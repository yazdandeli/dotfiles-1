"use strict";function factory(l,s,o,g){function y(t){return new Promise(n=>o.exists(t,n))}function J(t){return new Promise((n,r)=>{const e=new Date;o.utimes(t,e,e,i=>i?r(i):n())})}function I(t){return new Promise((n,r)=>o.lstat(t,(e,i)=>e?r(e):n(i)))}function M(t){return new Promise((n,r)=>o.readdir(t,(e,i)=>e?r(e):n(i)))}function T(t){return new Promise((n,r)=>o.mkdir(t,{recursive:!0},e=>e&&e.code!=="EEXIST"?r(e):n(t)))}function V(t){return new Promise((n,r)=>o.rmdir(t,e=>e?r(e):n(void 0)))}function U(t){return new Promise((n,r)=>o.unlink(t,e=>e?r(e):n(void 0)))}function N(t){return I(t).then(n=>n.isDirectory()&&!n.isSymbolicLink()?M(t).then(r=>Promise.all(r.map(e=>N(s.join(t,e))))).then(()=>V(t)):U(t),n=>{if(n.code!=="ENOENT")throw n})}function S(t){return new Promise(function(n,r){o.readFile(t,"utf8",function(e,i){if(e){r(e);return}n(i)})})}function F(t,n){return new Promise(function(r,e){o.writeFile(t,n,"utf8",function(i){if(i){e(i);return}r()})})}function X(t){const n=s.join(t,"languagepacks.json");try{return JSON.parse(o.readFileSync(n,"utf8"))}catch(r){}}function $(t,n){try{for(;n;){if(t[n])return n;{const r=n.lastIndexOf("-");if(r>0)n=n.substring(0,r);else return}}}catch(r){console.error("Resolving language pack configuration failed.",r)}}function z(t,n,r,e){if(e==="pseudo")return Promise.resolve({locale:e,availableLanguages:{},pseudo:!0});if(process.env.VSCODE_DEV)return Promise.resolve({locale:e,availableLanguages:{}});if(e&&(e==="en"||e==="en-us"))return Promise.resolve({locale:e,availableLanguages:{}});const i=e;g.mark("code/willGenerateNls");const u=function(a){return g.mark("code/didGenerateNls"),Promise.resolve({locale:a,availableLanguages:{}})};try{if(!t)return u(i);const a=X(n);if(!a||(e=$(a,e),!e))return u(i);const c=a[e];let w;return!c||typeof c.hash!="string"||!c.translations||typeof(w=c.translations.vscode)!="string"?u(i):y(w).then(A=>{if(!A)return u(i);const O=c.hash+"."+e,f=s.join(n,"clp",O),d=s.join(f,t),_=s.join(f,"tcf.json"),q=s.join(f,"corrupted.info"),x={locale:i,availableLanguages:{"*":e},_languagePackId:O,_translationsConfigFile:_,_cacheRoot:f,_resolvedLanguagePackCoreLocation:d,_corruptedFile:q};return y(q).then(B=>{let b;return B?b=N(f):b=Promise.resolve(void 0),b.then(()=>y(d).then(H=>H?(J(d).catch(()=>{}),g.mark("code/didGenerateNls"),x):T(d).then(()=>Promise.all([S(r),S(w)])).then(m=>{const p=JSON.parse(m[0]),K=JSON.parse(m[1]).contents,Q=Object.keys(p.bundles),v=[];for(const C of Q){const W=p.bundles[C],E=Object.create(null);for(const h of W){const G=p.keys[h],R=p.messages[h],D=K[h];let k;if(D){k=[];for(let P=0;P<G.length;P++){const j=G[P],Y=typeof j=="string"?j:j.key;let L=D[Y];L===void 0&&(L=R[P]),k.push(L)}}else k=R;E[h]=k}v.push(F(s.join(d,C.replace(/\//g,"!")+".nls.json"),JSON.stringify(E)))}return v.push(F(_,JSON.stringify(c.translations))),Promise.all(v)}).then(()=>(g.mark("code/didGenerateNls"),x)).catch(m=>(console.error("Generating translation files failed.",m),u(e)))))})})}catch(a){return console.error("Generating translation files failed.",a),u(e)}}return{getNLSConfiguration:z}}if(typeof define=="function")define(["path","fs","vs/base/common/performance"],function(l,s,o){return factory(require.__$__nodeRequire,l,s,o)});else if(typeof module=="object"&&typeof module.exports=="object"){const l=require("path"),s=require("fs"),o=require("../common/performance");module.exports=factory(require,l,s,o)}else throw new Error("Unknown context");

//# sourceMappingURL=languagePacks.js.map

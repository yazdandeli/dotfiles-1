{"version":3,"sources":["out-vscode/vs/workbench/services/extensions/node/fake","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/assert.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/collections.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/decorators.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/errors.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/arrays.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/functional.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/idGenerator.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/iterator.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/json.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/jsonFormatter.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/jsonEdit.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/lifecycle.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/linkedList.ts","out-vscode/vs/workbench/services/extensions/node/vs/base/common/marked/marked.js","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/numbers.ts","out-vscode/vs/workbench/services/extensions/node/vs/base/common/performance.js","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/platform.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/process.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/path.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/processes.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/stopwatch.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/event.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/cancellation.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/async.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/codicons.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/comparers.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/stream.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/strings.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/buffer.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/hash.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/severity.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/types.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/extpath.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/objects.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/uint.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/uri.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/map.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/filters.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/fuzzyScorer.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/glob.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/iconLabels.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/htmlContent.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/marshalling.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/network.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/normalization.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/resources.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/labels.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/uriIpc.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/uuid.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/node/decoder.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/node/pfs.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/node/extpath.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/node/powershell.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/node/proxy_agent.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/parts/ipc/common/ipc.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/parts/ipc/common/ipc.net.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/editor/common/core/characterClassifier.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/editor/common/controller/wordCharacterClassifier.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/editor/common/core/position.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/editor/common/core/range.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/editor/common/core/selection.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/editor/common/model.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/editor/common/model/textModelSearch.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/editor/common/model/wordHelper.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/editor/common/modes/languageConfiguration.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/editor/common/modes/languageSelector.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/editor/common/modes/linkComputer.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/editor/common/modes/tokenizationRegistry.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/editor/common/services/semanticTokensDto.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/editor/common/viewModel/prefixSumComputer.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/editor/common/model/mirrorTextModel.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/date.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/common/errorMessage.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/node/processes.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/node/shell.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/editor/common/config/editorOptions.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/instantiation/common/descriptors.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/instantiation/common/extensions.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/instantiation/common/graph.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/instantiation/common/instantiation.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/editor/common/services/modelService.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/editor/common/modes/languageFeatureRegistry.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/editor/common/modes.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/commands/common/commands.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/contextkey/common/contextkey.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/environment/common/environment.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/extensionManagement/common/extensionManagement.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/extensions/common/extensions.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/extensionManagement/common/extensionManagementUtil.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/files/common/files.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/instantiation/common/serviceCollection.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/instantiation/common/instantiationService.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/log/common/log.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/log/node/spdlogService.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/markers/common/markers.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/notification/common/notification.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/product/common/product.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/progress/common/progress.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/registry/common/platform.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/jsonschemas/common/jsonContributionRegistry.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/configuration/common/configurationRegistry.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/configuration/common/configuration.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/configuration/common/configurationModels.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/remote/common/remoteAuthorityResolver.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/remote/common/remoteHosts.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/sign/node/signService.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/theme/common/theme.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/theme/common/themeService.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/theme/common/iconRegistry.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/workspace/common/workspace.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/platform/workspaces/common/workspaces.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/cache.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostEditorTabs.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostFileSystemInfo.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostInitDataService.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostMemento.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostRpcService.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostSecrets.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostTunnelService.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostUriTransformerService.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/shared/webview.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostCodeInsets.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/common/views.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/apiCommands.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/contrib/debug/common/abstractDebugAdapter.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/contrib/debug/common/debugUtils.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/contrib/debug/node/debugAdapter.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/contrib/externalTerminal/node/externalTerminal.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/contrib/externalTerminal/node/externalTerminalService.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/contrib/debug/node/terminals.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/contrib/notebook/common/notebookCommon.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostNotebookDocument.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostTypes.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostDocumentData.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostNotebookConcatDocument.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostNotebookEditor.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostTheming.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/contrib/tasks/common/taskService.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/contrib/terminal/common/environmentVariable.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/contrib/terminal/common/environmentVariableCollection.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/contrib/terminal/common/environmentVariableShared.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/contrib/terminal/common/terminal.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/contrib/terminal/common/terminalDataBuffering.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/contrib/terminal/common/terminalEnvironment.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/contrib/terminal/node/terminal.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/contrib/terminal/node/terminalEnvironment.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/contrib/terminal/node/terminalProcess.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/contrib/testing/common/testCollection.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/services/configurationResolver/common/variableResolver.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/services/editor/common/editorGroupsService.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/services/editor/common/editorService.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostTypeConverters.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostDocumentSaveParticipant.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostFileSystemEventService.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostProgress.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostTextEditor.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostTreeViews.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/contrib/testing/common/ownedTestCollection.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/services/extensions/common/extensionDescriptionRegistry.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/services/extensions/common/extensionHostProtocol.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/services/extensions/common/extensions.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostExtensionActivator.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/node/extHostLogService.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/services/extensions/common/lazyPromise.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/services/extensions/common/proxyIdentifier.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHost.protocol.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/exHostSecretState.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostApiDeprecationService.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostAuthentication.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostBulkEdits.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostClipboard.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostCommands.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostApiCommands.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostComments.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostDecorations.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostDiagnostics.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostDialogs.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostDocumentContentProviders.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostDocuments.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostDocumentsAndEditors.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostFileSystem.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostFileSystemConsumer.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostLabelService.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostLanguageFeatures.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostLanguages.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostMessageService.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostNotebook.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostOutput.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostQuickOpen.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostSCM.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostStatusBar.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostStorage.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostStoragePaths.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostTerminalService.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostTextEditors.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostTimeline.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostUriOpener.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostUrls.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostWebview.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostCustomEditors.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostWebviewPanels.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostWebviewView.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostWindow.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/node/extHostDownloadService.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/node/extHostTunnelService.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/services/extensions/common/rpcProtocol.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/services/output/node/outputAppender.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/node/extHostOutputService.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/services/remote/common/remoteAgentService.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/services/path/common/pathService.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/services/search/common/search.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostWorkspace.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostConfiguration.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostTask.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostTesting.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/contrib/search/common/queryBuilder.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/shared/workspaceContains.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostExtensionService.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostDebugService.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostRequireInterceptor.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/node/extHostDebugService.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/node/extHostTask.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/node/extHostTerminalService.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/services/extensions/common/extensionHostMain.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/services/search/common/fileSearchManager.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/services/search/common/searchExtTypes.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/services/search/common/textSearchManager.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHostSearch.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHost.api.impl.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/common/extHost.common.services.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/services/search/node/ripgrepSearchUtils.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/services/textfile/common/encoding.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/services/search/node/textSearchManager.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/services/extensions/node/proxyResolver.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/services/search/node/ripgrepFileSearch.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/services/search/node/fileSearch.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/services/search/node/ripgrepTextSearchEngine.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/services/search/node/ripgrepSearchProvider.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/services/search/node/textSearchAdapter.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/services/search/node/rawSearchService.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/node/extHostSearch.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/base/parts/ipc/node/ipc.net.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/node/extHostCLIServer.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/node/extHostExtensionService.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/api/node/extHost.node.services.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/services/extensions/node/extensionHostProcessSetup.ts","out-vscode/vs/workbench/services/extensions/node/file:/github/workspace/lib/vscode/src/vs/workbench/services/extensions/node/extensionHostProcess.ts"],"sourcesContent":["}).call(this);","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n/**\n * Throws an error with the provided message if the provided value does not evaluate to a true Javascript value.\n */\nexport function ok(value?: unknown, message?: string) {\n\tif (!value) {\n\t\tthrow new Error(message ? `Assertion failed (${message})` : 'Assertion Failed');\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n/**\n * An interface for a JavaScript object that\n * acts a dictionary. The keys are strings.\n */\nexport type IStringDictionary<V> = Record<string, V>;\n\n\n/**\n * An interface for a JavaScript object that\n * acts a dictionary. The keys are numbers.\n */\nexport type INumberDictionary<V> = Record<number, V>;\n\nconst hasOwnProperty = Object.prototype.hasOwnProperty;\n\n/**\n * Returns an array which contains all values that reside\n * in the given dictionary.\n */\nexport function values<T>(from: IStringDictionary<T> | INumberDictionary<T>): T[] {\n\tconst result: T[] = [];\n\tfor (let key in from) {\n\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\tresult.push((from as any)[key]);\n\t\t}\n\t}\n\treturn result;\n}\n\n/**\n * Iterates over each entry in the provided dictionary. The iterator allows\n * to remove elements and will stop when the callback returns {{false}}.\n */\nexport function forEach<T>(from: IStringDictionary<T> | INumberDictionary<T>, callback: (entry: { key: any; value: T; }, remove: () => void) => any): void {\n\tfor (let key in from) {\n\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\tconst result = callback({ key: key, value: (from as any)[key] }, function () {\n\t\t\t\tdelete (from as any)[key];\n\t\t\t});\n\t\t\tif (result === false) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n}\n\n/**\n * Groups the collection into a dictionary based on the provided\n * group function.\n */\nexport function groupBy<T>(data: T[], groupFn: (element: T) => string): IStringDictionary<T[]> {\n\tconst result: IStringDictionary<T[]> = Object.create(null);\n\tfor (const element of data) {\n\t\tconst key = groupFn(element);\n\t\tlet target = result[key];\n\t\tif (!target) {\n\t\t\ttarget = result[key] = [];\n\t\t}\n\t\ttarget.push(element);\n\t}\n\treturn result;\n}\n\nexport function fromMap<T>(original: Map<string, T>): IStringDictionary<T> {\n\tconst result: IStringDictionary<T> = Object.create(null);\n\tif (original) {\n\t\toriginal.forEach((value, key) => {\n\t\t\tresult[key] = value;\n\t\t});\n\t}\n\treturn result;\n}\n\nexport function diffSets<T>(before: Set<T>, after: Set<T>): { removed: T[], added: T[] } {\n\tconst removed: T[] = [];\n\tconst added: T[] = [];\n\tfor (let element of before) {\n\t\tif (!after.has(element)) {\n\t\t\tremoved.push(element);\n\t\t}\n\t}\n\tfor (let element of after) {\n\t\tif (!before.has(element)) {\n\t\t\tadded.push(element);\n\t\t}\n\t}\n\treturn { removed, added };\n}\n\nexport function diffMaps<K, V>(before: Map<K, V>, after: Map<K, V>): { removed: V[], added: V[] } {\n\tconst removed: V[] = [];\n\tconst added: V[] = [];\n\tfor (let [index, value] of before) {\n\t\tif (!after.has(index)) {\n\t\t\tremoved.push(value);\n\t\t}\n\t}\n\tfor (let [index, value] of after) {\n\t\tif (!before.has(index)) {\n\t\t\tadded.push(value);\n\t\t}\n\t}\n\treturn { removed, added };\n}\nexport class SetMap<K, V> {\n\n\tprivate map = new Map<K, Set<V>>();\n\n\tadd(key: K, value: V): void {\n\t\tlet values = this.map.get(key);\n\n\t\tif (!values) {\n\t\t\tvalues = new Set<V>();\n\t\t\tthis.map.set(key, values);\n\t\t}\n\n\t\tvalues.add(value);\n\t}\n\n\tdelete(key: K, value: V): void {\n\t\tconst values = this.map.get(key);\n\n\t\tif (!values) {\n\t\t\treturn;\n\t\t}\n\n\t\tvalues.delete(value);\n\n\t\tif (values.size === 0) {\n\t\t\tthis.map.delete(key);\n\t\t}\n\t}\n\n\tforEach(key: K, fn: (value: V) => void): void {\n\t\tconst values = this.map.get(key);\n\n\t\tif (!values) {\n\t\t\treturn;\n\t\t}\n\n\t\tvalues.forEach(fn);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nexport function createDecorator(mapFn: (fn: Function, key: string) => Function): Function {\n\treturn (target: any, key: string, descriptor: any) => {\n\t\tlet fnKey: string | null = null;\n\t\tlet fn: Function | null = null;\n\n\t\tif (typeof descriptor.value === 'function') {\n\t\t\tfnKey = 'value';\n\t\t\tfn = descriptor.value;\n\t\t} else if (typeof descriptor.get === 'function') {\n\t\t\tfnKey = 'get';\n\t\t\tfn = descriptor.get;\n\t\t}\n\n\t\tif (!fn) {\n\t\t\tthrow new Error('not supported');\n\t\t}\n\n\t\tdescriptor[fnKey!] = mapFn(fn, key);\n\t};\n}\n\nlet memoizeId = 0;\nexport function createMemoizer() {\n\tconst memoizeKeyPrefix = `$memoize${memoizeId++}`;\n\tlet self: any = undefined;\n\n\tconst result = function memoize(target: any, key: string, descriptor: any) {\n\t\tlet fnKey: string | null = null;\n\t\tlet fn: Function | null = null;\n\n\t\tif (typeof descriptor.value === 'function') {\n\t\t\tfnKey = 'value';\n\t\t\tfn = descriptor.value;\n\n\t\t\tif (fn!.length !== 0) {\n\t\t\t\tconsole.warn('Memoize should only be used in functions with zero parameters');\n\t\t\t}\n\t\t} else if (typeof descriptor.get === 'function') {\n\t\t\tfnKey = 'get';\n\t\t\tfn = descriptor.get;\n\t\t}\n\n\t\tif (!fn) {\n\t\t\tthrow new Error('not supported');\n\t\t}\n\n\t\tconst memoizeKey = `${memoizeKeyPrefix}:${key}`;\n\t\tdescriptor[fnKey!] = function (...args: any[]) {\n\t\t\tself = this;\n\n\t\t\tif (!this.hasOwnProperty(memoizeKey)) {\n\t\t\t\tObject.defineProperty(this, memoizeKey, {\n\t\t\t\t\tconfigurable: true,\n\t\t\t\t\tenumerable: false,\n\t\t\t\t\twritable: true,\n\t\t\t\t\tvalue: fn!.apply(this, args)\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this[memoizeKey];\n\t\t};\n\t};\n\n\tresult.clear = () => {\n\t\tif (typeof self === 'undefined') {\n\t\t\treturn;\n\t\t}\n\t\tObject.getOwnPropertyNames(self).forEach(property => {\n\t\t\tif (property.indexOf(memoizeKeyPrefix) === 0) {\n\t\t\t\tdelete self[property];\n\t\t\t}\n\t\t});\n\t};\n\n\treturn result;\n}\n\nexport function memoize(target: any, key: string, descriptor: any) {\n\treturn createMemoizer()(target, key, descriptor);\n}\n\nexport interface IDebounceReducer<T> {\n\t(previousValue: T, ...args: any[]): T;\n}\n\nexport function debounce<T>(delay: number, reducer?: IDebounceReducer<T>, initialValueProvider?: () => T): Function {\n\treturn createDecorator((fn, key) => {\n\t\tconst timerKey = `$debounce$${key}`;\n\t\tconst resultKey = `$debounce$result$${key}`;\n\n\t\treturn function (this: any, ...args: any[]) {\n\t\t\tif (!this[resultKey]) {\n\t\t\t\tthis[resultKey] = initialValueProvider ? initialValueProvider() : undefined;\n\t\t\t}\n\n\t\t\tclearTimeout(this[timerKey]);\n\n\t\t\tif (reducer) {\n\t\t\t\tthis[resultKey] = reducer(this[resultKey], ...args);\n\t\t\t\targs = [this[resultKey]];\n\t\t\t}\n\n\t\t\tthis[timerKey] = setTimeout(() => {\n\t\t\t\tfn.apply(this, args);\n\t\t\t\tthis[resultKey] = initialValueProvider ? initialValueProvider() : undefined;\n\t\t\t}, delay);\n\t\t};\n\t});\n}\n\nexport function throttle<T>(delay: number, reducer?: IDebounceReducer<T>, initialValueProvider?: () => T): Function {\n\treturn createDecorator((fn, key) => {\n\t\tconst timerKey = `$throttle$timer$${key}`;\n\t\tconst resultKey = `$throttle$result$${key}`;\n\t\tconst lastRunKey = `$throttle$lastRun$${key}`;\n\t\tconst pendingKey = `$throttle$pending$${key}`;\n\n\t\treturn function (this: any, ...args: any[]) {\n\t\t\tif (!this[resultKey]) {\n\t\t\t\tthis[resultKey] = initialValueProvider ? initialValueProvider() : undefined;\n\t\t\t}\n\t\t\tif (this[lastRunKey] === null || this[lastRunKey] === undefined) {\n\t\t\t\tthis[lastRunKey] = -Number.MAX_VALUE;\n\t\t\t}\n\n\t\t\tif (reducer) {\n\t\t\t\tthis[resultKey] = reducer(this[resultKey], ...args);\n\t\t\t}\n\n\t\t\tif (this[pendingKey]) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst nextTime = this[lastRunKey] + delay;\n\t\t\tif (nextTime <= Date.now()) {\n\t\t\t\tthis[lastRunKey] = Date.now();\n\t\t\t\tfn.apply(this, [this[resultKey]]);\n\t\t\t\tthis[resultKey] = initialValueProvider ? initialValueProvider() : undefined;\n\t\t\t} else {\n\t\t\t\tthis[pendingKey] = true;\n\t\t\t\tthis[timerKey] = setTimeout(() => {\n\t\t\t\t\tthis[pendingKey] = false;\n\t\t\t\t\tthis[lastRunKey] = Date.now();\n\t\t\t\t\tfn.apply(this, [this[resultKey]]);\n\t\t\t\t\tthis[resultKey] = initialValueProvider ? initialValueProvider() : undefined;\n\t\t\t\t}, nextTime - Date.now());\n\t\t\t}\n\t\t};\n\t});\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nexport interface ErrorListenerCallback {\n\t(error: any): void;\n}\n\nexport interface ErrorListenerUnbind {\n\t(): void;\n}\n\n// Avoid circular dependency on EventEmitter by implementing a subset of the interface.\nexport class ErrorHandler {\n\tprivate unexpectedErrorHandler: (e: any) => void;\n\tprivate listeners: ErrorListenerCallback[];\n\n\tconstructor() {\n\n\t\tthis.listeners = [];\n\n\t\tthis.unexpectedErrorHandler = function (e: any) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (e.stack) {\n\t\t\t\t\tthrow new Error(e.message + '\\n\\n' + e.stack);\n\t\t\t\t}\n\n\t\t\t\tthrow e;\n\t\t\t}, 0);\n\t\t};\n\t}\n\n\taddListener(listener: ErrorListenerCallback): ErrorListenerUnbind {\n\t\tthis.listeners.push(listener);\n\n\t\treturn () => {\n\t\t\tthis._removeListener(listener);\n\t\t};\n\t}\n\n\tprivate emit(e: any): void {\n\t\tthis.listeners.forEach((listener) => {\n\t\t\tlistener(e);\n\t\t});\n\t}\n\n\tprivate _removeListener(listener: ErrorListenerCallback): void {\n\t\tthis.listeners.splice(this.listeners.indexOf(listener), 1);\n\t}\n\n\tsetUnexpectedErrorHandler(newUnexpectedErrorHandler: (e: any) => void): void {\n\t\tthis.unexpectedErrorHandler = newUnexpectedErrorHandler;\n\t}\n\n\tgetUnexpectedErrorHandler(): (e: any) => void {\n\t\treturn this.unexpectedErrorHandler;\n\t}\n\n\tonUnexpectedError(e: any): void {\n\t\tthis.unexpectedErrorHandler(e);\n\t\tthis.emit(e);\n\t}\n\n\t// For external errors, we don't want the listeners to be called\n\tonUnexpectedExternalError(e: any): void {\n\t\tthis.unexpectedErrorHandler(e);\n\t}\n}\n\nexport const errorHandler = new ErrorHandler();\n\nexport function setUnexpectedErrorHandler(newUnexpectedErrorHandler: (e: any) => void): void {\n\terrorHandler.setUnexpectedErrorHandler(newUnexpectedErrorHandler);\n}\n\nexport function onUnexpectedError(e: any): undefined {\n\t// ignore errors from cancelled promises\n\tif (!isPromiseCanceledError(e)) {\n\t\terrorHandler.onUnexpectedError(e);\n\t}\n\treturn undefined;\n}\n\nexport function onUnexpectedExternalError(e: any): undefined {\n\t// ignore errors from cancelled promises\n\tif (!isPromiseCanceledError(e)) {\n\t\terrorHandler.onUnexpectedExternalError(e);\n\t}\n\treturn undefined;\n}\n\nexport interface SerializedError {\n\treadonly $isError: true;\n\treadonly name: string;\n\treadonly message: string;\n\treadonly stack: string;\n}\n\nexport function transformErrorForSerialization(error: Error): SerializedError;\nexport function transformErrorForSerialization(error: any): any;\nexport function transformErrorForSerialization(error: any): any {\n\tif (error instanceof Error) {\n\t\tlet { name, message } = error;\n\t\tconst stack: string = (<any>error).stacktrace || (<any>error).stack;\n\t\treturn {\n\t\t\t$isError: true,\n\t\t\tname,\n\t\t\tmessage,\n\t\t\tstack\n\t\t};\n\t}\n\n\t// return as is\n\treturn error;\n}\n\n// see https://github.com/v8/v8/wiki/Stack%20Trace%20API#basic-stack-traces\nexport interface V8CallSite {\n\tgetThis(): any;\n\tgetTypeName(): string;\n\tgetFunction(): string;\n\tgetFunctionName(): string;\n\tgetMethodName(): string;\n\tgetFileName(): string;\n\tgetLineNumber(): number;\n\tgetColumnNumber(): number;\n\tgetEvalOrigin(): string;\n\tisToplevel(): boolean;\n\tisEval(): boolean;\n\tisNative(): boolean;\n\tisConstructor(): boolean;\n\ttoString(): string;\n}\n\nconst canceledName = 'Canceled';\n\n/**\n * Checks if the given error is a promise in canceled state\n */\nexport function isPromiseCanceledError(error: any): boolean {\n\treturn error instanceof Error && error.name === canceledName && error.message === canceledName;\n}\n\n// !!!IMPORTANT!!!\n// Do NOT change this class because it is also used as an API-type.\nexport class CancellationError extends Error {\n\tconstructor() {\n\t\tsuper(canceledName);\n\t\tthis.name = this.message;\n\t}\n}\n\n/**\n * Returns an error that signals cancellation.\n */\nexport function canceled(): Error {\n\tconst error = new Error(canceledName);\n\terror.name = error.message;\n\treturn error;\n}\n\nexport function illegalArgument(name?: string): Error {\n\tif (name) {\n\t\treturn new Error(`Illegal argument: ${name}`);\n\t} else {\n\t\treturn new Error('Illegal argument');\n\t}\n}\n\nexport function illegalState(name?: string): Error {\n\tif (name) {\n\t\treturn new Error(`Illegal state: ${name}`);\n\t} else {\n\t\treturn new Error('Illegal state');\n\t}\n}\n\nexport function readonly(name?: string): Error {\n\treturn name\n\t\t? new Error(`readonly property '${name} cannot be changed'`)\n\t\t: new Error('readonly property cannot be changed');\n}\n\nexport function disposed(what: string): Error {\n\tconst result = new Error(`${what} has been disposed`);\n\tresult.name = 'DISPOSED';\n\treturn result;\n}\n\nexport function getErrorMessage(err: any): string {\n\tif (!err) {\n\t\treturn 'Error';\n\t}\n\n\tif (err.message) {\n\t\treturn err.message;\n\t}\n\n\tif (err.stack) {\n\t\treturn err.stack.split('\\n')[0];\n\t}\n\n\treturn String(err);\n}\n\nexport class NotImplementedError extends Error {\n\tconstructor(message?: string) {\n\t\tsuper('NotImplemented');\n\t\tif (message) {\n\t\t\tthis.message = message;\n\t\t}\n\t}\n}\n\nexport class NotSupportedError extends Error {\n\tconstructor(message?: string) {\n\t\tsuper('NotSupported');\n\t\tif (message) {\n\t\t\tthis.message = message;\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { canceled } from 'vs/base/common/errors';\nimport { ISplice } from 'vs/base/common/sequence';\n\n/**\n * Returns the last element of an array.\n * @param array The array.\n * @param n Which element from the end (default is zero).\n */\nexport function tail<T>(array: ArrayLike<T>, n: number = 0): T {\n\treturn array[array.length - (1 + n)];\n}\n\nexport function tail2<T>(arr: T[]): [T[], T] {\n\tif (arr.length === 0) {\n\t\tthrow new Error('Invalid tail call');\n\t}\n\n\treturn [arr.slice(0, arr.length - 1), arr[arr.length - 1]];\n}\n\nexport function equals<T>(one: ReadonlyArray<T> | undefined, other: ReadonlyArray<T> | undefined, itemEquals: (a: T, b: T) => boolean = (a, b) => a === b): boolean {\n\tif (one === other) {\n\t\treturn true;\n\t}\n\n\tif (!one || !other) {\n\t\treturn false;\n\t}\n\n\tif (one.length !== other.length) {\n\t\treturn false;\n\t}\n\n\tfor (let i = 0, len = one.length; i < len; i++) {\n\t\tif (!itemEquals(one[i], other[i])) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}\n\nexport function binarySearch<T>(array: ReadonlyArray<T>, key: T, comparator: (op1: T, op2: T) => number): number {\n\tlet low = 0,\n\t\thigh = array.length - 1;\n\n\twhile (low <= high) {\n\t\tconst mid = ((low + high) / 2) | 0;\n\t\tconst comp = comparator(array[mid], key);\n\t\tif (comp < 0) {\n\t\t\tlow = mid + 1;\n\t\t} else if (comp > 0) {\n\t\t\thigh = mid - 1;\n\t\t} else {\n\t\t\treturn mid;\n\t\t}\n\t}\n\treturn -(low + 1);\n}\n\n/**\n * Takes a sorted array and a function p. The array is sorted in such a way that all elements where p(x) is false\n * are located before all elements where p(x) is true.\n * @returns the least x for which p(x) is true or array.length if no element fullfills the given function.\n */\nexport function findFirstInSorted<T>(array: ReadonlyArray<T>, p: (x: T) => boolean): number {\n\tlet low = 0, high = array.length;\n\tif (high === 0) {\n\t\treturn 0; // no children\n\t}\n\twhile (low < high) {\n\t\tconst mid = Math.floor((low + high) / 2);\n\t\tif (p(array[mid])) {\n\t\t\thigh = mid;\n\t\t} else {\n\t\t\tlow = mid + 1;\n\t\t}\n\t}\n\treturn low;\n}\n\ntype Compare<T> = (a: T, b: T) => number;\n\n\nexport function quickSelect<T>(nth: number, data: T[], compare: Compare<T>): T {\n\n\tnth = nth | 0;\n\n\tif (nth >= data.length) {\n\t\tthrow new TypeError('invalid index');\n\t}\n\n\tlet pivotValue = data[Math.floor(data.length * Math.random())];\n\tlet lower: T[] = [];\n\tlet higher: T[] = [];\n\tlet pivots: T[] = [];\n\n\tfor (let value of data) {\n\t\tconst val = compare(value, pivotValue);\n\t\tif (val < 0) {\n\t\t\tlower.push(value);\n\t\t} else if (val > 0) {\n\t\t\thigher.push(value);\n\t\t} else {\n\t\t\tpivots.push(value);\n\t\t}\n\t}\n\n\tif (nth < lower.length) {\n\t\treturn quickSelect(nth, lower, compare);\n\t} else if (nth < lower.length + pivots.length) {\n\t\treturn pivots[0];\n\t} else {\n\t\treturn quickSelect(nth - (lower.length + pivots.length), higher, compare);\n\t}\n}\n\n/**\n * Like `Array#sort` but always stable. Usually runs a little slower `than Array#sort`\n * so only use this when actually needing stable sort.\n */\nexport function mergeSort<T>(data: T[], compare: Compare<T>): T[] {\n\t_sort(data, compare, 0, data.length - 1, []);\n\treturn data;\n}\n\nfunction _merge<T>(a: T[], compare: Compare<T>, lo: number, mid: number, hi: number, aux: T[]): void {\n\tlet leftIdx = lo, rightIdx = mid + 1;\n\tfor (let i = lo; i <= hi; i++) {\n\t\taux[i] = a[i];\n\t}\n\tfor (let i = lo; i <= hi; i++) {\n\t\tif (leftIdx > mid) {\n\t\t\t// left side consumed\n\t\t\ta[i] = aux[rightIdx++];\n\t\t} else if (rightIdx > hi) {\n\t\t\t// right side consumed\n\t\t\ta[i] = aux[leftIdx++];\n\t\t} else if (compare(aux[rightIdx], aux[leftIdx]) < 0) {\n\t\t\t// right element is less -> comes first\n\t\t\ta[i] = aux[rightIdx++];\n\t\t} else {\n\t\t\t// left element comes first (less or equal)\n\t\t\ta[i] = aux[leftIdx++];\n\t\t}\n\t}\n}\n\nfunction _sort<T>(a: T[], compare: Compare<T>, lo: number, hi: number, aux: T[]) {\n\tif (hi <= lo) {\n\t\treturn;\n\t}\n\tconst mid = lo + ((hi - lo) / 2) | 0;\n\t_sort(a, compare, lo, mid, aux);\n\t_sort(a, compare, mid + 1, hi, aux);\n\tif (compare(a[mid], a[mid + 1]) <= 0) {\n\t\t// left and right are sorted and if the last-left element is less\n\t\t// or equals than the first-right element there is nothing else\n\t\t// to do\n\t\treturn;\n\t}\n\t_merge(a, compare, lo, mid, hi, aux);\n}\n\n\nexport function groupBy<T>(data: ReadonlyArray<T>, compare: (a: T, b: T) => number): T[][] {\n\tconst result: T[][] = [];\n\tlet currentGroup: T[] | undefined = undefined;\n\tfor (const element of mergeSort(data.slice(0), compare)) {\n\t\tif (!currentGroup || compare(currentGroup[0], element) !== 0) {\n\t\t\tcurrentGroup = [element];\n\t\t\tresult.push(currentGroup);\n\t\t} else {\n\t\t\tcurrentGroup.push(element);\n\t\t}\n\t}\n\treturn result;\n}\n\ninterface IMutableSplice<T> extends ISplice<T> {\n\tdeleteCount: number;\n}\n\n/**\n * Diffs two *sorted* arrays and computes the splices which apply the diff.\n */\nexport function sortedDiff<T>(before: ReadonlyArray<T>, after: ReadonlyArray<T>, compare: (a: T, b: T) => number): ISplice<T>[] {\n\tconst result: IMutableSplice<T>[] = [];\n\n\tfunction pushSplice(start: number, deleteCount: number, toInsert: T[]): void {\n\t\tif (deleteCount === 0 && toInsert.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst latest = result[result.length - 1];\n\n\t\tif (latest && latest.start + latest.deleteCount === start) {\n\t\t\tlatest.deleteCount += deleteCount;\n\t\t\tlatest.toInsert.push(...toInsert);\n\t\t} else {\n\t\t\tresult.push({ start, deleteCount, toInsert });\n\t\t}\n\t}\n\n\tlet beforeIdx = 0;\n\tlet afterIdx = 0;\n\n\twhile (true) {\n\t\tif (beforeIdx === before.length) {\n\t\t\tpushSplice(beforeIdx, 0, after.slice(afterIdx));\n\t\t\tbreak;\n\t\t}\n\t\tif (afterIdx === after.length) {\n\t\t\tpushSplice(beforeIdx, before.length - beforeIdx, []);\n\t\t\tbreak;\n\t\t}\n\n\t\tconst beforeElement = before[beforeIdx];\n\t\tconst afterElement = after[afterIdx];\n\t\tconst n = compare(beforeElement, afterElement);\n\t\tif (n === 0) {\n\t\t\t// equal\n\t\t\tbeforeIdx += 1;\n\t\t\tafterIdx += 1;\n\t\t} else if (n < 0) {\n\t\t\t// beforeElement is smaller -> before element removed\n\t\t\tpushSplice(beforeIdx, 1, []);\n\t\t\tbeforeIdx += 1;\n\t\t} else if (n > 0) {\n\t\t\t// beforeElement is greater -> after element added\n\t\t\tpushSplice(beforeIdx, 0, [afterElement]);\n\t\t\tafterIdx += 1;\n\t\t}\n\t}\n\n\treturn result;\n}\n\n/**\n * Takes two *sorted* arrays and computes their delta (removed, added elements).\n * Finishes in `Math.min(before.length, after.length)` steps.\n */\nexport function delta<T>(before: ReadonlyArray<T>, after: ReadonlyArray<T>, compare: (a: T, b: T) => number): { removed: T[], added: T[] } {\n\tconst splices = sortedDiff(before, after, compare);\n\tconst removed: T[] = [];\n\tconst added: T[] = [];\n\n\tfor (const splice of splices) {\n\t\tremoved.push(...before.slice(splice.start, splice.start + splice.deleteCount));\n\t\tadded.push(...splice.toInsert);\n\t}\n\n\treturn { removed, added };\n}\n\n/**\n * Returns the top N elements from the array.\n *\n * Faster than sorting the entire array when the array is a lot larger than N.\n *\n * @param array The unsorted array.\n * @param compare A sort function for the elements.\n * @param n The number of elements to return.\n * @return The first n elemnts from array when sorted with compare.\n */\nexport function top<T>(array: ReadonlyArray<T>, compare: (a: T, b: T) => number, n: number): T[] {\n\tif (n === 0) {\n\t\treturn [];\n\t}\n\tconst result = array.slice(0, n).sort(compare);\n\ttopStep(array, compare, result, n, array.length);\n\treturn result;\n}\n\n/**\n * Asynchronous variant of `top()` allowing for splitting up work in batches between which the event loop can run.\n *\n * Returns the top N elements from the array.\n *\n * Faster than sorting the entire array when the array is a lot larger than N.\n *\n * @param array The unsorted array.\n * @param compare A sort function for the elements.\n * @param n The number of elements to return.\n * @param batch The number of elements to examine before yielding to the event loop.\n * @return The first n elemnts from array when sorted with compare.\n */\nexport function topAsync<T>(array: T[], compare: (a: T, b: T) => number, n: number, batch: number, token?: CancellationToken): Promise<T[]> {\n\tif (n === 0) {\n\t\treturn Promise.resolve([]);\n\t}\n\n\treturn new Promise((resolve, reject) => {\n\t\t(async () => {\n\t\t\tconst o = array.length;\n\t\t\tconst result = array.slice(0, n).sort(compare);\n\t\t\tfor (let i = n, m = Math.min(n + batch, o); i < o; i = m, m = Math.min(m + batch, o)) {\n\t\t\t\tif (i > n) {\n\t\t\t\t\tawait new Promise(resolve => setTimeout(resolve)); // nextTick() would starve I/O.\n\t\t\t\t}\n\t\t\t\tif (token && token.isCancellationRequested) {\n\t\t\t\t\tthrow canceled();\n\t\t\t\t}\n\t\t\t\ttopStep(array, compare, result, i, m);\n\t\t\t}\n\t\t\treturn result;\n\t\t})()\n\t\t\t.then(resolve, reject);\n\t});\n}\n\nfunction topStep<T>(array: ReadonlyArray<T>, compare: (a: T, b: T) => number, result: T[], i: number, m: number): void {\n\tfor (const n = result.length; i < m; i++) {\n\t\tconst element = array[i];\n\t\tif (compare(element, result[n - 1]) < 0) {\n\t\t\tresult.pop();\n\t\t\tconst j = findFirstInSorted(result, e => compare(element, e) < 0);\n\t\t\tresult.splice(j, 0, element);\n\t\t}\n\t}\n}\n\n/**\n * @returns New array with all falsy values removed. The original array IS NOT modified.\n */\nexport function coalesce<T>(array: ReadonlyArray<T | undefined | null>): T[] {\n\treturn <T[]>array.filter(e => !!e);\n}\n\n/**\n * Remove all falsey values from `array`. The original array IS modified.\n */\nexport function coalesceInPlace<T>(array: Array<T | undefined | null>): void {\n\tlet to = 0;\n\tfor (let i = 0; i < array.length; i++) {\n\t\tif (!!array[i]) {\n\t\t\tarray[to] = array[i];\n\t\t\tto += 1;\n\t\t}\n\t}\n\tarray.length = to;\n}\n\n/**\n * Moves the element in the array for the provided positions.\n */\nexport function move(array: any[], from: number, to: number): void {\n\tarray.splice(to, 0, array.splice(from, 1)[0]);\n}\n\n/**\n * @returns false if the provided object is an array and not empty.\n */\nexport function isFalsyOrEmpty(obj: any): boolean {\n\treturn !Array.isArray(obj) || obj.length === 0;\n}\n\n/**\n * @returns True if the provided object is an array and has at least one element.\n */\nexport function isNonEmptyArray<T>(obj: T[] | undefined | null): obj is T[];\nexport function isNonEmptyArray<T>(obj: readonly T[] | undefined | null): obj is readonly T[];\nexport function isNonEmptyArray<T>(obj: T[] | readonly T[] | undefined | null): obj is T[] | readonly T[] {\n\treturn Array.isArray(obj) && obj.length > 0;\n}\n\n/**\n * Removes duplicates from the given array. The optional keyFn allows to specify\n * how elements are checked for equalness by returning a unique string for each.\n */\nexport function distinct<T>(array: ReadonlyArray<T>, keyFn?: (t: T) => string): T[] {\n\tif (!keyFn) {\n\t\treturn array.filter((element, position) => {\n\t\t\treturn array.indexOf(element) === position;\n\t\t});\n\t}\n\n\tconst seen: { [key: string]: boolean; } = Object.create(null);\n\treturn array.filter((elem) => {\n\t\tconst key = keyFn(elem);\n\t\tif (seen[key]) {\n\t\t\treturn false;\n\t\t}\n\n\t\tseen[key] = true;\n\n\t\treturn true;\n\t});\n}\n\nexport function distinctES6<T>(array: ReadonlyArray<T>): T[] {\n\tconst seen = new Set<T>();\n\treturn array.filter(element => {\n\t\tif (seen.has(element)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tseen.add(element);\n\t\treturn true;\n\t});\n}\n\nexport function uniqueFilter<T>(keyFn: (t: T) => string): (t: T) => boolean {\n\tconst seen: { [key: string]: boolean; } = Object.create(null);\n\n\treturn element => {\n\t\tconst key = keyFn(element);\n\n\t\tif (seen[key]) {\n\t\t\treturn false;\n\t\t}\n\n\t\tseen[key] = true;\n\t\treturn true;\n\t};\n}\n\nexport function lastIndex<T>(array: ReadonlyArray<T>, fn: (item: T) => boolean): number {\n\tfor (let i = array.length - 1; i >= 0; i--) {\n\t\tconst element = array[i];\n\n\t\tif (fn(element)) {\n\t\t\treturn i;\n\t\t}\n\t}\n\n\treturn -1;\n}\n\nexport function firstOrDefault<T, NotFound = T>(array: ReadonlyArray<T>, notFoundValue: NotFound): T | NotFound;\nexport function firstOrDefault<T>(array: ReadonlyArray<T>): T | undefined;\nexport function firstOrDefault<T, NotFound = T>(array: ReadonlyArray<T>, notFoundValue?: NotFound): T | NotFound | undefined {\n\treturn array.length > 0 ? array[0] : notFoundValue;\n}\n\nexport function commonPrefixLength<T>(one: ReadonlyArray<T>, other: ReadonlyArray<T>, equals: (a: T, b: T) => boolean = (a, b) => a === b): number {\n\tlet result = 0;\n\n\tfor (let i = 0, len = Math.min(one.length, other.length); i < len && equals(one[i], other[i]); i++) {\n\t\tresult++;\n\t}\n\n\treturn result;\n}\n\nexport function flatten<T>(arr: T[][]): T[] {\n\treturn (<T[]>[]).concat(...arr);\n}\n\nexport function range(to: number): number[];\nexport function range(from: number, to: number): number[];\nexport function range(arg: number, to?: number): number[] {\n\tlet from = typeof to === 'number' ? arg : 0;\n\n\tif (typeof to === 'number') {\n\t\tfrom = arg;\n\t} else {\n\t\tfrom = 0;\n\t\tto = arg;\n\t}\n\n\tconst result: number[] = [];\n\n\tif (from <= to) {\n\t\tfor (let i = from; i < to; i++) {\n\t\t\tresult.push(i);\n\t\t}\n\t} else {\n\t\tfor (let i = from; i > to; i--) {\n\t\t\tresult.push(i);\n\t\t}\n\t}\n\n\treturn result;\n}\n\nexport function index<T>(array: ReadonlyArray<T>, indexer: (t: T) => string): { [key: string]: T; };\nexport function index<T, R>(array: ReadonlyArray<T>, indexer: (t: T) => string, mapper: (t: T) => R): { [key: string]: R; };\nexport function index<T, R>(array: ReadonlyArray<T>, indexer: (t: T) => string, mapper?: (t: T) => R): { [key: string]: R; } {\n\treturn array.reduce((r, t) => {\n\t\tr[indexer(t)] = mapper ? mapper(t) : t;\n\t\treturn r;\n\t}, Object.create(null));\n}\n\n/**\n * Inserts an element into an array. Returns a function which, when\n * called, will remove that element from the array.\n */\nexport function insert<T>(array: T[], element: T): () => void {\n\tarray.push(element);\n\n\treturn () => remove(array, element);\n}\n\n/**\n * Removes an element from an array if it can be found.\n */\nexport function remove<T>(array: T[], element: T): T | undefined {\n\tconst index = array.indexOf(element);\n\tif (index > -1) {\n\t\tarray.splice(index, 1);\n\n\t\treturn element;\n\t}\n\n\treturn undefined;\n}\n\n/**\n * Insert `insertArr` inside `target` at `insertIndex`.\n * Please don't touch unless you understand https://jsperf.com/inserting-an-array-within-an-array\n */\nexport function arrayInsert<T>(target: T[], insertIndex: number, insertArr: T[]): T[] {\n\tconst before = target.slice(0, insertIndex);\n\tconst after = target.slice(insertIndex);\n\treturn before.concat(insertArr, after);\n}\n\n/**\n * Uses Fisher-Yates shuffle to shuffle the given array\n */\nexport function shuffle<T>(array: T[], _seed?: number): void {\n\tlet rand: () => number;\n\n\tif (typeof _seed === 'number') {\n\t\tlet seed = _seed;\n\t\t// Seeded random number generator in JS. Modified from:\n\t\t// https://stackoverflow.com/questions/521295/seeding-the-random-number-generator-in-javascript\n\t\trand = () => {\n\t\t\tconst x = Math.sin(seed++) * 179426549; // throw away most significant digits and reduce any potential bias\n\t\t\treturn x - Math.floor(x);\n\t\t};\n\t} else {\n\t\trand = Math.random;\n\t}\n\n\tfor (let i = array.length - 1; i > 0; i -= 1) {\n\t\tconst j = Math.floor(rand() * (i + 1));\n\t\tconst temp = array[i];\n\t\tarray[i] = array[j];\n\t\tarray[j] = temp;\n\t}\n}\n\n/**\n * Pushes an element to the start of the array, if found.\n */\nexport function pushToStart<T>(arr: T[], value: T): void {\n\tconst index = arr.indexOf(value);\n\n\tif (index > -1) {\n\t\tarr.splice(index, 1);\n\t\tarr.unshift(value);\n\t}\n}\n\n/**\n * Pushes an element to the end of the array, if found.\n */\nexport function pushToEnd<T>(arr: T[], value: T): void {\n\tconst index = arr.indexOf(value);\n\n\tif (index > -1) {\n\t\tarr.splice(index, 1);\n\t\tarr.push(value);\n\t}\n}\n\nexport function mapArrayOrNot<T, U>(items: T | T[], fn: (_: T) => U): U | U[] {\n\treturn Array.isArray(items) ?\n\t\titems.map(fn) :\n\t\tfn(items);\n}\n\nexport function asArray<T>(x: T | T[]): T[];\nexport function asArray<T>(x: T | readonly T[]): readonly T[];\nexport function asArray<T>(x: T | T[]): T[] {\n\treturn Array.isArray(x) ? x : [x];\n}\n\nexport function getRandomElement<T>(arr: T[]): T | undefined {\n\treturn arr[Math.floor(Math.random() * arr.length)];\n}\n\n/**\n * Returns the first mapped value of the array which is not undefined.\n */\nexport function mapFind<T, R>(array: Iterable<T>, mapFn: (value: T) => R | undefined): R | undefined {\n\tfor (const value of array) {\n\t\tconst mapped = mapFn(value);\n\t\tif (mapped !== undefined) {\n\t\t\treturn mapped;\n\t\t}\n\t}\n\n\treturn undefined;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nexport function once<T extends Function>(this: unknown, fn: T): T {\n\tconst _this = this;\n\tlet didCall = false;\n\tlet result: unknown;\n\n\treturn function () {\n\t\tif (didCall) {\n\t\t\treturn result;\n\t\t}\n\n\t\tdidCall = true;\n\t\tresult = fn.apply(_this, arguments);\n\n\t\treturn result;\n\t} as unknown as T;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nexport class IdGenerator {\n\n\tprivate _prefix: string;\n\tprivate _lastId: number;\n\n\tconstructor(prefix: string) {\n\t\tthis._prefix = prefix;\n\t\tthis._lastId = 0;\n\t}\n\n\tpublic nextId(): string {\n\t\treturn this._prefix + (++this._lastId);\n\t}\n}\n\nexport const defaultGenerator = new IdGenerator('id#');","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nexport namespace Iterable {\n\n\texport function is<T = any>(thing: any): thing is IterableIterator<T> {\n\t\treturn thing && typeof thing === 'object' && typeof thing[Symbol.iterator] === 'function';\n\t}\n\n\tconst _empty: Iterable<any> = Object.freeze([]);\n\texport function empty<T = any>(): Iterable<T> {\n\t\treturn _empty;\n\t}\n\n\texport function* single<T>(element: T): Iterable<T> {\n\t\tyield element;\n\t}\n\n\texport function from<T>(iterable: Iterable<T> | undefined | null): Iterable<T> {\n\t\treturn iterable || _empty;\n\t}\n\n\texport function isEmpty<T>(iterable: Iterable<T> | undefined | null): boolean {\n\t\treturn !iterable || iterable[Symbol.iterator]().next().done === true;\n\t}\n\n\texport function first<T>(iterable: Iterable<T>): T | undefined {\n\t\treturn iterable[Symbol.iterator]().next().value;\n\t}\n\n\texport function some<T>(iterable: Iterable<T>, predicate: (t: T) => boolean): boolean {\n\t\tfor (const element of iterable) {\n\t\t\tif (predicate(element)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\texport function filter<T, R extends T>(iterable: Iterable<T>, predicate: (t: T) => t is R): Iterable<R>;\n\texport function filter<T>(iterable: Iterable<T>, predicate: (t: T) => boolean): Iterable<T>;\n\texport function* filter<T>(iterable: Iterable<T>, predicate: (t: T) => boolean): Iterable<T> {\n\t\tfor (const element of iterable) {\n\t\t\tif (predicate(element)) {\n\t\t\t\tyield element;\n\t\t\t}\n\t\t}\n\t}\n\n\texport function* map<T, R>(iterable: Iterable<T>, fn: (t: T) => R): Iterable<R> {\n\t\tfor (const element of iterable) {\n\t\t\tyield fn(element);\n\t\t}\n\t}\n\n\texport function* concat<T>(...iterables: Iterable<T>[]): Iterable<T> {\n\t\tfor (const iterable of iterables) {\n\t\t\tfor (const element of iterable) {\n\t\t\t\tyield element;\n\t\t\t}\n\t\t}\n\t}\n\n\texport function* concatNested<T>(iterables: Iterable<Iterable<T>>): Iterable<T> {\n\t\tfor (const iterable of iterables) {\n\t\t\tfor (const element of iterable) {\n\t\t\t\tyield element;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Returns an iterable slice of the array, with the same semantics as `array.slice()`.\n\t */\n\texport function* slice<T>(iterable: ReadonlyArray<T>, from: number, to = iterable.length): Iterable<T> {\n\t\tif (from < 0) {\n\t\t\tfrom += iterable.length;\n\t\t}\n\n\t\tif (to < 0) {\n\t\t\tto += iterable.length;\n\t\t} else if (to > iterable.length) {\n\t\t\tto = iterable.length;\n\t\t}\n\n\t\tfor (; from < to; from++) {\n\t\t\tyield iterable[from];\n\t\t}\n\t}\n\n\t/**\n\t * Consumes `atMost` elements from iterable and returns the consumed elements,\n\t * and an iterable for the rest of the elements.\n\t */\n\texport function consume<T>(iterable: Iterable<T>, atMost: number = Number.POSITIVE_INFINITY): [T[], Iterable<T>] {\n\t\tconst consumed: T[] = [];\n\n\t\tif (atMost === 0) {\n\t\t\treturn [consumed, iterable];\n\t\t}\n\n\t\tconst iterator = iterable[Symbol.iterator]();\n\n\t\tfor (let i = 0; i < atMost; i++) {\n\t\t\tconst next = iterator.next();\n\n\t\t\tif (next.done) {\n\t\t\t\treturn [consumed, Iterable.empty()];\n\t\t\t}\n\n\t\t\tconsumed.push(next.value);\n\t\t}\n\n\t\treturn [consumed, { [Symbol.iterator]() { return iterator; } }];\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nexport const enum ScanError {\n\tNone = 0,\n\tUnexpectedEndOfComment = 1,\n\tUnexpectedEndOfString = 2,\n\tUnexpectedEndOfNumber = 3,\n\tInvalidUnicode = 4,\n\tInvalidEscapeCharacter = 5,\n\tInvalidCharacter = 6\n}\n\nexport const enum SyntaxKind {\n\tOpenBraceToken = 1,\n\tCloseBraceToken = 2,\n\tOpenBracketToken = 3,\n\tCloseBracketToken = 4,\n\tCommaToken = 5,\n\tColonToken = 6,\n\tNullKeyword = 7,\n\tTrueKeyword = 8,\n\tFalseKeyword = 9,\n\tStringLiteral = 10,\n\tNumericLiteral = 11,\n\tLineCommentTrivia = 12,\n\tBlockCommentTrivia = 13,\n\tLineBreakTrivia = 14,\n\tTrivia = 15,\n\tUnknown = 16,\n\tEOF = 17\n}\n\n/**\n * The scanner object, representing a JSON scanner at a position in the input string.\n */\nexport interface JSONScanner {\n\t/**\n\t * Sets the scan position to a new offset. A call to 'scan' is needed to get the first token.\n\t */\n\tsetPosition(pos: number): void;\n\t/**\n\t * Read the next token. Returns the token code.\n\t */\n\tscan(): SyntaxKind;\n\t/**\n\t * Returns the current scan position, which is after the last read token.\n\t */\n\tgetPosition(): number;\n\t/**\n\t * Returns the last read token.\n\t */\n\tgetToken(): SyntaxKind;\n\t/**\n\t * Returns the last read token value. The value for strings is the decoded string content. For numbers its of type number, for boolean it's true or false.\n\t */\n\tgetTokenValue(): string;\n\t/**\n\t * The start offset of the last read token.\n\t */\n\tgetTokenOffset(): number;\n\t/**\n\t * The length of the last read token.\n\t */\n\tgetTokenLength(): number;\n\t/**\n\t * An error code of the last scan.\n\t */\n\tgetTokenError(): ScanError;\n}\n\n\n\nexport interface ParseError {\n\terror: ParseErrorCode;\n\toffset: number;\n\tlength: number;\n}\n\nexport const enum ParseErrorCode {\n\tInvalidSymbol = 1,\n\tInvalidNumberFormat = 2,\n\tPropertyNameExpected = 3,\n\tValueExpected = 4,\n\tColonExpected = 5,\n\tCommaExpected = 6,\n\tCloseBraceExpected = 7,\n\tCloseBracketExpected = 8,\n\tEndOfFileExpected = 9,\n\tInvalidCommentToken = 10,\n\tUnexpectedEndOfComment = 11,\n\tUnexpectedEndOfString = 12,\n\tUnexpectedEndOfNumber = 13,\n\tInvalidUnicode = 14,\n\tInvalidEscapeCharacter = 15,\n\tInvalidCharacter = 16\n}\n\nexport type NodeType = 'object' | 'array' | 'property' | 'string' | 'number' | 'boolean' | 'null';\n\nexport interface Node {\n\treadonly type: NodeType;\n\treadonly value?: any;\n\treadonly offset: number;\n\treadonly length: number;\n\treadonly colonOffset?: number;\n\treadonly parent?: Node;\n\treadonly children?: Node[];\n}\n\nexport type Segment = string | number;\nexport type JSONPath = Segment[];\n\nexport interface Location {\n\t/**\n\t * The previous property key or literal value (string, number, boolean or null) or undefined.\n\t */\n\tpreviousNode?: Node;\n\t/**\n\t * The path describing the location in the JSON document. The path consists of a sequence strings\n\t * representing an object property or numbers for array indices.\n\t */\n\tpath: JSONPath;\n\t/**\n\t * Matches the locations path against a pattern consisting of strings (for properties) and numbers (for array indices).\n\t * '*' will match a single segment, of any property name or index.\n\t * '**' will match a sequence of segments or no segment, of any property name or index.\n\t */\n\tmatches: (patterns: JSONPath) => boolean;\n\t/**\n\t * If set, the location's offset is at a property key.\n\t */\n\tisAtPropertyKey: boolean;\n}\n\nexport interface ParseOptions {\n\tdisallowComments?: boolean;\n\tallowTrailingComma?: boolean;\n\tallowEmptyContent?: boolean;\n}\n\nexport namespace ParseOptions {\n\texport const DEFAULT = {\n\t\tallowTrailingComma: true\n\t};\n}\n\nexport interface JSONVisitor {\n\t/**\n\t * Invoked when an open brace is encountered and an object is started. The offset and length represent the location of the open brace.\n\t */\n\tonObjectBegin?: (offset: number, length: number) => void;\n\n\t/**\n\t * Invoked when a property is encountered. The offset and length represent the location of the property name.\n\t */\n\tonObjectProperty?: (property: string, offset: number, length: number) => void;\n\n\t/**\n\t * Invoked when a closing brace is encountered and an object is completed. The offset and length represent the location of the closing brace.\n\t */\n\tonObjectEnd?: (offset: number, length: number) => void;\n\n\t/**\n\t * Invoked when an open bracket is encountered. The offset and length represent the location of the open bracket.\n\t */\n\tonArrayBegin?: (offset: number, length: number) => void;\n\n\t/**\n\t * Invoked when a closing bracket is encountered. The offset and length represent the location of the closing bracket.\n\t */\n\tonArrayEnd?: (offset: number, length: number) => void;\n\n\t/**\n\t * Invoked when a literal value is encountered. The offset and length represent the location of the literal value.\n\t */\n\tonLiteralValue?: (value: any, offset: number, length: number) => void;\n\n\t/**\n\t * Invoked when a comma or colon separator is encountered. The offset and length represent the location of the separator.\n\t */\n\tonSeparator?: (character: string, offset: number, length: number) => void;\n\n\t/**\n\t * When comments are allowed, invoked when a line or block comment is encountered. The offset and length represent the location of the comment.\n\t */\n\tonComment?: (offset: number, length: number) => void;\n\n\t/**\n\t * Invoked on an error.\n\t */\n\tonError?: (error: ParseErrorCode, offset: number, length: number) => void;\n}\n\n/**\n * Creates a JSON scanner on the given text.\n * If ignoreTrivia is set, whitespaces or comments are ignored.\n */\nexport function createScanner(text: string, ignoreTrivia: boolean = false): JSONScanner {\n\n\tlet pos = 0,\n\t\tlen = text.length,\n\t\tvalue: string = '',\n\t\ttokenOffset = 0,\n\t\ttoken: SyntaxKind = SyntaxKind.Unknown,\n\t\tscanError: ScanError = ScanError.None;\n\n\tfunction scanHexDigits(count: number): number {\n\t\tlet digits = 0;\n\t\tlet hexValue = 0;\n\t\twhile (digits < count) {\n\t\t\tconst ch = text.charCodeAt(pos);\n\t\t\tif (ch >= CharacterCodes._0 && ch <= CharacterCodes._9) {\n\t\t\t\thexValue = hexValue * 16 + ch - CharacterCodes._0;\n\t\t\t}\n\t\t\telse if (ch >= CharacterCodes.A && ch <= CharacterCodes.F) {\n\t\t\t\thexValue = hexValue * 16 + ch - CharacterCodes.A + 10;\n\t\t\t}\n\t\t\telse if (ch >= CharacterCodes.a && ch <= CharacterCodes.f) {\n\t\t\t\thexValue = hexValue * 16 + ch - CharacterCodes.a + 10;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tpos++;\n\t\t\tdigits++;\n\t\t}\n\t\tif (digits < count) {\n\t\t\thexValue = -1;\n\t\t}\n\t\treturn hexValue;\n\t}\n\n\tfunction setPosition(newPosition: number) {\n\t\tpos = newPosition;\n\t\tvalue = '';\n\t\ttokenOffset = 0;\n\t\ttoken = SyntaxKind.Unknown;\n\t\tscanError = ScanError.None;\n\t}\n\n\tfunction scanNumber(): string {\n\t\tconst start = pos;\n\t\tif (text.charCodeAt(pos) === CharacterCodes._0) {\n\t\t\tpos++;\n\t\t} else {\n\t\t\tpos++;\n\t\t\twhile (pos < text.length && isDigit(text.charCodeAt(pos))) {\n\t\t\t\tpos++;\n\t\t\t}\n\t\t}\n\t\tif (pos < text.length && text.charCodeAt(pos) === CharacterCodes.dot) {\n\t\t\tpos++;\n\t\t\tif (pos < text.length && isDigit(text.charCodeAt(pos))) {\n\t\t\t\tpos++;\n\t\t\t\twhile (pos < text.length && isDigit(text.charCodeAt(pos))) {\n\t\t\t\t\tpos++;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tscanError = ScanError.UnexpectedEndOfNumber;\n\t\t\t\treturn text.substring(start, pos);\n\t\t\t}\n\t\t}\n\t\tlet end = pos;\n\t\tif (pos < text.length && (text.charCodeAt(pos) === CharacterCodes.E || text.charCodeAt(pos) === CharacterCodes.e)) {\n\t\t\tpos++;\n\t\t\tif (pos < text.length && text.charCodeAt(pos) === CharacterCodes.plus || text.charCodeAt(pos) === CharacterCodes.minus) {\n\t\t\t\tpos++;\n\t\t\t}\n\t\t\tif (pos < text.length && isDigit(text.charCodeAt(pos))) {\n\t\t\t\tpos++;\n\t\t\t\twhile (pos < text.length && isDigit(text.charCodeAt(pos))) {\n\t\t\t\t\tpos++;\n\t\t\t\t}\n\t\t\t\tend = pos;\n\t\t\t} else {\n\t\t\t\tscanError = ScanError.UnexpectedEndOfNumber;\n\t\t\t}\n\t\t}\n\t\treturn text.substring(start, end);\n\t}\n\n\tfunction scanString(): string {\n\n\t\tlet result = '',\n\t\t\tstart = pos;\n\n\t\twhile (true) {\n\t\t\tif (pos >= len) {\n\t\t\t\tresult += text.substring(start, pos);\n\t\t\t\tscanError = ScanError.UnexpectedEndOfString;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tconst ch = text.charCodeAt(pos);\n\t\t\tif (ch === CharacterCodes.doubleQuote) {\n\t\t\t\tresult += text.substring(start, pos);\n\t\t\t\tpos++;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (ch === CharacterCodes.backslash) {\n\t\t\t\tresult += text.substring(start, pos);\n\t\t\t\tpos++;\n\t\t\t\tif (pos >= len) {\n\t\t\t\t\tscanError = ScanError.UnexpectedEndOfString;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tconst ch2 = text.charCodeAt(pos++);\n\t\t\t\tswitch (ch2) {\n\t\t\t\t\tcase CharacterCodes.doubleQuote:\n\t\t\t\t\t\tresult += '\\\"';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase CharacterCodes.backslash:\n\t\t\t\t\t\tresult += '\\\\';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase CharacterCodes.slash:\n\t\t\t\t\t\tresult += '/';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase CharacterCodes.b:\n\t\t\t\t\t\tresult += '\\b';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase CharacterCodes.f:\n\t\t\t\t\t\tresult += '\\f';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase CharacterCodes.n:\n\t\t\t\t\t\tresult += '\\n';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase CharacterCodes.r:\n\t\t\t\t\t\tresult += '\\r';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase CharacterCodes.t:\n\t\t\t\t\t\tresult += '\\t';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase CharacterCodes.u:\n\t\t\t\t\t\tconst ch3 = scanHexDigits(4);\n\t\t\t\t\t\tif (ch3 >= 0) {\n\t\t\t\t\t\t\tresult += String.fromCharCode(ch3);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tscanError = ScanError.InvalidUnicode;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tscanError = ScanError.InvalidEscapeCharacter;\n\t\t\t\t}\n\t\t\t\tstart = pos;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (ch >= 0 && ch <= 0x1F) {\n\t\t\t\tif (isLineBreak(ch)) {\n\t\t\t\t\tresult += text.substring(start, pos);\n\t\t\t\t\tscanError = ScanError.UnexpectedEndOfString;\n\t\t\t\t\tbreak;\n\t\t\t\t} else {\n\t\t\t\t\tscanError = ScanError.InvalidCharacter;\n\t\t\t\t\t// mark as error but continue with string\n\t\t\t\t}\n\t\t\t}\n\t\t\tpos++;\n\t\t}\n\t\treturn result;\n\t}\n\n\tfunction scanNext(): SyntaxKind {\n\n\t\tvalue = '';\n\t\tscanError = ScanError.None;\n\n\t\ttokenOffset = pos;\n\n\t\tif (pos >= len) {\n\t\t\t// at the end\n\t\t\ttokenOffset = len;\n\t\t\treturn token = SyntaxKind.EOF;\n\t\t}\n\n\t\tlet code = text.charCodeAt(pos);\n\t\t// trivia: whitespace\n\t\tif (isWhitespace(code)) {\n\t\t\tdo {\n\t\t\t\tpos++;\n\t\t\t\tvalue += String.fromCharCode(code);\n\t\t\t\tcode = text.charCodeAt(pos);\n\t\t\t} while (isWhitespace(code));\n\n\t\t\treturn token = SyntaxKind.Trivia;\n\t\t}\n\n\t\t// trivia: newlines\n\t\tif (isLineBreak(code)) {\n\t\t\tpos++;\n\t\t\tvalue += String.fromCharCode(code);\n\t\t\tif (code === CharacterCodes.carriageReturn && text.charCodeAt(pos) === CharacterCodes.lineFeed) {\n\t\t\t\tpos++;\n\t\t\t\tvalue += '\\n';\n\t\t\t}\n\t\t\treturn token = SyntaxKind.LineBreakTrivia;\n\t\t}\n\n\t\tswitch (code) {\n\t\t\t// tokens: []{}:,\n\t\t\tcase CharacterCodes.openBrace:\n\t\t\t\tpos++;\n\t\t\t\treturn token = SyntaxKind.OpenBraceToken;\n\t\t\tcase CharacterCodes.closeBrace:\n\t\t\t\tpos++;\n\t\t\t\treturn token = SyntaxKind.CloseBraceToken;\n\t\t\tcase CharacterCodes.openBracket:\n\t\t\t\tpos++;\n\t\t\t\treturn token = SyntaxKind.OpenBracketToken;\n\t\t\tcase CharacterCodes.closeBracket:\n\t\t\t\tpos++;\n\t\t\t\treturn token = SyntaxKind.CloseBracketToken;\n\t\t\tcase CharacterCodes.colon:\n\t\t\t\tpos++;\n\t\t\t\treturn token = SyntaxKind.ColonToken;\n\t\t\tcase CharacterCodes.comma:\n\t\t\t\tpos++;\n\t\t\t\treturn token = SyntaxKind.CommaToken;\n\n\t\t\t// strings\n\t\t\tcase CharacterCodes.doubleQuote:\n\t\t\t\tpos++;\n\t\t\t\tvalue = scanString();\n\t\t\t\treturn token = SyntaxKind.StringLiteral;\n\n\t\t\t// comments\n\t\t\tcase CharacterCodes.slash:\n\t\t\t\tconst start = pos - 1;\n\t\t\t\t// Single-line comment\n\t\t\t\tif (text.charCodeAt(pos + 1) === CharacterCodes.slash) {\n\t\t\t\t\tpos += 2;\n\n\t\t\t\t\twhile (pos < len) {\n\t\t\t\t\t\tif (isLineBreak(text.charCodeAt(pos))) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tpos++;\n\n\t\t\t\t\t}\n\t\t\t\t\tvalue = text.substring(start, pos);\n\t\t\t\t\treturn token = SyntaxKind.LineCommentTrivia;\n\t\t\t\t}\n\n\t\t\t\t// Multi-line comment\n\t\t\t\tif (text.charCodeAt(pos + 1) === CharacterCodes.asterisk) {\n\t\t\t\t\tpos += 2;\n\n\t\t\t\t\tconst safeLength = len - 1; // For lookahead.\n\t\t\t\t\tlet commentClosed = false;\n\t\t\t\t\twhile (pos < safeLength) {\n\t\t\t\t\t\tconst ch = text.charCodeAt(pos);\n\n\t\t\t\t\t\tif (ch === CharacterCodes.asterisk && text.charCodeAt(pos + 1) === CharacterCodes.slash) {\n\t\t\t\t\t\t\tpos += 2;\n\t\t\t\t\t\t\tcommentClosed = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tpos++;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!commentClosed) {\n\t\t\t\t\t\tpos++;\n\t\t\t\t\t\tscanError = ScanError.UnexpectedEndOfComment;\n\t\t\t\t\t}\n\n\t\t\t\t\tvalue = text.substring(start, pos);\n\t\t\t\t\treturn token = SyntaxKind.BlockCommentTrivia;\n\t\t\t\t}\n\t\t\t\t// just a single slash\n\t\t\t\tvalue += String.fromCharCode(code);\n\t\t\t\tpos++;\n\t\t\t\treturn token = SyntaxKind.Unknown;\n\n\t\t\t// numbers\n\t\t\tcase CharacterCodes.minus:\n\t\t\t\tvalue += String.fromCharCode(code);\n\t\t\t\tpos++;\n\t\t\t\tif (pos === len || !isDigit(text.charCodeAt(pos))) {\n\t\t\t\t\treturn token = SyntaxKind.Unknown;\n\t\t\t\t}\n\t\t\t// found a minus, followed by a number so\n\t\t\t// we fall through to proceed with scanning\n\t\t\t// numbers\n\t\t\tcase CharacterCodes._0:\n\t\t\tcase CharacterCodes._1:\n\t\t\tcase CharacterCodes._2:\n\t\t\tcase CharacterCodes._3:\n\t\t\tcase CharacterCodes._4:\n\t\t\tcase CharacterCodes._5:\n\t\t\tcase CharacterCodes._6:\n\t\t\tcase CharacterCodes._7:\n\t\t\tcase CharacterCodes._8:\n\t\t\tcase CharacterCodes._9:\n\t\t\t\tvalue += scanNumber();\n\t\t\t\treturn token = SyntaxKind.NumericLiteral;\n\t\t\t// literals and unknown symbols\n\t\t\tdefault:\n\t\t\t\t// is a literal? Read the full word.\n\t\t\t\twhile (pos < len && isUnknownContentCharacter(code)) {\n\t\t\t\t\tpos++;\n\t\t\t\t\tcode = text.charCodeAt(pos);\n\t\t\t\t}\n\t\t\t\tif (tokenOffset !== pos) {\n\t\t\t\t\tvalue = text.substring(tokenOffset, pos);\n\t\t\t\t\t// keywords: true, false, null\n\t\t\t\t\tswitch (value) {\n\t\t\t\t\t\tcase 'true': return token = SyntaxKind.TrueKeyword;\n\t\t\t\t\t\tcase 'false': return token = SyntaxKind.FalseKeyword;\n\t\t\t\t\t\tcase 'null': return token = SyntaxKind.NullKeyword;\n\t\t\t\t\t}\n\t\t\t\t\treturn token = SyntaxKind.Unknown;\n\t\t\t\t}\n\t\t\t\t// some\n\t\t\t\tvalue += String.fromCharCode(code);\n\t\t\t\tpos++;\n\t\t\t\treturn token = SyntaxKind.Unknown;\n\t\t}\n\t}\n\n\tfunction isUnknownContentCharacter(code: CharacterCodes) {\n\t\tif (isWhitespace(code) || isLineBreak(code)) {\n\t\t\treturn false;\n\t\t}\n\t\tswitch (code) {\n\t\t\tcase CharacterCodes.closeBrace:\n\t\t\tcase CharacterCodes.closeBracket:\n\t\t\tcase CharacterCodes.openBrace:\n\t\t\tcase CharacterCodes.openBracket:\n\t\t\tcase CharacterCodes.doubleQuote:\n\t\t\tcase CharacterCodes.colon:\n\t\t\tcase CharacterCodes.comma:\n\t\t\tcase CharacterCodes.slash:\n\t\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\n\tfunction scanNextNonTrivia(): SyntaxKind {\n\t\tlet result: SyntaxKind;\n\t\tdo {\n\t\t\tresult = scanNext();\n\t\t} while (result >= SyntaxKind.LineCommentTrivia && result <= SyntaxKind.Trivia);\n\t\treturn result;\n\t}\n\n\treturn {\n\t\tsetPosition: setPosition,\n\t\tgetPosition: () => pos,\n\t\tscan: ignoreTrivia ? scanNextNonTrivia : scanNext,\n\t\tgetToken: () => token,\n\t\tgetTokenValue: () => value,\n\t\tgetTokenOffset: () => tokenOffset,\n\t\tgetTokenLength: () => pos - tokenOffset,\n\t\tgetTokenError: () => scanError\n\t};\n}\n\nfunction isWhitespace(ch: number): boolean {\n\treturn ch === CharacterCodes.space || ch === CharacterCodes.tab || ch === CharacterCodes.verticalTab || ch === CharacterCodes.formFeed ||\n\t\tch === CharacterCodes.nonBreakingSpace || ch === CharacterCodes.ogham || ch >= CharacterCodes.enQuad && ch <= CharacterCodes.zeroWidthSpace ||\n\t\tch === CharacterCodes.narrowNoBreakSpace || ch === CharacterCodes.mathematicalSpace || ch === CharacterCodes.ideographicSpace || ch === CharacterCodes.byteOrderMark;\n}\n\nfunction isLineBreak(ch: number): boolean {\n\treturn ch === CharacterCodes.lineFeed || ch === CharacterCodes.carriageReturn || ch === CharacterCodes.lineSeparator || ch === CharacterCodes.paragraphSeparator;\n}\n\nfunction isDigit(ch: number): boolean {\n\treturn ch >= CharacterCodes._0 && ch <= CharacterCodes._9;\n}\n\nconst enum CharacterCodes {\n\tnullCharacter = 0,\n\tmaxAsciiCharacter = 0x7F,\n\n\tlineFeed = 0x0A,              // \\n\n\tcarriageReturn = 0x0D,        // \\r\n\tlineSeparator = 0x2028,\n\tparagraphSeparator = 0x2029,\n\n\t// REVIEW: do we need to support this?  The scanner doesn't, but our IText does.  This seems\n\t// like an odd disparity?  (Or maybe it's completely fine for them to be different).\n\tnextLine = 0x0085,\n\n\t// Unicode 3.0 space characters\n\tspace = 0x0020,   // \" \"\n\tnonBreakingSpace = 0x00A0,   //\n\tenQuad = 0x2000,\n\temQuad = 0x2001,\n\tenSpace = 0x2002,\n\temSpace = 0x2003,\n\tthreePerEmSpace = 0x2004,\n\tfourPerEmSpace = 0x2005,\n\tsixPerEmSpace = 0x2006,\n\tfigureSpace = 0x2007,\n\tpunctuationSpace = 0x2008,\n\tthinSpace = 0x2009,\n\thairSpace = 0x200A,\n\tzeroWidthSpace = 0x200B,\n\tnarrowNoBreakSpace = 0x202F,\n\tideographicSpace = 0x3000,\n\tmathematicalSpace = 0x205F,\n\togham = 0x1680,\n\n\t_ = 0x5F,\n\t$ = 0x24,\n\n\t_0 = 0x30,\n\t_1 = 0x31,\n\t_2 = 0x32,\n\t_3 = 0x33,\n\t_4 = 0x34,\n\t_5 = 0x35,\n\t_6 = 0x36,\n\t_7 = 0x37,\n\t_8 = 0x38,\n\t_9 = 0x39,\n\n\ta = 0x61,\n\tb = 0x62,\n\tc = 0x63,\n\td = 0x64,\n\te = 0x65,\n\tf = 0x66,\n\tg = 0x67,\n\th = 0x68,\n\ti = 0x69,\n\tj = 0x6A,\n\tk = 0x6B,\n\tl = 0x6C,\n\tm = 0x6D,\n\tn = 0x6E,\n\to = 0x6F,\n\tp = 0x70,\n\tq = 0x71,\n\tr = 0x72,\n\ts = 0x73,\n\tt = 0x74,\n\tu = 0x75,\n\tv = 0x76,\n\tw = 0x77,\n\tx = 0x78,\n\ty = 0x79,\n\tz = 0x7A,\n\n\tA = 0x41,\n\tB = 0x42,\n\tC = 0x43,\n\tD = 0x44,\n\tE = 0x45,\n\tF = 0x46,\n\tG = 0x47,\n\tH = 0x48,\n\tI = 0x49,\n\tJ = 0x4A,\n\tK = 0x4B,\n\tL = 0x4C,\n\tM = 0x4D,\n\tN = 0x4E,\n\tO = 0x4F,\n\tP = 0x50,\n\tQ = 0x51,\n\tR = 0x52,\n\tS = 0x53,\n\tT = 0x54,\n\tU = 0x55,\n\tV = 0x56,\n\tW = 0x57,\n\tX = 0x58,\n\tY = 0x59,\n\tZ = 0x5A,\n\n\tampersand = 0x26,             // &\n\tasterisk = 0x2A,              // *\n\tat = 0x40,                    // @\n\tbackslash = 0x5C,             // \\\n\tbar = 0x7C,                   // |\n\tcaret = 0x5E,                 // ^\n\tcloseBrace = 0x7D,            // }\n\tcloseBracket = 0x5D,          // ]\n\tcloseParen = 0x29,            // )\n\tcolon = 0x3A,                 // :\n\tcomma = 0x2C,                 // ,\n\tdot = 0x2E,                   // .\n\tdoubleQuote = 0x22,           // \"\n\tequals = 0x3D,                // =\n\texclamation = 0x21,           // !\n\tgreaterThan = 0x3E,           // >\n\tlessThan = 0x3C,              // <\n\tminus = 0x2D,                 // -\n\topenBrace = 0x7B,             // {\n\topenBracket = 0x5B,           // [\n\topenParen = 0x28,             // (\n\tpercent = 0x25,               // %\n\tplus = 0x2B,                  // +\n\tquestion = 0x3F,              // ?\n\tsemicolon = 0x3B,             // ;\n\tsingleQuote = 0x27,           // '\n\tslash = 0x2F,                 // /\n\ttilde = 0x7E,                 // ~\n\n\tbackspace = 0x08,             // \\b\n\tformFeed = 0x0C,              // \\f\n\tbyteOrderMark = 0xFEFF,\n\ttab = 0x09,                   // \\t\n\tverticalTab = 0x0B,           // \\v\n}\n\ninterface NodeImpl extends Node {\n\ttype: NodeType;\n\tvalue?: any;\n\toffset: number;\n\tlength: number;\n\tcolonOffset?: number;\n\tparent?: NodeImpl;\n\tchildren?: NodeImpl[];\n}\n\n/**\n * For a given offset, evaluate the location in the JSON document. Each segment in the location path is either a property name or an array index.\n */\nexport function getLocation(text: string, position: number): Location {\n\tconst segments: Segment[] = []; // strings or numbers\n\tconst earlyReturnException = new Object();\n\tlet previousNode: NodeImpl | undefined = undefined;\n\tconst previousNodeInst: NodeImpl = {\n\t\tvalue: {},\n\t\toffset: 0,\n\t\tlength: 0,\n\t\ttype: 'object',\n\t\tparent: undefined\n\t};\n\tlet isAtPropertyKey = false;\n\tfunction setPreviousNode(value: string, offset: number, length: number, type: NodeType) {\n\t\tpreviousNodeInst.value = value;\n\t\tpreviousNodeInst.offset = offset;\n\t\tpreviousNodeInst.length = length;\n\t\tpreviousNodeInst.type = type;\n\t\tpreviousNodeInst.colonOffset = undefined;\n\t\tpreviousNode = previousNodeInst;\n\t}\n\ttry {\n\n\t\tvisit(text, {\n\t\t\tonObjectBegin: (offset: number, length: number) => {\n\t\t\t\tif (position <= offset) {\n\t\t\t\t\tthrow earlyReturnException;\n\t\t\t\t}\n\t\t\t\tpreviousNode = undefined;\n\t\t\t\tisAtPropertyKey = position > offset;\n\t\t\t\tsegments.push(''); // push a placeholder (will be replaced)\n\t\t\t},\n\t\t\tonObjectProperty: (name: string, offset: number, length: number) => {\n\t\t\t\tif (position < offset) {\n\t\t\t\t\tthrow earlyReturnException;\n\t\t\t\t}\n\t\t\t\tsetPreviousNode(name, offset, length, 'property');\n\t\t\t\tsegments[segments.length - 1] = name;\n\t\t\t\tif (position <= offset + length) {\n\t\t\t\t\tthrow earlyReturnException;\n\t\t\t\t}\n\t\t\t},\n\t\t\tonObjectEnd: (offset: number, length: number) => {\n\t\t\t\tif (position <= offset) {\n\t\t\t\t\tthrow earlyReturnException;\n\t\t\t\t}\n\t\t\t\tpreviousNode = undefined;\n\t\t\t\tsegments.pop();\n\t\t\t},\n\t\t\tonArrayBegin: (offset: number, length: number) => {\n\t\t\t\tif (position <= offset) {\n\t\t\t\t\tthrow earlyReturnException;\n\t\t\t\t}\n\t\t\t\tpreviousNode = undefined;\n\t\t\t\tsegments.push(0);\n\t\t\t},\n\t\t\tonArrayEnd: (offset: number, length: number) => {\n\t\t\t\tif (position <= offset) {\n\t\t\t\t\tthrow earlyReturnException;\n\t\t\t\t}\n\t\t\t\tpreviousNode = undefined;\n\t\t\t\tsegments.pop();\n\t\t\t},\n\t\t\tonLiteralValue: (value: any, offset: number, length: number) => {\n\t\t\t\tif (position < offset) {\n\t\t\t\t\tthrow earlyReturnException;\n\t\t\t\t}\n\t\t\t\tsetPreviousNode(value, offset, length, getNodeType(value));\n\n\t\t\t\tif (position <= offset + length) {\n\t\t\t\t\tthrow earlyReturnException;\n\t\t\t\t}\n\t\t\t},\n\t\t\tonSeparator: (sep: string, offset: number, length: number) => {\n\t\t\t\tif (position <= offset) {\n\t\t\t\t\tthrow earlyReturnException;\n\t\t\t\t}\n\t\t\t\tif (sep === ':' && previousNode && previousNode.type === 'property') {\n\t\t\t\t\tpreviousNode.colonOffset = offset;\n\t\t\t\t\tisAtPropertyKey = false;\n\t\t\t\t\tpreviousNode = undefined;\n\t\t\t\t} else if (sep === ',') {\n\t\t\t\t\tconst last = segments[segments.length - 1];\n\t\t\t\t\tif (typeof last === 'number') {\n\t\t\t\t\t\tsegments[segments.length - 1] = last + 1;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tisAtPropertyKey = true;\n\t\t\t\t\t\tsegments[segments.length - 1] = '';\n\t\t\t\t\t}\n\t\t\t\t\tpreviousNode = undefined;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t} catch (e) {\n\t\tif (e !== earlyReturnException) {\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\treturn {\n\t\tpath: segments,\n\t\tpreviousNode,\n\t\tisAtPropertyKey,\n\t\tmatches: (pattern: Segment[]) => {\n\t\t\tlet k = 0;\n\t\t\tfor (let i = 0; k < pattern.length && i < segments.length; i++) {\n\t\t\t\tif (pattern[k] === segments[i] || pattern[k] === '*') {\n\t\t\t\t\tk++;\n\t\t\t\t} else if (pattern[k] !== '**') {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn k === pattern.length;\n\t\t}\n\t};\n}\n\n\n/**\n * Parses the given text and returns the object the JSON content represents. On invalid input, the parser tries to be as fault tolerant as possible, but still return a result.\n * Therefore always check the errors list to find out if the input was valid.\n */\nexport function parse(text: string, errors: ParseError[] = [], options: ParseOptions = ParseOptions.DEFAULT): any {\n\tlet currentProperty: string | null = null;\n\tlet currentParent: any = [];\n\tconst previousParents: any[] = [];\n\n\tfunction onValue(value: any) {\n\t\tif (Array.isArray(currentParent)) {\n\t\t\t(<any[]>currentParent).push(value);\n\t\t} else if (currentProperty !== null) {\n\t\t\tcurrentParent[currentProperty] = value;\n\t\t}\n\t}\n\n\tconst visitor: JSONVisitor = {\n\t\tonObjectBegin: () => {\n\t\t\tconst object = {};\n\t\t\tonValue(object);\n\t\t\tpreviousParents.push(currentParent);\n\t\t\tcurrentParent = object;\n\t\t\tcurrentProperty = null;\n\t\t},\n\t\tonObjectProperty: (name: string) => {\n\t\t\tcurrentProperty = name;\n\t\t},\n\t\tonObjectEnd: () => {\n\t\t\tcurrentParent = previousParents.pop();\n\t\t},\n\t\tonArrayBegin: () => {\n\t\t\tconst array: any[] = [];\n\t\t\tonValue(array);\n\t\t\tpreviousParents.push(currentParent);\n\t\t\tcurrentParent = array;\n\t\t\tcurrentProperty = null;\n\t\t},\n\t\tonArrayEnd: () => {\n\t\t\tcurrentParent = previousParents.pop();\n\t\t},\n\t\tonLiteralValue: onValue,\n\t\tonError: (error: ParseErrorCode, offset: number, length: number) => {\n\t\t\terrors.push({ error, offset, length });\n\t\t}\n\t};\n\tvisit(text, visitor, options);\n\treturn currentParent[0];\n}\n\n\n/**\n * Parses the given text and returns a tree representation the JSON content. On invalid input, the parser tries to be as fault tolerant as possible, but still return a result.\n */\nexport function parseTree(text: string, errors: ParseError[] = [], options: ParseOptions = ParseOptions.DEFAULT): Node {\n\tlet currentParent: NodeImpl = { type: 'array', offset: -1, length: -1, children: [], parent: undefined }; // artificial root\n\n\tfunction ensurePropertyComplete(endOffset: number) {\n\t\tif (currentParent.type === 'property') {\n\t\t\tcurrentParent.length = endOffset - currentParent.offset;\n\t\t\tcurrentParent = currentParent.parent!;\n\t\t}\n\t}\n\n\tfunction onValue(valueNode: Node): Node {\n\t\tcurrentParent.children!.push(valueNode);\n\t\treturn valueNode;\n\t}\n\n\tconst visitor: JSONVisitor = {\n\t\tonObjectBegin: (offset: number) => {\n\t\t\tcurrentParent = onValue({ type: 'object', offset, length: -1, parent: currentParent, children: [] });\n\t\t},\n\t\tonObjectProperty: (name: string, offset: number, length: number) => {\n\t\t\tcurrentParent = onValue({ type: 'property', offset, length: -1, parent: currentParent, children: [] });\n\t\t\tcurrentParent.children!.push({ type: 'string', value: name, offset, length, parent: currentParent });\n\t\t},\n\t\tonObjectEnd: (offset: number, length: number) => {\n\t\t\tcurrentParent.length = offset + length - currentParent.offset;\n\t\t\tcurrentParent = currentParent.parent!;\n\t\t\tensurePropertyComplete(offset + length);\n\t\t},\n\t\tonArrayBegin: (offset: number, length: number) => {\n\t\t\tcurrentParent = onValue({ type: 'array', offset, length: -1, parent: currentParent, children: [] });\n\t\t},\n\t\tonArrayEnd: (offset: number, length: number) => {\n\t\t\tcurrentParent.length = offset + length - currentParent.offset;\n\t\t\tcurrentParent = currentParent.parent!;\n\t\t\tensurePropertyComplete(offset + length);\n\t\t},\n\t\tonLiteralValue: (value: any, offset: number, length: number) => {\n\t\t\tonValue({ type: getNodeType(value), offset, length, parent: currentParent, value });\n\t\t\tensurePropertyComplete(offset + length);\n\t\t},\n\t\tonSeparator: (sep: string, offset: number, length: number) => {\n\t\t\tif (currentParent.type === 'property') {\n\t\t\t\tif (sep === ':') {\n\t\t\t\t\tcurrentParent.colonOffset = offset;\n\t\t\t\t} else if (sep === ',') {\n\t\t\t\t\tensurePropertyComplete(offset);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tonError: (error: ParseErrorCode, offset: number, length: number) => {\n\t\t\terrors.push({ error, offset, length });\n\t\t}\n\t};\n\tvisit(text, visitor, options);\n\n\tconst result = currentParent.children![0];\n\tif (result) {\n\t\tdelete result.parent;\n\t}\n\treturn result;\n}\n\n/**\n * Finds the node at the given path in a JSON DOM.\n */\nexport function findNodeAtLocation(root: Node, path: JSONPath): Node | undefined {\n\tif (!root) {\n\t\treturn undefined;\n\t}\n\tlet node = root;\n\tfor (let segment of path) {\n\t\tif (typeof segment === 'string') {\n\t\t\tif (node.type !== 'object' || !Array.isArray(node.children)) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tlet found = false;\n\t\t\tfor (const propertyNode of node.children) {\n\t\t\t\tif (Array.isArray(propertyNode.children) && propertyNode.children[0].value === segment) {\n\t\t\t\t\tnode = propertyNode.children[1];\n\t\t\t\t\tfound = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!found) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t} else {\n\t\t\tconst index = <number>segment;\n\t\t\tif (node.type !== 'array' || index < 0 || !Array.isArray(node.children) || index >= node.children.length) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tnode = node.children[index];\n\t\t}\n\t}\n\treturn node;\n}\n\n/**\n * Gets the JSON path of the given JSON DOM node\n */\nexport function getNodePath(node: Node): JSONPath {\n\tif (!node.parent || !node.parent.children) {\n\t\treturn [];\n\t}\n\tconst path = getNodePath(node.parent);\n\tif (node.parent.type === 'property') {\n\t\tconst key = node.parent.children[0].value;\n\t\tpath.push(key);\n\t} else if (node.parent.type === 'array') {\n\t\tconst index = node.parent.children.indexOf(node);\n\t\tif (index !== -1) {\n\t\t\tpath.push(index);\n\t\t}\n\t}\n\treturn path;\n}\n\n/**\n * Evaluates the JavaScript object of the given JSON DOM node\n */\nexport function getNodeValue(node: Node): any {\n\tswitch (node.type) {\n\t\tcase 'array':\n\t\t\treturn node.children!.map(getNodeValue);\n\t\tcase 'object':\n\t\t\tconst obj = Object.create(null);\n\t\t\tfor (let prop of node.children!) {\n\t\t\t\tconst valueNode = prop.children![1];\n\t\t\t\tif (valueNode) {\n\t\t\t\t\tobj[prop.children![0].value] = getNodeValue(valueNode);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn obj;\n\t\tcase 'null':\n\t\tcase 'string':\n\t\tcase 'number':\n\t\tcase 'boolean':\n\t\t\treturn node.value;\n\t\tdefault:\n\t\t\treturn undefined;\n\t}\n\n}\n\nexport function contains(node: Node, offset: number, includeRightBound = false): boolean {\n\treturn (offset >= node.offset && offset < (node.offset + node.length)) || includeRightBound && (offset === (node.offset + node.length));\n}\n\n/**\n * Finds the most inner node at the given offset. If includeRightBound is set, also finds nodes that end at the given offset.\n */\nexport function findNodeAtOffset(node: Node, offset: number, includeRightBound = false): Node | undefined {\n\tif (contains(node, offset, includeRightBound)) {\n\t\tconst children = node.children;\n\t\tif (Array.isArray(children)) {\n\t\t\tfor (let i = 0; i < children.length && children[i].offset <= offset; i++) {\n\t\t\t\tconst item = findNodeAtOffset(children[i], offset, includeRightBound);\n\t\t\t\tif (item) {\n\t\t\t\t\treturn item;\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\t\treturn node;\n\t}\n\treturn undefined;\n}\n\n\n/**\n * Parses the given text and invokes the visitor functions for each object, array and literal reached.\n */\nexport function visit(text: string, visitor: JSONVisitor, options: ParseOptions = ParseOptions.DEFAULT): any {\n\n\tconst _scanner = createScanner(text, false);\n\n\tfunction toNoArgVisit(visitFunction?: (offset: number, length: number) => void): () => void {\n\t\treturn visitFunction ? () => visitFunction(_scanner.getTokenOffset(), _scanner.getTokenLength()) : () => true;\n\t}\n\tfunction toOneArgVisit<T>(visitFunction?: (arg: T, offset: number, length: number) => void): (arg: T) => void {\n\t\treturn visitFunction ? (arg: T) => visitFunction(arg, _scanner.getTokenOffset(), _scanner.getTokenLength()) : () => true;\n\t}\n\n\tconst onObjectBegin = toNoArgVisit(visitor.onObjectBegin),\n\t\tonObjectProperty = toOneArgVisit(visitor.onObjectProperty),\n\t\tonObjectEnd = toNoArgVisit(visitor.onObjectEnd),\n\t\tonArrayBegin = toNoArgVisit(visitor.onArrayBegin),\n\t\tonArrayEnd = toNoArgVisit(visitor.onArrayEnd),\n\t\tonLiteralValue = toOneArgVisit(visitor.onLiteralValue),\n\t\tonSeparator = toOneArgVisit(visitor.onSeparator),\n\t\tonComment = toNoArgVisit(visitor.onComment),\n\t\tonError = toOneArgVisit(visitor.onError);\n\n\tconst disallowComments = options && options.disallowComments;\n\tconst allowTrailingComma = options && options.allowTrailingComma;\n\tfunction scanNext(): SyntaxKind {\n\t\twhile (true) {\n\t\t\tconst token = _scanner.scan();\n\t\t\tswitch (_scanner.getTokenError()) {\n\t\t\t\tcase ScanError.InvalidUnicode:\n\t\t\t\t\thandleError(ParseErrorCode.InvalidUnicode);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ScanError.InvalidEscapeCharacter:\n\t\t\t\t\thandleError(ParseErrorCode.InvalidEscapeCharacter);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ScanError.UnexpectedEndOfNumber:\n\t\t\t\t\thandleError(ParseErrorCode.UnexpectedEndOfNumber);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ScanError.UnexpectedEndOfComment:\n\t\t\t\t\tif (!disallowComments) {\n\t\t\t\t\t\thandleError(ParseErrorCode.UnexpectedEndOfComment);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase ScanError.UnexpectedEndOfString:\n\t\t\t\t\thandleError(ParseErrorCode.UnexpectedEndOfString);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ScanError.InvalidCharacter:\n\t\t\t\t\thandleError(ParseErrorCode.InvalidCharacter);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tswitch (token) {\n\t\t\t\tcase SyntaxKind.LineCommentTrivia:\n\t\t\t\tcase SyntaxKind.BlockCommentTrivia:\n\t\t\t\t\tif (disallowComments) {\n\t\t\t\t\t\thandleError(ParseErrorCode.InvalidCommentToken);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tonComment();\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase SyntaxKind.Unknown:\n\t\t\t\t\thandleError(ParseErrorCode.InvalidSymbol);\n\t\t\t\t\tbreak;\n\t\t\t\tcase SyntaxKind.Trivia:\n\t\t\t\tcase SyntaxKind.LineBreakTrivia:\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\treturn token;\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction handleError(error: ParseErrorCode, skipUntilAfter: SyntaxKind[] = [], skipUntil: SyntaxKind[] = []): void {\n\t\tonError(error);\n\t\tif (skipUntilAfter.length + skipUntil.length > 0) {\n\t\t\tlet token = _scanner.getToken();\n\t\t\twhile (token !== SyntaxKind.EOF) {\n\t\t\t\tif (skipUntilAfter.indexOf(token) !== -1) {\n\t\t\t\t\tscanNext();\n\t\t\t\t\tbreak;\n\t\t\t\t} else if (skipUntil.indexOf(token) !== -1) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\ttoken = scanNext();\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction parseString(isValue: boolean): boolean {\n\t\tconst value = _scanner.getTokenValue();\n\t\tif (isValue) {\n\t\t\tonLiteralValue(value);\n\t\t} else {\n\t\t\tonObjectProperty(value);\n\t\t}\n\t\tscanNext();\n\t\treturn true;\n\t}\n\n\tfunction parseLiteral(): boolean {\n\t\tswitch (_scanner.getToken()) {\n\t\t\tcase SyntaxKind.NumericLiteral:\n\t\t\t\tlet value = 0;\n\t\t\t\ttry {\n\t\t\t\t\tvalue = JSON.parse(_scanner.getTokenValue());\n\t\t\t\t\tif (typeof value !== 'number') {\n\t\t\t\t\t\thandleError(ParseErrorCode.InvalidNumberFormat);\n\t\t\t\t\t\tvalue = 0;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\thandleError(ParseErrorCode.InvalidNumberFormat);\n\t\t\t\t}\n\t\t\t\tonLiteralValue(value);\n\t\t\t\tbreak;\n\t\t\tcase SyntaxKind.NullKeyword:\n\t\t\t\tonLiteralValue(null);\n\t\t\t\tbreak;\n\t\t\tcase SyntaxKind.TrueKeyword:\n\t\t\t\tonLiteralValue(true);\n\t\t\t\tbreak;\n\t\t\tcase SyntaxKind.FalseKeyword:\n\t\t\t\tonLiteralValue(false);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn false;\n\t\t}\n\t\tscanNext();\n\t\treturn true;\n\t}\n\n\tfunction parseProperty(): boolean {\n\t\tif (_scanner.getToken() !== SyntaxKind.StringLiteral) {\n\t\t\thandleError(ParseErrorCode.PropertyNameExpected, [], [SyntaxKind.CloseBraceToken, SyntaxKind.CommaToken]);\n\t\t\treturn false;\n\t\t}\n\t\tparseString(false);\n\t\tif (_scanner.getToken() === SyntaxKind.ColonToken) {\n\t\t\tonSeparator(':');\n\t\t\tscanNext(); // consume colon\n\n\t\t\tif (!parseValue()) {\n\t\t\t\thandleError(ParseErrorCode.ValueExpected, [], [SyntaxKind.CloseBraceToken, SyntaxKind.CommaToken]);\n\t\t\t}\n\t\t} else {\n\t\t\thandleError(ParseErrorCode.ColonExpected, [], [SyntaxKind.CloseBraceToken, SyntaxKind.CommaToken]);\n\t\t}\n\t\treturn true;\n\t}\n\n\tfunction parseObject(): boolean {\n\t\tonObjectBegin();\n\t\tscanNext(); // consume open brace\n\n\t\tlet needsComma = false;\n\t\twhile (_scanner.getToken() !== SyntaxKind.CloseBraceToken && _scanner.getToken() !== SyntaxKind.EOF) {\n\t\t\tif (_scanner.getToken() === SyntaxKind.CommaToken) {\n\t\t\t\tif (!needsComma) {\n\t\t\t\t\thandleError(ParseErrorCode.ValueExpected, [], []);\n\t\t\t\t}\n\t\t\t\tonSeparator(',');\n\t\t\t\tscanNext(); // consume comma\n\t\t\t\tif (_scanner.getToken() === SyntaxKind.CloseBraceToken && allowTrailingComma) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else if (needsComma) {\n\t\t\t\thandleError(ParseErrorCode.CommaExpected, [], []);\n\t\t\t}\n\t\t\tif (!parseProperty()) {\n\t\t\t\thandleError(ParseErrorCode.ValueExpected, [], [SyntaxKind.CloseBraceToken, SyntaxKind.CommaToken]);\n\t\t\t}\n\t\t\tneedsComma = true;\n\t\t}\n\t\tonObjectEnd();\n\t\tif (_scanner.getToken() !== SyntaxKind.CloseBraceToken) {\n\t\t\thandleError(ParseErrorCode.CloseBraceExpected, [SyntaxKind.CloseBraceToken], []);\n\t\t} else {\n\t\t\tscanNext(); // consume close brace\n\t\t}\n\t\treturn true;\n\t}\n\n\tfunction parseArray(): boolean {\n\t\tonArrayBegin();\n\t\tscanNext(); // consume open bracket\n\n\t\tlet needsComma = false;\n\t\twhile (_scanner.getToken() !== SyntaxKind.CloseBracketToken && _scanner.getToken() !== SyntaxKind.EOF) {\n\t\t\tif (_scanner.getToken() === SyntaxKind.CommaToken) {\n\t\t\t\tif (!needsComma) {\n\t\t\t\t\thandleError(ParseErrorCode.ValueExpected, [], []);\n\t\t\t\t}\n\t\t\t\tonSeparator(',');\n\t\t\t\tscanNext(); // consume comma\n\t\t\t\tif (_scanner.getToken() === SyntaxKind.CloseBracketToken && allowTrailingComma) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else if (needsComma) {\n\t\t\t\thandleError(ParseErrorCode.CommaExpected, [], []);\n\t\t\t}\n\t\t\tif (!parseValue()) {\n\t\t\t\thandleError(ParseErrorCode.ValueExpected, [], [SyntaxKind.CloseBracketToken, SyntaxKind.CommaToken]);\n\t\t\t}\n\t\t\tneedsComma = true;\n\t\t}\n\t\tonArrayEnd();\n\t\tif (_scanner.getToken() !== SyntaxKind.CloseBracketToken) {\n\t\t\thandleError(ParseErrorCode.CloseBracketExpected, [SyntaxKind.CloseBracketToken], []);\n\t\t} else {\n\t\t\tscanNext(); // consume close bracket\n\t\t}\n\t\treturn true;\n\t}\n\n\tfunction parseValue(): boolean {\n\t\tswitch (_scanner.getToken()) {\n\t\t\tcase SyntaxKind.OpenBracketToken:\n\t\t\t\treturn parseArray();\n\t\t\tcase SyntaxKind.OpenBraceToken:\n\t\t\t\treturn parseObject();\n\t\t\tcase SyntaxKind.StringLiteral:\n\t\t\t\treturn parseString(true);\n\t\t\tdefault:\n\t\t\t\treturn parseLiteral();\n\t\t}\n\t}\n\n\tscanNext();\n\tif (_scanner.getToken() === SyntaxKind.EOF) {\n\t\tif (options.allowEmptyContent) {\n\t\t\treturn true;\n\t\t}\n\t\thandleError(ParseErrorCode.ValueExpected, [], []);\n\t\treturn false;\n\t}\n\tif (!parseValue()) {\n\t\thandleError(ParseErrorCode.ValueExpected, [], []);\n\t\treturn false;\n\t}\n\tif (_scanner.getToken() !== SyntaxKind.EOF) {\n\t\thandleError(ParseErrorCode.EndOfFileExpected, [], []);\n\t}\n\treturn true;\n}\n\n/**\n * Takes JSON with JavaScript-style comments and remove\n * them. Optionally replaces every none-newline character\n * of comments with a replaceCharacter\n */\nexport function stripComments(text: string, replaceCh?: string): string {\n\n\tlet _scanner = createScanner(text),\n\t\tparts: string[] = [],\n\t\tkind: SyntaxKind,\n\t\toffset = 0,\n\t\tpos: number;\n\n\tdo {\n\t\tpos = _scanner.getPosition();\n\t\tkind = _scanner.scan();\n\t\tswitch (kind) {\n\t\t\tcase SyntaxKind.LineCommentTrivia:\n\t\t\tcase SyntaxKind.BlockCommentTrivia:\n\t\t\tcase SyntaxKind.EOF:\n\t\t\t\tif (offset !== pos) {\n\t\t\t\t\tparts.push(text.substring(offset, pos));\n\t\t\t\t}\n\t\t\t\tif (replaceCh !== undefined) {\n\t\t\t\t\tparts.push(_scanner.getTokenValue().replace(/[^\\r\\n]/g, replaceCh));\n\t\t\t\t}\n\t\t\t\toffset = _scanner.getPosition();\n\t\t\t\tbreak;\n\t\t}\n\t} while (kind !== SyntaxKind.EOF);\n\n\treturn parts.join('');\n}\n\nexport function getNodeType(value: any): NodeType {\n\tswitch (typeof value) {\n\t\tcase 'boolean': return 'boolean';\n\t\tcase 'number': return 'number';\n\t\tcase 'string': return 'string';\n\t\tcase 'object': {\n\t\t\tif (!value) {\n\t\t\t\treturn 'null';\n\t\t\t} else if (Array.isArray(value)) {\n\t\t\t\treturn 'array';\n\t\t\t}\n\t\t\treturn 'object';\n\t\t}\n\t\tdefault: return 'null';\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { createScanner, SyntaxKind, ScanError } from './json';\n\nexport interface FormattingOptions {\n\t/**\n\t * If indentation is based on spaces (`insertSpaces` = true), then what is the number of spaces that make an indent?\n\t */\n\ttabSize?: number;\n\t/**\n\t * Is indentation based on spaces?\n\t */\n\tinsertSpaces?: boolean;\n\t/**\n\t * The default 'end of line' character. If not set, '\\n' is used as default.\n\t */\n\teol?: string;\n}\n\n/**\n * Represents a text modification\n */\nexport interface Edit {\n\t/**\n\t * The start offset of the modification.\n\t */\n\toffset: number;\n\t/**\n\t * The length of the modification. Must not be negative. Empty length represents an *insert*.\n\t */\n\tlength: number;\n\t/**\n\t * The new content. Empty content represents a *remove*.\n\t */\n\tcontent: string;\n}\n\n/**\n * A text range in the document\n*/\nexport interface Range {\n\t/**\n\t * The start offset of the range.\n\t */\n\toffset: number;\n\t/**\n\t * The length of the range. Must not be negative.\n\t */\n\tlength: number;\n}\n\n\nexport function format(documentText: string, range: Range | undefined, options: FormattingOptions): Edit[] {\n\tlet initialIndentLevel: number;\n\tlet formatText: string;\n\tlet formatTextStart: number;\n\tlet rangeStart: number;\n\tlet rangeEnd: number;\n\tif (range) {\n\t\trangeStart = range.offset;\n\t\trangeEnd = rangeStart + range.length;\n\n\t\tformatTextStart = rangeStart;\n\t\twhile (formatTextStart > 0 && !isEOL(documentText, formatTextStart - 1)) {\n\t\t\tformatTextStart--;\n\t\t}\n\t\tlet endOffset = rangeEnd;\n\t\twhile (endOffset < documentText.length && !isEOL(documentText, endOffset)) {\n\t\t\tendOffset++;\n\t\t}\n\t\tformatText = documentText.substring(formatTextStart, endOffset);\n\t\tinitialIndentLevel = computeIndentLevel(formatText, options);\n\t} else {\n\t\tformatText = documentText;\n\t\tinitialIndentLevel = 0;\n\t\tformatTextStart = 0;\n\t\trangeStart = 0;\n\t\trangeEnd = documentText.length;\n\t}\n\tconst eol = getEOL(options, documentText);\n\n\tlet lineBreak = false;\n\tlet indentLevel = 0;\n\tlet indentValue: string;\n\tif (options.insertSpaces) {\n\t\tindentValue = repeat(' ', options.tabSize || 4);\n\t} else {\n\t\tindentValue = '\\t';\n\t}\n\n\tconst scanner = createScanner(formatText, false);\n\tlet hasError = false;\n\n\tfunction newLineAndIndent(): string {\n\t\treturn eol + repeat(indentValue, initialIndentLevel + indentLevel);\n\t}\n\tfunction scanNext(): SyntaxKind {\n\t\tlet token = scanner.scan();\n\t\tlineBreak = false;\n\t\twhile (token === SyntaxKind.Trivia || token === SyntaxKind.LineBreakTrivia) {\n\t\t\tlineBreak = lineBreak || (token === SyntaxKind.LineBreakTrivia);\n\t\t\ttoken = scanner.scan();\n\t\t}\n\t\thasError = token === SyntaxKind.Unknown || scanner.getTokenError() !== ScanError.None;\n\t\treturn token;\n\t}\n\tconst editOperations: Edit[] = [];\n\tfunction addEdit(text: string, startOffset: number, endOffset: number) {\n\t\tif (!hasError && startOffset < rangeEnd && endOffset > rangeStart && documentText.substring(startOffset, endOffset) !== text) {\n\t\t\teditOperations.push({ offset: startOffset, length: endOffset - startOffset, content: text });\n\t\t}\n\t}\n\n\tlet firstToken = scanNext();\n\n\tif (firstToken !== SyntaxKind.EOF) {\n\t\tconst firstTokenStart = scanner.getTokenOffset() + formatTextStart;\n\t\tconst initialIndent = repeat(indentValue, initialIndentLevel);\n\t\taddEdit(initialIndent, formatTextStart, firstTokenStart);\n\t}\n\n\twhile (firstToken !== SyntaxKind.EOF) {\n\t\tlet firstTokenEnd = scanner.getTokenOffset() + scanner.getTokenLength() + formatTextStart;\n\t\tlet secondToken = scanNext();\n\n\t\tlet replaceContent = '';\n\t\twhile (!lineBreak && (secondToken === SyntaxKind.LineCommentTrivia || secondToken === SyntaxKind.BlockCommentTrivia)) {\n\t\t\t// comments on the same line: keep them on the same line, but ignore them otherwise\n\t\t\tconst commentTokenStart = scanner.getTokenOffset() + formatTextStart;\n\t\t\taddEdit(' ', firstTokenEnd, commentTokenStart);\n\t\t\tfirstTokenEnd = scanner.getTokenOffset() + scanner.getTokenLength() + formatTextStart;\n\t\t\treplaceContent = secondToken === SyntaxKind.LineCommentTrivia ? newLineAndIndent() : '';\n\t\t\tsecondToken = scanNext();\n\t\t}\n\n\t\tif (secondToken === SyntaxKind.CloseBraceToken) {\n\t\t\tif (firstToken !== SyntaxKind.OpenBraceToken) {\n\t\t\t\tindentLevel--;\n\t\t\t\treplaceContent = newLineAndIndent();\n\t\t\t}\n\t\t} else if (secondToken === SyntaxKind.CloseBracketToken) {\n\t\t\tif (firstToken !== SyntaxKind.OpenBracketToken) {\n\t\t\t\tindentLevel--;\n\t\t\t\treplaceContent = newLineAndIndent();\n\t\t\t}\n\t\t} else {\n\t\t\tswitch (firstToken) {\n\t\t\t\tcase SyntaxKind.OpenBracketToken:\n\t\t\t\tcase SyntaxKind.OpenBraceToken:\n\t\t\t\t\tindentLevel++;\n\t\t\t\t\treplaceContent = newLineAndIndent();\n\t\t\t\t\tbreak;\n\t\t\t\tcase SyntaxKind.CommaToken:\n\t\t\t\tcase SyntaxKind.LineCommentTrivia:\n\t\t\t\t\treplaceContent = newLineAndIndent();\n\t\t\t\t\tbreak;\n\t\t\t\tcase SyntaxKind.BlockCommentTrivia:\n\t\t\t\t\tif (lineBreak) {\n\t\t\t\t\t\treplaceContent = newLineAndIndent();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// symbol following comment on the same line: keep on same line, separate with ' '\n\t\t\t\t\t\treplaceContent = ' ';\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase SyntaxKind.ColonToken:\n\t\t\t\t\treplaceContent = ' ';\n\t\t\t\t\tbreak;\n\t\t\t\tcase SyntaxKind.StringLiteral:\n\t\t\t\t\tif (secondToken === SyntaxKind.ColonToken) {\n\t\t\t\t\t\treplaceContent = '';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t// fall through\n\t\t\t\tcase SyntaxKind.NullKeyword:\n\t\t\t\tcase SyntaxKind.TrueKeyword:\n\t\t\t\tcase SyntaxKind.FalseKeyword:\n\t\t\t\tcase SyntaxKind.NumericLiteral:\n\t\t\t\tcase SyntaxKind.CloseBraceToken:\n\t\t\t\tcase SyntaxKind.CloseBracketToken:\n\t\t\t\t\tif (secondToken === SyntaxKind.LineCommentTrivia || secondToken === SyntaxKind.BlockCommentTrivia) {\n\t\t\t\t\t\treplaceContent = ' ';\n\t\t\t\t\t} else if (secondToken !== SyntaxKind.CommaToken && secondToken !== SyntaxKind.EOF) {\n\t\t\t\t\t\thasError = true;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase SyntaxKind.Unknown:\n\t\t\t\t\thasError = true;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (lineBreak && (secondToken === SyntaxKind.LineCommentTrivia || secondToken === SyntaxKind.BlockCommentTrivia)) {\n\t\t\t\treplaceContent = newLineAndIndent();\n\t\t\t}\n\n\t\t}\n\t\tconst secondTokenStart = scanner.getTokenOffset() + formatTextStart;\n\t\taddEdit(replaceContent, firstTokenEnd, secondTokenStart);\n\t\tfirstToken = secondToken;\n\t}\n\treturn editOperations;\n}\n\nfunction repeat(s: string, count: number): string {\n\tlet result = '';\n\tfor (let i = 0; i < count; i++) {\n\t\tresult += s;\n\t}\n\treturn result;\n}\n\nfunction computeIndentLevel(content: string, options: FormattingOptions): number {\n\tlet i = 0;\n\tlet nChars = 0;\n\tconst tabSize = options.tabSize || 4;\n\twhile (i < content.length) {\n\t\tconst ch = content.charAt(i);\n\t\tif (ch === ' ') {\n\t\t\tnChars++;\n\t\t} else if (ch === '\\t') {\n\t\t\tnChars += tabSize;\n\t\t} else {\n\t\t\tbreak;\n\t\t}\n\t\ti++;\n\t}\n\treturn Math.floor(nChars / tabSize);\n}\n\nexport function getEOL(options: FormattingOptions, text: string): string {\n\tfor (let i = 0; i < text.length; i++) {\n\t\tconst ch = text.charAt(i);\n\t\tif (ch === '\\r') {\n\t\t\tif (i + 1 < text.length && text.charAt(i + 1) === '\\n') {\n\t\t\t\treturn '\\r\\n';\n\t\t\t}\n\t\t\treturn '\\r';\n\t\t} else if (ch === '\\n') {\n\t\t\treturn '\\n';\n\t\t}\n\t}\n\treturn (options && options.eol) || '\\n';\n}\n\nexport function isEOL(text: string, offset: number) {\n\treturn '\\r\\n'.indexOf(text.charAt(offset)) !== -1;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ParseError, Node, JSONPath, Segment, parseTree, findNodeAtLocation } from './json';\nimport { Edit, format, isEOL, FormattingOptions } from './jsonFormatter';\nimport { mergeSort } from 'vs/base/common/arrays';\n\n\nexport function removeProperty(text: string, path: JSONPath, formattingOptions: FormattingOptions): Edit[] {\n\treturn setProperty(text, path, undefined, formattingOptions);\n}\n\nexport function setProperty(text: string, originalPath: JSONPath, value: any, formattingOptions: FormattingOptions, getInsertionIndex?: (properties: string[]) => number): Edit[] {\n\tconst path = originalPath.slice();\n\tconst errors: ParseError[] = [];\n\tconst root = parseTree(text, errors);\n\tlet parent: Node | undefined = undefined;\n\n\tlet lastSegment: Segment | undefined = undefined;\n\twhile (path.length > 0) {\n\t\tlastSegment = path.pop();\n\t\tparent = findNodeAtLocation(root, path);\n\t\tif (parent === undefined && value !== undefined) {\n\t\t\tif (typeof lastSegment === 'string') {\n\t\t\t\tvalue = { [lastSegment]: value };\n\t\t\t} else {\n\t\t\t\tvalue = [value];\n\t\t\t}\n\t\t} else {\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tif (!parent) {\n\t\t// empty document\n\t\tif (value === undefined) { // delete\n\t\t\tthrow new Error('Can not delete in empty document');\n\t\t}\n\t\treturn withFormatting(text, { offset: root ? root.offset : 0, length: root ? root.length : 0, content: JSON.stringify(value) }, formattingOptions);\n\t} else if (parent.type === 'object' && typeof lastSegment === 'string' && Array.isArray(parent.children)) {\n\t\tconst existing = findNodeAtLocation(parent, [lastSegment]);\n\t\tif (existing !== undefined) {\n\t\t\tif (value === undefined) { // delete\n\t\t\t\tif (!existing.parent) {\n\t\t\t\t\tthrow new Error('Malformed AST');\n\t\t\t\t}\n\t\t\t\tconst propertyIndex = parent.children.indexOf(existing.parent);\n\t\t\t\tlet removeBegin: number;\n\t\t\t\tlet removeEnd = existing.parent.offset + existing.parent.length;\n\t\t\t\tif (propertyIndex > 0) {\n\t\t\t\t\t// remove the comma of the previous node\n\t\t\t\t\tconst previous = parent.children[propertyIndex - 1];\n\t\t\t\t\tremoveBegin = previous.offset + previous.length;\n\t\t\t\t} else {\n\t\t\t\t\tremoveBegin = parent.offset + 1;\n\t\t\t\t\tif (parent.children.length > 1) {\n\t\t\t\t\t\t// remove the comma of the next node\n\t\t\t\t\t\tconst next = parent.children[1];\n\t\t\t\t\t\tremoveEnd = next.offset;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn withFormatting(text, { offset: removeBegin, length: removeEnd - removeBegin, content: '' }, formattingOptions);\n\t\t\t} else {\n\t\t\t\t// set value of existing property\n\t\t\t\treturn withFormatting(text, { offset: existing.offset, length: existing.length, content: JSON.stringify(value) }, formattingOptions);\n\t\t\t}\n\t\t} else {\n\t\t\tif (value === undefined) { // delete\n\t\t\t\treturn []; // property does not exist, nothing to do\n\t\t\t}\n\t\t\tconst newProperty = `${JSON.stringify(lastSegment)}: ${JSON.stringify(value)}`;\n\t\t\tconst index = getInsertionIndex ? getInsertionIndex(parent.children.map(p => p.children![0].value)) : parent.children.length;\n\t\t\tlet edit: Edit;\n\t\t\tif (index > 0) {\n\t\t\t\tconst previous = parent.children[index - 1];\n\t\t\t\tedit = { offset: previous.offset + previous.length, length: 0, content: ',' + newProperty };\n\t\t\t} else if (parent.children.length === 0) {\n\t\t\t\tedit = { offset: parent.offset + 1, length: 0, content: newProperty };\n\t\t\t} else {\n\t\t\t\tedit = { offset: parent.offset + 1, length: 0, content: newProperty + ',' };\n\t\t\t}\n\t\t\treturn withFormatting(text, edit, formattingOptions);\n\t\t}\n\t} else if (parent.type === 'array' && typeof lastSegment === 'number' && Array.isArray(parent.children)) {\n\t\tif (value !== undefined) {\n\t\t\t// Insert\n\t\t\tconst newProperty = `${JSON.stringify(value)}`;\n\t\t\tlet edit: Edit;\n\t\t\tif (parent.children.length === 0 || lastSegment === 0) {\n\t\t\t\tedit = { offset: parent.offset + 1, length: 0, content: parent.children.length === 0 ? newProperty : newProperty + ',' };\n\t\t\t} else {\n\t\t\t\tconst index = lastSegment === -1 || lastSegment > parent.children.length ? parent.children.length : lastSegment;\n\t\t\t\tconst previous = parent.children[index - 1];\n\t\t\t\tedit = { offset: previous.offset + previous.length, length: 0, content: ',' + newProperty };\n\t\t\t}\n\t\t\treturn withFormatting(text, edit, formattingOptions);\n\t\t} else {\n\t\t\t//Removal\n\t\t\tconst removalIndex = lastSegment;\n\t\t\tconst toRemove = parent.children[removalIndex];\n\t\t\tlet edit: Edit;\n\t\t\tif (parent.children.length === 1) {\n\t\t\t\t// only item\n\t\t\t\tedit = { offset: parent.offset + 1, length: parent.length - 2, content: '' };\n\t\t\t} else if (parent.children.length - 1 === removalIndex) {\n\t\t\t\t// last item\n\t\t\t\tconst previous = parent.children[removalIndex - 1];\n\t\t\t\tconst offset = previous.offset + previous.length;\n\t\t\t\tconst parentEndOffset = parent.offset + parent.length;\n\t\t\t\tedit = { offset, length: parentEndOffset - 2 - offset, content: '' };\n\t\t\t} else {\n\t\t\t\tedit = { offset: toRemove.offset, length: parent.children[removalIndex + 1].offset - toRemove.offset, content: '' };\n\t\t\t}\n\t\t\treturn withFormatting(text, edit, formattingOptions);\n\t\t}\n\t} else {\n\t\tthrow new Error(`Can not add ${typeof lastSegment !== 'number' ? 'index' : 'property'} to parent of type ${parent.type}`);\n\t}\n}\n\nexport function withFormatting(text: string, edit: Edit, formattingOptions: FormattingOptions): Edit[] {\n\t// apply the edit\n\tlet newText = applyEdit(text, edit);\n\n\t// format the new text\n\tlet begin = edit.offset;\n\tlet end = edit.offset + edit.content.length;\n\tif (edit.length === 0 || edit.content.length === 0) { // insert or remove\n\t\twhile (begin > 0 && !isEOL(newText, begin - 1)) {\n\t\t\tbegin--;\n\t\t}\n\t\twhile (end < newText.length && !isEOL(newText, end)) {\n\t\t\tend++;\n\t\t}\n\t}\n\n\tconst edits = format(newText, { offset: begin, length: end - begin }, formattingOptions);\n\n\t// apply the formatting edits and track the begin and end offsets of the changes\n\tfor (let i = edits.length - 1; i >= 0; i--) {\n\t\tconst curr = edits[i];\n\t\tnewText = applyEdit(newText, curr);\n\t\tbegin = Math.min(begin, curr.offset);\n\t\tend = Math.max(end, curr.offset + curr.length);\n\t\tend += curr.content.length - curr.length;\n\t}\n\t// create a single edit with all changes\n\tconst editLength = text.length - (newText.length - end) - begin;\n\treturn [{ offset: begin, length: editLength, content: newText.substring(begin, end) }];\n}\n\nexport function applyEdit(text: string, edit: Edit): string {\n\treturn text.substring(0, edit.offset) + edit.content + text.substring(edit.offset + edit.length);\n}\n\nexport function applyEdits(text: string, edits: Edit[]): string {\n\tlet sortedEdits = mergeSort(edits, (a, b) => {\n\t\tconst diff = a.offset - b.offset;\n\t\tif (diff === 0) {\n\t\t\treturn a.length - b.length;\n\t\t}\n\t\treturn diff;\n\t});\n\tlet lastModifiedOffset = text.length;\n\tfor (let i = sortedEdits.length - 1; i >= 0; i--) {\n\t\tlet e = sortedEdits[i];\n\t\tif (e.offset + e.length <= lastModifiedOffset) {\n\t\t\ttext = applyEdit(text, e);\n\t\t} else {\n\t\t\tthrow new Error('Overlapping edit');\n\t\t}\n\t\tlastModifiedOffset = e.offset;\n\t}\n\treturn text;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { once } from 'vs/base/common/functional';\nimport { Iterable } from 'vs/base/common/iterator';\n\n/**\n * Enables logging of potentially leaked disposables.\n *\n * A disposable is considered leaked if it is not disposed or not registered as the child of\n * another disposable. This tracking is very simple an only works for classes that either\n * extend Disposable or use a DisposableStore. This means there are a lot of false positives.\n */\nconst TRACK_DISPOSABLES = false;\nlet disposableTracker: IDisposableTracker | null = null;\n\nexport interface IDisposableTracker {\n\ttrackDisposable(x: IDisposable): void;\n\tmarkTracked(x: IDisposable): void;\n}\n\nexport function setDisposableTracker(tracker: IDisposableTracker | null): void {\n\tdisposableTracker = tracker;\n}\n\nif (TRACK_DISPOSABLES) {\n\tconst __is_disposable_tracked__ = '__is_disposable_tracked__';\n\tdisposableTracker = new class implements IDisposableTracker {\n\t\ttrackDisposable(x: IDisposable): void {\n\t\t\tconst stack = new Error('Potentially leaked disposable').stack!;\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (!(x as any)[__is_disposable_tracked__]) {\n\t\t\t\t\tconsole.log(stack);\n\t\t\t\t}\n\t\t\t}, 3000);\n\t\t}\n\n\t\tmarkTracked(x: IDisposable): void {\n\t\t\tif (x && x !== Disposable.None) {\n\t\t\t\ttry {\n\t\t\t\t\t(x as any)[__is_disposable_tracked__] = true;\n\t\t\t\t} catch {\n\t\t\t\t\t// noop\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n}\n\nfunction markTracked<T extends IDisposable>(x: T): void {\n\tif (!disposableTracker) {\n\t\treturn;\n\t}\n\tdisposableTracker.markTracked(x);\n}\n\nexport function trackDisposable<T extends IDisposable>(x: T): T {\n\tif (!disposableTracker) {\n\t\treturn x;\n\t}\n\tdisposableTracker.trackDisposable(x);\n\treturn x;\n}\n\nexport class MultiDisposeError extends Error {\n\tconstructor(\n\t\tpublic readonly errors: any[]\n\t) {\n\t\tsuper(`Encounter errors while disposing of store. Errors: [${errors.join(', ')}]`);\n\t}\n}\n\nexport interface IDisposable {\n\tdispose(): void;\n}\n\nexport function isDisposable<E extends object>(thing: E): thing is E & IDisposable {\n\treturn typeof (<IDisposable>thing).dispose === 'function' && (<IDisposable>thing).dispose.length === 0;\n}\n\nexport function dispose<T extends IDisposable>(disposable: T): T;\nexport function dispose<T extends IDisposable>(disposable: T | undefined): T | undefined;\nexport function dispose<T extends IDisposable, A extends IterableIterator<T> = IterableIterator<T>>(disposables: IterableIterator<T>): A;\nexport function dispose<T extends IDisposable>(disposables: Array<T>): Array<T>;\nexport function dispose<T extends IDisposable>(disposables: ReadonlyArray<T>): ReadonlyArray<T>;\nexport function dispose<T extends IDisposable>(arg: T | IterableIterator<T> | undefined): any {\n\tif (Iterable.is(arg)) {\n\t\tlet errors: any[] = [];\n\n\t\tfor (const d of arg) {\n\t\t\tif (d) {\n\t\t\t\tmarkTracked(d);\n\t\t\t\ttry {\n\t\t\t\t\td.dispose();\n\t\t\t\t} catch (e) {\n\t\t\t\t\terrors.push(e);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (errors.length === 1) {\n\t\t\tthrow errors[0];\n\t\t} else if (errors.length > 1) {\n\t\t\tthrow new MultiDisposeError(errors);\n\t\t}\n\n\t\treturn Array.isArray(arg) ? [] : arg;\n\t} else if (arg) {\n\t\tmarkTracked(arg);\n\t\targ.dispose();\n\t\treturn arg;\n\t}\n}\n\n\nexport function combinedDisposable(...disposables: IDisposable[]): IDisposable {\n\tdisposables.forEach(markTracked);\n\treturn toDisposable(() => dispose(disposables));\n}\n\nexport function toDisposable(fn: () => void): IDisposable {\n\tconst self = trackDisposable({\n\t\tdispose: () => {\n\t\t\tmarkTracked(self);\n\t\t\tfn();\n\t\t}\n\t});\n\treturn self;\n}\n\nexport class DisposableStore implements IDisposable {\n\n\tstatic DISABLE_DISPOSED_WARNING = false;\n\n\tprivate _toDispose = new Set<IDisposable>();\n\tprivate _isDisposed = false;\n\n\t/**\n\t * Dispose of all registered disposables and mark this object as disposed.\n\t *\n\t * Any future disposables added to this object will be disposed of on `add`.\n\t */\n\tpublic dispose(): void {\n\t\tif (this._isDisposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tmarkTracked(this);\n\t\tthis._isDisposed = true;\n\t\tthis.clear();\n\t}\n\n\t/**\n\t * Dispose of all registered disposables but do not mark this object as disposed.\n\t */\n\tpublic clear(): void {\n\t\ttry {\n\t\t\tdispose(this._toDispose.values());\n\t\t} finally {\n\t\t\tthis._toDispose.clear();\n\t\t}\n\t}\n\n\tpublic add<T extends IDisposable>(t: T): T {\n\t\tif (!t) {\n\t\t\treturn t;\n\t\t}\n\t\tif ((t as unknown as DisposableStore) === this) {\n\t\t\tthrow new Error('Cannot register a disposable on itself!');\n\t\t}\n\n\t\tmarkTracked(t);\n\t\tif (this._isDisposed) {\n\t\t\tif (!DisposableStore.DISABLE_DISPOSED_WARNING) {\n\t\t\t\tconsole.warn(new Error('Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!').stack);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._toDispose.add(t);\n\t\t}\n\n\t\treturn t;\n\t}\n}\n\nexport abstract class Disposable implements IDisposable {\n\n\tstatic readonly None = Object.freeze<IDisposable>({ dispose() { } });\n\n\tprivate readonly _store = new DisposableStore();\n\n\tconstructor() {\n\t\ttrackDisposable(this);\n\t}\n\n\tpublic dispose(): void {\n\t\tmarkTracked(this);\n\n\t\tthis._store.dispose();\n\t}\n\n\tprotected _register<T extends IDisposable>(t: T): T {\n\t\tif ((t as unknown as Disposable) === this) {\n\t\t\tthrow new Error('Cannot register a disposable on itself!');\n\t\t}\n\t\treturn this._store.add(t);\n\t}\n}\n\n/**\n * Manages the lifecycle of a disposable value that may be changed.\n *\n * This ensures that when the disposable value is changed, the previously held disposable is disposed of. You can\n * also register a `MutableDisposable` on a `Disposable` to ensure it is automatically cleaned up.\n */\nexport class MutableDisposable<T extends IDisposable> implements IDisposable {\n\tprivate _value?: T;\n\tprivate _isDisposed = false;\n\n\tconstructor() {\n\t\ttrackDisposable(this);\n\t}\n\n\tget value(): T | undefined {\n\t\treturn this._isDisposed ? undefined : this._value;\n\t}\n\n\tset value(value: T | undefined) {\n\t\tif (this._isDisposed || value === this._value) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._value) {\n\t\t\tthis._value.dispose();\n\t\t}\n\t\tif (value) {\n\t\t\tmarkTracked(value);\n\t\t}\n\t\tthis._value = value;\n\t}\n\n\tclear() {\n\t\tthis.value = undefined;\n\t}\n\n\tdispose(): void {\n\t\tthis._isDisposed = true;\n\t\tmarkTracked(this);\n\t\tif (this._value) {\n\t\t\tthis._value.dispose();\n\t\t}\n\t\tthis._value = undefined;\n\t}\n}\n\nexport interface IReference<T> extends IDisposable {\n\treadonly object: T;\n}\n\nexport abstract class ReferenceCollection<T> {\n\n\tprivate readonly references: Map<string, { readonly object: T; counter: number; }> = new Map();\n\n\tacquire(key: string, ...args: any[]): IReference<T> {\n\t\tlet reference = this.references.get(key);\n\n\t\tif (!reference) {\n\t\t\treference = { counter: 0, object: this.createReferencedObject(key, ...args) };\n\t\t\tthis.references.set(key, reference);\n\t\t}\n\n\t\tconst { object } = reference;\n\t\tconst dispose = once(() => {\n\t\t\tif (--reference!.counter === 0) {\n\t\t\t\tthis.destroyReferencedObject(key, reference!.object);\n\t\t\t\tthis.references.delete(key);\n\t\t\t}\n\t\t});\n\n\t\treference.counter++;\n\n\t\treturn { object, dispose };\n\t}\n\n\tprotected abstract createReferencedObject(key: string, ...args: any[]): T;\n\tprotected abstract destroyReferencedObject(key: string, object: T): void;\n}\n\nexport class ImmortalReference<T> implements IReference<T> {\n\tconstructor(public object: T) { }\n\tdispose(): void { /* noop */ }\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nclass Node<E> {\n\n\tstatic readonly Undefined = new Node<any>(undefined);\n\n\telement: E;\n\tnext: Node<E>;\n\tprev: Node<E>;\n\n\tconstructor(element: E) {\n\t\tthis.element = element;\n\t\tthis.next = Node.Undefined;\n\t\tthis.prev = Node.Undefined;\n\t}\n}\n\nexport class LinkedList<E> {\n\n\tprivate _first: Node<E> = Node.Undefined;\n\tprivate _last: Node<E> = Node.Undefined;\n\tprivate _size: number = 0;\n\n\tget size(): number {\n\t\treturn this._size;\n\t}\n\n\tisEmpty(): boolean {\n\t\treturn this._first === Node.Undefined;\n\t}\n\n\tclear(): void {\n\t\tthis._first = Node.Undefined;\n\t\tthis._last = Node.Undefined;\n\t\tthis._size = 0;\n\t}\n\n\tunshift(element: E): () => void {\n\t\treturn this._insert(element, false);\n\t}\n\n\tpush(element: E): () => void {\n\t\treturn this._insert(element, true);\n\t}\n\n\tprivate _insert(element: E, atTheEnd: boolean): () => void {\n\t\tconst newNode = new Node(element);\n\t\tif (this._first === Node.Undefined) {\n\t\t\tthis._first = newNode;\n\t\t\tthis._last = newNode;\n\n\t\t} else if (atTheEnd) {\n\t\t\t// push\n\t\t\tconst oldLast = this._last!;\n\t\t\tthis._last = newNode;\n\t\t\tnewNode.prev = oldLast;\n\t\t\toldLast.next = newNode;\n\n\t\t} else {\n\t\t\t// unshift\n\t\t\tconst oldFirst = this._first;\n\t\t\tthis._first = newNode;\n\t\t\tnewNode.next = oldFirst;\n\t\t\toldFirst.prev = newNode;\n\t\t}\n\t\tthis._size += 1;\n\n\t\tlet didRemove = false;\n\t\treturn () => {\n\t\t\tif (!didRemove) {\n\t\t\t\tdidRemove = true;\n\t\t\t\tthis._remove(newNode);\n\t\t\t}\n\t\t};\n\t}\n\n\tshift(): E | undefined {\n\t\tif (this._first === Node.Undefined) {\n\t\t\treturn undefined;\n\t\t} else {\n\t\t\tconst res = this._first.element;\n\t\t\tthis._remove(this._first);\n\t\t\treturn res;\n\t\t}\n\t}\n\n\tpop(): E | undefined {\n\t\tif (this._last === Node.Undefined) {\n\t\t\treturn undefined;\n\t\t} else {\n\t\t\tconst res = this._last.element;\n\t\t\tthis._remove(this._last);\n\t\t\treturn res;\n\t\t}\n\t}\n\n\tprivate _remove(node: Node<E>): void {\n\t\tif (node.prev !== Node.Undefined && node.next !== Node.Undefined) {\n\t\t\t// middle\n\t\t\tconst anchor = node.prev;\n\t\t\tanchor.next = node.next;\n\t\t\tnode.next.prev = anchor;\n\n\t\t} else if (node.prev === Node.Undefined && node.next === Node.Undefined) {\n\t\t\t// only node\n\t\t\tthis._first = Node.Undefined;\n\t\t\tthis._last = Node.Undefined;\n\n\t\t} else if (node.next === Node.Undefined) {\n\t\t\t// last\n\t\t\tthis._last = this._last!.prev!;\n\t\t\tthis._last.next = Node.Undefined;\n\n\t\t} else if (node.prev === Node.Undefined) {\n\t\t\t// first\n\t\t\tthis._first = this._first!.next!;\n\t\t\tthis._first.prev = Node.Undefined;\n\t\t}\n\n\t\t// done\n\t\tthis._size -= 1;\n\t}\n\n\t*[Symbol.iterator](): Iterator<E> {\n\t\tlet node = this._first;\n\t\twhile (node !== Node.Undefined) {\n\t\t\tyield node.element;\n\t\t\tnode = node.next;\n\t\t}\n\t}\n}\n","/**\n * marked - a markdown parser\n * Copyright (c) 2011-2020, Christopher Jeffrey. (MIT Licensed)\n * https://github.com/markedjs/marked\n */\n\n/**\n * DO NOT EDIT THIS FILE\n * The code in this file is generated from files in ./src/\n */\n\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n  typeof define === 'function' && define.amd ? define(\"vs/base/common/marked/marked\", factory) :\n  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, global.marked = factory());\n}(this, (function () { 'use strict';\n\n  function _defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  function _createClass(Constructor, protoProps, staticProps) {\n    if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) _defineProperties(Constructor, staticProps);\n    return Constructor;\n  }\n\n  function _unsupportedIterableToArray(o, minLen) {\n    if (!o) return;\n    if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n    var n = Object.prototype.toString.call(o).slice(8, -1);\n    if (n === \"Object\" && o.constructor) n = o.constructor.name;\n    if (n === \"Map\" || n === \"Set\") return Array.from(o);\n    if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n  }\n\n  function _arrayLikeToArray(arr, len) {\n    if (len == null || len > arr.length) len = arr.length;\n\n    for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n\n    return arr2;\n  }\n\n  function _createForOfIteratorHelperLoose(o, allowArrayLike) {\n    var it;\n\n    if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) {\n      if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n        if (it) o = it;\n        var i = 0;\n        return function () {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        };\n      }\n\n      throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n    }\n\n    it = o[Symbol.iterator]();\n    return it.next.bind(it);\n  }\n\n  function createCommonjsModule(fn, module) {\n  \treturn module = { exports: {} }, fn(module, module.exports), module.exports;\n  }\n\n  var defaults = createCommonjsModule(function (module) {\n    function getDefaults() {\n      return {\n        baseUrl: null,\n        breaks: false,\n        gfm: true,\n        headerIds: true,\n        headerPrefix: '',\n        highlight: null,\n        langPrefix: 'language-',\n        mangle: true,\n        pedantic: false,\n        renderer: null,\n        sanitize: false,\n        sanitizer: null,\n        silent: false,\n        smartLists: false,\n        smartypants: false,\n        tokenizer: null,\n        walkTokens: null,\n        xhtml: false\n      };\n    }\n\n    function changeDefaults(newDefaults) {\n      module.exports.defaults = newDefaults;\n    }\n\n    module.exports = {\n      defaults: getDefaults(),\n      getDefaults: getDefaults,\n      changeDefaults: changeDefaults\n    };\n  });\n  var defaults_1 = defaults.defaults;\n  var defaults_2 = defaults.getDefaults;\n  var defaults_3 = defaults.changeDefaults;\n\n  /**\n   * Helpers\n   */\n  var escapeTest = /[&<>\"']/;\n  var escapeReplace = /[&<>\"']/g;\n  var escapeTestNoEncode = /[<>\"']|&(?!#?\\w+;)/;\n  var escapeReplaceNoEncode = /[<>\"']|&(?!#?\\w+;)/g;\n  var escapeReplacements = {\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;',\n    '\"': '&quot;',\n    \"'\": '&#39;'\n  };\n\n  var getEscapeReplacement = function getEscapeReplacement(ch) {\n    return escapeReplacements[ch];\n  };\n\n  function escape(html, encode) {\n    if (encode) {\n      if (escapeTest.test(html)) {\n        return html.replace(escapeReplace, getEscapeReplacement);\n      }\n    } else {\n      if (escapeTestNoEncode.test(html)) {\n        return html.replace(escapeReplaceNoEncode, getEscapeReplacement);\n      }\n    }\n\n    return html;\n  }\n\n  var unescapeTest = /&(#(?:\\d+)|(?:#x[0-9A-Fa-f]+)|(?:\\w+));?/ig;\n\n  function unescape(html) {\n    // explicitly match decimal, hex, and named HTML entities\n    return html.replace(unescapeTest, function (_, n) {\n      n = n.toLowerCase();\n      if (n === 'colon') return ':';\n\n      if (n.charAt(0) === '#') {\n        return n.charAt(1) === 'x' ? String.fromCharCode(parseInt(n.substring(2), 16)) : String.fromCharCode(+n.substring(1));\n      }\n\n      return '';\n    });\n  }\n\n  var caret = /(^|[^\\[])\\^/g;\n\n  function edit(regex, opt) {\n    regex = regex.source || regex;\n    opt = opt || '';\n    var obj = {\n      replace: function replace(name, val) {\n        val = val.source || val;\n        val = val.replace(caret, '$1');\n        regex = regex.replace(name, val);\n        return obj;\n      },\n      getRegex: function getRegex() {\n        return new RegExp(regex, opt);\n      }\n    };\n    return obj;\n  }\n\n  var nonWordAndColonTest = /[^\\w:]/g;\n  var originIndependentUrl = /^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;\n\n  function cleanUrl(sanitize, base, href) {\n    if (sanitize) {\n      var prot;\n\n      try {\n        prot = decodeURIComponent(unescape(href)).replace(nonWordAndColonTest, '').toLowerCase();\n      } catch (e) {\n        return null;\n      }\n\n      if (prot.indexOf('javascript:') === 0 || prot.indexOf('vbscript:') === 0 || prot.indexOf('data:') === 0) {\n        return null;\n      }\n    }\n\n    if (base && !originIndependentUrl.test(href)) {\n      href = resolveUrl(base, href);\n    }\n\n    try {\n      href = encodeURI(href).replace(/%25/g, '%');\n    } catch (e) {\n      return null;\n    }\n\n    return href;\n  }\n\n  var baseUrls = {};\n  var justDomain = /^[^:]+:\\/*[^/]*$/;\n  var protocol = /^([^:]+:)[\\s\\S]*$/;\n  var domain = /^([^:]+:\\/*[^/]*)[\\s\\S]*$/;\n\n  function resolveUrl(base, href) {\n    if (!baseUrls[' ' + base]) {\n      // we can ignore everything in base after the last slash of its path component,\n      // but we might need to add _that_\n      // https://tools.ietf.org/html/rfc3986#section-3\n      if (justDomain.test(base)) {\n        baseUrls[' ' + base] = base + '/';\n      } else {\n        baseUrls[' ' + base] = rtrim(base, '/', true);\n      }\n    }\n\n    base = baseUrls[' ' + base];\n    var relativeBase = base.indexOf(':') === -1;\n\n    if (href.substring(0, 2) === '//') {\n      if (relativeBase) {\n        return href;\n      }\n\n      return base.replace(protocol, '$1') + href;\n    } else if (href.charAt(0) === '/') {\n      if (relativeBase) {\n        return href;\n      }\n\n      return base.replace(domain, '$1') + href;\n    } else {\n      return base + href;\n    }\n  }\n\n  var noopTest = {\n    exec: function noopTest() {}\n  };\n\n  function merge(obj) {\n    var i = 1,\n        target,\n        key;\n\n    for (; i < arguments.length; i++) {\n      target = arguments[i];\n\n      for (key in target) {\n        if (Object.prototype.hasOwnProperty.call(target, key)) {\n          obj[key] = target[key];\n        }\n      }\n    }\n\n    return obj;\n  }\n\n  function splitCells(tableRow, count) {\n    // ensure that every cell-delimiting pipe has a space\n    // before it to distinguish it from an escaped pipe\n    var row = tableRow.replace(/\\|/g, function (match, offset, str) {\n      var escaped = false,\n          curr = offset;\n\n      while (--curr >= 0 && str[curr] === '\\\\') {\n        escaped = !escaped;\n      }\n\n      if (escaped) {\n        // odd number of slashes means | is escaped\n        // so we leave it alone\n        return '|';\n      } else {\n        // add space before unescaped |\n        return ' |';\n      }\n    }),\n        cells = row.split(/ \\|/);\n    var i = 0;\n\n    if (cells.length > count) {\n      cells.splice(count);\n    } else {\n      while (cells.length < count) {\n        cells.push('');\n      }\n    }\n\n    for (; i < cells.length; i++) {\n      // leading or trailing whitespace is ignored per the gfm spec\n      cells[i] = cells[i].trim().replace(/\\\\\\|/g, '|');\n    }\n\n    return cells;\n  } // Remove trailing 'c's. Equivalent to str.replace(/c*$/, '').\n  // /c*$/ is vulnerable to REDOS.\n  // invert: Remove suffix of non-c chars instead. Default falsey.\n\n\n  function rtrim(str, c, invert) {\n    var l = str.length;\n\n    if (l === 0) {\n      return '';\n    } // Length of suffix matching the invert condition.\n\n\n    var suffLen = 0; // Step left until we fail to match the invert condition.\n\n    while (suffLen < l) {\n      var currChar = str.charAt(l - suffLen - 1);\n\n      if (currChar === c && !invert) {\n        suffLen++;\n      } else if (currChar !== c && invert) {\n        suffLen++;\n      } else {\n        break;\n      }\n    }\n\n    return str.substr(0, l - suffLen);\n  }\n\n  function findClosingBracket(str, b) {\n    if (str.indexOf(b[1]) === -1) {\n      return -1;\n    }\n\n    var l = str.length;\n    var level = 0,\n        i = 0;\n\n    for (; i < l; i++) {\n      if (str[i] === '\\\\') {\n        i++;\n      } else if (str[i] === b[0]) {\n        level++;\n      } else if (str[i] === b[1]) {\n        level--;\n\n        if (level < 0) {\n          return i;\n        }\n      }\n    }\n\n    return -1;\n  }\n\n  function checkSanitizeDeprecation(opt) {\n    if (opt && opt.sanitize && !opt.silent) {\n      console.warn('marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options');\n    }\n  } // copied from https://stackoverflow.com/a/5450113/806777\n\n\n  function repeatString(pattern, count) {\n    if (count < 1) {\n      return '';\n    }\n\n    var result = '';\n\n    while (count > 1) {\n      if (count & 1) {\n        result += pattern;\n      }\n\n      count >>= 1;\n      pattern += pattern;\n    }\n\n    return result + pattern;\n  }\n\n  var helpers = {\n    escape: escape,\n    unescape: unescape,\n    edit: edit,\n    cleanUrl: cleanUrl,\n    resolveUrl: resolveUrl,\n    noopTest: noopTest,\n    merge: merge,\n    splitCells: splitCells,\n    rtrim: rtrim,\n    findClosingBracket: findClosingBracket,\n    checkSanitizeDeprecation: checkSanitizeDeprecation,\n    repeatString: repeatString\n  };\n\n  var defaults$1 = defaults.defaults;\n  var rtrim$1 = helpers.rtrim,\n      splitCells$1 = helpers.splitCells,\n      _escape = helpers.escape,\n      findClosingBracket$1 = helpers.findClosingBracket;\n\n  function outputLink(cap, link, raw) {\n    var href = link.href;\n    var title = link.title ? _escape(link.title) : null;\n    var text = cap[1].replace(/\\\\([\\[\\]])/g, '$1');\n\n    if (cap[0].charAt(0) !== '!') {\n      return {\n        type: 'link',\n        raw: raw,\n        href: href,\n        title: title,\n        text: text\n      };\n    } else {\n      return {\n        type: 'image',\n        raw: raw,\n        href: href,\n        title: title,\n        text: _escape(text)\n      };\n    }\n  }\n\n  function indentCodeCompensation(raw, text) {\n    var matchIndentToCode = raw.match(/^(\\s+)(?:```)/);\n\n    if (matchIndentToCode === null) {\n      return text;\n    }\n\n    var indentToCode = matchIndentToCode[1];\n    return text.split('\\n').map(function (node) {\n      var matchIndentInNode = node.match(/^\\s+/);\n\n      if (matchIndentInNode === null) {\n        return node;\n      }\n\n      var indentInNode = matchIndentInNode[0];\n\n      if (indentInNode.length >= indentToCode.length) {\n        return node.slice(indentToCode.length);\n      }\n\n      return node;\n    }).join('\\n');\n  }\n  /**\n   * Tokenizer\n   */\n\n\n  var Tokenizer_1 = /*#__PURE__*/function () {\n    function Tokenizer(options) {\n      this.options = options || defaults$1;\n    }\n\n    var _proto = Tokenizer.prototype;\n\n    _proto.space = function space(src) {\n      var cap = this.rules.block.newline.exec(src);\n\n      if (cap) {\n        if (cap[0].length > 1) {\n          return {\n            type: 'space',\n            raw: cap[0]\n          };\n        }\n\n        return {\n          raw: '\\n'\n        };\n      }\n    };\n\n    _proto.code = function code(src, tokens) {\n      var cap = this.rules.block.code.exec(src);\n\n      if (cap) {\n        var lastToken = tokens[tokens.length - 1]; // An indented code block cannot interrupt a paragraph.\n\n        if (lastToken && lastToken.type === 'paragraph') {\n          return {\n            raw: cap[0],\n            text: cap[0].trimRight()\n          };\n        }\n\n        var text = cap[0].replace(/^ {4}/gm, '');\n        return {\n          type: 'code',\n          raw: cap[0],\n          codeBlockStyle: 'indented',\n          text: !this.options.pedantic ? rtrim$1(text, '\\n') : text\n        };\n      }\n    };\n\n    _proto.fences = function fences(src) {\n      var cap = this.rules.block.fences.exec(src);\n\n      if (cap) {\n        var raw = cap[0];\n        var text = indentCodeCompensation(raw, cap[3] || '');\n        return {\n          type: 'code',\n          raw: raw,\n          lang: cap[2] ? cap[2].trim() : cap[2],\n          text: text\n        };\n      }\n    };\n\n    _proto.heading = function heading(src) {\n      var cap = this.rules.block.heading.exec(src);\n\n      if (cap) {\n        return {\n          type: 'heading',\n          raw: cap[0],\n          depth: cap[1].length,\n          text: cap[2]\n        };\n      }\n    };\n\n    _proto.nptable = function nptable(src) {\n      var cap = this.rules.block.nptable.exec(src);\n\n      if (cap) {\n        var item = {\n          type: 'table',\n          header: splitCells$1(cap[1].replace(/^ *| *\\| *$/g, '')),\n          align: cap[2].replace(/^ *|\\| *$/g, '').split(/ *\\| */),\n          cells: cap[3] ? cap[3].replace(/\\n$/, '').split('\\n') : [],\n          raw: cap[0]\n        };\n\n        if (item.header.length === item.align.length) {\n          var l = item.align.length;\n          var i;\n\n          for (i = 0; i < l; i++) {\n            if (/^ *-+: *$/.test(item.align[i])) {\n              item.align[i] = 'right';\n            } else if (/^ *:-+: *$/.test(item.align[i])) {\n              item.align[i] = 'center';\n            } else if (/^ *:-+ *$/.test(item.align[i])) {\n              item.align[i] = 'left';\n            } else {\n              item.align[i] = null;\n            }\n          }\n\n          l = item.cells.length;\n\n          for (i = 0; i < l; i++) {\n            item.cells[i] = splitCells$1(item.cells[i], item.header.length);\n          }\n\n          return item;\n        }\n      }\n    };\n\n    _proto.hr = function hr(src) {\n      var cap = this.rules.block.hr.exec(src);\n\n      if (cap) {\n        return {\n          type: 'hr',\n          raw: cap[0]\n        };\n      }\n    };\n\n    _proto.blockquote = function blockquote(src) {\n      var cap = this.rules.block.blockquote.exec(src);\n\n      if (cap) {\n        var text = cap[0].replace(/^ *> ?/gm, '');\n        return {\n          type: 'blockquote',\n          raw: cap[0],\n          text: text\n        };\n      }\n    };\n\n    _proto.list = function list(src) {\n      var cap = this.rules.block.list.exec(src);\n\n      if (cap) {\n        var raw = cap[0];\n        var bull = cap[2];\n        var isordered = bull.length > 1;\n        var isparen = bull[bull.length - 1] === ')';\n        var list = {\n          type: 'list',\n          raw: raw,\n          ordered: isordered,\n          start: isordered ? +bull.slice(0, -1) : '',\n          loose: false,\n          items: []\n        }; // Get each top-level item.\n\n        var itemMatch = cap[0].match(this.rules.block.item);\n        var next = false,\n            item,\n            space,\n            b,\n            addBack,\n            loose,\n            istask,\n            ischecked;\n        var l = itemMatch.length;\n\n        for (var i = 0; i < l; i++) {\n          item = itemMatch[i];\n          raw = item; // Remove the list item's bullet\n          // so it is seen as the next token.\n\n          space = item.length;\n          item = item.replace(/^ *([*+-]|\\d+[.)]) ?/, ''); // Outdent whatever the\n          // list item contains. Hacky.\n\n          if (~item.indexOf('\\n ')) {\n            space -= item.length;\n            item = !this.options.pedantic ? item.replace(new RegExp('^ {1,' + space + '}', 'gm'), '') : item.replace(/^ {1,4}/gm, '');\n          } // Determine whether the next list item belongs here.\n          // Backpedal if it does not belong in this list.\n\n\n          if (i !== l - 1) {\n            b = this.rules.block.bullet.exec(itemMatch[i + 1])[0];\n\n            if (isordered ? b.length === 1 || !isparen && b[b.length - 1] === ')' : b.length > 1 || this.options.smartLists && b !== bull) {\n              addBack = itemMatch.slice(i + 1).join('\\n');\n              list.raw = list.raw.substring(0, list.raw.length - addBack.length);\n              i = l - 1;\n            }\n          } // Determine whether item is loose or not.\n          // Use: /(^|\\n)(?! )[^\\n]+\\n\\n(?!\\s*$)/\n          // for discount behavior.\n\n\n          loose = next || /\\n\\n(?!\\s*$)/.test(item);\n\n          if (i !== l - 1) {\n            next = item.charAt(item.length - 1) === '\\n';\n            if (!loose) loose = next;\n          }\n\n          if (loose) {\n            list.loose = true;\n          } // Check for task list items\n\n\n          istask = /^\\[[ xX]\\] /.test(item);\n          ischecked = undefined;\n\n          if (istask) {\n            ischecked = item[1] !== ' ';\n            item = item.replace(/^\\[[ xX]\\] +/, '');\n          }\n\n          list.items.push({\n            type: 'list_item',\n            raw: raw,\n            task: istask,\n            checked: ischecked,\n            loose: loose,\n            text: item\n          });\n        }\n\n        return list;\n      }\n    };\n\n    _proto.html = function html(src) {\n      var cap = this.rules.block.html.exec(src);\n\n      if (cap) {\n        return {\n          type: this.options.sanitize ? 'paragraph' : 'html',\n          raw: cap[0],\n          pre: !this.options.sanitizer && (cap[1] === 'pre' || cap[1] === 'script' || cap[1] === 'style'),\n          text: this.options.sanitize ? this.options.sanitizer ? this.options.sanitizer(cap[0]) : _escape(cap[0]) : cap[0]\n        };\n      }\n    };\n\n    _proto.def = function def(src) {\n      var cap = this.rules.block.def.exec(src);\n\n      if (cap) {\n        if (cap[3]) cap[3] = cap[3].substring(1, cap[3].length - 1);\n        var tag = cap[1].toLowerCase().replace(/\\s+/g, ' ');\n        return {\n          tag: tag,\n          raw: cap[0],\n          href: cap[2],\n          title: cap[3]\n        };\n      }\n    };\n\n    _proto.table = function table(src) {\n      var cap = this.rules.block.table.exec(src);\n\n      if (cap) {\n        var item = {\n          type: 'table',\n          header: splitCells$1(cap[1].replace(/^ *| *\\| *$/g, '')),\n          align: cap[2].replace(/^ *|\\| *$/g, '').split(/ *\\| */),\n          cells: cap[3] ? cap[3].replace(/\\n$/, '').split('\\n') : []\n        };\n\n        if (item.header.length === item.align.length) {\n          item.raw = cap[0];\n          var l = item.align.length;\n          var i;\n\n          for (i = 0; i < l; i++) {\n            if (/^ *-+: *$/.test(item.align[i])) {\n              item.align[i] = 'right';\n            } else if (/^ *:-+: *$/.test(item.align[i])) {\n              item.align[i] = 'center';\n            } else if (/^ *:-+ *$/.test(item.align[i])) {\n              item.align[i] = 'left';\n            } else {\n              item.align[i] = null;\n            }\n          }\n\n          l = item.cells.length;\n\n          for (i = 0; i < l; i++) {\n            item.cells[i] = splitCells$1(item.cells[i].replace(/^ *\\| *| *\\| *$/g, ''), item.header.length);\n          }\n\n          return item;\n        }\n      }\n    };\n\n    _proto.lheading = function lheading(src) {\n      var cap = this.rules.block.lheading.exec(src);\n\n      if (cap) {\n        return {\n          type: 'heading',\n          raw: cap[0],\n          depth: cap[2].charAt(0) === '=' ? 1 : 2,\n          text: cap[1]\n        };\n      }\n    };\n\n    _proto.paragraph = function paragraph(src) {\n      var cap = this.rules.block.paragraph.exec(src);\n\n      if (cap) {\n        return {\n          type: 'paragraph',\n          raw: cap[0],\n          text: cap[1].charAt(cap[1].length - 1) === '\\n' ? cap[1].slice(0, -1) : cap[1]\n        };\n      }\n    };\n\n    _proto.text = function text(src, tokens) {\n      var cap = this.rules.block.text.exec(src);\n\n      if (cap) {\n        var lastToken = tokens[tokens.length - 1];\n\n        if (lastToken && lastToken.type === 'text') {\n          return {\n            raw: cap[0],\n            text: cap[0]\n          };\n        }\n\n        return {\n          type: 'text',\n          raw: cap[0],\n          text: cap[0]\n        };\n      }\n    };\n\n    _proto.escape = function escape(src) {\n      var cap = this.rules.inline.escape.exec(src);\n\n      if (cap) {\n        return {\n          type: 'escape',\n          raw: cap[0],\n          text: _escape(cap[1])\n        };\n      }\n    };\n\n    _proto.tag = function tag(src, inLink, inRawBlock) {\n      var cap = this.rules.inline.tag.exec(src);\n\n      if (cap) {\n        if (!inLink && /^<a /i.test(cap[0])) {\n          inLink = true;\n        } else if (inLink && /^<\\/a>/i.test(cap[0])) {\n          inLink = false;\n        }\n\n        if (!inRawBlock && /^<(pre|code|kbd|script)(\\s|>)/i.test(cap[0])) {\n          inRawBlock = true;\n        } else if (inRawBlock && /^<\\/(pre|code|kbd|script)(\\s|>)/i.test(cap[0])) {\n          inRawBlock = false;\n        }\n\n        return {\n          type: this.options.sanitize ? 'text' : 'html',\n          raw: cap[0],\n          inLink: inLink,\n          inRawBlock: inRawBlock,\n          text: this.options.sanitize ? this.options.sanitizer ? this.options.sanitizer(cap[0]) : _escape(cap[0]) : cap[0]\n        };\n      }\n    };\n\n    _proto.link = function link(src) {\n      var cap = this.rules.inline.link.exec(src);\n\n      if (cap) {\n        var lastParenIndex = findClosingBracket$1(cap[2], '()');\n\n        if (lastParenIndex > -1) {\n          var start = cap[0].indexOf('!') === 0 ? 5 : 4;\n          var linkLen = start + cap[1].length + lastParenIndex;\n          cap[2] = cap[2].substring(0, lastParenIndex);\n          cap[0] = cap[0].substring(0, linkLen).trim();\n          cap[3] = '';\n        }\n\n        var href = cap[2];\n        var title = '';\n\n        if (this.options.pedantic) {\n          var link = /^([^'\"]*[^\\s])\\s+(['\"])(.*)\\2/.exec(href);\n\n          if (link) {\n            href = link[1];\n            title = link[3];\n          } else {\n            title = '';\n          }\n        } else {\n          title = cap[3] ? cap[3].slice(1, -1) : '';\n        }\n\n        href = href.trim().replace(/^<([\\s\\S]*)>$/, '$1');\n        var token = outputLink(cap, {\n          href: href ? href.replace(this.rules.inline._escapes, '$1') : href,\n          title: title ? title.replace(this.rules.inline._escapes, '$1') : title\n        }, cap[0]);\n        return token;\n      }\n    };\n\n    _proto.reflink = function reflink(src, links) {\n      var cap;\n\n      if ((cap = this.rules.inline.reflink.exec(src)) || (cap = this.rules.inline.nolink.exec(src))) {\n        var link = (cap[2] || cap[1]).replace(/\\s+/g, ' ');\n        link = links[link.toLowerCase()];\n\n        if (!link || !link.href) {\n          var text = cap[0].charAt(0);\n          return {\n            type: 'text',\n            raw: text,\n            text: text\n          };\n        }\n\n        var token = outputLink(cap, link, cap[0]);\n        return token;\n      }\n    };\n\n    _proto.strong = function strong(src, maskedSrc, prevChar) {\n      if (prevChar === void 0) {\n        prevChar = '';\n      }\n\n      var match = this.rules.inline.strong.start.exec(src);\n\n      if (match && (!match[1] || match[1] && (prevChar === '' || this.rules.inline.punctuation.exec(prevChar)))) {\n        maskedSrc = maskedSrc.slice(-1 * src.length);\n        var endReg = match[0] === '**' ? this.rules.inline.strong.endAst : this.rules.inline.strong.endUnd;\n        endReg.lastIndex = 0;\n        var cap;\n\n        while ((match = endReg.exec(maskedSrc)) != null) {\n          cap = this.rules.inline.strong.middle.exec(maskedSrc.slice(0, match.index + 3));\n\n          if (cap) {\n            return {\n              type: 'strong',\n              raw: src.slice(0, cap[0].length),\n              text: src.slice(2, cap[0].length - 2)\n            };\n          }\n        }\n      }\n    };\n\n    _proto.em = function em(src, maskedSrc, prevChar) {\n      if (prevChar === void 0) {\n        prevChar = '';\n      }\n\n      var match = this.rules.inline.em.start.exec(src);\n\n      if (match && (!match[1] || match[1] && (prevChar === '' || this.rules.inline.punctuation.exec(prevChar)))) {\n        maskedSrc = maskedSrc.slice(-1 * src.length);\n        var endReg = match[0] === '*' ? this.rules.inline.em.endAst : this.rules.inline.em.endUnd;\n        endReg.lastIndex = 0;\n        var cap;\n\n        while ((match = endReg.exec(maskedSrc)) != null) {\n          cap = this.rules.inline.em.middle.exec(maskedSrc.slice(0, match.index + 2));\n\n          if (cap) {\n            return {\n              type: 'em',\n              raw: src.slice(0, cap[0].length),\n              text: src.slice(1, cap[0].length - 1)\n            };\n          }\n        }\n      }\n    };\n\n    _proto.codespan = function codespan(src) {\n      var cap = this.rules.inline.code.exec(src);\n\n      if (cap) {\n        var text = cap[2].replace(/\\n/g, ' ');\n        var hasNonSpaceChars = /[^ ]/.test(text);\n        var hasSpaceCharsOnBothEnds = text.startsWith(' ') && text.endsWith(' ');\n\n        if (hasNonSpaceChars && hasSpaceCharsOnBothEnds) {\n          text = text.substring(1, text.length - 1);\n        }\n\n        text = _escape(text, true);\n        return {\n          type: 'codespan',\n          raw: cap[0],\n          text: text\n        };\n      }\n    };\n\n    _proto.br = function br(src) {\n      var cap = this.rules.inline.br.exec(src);\n\n      if (cap) {\n        return {\n          type: 'br',\n          raw: cap[0]\n        };\n      }\n    };\n\n    _proto.del = function del(src) {\n      var cap = this.rules.inline.del.exec(src);\n\n      if (cap) {\n        return {\n          type: 'del',\n          raw: cap[0],\n          text: cap[1]\n        };\n      }\n    };\n\n    _proto.autolink = function autolink(src, mangle) {\n      var cap = this.rules.inline.autolink.exec(src);\n\n      if (cap) {\n        var text, href;\n\n        if (cap[2] === '@') {\n          text = _escape(this.options.mangle ? mangle(cap[1]) : cap[1]);\n          href = 'mailto:' + text;\n        } else {\n          text = _escape(cap[1]);\n          href = text;\n        }\n\n        return {\n          type: 'link',\n          raw: cap[0],\n          text: text,\n          href: href,\n          tokens: [{\n            type: 'text',\n            raw: text,\n            text: text\n          }]\n        };\n      }\n    };\n\n    _proto.url = function url(src, mangle) {\n      var cap;\n\n      if (cap = this.rules.inline.url.exec(src)) {\n        var text, href;\n\n        if (cap[2] === '@') {\n          text = _escape(this.options.mangle ? mangle(cap[0]) : cap[0]);\n          href = 'mailto:' + text;\n        } else {\n          // do extended autolink path validation\n          var prevCapZero;\n\n          do {\n            prevCapZero = cap[0];\n            cap[0] = this.rules.inline._backpedal.exec(cap[0])[0];\n          } while (prevCapZero !== cap[0]);\n\n          text = _escape(cap[0]);\n\n          if (cap[1] === 'www.') {\n            href = 'http://' + text;\n          } else {\n            href = text;\n          }\n        }\n\n        return {\n          type: 'link',\n          raw: cap[0],\n          text: text,\n          href: href,\n          tokens: [{\n            type: 'text',\n            raw: text,\n            text: text\n          }]\n        };\n      }\n    };\n\n    _proto.inlineText = function inlineText(src, inRawBlock, smartypants) {\n      var cap = this.rules.inline.text.exec(src);\n\n      if (cap) {\n        var text;\n\n        if (inRawBlock) {\n          text = this.options.sanitize ? this.options.sanitizer ? this.options.sanitizer(cap[0]) : _escape(cap[0]) : cap[0];\n        } else {\n          text = _escape(this.options.smartypants ? smartypants(cap[0]) : cap[0]);\n        }\n\n        return {\n          type: 'text',\n          raw: cap[0],\n          text: text\n        };\n      }\n    };\n\n    return Tokenizer;\n  }();\n\n  var noopTest$1 = helpers.noopTest,\n      edit$1 = helpers.edit,\n      merge$1 = helpers.merge;\n  /**\n   * Block-Level Grammar\n   */\n\n  var block = {\n    newline: /^\\n+/,\n    code: /^( {4}[^\\n]+\\n*)+/,\n    fences: /^ {0,3}(`{3,}(?=[^`\\n]*\\n)|~{3,})([^\\n]*)\\n(?:|([\\s\\S]*?)\\n)(?: {0,3}\\1[~`]* *(?:\\n+|$)|$)/,\n    hr: /^ {0,3}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)/,\n    heading: /^ {0,3}(#{1,6}) +([^\\n]*?)(?: +#+)? *(?:\\n+|$)/,\n    blockquote: /^( {0,3}> ?(paragraph|[^\\n]*)(?:\\n|$))+/,\n    list: /^( {0,3})(bull) [\\s\\S]+?(?:hr|def|\\n{2,}(?! )(?!\\1bull )\\n*|\\s*$)/,\n    html: '^ {0,3}(?:' // optional indentation\n    + '<(script|pre|style)[\\\\s>][\\\\s\\\\S]*?(?:</\\\\1>[^\\\\n]*\\\\n+|$)' // (1)\n    + '|comment[^\\\\n]*(\\\\n+|$)' // (2)\n    + '|<\\\\?[\\\\s\\\\S]*?(?:\\\\?>\\\\n*|$)' // (3)\n    + '|<![A-Z][\\\\s\\\\S]*?(?:>\\\\n*|$)' // (4)\n    + '|<!\\\\[CDATA\\\\[[\\\\s\\\\S]*?(?:\\\\]\\\\]>\\\\n*|$)' // (5)\n    + '|</?(tag)(?: +|\\\\n|/?>)[\\\\s\\\\S]*?(?:\\\\n{2,}|$)' // (6)\n    + '|<(?!script|pre|style)([a-z][\\\\w-]*)(?:attribute)*? */?>(?=[ \\\\t]*(?:\\\\n|$))[\\\\s\\\\S]*?(?:\\\\n{2,}|$)' // (7) open tag\n    + '|</(?!script|pre|style)[a-z][\\\\w-]*\\\\s*>(?=[ \\\\t]*(?:\\\\n|$))[\\\\s\\\\S]*?(?:\\\\n{2,}|$)' // (7) closing tag\n    + ')',\n    def: /^ {0,3}\\[(label)\\]: *\\n? *<?([^\\s>]+)>?(?:(?: +\\n? *| *\\n *)(title))? *(?:\\n+|$)/,\n    nptable: noopTest$1,\n    table: noopTest$1,\n    lheading: /^([^\\n]+)\\n {0,3}(=+|-+) *(?:\\n+|$)/,\n    // regex template, placeholders will be replaced according to different paragraph\n    // interruption rules of commonmark and the original markdown spec:\n    _paragraph: /^([^\\n]+(?:\\n(?!hr|heading|lheading|blockquote|fences|list|html)[^\\n]+)*)/,\n    text: /^[^\\n]+/\n  };\n  block._label = /(?!\\s*\\])(?:\\\\[\\[\\]]|[^\\[\\]])+/;\n  block._title = /(?:\"(?:\\\\\"?|[^\"\\\\])*\"|'[^'\\n]*(?:\\n[^'\\n]+)*\\n?'|\\([^()]*\\))/;\n  block.def = edit$1(block.def).replace('label', block._label).replace('title', block._title).getRegex();\n  block.bullet = /(?:[*+-]|\\d{1,9}[.)])/;\n  block.item = /^( *)(bull) ?[^\\n]*(?:\\n(?!\\1bull ?)[^\\n]*)*/;\n  block.item = edit$1(block.item, 'gm').replace(/bull/g, block.bullet).getRegex();\n  block.list = edit$1(block.list).replace(/bull/g, block.bullet).replace('hr', '\\\\n+(?=\\\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\\\* *){3,})(?:\\\\n+|$))').replace('def', '\\\\n+(?=' + block.def.source + ')').getRegex();\n  block._tag = 'address|article|aside|base|basefont|blockquote|body|caption' + '|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption' + '|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe' + '|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option' + '|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr' + '|track|ul';\n  block._comment = /<!--(?!-?>)[\\s\\S]*?(?:-->|$)/;\n  block.html = edit$1(block.html, 'i').replace('comment', block._comment).replace('tag', block._tag).replace('attribute', / +[a-zA-Z:_][\\w.:-]*(?: *= *\"[^\"\\n]*\"| *= *'[^'\\n]*'| *= *[^\\s\"'=<>`]+)?/).getRegex();\n  block.paragraph = edit$1(block._paragraph).replace('hr', block.hr).replace('heading', ' {0,3}#{1,6} ').replace('|lheading', '') // setex headings don't interrupt commonmark paragraphs\n  .replace('blockquote', ' {0,3}>').replace('fences', ' {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n').replace('list', ' {0,3}(?:[*+-]|1[.)]) ') // only lists starting from 1 can interrupt\n  .replace('html', '</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|!--)').replace('tag', block._tag) // pars can be interrupted by type (6) html blocks\n  .getRegex();\n  block.blockquote = edit$1(block.blockquote).replace('paragraph', block.paragraph).getRegex();\n  /**\n   * Normal Block Grammar\n   */\n\n  block.normal = merge$1({}, block);\n  /**\n   * GFM Block Grammar\n   */\n\n  block.gfm = merge$1({}, block.normal, {\n    nptable: '^ *([^|\\\\n ].*\\\\|.*)\\\\n' // Header\n    + ' {0,3}([-:]+ *\\\\|[-| :]*)' // Align\n    + '(?:\\\\n((?:(?!\\\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\\\n|$))*)\\\\n*|$)',\n    // Cells\n    table: '^ *\\\\|(.+)\\\\n' // Header\n    + ' {0,3}\\\\|?( *[-:]+[-| :]*)' // Align\n    + '(?:\\\\n *((?:(?!\\\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\\\n|$))*)\\\\n*|$)' // Cells\n\n  });\n  block.gfm.nptable = edit$1(block.gfm.nptable).replace('hr', block.hr).replace('heading', ' {0,3}#{1,6} ').replace('blockquote', ' {0,3}>').replace('code', ' {4}[^\\\\n]').replace('fences', ' {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n').replace('list', ' {0,3}(?:[*+-]|1[.)]) ') // only lists starting from 1 can interrupt\n  .replace('html', '</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|!--)').replace('tag', block._tag) // tables can be interrupted by type (6) html blocks\n  .getRegex();\n  block.gfm.table = edit$1(block.gfm.table).replace('hr', block.hr).replace('heading', ' {0,3}#{1,6} ').replace('blockquote', ' {0,3}>').replace('code', ' {4}[^\\\\n]').replace('fences', ' {0,3}(?:`{3,}(?=[^`\\\\n]*\\\\n)|~{3,})[^\\\\n]*\\\\n').replace('list', ' {0,3}(?:[*+-]|1[.)]) ') // only lists starting from 1 can interrupt\n  .replace('html', '</?(?:tag)(?: +|\\\\n|/?>)|<(?:script|pre|style|!--)').replace('tag', block._tag) // tables can be interrupted by type (6) html blocks\n  .getRegex();\n  /**\n   * Pedantic grammar (original John Gruber's loose markdown specification)\n   */\n\n  block.pedantic = merge$1({}, block.normal, {\n    html: edit$1('^ *(?:comment *(?:\\\\n|\\\\s*$)' + '|<(tag)[\\\\s\\\\S]+?</\\\\1> *(?:\\\\n{2,}|\\\\s*$)' // closed tag\n    + '|<tag(?:\"[^\"]*\"|\\'[^\\']*\\'|\\\\s[^\\'\"/>\\\\s]*)*?/?> *(?:\\\\n{2,}|\\\\s*$))').replace('comment', block._comment).replace(/tag/g, '(?!(?:' + 'a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub' + '|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)' + '\\\\b)\\\\w+(?!:|[^\\\\w\\\\s@]*@)\\\\b').getRegex(),\n    def: /^ *\\[([^\\]]+)\\]: *<?([^\\s>]+)>?(?: +([\"(][^\\n]+[\")]))? *(?:\\n+|$)/,\n    heading: /^ *(#{1,6}) *([^\\n]+?) *(?:#+ *)?(?:\\n+|$)/,\n    fences: noopTest$1,\n    // fences not supported\n    paragraph: edit$1(block.normal._paragraph).replace('hr', block.hr).replace('heading', ' *#{1,6} *[^\\n]').replace('lheading', block.lheading).replace('blockquote', ' {0,3}>').replace('|fences', '').replace('|list', '').replace('|html', '').getRegex()\n  });\n  /**\n   * Inline-Level Grammar\n   */\n\n  var inline = {\n    escape: /^\\\\([!\"#$%&'()*+,\\-./:;<=>?@\\[\\]\\\\^_`{|}~])/,\n    autolink: /^<(scheme:[^\\s\\x00-\\x1f<>]*|email)>/,\n    url: noopTest$1,\n    tag: '^comment' + '|^</[a-zA-Z][\\\\w:-]*\\\\s*>' // self-closing tag\n    + '|^<[a-zA-Z][\\\\w-]*(?:attribute)*?\\\\s*/?>' // open tag\n    + '|^<\\\\?[\\\\s\\\\S]*?\\\\?>' // processing instruction, e.g. <?php ?>\n    + '|^<![a-zA-Z]+\\\\s[\\\\s\\\\S]*?>' // declaration, e.g. <!DOCTYPE html>\n    + '|^<!\\\\[CDATA\\\\[[\\\\s\\\\S]*?\\\\]\\\\]>',\n    // CDATA section\n    link: /^!?\\[(label)\\]\\(\\s*(href)(?:\\s+(title))?\\s*\\)/,\n    reflink: /^!?\\[(label)\\]\\[(?!\\s*\\])((?:\\\\[\\[\\]]?|[^\\[\\]\\\\])+)\\]/,\n    nolink: /^!?\\[(?!\\s*\\])((?:\\[[^\\[\\]]*\\]|\\\\[\\[\\]]|[^\\[\\]])*)\\](?:\\[\\])?/,\n    reflinkSearch: 'reflink|nolink(?!\\\\()',\n    strong: {\n      start: /^(?:(\\*\\*(?=[*punctuation]))|\\*\\*)(?![\\s])|__/,\n      // (1) returns if starts w/ punctuation\n      middle: /^\\*\\*(?:(?:(?!overlapSkip)(?:[^*]|\\\\\\*)|overlapSkip)|\\*(?:(?!overlapSkip)(?:[^*]|\\\\\\*)|overlapSkip)*?\\*)+?\\*\\*$|^__(?![\\s])((?:(?:(?!overlapSkip)(?:[^_]|\\\\_)|overlapSkip)|_(?:(?!overlapSkip)(?:[^_]|\\\\_)|overlapSkip)*?_)+?)__$/,\n      endAst: /[^punctuation\\s]\\*\\*(?!\\*)|[punctuation]\\*\\*(?!\\*)(?:(?=[punctuation_\\s]|$))/,\n      // last char can't be punct, or final * must also be followed by punct (or endline)\n      endUnd: /[^\\s]__(?!_)(?:(?=[punctuation*\\s])|$)/ // last char can't be a space, and final _ must preceed punct or \\s (or endline)\n\n    },\n    em: {\n      start: /^(?:(\\*(?=[punctuation]))|\\*)(?![*\\s])|_/,\n      // (1) returns if starts w/ punctuation\n      middle: /^\\*(?:(?:(?!overlapSkip)(?:[^*]|\\\\\\*)|overlapSkip)|\\*(?:(?!overlapSkip)(?:[^*]|\\\\\\*)|overlapSkip)*?\\*)+?\\*$|^_(?![_\\s])(?:(?:(?!overlapSkip)(?:[^_]|\\\\_)|overlapSkip)|_(?:(?!overlapSkip)(?:[^_]|\\\\_)|overlapSkip)*?_)+?_$/,\n      endAst: /[^punctuation\\s]\\*(?!\\*)|[punctuation]\\*(?!\\*)(?:(?=[punctuation_\\s]|$))/,\n      // last char can't be punct, or final * must also be followed by punct (or endline)\n      endUnd: /[^\\s]_(?!_)(?:(?=[punctuation*\\s])|$)/ // last char can't be a space, and final _ must preceed punct or \\s (or endline)\n\n    },\n    code: /^(`+)([^`]|[^`][\\s\\S]*?[^`])\\1(?!`)/,\n    br: /^( {2,}|\\\\)\\n(?!\\s*$)/,\n    del: noopTest$1,\n    text: /^(`+|[^`])(?:(?= {2,}\\n)|[\\s\\S]*?(?:(?=[\\\\<!\\[`*]|\\b_|$)|[^ ](?= {2,}\\n)))/,\n    punctuation: /^([\\s*punctuation])/\n  }; // list of punctuation marks from common mark spec\n  // without * and _ to workaround cases with double emphasis\n\n  inline._punctuation = '!\"#$%&\\'()+\\\\-.,/:;<=>?@\\\\[\\\\]`^{|}~';\n  inline.punctuation = edit$1(inline.punctuation).replace(/punctuation/g, inline._punctuation).getRegex(); // sequences em should skip over [title](link), `code`, <html>\n\n  inline._blockSkip = '\\\\[[^\\\\]]*?\\\\]\\\\([^\\\\)]*?\\\\)|`[^`]*?`|<[^>]*?>';\n  inline._overlapSkip = '__[^_]*?__|\\\\*\\\\*\\\\[^\\\\*\\\\]*?\\\\*\\\\*';\n  inline._comment = edit$1(block._comment).replace('(?:-->|$)', '-->').getRegex();\n  inline.em.start = edit$1(inline.em.start).replace(/punctuation/g, inline._punctuation).getRegex();\n  inline.em.middle = edit$1(inline.em.middle).replace(/punctuation/g, inline._punctuation).replace(/overlapSkip/g, inline._overlapSkip).getRegex();\n  inline.em.endAst = edit$1(inline.em.endAst, 'g').replace(/punctuation/g, inline._punctuation).getRegex();\n  inline.em.endUnd = edit$1(inline.em.endUnd, 'g').replace(/punctuation/g, inline._punctuation).getRegex();\n  inline.strong.start = edit$1(inline.strong.start).replace(/punctuation/g, inline._punctuation).getRegex();\n  inline.strong.middle = edit$1(inline.strong.middle).replace(/punctuation/g, inline._punctuation).replace(/overlapSkip/g, inline._overlapSkip).getRegex();\n  inline.strong.endAst = edit$1(inline.strong.endAst, 'g').replace(/punctuation/g, inline._punctuation).getRegex();\n  inline.strong.endUnd = edit$1(inline.strong.endUnd, 'g').replace(/punctuation/g, inline._punctuation).getRegex();\n  inline.blockSkip = edit$1(inline._blockSkip, 'g').getRegex();\n  inline.overlapSkip = edit$1(inline._overlapSkip, 'g').getRegex();\n  inline._escapes = /\\\\([!\"#$%&'()*+,\\-./:;<=>?@\\[\\]\\\\^_`{|}~])/g;\n  inline._scheme = /[a-zA-Z][a-zA-Z0-9+.-]{1,31}/;\n  inline._email = /[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/;\n  inline.autolink = edit$1(inline.autolink).replace('scheme', inline._scheme).replace('email', inline._email).getRegex();\n  inline._attribute = /\\s+[a-zA-Z:_][\\w.:-]*(?:\\s*=\\s*\"[^\"]*\"|\\s*=\\s*'[^']*'|\\s*=\\s*[^\\s\"'=<>`]+)?/;\n  inline.tag = edit$1(inline.tag).replace('comment', inline._comment).replace('attribute', inline._attribute).getRegex();\n  inline._label = /(?:\\[(?:\\\\.|[^\\[\\]\\\\])*\\]|\\\\.|`[^`]*`|[^\\[\\]\\\\`])*?/;\n  inline._href = /<(?:\\\\[<>]?|[^\\s<>\\\\])*>|[^\\s\\x00-\\x1f]*/;\n  inline._title = /\"(?:\\\\\"?|[^\"\\\\])*\"|'(?:\\\\'?|[^'\\\\])*'|\\((?:\\\\\\)?|[^)\\\\])*\\)/;\n  inline.link = edit$1(inline.link).replace('label', inline._label).replace('href', inline._href).replace('title', inline._title).getRegex();\n  inline.reflink = edit$1(inline.reflink).replace('label', inline._label).getRegex();\n  inline.reflinkSearch = edit$1(inline.reflinkSearch, 'g').replace('reflink', inline.reflink).replace('nolink', inline.nolink).getRegex();\n  /**\n   * Normal Inline Grammar\n   */\n\n  inline.normal = merge$1({}, inline);\n  /**\n   * Pedantic Inline Grammar\n   */\n\n  inline.pedantic = merge$1({}, inline.normal, {\n    strong: {\n      start: /^__|\\*\\*/,\n      middle: /^__(?=\\S)([\\s\\S]*?\\S)__(?!_)|^\\*\\*(?=\\S)([\\s\\S]*?\\S)\\*\\*(?!\\*)/,\n      endAst: /\\*\\*(?!\\*)/g,\n      endUnd: /__(?!_)/g\n    },\n    em: {\n      start: /^_|\\*/,\n      middle: /^()\\*(?=\\S)([\\s\\S]*?\\S)\\*(?!\\*)|^_(?=\\S)([\\s\\S]*?\\S)_(?!_)/,\n      endAst: /\\*(?!\\*)/g,\n      endUnd: /_(?!_)/g\n    },\n    link: edit$1(/^!?\\[(label)\\]\\((.*?)\\)/).replace('label', inline._label).getRegex(),\n    reflink: edit$1(/^!?\\[(label)\\]\\s*\\[([^\\]]*)\\]/).replace('label', inline._label).getRegex()\n  });\n  /**\n   * GFM Inline Grammar\n   */\n\n  inline.gfm = merge$1({}, inline.normal, {\n    escape: edit$1(inline.escape).replace('])', '~|])').getRegex(),\n    _extended_email: /[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,\n    url: /^((?:ftp|https?):\\/\\/|www\\.)(?:[a-zA-Z0-9\\-]+\\.?)+[^\\s<]*|^email/,\n    _backpedal: /(?:[^?!.,:;*_~()&]+|\\([^)]*\\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_~)]+(?!$))+/,\n    del: /^~+(?=\\S)([\\s\\S]*?\\S)~+/,\n    text: /^(`+|[^`])(?:(?= {2,}\\n)|[\\s\\S]*?(?:(?=[\\\\<!\\[`*~]|\\b_|https?:\\/\\/|ftp:\\/\\/|www\\.|$)|[^ ](?= {2,}\\n)|[^a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-](?=[a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-]+@))|(?=[a-zA-Z0-9.!#$%&'*+\\/=?_`{\\|}~-]+@))/\n  });\n  inline.gfm.url = edit$1(inline.gfm.url, 'i').replace('email', inline.gfm._extended_email).getRegex();\n  /**\n   * GFM + Line Breaks Inline Grammar\n   */\n\n  inline.breaks = merge$1({}, inline.gfm, {\n    br: edit$1(inline.br).replace('{2,}', '*').getRegex(),\n    text: edit$1(inline.gfm.text).replace('\\\\b_', '\\\\b_| {2,}\\\\n').replace(/\\{2,\\}/g, '*').getRegex()\n  });\n  var rules = {\n    block: block,\n    inline: inline\n  };\n\n  var defaults$2 = defaults.defaults;\n  var block$1 = rules.block,\n      inline$1 = rules.inline;\n  var repeatString$1 = helpers.repeatString;\n  /**\n   * smartypants text replacement\n   */\n\n  function smartypants(text) {\n    return text // em-dashes\n    .replace(/---/g, \"\\u2014\") // en-dashes\n    .replace(/--/g, \"\\u2013\") // opening singles\n    .replace(/(^|[-\\u2014/(\\[{\"\\s])'/g, \"$1\\u2018\") // closing singles & apostrophes\n    .replace(/'/g, \"\\u2019\") // opening doubles\n    .replace(/(^|[-\\u2014/(\\[{\\u2018\\s])\"/g, \"$1\\u201C\") // closing doubles\n    .replace(/\"/g, \"\\u201D\") // ellipses\n    .replace(/\\.{3}/g, \"\\u2026\");\n  }\n  /**\n   * mangle email addresses\n   */\n\n\n  function mangle(text) {\n    var out = '',\n        i,\n        ch;\n    var l = text.length;\n\n    for (i = 0; i < l; i++) {\n      ch = text.charCodeAt(i);\n\n      if (Math.random() > 0.5) {\n        ch = 'x' + ch.toString(16);\n      }\n\n      out += '&#' + ch + ';';\n    }\n\n    return out;\n  }\n  /**\n   * Block Lexer\n   */\n\n\n  var Lexer_1 = /*#__PURE__*/function () {\n    function Lexer(options) {\n      this.tokens = [];\n      this.tokens.links = Object.create(null);\n      this.options = options || defaults$2;\n      this.options.tokenizer = this.options.tokenizer || new Tokenizer_1();\n      this.tokenizer = this.options.tokenizer;\n      this.tokenizer.options = this.options;\n      var rules = {\n        block: block$1.normal,\n        inline: inline$1.normal\n      };\n\n      if (this.options.pedantic) {\n        rules.block = block$1.pedantic;\n        rules.inline = inline$1.pedantic;\n      } else if (this.options.gfm) {\n        rules.block = block$1.gfm;\n\n        if (this.options.breaks) {\n          rules.inline = inline$1.breaks;\n        } else {\n          rules.inline = inline$1.gfm;\n        }\n      }\n\n      this.tokenizer.rules = rules;\n    }\n    /**\n     * Expose Rules\n     */\n\n\n    /**\n     * Static Lex Method\n     */\n    Lexer.lex = function lex(src, options) {\n      var lexer = new Lexer(options);\n      return lexer.lex(src);\n    }\n    /**\n     * Static Lex Inline Method\n     */\n    ;\n\n    Lexer.lexInline = function lexInline(src, options) {\n      var lexer = new Lexer(options);\n      return lexer.inlineTokens(src);\n    }\n    /**\n     * Preprocessing\n     */\n    ;\n\n    var _proto = Lexer.prototype;\n\n    _proto.lex = function lex(src) {\n      src = src.replace(/\\r\\n|\\r/g, '\\n').replace(/\\t/g, '    ');\n      this.blockTokens(src, this.tokens, true);\n      this.inline(this.tokens);\n      return this.tokens;\n    }\n    /**\n     * Lexing\n     */\n    ;\n\n    _proto.blockTokens = function blockTokens(src, tokens, top) {\n      if (tokens === void 0) {\n        tokens = [];\n      }\n\n      if (top === void 0) {\n        top = true;\n      }\n\n      src = src.replace(/^ +$/gm, '');\n      var token, i, l, lastToken;\n\n      while (src) {\n        // newline\n        if (token = this.tokenizer.space(src)) {\n          src = src.substring(token.raw.length);\n\n          if (token.type) {\n            tokens.push(token);\n          }\n\n          continue;\n        } // code\n\n\n        if (token = this.tokenizer.code(src, tokens)) {\n          src = src.substring(token.raw.length);\n\n          if (token.type) {\n            tokens.push(token);\n          } else {\n            lastToken = tokens[tokens.length - 1];\n            lastToken.raw += '\\n' + token.raw;\n            lastToken.text += '\\n' + token.text;\n          }\n\n          continue;\n        } // fences\n\n\n        if (token = this.tokenizer.fences(src)) {\n          src = src.substring(token.raw.length);\n          tokens.push(token);\n          continue;\n        } // heading\n\n\n        if (token = this.tokenizer.heading(src)) {\n          src = src.substring(token.raw.length);\n          tokens.push(token);\n          continue;\n        } // table no leading pipe (gfm)\n\n\n        if (token = this.tokenizer.nptable(src)) {\n          src = src.substring(token.raw.length);\n          tokens.push(token);\n          continue;\n        } // hr\n\n\n        if (token = this.tokenizer.hr(src)) {\n          src = src.substring(token.raw.length);\n          tokens.push(token);\n          continue;\n        } // blockquote\n\n\n        if (token = this.tokenizer.blockquote(src)) {\n          src = src.substring(token.raw.length);\n          token.tokens = this.blockTokens(token.text, [], top);\n          tokens.push(token);\n          continue;\n        } // list\n\n\n        if (token = this.tokenizer.list(src)) {\n          src = src.substring(token.raw.length);\n          l = token.items.length;\n\n          for (i = 0; i < l; i++) {\n            token.items[i].tokens = this.blockTokens(token.items[i].text, [], false);\n          }\n\n          tokens.push(token);\n          continue;\n        } // html\n\n\n        if (token = this.tokenizer.html(src)) {\n          src = src.substring(token.raw.length);\n          tokens.push(token);\n          continue;\n        } // def\n\n\n        if (top && (token = this.tokenizer.def(src))) {\n          src = src.substring(token.raw.length);\n\n          if (!this.tokens.links[token.tag]) {\n            this.tokens.links[token.tag] = {\n              href: token.href,\n              title: token.title\n            };\n          }\n\n          continue;\n        } // table (gfm)\n\n\n        if (token = this.tokenizer.table(src)) {\n          src = src.substring(token.raw.length);\n          tokens.push(token);\n          continue;\n        } // lheading\n\n\n        if (token = this.tokenizer.lheading(src)) {\n          src = src.substring(token.raw.length);\n          tokens.push(token);\n          continue;\n        } // top-level paragraph\n\n\n        if (top && (token = this.tokenizer.paragraph(src))) {\n          src = src.substring(token.raw.length);\n          tokens.push(token);\n          continue;\n        } // text\n\n\n        if (token = this.tokenizer.text(src, tokens)) {\n          src = src.substring(token.raw.length);\n\n          if (token.type) {\n            tokens.push(token);\n          } else {\n            lastToken = tokens[tokens.length - 1];\n            lastToken.raw += '\\n' + token.raw;\n            lastToken.text += '\\n' + token.text;\n          }\n\n          continue;\n        }\n\n        if (src) {\n          var errMsg = 'Infinite loop on byte: ' + src.charCodeAt(0);\n\n          if (this.options.silent) {\n            console.error(errMsg);\n            break;\n          } else {\n            throw new Error(errMsg);\n          }\n        }\n      }\n\n      return tokens;\n    };\n\n    _proto.inline = function inline(tokens) {\n      var i, j, k, l2, row, token;\n      var l = tokens.length;\n\n      for (i = 0; i < l; i++) {\n        token = tokens[i];\n\n        switch (token.type) {\n          case 'paragraph':\n          case 'text':\n          case 'heading':\n            {\n              token.tokens = [];\n              this.inlineTokens(token.text, token.tokens);\n              break;\n            }\n\n          case 'table':\n            {\n              token.tokens = {\n                header: [],\n                cells: []\n              }; // header\n\n              l2 = token.header.length;\n\n              for (j = 0; j < l2; j++) {\n                token.tokens.header[j] = [];\n                this.inlineTokens(token.header[j], token.tokens.header[j]);\n              } // cells\n\n\n              l2 = token.cells.length;\n\n              for (j = 0; j < l2; j++) {\n                row = token.cells[j];\n                token.tokens.cells[j] = [];\n\n                for (k = 0; k < row.length; k++) {\n                  token.tokens.cells[j][k] = [];\n                  this.inlineTokens(row[k], token.tokens.cells[j][k]);\n                }\n              }\n\n              break;\n            }\n\n          case 'blockquote':\n            {\n              this.inline(token.tokens);\n              break;\n            }\n\n          case 'list':\n            {\n              l2 = token.items.length;\n\n              for (j = 0; j < l2; j++) {\n                this.inline(token.items[j].tokens);\n              }\n\n              break;\n            }\n        }\n      }\n\n      return tokens;\n    }\n    /**\n     * Lexing/Compiling\n     */\n    ;\n\n    _proto.inlineTokens = function inlineTokens(src, tokens, inLink, inRawBlock, prevChar) {\n      if (tokens === void 0) {\n        tokens = [];\n      }\n\n      if (inLink === void 0) {\n        inLink = false;\n      }\n\n      if (inRawBlock === void 0) {\n        inRawBlock = false;\n      }\n\n      if (prevChar === void 0) {\n        prevChar = '';\n      }\n\n      var token; // String with links masked to avoid interference with em and strong\n\n      var maskedSrc = src;\n      var match; // Mask out reflinks\n\n      if (this.tokens.links) {\n        var links = Object.keys(this.tokens.links);\n\n        if (links.length > 0) {\n          while ((match = this.tokenizer.rules.inline.reflinkSearch.exec(maskedSrc)) != null) {\n            if (links.includes(match[0].slice(match[0].lastIndexOf('[') + 1, -1))) {\n              maskedSrc = maskedSrc.slice(0, match.index) + '[' + repeatString$1('a', match[0].length - 2) + ']' + maskedSrc.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex);\n            }\n          }\n        }\n      } // Mask out other blocks\n\n\n      while ((match = this.tokenizer.rules.inline.blockSkip.exec(maskedSrc)) != null) {\n        maskedSrc = maskedSrc.slice(0, match.index) + '[' + repeatString$1('a', match[0].length - 2) + ']' + maskedSrc.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);\n      }\n\n      while (src) {\n        // escape\n        if (token = this.tokenizer.escape(src)) {\n          src = src.substring(token.raw.length);\n          tokens.push(token);\n          continue;\n        } // tag\n\n\n        if (token = this.tokenizer.tag(src, inLink, inRawBlock)) {\n          src = src.substring(token.raw.length);\n          inLink = token.inLink;\n          inRawBlock = token.inRawBlock;\n          tokens.push(token);\n          continue;\n        } // link\n\n\n        if (token = this.tokenizer.link(src)) {\n          src = src.substring(token.raw.length);\n\n          if (token.type === 'link') {\n            token.tokens = this.inlineTokens(token.text, [], true, inRawBlock);\n          }\n\n          tokens.push(token);\n          continue;\n        } // reflink, nolink\n\n\n        if (token = this.tokenizer.reflink(src, this.tokens.links)) {\n          src = src.substring(token.raw.length);\n\n          if (token.type === 'link') {\n            token.tokens = this.inlineTokens(token.text, [], true, inRawBlock);\n          }\n\n          tokens.push(token);\n          continue;\n        } // strong\n\n\n        if (token = this.tokenizer.strong(src, maskedSrc, prevChar)) {\n          src = src.substring(token.raw.length);\n          token.tokens = this.inlineTokens(token.text, [], inLink, inRawBlock);\n          tokens.push(token);\n          continue;\n        } // em\n\n\n        if (token = this.tokenizer.em(src, maskedSrc, prevChar)) {\n          src = src.substring(token.raw.length);\n          token.tokens = this.inlineTokens(token.text, [], inLink, inRawBlock);\n          tokens.push(token);\n          continue;\n        } // code\n\n\n        if (token = this.tokenizer.codespan(src)) {\n          src = src.substring(token.raw.length);\n          tokens.push(token);\n          continue;\n        } // br\n\n\n        if (token = this.tokenizer.br(src)) {\n          src = src.substring(token.raw.length);\n          tokens.push(token);\n          continue;\n        } // del (gfm)\n\n\n        if (token = this.tokenizer.del(src)) {\n          src = src.substring(token.raw.length);\n          token.tokens = this.inlineTokens(token.text, [], inLink, inRawBlock);\n          tokens.push(token);\n          continue;\n        } // autolink\n\n\n        if (token = this.tokenizer.autolink(src, mangle)) {\n          src = src.substring(token.raw.length);\n          tokens.push(token);\n          continue;\n        } // url (gfm)\n\n\n        if (!inLink && (token = this.tokenizer.url(src, mangle))) {\n          src = src.substring(token.raw.length);\n          tokens.push(token);\n          continue;\n        } // text\n\n\n        if (token = this.tokenizer.inlineText(src, inRawBlock, smartypants)) {\n          src = src.substring(token.raw.length);\n          prevChar = token.raw.slice(-1);\n          tokens.push(token);\n          continue;\n        }\n\n        if (src) {\n          var errMsg = 'Infinite loop on byte: ' + src.charCodeAt(0);\n\n          if (this.options.silent) {\n            console.error(errMsg);\n            break;\n          } else {\n            throw new Error(errMsg);\n          }\n        }\n      }\n\n      return tokens;\n    };\n\n    _createClass(Lexer, null, [{\n      key: \"rules\",\n      get: function get() {\n        return {\n          block: block$1,\n          inline: inline$1\n        };\n      }\n    }]);\n\n    return Lexer;\n  }();\n\n  var defaults$3 = defaults.defaults;\n  var cleanUrl$1 = helpers.cleanUrl,\n      escape$1 = helpers.escape;\n  /**\n   * Renderer\n   */\n\n  var Renderer_1 = /*#__PURE__*/function () {\n    function Renderer(options) {\n      this.options = options || defaults$3;\n    }\n\n    var _proto = Renderer.prototype;\n\n    _proto.code = function code(_code, infostring, escaped) {\n      var lang = (infostring || '').match(/\\S*/)[0];\n\n      if (this.options.highlight) {\n        var out = this.options.highlight(_code, lang);\n\n        if (out != null && out !== _code) {\n          escaped = true;\n          _code = out;\n        }\n      }\n\n      if (!lang) {\n        return '<pre><code>' + (escaped ? _code : escape$1(_code, true)) + '</code></pre>\\n';\n      }\n\n      return '<pre><code class=\"' + this.options.langPrefix + escape$1(lang, true) + '\">' + (escaped ? _code : escape$1(_code, true)) + '</code></pre>\\n';\n    };\n\n    _proto.blockquote = function blockquote(quote) {\n      return '<blockquote>\\n' + quote + '</blockquote>\\n';\n    };\n\n    _proto.html = function html(_html) {\n      return _html;\n    };\n\n    _proto.heading = function heading(text, level, raw, slugger) {\n      if (this.options.headerIds) {\n        return '<h' + level + ' id=\"' + this.options.headerPrefix + slugger.slug(raw) + '\">' + text + '</h' + level + '>\\n';\n      } // ignore IDs\n\n\n      return '<h' + level + '>' + text + '</h' + level + '>\\n';\n    };\n\n    _proto.hr = function hr() {\n      return this.options.xhtml ? '<hr/>\\n' : '<hr>\\n';\n    };\n\n    _proto.list = function list(body, ordered, start) {\n      var type = ordered ? 'ol' : 'ul',\n          startatt = ordered && start !== 1 ? ' start=\"' + start + '\"' : '';\n      return '<' + type + startatt + '>\\n' + body + '</' + type + '>\\n';\n    };\n\n    _proto.listitem = function listitem(text) {\n      return '<li>' + text + '</li>\\n';\n    };\n\n    _proto.checkbox = function checkbox(checked) {\n      return '<input ' + (checked ? 'checked=\"\" ' : '') + 'disabled=\"\" type=\"checkbox\"' + (this.options.xhtml ? ' /' : '') + '> ';\n    };\n\n    _proto.paragraph = function paragraph(text) {\n      return '<p>' + text + '</p>\\n';\n    };\n\n    _proto.table = function table(header, body) {\n      if (body) body = '<tbody>' + body + '</tbody>';\n      return '<table>\\n' + '<thead>\\n' + header + '</thead>\\n' + body + '</table>\\n';\n    };\n\n    _proto.tablerow = function tablerow(content) {\n      return '<tr>\\n' + content + '</tr>\\n';\n    };\n\n    _proto.tablecell = function tablecell(content, flags) {\n      var type = flags.header ? 'th' : 'td';\n      var tag = flags.align ? '<' + type + ' align=\"' + flags.align + '\">' : '<' + type + '>';\n      return tag + content + '</' + type + '>\\n';\n    } // span level renderer\n    ;\n\n    _proto.strong = function strong(text) {\n      return '<strong>' + text + '</strong>';\n    };\n\n    _proto.em = function em(text) {\n      return '<em>' + text + '</em>';\n    };\n\n    _proto.codespan = function codespan(text) {\n      return '<code>' + text + '</code>';\n    };\n\n    _proto.br = function br() {\n      return this.options.xhtml ? '<br/>' : '<br>';\n    };\n\n    _proto.del = function del(text) {\n      return '<del>' + text + '</del>';\n    };\n\n    _proto.link = function link(href, title, text) {\n      href = cleanUrl$1(this.options.sanitize, this.options.baseUrl, href);\n\n      if (href === null) {\n        return text;\n      }\n\n      var out = '<a href=\"' + escape$1(href) + '\"';\n\n      if (title) {\n        out += ' title=\"' + title + '\"';\n      }\n\n      out += '>' + text + '</a>';\n      return out;\n    };\n\n    _proto.image = function image(href, title, text) {\n      href = cleanUrl$1(this.options.sanitize, this.options.baseUrl, href);\n\n      if (href === null) {\n        return text;\n      }\n\n      var out = '<img src=\"' + href + '\" alt=\"' + text + '\"';\n\n      if (title) {\n        out += ' title=\"' + title + '\"';\n      }\n\n      out += this.options.xhtml ? '/>' : '>';\n      return out;\n    };\n\n    _proto.text = function text(_text) {\n      return _text;\n    };\n\n    return Renderer;\n  }();\n\n  /**\n   * TextRenderer\n   * returns only the textual part of the token\n   */\n  var TextRenderer_1 = /*#__PURE__*/function () {\n    function TextRenderer() {}\n\n    var _proto = TextRenderer.prototype;\n\n    // no need for block level renderers\n    _proto.strong = function strong(text) {\n      return text;\n    };\n\n    _proto.em = function em(text) {\n      return text;\n    };\n\n    _proto.codespan = function codespan(text) {\n      return text;\n    };\n\n    _proto.del = function del(text) {\n      return text;\n    };\n\n    _proto.html = function html(text) {\n      return text;\n    };\n\n    _proto.text = function text(_text) {\n      return _text;\n    };\n\n    _proto.link = function link(href, title, text) {\n      return '' + text;\n    };\n\n    _proto.image = function image(href, title, text) {\n      return '' + text;\n    };\n\n    _proto.br = function br() {\n      return '';\n    };\n\n    return TextRenderer;\n  }();\n\n  /**\n   * Slugger generates header id\n   */\n  var Slugger_1 = /*#__PURE__*/function () {\n    function Slugger() {\n      this.seen = {};\n    }\n\n    var _proto = Slugger.prototype;\n\n    _proto.serialize = function serialize(value) {\n      return value.toLowerCase().trim() // remove html tags\n      .replace(/<[!\\/a-z].*?>/ig, '') // remove unwanted chars\n      .replace(/[\\u2000-\\u206F\\u2E00-\\u2E7F\\\\'!\"#$%&()*+,./:;<=>?@[\\]^`{|}~]/g, '').replace(/\\s/g, '-');\n    }\n    /**\n     * Finds the next safe (unique) slug to use\n     */\n    ;\n\n    _proto.getNextSafeSlug = function getNextSafeSlug(originalSlug, isDryRun) {\n      var slug = originalSlug;\n      var occurenceAccumulator = 0;\n\n      if (this.seen.hasOwnProperty(slug)) {\n        occurenceAccumulator = this.seen[originalSlug];\n\n        do {\n          occurenceAccumulator++;\n          slug = originalSlug + '-' + occurenceAccumulator;\n        } while (this.seen.hasOwnProperty(slug));\n      }\n\n      if (!isDryRun) {\n        this.seen[originalSlug] = occurenceAccumulator;\n        this.seen[slug] = 0;\n      }\n\n      return slug;\n    }\n    /**\n     * Convert string to unique id\n     * @param {object} options\n     * @param {boolean} options.dryrun Generates the next unique slug without updating the internal accumulator.\n     */\n    ;\n\n    _proto.slug = function slug(value, options) {\n      if (options === void 0) {\n        options = {};\n      }\n\n      var slug = this.serialize(value);\n      return this.getNextSafeSlug(slug, options.dryrun);\n    };\n\n    return Slugger;\n  }();\n\n  var defaults$4 = defaults.defaults;\n  var unescape$1 = helpers.unescape;\n  /**\n   * Parsing & Compiling\n   */\n\n  var Parser_1 = /*#__PURE__*/function () {\n    function Parser(options) {\n      this.options = options || defaults$4;\n      this.options.renderer = this.options.renderer || new Renderer_1();\n      this.renderer = this.options.renderer;\n      this.renderer.options = this.options;\n      this.textRenderer = new TextRenderer_1();\n      this.slugger = new Slugger_1();\n    }\n    /**\n     * Static Parse Method\n     */\n\n\n    Parser.parse = function parse(tokens, options) {\n      var parser = new Parser(options);\n      return parser.parse(tokens);\n    }\n    /**\n     * Static Parse Inline Method\n     */\n    ;\n\n    Parser.parseInline = function parseInline(tokens, options) {\n      var parser = new Parser(options);\n      return parser.parseInline(tokens);\n    }\n    /**\n     * Parse Loop\n     */\n    ;\n\n    var _proto = Parser.prototype;\n\n    _proto.parse = function parse(tokens, top) {\n      if (top === void 0) {\n        top = true;\n      }\n\n      var out = '',\n          i,\n          j,\n          k,\n          l2,\n          l3,\n          row,\n          cell,\n          header,\n          body,\n          token,\n          ordered,\n          start,\n          loose,\n          itemBody,\n          item,\n          checked,\n          task,\n          checkbox;\n      var l = tokens.length;\n\n      for (i = 0; i < l; i++) {\n        token = tokens[i];\n\n        switch (token.type) {\n          case 'space':\n            {\n              continue;\n            }\n\n          case 'hr':\n            {\n              out += this.renderer.hr();\n              continue;\n            }\n\n          case 'heading':\n            {\n              out += this.renderer.heading(this.parseInline(token.tokens), token.depth, unescape$1(this.parseInline(token.tokens, this.textRenderer)), this.slugger);\n              continue;\n            }\n\n          case 'code':\n            {\n              out += this.renderer.code(token.text, token.lang, token.escaped);\n              continue;\n            }\n\n          case 'table':\n            {\n              header = ''; // header\n\n              cell = '';\n              l2 = token.header.length;\n\n              for (j = 0; j < l2; j++) {\n                cell += this.renderer.tablecell(this.parseInline(token.tokens.header[j]), {\n                  header: true,\n                  align: token.align[j]\n                });\n              }\n\n              header += this.renderer.tablerow(cell);\n              body = '';\n              l2 = token.cells.length;\n\n              for (j = 0; j < l2; j++) {\n                row = token.tokens.cells[j];\n                cell = '';\n                l3 = row.length;\n\n                for (k = 0; k < l3; k++) {\n                  cell += this.renderer.tablecell(this.parseInline(row[k]), {\n                    header: false,\n                    align: token.align[k]\n                  });\n                }\n\n                body += this.renderer.tablerow(cell);\n              }\n\n              out += this.renderer.table(header, body);\n              continue;\n            }\n\n          case 'blockquote':\n            {\n              body = this.parse(token.tokens);\n              out += this.renderer.blockquote(body);\n              continue;\n            }\n\n          case 'list':\n            {\n              ordered = token.ordered;\n              start = token.start;\n              loose = token.loose;\n              l2 = token.items.length;\n              body = '';\n\n              for (j = 0; j < l2; j++) {\n                item = token.items[j];\n                checked = item.checked;\n                task = item.task;\n                itemBody = '';\n\n                if (item.task) {\n                  checkbox = this.renderer.checkbox(checked);\n\n                  if (loose) {\n                    if (item.tokens.length > 0 && item.tokens[0].type === 'text') {\n                      item.tokens[0].text = checkbox + ' ' + item.tokens[0].text;\n\n                      if (item.tokens[0].tokens && item.tokens[0].tokens.length > 0 && item.tokens[0].tokens[0].type === 'text') {\n                        item.tokens[0].tokens[0].text = checkbox + ' ' + item.tokens[0].tokens[0].text;\n                      }\n                    } else {\n                      item.tokens.unshift({\n                        type: 'text',\n                        text: checkbox\n                      });\n                    }\n                  } else {\n                    itemBody += checkbox;\n                  }\n                }\n\n                itemBody += this.parse(item.tokens, loose);\n                body += this.renderer.listitem(itemBody, task, checked);\n              }\n\n              out += this.renderer.list(body, ordered, start);\n              continue;\n            }\n\n          case 'html':\n            {\n              // TODO parse inline content if parameter markdown=1\n              out += this.renderer.html(token.text);\n              continue;\n            }\n\n          case 'paragraph':\n            {\n              out += this.renderer.paragraph(this.parseInline(token.tokens));\n              continue;\n            }\n\n          case 'text':\n            {\n              body = token.tokens ? this.parseInline(token.tokens) : token.text;\n\n              while (i + 1 < l && tokens[i + 1].type === 'text') {\n                token = tokens[++i];\n                body += '\\n' + (token.tokens ? this.parseInline(token.tokens) : token.text);\n              }\n\n              out += top ? this.renderer.paragraph(body) : body;\n              continue;\n            }\n\n          default:\n            {\n              var errMsg = 'Token with \"' + token.type + '\" type was not found.';\n\n              if (this.options.silent) {\n                console.error(errMsg);\n                return;\n              } else {\n                throw new Error(errMsg);\n              }\n            }\n        }\n      }\n\n      return out;\n    }\n    /**\n     * Parse Inline Tokens\n     */\n    ;\n\n    _proto.parseInline = function parseInline(tokens, renderer) {\n      renderer = renderer || this.renderer;\n      var out = '',\n          i,\n          token;\n      var l = tokens.length;\n\n      for (i = 0; i < l; i++) {\n        token = tokens[i];\n\n        switch (token.type) {\n          case 'escape':\n            {\n              out += renderer.text(token.text);\n              break;\n            }\n\n          case 'html':\n            {\n              out += renderer.html(token.text);\n              break;\n            }\n\n          case 'link':\n            {\n              out += renderer.link(token.href, token.title, this.parseInline(token.tokens, renderer));\n              break;\n            }\n\n          case 'image':\n            {\n              out += renderer.image(token.href, token.title, token.text);\n              break;\n            }\n\n          case 'strong':\n            {\n              out += renderer.strong(this.parseInline(token.tokens, renderer));\n              break;\n            }\n\n          case 'em':\n            {\n              out += renderer.em(this.parseInline(token.tokens, renderer));\n              break;\n            }\n\n          case 'codespan':\n            {\n              out += renderer.codespan(token.text);\n              break;\n            }\n\n          case 'br':\n            {\n              out += renderer.br();\n              break;\n            }\n\n          case 'del':\n            {\n              out += renderer.del(this.parseInline(token.tokens, renderer));\n              break;\n            }\n\n          case 'text':\n            {\n              out += renderer.text(token.text);\n              break;\n            }\n\n          default:\n            {\n              var errMsg = 'Token with \"' + token.type + '\" type was not found.';\n\n              if (this.options.silent) {\n                console.error(errMsg);\n                return;\n              } else {\n                throw new Error(errMsg);\n              }\n            }\n        }\n      }\n\n      return out;\n    };\n\n    return Parser;\n  }();\n\n  var merge$2 = helpers.merge,\n      checkSanitizeDeprecation$1 = helpers.checkSanitizeDeprecation,\n      escape$2 = helpers.escape;\n  var getDefaults = defaults.getDefaults,\n      changeDefaults = defaults.changeDefaults,\n      defaults$5 = defaults.defaults;\n  /**\n   * Marked\n   */\n\n  function marked(src, opt, callback) {\n    // throw error in case of non string input\n    if (typeof src === 'undefined' || src === null) {\n      throw new Error('marked(): input parameter is undefined or null');\n    }\n\n    if (typeof src !== 'string') {\n      throw new Error('marked(): input parameter is of type ' + Object.prototype.toString.call(src) + ', string expected');\n    }\n\n    if (typeof opt === 'function') {\n      callback = opt;\n      opt = null;\n    }\n\n    opt = merge$2({}, marked.defaults, opt || {});\n    checkSanitizeDeprecation$1(opt);\n\n    if (callback) {\n      var highlight = opt.highlight;\n      var tokens;\n\n      try {\n        tokens = Lexer_1.lex(src, opt);\n      } catch (e) {\n        return callback(e);\n      }\n\n      var done = function done(err) {\n        var out;\n\n        if (!err) {\n          try {\n            out = Parser_1.parse(tokens, opt);\n          } catch (e) {\n            err = e;\n          }\n        }\n\n        opt.highlight = highlight;\n        return err ? callback(err) : callback(null, out);\n      };\n\n      if (!highlight || highlight.length < 3) {\n        return done();\n      }\n\n      delete opt.highlight;\n      if (!tokens.length) return done();\n      var pending = 0;\n      marked.walkTokens(tokens, function (token) {\n        if (token.type === 'code') {\n          pending++;\n          setTimeout(function () {\n            highlight(token.text, token.lang, function (err, code) {\n              if (err) {\n                return done(err);\n              }\n\n              if (code != null && code !== token.text) {\n                token.text = code;\n                token.escaped = true;\n              }\n\n              pending--;\n\n              if (pending === 0) {\n                done();\n              }\n            });\n          }, 0);\n        }\n      });\n\n      if (pending === 0) {\n        done();\n      }\n\n      return;\n    }\n\n    try {\n      var _tokens = Lexer_1.lex(src, opt);\n\n      if (opt.walkTokens) {\n        marked.walkTokens(_tokens, opt.walkTokens);\n      }\n\n      return Parser_1.parse(_tokens, opt);\n    } catch (e) {\n      e.message += '\\nPlease report this to https://github.com/markedjs/marked.';\n\n      if (opt.silent) {\n        return '<p>An error occurred:</p><pre>' + escape$2(e.message + '', true) + '</pre>';\n      }\n\n      throw e;\n    }\n  }\n  /**\n   * Options\n   */\n\n\n  marked.options = marked.setOptions = function (opt) {\n    merge$2(marked.defaults, opt);\n    changeDefaults(marked.defaults);\n    return marked;\n  };\n\n  marked.getDefaults = getDefaults;\n  marked.defaults = defaults$5;\n  /**\n   * Use Extension\n   */\n\n  marked.use = function (extension) {\n    var opts = merge$2({}, extension);\n\n    if (extension.renderer) {\n      (function () {\n        var renderer = marked.defaults.renderer || new Renderer_1();\n\n        var _loop = function _loop(prop) {\n          var prevRenderer = renderer[prop];\n\n          renderer[prop] = function () {\n            for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n              args[_key] = arguments[_key];\n            }\n\n            var ret = extension.renderer[prop].apply(renderer, args);\n\n            if (ret === false) {\n              ret = prevRenderer.apply(renderer, args);\n            }\n\n            return ret;\n          };\n        };\n\n        for (var prop in extension.renderer) {\n          _loop(prop);\n        }\n\n        opts.renderer = renderer;\n      })();\n    }\n\n    if (extension.tokenizer) {\n      (function () {\n        var tokenizer = marked.defaults.tokenizer || new Tokenizer_1();\n\n        var _loop2 = function _loop2(prop) {\n          var prevTokenizer = tokenizer[prop];\n\n          tokenizer[prop] = function () {\n            for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n              args[_key2] = arguments[_key2];\n            }\n\n            var ret = extension.tokenizer[prop].apply(tokenizer, args);\n\n            if (ret === false) {\n              ret = prevTokenizer.apply(tokenizer, args);\n            }\n\n            return ret;\n          };\n        };\n\n        for (var prop in extension.tokenizer) {\n          _loop2(prop);\n        }\n\n        opts.tokenizer = tokenizer;\n      })();\n    }\n\n    if (extension.walkTokens) {\n      var walkTokens = marked.defaults.walkTokens;\n\n      opts.walkTokens = function (token) {\n        extension.walkTokens(token);\n\n        if (walkTokens) {\n          walkTokens(token);\n        }\n      };\n    }\n\n    marked.setOptions(opts);\n  };\n  /**\n   * Run callback for every token\n   */\n\n\n  marked.walkTokens = function (tokens, callback) {\n    for (var _iterator = _createForOfIteratorHelperLoose(tokens), _step; !(_step = _iterator()).done;) {\n      var token = _step.value;\n      callback(token);\n\n      switch (token.type) {\n        case 'table':\n          {\n            for (var _iterator2 = _createForOfIteratorHelperLoose(token.tokens.header), _step2; !(_step2 = _iterator2()).done;) {\n              var cell = _step2.value;\n              marked.walkTokens(cell, callback);\n            }\n\n            for (var _iterator3 = _createForOfIteratorHelperLoose(token.tokens.cells), _step3; !(_step3 = _iterator3()).done;) {\n              var row = _step3.value;\n\n              for (var _iterator4 = _createForOfIteratorHelperLoose(row), _step4; !(_step4 = _iterator4()).done;) {\n                var _cell = _step4.value;\n                marked.walkTokens(_cell, callback);\n              }\n            }\n\n            break;\n          }\n\n        case 'list':\n          {\n            marked.walkTokens(token.items, callback);\n            break;\n          }\n\n        default:\n          {\n            if (token.tokens) {\n              marked.walkTokens(token.tokens, callback);\n            }\n          }\n      }\n    }\n  };\n  /**\n   * Parse Inline\n   */\n\n\n  marked.parseInline = function (src, opt) {\n    // throw error in case of non string input\n    if (typeof src === 'undefined' || src === null) {\n      throw new Error('marked.parseInline(): input parameter is undefined or null');\n    }\n\n    if (typeof src !== 'string') {\n      throw new Error('marked.parseInline(): input parameter is of type ' + Object.prototype.toString.call(src) + ', string expected');\n    }\n\n    opt = merge$2({}, marked.defaults, opt || {});\n    checkSanitizeDeprecation$1(opt);\n\n    try {\n      var tokens = Lexer_1.lexInline(src, opt);\n\n      if (opt.walkTokens) {\n        marked.walkTokens(tokens, opt.walkTokens);\n      }\n\n      return Parser_1.parseInline(tokens, opt);\n    } catch (e) {\n      e.message += '\\nPlease report this to https://github.com/markedjs/marked.';\n\n      if (opt.silent) {\n        return '<p>An error occurred:</p><pre>' + escape$2(e.message + '', true) + '</pre>';\n      }\n\n      throw e;\n    }\n  };\n  /**\n   * Expose\n   */\n\n\n  marked.Parser = Parser_1;\n  marked.parser = Parser_1.parse;\n  marked.Renderer = Renderer_1;\n  marked.TextRenderer = TextRenderer_1;\n  marked.Lexer = Lexer_1;\n  marked.lexer = Lexer_1.lex;\n  marked.Tokenizer = Tokenizer_1;\n  marked.Slugger = Slugger_1;\n  marked.parse = marked;\n  var marked_1 = marked;\n\n  return marked_1;\n\n})));\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nexport function clamp(value: number, min: number, max: number): number {\n\treturn Math.min(Math.max(value, min), max);\n}\n\nexport function rot(index: number, modulo: number): number {\n\treturn (modulo + (index % modulo)) % modulo;\n}\n\nexport class Counter {\n\tprivate _next = 0;\n\n\tgetNext(): number {\n\t\treturn this._next++;\n\t}\n}\n\nexport class MovingAverage {\n\n\tprivate _n = 1;\n\tprivate _val = 0;\n\n\tupdate(value: number): this {\n\t\tthis._val = this._val + (value - this._val) / this._n;\n\t\tthis._n += 1;\n\t\treturn this;\n\t}\n\n\tget value(): number {\n\t\treturn this._val;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n'use strict';\n\n//@ts-check\n\n/**\n * @returns {{mark(name:string):void, getMarks():{name:string, startTime:number}[]}}\n */\nfunction _definePolyfillMarks(timeOrigin) {\n\n\tconst _data = [];\n\tif (typeof timeOrigin === 'number') {\n\t\t_data.push('code/timeOrigin', timeOrigin);\n\t}\n\n\tfunction mark(name) {\n\t\t_data.push(name, Date.now());\n\t}\n\tfunction getMarks() {\n\t\tconst result = [];\n\t\tfor (let i = 0; i < _data.length; i += 2) {\n\t\t\tresult.push({\n\t\t\t\tname: _data[i],\n\t\t\t\tstartTime: _data[i + 1],\n\t\t\t});\n\t\t}\n\t\treturn result;\n\t}\n\treturn { mark, getMarks };\n}\n\n/**\n * @returns {{mark(name:string):void, getMarks():{name:string, startTime:number}[]}}\n */\nfunction _define() {\n\n\tif (typeof performance === 'object' && typeof performance.mark === 'function') {\n\t\t// in a browser context, reuse performance-util\n\n\t\tif (typeof performance.timeOrigin !== 'number' && !performance.timing) {\n\t\t\t// safari & webworker: because there is no timeOrigin and no workaround\n\t\t\t// we use the `Date.now`-based polyfill.\n\t\t\treturn _definePolyfillMarks();\n\n\t\t} else {\n\t\t\t// use \"native\" performance for mark and getMarks\n\t\t\treturn {\n\t\t\t\tmark(name) {\n\t\t\t\t\tperformance.mark(name);\n\t\t\t\t},\n\t\t\t\tgetMarks() {\n\t\t\t\t\tlet timeOrigin = performance.timeOrigin;\n\t\t\t\t\tif (typeof timeOrigin !== 'number') {\n\t\t\t\t\t\t// safari: there is no timerOrigin but in renderers there is the timing-property\n\t\t\t\t\t\t// see https://bugs.webkit.org/show_bug.cgi?id=174862\n\t\t\t\t\t\ttimeOrigin = performance.timing.navigationStart || performance.timing.redirectStart || performance.timing.fetchStart;\n\t\t\t\t\t}\n\t\t\t\t\tconst result = [{ name: 'code/timeOrigin', startTime: Math.round(timeOrigin) }];\n\t\t\t\t\tfor (const entry of performance.getEntriesByType('mark')) {\n\t\t\t\t\t\tresult.push({\n\t\t\t\t\t\t\tname: entry.name,\n\t\t\t\t\t\t\tstartTime: Math.round(timeOrigin + entry.startTime)\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t} else if (typeof process === 'object') {\n\t\t// node.js: use the normal polyfill but add the timeOrigin\n\t\t// from the node perf_hooks API as very first mark\n\t\tconst timeOrigin = Math.round((require.nodeRequire || require)('perf_hooks').performance.timeOrigin);\n\t\treturn _definePolyfillMarks(timeOrigin);\n\n\t} else {\n\t\t// unknown environment\n\t\tconsole.trace('perf-util loaded in UNKNOWN environment');\n\t\treturn _definePolyfillMarks();\n\t}\n}\n\nfunction _factory(sharedObj) {\n\tif (!sharedObj.MonacoPerformanceMarks) {\n\t\tsharedObj.MonacoPerformanceMarks = _define();\n\t}\n\treturn sharedObj.MonacoPerformanceMarks;\n}\n\n// This module can be loaded in an amd and commonjs-context.\n// Because we want both instances to use the same perf-data\n// we store them globally\n\n// eslint-disable-next-line no-var\nvar sharedObj;\nif (typeof global === 'object') {\n\t// nodejs\n\tsharedObj = global;\n} else if (typeof self === 'object') {\n\t// browser\n\tsharedObj = self;\n} else {\n\tsharedObj = {};\n}\n\nif (typeof define === 'function') {\n\t// amd\n\tdefine(\"vs/base/common/performance\", [], function () { return _factory(sharedObj); });\n} else if (typeof module === 'object' && typeof module.exports === 'object') {\n\t// commonjs\n\tmodule.exports = _factory(sharedObj);\n} else {\n\tconsole.trace('perf-util defined in UNKNOWN context (neither requirejs or commonjs)');\n\tsharedObj.perf = _factory(sharedObj);\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nconst LANGUAGE_DEFAULT = 'en';\n\nlet _isWindows = false;\nlet _isMacintosh = false;\nlet _isLinux = false;\nlet _isLinuxSnap = false;\nlet _isNative = false;\nlet _isWeb = false;\nlet _isIOS = false;\nlet _locale: string | undefined = undefined;\nlet _language: string = LANGUAGE_DEFAULT;\nlet _translationsConfigFile: string | undefined = undefined;\nlet _userAgent: string | undefined = undefined;\n\ninterface NLSConfig {\n\tlocale: string;\n\tavailableLanguages: { [key: string]: string; };\n\t_translationsConfigFile: string;\n}\n\nexport interface IProcessEnvironment {\n\t[key: string]: string;\n}\n\nexport interface INodeProcess {\n\tplatform: 'win32' | 'linux' | 'darwin';\n\tenv: IProcessEnvironment;\n\tnextTick: Function;\n\tversions?: {\n\t\telectron?: string;\n\t};\n\tsandboxed?: boolean; // Electron\n\ttype?: string;\n\tcwd(): string;\n}\ndeclare const process: INodeProcess;\ndeclare const global: any;\n\ninterface INavigator {\n\tuserAgent: string;\n\tlanguage: string;\n\tmaxTouchPoints?: number;\n}\ndeclare const navigator: INavigator;\ndeclare const self: any;\n\nconst _globals = (typeof self === 'object' ? self : typeof global === 'object' ? global : {} as any);\n\nlet nodeProcess: INodeProcess | undefined = undefined;\nif (typeof process !== 'undefined') {\n\t// Native environment (non-sandboxed)\n\tnodeProcess = process;\n} else if (typeof _globals.vscode !== 'undefined') {\n\t// Native environment (sandboxed)\n\tnodeProcess = _globals.vscode.process;\n}\n\nconst isElectronRenderer = typeof nodeProcess?.versions?.electron === 'string' && nodeProcess.type === 'renderer';\nexport const isElectronSandboxed = isElectronRenderer && nodeProcess?.sandboxed;\nexport const browserCodeLoadingCacheStrategy: 'none' | 'code' | 'bypassHeatCheck' | 'bypassHeatCheckAndEagerCompile' | undefined = (() => {\n\n\t// Always enabled when sandbox is enabled\n\tif (isElectronSandboxed) {\n\t\treturn 'bypassHeatCheck';\n\t}\n\n\t// Otherwise, only enabled conditionally\n\tconst env = nodeProcess?.env['ENABLE_VSCODE_BROWSER_CODE_LOADING'];\n\tif (typeof env === 'string') {\n\t\tif (env === 'none' || env === 'code' || env === 'bypassHeatCheck' || env === 'bypassHeatCheckAndEagerCompile') {\n\t\t\treturn env;\n\t\t}\n\n\t\treturn 'bypassHeatCheck';\n\t}\n\n\treturn undefined;\n})();\nexport const isPreferringBrowserCodeLoad = typeof browserCodeLoadingCacheStrategy === 'string';\n\n// Web environment\nif (typeof navigator === 'object' && !isElectronRenderer) {\n\t_userAgent = navigator.userAgent;\n\t_isWindows = _userAgent.indexOf('Windows') >= 0;\n\t_isMacintosh = _userAgent.indexOf('Macintosh') >= 0;\n\t_isIOS = (_userAgent.indexOf('Macintosh') >= 0 || _userAgent.indexOf('iPad') >= 0 || _userAgent.indexOf('iPhone') >= 0) && !!navigator.maxTouchPoints && navigator.maxTouchPoints > 0;\n\t_isLinux = _userAgent.indexOf('Linux') >= 0;\n\t_isWeb = true;\n\t_locale = navigator.language;\n\t_language = _locale;\n\n\t// NOTE@coder: Make languages work.\n\tconst el = typeof document !== 'undefined' && document.getElementById('vscode-remote-nls-configuration');\n\tconst rawNlsConfig = el && el.getAttribute('data-settings');\n\tif (rawNlsConfig) {\n\t\ttry {\n\t\t\tconst nlsConfig: NLSConfig = JSON.parse(rawNlsConfig);\n\t\t\t_locale = nlsConfig.locale;\n\t\t\t_translationsConfigFile = nlsConfig._translationsConfigFile;\n\t\t\t_language = nlsConfig.availableLanguages['*'] || LANGUAGE_DEFAULT;\n\t\t} catch (error) { /* Oh well. */ }\n\t}\n}\n\n// Native environment\nelse if (typeof nodeProcess === 'object') {\n\t_isWindows = (nodeProcess.platform === 'win32');\n\t_isMacintosh = (nodeProcess.platform === 'darwin');\n\t_isLinux = (nodeProcess.platform === 'linux');\n\t_isLinuxSnap = _isLinux && !!nodeProcess.env['SNAP'] && !!nodeProcess.env['SNAP_REVISION'];\n\t_locale = LANGUAGE_DEFAULT;\n\t_language = LANGUAGE_DEFAULT;\n\tconst rawNlsConfig = nodeProcess.env['VSCODE_NLS_CONFIG'];\n\tif (rawNlsConfig) {\n\t\ttry {\n\t\t\tconst nlsConfig: NLSConfig = JSON.parse(rawNlsConfig);\n\t\t\tconst resolved = nlsConfig.availableLanguages['*'];\n\t\t\t_locale = nlsConfig.locale;\n\t\t\t// VSCode's default language is 'en'\n\t\t\t_language = resolved ? resolved : LANGUAGE_DEFAULT;\n\t\t\t_translationsConfigFile = nlsConfig._translationsConfigFile;\n\t\t} catch (e) {\n\t\t}\n\t}\n\t_isNative = true;\n}\n\n// Unknown environment\nelse {\n\tconsole.error('Unable to resolve platform.');\n}\n\nexport const enum Platform {\n\tWeb,\n\tMac,\n\tLinux,\n\tWindows\n}\nexport function PlatformToString(platform: Platform) {\n\tswitch (platform) {\n\t\tcase Platform.Web: return 'Web';\n\t\tcase Platform.Mac: return 'Mac';\n\t\tcase Platform.Linux: return 'Linux';\n\t\tcase Platform.Windows: return 'Windows';\n\t}\n}\n\nlet _platform: Platform = Platform.Web;\nif (_isMacintosh) {\n\t_platform = Platform.Mac;\n} else if (_isWindows) {\n\t_platform = Platform.Windows;\n} else if (_isLinux) {\n\t_platform = Platform.Linux;\n}\n\nexport const isWindows = _isWindows;\nexport const isMacintosh = _isMacintosh;\nexport const isLinux = _isLinux;\nexport const isLinuxSnap = _isLinuxSnap;\nexport const isNative = _isNative;\nexport const isWeb = _isWeb;\nexport const isIOS = _isIOS;\nexport const platform = _platform;\nexport const userAgent = _userAgent;\n\n/**\n * The language used for the user interface. The format of\n * the string is all lower case (e.g. zh-tw for Traditional\n * Chinese)\n */\nexport const language = _language;\n\nexport namespace Language {\n\n\texport function value(): string {\n\t\treturn language;\n\t}\n\n\texport function isDefaultVariant(): boolean {\n\t\tif (language.length === 2) {\n\t\t\treturn language === 'en';\n\t\t} else if (language.length >= 3) {\n\t\t\treturn language[0] === 'e' && language[1] === 'n' && language[2] === '-';\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\texport function isDefault(): boolean {\n\t\treturn language === 'en';\n\t}\n}\n\n/**\n * The OS locale or the locale specified by --locale. The format of\n * the string is all lower case (e.g. zh-tw for Traditional\n * Chinese). The UI is not necessarily shown in the provided locale.\n */\nexport const locale = _locale;\n\n/**\n * The translatios that are available through language packs.\n */\nexport const translationsConfigFile = _translationsConfigFile;\n\nexport const globals: any = _globals;\n\ninterface ISetImmediate {\n\t(callback: (...args: any[]) => void): void;\n}\n\nexport const setImmediate: ISetImmediate = (function defineSetImmediate() {\n\tif (globals.setImmediate) {\n\t\treturn globals.setImmediate.bind(globals);\n\t}\n\tif (typeof globals.postMessage === 'function' && !globals.importScripts) {\n\t\tinterface IQueueElement {\n\t\t\tid: number;\n\t\t\tcallback: () => void;\n\t\t}\n\t\tlet pending: IQueueElement[] = [];\n\t\tglobals.addEventListener('message', (e: MessageEvent) => {\n\t\t\tif (e.data && e.data.vscodeSetImmediateId) {\n\t\t\t\tfor (let i = 0, len = pending.length; i < len; i++) {\n\t\t\t\t\tconst candidate = pending[i];\n\t\t\t\t\tif (candidate.id === e.data.vscodeSetImmediateId) {\n\t\t\t\t\t\tpending.splice(i, 1);\n\t\t\t\t\t\tcandidate.callback();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tlet lastId = 0;\n\t\treturn (callback: () => void) => {\n\t\t\tconst myId = ++lastId;\n\t\t\tpending.push({\n\t\t\t\tid: myId,\n\t\t\t\tcallback: callback\n\t\t\t});\n\t\t\tglobals.postMessage({ vscodeSetImmediateId: myId }, '*');\n\t\t};\n\t}\n\tif (nodeProcess) {\n\t\treturn nodeProcess.nextTick.bind(nodeProcess);\n\t}\n\tconst _promise = Promise.resolve();\n\treturn (callback: (...args: any[]) => void) => _promise.then(callback);\n})();\n\nexport const enum OperatingSystem {\n\tWindows = 1,\n\tMacintosh = 2,\n\tLinux = 3\n}\nexport const OS = (_isMacintosh || _isIOS ? OperatingSystem.Macintosh : (_isWindows ? OperatingSystem.Windows : OperatingSystem.Linux));\n\nlet _isLittleEndian = true;\nlet _isLittleEndianComputed = false;\nexport function isLittleEndian(): boolean {\n\tif (!_isLittleEndianComputed) {\n\t\t_isLittleEndianComputed = true;\n\t\tconst test = new Uint8Array(2);\n\t\ttest[0] = 1;\n\t\ttest[1] = 2;\n\t\tconst view = new Uint16Array(test.buffer);\n\t\t_isLittleEndian = (view[0] === (2 << 8) + 1);\n\t}\n\treturn _isLittleEndian;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { isWindows, isMacintosh, setImmediate, globals, INodeProcess } from 'vs/base/common/platform';\n\ndeclare const process: INodeProcess;\n\nlet safeProcess: INodeProcess;\n\n// Native node.js environment\nif (typeof process !== 'undefined') {\n\tsafeProcess = process;\n}\n\n// Native sandbox environment\nelse if (typeof globals.vscode !== 'undefined') {\n\tsafeProcess = {\n\n\t\t// Supported\n\t\tget platform(): 'win32' | 'linux' | 'darwin' { return globals.vscode.process.platform; },\n\t\tget env() { return globals.vscode.process.env; },\n\t\tnextTick(callback: (...args: any[]) => void): void { return setImmediate(callback); },\n\n\t\t// Unsupported\n\t\tcwd(): string { return globals.vscode.process.env['VSCODE_CWD'] || globals.vscode.process.execPath.substr(0, globals.vscode.process.execPath.lastIndexOf(globals.vscode.process.platform === 'win32' ? '\\\\' : '/')); }\n\t};\n}\n\n// Web environment\nelse {\n\tsafeProcess = {\n\n\t\t// Supported\n\t\tget platform(): 'win32' | 'linux' | 'darwin' { return isWindows ? 'win32' : isMacintosh ? 'darwin' : 'linux'; },\n\t\tnextTick(callback: (...args: any[]) => void): void { return setImmediate(callback); },\n\n\t\t// Unsupported\n\t\tget env() { return Object.create(null); },\n\t\tcwd(): string { return '/'; }\n\t};\n}\n\nexport const cwd = safeProcess.cwd;\nexport const env = safeProcess.env;\nexport const platform = safeProcess.platform;\nexport const nextTick = safeProcess.nextTick;\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n// NOTE: VSCode's copy of nodejs path library to be usable in common (non-node) namespace\n// Copied from: https://github.com/nodejs/node/blob/v12.8.1/lib/path.js\n\n/**\n * Copyright Joyent, Inc. and other Node contributors.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the\n * \"Software\"), to deal in the Software without restriction, including\n * without limitation the rights to use, copy, modify, merge, publish,\n * distribute, sublicense, and/or sell copies of the Software, and to permit\n * persons to whom the Software is furnished to do so, subject to the\n * following conditions:\n *\n * The above copyright notice and this permission notice shall be included\n * in all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n * NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n * DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n * USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\nimport * as process from 'vs/base/common/process';\n\nconst CHAR_UPPERCASE_A = 65;/* A */\nconst CHAR_LOWERCASE_A = 97; /* a */\nconst CHAR_UPPERCASE_Z = 90; /* Z */\nconst CHAR_LOWERCASE_Z = 122; /* z */\nconst CHAR_DOT = 46; /* . */\nconst CHAR_FORWARD_SLASH = 47; /* / */\nconst CHAR_BACKWARD_SLASH = 92; /* \\ */\nconst CHAR_COLON = 58; /* : */\nconst CHAR_QUESTION_MARK = 63; /* ? */\n\nclass ErrorInvalidArgType extends Error {\n\tcode: 'ERR_INVALID_ARG_TYPE';\n\tconstructor(name: string, expected: string, actual: unknown) {\n\t\t// determiner: 'must be' or 'must not be'\n\t\tlet determiner;\n\t\tif (typeof expected === 'string' && expected.indexOf('not ') === 0) {\n\t\t\tdeterminer = 'must not be';\n\t\t\texpected = expected.replace(/^not /, '');\n\t\t} else {\n\t\t\tdeterminer = 'must be';\n\t\t}\n\n\t\tconst type = name.indexOf('.') !== -1 ? 'property' : 'argument';\n\t\tlet msg = `The \"${name}\" ${type} ${determiner} of type ${expected}`;\n\n\t\tmsg += `. Received type ${typeof actual}`;\n\t\tsuper(msg);\n\n\t\tthis.code = 'ERR_INVALID_ARG_TYPE';\n\t}\n}\n\nfunction validateString(value: string, name: string) {\n\tif (typeof value !== 'string') {\n\t\tthrow new ErrorInvalidArgType(name, 'string', value);\n\t}\n}\n\nfunction isPathSeparator(code: number | undefined) {\n\treturn code === CHAR_FORWARD_SLASH || code === CHAR_BACKWARD_SLASH;\n}\n\nfunction isPosixPathSeparator(code: number | undefined) {\n\treturn code === CHAR_FORWARD_SLASH;\n}\n\nfunction isWindowsDeviceRoot(code: number) {\n\treturn code >= CHAR_UPPERCASE_A && code <= CHAR_UPPERCASE_Z ||\n\t\tcode >= CHAR_LOWERCASE_A && code <= CHAR_LOWERCASE_Z;\n}\n\n// Resolves . and .. elements in a path with directory names\nfunction normalizeString(path: string, allowAboveRoot: boolean, separator: string, isPathSeparator: (code?: number) => boolean) {\n\tlet res = '';\n\tlet lastSegmentLength = 0;\n\tlet lastSlash = -1;\n\tlet dots = 0;\n\tlet code = 0;\n\tfor (let i = 0; i <= path.length; ++i) {\n\t\tif (i < path.length) {\n\t\t\tcode = path.charCodeAt(i);\n\t\t}\n\t\telse if (isPathSeparator(code)) {\n\t\t\tbreak;\n\t\t}\n\t\telse {\n\t\t\tcode = CHAR_FORWARD_SLASH;\n\t\t}\n\n\t\tif (isPathSeparator(code)) {\n\t\t\tif (lastSlash === i - 1 || dots === 1) {\n\t\t\t\t// NOOP\n\t\t\t} else if (dots === 2) {\n\t\t\t\tif (res.length < 2 || lastSegmentLength !== 2 ||\n\t\t\t\t\tres.charCodeAt(res.length - 1) !== CHAR_DOT ||\n\t\t\t\t\tres.charCodeAt(res.length - 2) !== CHAR_DOT) {\n\t\t\t\t\tif (res.length > 2) {\n\t\t\t\t\t\tconst lastSlashIndex = res.lastIndexOf(separator);\n\t\t\t\t\t\tif (lastSlashIndex === -1) {\n\t\t\t\t\t\t\tres = '';\n\t\t\t\t\t\t\tlastSegmentLength = 0;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tres = res.slice(0, lastSlashIndex);\n\t\t\t\t\t\t\tlastSegmentLength = res.length - 1 - res.lastIndexOf(separator);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlastSlash = i;\n\t\t\t\t\t\tdots = 0;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else if (res.length !== 0) {\n\t\t\t\t\t\tres = '';\n\t\t\t\t\t\tlastSegmentLength = 0;\n\t\t\t\t\t\tlastSlash = i;\n\t\t\t\t\t\tdots = 0;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (allowAboveRoot) {\n\t\t\t\t\tres += res.length > 0 ? `${separator}..` : '..';\n\t\t\t\t\tlastSegmentLength = 2;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (res.length > 0) {\n\t\t\t\t\tres += `${separator}${path.slice(lastSlash + 1, i)}`;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tres = path.slice(lastSlash + 1, i);\n\t\t\t\t}\n\t\t\t\tlastSegmentLength = i - lastSlash - 1;\n\t\t\t}\n\t\t\tlastSlash = i;\n\t\t\tdots = 0;\n\t\t} else if (code === CHAR_DOT && dots !== -1) {\n\t\t\t++dots;\n\t\t} else {\n\t\t\tdots = -1;\n\t\t}\n\t}\n\treturn res;\n}\n\nfunction _format(sep: string, pathObject: ParsedPath) {\n\tif (pathObject === null || typeof pathObject !== 'object') {\n\t\tthrow new ErrorInvalidArgType('pathObject', 'Object', pathObject);\n\t}\n\tconst dir = pathObject.dir || pathObject.root;\n\tconst base = pathObject.base ||\n\t\t`${pathObject.name || ''}${pathObject.ext || ''}`;\n\tif (!dir) {\n\t\treturn base;\n\t}\n\treturn dir === pathObject.root ? `${dir}${base}` : `${dir}${sep}${base}`;\n}\n\nexport interface ParsedPath {\n\troot: string;\n\tdir: string;\n\tbase: string;\n\text: string;\n\tname: string;\n}\n\nexport interface IPath {\n\tnormalize(path: string): string;\n\tisAbsolute(path: string): boolean;\n\tjoin(...paths: string[]): string;\n\tresolve(...pathSegments: string[]): string;\n\trelative(from: string, to: string): string;\n\tdirname(path: string): string;\n\tbasename(path: string, ext?: string): string;\n\textname(path: string): string;\n\tformat(pathObject: ParsedPath): string;\n\tparse(path: string): ParsedPath;\n\ttoNamespacedPath(path: string): string;\n\tsep: '\\\\' | '/';\n\tdelimiter: string;\n\twin32: IPath | null;\n\tposix: IPath | null;\n}\n\nexport const win32: IPath = {\n\t// path.resolve([from ...], to)\n\tresolve(...pathSegments: string[]): string {\n\t\tlet resolvedDevice = '';\n\t\tlet resolvedTail = '';\n\t\tlet resolvedAbsolute = false;\n\n\t\tfor (let i = pathSegments.length - 1; i >= -1; i--) {\n\t\t\tlet path;\n\t\t\tif (i >= 0) {\n\t\t\t\tpath = pathSegments[i];\n\t\t\t\tvalidateString(path, 'path');\n\n\t\t\t\t// Skip empty entries\n\t\t\t\tif (path.length === 0) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t} else if (resolvedDevice.length === 0) {\n\t\t\t\tpath = process.cwd();\n\t\t\t} else {\n\t\t\t\t// Windows has the concept of drive-specific current working\n\t\t\t\t// directories. If we've resolved a drive letter but not yet an\n\t\t\t\t// absolute path, get cwd for that drive, or the process cwd if\n\t\t\t\t// the drive cwd is not available. We're sure the device is not\n\t\t\t\t// a UNC path at this points, because UNC paths are always absolute.\n\t\t\t\tpath = process.env[`=${resolvedDevice}`] || process.cwd();\n\n\t\t\t\t// Verify that a cwd was found and that it actually points\n\t\t\t\t// to our drive. If not, default to the drive's root.\n\t\t\t\tif (path === undefined ||\n\t\t\t\t\tpath.slice(0, 2).toLowerCase() !== resolvedDevice.toLowerCase() &&\n\t\t\t\t\tpath.charCodeAt(2) === CHAR_BACKWARD_SLASH) {\n\t\t\t\t\tpath = `${resolvedDevice}\\\\`;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst len = path.length;\n\t\t\tlet rootEnd = 0;\n\t\t\tlet device = '';\n\t\t\tlet isAbsolute = false;\n\t\t\tconst code = path.charCodeAt(0);\n\n\t\t\t// Try to match a root\n\t\t\tif (len === 1) {\n\t\t\t\tif (isPathSeparator(code)) {\n\t\t\t\t\t// `path` contains just a path separator\n\t\t\t\t\trootEnd = 1;\n\t\t\t\t\tisAbsolute = true;\n\t\t\t\t}\n\t\t\t} else if (isPathSeparator(code)) {\n\t\t\t\t// Possible UNC root\n\n\t\t\t\t// If we started with a separator, we know we at least have an\n\t\t\t\t// absolute path of some kind (UNC or otherwise)\n\t\t\t\tisAbsolute = true;\n\n\t\t\t\tif (isPathSeparator(path.charCodeAt(1))) {\n\t\t\t\t\t// Matched double path separator at beginning\n\t\t\t\t\tlet j = 2;\n\t\t\t\t\tlet last = j;\n\t\t\t\t\t// Match 1 or more non-path separators\n\t\t\t\t\twhile (j < len && !isPathSeparator(path.charCodeAt(j))) {\n\t\t\t\t\t\tj++;\n\t\t\t\t\t}\n\t\t\t\t\tif (j < len && j !== last) {\n\t\t\t\t\t\tconst firstPart = path.slice(last, j);\n\t\t\t\t\t\t// Matched!\n\t\t\t\t\t\tlast = j;\n\t\t\t\t\t\t// Match 1 or more path separators\n\t\t\t\t\t\twhile (j < len && isPathSeparator(path.charCodeAt(j))) {\n\t\t\t\t\t\t\tj++;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (j < len && j !== last) {\n\t\t\t\t\t\t\t// Matched!\n\t\t\t\t\t\t\tlast = j;\n\t\t\t\t\t\t\t// Match 1 or more non-path separators\n\t\t\t\t\t\t\twhile (j < len && !isPathSeparator(path.charCodeAt(j))) {\n\t\t\t\t\t\t\t\tj++;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (j === len || j !== last) {\n\t\t\t\t\t\t\t\t// We matched a UNC root\n\t\t\t\t\t\t\t\tdevice = `\\\\\\\\${firstPart}\\\\${path.slice(last, j)}`;\n\t\t\t\t\t\t\t\trootEnd = j;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\trootEnd = 1;\n\t\t\t\t}\n\t\t\t} else if (isWindowsDeviceRoot(code) &&\n\t\t\t\tpath.charCodeAt(1) === CHAR_COLON) {\n\t\t\t\t// Possible device root\n\t\t\t\tdevice = path.slice(0, 2);\n\t\t\t\trootEnd = 2;\n\t\t\t\tif (len > 2 && isPathSeparator(path.charCodeAt(2))) {\n\t\t\t\t\t// Treat separator following drive name as an absolute path\n\t\t\t\t\t// indicator\n\t\t\t\t\tisAbsolute = true;\n\t\t\t\t\trootEnd = 3;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (device.length > 0) {\n\t\t\t\tif (resolvedDevice.length > 0) {\n\t\t\t\t\tif (device.toLowerCase() !== resolvedDevice.toLowerCase()) {\n\t\t\t\t\t\t// This path points to another device so it is not applicable\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tresolvedDevice = device;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (resolvedAbsolute) {\n\t\t\t\tif (resolvedDevice.length > 0) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tresolvedTail = `${path.slice(rootEnd)}\\\\${resolvedTail}`;\n\t\t\t\tresolvedAbsolute = isAbsolute;\n\t\t\t\tif (isAbsolute && resolvedDevice.length > 0) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// At this point the path should be resolved to a full absolute path,\n\t\t// but handle relative paths to be safe (might happen when process.cwd()\n\t\t// fails)\n\n\t\t// Normalize the tail path\n\t\tresolvedTail = normalizeString(resolvedTail, !resolvedAbsolute, '\\\\',\n\t\t\tisPathSeparator);\n\n\t\treturn resolvedAbsolute ?\n\t\t\t`${resolvedDevice}\\\\${resolvedTail}` :\n\t\t\t`${resolvedDevice}${resolvedTail}` || '.';\n\t},\n\n\tnormalize(path: string): string {\n\t\tvalidateString(path, 'path');\n\t\tconst len = path.length;\n\t\tif (len === 0) {\n\t\t\treturn '.';\n\t\t}\n\t\tlet rootEnd = 0;\n\t\tlet device;\n\t\tlet isAbsolute = false;\n\t\tconst code = path.charCodeAt(0);\n\n\t\t// Try to match a root\n\t\tif (len === 1) {\n\t\t\t// `path` contains just a single char, exit early to avoid\n\t\t\t// unnecessary work\n\t\t\treturn isPosixPathSeparator(code) ? '\\\\' : path;\n\t\t}\n\t\tif (isPathSeparator(code)) {\n\t\t\t// Possible UNC root\n\n\t\t\t// If we started with a separator, we know we at least have an absolute\n\t\t\t// path of some kind (UNC or otherwise)\n\t\t\tisAbsolute = true;\n\n\t\t\tif (isPathSeparator(path.charCodeAt(1))) {\n\t\t\t\t// Matched double path separator at beginning\n\t\t\t\tlet j = 2;\n\t\t\t\tlet last = j;\n\t\t\t\t// Match 1 or more non-path separators\n\t\t\t\twhile (j < len && !isPathSeparator(path.charCodeAt(j))) {\n\t\t\t\t\tj++;\n\t\t\t\t}\n\t\t\t\tif (j < len && j !== last) {\n\t\t\t\t\tconst firstPart = path.slice(last, j);\n\t\t\t\t\t// Matched!\n\t\t\t\t\tlast = j;\n\t\t\t\t\t// Match 1 or more path separators\n\t\t\t\t\twhile (j < len && isPathSeparator(path.charCodeAt(j))) {\n\t\t\t\t\t\tj++;\n\t\t\t\t\t}\n\t\t\t\t\tif (j < len && j !== last) {\n\t\t\t\t\t\t// Matched!\n\t\t\t\t\t\tlast = j;\n\t\t\t\t\t\t// Match 1 or more non-path separators\n\t\t\t\t\t\twhile (j < len && !isPathSeparator(path.charCodeAt(j))) {\n\t\t\t\t\t\t\tj++;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (j === len) {\n\t\t\t\t\t\t\t// We matched a UNC root only\n\t\t\t\t\t\t\t// Return the normalized version of the UNC root since there\n\t\t\t\t\t\t\t// is nothing left to process\n\t\t\t\t\t\t\treturn `\\\\\\\\${firstPart}\\\\${path.slice(last)}\\\\`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (j !== last) {\n\t\t\t\t\t\t\t// We matched a UNC root with leftovers\n\t\t\t\t\t\t\tdevice = `\\\\\\\\${firstPart}\\\\${path.slice(last, j)}`;\n\t\t\t\t\t\t\trootEnd = j;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\trootEnd = 1;\n\t\t\t}\n\t\t} else if (isWindowsDeviceRoot(code) && path.charCodeAt(1) === CHAR_COLON) {\n\t\t\t// Possible device root\n\t\t\tdevice = path.slice(0, 2);\n\t\t\trootEnd = 2;\n\t\t\tif (len > 2 && isPathSeparator(path.charCodeAt(2))) {\n\t\t\t\t// Treat separator following drive name as an absolute path\n\t\t\t\t// indicator\n\t\t\t\tisAbsolute = true;\n\t\t\t\trootEnd = 3;\n\t\t\t}\n\t\t}\n\n\t\tlet tail = rootEnd < len ?\n\t\t\tnormalizeString(path.slice(rootEnd), !isAbsolute, '\\\\', isPathSeparator) :\n\t\t\t'';\n\t\tif (tail.length === 0 && !isAbsolute) {\n\t\t\ttail = '.';\n\t\t}\n\t\tif (tail.length > 0 && isPathSeparator(path.charCodeAt(len - 1))) {\n\t\t\ttail += '\\\\';\n\t\t}\n\t\tif (device === undefined) {\n\t\t\treturn isAbsolute ? `\\\\${tail}` : tail;\n\t\t}\n\t\treturn isAbsolute ? `${device}\\\\${tail}` : `${device}${tail}`;\n\t},\n\n\tisAbsolute(path: string): boolean {\n\t\tvalidateString(path, 'path');\n\t\tconst len = path.length;\n\t\tif (len === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst code = path.charCodeAt(0);\n\t\treturn isPathSeparator(code) ||\n\t\t\t// Possible device root\n\t\t\tlen > 2 &&\n\t\t\tisWindowsDeviceRoot(code) &&\n\t\t\tpath.charCodeAt(1) === CHAR_COLON &&\n\t\t\tisPathSeparator(path.charCodeAt(2));\n\t},\n\n\tjoin(...paths: string[]): string {\n\t\tif (paths.length === 0) {\n\t\t\treturn '.';\n\t\t}\n\n\t\tlet joined;\n\t\tlet firstPart: string | undefined;\n\t\tfor (let i = 0; i < paths.length; ++i) {\n\t\t\tconst arg = paths[i];\n\t\t\tvalidateString(arg, 'path');\n\t\t\tif (arg.length > 0) {\n\t\t\t\tif (joined === undefined) {\n\t\t\t\t\tjoined = firstPart = arg;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tjoined += `\\\\${arg}`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (joined === undefined) {\n\t\t\treturn '.';\n\t\t}\n\n\t\t// Make sure that the joined path doesn't start with two slashes, because\n\t\t// normalize() will mistake it for an UNC path then.\n\t\t//\n\t\t// This step is skipped when it is very clear that the user actually\n\t\t// intended to point at an UNC path. This is assumed when the first\n\t\t// non-empty string arguments starts with exactly two slashes followed by\n\t\t// at least one more non-slash character.\n\t\t//\n\t\t// Note that for normalize() to treat a path as an UNC path it needs to\n\t\t// have at least 2 components, so we don't filter for that here.\n\t\t// This means that the user can use join to construct UNC paths from\n\t\t// a server name and a share name; for example:\n\t\t//   path.join('//server', 'share') -> '\\\\\\\\server\\\\share\\\\')\n\t\tlet needsReplace = true;\n\t\tlet slashCount = 0;\n\t\tif (typeof firstPart === 'string' && isPathSeparator(firstPart.charCodeAt(0))) {\n\t\t\t++slashCount;\n\t\t\tconst firstLen = firstPart.length;\n\t\t\tif (firstLen > 1 && isPathSeparator(firstPart.charCodeAt(1))) {\n\t\t\t\t++slashCount;\n\t\t\t\tif (firstLen > 2) {\n\t\t\t\t\tif (isPathSeparator(firstPart.charCodeAt(2))) {\n\t\t\t\t\t\t++slashCount;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// We matched a UNC path in the first part\n\t\t\t\t\t\tneedsReplace = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (needsReplace) {\n\t\t\t// Find any more consecutive slashes we need to replace\n\t\t\twhile (slashCount < joined.length &&\n\t\t\t\tisPathSeparator(joined.charCodeAt(slashCount))) {\n\t\t\t\tslashCount++;\n\t\t\t}\n\n\t\t\t// Replace the slashes if needed\n\t\t\tif (slashCount >= 2) {\n\t\t\t\tjoined = `\\\\${joined.slice(slashCount)}`;\n\t\t\t}\n\t\t}\n\n\t\treturn win32.normalize(joined);\n\t},\n\n\n\t// It will solve the relative path from `from` to `to`, for instance:\n\t//  from = 'C:\\\\orandea\\\\test\\\\aaa'\n\t//  to = 'C:\\\\orandea\\\\impl\\\\bbb'\n\t// The output of the function should be: '..\\\\..\\\\impl\\\\bbb'\n\trelative(from: string, to: string): string {\n\t\tvalidateString(from, 'from');\n\t\tvalidateString(to, 'to');\n\n\t\tif (from === to) {\n\t\t\treturn '';\n\t\t}\n\n\t\tconst fromOrig = win32.resolve(from);\n\t\tconst toOrig = win32.resolve(to);\n\n\t\tif (fromOrig === toOrig) {\n\t\t\treturn '';\n\t\t}\n\n\t\tfrom = fromOrig.toLowerCase();\n\t\tto = toOrig.toLowerCase();\n\n\t\tif (from === to) {\n\t\t\treturn '';\n\t\t}\n\n\t\t// Trim any leading backslashes\n\t\tlet fromStart = 0;\n\t\twhile (fromStart < from.length &&\n\t\t\tfrom.charCodeAt(fromStart) === CHAR_BACKWARD_SLASH) {\n\t\t\tfromStart++;\n\t\t}\n\t\t// Trim trailing backslashes (applicable to UNC paths only)\n\t\tlet fromEnd = from.length;\n\t\twhile (fromEnd - 1 > fromStart &&\n\t\t\tfrom.charCodeAt(fromEnd - 1) === CHAR_BACKWARD_SLASH) {\n\t\t\tfromEnd--;\n\t\t}\n\t\tconst fromLen = fromEnd - fromStart;\n\n\t\t// Trim any leading backslashes\n\t\tlet toStart = 0;\n\t\twhile (toStart < to.length &&\n\t\t\tto.charCodeAt(toStart) === CHAR_BACKWARD_SLASH) {\n\t\t\ttoStart++;\n\t\t}\n\t\t// Trim trailing backslashes (applicable to UNC paths only)\n\t\tlet toEnd = to.length;\n\t\twhile (toEnd - 1 > toStart &&\n\t\t\tto.charCodeAt(toEnd - 1) === CHAR_BACKWARD_SLASH) {\n\t\t\ttoEnd--;\n\t\t}\n\t\tconst toLen = toEnd - toStart;\n\n\t\t// Compare paths to find the longest common path from root\n\t\tconst length = fromLen < toLen ? fromLen : toLen;\n\t\tlet lastCommonSep = -1;\n\t\tlet i = 0;\n\t\tfor (; i < length; i++) {\n\t\t\tconst fromCode = from.charCodeAt(fromStart + i);\n\t\t\tif (fromCode !== to.charCodeAt(toStart + i)) {\n\t\t\t\tbreak;\n\t\t\t} else if (fromCode === CHAR_BACKWARD_SLASH) {\n\t\t\t\tlastCommonSep = i;\n\t\t\t}\n\t\t}\n\n\t\t// We found a mismatch before the first common path separator was seen, so\n\t\t// return the original `to`.\n\t\tif (i !== length) {\n\t\t\tif (lastCommonSep === -1) {\n\t\t\t\treturn toOrig;\n\t\t\t}\n\t\t} else {\n\t\t\tif (toLen > length) {\n\t\t\t\tif (to.charCodeAt(toStart + i) === CHAR_BACKWARD_SLASH) {\n\t\t\t\t\t// We get here if `from` is the exact base path for `to`.\n\t\t\t\t\t// For example: from='C:\\\\foo\\\\bar'; to='C:\\\\foo\\\\bar\\\\baz'\n\t\t\t\t\treturn toOrig.slice(toStart + i + 1);\n\t\t\t\t}\n\t\t\t\tif (i === 2) {\n\t\t\t\t\t// We get here if `from` is the device root.\n\t\t\t\t\t// For example: from='C:\\\\'; to='C:\\\\foo'\n\t\t\t\t\treturn toOrig.slice(toStart + i);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (fromLen > length) {\n\t\t\t\tif (from.charCodeAt(fromStart + i) === CHAR_BACKWARD_SLASH) {\n\t\t\t\t\t// We get here if `to` is the exact base path for `from`.\n\t\t\t\t\t// For example: from='C:\\\\foo\\\\bar'; to='C:\\\\foo'\n\t\t\t\t\tlastCommonSep = i;\n\t\t\t\t} else if (i === 2) {\n\t\t\t\t\t// We get here if `to` is the device root.\n\t\t\t\t\t// For example: from='C:\\\\foo\\\\bar'; to='C:\\\\'\n\t\t\t\t\tlastCommonSep = 3;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (lastCommonSep === -1) {\n\t\t\t\tlastCommonSep = 0;\n\t\t\t}\n\t\t}\n\n\t\tlet out = '';\n\t\t// Generate the relative path based on the path difference between `to` and\n\t\t// `from`\n\t\tfor (i = fromStart + lastCommonSep + 1; i <= fromEnd; ++i) {\n\t\t\tif (i === fromEnd || from.charCodeAt(i) === CHAR_BACKWARD_SLASH) {\n\t\t\t\tout += out.length === 0 ? '..' : '\\\\..';\n\t\t\t}\n\t\t}\n\n\t\ttoStart += lastCommonSep;\n\n\t\t// Lastly, append the rest of the destination (`to`) path that comes after\n\t\t// the common path parts\n\t\tif (out.length > 0) {\n\t\t\treturn `${out}${toOrig.slice(toStart, toEnd)}`;\n\t\t}\n\n\t\tif (toOrig.charCodeAt(toStart) === CHAR_BACKWARD_SLASH) {\n\t\t\t++toStart;\n\t\t}\n\n\t\treturn toOrig.slice(toStart, toEnd);\n\t},\n\n\ttoNamespacedPath(path: string): string {\n\t\t// Note: this will *probably* throw somewhere.\n\t\tif (typeof path !== 'string') {\n\t\t\treturn path;\n\t\t}\n\n\t\tif (path.length === 0) {\n\t\t\treturn '';\n\t\t}\n\n\t\tconst resolvedPath = win32.resolve(path);\n\n\t\tif (resolvedPath.length <= 2) {\n\t\t\treturn path;\n\t\t}\n\n\t\tif (resolvedPath.charCodeAt(0) === CHAR_BACKWARD_SLASH) {\n\t\t\t// Possible UNC root\n\t\t\tif (resolvedPath.charCodeAt(1) === CHAR_BACKWARD_SLASH) {\n\t\t\t\tconst code = resolvedPath.charCodeAt(2);\n\t\t\t\tif (code !== CHAR_QUESTION_MARK && code !== CHAR_DOT) {\n\t\t\t\t\t// Matched non-long UNC root, convert the path to a long UNC path\n\t\t\t\t\treturn `\\\\\\\\?\\\\UNC\\\\${resolvedPath.slice(2)}`;\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (isWindowsDeviceRoot(resolvedPath.charCodeAt(0)) &&\n\t\t\tresolvedPath.charCodeAt(1) === CHAR_COLON &&\n\t\t\tresolvedPath.charCodeAt(2) === CHAR_BACKWARD_SLASH) {\n\t\t\t// Matched device root, convert the path to a long UNC path\n\t\t\treturn `\\\\\\\\?\\\\${resolvedPath}`;\n\t\t}\n\n\t\treturn path;\n\t},\n\n\tdirname(path: string): string {\n\t\tvalidateString(path, 'path');\n\t\tconst len = path.length;\n\t\tif (len === 0) {\n\t\t\treturn '.';\n\t\t}\n\t\tlet rootEnd = -1;\n\t\tlet offset = 0;\n\t\tconst code = path.charCodeAt(0);\n\n\t\tif (len === 1) {\n\t\t\t// `path` contains just a path separator, exit early to avoid\n\t\t\t// unnecessary work or a dot.\n\t\t\treturn isPathSeparator(code) ? path : '.';\n\t\t}\n\n\t\t// Try to match a root\n\t\tif (isPathSeparator(code)) {\n\t\t\t// Possible UNC root\n\n\t\t\trootEnd = offset = 1;\n\n\t\t\tif (isPathSeparator(path.charCodeAt(1))) {\n\t\t\t\t// Matched double path separator at beginning\n\t\t\t\tlet j = 2;\n\t\t\t\tlet last = j;\n\t\t\t\t// Match 1 or more non-path separators\n\t\t\t\twhile (j < len && !isPathSeparator(path.charCodeAt(j))) {\n\t\t\t\t\tj++;\n\t\t\t\t}\n\t\t\t\tif (j < len && j !== last) {\n\t\t\t\t\t// Matched!\n\t\t\t\t\tlast = j;\n\t\t\t\t\t// Match 1 or more path separators\n\t\t\t\t\twhile (j < len && isPathSeparator(path.charCodeAt(j))) {\n\t\t\t\t\t\tj++;\n\t\t\t\t\t}\n\t\t\t\t\tif (j < len && j !== last) {\n\t\t\t\t\t\t// Matched!\n\t\t\t\t\t\tlast = j;\n\t\t\t\t\t\t// Match 1 or more non-path separators\n\t\t\t\t\t\twhile (j < len && !isPathSeparator(path.charCodeAt(j))) {\n\t\t\t\t\t\t\tj++;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (j === len) {\n\t\t\t\t\t\t\t// We matched a UNC root only\n\t\t\t\t\t\t\treturn path;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (j !== last) {\n\t\t\t\t\t\t\t// We matched a UNC root with leftovers\n\n\t\t\t\t\t\t\t// Offset by 1 to include the separator after the UNC root to\n\t\t\t\t\t\t\t// treat it as a \"normal root\" on top of a (UNC) root\n\t\t\t\t\t\t\trootEnd = offset = j + 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Possible device root\n\t\t} else if (isWindowsDeviceRoot(code) && path.charCodeAt(1) === CHAR_COLON) {\n\t\t\trootEnd = len > 2 && isPathSeparator(path.charCodeAt(2)) ? 3 : 2;\n\t\t\toffset = rootEnd;\n\t\t}\n\n\t\tlet end = -1;\n\t\tlet matchedSlash = true;\n\t\tfor (let i = len - 1; i >= offset; --i) {\n\t\t\tif (isPathSeparator(path.charCodeAt(i))) {\n\t\t\t\tif (!matchedSlash) {\n\t\t\t\t\tend = i;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// We saw the first non-path separator\n\t\t\t\tmatchedSlash = false;\n\t\t\t}\n\t\t}\n\n\t\tif (end === -1) {\n\t\t\tif (rootEnd === -1) {\n\t\t\t\treturn '.';\n\t\t\t}\n\n\t\t\tend = rootEnd;\n\t\t}\n\t\treturn path.slice(0, end);\n\t},\n\n\tbasename(path: string, ext?: string): string {\n\t\tif (ext !== undefined) {\n\t\t\tvalidateString(ext, 'ext');\n\t\t}\n\t\tvalidateString(path, 'path');\n\t\tlet start = 0;\n\t\tlet end = -1;\n\t\tlet matchedSlash = true;\n\t\tlet i;\n\n\t\t// Check for a drive letter prefix so as not to mistake the following\n\t\t// path separator as an extra separator at the end of the path that can be\n\t\t// disregarded\n\t\tif (path.length >= 2 &&\n\t\t\tisWindowsDeviceRoot(path.charCodeAt(0)) &&\n\t\t\tpath.charCodeAt(1) === CHAR_COLON) {\n\t\t\tstart = 2;\n\t\t}\n\n\t\tif (ext !== undefined && ext.length > 0 && ext.length <= path.length) {\n\t\t\tif (ext === path) {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\tlet extIdx = ext.length - 1;\n\t\t\tlet firstNonSlashEnd = -1;\n\t\t\tfor (i = path.length - 1; i >= start; --i) {\n\t\t\t\tconst code = path.charCodeAt(i);\n\t\t\t\tif (isPathSeparator(code)) {\n\t\t\t\t\t// If we reached a path separator that was not part of a set of path\n\t\t\t\t\t// separators at the end of the string, stop now\n\t\t\t\t\tif (!matchedSlash) {\n\t\t\t\t\t\tstart = i + 1;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (firstNonSlashEnd === -1) {\n\t\t\t\t\t\t// We saw the first non-path separator, remember this index in case\n\t\t\t\t\t\t// we need it if the extension ends up not matching\n\t\t\t\t\t\tmatchedSlash = false;\n\t\t\t\t\t\tfirstNonSlashEnd = i + 1;\n\t\t\t\t\t}\n\t\t\t\t\tif (extIdx >= 0) {\n\t\t\t\t\t\t// Try to match the explicit extension\n\t\t\t\t\t\tif (code === ext.charCodeAt(extIdx)) {\n\t\t\t\t\t\t\tif (--extIdx === -1) {\n\t\t\t\t\t\t\t\t// We matched the extension, so mark this as the end of our path\n\t\t\t\t\t\t\t\t// component\n\t\t\t\t\t\t\t\tend = i;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Extension does not match, so our result is the entire path\n\t\t\t\t\t\t\t// component\n\t\t\t\t\t\t\textIdx = -1;\n\t\t\t\t\t\t\tend = firstNonSlashEnd;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (start === end) {\n\t\t\t\tend = firstNonSlashEnd;\n\t\t\t} else if (end === -1) {\n\t\t\t\tend = path.length;\n\t\t\t}\n\t\t\treturn path.slice(start, end);\n\t\t}\n\t\tfor (i = path.length - 1; i >= start; --i) {\n\t\t\tif (isPathSeparator(path.charCodeAt(i))) {\n\t\t\t\t// If we reached a path separator that was not part of a set of path\n\t\t\t\t// separators at the end of the string, stop now\n\t\t\t\tif (!matchedSlash) {\n\t\t\t\t\tstart = i + 1;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else if (end === -1) {\n\t\t\t\t// We saw the first non-path separator, mark this as the end of our\n\t\t\t\t// path component\n\t\t\t\tmatchedSlash = false;\n\t\t\t\tend = i + 1;\n\t\t\t}\n\t\t}\n\n\t\tif (end === -1) {\n\t\t\treturn '';\n\t\t}\n\t\treturn path.slice(start, end);\n\t},\n\n\textname(path: string): string {\n\t\tvalidateString(path, 'path');\n\t\tlet start = 0;\n\t\tlet startDot = -1;\n\t\tlet startPart = 0;\n\t\tlet end = -1;\n\t\tlet matchedSlash = true;\n\t\t// Track the state of characters (if any) we see before our first dot and\n\t\t// after any path separator we find\n\t\tlet preDotState = 0;\n\n\t\t// Check for a drive letter prefix so as not to mistake the following\n\t\t// path separator as an extra separator at the end of the path that can be\n\t\t// disregarded\n\n\t\tif (path.length >= 2 &&\n\t\t\tpath.charCodeAt(1) === CHAR_COLON &&\n\t\t\tisWindowsDeviceRoot(path.charCodeAt(0))) {\n\t\t\tstart = startPart = 2;\n\t\t}\n\n\t\tfor (let i = path.length - 1; i >= start; --i) {\n\t\t\tconst code = path.charCodeAt(i);\n\t\t\tif (isPathSeparator(code)) {\n\t\t\t\t// If we reached a path separator that was not part of a set of path\n\t\t\t\t// separators at the end of the string, stop now\n\t\t\t\tif (!matchedSlash) {\n\t\t\t\t\tstartPart = i + 1;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (end === -1) {\n\t\t\t\t// We saw the first non-path separator, mark this as the end of our\n\t\t\t\t// extension\n\t\t\t\tmatchedSlash = false;\n\t\t\t\tend = i + 1;\n\t\t\t}\n\t\t\tif (code === CHAR_DOT) {\n\t\t\t\t// If this is our first dot, mark it as the start of our extension\n\t\t\t\tif (startDot === -1) {\n\t\t\t\t\tstartDot = i;\n\t\t\t\t}\n\t\t\t\telse if (preDotState !== 1) {\n\t\t\t\t\tpreDotState = 1;\n\t\t\t\t}\n\t\t\t} else if (startDot !== -1) {\n\t\t\t\t// We saw a non-dot and non-path separator before our dot, so we should\n\t\t\t\t// have a good chance at having a non-empty extension\n\t\t\t\tpreDotState = -1;\n\t\t\t}\n\t\t}\n\n\t\tif (startDot === -1 ||\n\t\t\tend === -1 ||\n\t\t\t// We saw a non-dot character immediately before the dot\n\t\t\tpreDotState === 0 ||\n\t\t\t// The (right-most) trimmed path component is exactly '..'\n\t\t\t(preDotState === 1 &&\n\t\t\t\tstartDot === end - 1 &&\n\t\t\t\tstartDot === startPart + 1)) {\n\t\t\treturn '';\n\t\t}\n\t\treturn path.slice(startDot, end);\n\t},\n\n\tformat: _format.bind(null, '\\\\'),\n\n\tparse(path) {\n\t\tvalidateString(path, 'path');\n\n\t\tconst ret = { root: '', dir: '', base: '', ext: '', name: '' };\n\t\tif (path.length === 0) {\n\t\t\treturn ret;\n\t\t}\n\n\t\tconst len = path.length;\n\t\tlet rootEnd = 0;\n\t\tlet code = path.charCodeAt(0);\n\n\t\tif (len === 1) {\n\t\t\tif (isPathSeparator(code)) {\n\t\t\t\t// `path` contains just a path separator, exit early to avoid\n\t\t\t\t// unnecessary work\n\t\t\t\tret.root = ret.dir = path;\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t\tret.base = ret.name = path;\n\t\t\treturn ret;\n\t\t}\n\t\t// Try to match a root\n\t\tif (isPathSeparator(code)) {\n\t\t\t// Possible UNC root\n\n\t\t\trootEnd = 1;\n\t\t\tif (isPathSeparator(path.charCodeAt(1))) {\n\t\t\t\t// Matched double path separator at beginning\n\t\t\t\tlet j = 2;\n\t\t\t\tlet last = j;\n\t\t\t\t// Match 1 or more non-path separators\n\t\t\t\twhile (j < len && !isPathSeparator(path.charCodeAt(j))) {\n\t\t\t\t\tj++;\n\t\t\t\t}\n\t\t\t\tif (j < len && j !== last) {\n\t\t\t\t\t// Matched!\n\t\t\t\t\tlast = j;\n\t\t\t\t\t// Match 1 or more path separators\n\t\t\t\t\twhile (j < len && isPathSeparator(path.charCodeAt(j))) {\n\t\t\t\t\t\tj++;\n\t\t\t\t\t}\n\t\t\t\t\tif (j < len && j !== last) {\n\t\t\t\t\t\t// Matched!\n\t\t\t\t\t\tlast = j;\n\t\t\t\t\t\t// Match 1 or more non-path separators\n\t\t\t\t\t\twhile (j < len && !isPathSeparator(path.charCodeAt(j))) {\n\t\t\t\t\t\t\tj++;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (j === len) {\n\t\t\t\t\t\t\t// We matched a UNC root only\n\t\t\t\t\t\t\trootEnd = j;\n\t\t\t\t\t\t} else if (j !== last) {\n\t\t\t\t\t\t\t// We matched a UNC root with leftovers\n\t\t\t\t\t\t\trootEnd = j + 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (isWindowsDeviceRoot(code) && path.charCodeAt(1) === CHAR_COLON) {\n\t\t\t// Possible device root\n\t\t\tif (len <= 2) {\n\t\t\t\t// `path` contains just a drive root, exit early to avoid\n\t\t\t\t// unnecessary work\n\t\t\t\tret.root = ret.dir = path;\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t\trootEnd = 2;\n\t\t\tif (isPathSeparator(path.charCodeAt(2))) {\n\t\t\t\tif (len === 3) {\n\t\t\t\t\t// `path` contains just a drive root, exit early to avoid\n\t\t\t\t\t// unnecessary work\n\t\t\t\t\tret.root = ret.dir = path;\n\t\t\t\t\treturn ret;\n\t\t\t\t}\n\t\t\t\trootEnd = 3;\n\t\t\t}\n\t\t}\n\t\tif (rootEnd > 0) {\n\t\t\tret.root = path.slice(0, rootEnd);\n\t\t}\n\n\t\tlet startDot = -1;\n\t\tlet startPart = rootEnd;\n\t\tlet end = -1;\n\t\tlet matchedSlash = true;\n\t\tlet i = path.length - 1;\n\n\t\t// Track the state of characters (if any) we see before our first dot and\n\t\t// after any path separator we find\n\t\tlet preDotState = 0;\n\n\t\t// Get non-dir info\n\t\tfor (; i >= rootEnd; --i) {\n\t\t\tcode = path.charCodeAt(i);\n\t\t\tif (isPathSeparator(code)) {\n\t\t\t\t// If we reached a path separator that was not part of a set of path\n\t\t\t\t// separators at the end of the string, stop now\n\t\t\t\tif (!matchedSlash) {\n\t\t\t\t\tstartPart = i + 1;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (end === -1) {\n\t\t\t\t// We saw the first non-path separator, mark this as the end of our\n\t\t\t\t// extension\n\t\t\t\tmatchedSlash = false;\n\t\t\t\tend = i + 1;\n\t\t\t}\n\t\t\tif (code === CHAR_DOT) {\n\t\t\t\t// If this is our first dot, mark it as the start of our extension\n\t\t\t\tif (startDot === -1) {\n\t\t\t\t\tstartDot = i;\n\t\t\t\t} else if (preDotState !== 1) {\n\t\t\t\t\tpreDotState = 1;\n\t\t\t\t}\n\t\t\t} else if (startDot !== -1) {\n\t\t\t\t// We saw a non-dot and non-path separator before our dot, so we should\n\t\t\t\t// have a good chance at having a non-empty extension\n\t\t\t\tpreDotState = -1;\n\t\t\t}\n\t\t}\n\n\t\tif (end !== -1) {\n\t\t\tif (startDot === -1 ||\n\t\t\t\t// We saw a non-dot character immediately before the dot\n\t\t\t\tpreDotState === 0 ||\n\t\t\t\t// The (right-most) trimmed path component is exactly '..'\n\t\t\t\t(preDotState === 1 &&\n\t\t\t\t\tstartDot === end - 1 &&\n\t\t\t\t\tstartDot === startPart + 1)) {\n\t\t\t\tret.base = ret.name = path.slice(startPart, end);\n\t\t\t} else {\n\t\t\t\tret.name = path.slice(startPart, startDot);\n\t\t\t\tret.base = path.slice(startPart, end);\n\t\t\t\tret.ext = path.slice(startDot, end);\n\t\t\t}\n\t\t}\n\n\t\t// If the directory is the root, use the entire root as the `dir` including\n\t\t// the trailing slash if any (`C:\\abc` -> `C:\\`). Otherwise, strip out the\n\t\t// trailing slash (`C:\\abc\\def` -> `C:\\abc`).\n\t\tif (startPart > 0 && startPart !== rootEnd) {\n\t\t\tret.dir = path.slice(0, startPart - 1);\n\t\t} else {\n\t\t\tret.dir = ret.root;\n\t\t}\n\n\t\treturn ret;\n\t},\n\n\tsep: '\\\\',\n\tdelimiter: ';',\n\twin32: null,\n\tposix: null\n};\n\nexport const posix: IPath = {\n\t// path.resolve([from ...], to)\n\tresolve(...pathSegments: string[]): string {\n\t\tlet resolvedPath = '';\n\t\tlet resolvedAbsolute = false;\n\n\t\tfor (let i = pathSegments.length - 1; i >= -1 && !resolvedAbsolute; i--) {\n\t\t\tconst path = i >= 0 ? pathSegments[i] : process.cwd();\n\n\t\t\tvalidateString(path, 'path');\n\n\t\t\t// Skip empty entries\n\t\t\tif (path.length === 0) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tresolvedPath = `${path}/${resolvedPath}`;\n\t\t\tresolvedAbsolute = path.charCodeAt(0) === CHAR_FORWARD_SLASH;\n\t\t}\n\n\t\t// At this point the path should be resolved to a full absolute path, but\n\t\t// handle relative paths to be safe (might happen when process.cwd() fails)\n\n\t\t// Normalize the path\n\t\tresolvedPath = normalizeString(resolvedPath, !resolvedAbsolute, '/',\n\t\t\tisPosixPathSeparator);\n\n\t\tif (resolvedAbsolute) {\n\t\t\treturn `/${resolvedPath}`;\n\t\t}\n\t\treturn resolvedPath.length > 0 ? resolvedPath : '.';\n\t},\n\n\tnormalize(path: string): string {\n\t\tvalidateString(path, 'path');\n\n\t\tif (path.length === 0) {\n\t\t\treturn '.';\n\t\t}\n\n\t\tconst isAbsolute = path.charCodeAt(0) === CHAR_FORWARD_SLASH;\n\t\tconst trailingSeparator =\n\t\t\tpath.charCodeAt(path.length - 1) === CHAR_FORWARD_SLASH;\n\n\t\t// Normalize the path\n\t\tpath = normalizeString(path, !isAbsolute, '/', isPosixPathSeparator);\n\n\t\tif (path.length === 0) {\n\t\t\tif (isAbsolute) {\n\t\t\t\treturn '/';\n\t\t\t}\n\t\t\treturn trailingSeparator ? './' : '.';\n\t\t}\n\t\tif (trailingSeparator) {\n\t\t\tpath += '/';\n\t\t}\n\n\t\treturn isAbsolute ? `/${path}` : path;\n\t},\n\n\tisAbsolute(path: string): boolean {\n\t\tvalidateString(path, 'path');\n\t\treturn path.length > 0 && path.charCodeAt(0) === CHAR_FORWARD_SLASH;\n\t},\n\n\tjoin(...paths: string[]): string {\n\t\tif (paths.length === 0) {\n\t\t\treturn '.';\n\t\t}\n\t\tlet joined;\n\t\tfor (let i = 0; i < paths.length; ++i) {\n\t\t\tconst arg = paths[i];\n\t\t\tvalidateString(arg, 'path');\n\t\t\tif (arg.length > 0) {\n\t\t\t\tif (joined === undefined) {\n\t\t\t\t\tjoined = arg;\n\t\t\t\t} else {\n\t\t\t\t\tjoined += `/${arg}`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (joined === undefined) {\n\t\t\treturn '.';\n\t\t}\n\t\treturn posix.normalize(joined);\n\t},\n\n\trelative(from: string, to: string): string {\n\t\tvalidateString(from, 'from');\n\t\tvalidateString(to, 'to');\n\n\t\tif (from === to) {\n\t\t\treturn '';\n\t\t}\n\n\t\t// Trim leading forward slashes.\n\t\tfrom = posix.resolve(from);\n\t\tto = posix.resolve(to);\n\n\t\tif (from === to) {\n\t\t\treturn '';\n\t\t}\n\n\t\tconst fromStart = 1;\n\t\tconst fromEnd = from.length;\n\t\tconst fromLen = fromEnd - fromStart;\n\t\tconst toStart = 1;\n\t\tconst toLen = to.length - toStart;\n\n\t\t// Compare paths to find the longest common path from root\n\t\tconst length = (fromLen < toLen ? fromLen : toLen);\n\t\tlet lastCommonSep = -1;\n\t\tlet i = 0;\n\t\tfor (; i < length; i++) {\n\t\t\tconst fromCode = from.charCodeAt(fromStart + i);\n\t\t\tif (fromCode !== to.charCodeAt(toStart + i)) {\n\t\t\t\tbreak;\n\t\t\t} else if (fromCode === CHAR_FORWARD_SLASH) {\n\t\t\t\tlastCommonSep = i;\n\t\t\t}\n\t\t}\n\t\tif (i === length) {\n\t\t\tif (toLen > length) {\n\t\t\t\tif (to.charCodeAt(toStart + i) === CHAR_FORWARD_SLASH) {\n\t\t\t\t\t// We get here if `from` is the exact base path for `to`.\n\t\t\t\t\t// For example: from='/foo/bar'; to='/foo/bar/baz'\n\t\t\t\t\treturn to.slice(toStart + i + 1);\n\t\t\t\t}\n\t\t\t\tif (i === 0) {\n\t\t\t\t\t// We get here if `from` is the root\n\t\t\t\t\t// For example: from='/'; to='/foo'\n\t\t\t\t\treturn to.slice(toStart + i);\n\t\t\t\t}\n\t\t\t} else if (fromLen > length) {\n\t\t\t\tif (from.charCodeAt(fromStart + i) === CHAR_FORWARD_SLASH) {\n\t\t\t\t\t// We get here if `to` is the exact base path for `from`.\n\t\t\t\t\t// For example: from='/foo/bar/baz'; to='/foo/bar'\n\t\t\t\t\tlastCommonSep = i;\n\t\t\t\t} else if (i === 0) {\n\t\t\t\t\t// We get here if `to` is the root.\n\t\t\t\t\t// For example: from='/foo/bar'; to='/'\n\t\t\t\t\tlastCommonSep = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet out = '';\n\t\t// Generate the relative path based on the path difference between `to`\n\t\t// and `from`.\n\t\tfor (i = fromStart + lastCommonSep + 1; i <= fromEnd; ++i) {\n\t\t\tif (i === fromEnd || from.charCodeAt(i) === CHAR_FORWARD_SLASH) {\n\t\t\t\tout += out.length === 0 ? '..' : '/..';\n\t\t\t}\n\t\t}\n\n\t\t// Lastly, append the rest of the destination (`to`) path that comes after\n\t\t// the common path parts.\n\t\treturn `${out}${to.slice(toStart + lastCommonSep)}`;\n\t},\n\n\ttoNamespacedPath(path: string): string {\n\t\t// Non-op on posix systems\n\t\treturn path;\n\t},\n\n\tdirname(path: string): string {\n\t\tvalidateString(path, 'path');\n\t\tif (path.length === 0) {\n\t\t\treturn '.';\n\t\t}\n\t\tconst hasRoot = path.charCodeAt(0) === CHAR_FORWARD_SLASH;\n\t\tlet end = -1;\n\t\tlet matchedSlash = true;\n\t\tfor (let i = path.length - 1; i >= 1; --i) {\n\t\t\tif (path.charCodeAt(i) === CHAR_FORWARD_SLASH) {\n\t\t\t\tif (!matchedSlash) {\n\t\t\t\t\tend = i;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// We saw the first non-path separator\n\t\t\t\tmatchedSlash = false;\n\t\t\t}\n\t\t}\n\n\t\tif (end === -1) {\n\t\t\treturn hasRoot ? '/' : '.';\n\t\t}\n\t\tif (hasRoot && end === 1) {\n\t\t\treturn '//';\n\t\t}\n\t\treturn path.slice(0, end);\n\t},\n\n\tbasename(path: string, ext?: string): string {\n\t\tif (ext !== undefined) {\n\t\t\tvalidateString(ext, 'ext');\n\t\t}\n\t\tvalidateString(path, 'path');\n\n\t\tlet start = 0;\n\t\tlet end = -1;\n\t\tlet matchedSlash = true;\n\t\tlet i;\n\n\t\tif (ext !== undefined && ext.length > 0 && ext.length <= path.length) {\n\t\t\tif (ext === path) {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\tlet extIdx = ext.length - 1;\n\t\t\tlet firstNonSlashEnd = -1;\n\t\t\tfor (i = path.length - 1; i >= 0; --i) {\n\t\t\t\tconst code = path.charCodeAt(i);\n\t\t\t\tif (code === CHAR_FORWARD_SLASH) {\n\t\t\t\t\t// If we reached a path separator that was not part of a set of path\n\t\t\t\t\t// separators at the end of the string, stop now\n\t\t\t\t\tif (!matchedSlash) {\n\t\t\t\t\t\tstart = i + 1;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (firstNonSlashEnd === -1) {\n\t\t\t\t\t\t// We saw the first non-path separator, remember this index in case\n\t\t\t\t\t\t// we need it if the extension ends up not matching\n\t\t\t\t\t\tmatchedSlash = false;\n\t\t\t\t\t\tfirstNonSlashEnd = i + 1;\n\t\t\t\t\t}\n\t\t\t\t\tif (extIdx >= 0) {\n\t\t\t\t\t\t// Try to match the explicit extension\n\t\t\t\t\t\tif (code === ext.charCodeAt(extIdx)) {\n\t\t\t\t\t\t\tif (--extIdx === -1) {\n\t\t\t\t\t\t\t\t// We matched the extension, so mark this as the end of our path\n\t\t\t\t\t\t\t\t// component\n\t\t\t\t\t\t\t\tend = i;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Extension does not match, so our result is the entire path\n\t\t\t\t\t\t\t// component\n\t\t\t\t\t\t\textIdx = -1;\n\t\t\t\t\t\t\tend = firstNonSlashEnd;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (start === end) {\n\t\t\t\tend = firstNonSlashEnd;\n\t\t\t} else if (end === -1) {\n\t\t\t\tend = path.length;\n\t\t\t}\n\t\t\treturn path.slice(start, end);\n\t\t}\n\t\tfor (i = path.length - 1; i >= 0; --i) {\n\t\t\tif (path.charCodeAt(i) === CHAR_FORWARD_SLASH) {\n\t\t\t\t// If we reached a path separator that was not part of a set of path\n\t\t\t\t// separators at the end of the string, stop now\n\t\t\t\tif (!matchedSlash) {\n\t\t\t\t\tstart = i + 1;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else if (end === -1) {\n\t\t\t\t// We saw the first non-path separator, mark this as the end of our\n\t\t\t\t// path component\n\t\t\t\tmatchedSlash = false;\n\t\t\t\tend = i + 1;\n\t\t\t}\n\t\t}\n\n\t\tif (end === -1) {\n\t\t\treturn '';\n\t\t}\n\t\treturn path.slice(start, end);\n\t},\n\n\textname(path: string): string {\n\t\tvalidateString(path, 'path');\n\t\tlet startDot = -1;\n\t\tlet startPart = 0;\n\t\tlet end = -1;\n\t\tlet matchedSlash = true;\n\t\t// Track the state of characters (if any) we see before our first dot and\n\t\t// after any path separator we find\n\t\tlet preDotState = 0;\n\t\tfor (let i = path.length - 1; i >= 0; --i) {\n\t\t\tconst code = path.charCodeAt(i);\n\t\t\tif (code === CHAR_FORWARD_SLASH) {\n\t\t\t\t// If we reached a path separator that was not part of a set of path\n\t\t\t\t// separators at the end of the string, stop now\n\t\t\t\tif (!matchedSlash) {\n\t\t\t\t\tstartPart = i + 1;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (end === -1) {\n\t\t\t\t// We saw the first non-path separator, mark this as the end of our\n\t\t\t\t// extension\n\t\t\t\tmatchedSlash = false;\n\t\t\t\tend = i + 1;\n\t\t\t}\n\t\t\tif (code === CHAR_DOT) {\n\t\t\t\t// If this is our first dot, mark it as the start of our extension\n\t\t\t\tif (startDot === -1) {\n\t\t\t\t\tstartDot = i;\n\t\t\t\t}\n\t\t\t\telse if (preDotState !== 1) {\n\t\t\t\t\tpreDotState = 1;\n\t\t\t\t}\n\t\t\t} else if (startDot !== -1) {\n\t\t\t\t// We saw a non-dot and non-path separator before our dot, so we should\n\t\t\t\t// have a good chance at having a non-empty extension\n\t\t\t\tpreDotState = -1;\n\t\t\t}\n\t\t}\n\n\t\tif (startDot === -1 ||\n\t\t\tend === -1 ||\n\t\t\t// We saw a non-dot character immediately before the dot\n\t\t\tpreDotState === 0 ||\n\t\t\t// The (right-most) trimmed path component is exactly '..'\n\t\t\t(preDotState === 1 &&\n\t\t\t\tstartDot === end - 1 &&\n\t\t\t\tstartDot === startPart + 1)) {\n\t\t\treturn '';\n\t\t}\n\t\treturn path.slice(startDot, end);\n\t},\n\n\tformat: _format.bind(null, '/'),\n\n\tparse(path: string): ParsedPath {\n\t\tvalidateString(path, 'path');\n\n\t\tconst ret = { root: '', dir: '', base: '', ext: '', name: '' };\n\t\tif (path.length === 0) {\n\t\t\treturn ret;\n\t\t}\n\t\tconst isAbsolute = path.charCodeAt(0) === CHAR_FORWARD_SLASH;\n\t\tlet start;\n\t\tif (isAbsolute) {\n\t\t\tret.root = '/';\n\t\t\tstart = 1;\n\t\t} else {\n\t\t\tstart = 0;\n\t\t}\n\t\tlet startDot = -1;\n\t\tlet startPart = 0;\n\t\tlet end = -1;\n\t\tlet matchedSlash = true;\n\t\tlet i = path.length - 1;\n\n\t\t// Track the state of characters (if any) we see before our first dot and\n\t\t// after any path separator we find\n\t\tlet preDotState = 0;\n\n\t\t// Get non-dir info\n\t\tfor (; i >= start; --i) {\n\t\t\tconst code = path.charCodeAt(i);\n\t\t\tif (code === CHAR_FORWARD_SLASH) {\n\t\t\t\t// If we reached a path separator that was not part of a set of path\n\t\t\t\t// separators at the end of the string, stop now\n\t\t\t\tif (!matchedSlash) {\n\t\t\t\t\tstartPart = i + 1;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (end === -1) {\n\t\t\t\t// We saw the first non-path separator, mark this as the end of our\n\t\t\t\t// extension\n\t\t\t\tmatchedSlash = false;\n\t\t\t\tend = i + 1;\n\t\t\t}\n\t\t\tif (code === CHAR_DOT) {\n\t\t\t\t// If this is our first dot, mark it as the start of our extension\n\t\t\t\tif (startDot === -1) {\n\t\t\t\t\tstartDot = i;\n\t\t\t\t} else if (preDotState !== 1) {\n\t\t\t\t\tpreDotState = 1;\n\t\t\t\t}\n\t\t\t} else if (startDot !== -1) {\n\t\t\t\t// We saw a non-dot and non-path separator before our dot, so we should\n\t\t\t\t// have a good chance at having a non-empty extension\n\t\t\t\tpreDotState = -1;\n\t\t\t}\n\t\t}\n\n\t\tif (end !== -1) {\n\t\t\tconst start = startPart === 0 && isAbsolute ? 1 : startPart;\n\t\t\tif (startDot === -1 ||\n\t\t\t\t// We saw a non-dot character immediately before the dot\n\t\t\t\tpreDotState === 0 ||\n\t\t\t\t// The (right-most) trimmed path component is exactly '..'\n\t\t\t\t(preDotState === 1 &&\n\t\t\t\t\tstartDot === end - 1 &&\n\t\t\t\t\tstartDot === startPart + 1)) {\n\t\t\t\tret.base = ret.name = path.slice(start, end);\n\t\t\t} else {\n\t\t\t\tret.name = path.slice(start, startDot);\n\t\t\t\tret.base = path.slice(start, end);\n\t\t\t\tret.ext = path.slice(startDot, end);\n\t\t\t}\n\t\t}\n\n\t\tif (startPart > 0) {\n\t\t\tret.dir = path.slice(0, startPart - 1);\n\t\t} else if (isAbsolute) {\n\t\t\tret.dir = '/';\n\t\t}\n\n\t\treturn ret;\n\t},\n\n\tsep: '/',\n\tdelimiter: ':',\n\twin32: null,\n\tposix: null\n};\n\nposix.win32 = win32.win32 = win32;\nposix.posix = win32.posix = posix;\n\nexport const normalize = (process.platform === 'win32' ? win32.normalize : posix.normalize);\nexport const isAbsolute = (process.platform === 'win32' ? win32.isAbsolute : posix.isAbsolute);\nexport const join = (process.platform === 'win32' ? win32.join : posix.join);\nexport const resolve = (process.platform === 'win32' ? win32.resolve : posix.resolve);\nexport const relative = (process.platform === 'win32' ? win32.relative : posix.relative);\nexport const dirname = (process.platform === 'win32' ? win32.dirname : posix.dirname);\nexport const basename = (process.platform === 'win32' ? win32.basename : posix.basename);\nexport const extname = (process.platform === 'win32' ? win32.extname : posix.extname);\nexport const format = (process.platform === 'win32' ? win32.format : posix.format);\nexport const parse = (process.platform === 'win32' ? win32.parse : posix.parse);\nexport const toNamespacedPath = (process.platform === 'win32' ? win32.toNamespacedPath : posix.toNamespacedPath);\nexport const sep = (process.platform === 'win32' ? win32.sep : posix.sep);\nexport const delimiter = (process.platform === 'win32' ? win32.delimiter : posix.delimiter);\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IProcessEnvironment } from 'vs/base/common/platform';\n\n/**\n * Options to be passed to the external program or shell.\n */\nexport interface CommandOptions {\n\t/**\n\t * The current working directory of the executed program or shell.\n\t * If omitted VSCode's current workspace root is used.\n\t */\n\tcwd?: string;\n\n\t/**\n\t * The environment of the executed program or shell. If omitted\n\t * the parent process' environment is used.\n\t */\n\tenv?: { [key: string]: string; };\n}\n\nexport interface Executable {\n\t/**\n\t * The command to be executed. Can be an external program or a shell\n\t * command.\n\t */\n\tcommand: string;\n\n\t/**\n\t * Specifies whether the command is a shell command and therefore must\n\t * be executed in a shell interpreter (e.g. cmd.exe, bash, ...).\n\t */\n\tisShellCommand: boolean;\n\n\t/**\n\t * The arguments passed to the command.\n\t */\n\targs: string[];\n\n\t/**\n\t * The command options used when the command is executed. Can be omitted.\n\t */\n\toptions?: CommandOptions;\n}\n\nexport interface ForkOptions extends CommandOptions {\n\texecArgv?: string[];\n}\n\nexport const enum Source {\n\tstdout,\n\tstderr\n}\n\n/**\n * The data send via a success callback\n */\nexport interface SuccessData {\n\terror?: Error;\n\tcmdCode?: number;\n\tterminated?: boolean;\n}\n\n/**\n * The data send via a error callback\n */\nexport interface ErrorData {\n\terror?: Error;\n\tterminated?: boolean;\n\tstdout?: string;\n\tstderr?: string;\n}\n\nexport interface TerminateResponse {\n\tsuccess: boolean;\n\tcode?: TerminateResponseCode;\n\terror?: any;\n}\n\nexport const enum TerminateResponseCode {\n\tSuccess = 0,\n\tUnknown = 1,\n\tAccessDenied = 2,\n\tProcessNotFound = 3,\n}\n\nexport interface ProcessItem {\n\tname: string;\n\tcmd: string;\n\tpid: number;\n\tppid: number;\n\tload: number;\n\tmem: number;\n\n\tchildren?: ProcessItem[];\n}\n\n/**\n * Sanitizes a VS Code process environment by removing all Electron/VS Code-related values.\n */\nexport function sanitizeProcessEnvironment(env: IProcessEnvironment, ...preserve: string[]): void {\n\tconst set = preserve.reduce((set, key) => {\n\t\tset[key] = true;\n\t\treturn set;\n\t}, {} as Record<string, boolean>);\n\tconst keysToRemove = [\n\t\t/^ELECTRON_.+$/,\n\t\t/^VSCODE_.+$/,\n\t\t/^SNAP(|_.*)$/,\n\t\t/^GDK_PIXBUF_.+$/,\n\t\t/^CODE_SERVER_.+$/,\n\t];\n\tconst envKeys = Object.keys(env);\n\tenvKeys\n\t\t.filter(key => !set[key])\n\t\t.forEach(envKey => {\n\t\t\tfor (let i = 0; i < keysToRemove.length; i++) {\n\t\t\t\tif (envKey.search(keysToRemove[i]) !== -1) {\n\t\t\t\t\tdelete env[envKey];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { globals } from 'vs/base/common/platform';\n\nconst hasPerformanceNow = (globals.performance && typeof globals.performance.now === 'function');\n\nexport class StopWatch {\n\n\tprivate _highResolution: boolean;\n\tprivate _startTime: number;\n\tprivate _stopTime: number;\n\n\tpublic static create(highResolution: boolean = true): StopWatch {\n\t\treturn new StopWatch(highResolution);\n\t}\n\n\tconstructor(highResolution: boolean) {\n\t\tthis._highResolution = hasPerformanceNow && highResolution;\n\t\tthis._startTime = this._now();\n\t\tthis._stopTime = -1;\n\t}\n\n\tpublic stop(): void {\n\t\tthis._stopTime = this._now();\n\t}\n\n\tpublic elapsed(): number {\n\t\tif (this._stopTime !== -1) {\n\t\t\treturn this._stopTime - this._startTime;\n\t\t}\n\t\treturn this._now() - this._startTime;\n\t}\n\n\tprivate _now(): number {\n\t\treturn this._highResolution ? globals.performance.now() : Date.now();\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { onUnexpectedError } from 'vs/base/common/errors';\nimport { once as onceFn } from 'vs/base/common/functional';\nimport { Disposable, IDisposable, toDisposable, combinedDisposable, DisposableStore } from 'vs/base/common/lifecycle';\nimport { LinkedList } from 'vs/base/common/linkedList';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { StopWatch } from 'vs/base/common/stopwatch';\n\n/**\n * To an event a function with one or zero parameters\n * can be subscribed. The event is the subscriber function itself.\n */\nexport interface Event<T> {\n\t(listener: (e: T) => any, thisArgs?: any, disposables?: IDisposable[] | DisposableStore): IDisposable;\n}\n\nexport namespace Event {\n\texport const None: Event<any> = () => Disposable.None;\n\n\t/**\n\t * Given an event, returns another event which only fires once.\n\t */\n\texport function once<T>(event: Event<T>): Event<T> {\n\t\treturn (listener, thisArgs = null, disposables?) => {\n\t\t\t// we need this, in case the event fires during the listener call\n\t\t\tlet didFire = false;\n\t\t\tlet result: IDisposable;\n\t\t\tresult = event(e => {\n\t\t\t\tif (didFire) {\n\t\t\t\t\treturn;\n\t\t\t\t} else if (result) {\n\t\t\t\t\tresult.dispose();\n\t\t\t\t} else {\n\t\t\t\t\tdidFire = true;\n\t\t\t\t}\n\n\t\t\t\treturn listener.call(thisArgs, e);\n\t\t\t}, null, disposables);\n\n\t\t\tif (didFire) {\n\t\t\t\tresult.dispose();\n\t\t\t}\n\n\t\t\treturn result;\n\t\t};\n\t}\n\n\t/**\n\t * Given an event and a `map` function, returns another event which maps each element\n\t * through the mapping function.\n\t */\n\texport function map<I, O>(event: Event<I>, map: (i: I) => O): Event<O> {\n\t\treturn snapshot((listener, thisArgs = null, disposables?) => event(i => listener.call(thisArgs, map(i)), null, disposables));\n\t}\n\n\t/**\n\t * Given an event and an `each` function, returns another identical event and calls\n\t * the `each` function per each element.\n\t */\n\texport function forEach<I>(event: Event<I>, each: (i: I) => void): Event<I> {\n\t\treturn snapshot((listener, thisArgs = null, disposables?) => event(i => { each(i); listener.call(thisArgs, i); }, null, disposables));\n\t}\n\n\t/**\n\t * Given an event and a `filter` function, returns another event which emits those\n\t * elements for which the `filter` function returns `true`.\n\t */\n\texport function filter<T>(event: Event<T>, filter: (e: T) => boolean): Event<T>;\n\texport function filter<T, R>(event: Event<T | R>, filter: (e: T | R) => e is R): Event<R>;\n\texport function filter<T>(event: Event<T>, filter: (e: T) => boolean): Event<T> {\n\t\treturn snapshot((listener, thisArgs = null, disposables?) => event(e => filter(e) && listener.call(thisArgs, e), null, disposables));\n\t}\n\n\t/**\n\t * Given an event, returns the same event but typed as `Event<void>`.\n\t */\n\texport function signal<T>(event: Event<T>): Event<void> {\n\t\treturn event as Event<any> as Event<void>;\n\t}\n\n\t/**\n\t * Given a collection of events, returns a single event which emits\n\t * whenever any of the provided events emit.\n\t */\n\texport function any<T>(...events: Event<T>[]): Event<T>;\n\texport function any(...events: Event<any>[]): Event<void>;\n\texport function any<T>(...events: Event<T>[]): Event<T> {\n\t\treturn (listener, thisArgs = null, disposables?) => combinedDisposable(...events.map(event => event(e => listener.call(thisArgs, e), null, disposables)));\n\t}\n\n\t/**\n\t * Given an event and a `merge` function, returns another event which maps each element\n\t * and the cumulative result through the `merge` function. Similar to `map`, but with memory.\n\t */\n\texport function reduce<I, O>(event: Event<I>, merge: (last: O | undefined, event: I) => O, initial?: O): Event<O> {\n\t\tlet output: O | undefined = initial;\n\n\t\treturn map<I, O>(event, e => {\n\t\t\toutput = merge(output, e);\n\t\t\treturn output;\n\t\t});\n\t}\n\n\t/**\n\t * Given a chain of event processing functions (filter, map, etc), each\n\t * function will be invoked per event & per listener. Snapshotting an event\n\t * chain allows each function to be invoked just once per event.\n\t */\n\texport function snapshot<T>(event: Event<T>): Event<T> {\n\t\tlet listener: IDisposable;\n\t\tconst emitter = new Emitter<T>({\n\t\t\tonFirstListenerAdd() {\n\t\t\t\tlistener = event(emitter.fire, emitter);\n\t\t\t},\n\t\t\tonLastListenerRemove() {\n\t\t\t\tlistener.dispose();\n\t\t\t}\n\t\t});\n\n\t\treturn emitter.event;\n\t}\n\n\t/**\n\t * Debounces the provided event, given a `merge` function.\n\t *\n\t * @param event The input event.\n\t * @param merge The reducing function.\n\t * @param delay The debouncing delay in millis.\n\t * @param leading Whether the event should fire in the leading phase of the timeout.\n\t * @param leakWarningThreshold The leak warning threshold override.\n\t */\n\texport function debounce<T>(event: Event<T>, merge: (last: T | undefined, event: T) => T, delay?: number, leading?: boolean, leakWarningThreshold?: number): Event<T>;\n\texport function debounce<I, O>(event: Event<I>, merge: (last: O | undefined, event: I) => O, delay?: number, leading?: boolean, leakWarningThreshold?: number): Event<O>;\n\texport function debounce<I, O>(event: Event<I>, merge: (last: O | undefined, event: I) => O, delay: number = 100, leading = false, leakWarningThreshold?: number): Event<O> {\n\n\t\tlet subscription: IDisposable;\n\t\tlet output: O | undefined = undefined;\n\t\tlet handle: any = undefined;\n\t\tlet numDebouncedCalls = 0;\n\n\t\tconst emitter = new Emitter<O>({\n\t\t\tleakWarningThreshold,\n\t\t\tonFirstListenerAdd() {\n\t\t\t\tsubscription = event(cur => {\n\t\t\t\t\tnumDebouncedCalls++;\n\t\t\t\t\toutput = merge(output, cur);\n\n\t\t\t\t\tif (leading && !handle) {\n\t\t\t\t\t\temitter.fire(output);\n\t\t\t\t\t\toutput = undefined;\n\t\t\t\t\t}\n\n\t\t\t\t\tclearTimeout(handle);\n\t\t\t\t\thandle = setTimeout(() => {\n\t\t\t\t\t\tconst _output = output;\n\t\t\t\t\t\toutput = undefined;\n\t\t\t\t\t\thandle = undefined;\n\t\t\t\t\t\tif (!leading || numDebouncedCalls > 1) {\n\t\t\t\t\t\t\temitter.fire(_output!);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnumDebouncedCalls = 0;\n\t\t\t\t\t}, delay);\n\t\t\t\t});\n\t\t\t},\n\t\t\tonLastListenerRemove() {\n\t\t\t\tsubscription.dispose();\n\t\t\t}\n\t\t});\n\n\t\treturn emitter.event;\n\t}\n\n\t/**\n\t * Given an event, it returns another event which fires only once and as soon as\n\t * the input event emits. The event data is the number of millis it took for the\n\t * event to fire.\n\t */\n\texport function stopwatch<T>(event: Event<T>): Event<number> {\n\t\tconst start = new Date().getTime();\n\t\treturn map(once(event), _ => new Date().getTime() - start);\n\t}\n\n\t/**\n\t * Given an event, it returns another event which fires only when the event\n\t * element changes.\n\t */\n\texport function latch<T>(event: Event<T>): Event<T> {\n\t\tlet firstCall = true;\n\t\tlet cache: T;\n\n\t\treturn filter(event, value => {\n\t\t\tconst shouldEmit = firstCall || value !== cache;\n\t\t\tfirstCall = false;\n\t\t\tcache = value;\n\t\t\treturn shouldEmit;\n\t\t});\n\t}\n\n\t/**\n\t * Buffers the provided event until a first listener comes\n\t * along, at which point fire all the events at once and\n\t * pipe the event from then on.\n\t *\n\t * ```typescript\n\t * const emitter = new Emitter<number>();\n\t * const event = emitter.event;\n\t * const bufferedEvent = buffer(event);\n\t *\n\t * emitter.fire(1);\n\t * emitter.fire(2);\n\t * emitter.fire(3);\n\t * // nothing...\n\t *\n\t * const listener = bufferedEvent(num => console.log(num));\n\t * // 1, 2, 3\n\t *\n\t * emitter.fire(4);\n\t * // 4\n\t * ```\n\t */\n\texport function buffer<T>(event: Event<T>, nextTick = false, _buffer: T[] = []): Event<T> {\n\t\tlet buffer: T[] | null = _buffer.slice();\n\n\t\tlet listener: IDisposable | null = event(e => {\n\t\t\tif (buffer) {\n\t\t\t\tbuffer.push(e);\n\t\t\t} else {\n\t\t\t\temitter.fire(e);\n\t\t\t}\n\t\t});\n\n\t\tconst flush = () => {\n\t\t\tif (buffer) {\n\t\t\t\tbuffer.forEach(e => emitter.fire(e));\n\t\t\t}\n\t\t\tbuffer = null;\n\t\t};\n\n\t\tconst emitter = new Emitter<T>({\n\t\t\tonFirstListenerAdd() {\n\t\t\t\tif (!listener) {\n\t\t\t\t\tlistener = event(e => emitter.fire(e));\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tonFirstListenerDidAdd() {\n\t\t\t\tif (buffer) {\n\t\t\t\t\tif (nextTick) {\n\t\t\t\t\t\tsetTimeout(flush);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tflush();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tonLastListenerRemove() {\n\t\t\t\tif (listener) {\n\t\t\t\t\tlistener.dispose();\n\t\t\t\t}\n\t\t\t\tlistener = null;\n\t\t\t}\n\t\t});\n\n\t\treturn emitter.event;\n\t}\n\n\texport interface IChainableEvent<T> {\n\t\tevent: Event<T>;\n\t\tmap<O>(fn: (i: T) => O): IChainableEvent<O>;\n\t\tforEach(fn: (i: T) => void): IChainableEvent<T>;\n\t\tfilter(fn: (e: T) => boolean): IChainableEvent<T>;\n\t\tfilter<R>(fn: (e: T | R) => e is R): IChainableEvent<R>;\n\t\treduce<R>(merge: (last: R | undefined, event: T) => R, initial?: R): IChainableEvent<R>;\n\t\tlatch(): IChainableEvent<T>;\n\t\tdebounce(merge: (last: T | undefined, event: T) => T, delay?: number, leading?: boolean, leakWarningThreshold?: number): IChainableEvent<T>;\n\t\tdebounce<R>(merge: (last: R | undefined, event: T) => R, delay?: number, leading?: boolean, leakWarningThreshold?: number): IChainableEvent<R>;\n\t\ton(listener: (e: T) => any, thisArgs?: any, disposables?: IDisposable[] | DisposableStore): IDisposable;\n\t\tonce(listener: (e: T) => any, thisArgs?: any, disposables?: IDisposable[]): IDisposable;\n\t}\n\n\tclass ChainableEvent<T> implements IChainableEvent<T> {\n\n\t\tconstructor(readonly event: Event<T>) { }\n\n\t\tmap<O>(fn: (i: T) => O): IChainableEvent<O> {\n\t\t\treturn new ChainableEvent(map(this.event, fn));\n\t\t}\n\n\t\tforEach(fn: (i: T) => void): IChainableEvent<T> {\n\t\t\treturn new ChainableEvent(forEach(this.event, fn));\n\t\t}\n\n\t\tfilter(fn: (e: T) => boolean): IChainableEvent<T>;\n\t\tfilter<R>(fn: (e: T | R) => e is R): IChainableEvent<R>;\n\t\tfilter(fn: (e: T) => boolean): IChainableEvent<T> {\n\t\t\treturn new ChainableEvent(filter(this.event, fn));\n\t\t}\n\n\t\treduce<R>(merge: (last: R | undefined, event: T) => R, initial?: R): IChainableEvent<R> {\n\t\t\treturn new ChainableEvent(reduce(this.event, merge, initial));\n\t\t}\n\n\t\tlatch(): IChainableEvent<T> {\n\t\t\treturn new ChainableEvent(latch(this.event));\n\t\t}\n\n\t\tdebounce(merge: (last: T | undefined, event: T) => T, delay?: number, leading?: boolean, leakWarningThreshold?: number): IChainableEvent<T>;\n\t\tdebounce<R>(merge: (last: R | undefined, event: T) => R, delay?: number, leading?: boolean, leakWarningThreshold?: number): IChainableEvent<R>;\n\t\tdebounce<R>(merge: (last: R | undefined, event: T) => R, delay: number = 100, leading = false, leakWarningThreshold?: number): IChainableEvent<R> {\n\t\t\treturn new ChainableEvent(debounce(this.event, merge, delay, leading, leakWarningThreshold));\n\t\t}\n\n\t\ton(listener: (e: T) => any, thisArgs: any, disposables: IDisposable[] | DisposableStore) {\n\t\t\treturn this.event(listener, thisArgs, disposables);\n\t\t}\n\n\t\tonce(listener: (e: T) => any, thisArgs: any, disposables: IDisposable[]) {\n\t\t\treturn once(this.event)(listener, thisArgs, disposables);\n\t\t}\n\t}\n\n\texport function chain<T>(event: Event<T>): IChainableEvent<T> {\n\t\treturn new ChainableEvent(event);\n\t}\n\n\texport interface NodeEventEmitter {\n\t\ton(event: string | symbol, listener: Function): unknown;\n\t\tremoveListener(event: string | symbol, listener: Function): unknown;\n\t}\n\n\texport function fromNodeEventEmitter<T>(emitter: NodeEventEmitter, eventName: string, map: (...args: any[]) => T = id => id): Event<T> {\n\t\tconst fn = (...args: any[]) => result.fire(map(...args));\n\t\tconst onFirstListenerAdd = () => emitter.on(eventName, fn);\n\t\tconst onLastListenerRemove = () => emitter.removeListener(eventName, fn);\n\t\tconst result = new Emitter<T>({ onFirstListenerAdd, onLastListenerRemove });\n\n\t\treturn result.event;\n\t}\n\n\texport interface DOMEventEmitter {\n\t\taddEventListener(event: string | symbol, listener: Function): void;\n\t\tremoveEventListener(event: string | symbol, listener: Function): void;\n\t}\n\n\texport function fromDOMEventEmitter<T>(emitter: DOMEventEmitter, eventName: string, map: (...args: any[]) => T = id => id): Event<T> {\n\t\tconst fn = (...args: any[]) => result.fire(map(...args));\n\t\tconst onFirstListenerAdd = () => emitter.addEventListener(eventName, fn);\n\t\tconst onLastListenerRemove = () => emitter.removeEventListener(eventName, fn);\n\t\tconst result = new Emitter<T>({ onFirstListenerAdd, onLastListenerRemove });\n\n\t\treturn result.event;\n\t}\n\n\texport function fromPromise<T = any>(promise: Promise<T>): Event<undefined> {\n\t\tconst emitter = new Emitter<undefined>();\n\t\tlet shouldEmit = false;\n\n\t\tpromise\n\t\t\t.then(undefined, () => null)\n\t\t\t.then(() => {\n\t\t\t\tif (!shouldEmit) {\n\t\t\t\t\tsetTimeout(() => emitter.fire(undefined), 0);\n\t\t\t\t} else {\n\t\t\t\t\temitter.fire(undefined);\n\t\t\t\t}\n\t\t\t});\n\n\t\tshouldEmit = true;\n\t\treturn emitter.event;\n\t}\n\n\texport function toPromise<T>(event: Event<T>): Promise<T> {\n\t\treturn new Promise(resolve => once(event)(resolve));\n\t}\n}\n\ntype Listener<T> = [(e: T) => void, any] | ((e: T) => void);\n\nexport interface EmitterOptions {\n\tonFirstListenerAdd?: Function;\n\tonFirstListenerDidAdd?: Function;\n\tonListenerDidAdd?: Function;\n\tonLastListenerRemove?: Function;\n\tleakWarningThreshold?: number;\n\n\t/** ONLY enable this during development */\n\t_profName?: string\n}\n\n\nclass EventProfiling {\n\n\tprivate static _idPool = 0;\n\n\tprivate _name: string;\n\tprivate _stopWatch?: StopWatch;\n\tprivate _listenerCount: number = 0;\n\tprivate _invocationCount = 0;\n\tprivate _elapsedOverall = 0;\n\n\tconstructor(name: string) {\n\t\tthis._name = `${name}_${EventProfiling._idPool++}`;\n\t}\n\n\tstart(listenerCount: number): void {\n\t\tthis._stopWatch = new StopWatch(true);\n\t\tthis._listenerCount = listenerCount;\n\t}\n\n\tstop(): void {\n\t\tif (this._stopWatch) {\n\t\t\tconst elapsed = this._stopWatch.elapsed();\n\t\t\tthis._elapsedOverall += elapsed;\n\t\t\tthis._invocationCount += 1;\n\n\t\t\tconsole.info(`did FIRE ${this._name}: elapsed_ms: ${elapsed.toFixed(5)}, listener: ${this._listenerCount} (elapsed_overall: ${this._elapsedOverall.toFixed(2)}, invocations: ${this._invocationCount})`);\n\t\t\tthis._stopWatch = undefined;\n\t\t}\n\t}\n}\n\nlet _globalLeakWarningThreshold = -1;\nexport function setGlobalLeakWarningThreshold(n: number): IDisposable {\n\tconst oldValue = _globalLeakWarningThreshold;\n\t_globalLeakWarningThreshold = n;\n\treturn {\n\t\tdispose() {\n\t\t\t_globalLeakWarningThreshold = oldValue;\n\t\t}\n\t};\n}\n\nclass LeakageMonitor {\n\n\tprivate _stacks: Map<string, number> | undefined;\n\tprivate _warnCountdown: number = 0;\n\n\tconstructor(\n\t\treadonly customThreshold?: number,\n\t\treadonly name: string = Math.random().toString(18).slice(2, 5),\n\t) { }\n\n\tdispose(): void {\n\t\tif (this._stacks) {\n\t\t\tthis._stacks.clear();\n\t\t}\n\t}\n\n\tcheck(listenerCount: number): undefined | (() => void) {\n\n\t\tlet threshold = _globalLeakWarningThreshold;\n\t\tif (typeof this.customThreshold === 'number') {\n\t\t\tthreshold = this.customThreshold;\n\t\t}\n\n\t\tif (threshold <= 0 || listenerCount < threshold) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (!this._stacks) {\n\t\t\tthis._stacks = new Map();\n\t\t}\n\t\tconst stack = new Error().stack!.split('\\n').slice(3).join('\\n');\n\t\tconst count = (this._stacks.get(stack) || 0);\n\t\tthis._stacks.set(stack, count + 1);\n\t\tthis._warnCountdown -= 1;\n\n\t\tif (this._warnCountdown <= 0) {\n\t\t\t// only warn on first exceed and then every time the limit\n\t\t\t// is exceeded by 50% again\n\t\t\tthis._warnCountdown = threshold * 0.5;\n\n\t\t\t// find most frequent listener and print warning\n\t\t\tlet topStack: string | undefined;\n\t\t\tlet topCount: number = 0;\n\t\t\tfor (const [stack, count] of this._stacks) {\n\t\t\t\tif (!topStack || topCount < count) {\n\t\t\t\t\ttopStack = stack;\n\t\t\t\t\ttopCount = count;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconsole.warn(`[${this.name}] potential listener LEAK detected, having ${listenerCount} listeners already. MOST frequent listener (${topCount}):`);\n\t\t\tconsole.warn(topStack!);\n\t\t}\n\n\t\treturn () => {\n\t\t\tconst count = (this._stacks!.get(stack) || 0);\n\t\t\tthis._stacks!.set(stack, count - 1);\n\t\t};\n\t}\n}\n\n/**\n * The Emitter can be used to expose an Event to the public\n * to fire it from the insides.\n * Sample:\n\tclass Document {\n\n\t\tprivate readonly _onDidChange = new Emitter<(value:string)=>any>();\n\n\t\tpublic onDidChange = this._onDidChange.event;\n\n\t\t// getter-style\n\t\t// get onDidChange(): Event<(value:string)=>any> {\n\t\t// \treturn this._onDidChange.event;\n\t\t// }\n\n\t\tprivate _doIt() {\n\t\t\t//...\n\t\t\tthis._onDidChange.fire(value);\n\t\t}\n\t}\n */\nexport class Emitter<T> {\n\n\tprivate static readonly _noop = function () { };\n\n\tprivate readonly _options?: EmitterOptions;\n\tprivate readonly _leakageMon?: LeakageMonitor;\n\tprivate readonly _perfMon?: EventProfiling;\n\tprivate _disposed: boolean = false;\n\tprivate _event?: Event<T>;\n\tprivate _deliveryQueue?: LinkedList<[Listener<T>, T]>;\n\tprotected _listeners?: LinkedList<Listener<T>>;\n\n\tconstructor(options?: EmitterOptions) {\n\t\tthis._options = options;\n\t\tthis._leakageMon = _globalLeakWarningThreshold > 0 ? new LeakageMonitor(this._options && this._options.leakWarningThreshold) : undefined;\n\t\tthis._perfMon = this._options?._profName ? new EventProfiling(this._options._profName) : undefined;\n\t}\n\n\t/**\n\t * For the public to allow to subscribe\n\t * to events from this Emitter\n\t */\n\tget event(): Event<T> {\n\t\tif (!this._event) {\n\t\t\tthis._event = (listener: (e: T) => any, thisArgs?: any, disposables?: IDisposable[] | DisposableStore) => {\n\t\t\t\tif (!this._listeners) {\n\t\t\t\t\tthis._listeners = new LinkedList();\n\t\t\t\t}\n\n\t\t\t\tconst firstListener = this._listeners.isEmpty();\n\n\t\t\t\tif (firstListener && this._options && this._options.onFirstListenerAdd) {\n\t\t\t\t\tthis._options.onFirstListenerAdd(this);\n\t\t\t\t}\n\n\t\t\t\tconst remove = this._listeners.push(!thisArgs ? listener : [listener, thisArgs]);\n\n\t\t\t\tif (firstListener && this._options && this._options.onFirstListenerDidAdd) {\n\t\t\t\t\tthis._options.onFirstListenerDidAdd(this);\n\t\t\t\t}\n\n\t\t\t\tif (this._options && this._options.onListenerDidAdd) {\n\t\t\t\t\tthis._options.onListenerDidAdd(this, listener, thisArgs);\n\t\t\t\t}\n\n\t\t\t\t// check and record this emitter for potential leakage\n\t\t\t\tconst removeMonitor = this._leakageMon?.check(this._listeners.size);\n\n\t\t\t\tlet result: IDisposable;\n\t\t\t\tresult = {\n\t\t\t\t\tdispose: () => {\n\t\t\t\t\t\tif (removeMonitor) {\n\t\t\t\t\t\t\tremoveMonitor();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresult.dispose = Emitter._noop;\n\t\t\t\t\t\tif (!this._disposed) {\n\t\t\t\t\t\t\tremove();\n\t\t\t\t\t\t\tif (this._options && this._options.onLastListenerRemove) {\n\t\t\t\t\t\t\t\tconst hasListeners = (this._listeners && !this._listeners.isEmpty());\n\t\t\t\t\t\t\t\tif (!hasListeners) {\n\t\t\t\t\t\t\t\t\tthis._options.onLastListenerRemove(this);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tif (disposables instanceof DisposableStore) {\n\t\t\t\t\tdisposables.add(result);\n\t\t\t\t} else if (Array.isArray(disposables)) {\n\t\t\t\t\tdisposables.push(result);\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t};\n\t\t}\n\t\treturn this._event;\n\t}\n\n\t/**\n\t * To be kept private to fire an event to\n\t * subscribers\n\t */\n\tfire(event: T): void {\n\t\tif (this._listeners) {\n\t\t\t// put all [listener,event]-pairs into delivery queue\n\t\t\t// then emit all event. an inner/nested event might be\n\t\t\t// the driver of this\n\n\t\t\tif (!this._deliveryQueue) {\n\t\t\t\tthis._deliveryQueue = new LinkedList();\n\t\t\t}\n\n\t\t\tfor (let listener of this._listeners) {\n\t\t\t\tthis._deliveryQueue.push([listener, event]);\n\t\t\t}\n\n\t\t\t// start/stop performance insight collection\n\t\t\tthis._perfMon?.start(this._deliveryQueue.size);\n\n\t\t\twhile (this._deliveryQueue.size > 0) {\n\t\t\t\tconst [listener, event] = this._deliveryQueue.shift()!;\n\t\t\t\ttry {\n\t\t\t\t\tif (typeof listener === 'function') {\n\t\t\t\t\t\tlistener.call(undefined, event);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlistener[0].call(listener[1], event);\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tonUnexpectedError(e);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._perfMon?.stop();\n\t\t}\n\t}\n\n\tdispose() {\n\t\tthis._listeners?.clear();\n\t\tthis._deliveryQueue?.clear();\n\t\tthis._leakageMon?.dispose();\n\t\tthis._disposed = true;\n\t}\n}\n\nexport class PauseableEmitter<T> extends Emitter<T> {\n\n\tprivate _isPaused = 0;\n\tprivate _eventQueue = new LinkedList<T>();\n\tprivate _mergeFn?: (input: T[]) => T;\n\n\tconstructor(options?: EmitterOptions & { merge?: (input: T[]) => T }) {\n\t\tsuper(options);\n\t\tthis._mergeFn = options?.merge;\n\t}\n\n\tpause(): void {\n\t\tthis._isPaused++;\n\t}\n\n\tresume(): void {\n\t\tif (this._isPaused !== 0 && --this._isPaused === 0) {\n\t\t\tif (this._mergeFn) {\n\t\t\t\t// use the merge function to create a single composite\n\t\t\t\t// event. make a copy in case firing pauses this emitter\n\t\t\t\tconst events = Array.from(this._eventQueue);\n\t\t\t\tthis._eventQueue.clear();\n\t\t\t\tsuper.fire(this._mergeFn(events));\n\n\t\t\t} else {\n\t\t\t\t// no merging, fire each event individually and test\n\t\t\t\t// that this emitter isn't paused halfway through\n\t\t\t\twhile (!this._isPaused && this._eventQueue.size !== 0) {\n\t\t\t\t\tsuper.fire(this._eventQueue.shift()!);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfire(event: T): void {\n\t\tif (this._listeners) {\n\t\t\tif (this._isPaused !== 0) {\n\t\t\t\tthis._eventQueue.push(event);\n\t\t\t} else {\n\t\t\t\tsuper.fire(event);\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport interface IWaitUntil {\n\twaitUntil(thenable: Promise<any>): void;\n}\n\nexport class AsyncEmitter<T extends IWaitUntil> extends Emitter<T> {\n\n\tprivate _asyncDeliveryQueue?: LinkedList<[Listener<T>, Omit<T, 'waitUntil'>]>;\n\n\tasync fireAsync(data: Omit<T, 'waitUntil'>, token: CancellationToken, promiseJoin?: (p: Promise<any>, listener: Function) => Promise<any>): Promise<void> {\n\t\tif (!this._listeners) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._asyncDeliveryQueue) {\n\t\t\tthis._asyncDeliveryQueue = new LinkedList();\n\t\t}\n\n\t\tfor (const listener of this._listeners) {\n\t\t\tthis._asyncDeliveryQueue.push([listener, data]);\n\t\t}\n\n\t\twhile (this._asyncDeliveryQueue.size > 0 && !token.isCancellationRequested) {\n\n\t\t\tconst [listener, data] = this._asyncDeliveryQueue.shift()!;\n\t\t\tconst thenables: Promise<any>[] = [];\n\n\t\t\tconst event = <T>{\n\t\t\t\t...data,\n\t\t\t\twaitUntil: (p: Promise<any>): void => {\n\t\t\t\t\tif (Object.isFrozen(thenables)) {\n\t\t\t\t\t\tthrow new Error('waitUntil can NOT be called asynchronous');\n\t\t\t\t\t}\n\t\t\t\t\tif (promiseJoin) {\n\t\t\t\t\t\tp = promiseJoin(p, typeof listener === 'function' ? listener : listener[0]);\n\t\t\t\t\t}\n\t\t\t\t\tthenables.push(p);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\ttry {\n\t\t\t\tif (typeof listener === 'function') {\n\t\t\t\t\tlistener.call(undefined, event);\n\t\t\t\t} else {\n\t\t\t\t\tlistener[0].call(listener[1], event);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tonUnexpectedError(e);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// freeze thenables-collection to enforce sync-calls to\n\t\t\t// wait until and then wait for all thenables to resolve\n\t\t\tObject.freeze(thenables);\n\t\t\tawait Promise.all(thenables).catch(e => onUnexpectedError(e));\n\t\t}\n\t}\n}\n\nexport class EventMultiplexer<T> implements IDisposable {\n\n\tprivate readonly emitter: Emitter<T>;\n\tprivate hasListeners = false;\n\tprivate events: { event: Event<T>; listener: IDisposable | null; }[] = [];\n\n\tconstructor() {\n\t\tthis.emitter = new Emitter<T>({\n\t\t\tonFirstListenerAdd: () => this.onFirstListenerAdd(),\n\t\t\tonLastListenerRemove: () => this.onLastListenerRemove()\n\t\t});\n\t}\n\n\tget event(): Event<T> {\n\t\treturn this.emitter.event;\n\t}\n\n\tadd(event: Event<T>): IDisposable {\n\t\tconst e = { event: event, listener: null };\n\t\tthis.events.push(e);\n\n\t\tif (this.hasListeners) {\n\t\t\tthis.hook(e);\n\t\t}\n\n\t\tconst dispose = () => {\n\t\t\tif (this.hasListeners) {\n\t\t\t\tthis.unhook(e);\n\t\t\t}\n\n\t\t\tconst idx = this.events.indexOf(e);\n\t\t\tthis.events.splice(idx, 1);\n\t\t};\n\n\t\treturn toDisposable(onceFn(dispose));\n\t}\n\n\tprivate onFirstListenerAdd(): void {\n\t\tthis.hasListeners = true;\n\t\tthis.events.forEach(e => this.hook(e));\n\t}\n\n\tprivate onLastListenerRemove(): void {\n\t\tthis.hasListeners = false;\n\t\tthis.events.forEach(e => this.unhook(e));\n\t}\n\n\tprivate hook(e: { event: Event<T>; listener: IDisposable | null; }): void {\n\t\te.listener = e.event(r => this.emitter.fire(r));\n\t}\n\n\tprivate unhook(e: { event: Event<T>; listener: IDisposable | null; }): void {\n\t\tif (e.listener) {\n\t\t\te.listener.dispose();\n\t\t}\n\t\te.listener = null;\n\t}\n\n\tdispose(): void {\n\t\tthis.emitter.dispose();\n\t}\n}\n\n/**\n * The EventBufferer is useful in situations in which you want\n * to delay firing your events during some code.\n * You can wrap that code and be sure that the event will not\n * be fired during that wrap.\n *\n * ```\n * const emitter: Emitter;\n * const delayer = new EventDelayer();\n * const delayedEvent = delayer.wrapEvent(emitter.event);\n *\n * delayedEvent(console.log);\n *\n * delayer.bufferEvents(() => {\n *   emitter.fire(); // event will not be fired yet\n * });\n *\n * // event will only be fired at this point\n * ```\n */\nexport class EventBufferer {\n\n\tprivate buffers: Function[][] = [];\n\n\twrapEvent<T>(event: Event<T>): Event<T> {\n\t\treturn (listener, thisArgs?, disposables?) => {\n\t\t\treturn event(i => {\n\t\t\t\tconst buffer = this.buffers[this.buffers.length - 1];\n\n\t\t\t\tif (buffer) {\n\t\t\t\t\tbuffer.push(() => listener.call(thisArgs, i));\n\t\t\t\t} else {\n\t\t\t\t\tlistener.call(thisArgs, i);\n\t\t\t\t}\n\t\t\t}, undefined, disposables);\n\t\t};\n\t}\n\n\tbufferEvents<R = void>(fn: () => R): R {\n\t\tconst buffer: Array<() => R> = [];\n\t\tthis.buffers.push(buffer);\n\t\tconst r = fn();\n\t\tthis.buffers.pop();\n\t\tbuffer.forEach(flush => flush());\n\t\treturn r;\n\t}\n}\n\n/**\n * A Relay is an event forwarder which functions as a replugabble event pipe.\n * Once created, you can connect an input event to it and it will simply forward\n * events from that input event through its own `event` property. The `input`\n * can be changed at any point in time.\n */\nexport class Relay<T> implements IDisposable {\n\n\tprivate listening = false;\n\tprivate inputEvent: Event<T> = Event.None;\n\tprivate inputEventListener: IDisposable = Disposable.None;\n\n\tprivate readonly emitter = new Emitter<T>({\n\t\tonFirstListenerDidAdd: () => {\n\t\t\tthis.listening = true;\n\t\t\tthis.inputEventListener = this.inputEvent(this.emitter.fire, this.emitter);\n\t\t},\n\t\tonLastListenerRemove: () => {\n\t\t\tthis.listening = false;\n\t\t\tthis.inputEventListener.dispose();\n\t\t}\n\t});\n\n\treadonly event: Event<T> = this.emitter.event;\n\n\tset input(event: Event<T>) {\n\t\tthis.inputEvent = event;\n\n\t\tif (this.listening) {\n\t\t\tthis.inputEventListener.dispose();\n\t\t\tthis.inputEventListener = event(this.emitter.fire, this.emitter);\n\t\t}\n\t}\n\n\tdispose() {\n\t\tthis.inputEventListener.dispose();\n\t\tthis.emitter.dispose();\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { IDisposable } from 'vs/base/common/lifecycle';\n\nexport interface CancellationToken {\n\n\t/**\n\t * A flag signalling is cancellation has been requested.\n\t */\n\treadonly isCancellationRequested: boolean;\n\n\t/**\n\t * An event which fires when cancellation is requested. This event\n\t * only ever fires `once` as cancellation can only happen once. Listeners\n\t * that are registered after cancellation will be called (next event loop run),\n\t * but also only once.\n\t *\n\t * @event\n\t */\n\treadonly onCancellationRequested: (listener: (e: any) => any, thisArgs?: any, disposables?: IDisposable[]) => IDisposable;\n}\n\nconst shortcutEvent: Event<any> = Object.freeze(function (callback, context?): IDisposable {\n\tconst handle = setTimeout(callback.bind(context), 0);\n\treturn { dispose() { clearTimeout(handle); } };\n});\n\nexport namespace CancellationToken {\n\n\texport function isCancellationToken(thing: unknown): thing is CancellationToken {\n\t\tif (thing === CancellationToken.None || thing === CancellationToken.Cancelled) {\n\t\t\treturn true;\n\t\t}\n\t\tif (thing instanceof MutableToken) {\n\t\t\treturn true;\n\t\t}\n\t\tif (!thing || typeof thing !== 'object') {\n\t\t\treturn false;\n\t\t}\n\t\treturn typeof (thing as CancellationToken).isCancellationRequested === 'boolean'\n\t\t\t&& typeof (thing as CancellationToken).onCancellationRequested === 'function';\n\t}\n\n\n\texport const None: CancellationToken = Object.freeze({\n\t\tisCancellationRequested: false,\n\t\tonCancellationRequested: Event.None\n\t});\n\n\texport const Cancelled: CancellationToken = Object.freeze({\n\t\tisCancellationRequested: true,\n\t\tonCancellationRequested: shortcutEvent\n\t});\n}\n\nclass MutableToken implements CancellationToken {\n\n\tprivate _isCancelled: boolean = false;\n\tprivate _emitter: Emitter<any> | null = null;\n\n\tpublic cancel() {\n\t\tif (!this._isCancelled) {\n\t\t\tthis._isCancelled = true;\n\t\t\tif (this._emitter) {\n\t\t\t\tthis._emitter.fire(undefined);\n\t\t\t\tthis.dispose();\n\t\t\t}\n\t\t}\n\t}\n\n\tget isCancellationRequested(): boolean {\n\t\treturn this._isCancelled;\n\t}\n\n\tget onCancellationRequested(): Event<any> {\n\t\tif (this._isCancelled) {\n\t\t\treturn shortcutEvent;\n\t\t}\n\t\tif (!this._emitter) {\n\t\t\tthis._emitter = new Emitter<any>();\n\t\t}\n\t\treturn this._emitter.event;\n\t}\n\n\tpublic dispose(): void {\n\t\tif (this._emitter) {\n\t\t\tthis._emitter.dispose();\n\t\t\tthis._emitter = null;\n\t\t}\n\t}\n}\n\nexport class CancellationTokenSource {\n\n\tprivate _token?: CancellationToken = undefined;\n\tprivate _parentListener?: IDisposable = undefined;\n\n\tconstructor(parent?: CancellationToken) {\n\t\tthis._parentListener = parent && parent.onCancellationRequested(this.cancel, this);\n\t}\n\n\tget token(): CancellationToken {\n\t\tif (!this._token) {\n\t\t\t// be lazy and create the token only when\n\t\t\t// actually needed\n\t\t\tthis._token = new MutableToken();\n\t\t}\n\t\treturn this._token;\n\t}\n\n\tcancel(): void {\n\t\tif (!this._token) {\n\t\t\t// save an object by returning the default\n\t\t\t// cancelled token when cancellation happens\n\t\t\t// before someone asks for the token\n\t\t\tthis._token = CancellationToken.Cancelled;\n\n\t\t} else if (this._token instanceof MutableToken) {\n\t\t\t// actually cancel\n\t\t\tthis._token.cancel();\n\t\t}\n\t}\n\n\tdispose(cancel: boolean = false): void {\n\t\tif (cancel) {\n\t\t\tthis.cancel();\n\t\t}\n\t\tif (this._parentListener) {\n\t\t\tthis._parentListener.dispose();\n\t\t}\n\t\tif (!this._token) {\n\t\t\t// ensure to initialize with an empty token if we had none\n\t\t\tthis._token = CancellationToken.None;\n\n\t\t} else if (this._token instanceof MutableToken) {\n\t\t\t// actually dispose\n\t\t\tthis._token.dispose();\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken, CancellationTokenSource } from 'vs/base/common/cancellation';\nimport * as errors from 'vs/base/common/errors';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { IDisposable, toDisposable } from 'vs/base/common/lifecycle';\nimport { URI } from 'vs/base/common/uri';\n\nexport function isThenable<T>(obj: any): obj is Promise<T> {\n\treturn obj && typeof (<Promise<any>>obj).then === 'function';\n}\n\nexport interface CancelablePromise<T> extends Promise<T> {\n\tcancel(): void;\n}\n\nexport function createCancelablePromise<T>(callback: (token: CancellationToken) => Promise<T>): CancelablePromise<T> {\n\tconst source = new CancellationTokenSource();\n\n\tconst thenable = callback(source.token);\n\tconst promise = new Promise<T>((resolve, reject) => {\n\t\tsource.token.onCancellationRequested(() => {\n\t\t\treject(errors.canceled());\n\t\t});\n\t\tPromise.resolve(thenable).then(value => {\n\t\t\tsource.dispose();\n\t\t\tresolve(value);\n\t\t}, err => {\n\t\t\tsource.dispose();\n\t\t\treject(err);\n\t\t});\n\t});\n\n\treturn <CancelablePromise<T>>new class {\n\t\tcancel() {\n\t\t\tsource.cancel();\n\t\t}\n\t\tthen<TResult1 = T, TResult2 = never>(resolve?: ((value: T) => TResult1 | Promise<TResult1>) | undefined | null, reject?: ((reason: any) => TResult2 | Promise<TResult2>) | undefined | null): Promise<TResult1 | TResult2> {\n\t\t\treturn promise.then(resolve, reject);\n\t\t}\n\t\tcatch<TResult = never>(reject?: ((reason: any) => TResult | Promise<TResult>) | undefined | null): Promise<T | TResult> {\n\t\t\treturn this.then(undefined, reject);\n\t\t}\n\t\tfinally(onfinally?: (() => void) | undefined | null): Promise<T> {\n\t\t\treturn promise.finally(onfinally);\n\t\t}\n\t};\n}\n\nexport function raceCancellation<T>(promise: Promise<T>, token: CancellationToken): Promise<T | undefined>;\nexport function raceCancellation<T>(promise: Promise<T>, token: CancellationToken, defaultValue: T): Promise<T>;\nexport function raceCancellation<T>(promise: Promise<T>, token: CancellationToken, defaultValue?: T): Promise<T | undefined> {\n\treturn Promise.race([promise, new Promise<T | undefined>(resolve => token.onCancellationRequested(() => resolve(defaultValue)))]);\n}\n\n/**\n * Returns as soon as one of the promises is resolved and cancels remaining promises\n */\nexport async function raceCancellablePromises<T>(cancellablePromises: CancelablePromise<T>[]): Promise<T> {\n\tlet resolvedPromiseIndex = -1;\n\tconst promises = cancellablePromises.map((promise, index) => promise.then(result => { resolvedPromiseIndex = index; return result; }));\n\tconst result = await Promise.race(promises);\n\tcancellablePromises.forEach((cancellablePromise, index) => {\n\t\tif (index !== resolvedPromiseIndex) {\n\t\t\tcancellablePromise.cancel();\n\t\t}\n\t});\n\treturn result;\n}\n\nexport function raceTimeout<T>(promise: Promise<T>, timeout: number, onTimeout?: () => void): Promise<T | undefined> {\n\tlet promiseResolve: ((value: T | undefined) => void) | undefined = undefined;\n\n\tconst timer = setTimeout(() => {\n\t\tpromiseResolve?.(undefined);\n\t\tonTimeout?.();\n\t}, timeout);\n\n\treturn Promise.race([\n\t\tpromise.finally(() => clearTimeout(timer)),\n\t\tnew Promise<T | undefined>(resolve => promiseResolve = resolve)\n\t]);\n}\n\nexport function asPromise<T>(callback: () => T | Thenable<T>): Promise<T> {\n\treturn new Promise<T>((resolve, reject) => {\n\t\tconst item = callback();\n\t\tif (isThenable<T>(item)) {\n\t\t\titem.then(resolve, reject);\n\t\t} else {\n\t\t\tresolve(item);\n\t\t}\n\t});\n}\n\nexport interface ITask<T> {\n\t(): T;\n}\n\n/**\n * A helper to prevent accumulation of sequential async tasks.\n *\n * Imagine a mail man with the sole task of delivering letters. As soon as\n * a letter submitted for delivery, he drives to the destination, delivers it\n * and returns to his base. Imagine that during the trip, N more letters were submitted.\n * When the mail man returns, he picks those N letters and delivers them all in a\n * single trip. Even though N+1 submissions occurred, only 2 deliveries were made.\n *\n * The throttler implements this via the queue() method, by providing it a task\n * factory. Following the example:\n *\n * \t\tconst throttler = new Throttler();\n * \t\tconst letters = [];\n *\n * \t\tfunction deliver() {\n * \t\t\tconst lettersToDeliver = letters;\n * \t\t\tletters = [];\n * \t\t\treturn makeTheTrip(lettersToDeliver);\n * \t\t}\n *\n * \t\tfunction onLetterReceived(l) {\n * \t\t\tletters.push(l);\n * \t\t\tthrottler.queue(deliver);\n * \t\t}\n */\nexport class Throttler {\n\n\tprivate activePromise: Promise<any> | null;\n\tprivate queuedPromise: Promise<any> | null;\n\tprivate queuedPromiseFactory: ITask<Promise<any>> | null;\n\n\tconstructor() {\n\t\tthis.activePromise = null;\n\t\tthis.queuedPromise = null;\n\t\tthis.queuedPromiseFactory = null;\n\t}\n\n\tqueue<T>(promiseFactory: ITask<Promise<T>>): Promise<T> {\n\t\tif (this.activePromise) {\n\t\t\tthis.queuedPromiseFactory = promiseFactory;\n\n\t\t\tif (!this.queuedPromise) {\n\t\t\t\tconst onComplete = () => {\n\t\t\t\t\tthis.queuedPromise = null;\n\n\t\t\t\t\tconst result = this.queue(this.queuedPromiseFactory!);\n\t\t\t\t\tthis.queuedPromiseFactory = null;\n\n\t\t\t\t\treturn result;\n\t\t\t\t};\n\n\t\t\t\tthis.queuedPromise = new Promise(resolve => {\n\t\t\t\t\tthis.activePromise!.then(onComplete, onComplete).then(resolve);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tthis.queuedPromise!.then(resolve, reject);\n\t\t\t});\n\t\t}\n\n\t\tthis.activePromise = promiseFactory();\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.activePromise!.then((result: any) => {\n\t\t\t\tthis.activePromise = null;\n\t\t\t\tresolve(result);\n\t\t\t}, (err: any) => {\n\t\t\t\tthis.activePromise = null;\n\t\t\t\treject(err);\n\t\t\t});\n\t\t});\n\t}\n}\n\nexport class Sequencer {\n\n\tprivate current: Promise<any> = Promise.resolve(null);\n\n\tqueue<T>(promiseTask: ITask<Promise<T>>): Promise<T> {\n\t\treturn this.current = this.current.then(() => promiseTask(), () => promiseTask());\n\t}\n}\n\nexport class SequencerByKey<TKey> {\n\n\tprivate promiseMap = new Map<TKey, Promise<any>>();\n\n\tqueue<T>(key: TKey, promiseTask: ITask<Promise<T>>): Promise<T> {\n\t\tconst runningPromise = this.promiseMap.get(key) ?? Promise.resolve();\n\t\tconst newPromise = runningPromise\n\t\t\t.catch(() => { })\n\t\t\t.then(promiseTask)\n\t\t\t.finally(() => {\n\t\t\t\tif (this.promiseMap.get(key) === newPromise) {\n\t\t\t\t\tthis.promiseMap.delete(key);\n\t\t\t\t}\n\t\t\t});\n\t\tthis.promiseMap.set(key, newPromise);\n\t\treturn newPromise;\n\t}\n}\n\n/**\n * A helper to delay (debounce) execution of a task that is being requested often.\n *\n * Following the throttler, now imagine the mail man wants to optimize the number of\n * trips proactively. The trip itself can be long, so he decides not to make the trip\n * as soon as a letter is submitted. Instead he waits a while, in case more\n * letters are submitted. After said waiting period, if no letters were submitted, he\n * decides to make the trip. Imagine that N more letters were submitted after the first\n * one, all within a short period of time between each other. Even though N+1\n * submissions occurred, only 1 delivery was made.\n *\n * The delayer offers this behavior via the trigger() method, into which both the task\n * to be executed and the waiting period (delay) must be passed in as arguments. Following\n * the example:\n *\n * \t\tconst delayer = new Delayer(WAITING_PERIOD);\n * \t\tconst letters = [];\n *\n * \t\tfunction letterReceived(l) {\n * \t\t\tletters.push(l);\n * \t\t\tdelayer.trigger(() => { return makeTheTrip(); });\n * \t\t}\n */\nexport class Delayer<T> implements IDisposable {\n\n\tprivate timeout: any;\n\tprivate completionPromise: Promise<any> | null;\n\tprivate doResolve: ((value?: any | Promise<any>) => void) | null;\n\tprivate doReject: ((err: any) => void) | null;\n\tprivate task: ITask<T | Promise<T>> | null;\n\n\tconstructor(public defaultDelay: number) {\n\t\tthis.timeout = null;\n\t\tthis.completionPromise = null;\n\t\tthis.doResolve = null;\n\t\tthis.doReject = null;\n\t\tthis.task = null;\n\t}\n\n\ttrigger(task: ITask<T | Promise<T>>, delay: number = this.defaultDelay): Promise<T> {\n\t\tthis.task = task;\n\t\tthis.cancelTimeout();\n\n\t\tif (!this.completionPromise) {\n\t\t\tthis.completionPromise = new Promise((resolve, reject) => {\n\t\t\t\tthis.doResolve = resolve;\n\t\t\t\tthis.doReject = reject;\n\t\t\t}).then(() => {\n\t\t\t\tthis.completionPromise = null;\n\t\t\t\tthis.doResolve = null;\n\t\t\t\tif (this.task) {\n\t\t\t\t\tconst task = this.task;\n\t\t\t\t\tthis.task = null;\n\t\t\t\t\treturn task();\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t});\n\t\t}\n\n\t\tthis.timeout = setTimeout(() => {\n\t\t\tthis.timeout = null;\n\t\t\tif (this.doResolve) {\n\t\t\t\tthis.doResolve(null);\n\t\t\t}\n\t\t}, delay);\n\n\t\treturn this.completionPromise;\n\t}\n\n\tisTriggered(): boolean {\n\t\treturn this.timeout !== null;\n\t}\n\n\tcancel(): void {\n\t\tthis.cancelTimeout();\n\n\t\tif (this.completionPromise) {\n\t\t\tif (this.doReject) {\n\t\t\t\tthis.doReject(errors.canceled());\n\t\t\t}\n\t\t\tthis.completionPromise = null;\n\t\t}\n\t}\n\n\tprivate cancelTimeout(): void {\n\t\tif (this.timeout !== null) {\n\t\t\tclearTimeout(this.timeout);\n\t\t\tthis.timeout = null;\n\t\t}\n\t}\n\n\tdispose(): void {\n\t\tthis.cancelTimeout();\n\t}\n}\n\n/**\n * A helper to delay execution of a task that is being requested often, while\n * preventing accumulation of consecutive executions, while the task runs.\n *\n * The mail man is clever and waits for a certain amount of time, before going\n * out to deliver letters. While the mail man is going out, more letters arrive\n * and can only be delivered once he is back. Once he is back the mail man will\n * do one more trip to deliver the letters that have accumulated while he was out.\n */\nexport class ThrottledDelayer<T> {\n\n\tprivate delayer: Delayer<Promise<T>>;\n\tprivate throttler: Throttler;\n\n\tconstructor(defaultDelay: number) {\n\t\tthis.delayer = new Delayer(defaultDelay);\n\t\tthis.throttler = new Throttler();\n\t}\n\n\ttrigger(promiseFactory: ITask<Promise<T>>, delay?: number): Promise<T> {\n\t\treturn this.delayer.trigger(() => this.throttler.queue(promiseFactory), delay) as any as Promise<T>;\n\t}\n\n\tisTriggered(): boolean {\n\t\treturn this.delayer.isTriggered();\n\t}\n\n\tcancel(): void {\n\t\tthis.delayer.cancel();\n\t}\n\n\tdispose(): void {\n\t\tthis.delayer.dispose();\n\t}\n}\n\n/**\n * A barrier that is initially closed and then becomes opened permanently.\n */\nexport class Barrier {\n\n\tprivate _isOpen: boolean;\n\tprivate _promise: Promise<boolean>;\n\tprivate _completePromise!: (v: boolean) => void;\n\n\tconstructor() {\n\t\tthis._isOpen = false;\n\t\tthis._promise = new Promise<boolean>((c, e) => {\n\t\t\tthis._completePromise = c;\n\t\t});\n\t}\n\n\tisOpen(): boolean {\n\t\treturn this._isOpen;\n\t}\n\n\topen(): void {\n\t\tthis._isOpen = true;\n\t\tthis._completePromise(true);\n\t}\n\n\twait(): Promise<boolean> {\n\t\treturn this._promise;\n\t}\n}\n\nexport function timeout(millis: number): CancelablePromise<void>;\nexport function timeout(millis: number, token: CancellationToken): Promise<void>;\nexport function timeout(millis: number, token?: CancellationToken): CancelablePromise<void> | Promise<void> {\n\tif (!token) {\n\t\treturn createCancelablePromise(token => timeout(millis, token));\n\t}\n\n\treturn new Promise((resolve, reject) => {\n\t\tconst handle = setTimeout(resolve, millis);\n\t\ttoken.onCancellationRequested(() => {\n\t\t\tclearTimeout(handle);\n\t\t\treject(errors.canceled());\n\t\t});\n\t});\n}\n\nexport function disposableTimeout(handler: () => void, timeout = 0): IDisposable {\n\tconst timer = setTimeout(handler, timeout);\n\treturn toDisposable(() => clearTimeout(timer));\n}\n\nexport function ignoreErrors<T>(promise: Promise<T>): Promise<T | undefined> {\n\treturn promise.then(undefined, _ => undefined);\n}\n\n/**\n * Runs the provided list of promise factories in sequential order. The returned\n * promise will complete to an array of results from each promise.\n */\n\nexport function sequence<T>(promiseFactories: ITask<Promise<T>>[]): Promise<T[]> {\n\tconst results: T[] = [];\n\tlet index = 0;\n\tconst len = promiseFactories.length;\n\n\tfunction next(): Promise<T> | null {\n\t\treturn index < len ? promiseFactories[index++]() : null;\n\t}\n\n\tfunction thenHandler(result: any): Promise<any> {\n\t\tif (result !== undefined && result !== null) {\n\t\t\tresults.push(result);\n\t\t}\n\n\t\tconst n = next();\n\t\tif (n) {\n\t\t\treturn n.then(thenHandler);\n\t\t}\n\n\t\treturn Promise.resolve(results);\n\t}\n\n\treturn Promise.resolve(null).then(thenHandler);\n}\n\nexport function first<T>(promiseFactories: ITask<Promise<T>>[], shouldStop: (t: T) => boolean = t => !!t, defaultValue: T | null = null): Promise<T | null> {\n\tlet index = 0;\n\tconst len = promiseFactories.length;\n\n\tconst loop: () => Promise<T | null> = () => {\n\t\tif (index >= len) {\n\t\t\treturn Promise.resolve(defaultValue);\n\t\t}\n\n\t\tconst factory = promiseFactories[index++];\n\t\tconst promise = Promise.resolve(factory());\n\n\t\treturn promise.then(result => {\n\t\t\tif (shouldStop(result)) {\n\t\t\t\treturn Promise.resolve(result);\n\t\t\t}\n\n\t\t\treturn loop();\n\t\t});\n\t};\n\n\treturn loop();\n}\n\n/**\n * Returns the result of the first promise that matches the \"shouldStop\",\n * running all promises in parallel. Supports cancelable promises.\n */\nexport function firstParallel<T>(promiseList: Promise<T>[], shouldStop?: (t: T) => boolean, defaultValue?: T | null): Promise<T | null>;\nexport function firstParallel<T, R extends T>(promiseList: Promise<T>[], shouldStop: (t: T) => t is R, defaultValue?: R | null): Promise<R | null>;\nexport function firstParallel<T>(promiseList: Promise<T>[], shouldStop: (t: T) => boolean = t => !!t, defaultValue: T | null = null) {\n\tif (promiseList.length === 0) {\n\t\treturn Promise.resolve(defaultValue);\n\t}\n\n\tlet todo = promiseList.length;\n\tconst finish = () => {\n\t\ttodo = -1;\n\t\tfor (const promise of promiseList) {\n\t\t\t(promise as Partial<CancelablePromise<T>>).cancel?.();\n\t\t}\n\t};\n\n\treturn new Promise<T | null>((resolve, reject) => {\n\t\tfor (const promise of promiseList) {\n\t\t\tpromise.then(result => {\n\t\t\t\tif (--todo >= 0 && shouldStop(result)) {\n\t\t\t\t\tfinish();\n\t\t\t\t\tresolve(result);\n\t\t\t\t} else if (todo === 0) {\n\t\t\t\t\tresolve(defaultValue);\n\t\t\t\t}\n\t\t\t})\n\t\t\t\t.catch(err => {\n\t\t\t\t\tif (--todo >= 0) {\n\t\t\t\t\t\tfinish();\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t}\n\t});\n}\n\ninterface ILimitedTaskFactory<T> {\n\tfactory: ITask<Promise<T>>;\n\tc: (value: T | Promise<T>) => void;\n\te: (error?: any) => void;\n}\n\n/**\n * A helper to queue N promises and run them all with a max degree of parallelism. The helper\n * ensures that at any time no more than M promises are running at the same time.\n */\nexport class Limiter<T> {\n\n\tprivate _size = 0;\n\tprivate runningPromises: number;\n\tprivate maxDegreeOfParalellism: number;\n\tprivate outstandingPromises: ILimitedTaskFactory<T>[];\n\tprivate readonly _onFinished: Emitter<void>;\n\n\tconstructor(maxDegreeOfParalellism: number) {\n\t\tthis.maxDegreeOfParalellism = maxDegreeOfParalellism;\n\t\tthis.outstandingPromises = [];\n\t\tthis.runningPromises = 0;\n\t\tthis._onFinished = new Emitter<void>();\n\t}\n\n\tget onFinished(): Event<void> {\n\t\treturn this._onFinished.event;\n\t}\n\n\tget size(): number {\n\t\treturn this._size;\n\t\t// return this.runningPromises + this.outstandingPromises.length;\n\t}\n\n\tqueue(factory: ITask<Promise<T>>): Promise<T> {\n\t\tthis._size++;\n\n\t\treturn new Promise<T>((c, e) => {\n\t\t\tthis.outstandingPromises.push({ factory, c, e });\n\t\t\tthis.consume();\n\t\t});\n\t}\n\n\tprivate consume(): void {\n\t\twhile (this.outstandingPromises.length && this.runningPromises < this.maxDegreeOfParalellism) {\n\t\t\tconst iLimitedTask = this.outstandingPromises.shift()!;\n\t\t\tthis.runningPromises++;\n\n\t\t\tconst promise = iLimitedTask.factory();\n\t\t\tpromise.then(iLimitedTask.c, iLimitedTask.e);\n\t\t\tpromise.then(() => this.consumed(), () => this.consumed());\n\t\t}\n\t}\n\n\tprivate consumed(): void {\n\t\tthis._size--;\n\t\tthis.runningPromises--;\n\n\t\tif (this.outstandingPromises.length > 0) {\n\t\t\tthis.consume();\n\t\t} else {\n\t\t\tthis._onFinished.fire();\n\t\t}\n\t}\n\n\tdispose(): void {\n\t\tthis._onFinished.dispose();\n\t}\n}\n\n/**\n * A queue is handles one promise at a time and guarantees that at any time only one promise is executing.\n */\nexport class Queue<T> extends Limiter<T> {\n\n\tconstructor() {\n\t\tsuper(1);\n\t}\n}\n\n/**\n * A helper to organize queues per resource. The ResourceQueue makes sure to manage queues per resource\n * by disposing them once the queue is empty.\n */\nexport class ResourceQueue implements IDisposable {\n\n\tprivate readonly queues = new Map<string, Queue<void>>();\n\n\tqueueFor(resource: URI): Queue<void> {\n\t\tconst key = resource.toString();\n\t\tif (!this.queues.has(key)) {\n\t\t\tconst queue = new Queue<void>();\n\t\t\tqueue.onFinished(() => {\n\t\t\t\tqueue.dispose();\n\t\t\t\tthis.queues.delete(key);\n\t\t\t});\n\n\t\t\tthis.queues.set(key, queue);\n\t\t}\n\n\t\treturn this.queues.get(key)!;\n\t}\n\n\tdispose(): void {\n\t\tthis.queues.forEach(queue => queue.dispose());\n\t\tthis.queues.clear();\n\t}\n}\n\nexport class TimeoutTimer implements IDisposable {\n\tprivate _token: any;\n\n\tconstructor();\n\tconstructor(runner: () => void, timeout: number);\n\tconstructor(runner?: () => void, timeout?: number) {\n\t\tthis._token = -1;\n\n\t\tif (typeof runner === 'function' && typeof timeout === 'number') {\n\t\t\tthis.setIfNotSet(runner, timeout);\n\t\t}\n\t}\n\n\tdispose(): void {\n\t\tthis.cancel();\n\t}\n\n\tcancel(): void {\n\t\tif (this._token !== -1) {\n\t\t\tclearTimeout(this._token);\n\t\t\tthis._token = -1;\n\t\t}\n\t}\n\n\tcancelAndSet(runner: () => void, timeout: number): void {\n\t\tthis.cancel();\n\t\tthis._token = setTimeout(() => {\n\t\t\tthis._token = -1;\n\t\t\trunner();\n\t\t}, timeout);\n\t}\n\n\tsetIfNotSet(runner: () => void, timeout: number): void {\n\t\tif (this._token !== -1) {\n\t\t\t// timer is already set\n\t\t\treturn;\n\t\t}\n\t\tthis._token = setTimeout(() => {\n\t\t\tthis._token = -1;\n\t\t\trunner();\n\t\t}, timeout);\n\t}\n}\n\nexport class IntervalTimer implements IDisposable {\n\n\tprivate _token: any;\n\n\tconstructor() {\n\t\tthis._token = -1;\n\t}\n\n\tdispose(): void {\n\t\tthis.cancel();\n\t}\n\n\tcancel(): void {\n\t\tif (this._token !== -1) {\n\t\t\tclearInterval(this._token);\n\t\t\tthis._token = -1;\n\t\t}\n\t}\n\n\tcancelAndSet(runner: () => void, interval: number): void {\n\t\tthis.cancel();\n\t\tthis._token = setInterval(() => {\n\t\t\trunner();\n\t\t}, interval);\n\t}\n}\n\nexport class RunOnceScheduler {\n\n\tprotected runner: ((...args: any[]) => void) | null;\n\n\tprivate timeoutToken: any;\n\tprivate timeout: number;\n\tprivate timeoutHandler: () => void;\n\n\tconstructor(runner: (...args: any[]) => void, delay: number) {\n\t\tthis.timeoutToken = -1;\n\t\tthis.runner = runner;\n\t\tthis.timeout = delay;\n\t\tthis.timeoutHandler = this.onTimeout.bind(this);\n\t}\n\n\t/**\n\t * Dispose RunOnceScheduler\n\t */\n\tdispose(): void {\n\t\tthis.cancel();\n\t\tthis.runner = null;\n\t}\n\n\t/**\n\t * Cancel current scheduled runner (if any).\n\t */\n\tcancel(): void {\n\t\tif (this.isScheduled()) {\n\t\t\tclearTimeout(this.timeoutToken);\n\t\t\tthis.timeoutToken = -1;\n\t\t}\n\t}\n\n\t/**\n\t * Cancel previous runner (if any) & schedule a new runner.\n\t */\n\tschedule(delay = this.timeout): void {\n\t\tthis.cancel();\n\t\tthis.timeoutToken = setTimeout(this.timeoutHandler, delay);\n\t}\n\n\tget delay(): number {\n\t\treturn this.timeout;\n\t}\n\n\tset delay(value: number) {\n\t\tthis.timeout = value;\n\t}\n\n\t/**\n\t * Returns true if scheduled.\n\t */\n\tisScheduled(): boolean {\n\t\treturn this.timeoutToken !== -1;\n\t}\n\n\tprivate onTimeout() {\n\t\tthis.timeoutToken = -1;\n\t\tif (this.runner) {\n\t\t\tthis.doRun();\n\t\t}\n\t}\n\n\tprotected doRun(): void {\n\t\tif (this.runner) {\n\t\t\tthis.runner();\n\t\t}\n\t}\n}\n\nexport class RunOnceWorker<T> extends RunOnceScheduler {\n\tprivate units: T[] = [];\n\n\tconstructor(runner: (units: T[]) => void, timeout: number) {\n\t\tsuper(runner, timeout);\n\t}\n\n\twork(unit: T): void {\n\t\tthis.units.push(unit);\n\n\t\tif (!this.isScheduled()) {\n\t\t\tthis.schedule();\n\t\t}\n\t}\n\n\tprotected doRun(): void {\n\t\tconst units = this.units;\n\t\tthis.units = [];\n\n\t\tif (this.runner) {\n\t\t\tthis.runner(units);\n\t\t}\n\t}\n\n\tdispose(): void {\n\t\tthis.units = [];\n\n\t\tsuper.dispose();\n\t}\n}\n\n//#region -- run on idle tricks ------------\n\nexport interface IdleDeadline {\n\treadonly didTimeout: boolean;\n\ttimeRemaining(): number;\n}\n/**\n * Execute the callback the next time the browser is idle\n */\nexport let runWhenIdle: (callback: (idle: IdleDeadline) => void, timeout?: number) => IDisposable;\n\ndeclare function requestIdleCallback(callback: (args: IdleDeadline) => void, options?: { timeout: number }): number;\ndeclare function cancelIdleCallback(handle: number): void;\n\n(function () {\n\tif (typeof requestIdleCallback !== 'function' || typeof cancelIdleCallback !== 'function') {\n\t\tconst dummyIdle: IdleDeadline = Object.freeze({\n\t\t\tdidTimeout: true,\n\t\t\ttimeRemaining() { return 15; }\n\t\t});\n\t\trunWhenIdle = (runner) => {\n\t\t\tconst handle = setTimeout(() => runner(dummyIdle));\n\t\t\tlet disposed = false;\n\t\t\treturn {\n\t\t\t\tdispose() {\n\t\t\t\t\tif (disposed) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tdisposed = true;\n\t\t\t\t\tclearTimeout(handle);\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\t} else {\n\t\trunWhenIdle = (runner, timeout?) => {\n\t\t\tconst handle: number = requestIdleCallback(runner, typeof timeout === 'number' ? { timeout } : undefined);\n\t\t\tlet disposed = false;\n\t\t\treturn {\n\t\t\t\tdispose() {\n\t\t\t\t\tif (disposed) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tdisposed = true;\n\t\t\t\t\tcancelIdleCallback(handle);\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\t}\n})();\n\n/**\n * An implementation of the \"idle-until-urgent\"-strategy as introduced\n * here: https://philipwalton.com/articles/idle-until-urgent/\n */\nexport class IdleValue<T> {\n\n\tprivate readonly _executor: () => void;\n\tprivate readonly _handle: IDisposable;\n\n\tprivate _didRun: boolean = false;\n\tprivate _value?: T;\n\tprivate _error: any;\n\n\tconstructor(executor: () => T) {\n\t\tthis._executor = () => {\n\t\t\ttry {\n\t\t\t\tthis._value = executor();\n\t\t\t} catch (err) {\n\t\t\t\tthis._error = err;\n\t\t\t} finally {\n\t\t\t\tthis._didRun = true;\n\t\t\t}\n\t\t};\n\t\tthis._handle = runWhenIdle(() => this._executor());\n\t}\n\n\tdispose(): void {\n\t\tthis._handle.dispose();\n\t}\n\n\tget value(): T {\n\t\tif (!this._didRun) {\n\t\t\tthis._handle.dispose();\n\t\t\tthis._executor();\n\t\t}\n\t\tif (this._error) {\n\t\t\tthrow this._error;\n\t\t}\n\t\treturn this._value!;\n\t}\n}\n\n//#endregion\n\nexport async function retry<T>(task: ITask<Promise<T>>, delay: number, retries: number): Promise<T> {\n\tlet lastError: Error | undefined;\n\n\tfor (let i = 0; i < retries; i++) {\n\t\ttry {\n\t\t\treturn await task();\n\t\t} catch (error) {\n\t\t\tlastError = error;\n\n\t\t\tawait timeout(delay);\n\t\t}\n\t}\n\n\tthrow lastError;\n}\n\n//#region Task Sequentializer\n\ninterface IPendingTask {\n\ttaskId: number;\n\tcancel: () => void;\n\tpromise: Promise<void>;\n}\n\ninterface ISequentialTask {\n\tpromise: Promise<void>;\n\tpromiseResolve: () => void;\n\tpromiseReject: (error: Error) => void;\n\trun: () => Promise<void>;\n}\n\nexport interface ITaskSequentializerWithPendingTask {\n\treadonly pending: Promise<void>;\n}\n\nexport class TaskSequentializer {\n\tprivate _pending?: IPendingTask;\n\tprivate _next?: ISequentialTask;\n\n\thasPending(taskId?: number): this is ITaskSequentializerWithPendingTask {\n\t\tif (!this._pending) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (typeof taskId === 'number') {\n\t\t\treturn this._pending.taskId === taskId;\n\t\t}\n\n\t\treturn !!this._pending;\n\t}\n\n\tget pending(): Promise<void> | undefined {\n\t\treturn this._pending ? this._pending.promise : undefined;\n\t}\n\n\tcancelPending(): void {\n\t\tthis._pending?.cancel();\n\t}\n\n\tsetPending(taskId: number, promise: Promise<void>, onCancel?: () => void,): Promise<void> {\n\t\tthis._pending = { taskId: taskId, cancel: () => onCancel?.(), promise };\n\n\t\tpromise.then(() => this.donePending(taskId), () => this.donePending(taskId));\n\n\t\treturn promise;\n\t}\n\n\tprivate donePending(taskId: number): void {\n\t\tif (this._pending && taskId === this._pending.taskId) {\n\n\t\t\t// only set pending to done if the promise finished that is associated with that taskId\n\t\t\tthis._pending = undefined;\n\n\t\t\t// schedule the next task now that we are free if we have any\n\t\t\tthis.triggerNext();\n\t\t}\n\t}\n\n\tprivate triggerNext(): void {\n\t\tif (this._next) {\n\t\t\tconst next = this._next;\n\t\t\tthis._next = undefined;\n\n\t\t\t// Run next task and complete on the associated promise\n\t\t\tnext.run().then(next.promiseResolve, next.promiseReject);\n\t\t}\n\t}\n\n\tsetNext(run: () => Promise<void>): Promise<void> {\n\n\t\t// this is our first next task, so we create associated promise with it\n\t\t// so that we can return a promise that completes when the task has\n\t\t// completed.\n\t\tif (!this._next) {\n\t\t\tlet promiseResolve: () => void;\n\t\t\tlet promiseReject: (error: Error) => void;\n\t\t\tconst promise = new Promise<void>((resolve, reject) => {\n\t\t\t\tpromiseResolve = resolve;\n\t\t\t\tpromiseReject = reject;\n\t\t\t});\n\n\t\t\tthis._next = {\n\t\t\t\trun,\n\t\t\t\tpromise,\n\t\t\t\tpromiseResolve: promiseResolve!,\n\t\t\t\tpromiseReject: promiseReject!\n\t\t\t};\n\t\t}\n\n\t\t// we have a previous next task, just overwrite it\n\t\telse {\n\t\t\tthis._next.run = run;\n\t\t}\n\n\t\treturn this._next.promise;\n\t}\n}\n\n//#endregion\n\n//#region\n\n/**\n * The `IntervalCounter` allows to count the number\n * of calls to `increment()` over a duration of\n * `interval`. This utility can be used to conditionally\n * throttle a frequent task when a certain threshold\n * is reached.\n */\nexport class IntervalCounter {\n\n\tprivate lastIncrementTime = 0;\n\n\tprivate value = 0;\n\n\tconstructor(private readonly interval: number) { }\n\n\tincrement(): number {\n\t\tconst now = Date.now();\n\n\t\t// We are outside of the range of `interval` and as such\n\t\t// start counting from 0 and remember the time\n\t\tif (now - this.lastIncrementTime > this.interval) {\n\t\t\tthis.lastIncrementTime = now;\n\t\t\tthis.value = 0;\n\t\t}\n\n\t\tthis.value++;\n\n\t\treturn this.value;\n\t}\n}\n\n//#endregion\n\nexport type ValueCallback<T = any> = (value: T | Promise<T>) => void;\n\n/**\n * Creates a promise whose resolution or rejection can be controlled imperatively.\n */\nexport class DeferredPromise<T> {\n\n\tprivate completeCallback!: ValueCallback<T>;\n\tprivate errorCallback!: (err: any) => void;\n\tprivate rejected = false;\n\tprivate resolved = false;\n\n\tpublic get isRejected() {\n\t\treturn this.rejected;\n\t}\n\n\tpublic get isResolved() {\n\t\treturn this.resolved;\n\t}\n\n\tpublic get isSettled() {\n\t\treturn this.rejected || this.resolved;\n\t}\n\n\tpublic p: Promise<T>;\n\n\tconstructor() {\n\t\tthis.p = new Promise<T>((c, e) => {\n\t\t\tthis.completeCallback = c;\n\t\t\tthis.errorCallback = e;\n\t\t});\n\t}\n\n\tpublic complete(value: T) {\n\t\treturn new Promise<void>(resolve => {\n\t\t\tthis.completeCallback(value);\n\t\t\tthis.resolved = true;\n\t\t\tresolve();\n\t\t});\n\t}\n\n\tpublic error(err: any) {\n\t\treturn new Promise<void>(resolve => {\n\t\t\tthis.errorCallback(err);\n\t\t\tthis.rejected = true;\n\t\t\tresolve();\n\t\t});\n\t}\n\n\tpublic cancel() {\n\t\tnew Promise<void>(resolve => {\n\t\t\tthis.errorCallback(errors.canceled());\n\t\t\tthis.rejected = true;\n\t\t\tresolve();\n\t\t});\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from 'vs/base/common/event';\n\nexport interface IIconRegistry {\n\treadonly all: IterableIterator<Codicon>;\n\treadonly onDidRegister: Event<Codicon>;\n\tget(id: string): Codicon | undefined;\n}\n\nclass Registry implements IIconRegistry {\n\n\tprivate readonly _icons = new Map<string, Codicon>();\n\tprivate readonly _onDidRegister = new Emitter<Codicon>();\n\n\tpublic add(icon: Codicon) {\n\t\tconst existing = this._icons.get(icon.id);\n\t\tif (!existing) {\n\t\t\tthis._icons.set(icon.id, icon);\n\t\t\tthis._onDidRegister.fire(icon);\n\t\t} else if (icon.description) {\n\t\t\texisting.description = icon.description;\n\t\t} else {\n\t\t\tconsole.error(`Duplicate registration of codicon ${icon.id}`);\n\t\t}\n\t}\n\n\tpublic get(id: string): Codicon | undefined {\n\t\treturn this._icons.get(id);\n\t}\n\n\tpublic get all(): IterableIterator<Codicon> {\n\t\treturn this._icons.values();\n\t}\n\n\tpublic get onDidRegister(): Event<Codicon> {\n\t\treturn this._onDidRegister.event;\n\t}\n}\n\nconst _registry = new Registry();\n\nexport const iconRegistry: IIconRegistry = _registry;\n\nexport function registerCodicon(id: string, def: Codicon): Codicon {\n\treturn new Codicon(id, def);\n}\n\nexport class Codicon implements CSSIcon {\n\tconstructor(public readonly id: string, public readonly definition: Codicon | IconDefinition, public description?: string) {\n\t\t_registry.add(this);\n\t}\n\tpublic get classNames() { return 'codicon codicon-' + this.id; }\n\t// classNamesArray is useful for migrating to ES6 classlist\n\tpublic get classNamesArray() { return ['codicon', 'codicon-' + this.id]; }\n\tpublic get cssSelector() { return '.codicon.codicon-' + this.id; }\n}\n\nexport function getClassNamesArray(id: string, modifier?: string) {\n\tconst classNames = ['codicon', 'codicon-' + id];\n\tif (modifier) {\n\t\tclassNames.push('codicon-modifier-' + modifier);\n\t}\n\treturn classNames;\n}\n\nexport interface CSSIcon {\n\treadonly id: string;\n}\n\nexport namespace CSSIcon {\n\texport const iconIdRegex = /^(codicon\\/)?([a-z\\-]+)(?:~([a-z\\-]+))?$/i;\n\n\texport function asClassNameArray(icon: CSSIcon): string[] {\n\t\tif (icon instanceof Codicon) {\n\t\t\treturn ['codicon', 'codicon-' + icon.id];\n\t\t}\n\t\tconst match = iconIdRegex.exec(icon.id);\n\t\tif (!match) {\n\t\t\treturn asClassNameArray(Codicon.error);\n\t\t}\n\t\tlet [, , id, modifier] = match;\n\t\tconst classNames = ['codicon', 'codicon-' + id];\n\t\tif (modifier) {\n\t\t\tclassNames.push('codicon-modifier-' + modifier);\n\t\t}\n\t\treturn classNames;\n\t}\n\n\texport function asClassName(icon: CSSIcon): string {\n\t\treturn asClassNameArray(icon).join(' ');\n\t}\n\n\texport function asCSSSelector(icon: CSSIcon): string {\n\t\treturn '.' + asClassNameArray(icon).join('.');\n\t}\n}\n\n\n\ninterface IconDefinition {\n\tcharacter: string;\n}\n\nexport namespace Codicon {\n\n\t// built-in icons, with image name\n\texport const add = new Codicon('add', { character: '\\\\ea60' });\n\texport const plus = new Codicon('plus', { character: '\\\\ea60' });\n\texport const gistNew = new Codicon('gist-new', { character: '\\\\ea60' });\n\texport const repoCreate = new Codicon('repo-create', { character: '\\\\ea60' });\n\texport const lightbulb = new Codicon('lightbulb', { character: '\\\\ea61' });\n\texport const lightBulb = new Codicon('light-bulb', { character: '\\\\ea61' });\n\texport const repo = new Codicon('repo', { character: '\\\\ea62' });\n\texport const repoDelete = new Codicon('repo-delete', { character: '\\\\ea62' });\n\texport const gistFork = new Codicon('gist-fork', { character: '\\\\ea63' });\n\texport const repoForked = new Codicon('repo-forked', { character: '\\\\ea63' });\n\texport const gitPullRequest = new Codicon('git-pull-request', { character: '\\\\ea64' });\n\texport const gitPullRequestAbandoned = new Codicon('git-pull-request-abandoned', { character: '\\\\ea64' });\n\texport const recordKeys = new Codicon('record-keys', { character: '\\\\ea65' });\n\texport const keyboard = new Codicon('keyboard', { character: '\\\\ea65' });\n\texport const tag = new Codicon('tag', { character: '\\\\ea66' });\n\texport const tagAdd = new Codicon('tag-add', { character: '\\\\ea66' });\n\texport const tagRemove = new Codicon('tag-remove', { character: '\\\\ea66' });\n\texport const person = new Codicon('person', { character: '\\\\ea67' });\n\texport const personAdd = new Codicon('person-add', { character: '\\\\ea67' });\n\texport const personFollow = new Codicon('person-follow', { character: '\\\\ea67' });\n\texport const personOutline = new Codicon('person-outline', { character: '\\\\ea67' });\n\texport const personFilled = new Codicon('person-filled', { character: '\\\\ea67' });\n\texport const gitBranch = new Codicon('git-branch', { character: '\\\\ea68' });\n\texport const gitBranchCreate = new Codicon('git-branch-create', { character: '\\\\ea68' });\n\texport const gitBranchDelete = new Codicon('git-branch-delete', { character: '\\\\ea68' });\n\texport const sourceControl = new Codicon('source-control', { character: '\\\\ea68' });\n\texport const mirror = new Codicon('mirror', { character: '\\\\ea69' });\n\texport const mirrorPublic = new Codicon('mirror-public', { character: '\\\\ea69' });\n\texport const star = new Codicon('star', { character: '\\\\ea6a' });\n\texport const starAdd = new Codicon('star-add', { character: '\\\\ea6a' });\n\texport const starDelete = new Codicon('star-delete', { character: '\\\\ea6a' });\n\texport const starEmpty = new Codicon('star-empty', { character: '\\\\ea6a' });\n\texport const comment = new Codicon('comment', { character: '\\\\ea6b' });\n\texport const commentAdd = new Codicon('comment-add', { character: '\\\\ea6b' });\n\texport const alert = new Codicon('alert', { character: '\\\\ea6c' });\n\texport const warning = new Codicon('warning', { character: '\\\\ea6c' });\n\texport const search = new Codicon('search', { character: '\\\\ea6d' });\n\texport const searchSave = new Codicon('search-save', { character: '\\\\ea6d' });\n\texport const logOut = new Codicon('log-out', { character: '\\\\ea6e' });\n\texport const signOut = new Codicon('sign-out', { character: '\\\\ea6e' });\n\texport const logIn = new Codicon('log-in', { character: '\\\\ea6f' });\n\texport const signIn = new Codicon('sign-in', { character: '\\\\ea6f' });\n\texport const eye = new Codicon('eye', { character: '\\\\ea70' });\n\texport const eyeUnwatch = new Codicon('eye-unwatch', { character: '\\\\ea70' });\n\texport const eyeWatch = new Codicon('eye-watch', { character: '\\\\ea70' });\n\texport const circleFilled = new Codicon('circle-filled', { character: '\\\\ea71' });\n\texport const primitiveDot = new Codicon('primitive-dot', { character: '\\\\ea71' });\n\texport const closeDirty = new Codicon('close-dirty', { character: '\\\\ea71' });\n\texport const debugBreakpoint = new Codicon('debug-breakpoint', { character: '\\\\ea71' });\n\texport const debugBreakpointDisabled = new Codicon('debug-breakpoint-disabled', { character: '\\\\ea71' });\n\texport const debugHint = new Codicon('debug-hint', { character: '\\\\ea71' });\n\texport const primitiveSquare = new Codicon('primitive-square', { character: '\\\\ea72' });\n\texport const edit = new Codicon('edit', { character: '\\\\ea73' });\n\texport const pencil = new Codicon('pencil', { character: '\\\\ea73' });\n\texport const info = new Codicon('info', { character: '\\\\ea74' });\n\texport const issueOpened = new Codicon('issue-opened', { character: '\\\\ea74' });\n\texport const gistPrivate = new Codicon('gist-private', { character: '\\\\ea75' });\n\texport const gitForkPrivate = new Codicon('git-fork-private', { character: '\\\\ea75' });\n\texport const lock = new Codicon('lock', { character: '\\\\ea75' });\n\texport const mirrorPrivate = new Codicon('mirror-private', { character: '\\\\ea75' });\n\texport const close = new Codicon('close', { character: '\\\\ea76' });\n\texport const removeClose = new Codicon('remove-close', { character: '\\\\ea76' });\n\texport const x = new Codicon('x', { character: '\\\\ea76' });\n\texport const repoSync = new Codicon('repo-sync', { character: '\\\\ea77' });\n\texport const sync = new Codicon('sync', { character: '\\\\ea77' });\n\texport const clone = new Codicon('clone', { character: '\\\\ea78' });\n\texport const desktopDownload = new Codicon('desktop-download', { character: '\\\\ea78' });\n\texport const beaker = new Codicon('beaker', { character: '\\\\ea79' });\n\texport const microscope = new Codicon('microscope', { character: '\\\\ea79' });\n\texport const vm = new Codicon('vm', { character: '\\\\ea7a' });\n\texport const deviceDesktop = new Codicon('device-desktop', { character: '\\\\ea7a' });\n\texport const file = new Codicon('file', { character: '\\\\ea7b' });\n\texport const fileText = new Codicon('file-text', { character: '\\\\ea7b' });\n\texport const more = new Codicon('more', { character: '\\\\ea7c' });\n\texport const ellipsis = new Codicon('ellipsis', { character: '\\\\ea7c' });\n\texport const kebabHorizontal = new Codicon('kebab-horizontal', { character: '\\\\ea7c' });\n\texport const mailReply = new Codicon('mail-reply', { character: '\\\\ea7d' });\n\texport const reply = new Codicon('reply', { character: '\\\\ea7d' });\n\texport const organization = new Codicon('organization', { character: '\\\\ea7e' });\n\texport const organizationFilled = new Codicon('organization-filled', { character: '\\\\ea7e' });\n\texport const organizationOutline = new Codicon('organization-outline', { character: '\\\\ea7e' });\n\texport const newFile = new Codicon('new-file', { character: '\\\\ea7f' });\n\texport const fileAdd = new Codicon('file-add', { character: '\\\\ea7f' });\n\texport const newFolder = new Codicon('new-folder', { character: '\\\\ea80' });\n\texport const fileDirectoryCreate = new Codicon('file-directory-create', { character: '\\\\ea80' });\n\texport const trash = new Codicon('trash', { character: '\\\\ea81' });\n\texport const trashcan = new Codicon('trashcan', { character: '\\\\ea81' });\n\texport const history = new Codicon('history', { character: '\\\\ea82' });\n\texport const clock = new Codicon('clock', { character: '\\\\ea82' });\n\texport const folder = new Codicon('folder', { character: '\\\\ea83' });\n\texport const fileDirectory = new Codicon('file-directory', { character: '\\\\ea83' });\n\texport const symbolFolder = new Codicon('symbol-folder', { character: '\\\\ea83' });\n\texport const logoGithub = new Codicon('logo-github', { character: '\\\\ea84' });\n\texport const markGithub = new Codicon('mark-github', { character: '\\\\ea84' });\n\texport const github = new Codicon('github', { character: '\\\\ea84' });\n\texport const terminal = new Codicon('terminal', { character: '\\\\ea85' });\n\texport const console = new Codicon('console', { character: '\\\\ea85' });\n\texport const repl = new Codicon('repl', { character: '\\\\ea85' });\n\texport const zap = new Codicon('zap', { character: '\\\\ea86' });\n\texport const symbolEvent = new Codicon('symbol-event', { character: '\\\\ea86' });\n\texport const error = new Codicon('error', { character: '\\\\ea87' });\n\texport const stop = new Codicon('stop', { character: '\\\\ea87' });\n\texport const variable = new Codicon('variable', { character: '\\\\ea88' });\n\texport const symbolVariable = new Codicon('symbol-variable', { character: '\\\\ea88' });\n\texport const array = new Codicon('array', { character: '\\\\ea8a' });\n\texport const symbolArray = new Codicon('symbol-array', { character: '\\\\ea8a' });\n\texport const symbolModule = new Codicon('symbol-module', { character: '\\\\ea8b' });\n\texport const symbolPackage = new Codicon('symbol-package', { character: '\\\\ea8b' });\n\texport const symbolNamespace = new Codicon('symbol-namespace', { character: '\\\\ea8b' });\n\texport const symbolObject = new Codicon('symbol-object', { character: '\\\\ea8b' });\n\texport const symbolMethod = new Codicon('symbol-method', { character: '\\\\ea8c' });\n\texport const symbolFunction = new Codicon('symbol-function', { character: '\\\\ea8c' });\n\texport const symbolConstructor = new Codicon('symbol-constructor', { character: '\\\\ea8c' });\n\texport const symbolBoolean = new Codicon('symbol-boolean', { character: '\\\\ea8f' });\n\texport const symbolNull = new Codicon('symbol-null', { character: '\\\\ea8f' });\n\texport const symbolNumeric = new Codicon('symbol-numeric', { character: '\\\\ea90' });\n\texport const symbolNumber = new Codicon('symbol-number', { character: '\\\\ea90' });\n\texport const symbolStructure = new Codicon('symbol-structure', { character: '\\\\ea91' });\n\texport const symbolStruct = new Codicon('symbol-struct', { character: '\\\\ea91' });\n\texport const symbolParameter = new Codicon('symbol-parameter', { character: '\\\\ea92' });\n\texport const symbolTypeParameter = new Codicon('symbol-type-parameter', { character: '\\\\ea92' });\n\texport const symbolKey = new Codicon('symbol-key', { character: '\\\\ea93' });\n\texport const symbolText = new Codicon('symbol-text', { character: '\\\\ea93' });\n\texport const symbolReference = new Codicon('symbol-reference', { character: '\\\\ea94' });\n\texport const goToFile = new Codicon('go-to-file', { character: '\\\\ea94' });\n\texport const symbolEnum = new Codicon('symbol-enum', { character: '\\\\ea95' });\n\texport const symbolValue = new Codicon('symbol-value', { character: '\\\\ea95' });\n\texport const symbolRuler = new Codicon('symbol-ruler', { character: '\\\\ea96' });\n\texport const symbolUnit = new Codicon('symbol-unit', { character: '\\\\ea96' });\n\texport const activateBreakpoints = new Codicon('activate-breakpoints', { character: '\\\\ea97' });\n\texport const archive = new Codicon('archive', { character: '\\\\ea98' });\n\texport const arrowBoth = new Codicon('arrow-both', { character: '\\\\ea99' });\n\texport const arrowDown = new Codicon('arrow-down', { character: '\\\\ea9a' });\n\texport const arrowLeft = new Codicon('arrow-left', { character: '\\\\ea9b' });\n\texport const arrowRight = new Codicon('arrow-right', { character: '\\\\ea9c' });\n\texport const arrowSmallDown = new Codicon('arrow-small-down', { character: '\\\\ea9d' });\n\texport const arrowSmallLeft = new Codicon('arrow-small-left', { character: '\\\\ea9e' });\n\texport const arrowSmallRight = new Codicon('arrow-small-right', { character: '\\\\ea9f' });\n\texport const arrowSmallUp = new Codicon('arrow-small-up', { character: '\\\\eaa0' });\n\texport const arrowUp = new Codicon('arrow-up', { character: '\\\\eaa1' });\n\texport const bell = new Codicon('bell', { character: '\\\\eaa2' });\n\texport const bold = new Codicon('bold', { character: '\\\\eaa3' });\n\texport const book = new Codicon('book', { character: '\\\\eaa4' });\n\texport const bookmark = new Codicon('bookmark', { character: '\\\\eaa5' });\n\texport const debugBreakpointConditionalUnverified = new Codicon('debug-breakpoint-conditional-unverified', { character: '\\\\eaa6' });\n\texport const debugBreakpointConditional = new Codicon('debug-breakpoint-conditional', { character: '\\\\eaa7' });\n\texport const debugBreakpointConditionalDisabled = new Codicon('debug-breakpoint-conditional-disabled', { character: '\\\\eaa7' });\n\texport const debugBreakpointDataUnverified = new Codicon('debug-breakpoint-data-unverified', { character: '\\\\eaa8' });\n\texport const debugBreakpointData = new Codicon('debug-breakpoint-data', { character: '\\\\eaa9' });\n\texport const debugBreakpointDataDisabled = new Codicon('debug-breakpoint-data-disabled', { character: '\\\\eaa9' });\n\texport const debugBreakpointLogUnverified = new Codicon('debug-breakpoint-log-unverified', { character: '\\\\eaaa' });\n\texport const debugBreakpointLog = new Codicon('debug-breakpoint-log', { character: '\\\\eaab' });\n\texport const debugBreakpointLogDisabled = new Codicon('debug-breakpoint-log-disabled', { character: '\\\\eaab' });\n\texport const briefcase = new Codicon('briefcase', { character: '\\\\eaac' });\n\texport const broadcast = new Codicon('broadcast', { character: '\\\\eaad' });\n\texport const browser = new Codicon('browser', { character: '\\\\eaae' });\n\texport const bug = new Codicon('bug', { character: '\\\\eaaf' });\n\texport const calendar = new Codicon('calendar', { character: '\\\\eab0' });\n\texport const caseSensitive = new Codicon('case-sensitive', { character: '\\\\eab1' });\n\texport const check = new Codicon('check', { character: '\\\\eab2' });\n\texport const checklist = new Codicon('checklist', { character: '\\\\eab3' });\n\texport const chevronDown = new Codicon('chevron-down', { character: '\\\\eab4' });\n\texport const chevronLeft = new Codicon('chevron-left', { character: '\\\\eab5' });\n\texport const chevronRight = new Codicon('chevron-right', { character: '\\\\eab6' });\n\texport const chevronUp = new Codicon('chevron-up', { character: '\\\\eab7' });\n\texport const chromeClose = new Codicon('chrome-close', { character: '\\\\eab8' });\n\texport const chromeMaximize = new Codicon('chrome-maximize', { character: '\\\\eab9' });\n\texport const chromeMinimize = new Codicon('chrome-minimize', { character: '\\\\eaba' });\n\texport const chromeRestore = new Codicon('chrome-restore', { character: '\\\\eabb' });\n\texport const circleOutline = new Codicon('circle-outline', { character: '\\\\eabc' });\n\texport const debugBreakpointUnverified = new Codicon('debug-breakpoint-unverified', { character: '\\\\eabc' });\n\texport const circleSlash = new Codicon('circle-slash', { character: '\\\\eabd' });\n\texport const circuitBoard = new Codicon('circuit-board', { character: '\\\\eabe' });\n\texport const clearAll = new Codicon('clear-all', { character: '\\\\eabf' });\n\texport const clippy = new Codicon('clippy', { character: '\\\\eac0' });\n\texport const closeAll = new Codicon('close-all', { character: '\\\\eac1' });\n\texport const cloudDownload = new Codicon('cloud-download', { character: '\\\\eac2' });\n\texport const cloudUpload = new Codicon('cloud-upload', { character: '\\\\eac3' });\n\texport const code = new Codicon('code', { character: '\\\\eac4' });\n\texport const collapseAll = new Codicon('collapse-all', { character: '\\\\eac5' });\n\texport const colorMode = new Codicon('color-mode', { character: '\\\\eac6' });\n\texport const commentDiscussion = new Codicon('comment-discussion', { character: '\\\\eac7' });\n\texport const compareChanges = new Codicon('compare-changes', { character: '\\\\eafd' });\n\texport const creditCard = new Codicon('credit-card', { character: '\\\\eac9' });\n\texport const dash = new Codicon('dash', { character: '\\\\eacc' });\n\texport const dashboard = new Codicon('dashboard', { character: '\\\\eacd' });\n\texport const database = new Codicon('database', { character: '\\\\eace' });\n\texport const debugContinue = new Codicon('debug-continue', { character: '\\\\eacf' });\n\texport const debugDisconnect = new Codicon('debug-disconnect', { character: '\\\\ead0' });\n\texport const debugPause = new Codicon('debug-pause', { character: '\\\\ead1' });\n\texport const debugRestart = new Codicon('debug-restart', { character: '\\\\ead2' });\n\texport const debugStart = new Codicon('debug-start', { character: '\\\\ead3' });\n\texport const debugStepInto = new Codicon('debug-step-into', { character: '\\\\ead4' });\n\texport const debugStepOut = new Codicon('debug-step-out', { character: '\\\\ead5' });\n\texport const debugStepOver = new Codicon('debug-step-over', { character: '\\\\ead6' });\n\texport const debugStop = new Codicon('debug-stop', { character: '\\\\ead7' });\n\texport const debug = new Codicon('debug', { character: '\\\\ead8' });\n\texport const deviceCameraVideo = new Codicon('device-camera-video', { character: '\\\\ead9' });\n\texport const deviceCamera = new Codicon('device-camera', { character: '\\\\eada' });\n\texport const deviceMobile = new Codicon('device-mobile', { character: '\\\\eadb' });\n\texport const diffAdded = new Codicon('diff-added', { character: '\\\\eadc' });\n\texport const diffIgnored = new Codicon('diff-ignored', { character: '\\\\eadd' });\n\texport const diffModified = new Codicon('diff-modified', { character: '\\\\eade' });\n\texport const diffRemoved = new Codicon('diff-removed', { character: '\\\\eadf' });\n\texport const diffRenamed = new Codicon('diff-renamed', { character: '\\\\eae0' });\n\texport const diff = new Codicon('diff', { character: '\\\\eae1' });\n\texport const discard = new Codicon('discard', { character: '\\\\eae2' });\n\texport const editorLayout = new Codicon('editor-layout', { character: '\\\\eae3' });\n\texport const emptyWindow = new Codicon('empty-window', { character: '\\\\eae4' });\n\texport const exclude = new Codicon('exclude', { character: '\\\\eae5' });\n\texport const extensions = new Codicon('extensions', { character: '\\\\eae6' });\n\texport const eyeClosed = new Codicon('eye-closed', { character: '\\\\eae7' });\n\texport const fileBinary = new Codicon('file-binary', { character: '\\\\eae8' });\n\texport const fileCode = new Codicon('file-code', { character: '\\\\eae9' });\n\texport const fileMedia = new Codicon('file-media', { character: '\\\\eaea' });\n\texport const filePdf = new Codicon('file-pdf', { character: '\\\\eaeb' });\n\texport const fileSubmodule = new Codicon('file-submodule', { character: '\\\\eaec' });\n\texport const fileSymlinkDirectory = new Codicon('file-symlink-directory', { character: '\\\\eaed' });\n\texport const fileSymlinkFile = new Codicon('file-symlink-file', { character: '\\\\eaee' });\n\texport const fileZip = new Codicon('file-zip', { character: '\\\\eaef' });\n\texport const files = new Codicon('files', { character: '\\\\eaf0' });\n\texport const filter = new Codicon('filter', { character: '\\\\eaf1' });\n\texport const flame = new Codicon('flame', { character: '\\\\eaf2' });\n\texport const foldDown = new Codicon('fold-down', { character: '\\\\eaf3' });\n\texport const foldUp = new Codicon('fold-up', { character: '\\\\eaf4' });\n\texport const fold = new Codicon('fold', { character: '\\\\eaf5' });\n\texport const folderActive = new Codicon('folder-active', { character: '\\\\eaf6' });\n\texport const folderOpened = new Codicon('folder-opened', { character: '\\\\eaf7' });\n\texport const gear = new Codicon('gear', { character: '\\\\eaf8' });\n\texport const gift = new Codicon('gift', { character: '\\\\eaf9' });\n\texport const gistSecret = new Codicon('gist-secret', { character: '\\\\eafa' });\n\texport const gist = new Codicon('gist', { character: '\\\\eafb' });\n\texport const gitCommit = new Codicon('git-commit', { character: '\\\\eafc' });\n\texport const gitCompare = new Codicon('git-compare', { character: '\\\\eafd' });\n\texport const gitMerge = new Codicon('git-merge', { character: '\\\\eafe' });\n\texport const githubAction = new Codicon('github-action', { character: '\\\\eaff' });\n\texport const githubAlt = new Codicon('github-alt', { character: '\\\\eb00' });\n\texport const globe = new Codicon('globe', { character: '\\\\eb01' });\n\texport const grabber = new Codicon('grabber', { character: '\\\\eb02' });\n\texport const graph = new Codicon('graph', { character: '\\\\eb03' });\n\texport const gripper = new Codicon('gripper', { character: '\\\\eb04' });\n\texport const heart = new Codicon('heart', { character: '\\\\eb05' });\n\texport const home = new Codicon('home', { character: '\\\\eb06' });\n\texport const horizontalRule = new Codicon('horizontal-rule', { character: '\\\\eb07' });\n\texport const hubot = new Codicon('hubot', { character: '\\\\eb08' });\n\texport const inbox = new Codicon('inbox', { character: '\\\\eb09' });\n\texport const issueClosed = new Codicon('issue-closed', { character: '\\\\eb0a' });\n\texport const issueReopened = new Codicon('issue-reopened', { character: '\\\\eb0b' });\n\texport const issues = new Codicon('issues', { character: '\\\\eb0c' });\n\texport const italic = new Codicon('italic', { character: '\\\\eb0d' });\n\texport const jersey = new Codicon('jersey', { character: '\\\\eb0e' });\n\texport const json = new Codicon('json', { character: '\\\\eb0f' });\n\texport const kebabVertical = new Codicon('kebab-vertical', { character: '\\\\eb10' });\n\texport const key = new Codicon('key', { character: '\\\\eb11' });\n\texport const law = new Codicon('law', { character: '\\\\eb12' });\n\texport const lightbulbAutofix = new Codicon('lightbulb-autofix', { character: '\\\\eb13' });\n\texport const linkExternal = new Codicon('link-external', { character: '\\\\eb14' });\n\texport const link = new Codicon('link', { character: '\\\\eb15' });\n\texport const listOrdered = new Codicon('list-ordered', { character: '\\\\eb16' });\n\texport const listUnordered = new Codicon('list-unordered', { character: '\\\\eb17' });\n\texport const liveShare = new Codicon('live-share', { character: '\\\\eb18' });\n\texport const loading = new Codicon('loading', { character: '\\\\eb19' });\n\texport const location = new Codicon('location', { character: '\\\\eb1a' });\n\texport const mailRead = new Codicon('mail-read', { character: '\\\\eb1b' });\n\texport const mail = new Codicon('mail', { character: '\\\\eb1c' });\n\texport const markdown = new Codicon('markdown', { character: '\\\\eb1d' });\n\texport const megaphone = new Codicon('megaphone', { character: '\\\\eb1e' });\n\texport const mention = new Codicon('mention', { character: '\\\\eb1f' });\n\texport const milestone = new Codicon('milestone', { character: '\\\\eb20' });\n\texport const mortarBoard = new Codicon('mortar-board', { character: '\\\\eb21' });\n\texport const move = new Codicon('move', { character: '\\\\eb22' });\n\texport const multipleWindows = new Codicon('multiple-windows', { character: '\\\\eb23' });\n\texport const mute = new Codicon('mute', { character: '\\\\eb24' });\n\texport const noNewline = new Codicon('no-newline', { character: '\\\\eb25' });\n\texport const note = new Codicon('note', { character: '\\\\eb26' });\n\texport const octoface = new Codicon('octoface', { character: '\\\\eb27' });\n\texport const openPreview = new Codicon('open-preview', { character: '\\\\eb28' });\n\texport const package_ = new Codicon('package', { character: '\\\\eb29' });\n\texport const paintcan = new Codicon('paintcan', { character: '\\\\eb2a' });\n\texport const pin = new Codicon('pin', { character: '\\\\eb2b' });\n\texport const play = new Codicon('play', { character: '\\\\eb2c' });\n\texport const run = new Codicon('run', { character: '\\\\eb2c' });\n\texport const plug = new Codicon('plug', { character: '\\\\eb2d' });\n\texport const preserveCase = new Codicon('preserve-case', { character: '\\\\eb2e' });\n\texport const preview = new Codicon('preview', { character: '\\\\eb2f' });\n\texport const project = new Codicon('project', { character: '\\\\eb30' });\n\texport const pulse = new Codicon('pulse', { character: '\\\\eb31' });\n\texport const question = new Codicon('question', { character: '\\\\eb32' });\n\texport const quote = new Codicon('quote', { character: '\\\\eb33' });\n\texport const radioTower = new Codicon('radio-tower', { character: '\\\\eb34' });\n\texport const reactions = new Codicon('reactions', { character: '\\\\eb35' });\n\texport const references = new Codicon('references', { character: '\\\\eb36' });\n\texport const refresh = new Codicon('refresh', { character: '\\\\eb37' });\n\texport const regex = new Codicon('regex', { character: '\\\\eb38' });\n\texport const remoteExplorer = new Codicon('remote-explorer', { character: '\\\\eb39' });\n\texport const remote = new Codicon('remote', { character: '\\\\eb3a' });\n\texport const remove = new Codicon('remove', { character: '\\\\eb3b' });\n\texport const replaceAll = new Codicon('replace-all', { character: '\\\\eb3c' });\n\texport const replace = new Codicon('replace', { character: '\\\\eb3d' });\n\texport const repoClone = new Codicon('repo-clone', { character: '\\\\eb3e' });\n\texport const repoForcePush = new Codicon('repo-force-push', { character: '\\\\eb3f' });\n\texport const repoPull = new Codicon('repo-pull', { character: '\\\\eb40' });\n\texport const repoPush = new Codicon('repo-push', { character: '\\\\eb41' });\n\texport const report = new Codicon('report', { character: '\\\\eb42' });\n\texport const requestChanges = new Codicon('request-changes', { character: '\\\\eb43' });\n\texport const rocket = new Codicon('rocket', { character: '\\\\eb44' });\n\texport const rootFolderOpened = new Codicon('root-folder-opened', { character: '\\\\eb45' });\n\texport const rootFolder = new Codicon('root-folder', { character: '\\\\eb46' });\n\texport const rss = new Codicon('rss', { character: '\\\\eb47' });\n\texport const ruby = new Codicon('ruby', { character: '\\\\eb48' });\n\texport const saveAll = new Codicon('save-all', { character: '\\\\eb49' });\n\texport const saveAs = new Codicon('save-as', { character: '\\\\eb4a' });\n\texport const save = new Codicon('save', { character: '\\\\eb4b' });\n\texport const screenFull = new Codicon('screen-full', { character: '\\\\eb4c' });\n\texport const screenNormal = new Codicon('screen-normal', { character: '\\\\eb4d' });\n\texport const searchStop = new Codicon('search-stop', { character: '\\\\eb4e' });\n\texport const server = new Codicon('server', { character: '\\\\eb50' });\n\texport const settingsGear = new Codicon('settings-gear', { character: '\\\\eb51' });\n\texport const settings = new Codicon('settings', { character: '\\\\eb52' });\n\texport const shield = new Codicon('shield', { character: '\\\\eb53' });\n\texport const smiley = new Codicon('smiley', { character: '\\\\eb54' });\n\texport const sortPrecedence = new Codicon('sort-precedence', { character: '\\\\eb55' });\n\texport const splitHorizontal = new Codicon('split-horizontal', { character: '\\\\eb56' });\n\texport const splitVertical = new Codicon('split-vertical', { character: '\\\\eb57' });\n\texport const squirrel = new Codicon('squirrel', { character: '\\\\eb58' });\n\texport const starFull = new Codicon('star-full', { character: '\\\\eb59' });\n\texport const starHalf = new Codicon('star-half', { character: '\\\\eb5a' });\n\texport const symbolClass = new Codicon('symbol-class', { character: '\\\\eb5b' });\n\texport const symbolColor = new Codicon('symbol-color', { character: '\\\\eb5c' });\n\texport const symbolConstant = new Codicon('symbol-constant', { character: '\\\\eb5d' });\n\texport const symbolEnumMember = new Codicon('symbol-enum-member', { character: '\\\\eb5e' });\n\texport const symbolField = new Codicon('symbol-field', { character: '\\\\eb5f' });\n\texport const symbolFile = new Codicon('symbol-file', { character: '\\\\eb60' });\n\texport const symbolInterface = new Codicon('symbol-interface', { character: '\\\\eb61' });\n\texport const symbolKeyword = new Codicon('symbol-keyword', { character: '\\\\eb62' });\n\texport const symbolMisc = new Codicon('symbol-misc', { character: '\\\\eb63' });\n\texport const symbolOperator = new Codicon('symbol-operator', { character: '\\\\eb64' });\n\texport const symbolProperty = new Codicon('symbol-property', { character: '\\\\eb65' });\n\texport const wrench = new Codicon('wrench', { character: '\\\\eb65' });\n\texport const wrenchSubaction = new Codicon('wrench-subaction', { character: '\\\\eb65' });\n\texport const symbolSnippet = new Codicon('symbol-snippet', { character: '\\\\eb66' });\n\texport const tasklist = new Codicon('tasklist', { character: '\\\\eb67' });\n\texport const telescope = new Codicon('telescope', { character: '\\\\eb68' });\n\texport const textSize = new Codicon('text-size', { character: '\\\\eb69' });\n\texport const threeBars = new Codicon('three-bars', { character: '\\\\eb6a' });\n\texport const thumbsdown = new Codicon('thumbsdown', { character: '\\\\eb6b' });\n\texport const thumbsup = new Codicon('thumbsup', { character: '\\\\eb6c' });\n\texport const tools = new Codicon('tools', { character: '\\\\eb6d' });\n\texport const triangleDown = new Codicon('triangle-down', { character: '\\\\eb6e' });\n\texport const triangleLeft = new Codicon('triangle-left', { character: '\\\\eb6f' });\n\texport const triangleRight = new Codicon('triangle-right', { character: '\\\\eb70' });\n\texport const triangleUp = new Codicon('triangle-up', { character: '\\\\eb71' });\n\texport const twitter = new Codicon('twitter', { character: '\\\\eb72' });\n\texport const unfold = new Codicon('unfold', { character: '\\\\eb73' });\n\texport const unlock = new Codicon('unlock', { character: '\\\\eb74' });\n\texport const unmute = new Codicon('unmute', { character: '\\\\eb75' });\n\texport const unverified = new Codicon('unverified', { character: '\\\\eb76' });\n\texport const verified = new Codicon('verified', { character: '\\\\eb77' });\n\texport const versions = new Codicon('versions', { character: '\\\\eb78' });\n\texport const vmActive = new Codicon('vm-active', { character: '\\\\eb79' });\n\texport const vmOutline = new Codicon('vm-outline', { character: '\\\\eb7a' });\n\texport const vmRunning = new Codicon('vm-running', { character: '\\\\eb7b' });\n\texport const watch = new Codicon('watch', { character: '\\\\eb7c' });\n\texport const whitespace = new Codicon('whitespace', { character: '\\\\eb7d' });\n\texport const wholeWord = new Codicon('whole-word', { character: '\\\\eb7e' });\n\texport const window = new Codicon('window', { character: '\\\\eb7f' });\n\texport const wordWrap = new Codicon('word-wrap', { character: '\\\\eb80' });\n\texport const zoomIn = new Codicon('zoom-in', { character: '\\\\eb81' });\n\texport const zoomOut = new Codicon('zoom-out', { character: '\\\\eb82' });\n\texport const listFilter = new Codicon('list-filter', { character: '\\\\eb83' });\n\texport const listFlat = new Codicon('list-flat', { character: '\\\\eb84' });\n\texport const listSelection = new Codicon('list-selection', { character: '\\\\eb85' });\n\texport const selection = new Codicon('selection', { character: '\\\\eb85' });\n\texport const listTree = new Codicon('list-tree', { character: '\\\\eb86' });\n\texport const debugBreakpointFunctionUnverified = new Codicon('debug-breakpoint-function-unverified', { character: '\\\\eb87' });\n\texport const debugBreakpointFunction = new Codicon('debug-breakpoint-function', { character: '\\\\eb88' });\n\texport const debugBreakpointFunctionDisabled = new Codicon('debug-breakpoint-function-disabled', { character: '\\\\eb88' });\n\texport const debugStackframeActive = new Codicon('debug-stackframe-active', { character: '\\\\eb89' });\n\texport const debugStackframeDot = new Codicon('debug-stackframe-dot', { character: '\\\\eb8a' });\n\texport const debugStackframe = new Codicon('debug-stackframe', { character: '\\\\eb8b' });\n\texport const debugStackframeFocused = new Codicon('debug-stackframe-focused', { character: '\\\\eb8b' });\n\texport const debugBreakpointUnsupported = new Codicon('debug-breakpoint-unsupported', { character: '\\\\eb8c' });\n\texport const symbolString = new Codicon('symbol-string', { character: '\\\\eb8d' });\n\texport const debugReverseContinue = new Codicon('debug-reverse-continue', { character: '\\\\eb8e' });\n\texport const debugStepBack = new Codicon('debug-step-back', { character: '\\\\eb8f' });\n\texport const debugRestartFrame = new Codicon('debug-restart-frame', { character: '\\\\eb90' });\n\texport const callIncoming = new Codicon('call-incoming', { character: '\\\\eb92' });\n\texport const callOutgoing = new Codicon('call-outgoing', { character: '\\\\eb93' });\n\texport const menu = new Codicon('menu', { character: '\\\\eb94' });\n\texport const expandAll = new Codicon('expand-all', { character: '\\\\eb95' });\n\texport const feedback = new Codicon('feedback', { character: '\\\\eb96' });\n\texport const groupByRefType = new Codicon('group-by-ref-type', { character: '\\\\eb97' });\n\texport const ungroupByRefType = new Codicon('ungroup-by-ref-type', { character: '\\\\eb98' });\n\texport const account = new Codicon('account', { character: '\\\\eb99' });\n\texport const bellDot = new Codicon('bell-dot', { character: '\\\\eb9a' });\n\texport const debugConsole = new Codicon('debug-console', { character: '\\\\eb9b' });\n\texport const library = new Codicon('library', { character: '\\\\eb9c' });\n\texport const output = new Codicon('output', { character: '\\\\eb9d' });\n\texport const runAll = new Codicon('run-all', { character: '\\\\eb9e' });\n\texport const syncIgnored = new Codicon('sync-ignored', { character: '\\\\eb9f' });\n\texport const pinned = new Codicon('pinned', { character: '\\\\eba0' });\n\texport const githubInverted = new Codicon('github-inverted', { character: '\\\\eba1' });\n\texport const debugAlt = new Codicon('debug-alt', { character: '\\\\eb91' });\n\texport const serverProcess = new Codicon('server-process', { character: '\\\\eba2' });\n\texport const serverEnvironment = new Codicon('server-environment', { character: '\\\\eba3' });\n\texport const pass = new Codicon('pass', { character: '\\\\eba4' });\n\texport const stopCircle = new Codicon('stop-circle', { character: '\\\\eba5' });\n\texport const playCircle = new Codicon('play-circle', { character: '\\\\eba6' });\n\texport const record = new Codicon('record', { character: '\\\\eba7' });\n\texport const debugAltSmall = new Codicon('debug-alt-small', { character: '\\\\eba8' });\n\texport const vmConnect = new Codicon('vm-connect', { character: '\\\\eba9' });\n\texport const cloud = new Codicon('cloud', { character: '\\\\ebaa' });\n\texport const merge = new Codicon('merge', { character: '\\\\ebab' });\n\texport const exportIcon = new Codicon('export', { character: '\\\\ebac' });\n\texport const graphLeft = new Codicon('graph-left', { character: '\\\\ebad' });\n\texport const magnet = new Codicon('magnet', { character: '\\\\ebae' });\n\texport const notebook = new Codicon('notebook', { character: '\\\\ebaf' });\n\texport const redo = new Codicon('redo', { character: '\\\\ebb0' });\n\texport const checkAll = new Codicon('check-all', { character: '\\\\ebb1' });\n\texport const pinnedDirty = new Codicon('pinned-dirty', { character: '\\\\ebb2' });\n\texport const passFilled = new Codicon('pass-filled', { character: '\\\\ebb3' });\n\texport const circleLargeFilled = new Codicon('circle-large-filled', { character: '\\\\ebb4' });\n\texport const circleLargeOutline = new Codicon('circle-large-outline', { character: '\\\\ebb5' });\n\texport const combine = new Codicon('combine', { character: '\\\\ebb6' });\n\texport const gather = new Codicon('gather', { character: '\\\\ebb6' });\n\texport const table = new Codicon('table', { character: '\\\\ebb7' });\n\texport const variableGroup = new Codicon('variable-group', { character: '\\\\ebb8' });\n\texport const typeHierarchy = new Codicon('type-hierarchy', { character: '\\\\ebb9' });\n\texport const typeHierarchySub = new Codicon('type-hierarchy-sub', { character: '\\\\ebba' });\n\texport const typeHierarchySuper = new Codicon('type-hierarchy-super', { character: '\\\\ebbb' });\n\texport const gitPullRequestCreate = new Codicon('git-pull-request-create', { character: '\\\\ebbc' });\n\n\texport const dropDownButton = new Codicon('drop-down-button', Codicon.chevronDown.definition);\n}\n\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { sep } from 'vs/base/common/path';\nimport { IdleValue } from 'vs/base/common/async';\n\n// When comparing large numbers of strings, such as in sorting large arrays, is better for\n// performance to create an Intl.Collator object and use the function provided by its compare\n// property than it is to use String.prototype.localeCompare()\n\n// A collator with numeric sorting enabled, and no sensitivity to case or to accents\nconst intlFileNameCollatorBaseNumeric: IdleValue<{ collator: Intl.Collator, collatorIsNumeric: boolean }> = new IdleValue(() => {\n\tconst collator = new Intl.Collator(undefined, { numeric: true, sensitivity: 'base' });\n\treturn {\n\t\tcollator: collator,\n\t\tcollatorIsNumeric: collator.resolvedOptions().numeric\n\t};\n});\n\n// A collator with numeric sorting enabled.\nconst intlFileNameCollatorNumeric: IdleValue<{ collator: Intl.Collator }> = new IdleValue(() => {\n\tconst collator = new Intl.Collator(undefined, { numeric: true });\n\treturn {\n\t\tcollator: collator\n\t};\n});\n\n// A collator with numeric sorting enabled, and sensitivity to accents and diacritics but not case.\nconst intlFileNameCollatorNumericCaseInsenstive: IdleValue<{ collator: Intl.Collator }> = new IdleValue(() => {\n\tconst collator = new Intl.Collator(undefined, { numeric: true, sensitivity: 'accent' });\n\treturn {\n\t\tcollator: collator\n\t};\n});/** Compares filenames without distinguishing the name from the extension. Disambiguates by unicode comparison. */\nexport function compareFileNames(one: string | null, other: string | null, caseSensitive = false): number {\n\tconst a = one || '';\n\tconst b = other || '';\n\tconst result = intlFileNameCollatorBaseNumeric.value.collator.compare(a, b);\n\n\t// Using the numeric option in the collator will\n\t// make compare(`foo1`, `foo01`) === 0. We must disambiguate.\n\tif (intlFileNameCollatorBaseNumeric.value.collatorIsNumeric && result === 0 && a !== b) {\n\t\treturn a < b ? -1 : 1;\n\t}\n\n\treturn result;\n}\n\n/** Compares filenames without distinguishing the name from the extension. Disambiguates by length, not unicode comparison. */\nexport function compareFileNamesDefault(one: string | null, other: string | null): number {\n\tconst collatorNumeric = intlFileNameCollatorNumeric.value.collator;\n\tone = one || '';\n\tother = other || '';\n\n\t// Compare the entire filename - both name and extension - and disambiguate by length if needed\n\treturn compareAndDisambiguateByLength(collatorNumeric, one, other);\n}\n\nexport function noIntlCompareFileNames(one: string | null, other: string | null, caseSensitive = false): number {\n\tif (!caseSensitive) {\n\t\tone = one && one.toLowerCase();\n\t\tother = other && other.toLowerCase();\n\t}\n\n\tconst [oneName, oneExtension] = extractNameAndExtension(one);\n\tconst [otherName, otherExtension] = extractNameAndExtension(other);\n\n\tif (oneName !== otherName) {\n\t\treturn oneName < otherName ? -1 : 1;\n\t}\n\n\tif (oneExtension === otherExtension) {\n\t\treturn 0;\n\t}\n\n\treturn oneExtension < otherExtension ? -1 : 1;\n}\n\nexport function compareFileExtensions(one: string | null, other: string | null): number {\n\tconst [oneName, oneExtension] = extractNameAndExtension(one);\n\tconst [otherName, otherExtension] = extractNameAndExtension(other);\n\n\tlet result = intlFileNameCollatorBaseNumeric.value.collator.compare(oneExtension, otherExtension);\n\n\tif (result === 0) {\n\t\t// Using the numeric option in the collator will\n\t\t// make compare(`foo1`, `foo01`) === 0. We must disambiguate.\n\t\tif (intlFileNameCollatorBaseNumeric.value.collatorIsNumeric && oneExtension !== otherExtension) {\n\t\t\treturn oneExtension < otherExtension ? -1 : 1;\n\t\t}\n\n\t\t// Extensions are equal, compare filenames\n\t\tresult = intlFileNameCollatorBaseNumeric.value.collator.compare(oneName, otherName);\n\n\t\tif (intlFileNameCollatorBaseNumeric.value.collatorIsNumeric && result === 0 && oneName !== otherName) {\n\t\t\treturn oneName < otherName ? -1 : 1;\n\t\t}\n\t}\n\n\treturn result;\n}\n\n/** Compares filenames by extenson, then by full filename */\nexport function compareFileExtensionsDefault(one: string | null, other: string | null): number {\n\tone = one || '';\n\tother = other || '';\n\tconst oneExtension = extractExtension(one);\n\tconst otherExtension = extractExtension(other);\n\tconst collatorNumeric = intlFileNameCollatorNumeric.value.collator;\n\tconst collatorNumericCaseInsensitive = intlFileNameCollatorNumericCaseInsenstive.value.collator;\n\tlet result;\n\n\t// Check for extension differences, ignoring differences in case and comparing numbers numerically.\n\tresult = compareAndDisambiguateByLength(collatorNumericCaseInsensitive, oneExtension, otherExtension);\n\tif (result !== 0) {\n\t\treturn result;\n\t}\n\n\t// Compare full filenames\n\treturn compareAndDisambiguateByLength(collatorNumeric, one, other);\n}\n\nconst FileNameMatch = /^(.*?)(\\.([^.]*))?$/;\n\n/** Extracts the name and extension from a full filename, with optional special handling for dotfiles */\nfunction extractNameAndExtension(str?: string | null, dotfilesAsNames = false): [string, string] {\n\tconst match = str ? FileNameMatch.exec(str) as Array<string> : ([] as Array<string>);\n\n\tlet result: [string, string] = [(match && match[1]) || '', (match && match[3]) || ''];\n\n\t// if the dotfilesAsNames option is selected, treat an empty filename with an extension,\n\t// or a filename that starts with a dot, as a dotfile name\n\tif (dotfilesAsNames && (!result[0] && result[1] || result[0] && result[0].charAt(0) === '.')) {\n\t\tresult = [result[0] + '.' + result[1], ''];\n\t}\n\n\treturn result;\n}\n\n/** Extracts the extension from a full filename. Treats dotfiles as names, not extensions. */\nfunction extractExtension(str?: string | null): string {\n\tconst match = str ? FileNameMatch.exec(str) as Array<string> : ([] as Array<string>);\n\n\treturn (match && match[1] && match[1].charAt(0) !== '.' && match[3]) || '';\n}\n\nfunction compareAndDisambiguateByLength(collator: Intl.Collator, one: string, other: string) {\n\t// Check for differences\n\tlet result = collator.compare(one, other);\n\tif (result !== 0) {\n\t\treturn result;\n\t}\n\n\t// In a numeric comparison, `foo1` and `foo01` will compare as equivalent.\n\t// Disambiguate by sorting the shorter string first.\n\tif (one.length !== other.length) {\n\t\treturn one.length < other.length ? -1 : 1;\n\t}\n\n\treturn 0;\n}\n\nfunction comparePathComponents(one: string, other: string, caseSensitive = false): number {\n\tif (!caseSensitive) {\n\t\tone = one && one.toLowerCase();\n\t\tother = other && other.toLowerCase();\n\t}\n\n\tif (one === other) {\n\t\treturn 0;\n\t}\n\n\treturn one < other ? -1 : 1;\n}\n\nexport function comparePaths(one: string, other: string, caseSensitive = false): number {\n\tconst oneParts = one.split(sep);\n\tconst otherParts = other.split(sep);\n\n\tconst lastOne = oneParts.length - 1;\n\tconst lastOther = otherParts.length - 1;\n\tlet endOne: boolean, endOther: boolean;\n\n\tfor (let i = 0; ; i++) {\n\t\tendOne = lastOne === i;\n\t\tendOther = lastOther === i;\n\n\t\tif (endOne && endOther) {\n\t\t\treturn compareFileNames(oneParts[i], otherParts[i], caseSensitive);\n\t\t} else if (endOne) {\n\t\t\treturn -1;\n\t\t} else if (endOther) {\n\t\t\treturn 1;\n\t\t}\n\n\t\tconst result = comparePathComponents(oneParts[i], otherParts[i], caseSensitive);\n\n\t\tif (result !== 0) {\n\t\t\treturn result;\n\t\t}\n\t}\n}\n\nexport function compareAnything(one: string, other: string, lookFor: string): number {\n\tconst elementAName = one.toLowerCase();\n\tconst elementBName = other.toLowerCase();\n\n\t// Sort prefix matches over non prefix matches\n\tconst prefixCompare = compareByPrefix(one, other, lookFor);\n\tif (prefixCompare) {\n\t\treturn prefixCompare;\n\t}\n\n\t// Sort suffix matches over non suffix matches\n\tconst elementASuffixMatch = elementAName.endsWith(lookFor);\n\tconst elementBSuffixMatch = elementBName.endsWith(lookFor);\n\tif (elementASuffixMatch !== elementBSuffixMatch) {\n\t\treturn elementASuffixMatch ? -1 : 1;\n\t}\n\n\t// Understand file names\n\tconst r = compareFileNames(elementAName, elementBName);\n\tif (r !== 0) {\n\t\treturn r;\n\t}\n\n\t// Compare by name\n\treturn elementAName.localeCompare(elementBName);\n}\n\nexport function compareByPrefix(one: string, other: string, lookFor: string): number {\n\tconst elementAName = one.toLowerCase();\n\tconst elementBName = other.toLowerCase();\n\n\t// Sort prefix matches over non prefix matches\n\tconst elementAPrefixMatch = elementAName.startsWith(lookFor);\n\tconst elementBPrefixMatch = elementBName.startsWith(lookFor);\n\tif (elementAPrefixMatch !== elementBPrefixMatch) {\n\t\treturn elementAPrefixMatch ? -1 : 1;\n\t}\n\n\t// Same prefix: Sort shorter matches to the top to have those on top that match more precisely\n\telse if (elementAPrefixMatch && elementBPrefixMatch) {\n\t\tif (elementAName.length < elementBName.length) {\n\t\t\treturn -1;\n\t\t}\n\n\t\tif (elementAName.length > elementBName.length) {\n\t\t\treturn 1;\n\t\t}\n\t}\n\n\treturn 0;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { onUnexpectedError } from 'vs/base/common/errors';\nimport { DisposableStore, toDisposable } from 'vs/base/common/lifecycle';\n\n/**\n * The payload that flows in readable stream events.\n */\nexport type ReadableStreamEventPayload<T> = T | Error | 'end';\n\nexport interface ReadableStreamEvents<T> {\n\n\t/**\n\t * The 'data' event is emitted whenever the stream is\n\t * relinquishing ownership of a chunk of data to a consumer.\n\t */\n\ton(event: 'data', callback: (data: T) => void): void;\n\n\t/**\n\t * Emitted when any error occurs.\n\t */\n\ton(event: 'error', callback: (err: Error) => void): void;\n\n\t/**\n\t * The 'end' event is emitted when there is no more data\n\t * to be consumed from the stream. The 'end' event will\n\t * not be emitted unless the data is completely consumed.\n\t */\n\ton(event: 'end', callback: () => void): void;\n}\n\n/**\n * A interface that emulates the API shape of a node.js readable\n * stream for use in native and web environments.\n */\nexport interface ReadableStream<T> extends ReadableStreamEvents<T> {\n\n\t/**\n\t * Stops emitting any events until resume() is called.\n\t */\n\tpause(): void;\n\n\t/**\n\t * Starts emitting events again after pause() was called.\n\t */\n\tresume(): void;\n\n\t/**\n\t * Destroys the stream and stops emitting any event.\n\t */\n\tdestroy(): void;\n\n\t/**\n\t * Allows to remove a listener that was previously added.\n\t */\n\tremoveListener(event: string, callback: Function): void;\n}\n\n/**\n * A interface that emulates the API shape of a node.js readable\n * for use in native and web environments.\n */\nexport interface Readable<T> {\n\n\t/**\n\t * Read data from the underlying source. Will return\n\t * null to indicate that no more data can be read.\n\t */\n\tread(): T | null;\n}\n\n/**\n * A interface that emulates the API shape of a node.js writeable\n * stream for use in native and web environments.\n */\nexport interface WriteableStream<T> extends ReadableStream<T> {\n\n\t/**\n\t * Writing data to the stream will trigger the on('data')\n\t * event listener if the stream is flowing and buffer the\n\t * data otherwise until the stream is flowing.\n\t *\n\t * If a `highWaterMark` is configured and writing to the\n\t * stream reaches this mark, a promise will be returned\n\t * that should be awaited on before writing more data.\n\t * Otherwise there is a risk of buffering a large number\n\t * of data chunks without consumer.\n\t */\n\twrite(data: T): void | Promise<void>;\n\n\t/**\n\t * Signals an error to the consumer of the stream via the\n\t * on('error') handler if the stream is flowing.\n\t */\n\terror(error: Error): void;\n\n\t/**\n\t * Signals the end of the stream to the consumer. If the\n\t * result is not an error, will trigger the on('data') event\n\t * listener if the stream is flowing and buffer the data\n\t * otherwise until the stream is flowing.\n\t *\n\t * In case of an error, the on('error') event will be used\n\t * if the stream is flowing.\n\t */\n\tend(result?: T | Error): void;\n}\n\n/**\n * A stream that has a buffer already read. Returns the original stream\n * that was read as well as the chunks that got read.\n *\n * The `ended` flag indicates if the stream has been fully consumed.\n */\nexport interface ReadableBufferedStream<T> {\n\n\t/**\n\t * The original stream that is being read.\n\t */\n\tstream: ReadableStream<T>;\n\n\t/**\n\t * An array of chunks already read from this stream.\n\t */\n\tbuffer: T[];\n\n\t/**\n\t * Signals if the stream has ended or not. If not, consumers\n\t * should continue to read from the stream until consumed.\n\t */\n\tended: boolean;\n}\n\nexport function isReadableStream<T>(obj: unknown): obj is ReadableStream<T> {\n\tconst candidate = obj as ReadableStream<T>;\n\n\treturn candidate && [candidate.on, candidate.pause, candidate.resume, candidate.destroy].every(fn => typeof fn === 'function');\n}\n\nexport function isReadableBufferedStream<T>(obj: unknown): obj is ReadableBufferedStream<T> {\n\tconst candidate = obj as ReadableBufferedStream<T>;\n\n\treturn candidate && isReadableStream(candidate.stream) && Array.isArray(candidate.buffer) && typeof candidate.ended === 'boolean';\n}\n\nexport interface IReducer<T> {\n\t(data: T[]): T;\n}\n\nexport interface IDataTransformer<Original, Transformed> {\n\t(data: Original): Transformed;\n}\n\nexport interface IErrorTransformer {\n\t(error: Error): Error;\n}\n\nexport interface ITransformer<Original, Transformed> {\n\tdata: IDataTransformer<Original, Transformed>;\n\terror?: IErrorTransformer;\n}\n\nexport function newWriteableStream<T>(reducer: IReducer<T>, options?: WriteableStreamOptions): WriteableStream<T> {\n\treturn new WriteableStreamImpl<T>(reducer, options);\n}\n\nexport interface WriteableStreamOptions {\n\n\t/**\n\t * The number of objects to buffer before WriteableStream#write()\n\t * signals back that the buffer is full. Can be used to reduce\n\t * the memory pressure when the stream is not flowing.\n\t */\n\thighWaterMark?: number;\n}\n\nclass WriteableStreamImpl<T> implements WriteableStream<T> {\n\n\tprivate readonly state = {\n\t\tflowing: false,\n\t\tended: false,\n\t\tdestroyed: false\n\t};\n\n\tprivate readonly buffer = {\n\t\tdata: [] as T[],\n\t\terror: [] as Error[]\n\t};\n\n\tprivate readonly listeners = {\n\t\tdata: [] as { (data: T): void }[],\n\t\terror: [] as { (error: Error): void }[],\n\t\tend: [] as { (): void }[]\n\t};\n\n\tprivate readonly pendingWritePromises: Function[] = [];\n\n\tconstructor(private reducer: IReducer<T>, private options?: WriteableStreamOptions) { }\n\n\tpause(): void {\n\t\tif (this.state.destroyed) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.state.flowing = false;\n\t}\n\n\tresume(): void {\n\t\tif (this.state.destroyed) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.state.flowing) {\n\t\t\tthis.state.flowing = true;\n\n\t\t\t// emit buffered events\n\t\t\tthis.flowData();\n\t\t\tthis.flowErrors();\n\t\t\tthis.flowEnd();\n\t\t}\n\t}\n\n\twrite(data: T): void | Promise<void> {\n\t\tif (this.state.destroyed) {\n\t\t\treturn;\n\t\t}\n\n\t\t// flowing: directly send the data to listeners\n\t\tif (this.state.flowing) {\n\t\t\tthis.emitData(data);\n\t\t}\n\n\t\t// not yet flowing: buffer data until flowing\n\t\telse {\n\t\t\tthis.buffer.data.push(data);\n\n\t\t\t// highWaterMark: if configured, signal back when buffer reached limits\n\t\t\tif (typeof this.options?.highWaterMark === 'number' && this.buffer.data.length > this.options.highWaterMark) {\n\t\t\t\treturn new Promise(resolve => this.pendingWritePromises.push(resolve));\n\t\t\t}\n\t\t}\n\t}\n\n\terror(error: Error): void {\n\t\tif (this.state.destroyed) {\n\t\t\treturn;\n\t\t}\n\n\t\t// flowing: directly send the error to listeners\n\t\tif (this.state.flowing) {\n\t\t\tthis.emitError(error);\n\t\t}\n\n\t\t// not yet flowing: buffer errors until flowing\n\t\telse {\n\t\t\tthis.buffer.error.push(error);\n\t\t}\n\t}\n\n\tend(result?: T | Error): void {\n\t\tif (this.state.destroyed) {\n\t\t\treturn;\n\t\t}\n\n\t\t// end with data or error if provided\n\t\tif (result instanceof Error) {\n\t\t\tthis.error(result);\n\t\t} else if (result) {\n\t\t\tthis.write(result);\n\t\t}\n\n\t\t// flowing: send end event to listeners\n\t\tif (this.state.flowing) {\n\t\t\tthis.emitEnd();\n\n\t\t\tthis.destroy();\n\t\t}\n\n\t\t// not yet flowing: remember state\n\t\telse {\n\t\t\tthis.state.ended = true;\n\t\t}\n\t}\n\n\tprivate emitData(data: T): void {\n\t\tthis.listeners.data.slice(0).forEach(listener => listener(data)); // slice to avoid listener mutation from delivering event\n\t}\n\n\tprivate emitError(error: Error): void {\n\t\tif (this.listeners.error.length === 0) {\n\t\t\tonUnexpectedError(error); // nobody listened to this error so we log it as unexpected\n\t\t} else {\n\t\t\tthis.listeners.error.slice(0).forEach(listener => listener(error)); // slice to avoid listener mutation from delivering event\n\t\t}\n\t}\n\n\tprivate emitEnd(): void {\n\t\tthis.listeners.end.slice(0).forEach(listener => listener()); // slice to avoid listener mutation from delivering event\n\t}\n\n\ton(event: 'data', callback: (data: T) => void): void;\n\ton(event: 'error', callback: (err: Error) => void): void;\n\ton(event: 'end', callback: () => void): void;\n\ton(event: 'data' | 'error' | 'end', callback: (arg0?: any) => void): void {\n\t\tif (this.state.destroyed) {\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (event) {\n\t\t\tcase 'data':\n\t\t\t\tthis.listeners.data.push(callback);\n\n\t\t\t\t// switch into flowing mode as soon as the first 'data'\n\t\t\t\t// listener is added and we are not yet in flowing mode\n\t\t\t\tthis.resume();\n\n\t\t\t\tbreak;\n\n\t\t\tcase 'end':\n\t\t\t\tthis.listeners.end.push(callback);\n\n\t\t\t\t// emit 'end' event directly if we are flowing\n\t\t\t\t// and the end has already been reached\n\t\t\t\t//\n\t\t\t\t// finish() when it went through\n\t\t\t\tif (this.state.flowing && this.flowEnd()) {\n\t\t\t\t\tthis.destroy();\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase 'error':\n\t\t\t\tthis.listeners.error.push(callback);\n\n\t\t\t\t// emit buffered 'error' events unless done already\n\t\t\t\t// now that we know that we have at least one listener\n\t\t\t\tif (this.state.flowing) {\n\t\t\t\t\tthis.flowErrors();\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tremoveListener(event: string, callback: Function): void {\n\t\tif (this.state.destroyed) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet listeners: unknown[] | undefined = undefined;\n\n\t\tswitch (event) {\n\t\t\tcase 'data':\n\t\t\t\tlisteners = this.listeners.data;\n\t\t\t\tbreak;\n\n\t\t\tcase 'end':\n\t\t\t\tlisteners = this.listeners.end;\n\t\t\t\tbreak;\n\n\t\t\tcase 'error':\n\t\t\t\tlisteners = this.listeners.error;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (listeners) {\n\t\t\tconst index = listeners.indexOf(callback);\n\t\t\tif (index >= 0) {\n\t\t\t\tlisteners.splice(index, 1);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate flowData(): void {\n\t\tif (this.buffer.data.length > 0) {\n\t\t\tconst fullDataBuffer = this.reducer(this.buffer.data);\n\n\t\t\tthis.emitData(fullDataBuffer);\n\n\t\t\tthis.buffer.data.length = 0;\n\n\t\t\t// When the buffer is empty, resolve all pending writers\n\t\t\tconst pendingWritePromises = [...this.pendingWritePromises];\n\t\t\tthis.pendingWritePromises.length = 0;\n\t\t\tpendingWritePromises.forEach(pendingWritePromise => pendingWritePromise());\n\t\t}\n\t}\n\n\tprivate flowErrors(): void {\n\t\tif (this.listeners.error.length > 0) {\n\t\t\tfor (const error of this.buffer.error) {\n\t\t\t\tthis.emitError(error);\n\t\t\t}\n\n\t\t\tthis.buffer.error.length = 0;\n\t\t}\n\t}\n\n\tprivate flowEnd(): boolean {\n\t\tif (this.state.ended) {\n\t\t\tthis.emitEnd();\n\n\t\t\treturn this.listeners.end.length > 0;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tdestroy(): void {\n\t\tif (!this.state.destroyed) {\n\t\t\tthis.state.destroyed = true;\n\t\t\tthis.state.ended = true;\n\n\t\t\tthis.buffer.data.length = 0;\n\t\t\tthis.buffer.error.length = 0;\n\n\t\t\tthis.listeners.data.length = 0;\n\t\t\tthis.listeners.error.length = 0;\n\t\t\tthis.listeners.end.length = 0;\n\n\t\t\tthis.pendingWritePromises.length = 0;\n\t\t}\n\t}\n}\n\n/**\n * Helper to fully read a T readable into a T.\n */\nexport function consumeReadable<T>(readable: Readable<T>, reducer: IReducer<T>): T {\n\tconst chunks: T[] = [];\n\n\tlet chunk: T | null;\n\twhile ((chunk = readable.read()) !== null) {\n\t\tchunks.push(chunk);\n\t}\n\n\treturn reducer(chunks);\n}\n\n/**\n * Helper to read a T readable up to a maximum of chunks. If the limit is\n * reached, will return a readable instead to ensure all data can still\n * be read.\n */\nexport function peekReadable<T>(readable: Readable<T>, reducer: IReducer<T>, maxChunks: number): T | Readable<T> {\n\tconst chunks: T[] = [];\n\n\tlet chunk: T | null | undefined = undefined;\n\twhile ((chunk = readable.read()) !== null && chunks.length < maxChunks) {\n\t\tchunks.push(chunk);\n\t}\n\n\t// If the last chunk is null, it means we reached the end of\n\t// the readable and return all the data at once\n\tif (chunk === null && chunks.length > 0) {\n\t\treturn reducer(chunks);\n\t}\n\n\t// Otherwise, we still have a chunk, it means we reached the maxChunks\n\t// value and as such we return a new Readable that first returns\n\t// the existing read chunks and then continues with reading from\n\t// the underlying readable.\n\treturn {\n\t\tread: () => {\n\n\t\t\t// First consume chunks from our array\n\t\t\tif (chunks.length > 0) {\n\t\t\t\treturn chunks.shift()!;\n\t\t\t}\n\n\t\t\t// Then ensure to return our last read chunk\n\t\t\tif (typeof chunk !== 'undefined') {\n\t\t\t\tconst lastReadChunk = chunk;\n\n\t\t\t\t// explicitly use undefined here to indicate that we consumed\n\t\t\t\t// the chunk, which could have either been null or valued.\n\t\t\t\tchunk = undefined;\n\n\t\t\t\treturn lastReadChunk;\n\t\t\t}\n\n\t\t\t// Finally delegate back to the Readable\n\t\t\treturn readable.read();\n\t\t}\n\t};\n}\n\n/**\n * Helper to fully read a T stream into a T.\n */\nexport function consumeStream<T>(stream: ReadableStreamEvents<T>, reducer: IReducer<T>): Promise<T> {\n\treturn new Promise((resolve, reject) => {\n\t\tconst chunks: T[] = [];\n\n\t\tstream.on('error', error => reject(error));\n\t\tstream.on('end', () => resolve(reducer(chunks)));\n\n\t\t// Adding the `data` listener will turn the stream\n\t\t// into flowing mode. As such it is important to\n\t\t// add this listener last (DO NOT CHANGE!)\n\t\tstream.on('data', data => chunks.push(data));\n\t});\n}\n\n/**\n * Helper to peek up to `maxChunks` into a stream. The return type signals if\n * the stream has ended or not. If not, caller needs to add a `data` listener\n * to continue reading.\n */\nexport function peekStream<T>(stream: ReadableStream<T>, maxChunks: number): Promise<ReadableBufferedStream<T>> {\n\treturn new Promise((resolve, reject) => {\n\t\tconst streamListeners = new DisposableStore();\n\n\t\t// Data Listener\n\t\tconst buffer: T[] = [];\n\t\tconst dataListener = (chunk: T) => {\n\n\t\t\t// Add to buffer\n\t\t\tbuffer.push(chunk);\n\n\t\t\t// We reached maxChunks and thus need to return\n\t\t\tif (buffer.length > maxChunks) {\n\n\t\t\t\t// Dispose any listeners and ensure to pause the\n\t\t\t\t// stream so that it can be consumed again by caller\n\t\t\t\tstreamListeners.dispose();\n\t\t\t\tstream.pause();\n\n\t\t\t\treturn resolve({ stream, buffer, ended: false });\n\t\t\t}\n\t\t};\n\n\t\tstreamListeners.add(toDisposable(() => stream.removeListener('data', dataListener)));\n\t\tstream.on('data', dataListener);\n\n\t\t// Error Listener\n\t\tconst errorListener = (error: Error) => {\n\t\t\treturn reject(error);\n\t\t};\n\n\t\tstreamListeners.add(toDisposable(() => stream.removeListener('error', errorListener)));\n\t\tstream.on('error', errorListener);\n\n\t\tconst endListener = () => {\n\t\t\treturn resolve({ stream, buffer, ended: true });\n\t\t};\n\n\t\tstreamListeners.add(toDisposable(() => stream.removeListener('end', endListener)));\n\t\tstream.on('end', endListener);\n\t});\n}\n\n/**\n * Helper to create a readable stream from an existing T.\n */\nexport function toStream<T>(t: T, reducer: IReducer<T>): ReadableStream<T> {\n\tconst stream = newWriteableStream<T>(reducer);\n\n\tstream.end(t);\n\n\treturn stream;\n}\n\n/**\n * Helper to convert a T into a Readable<T>.\n */\nexport function toReadable<T>(t: T): Readable<T> {\n\tlet consumed = false;\n\n\treturn {\n\t\tread: () => {\n\t\t\tif (consumed) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconsumed = true;\n\n\t\t\treturn t;\n\t\t}\n\t};\n}\n\n/**\n * Helper to transform a readable stream into another stream.\n */\nexport function transform<Original, Transformed>(stream: ReadableStreamEvents<Original>, transformer: ITransformer<Original, Transformed>, reducer: IReducer<Transformed>): ReadableStream<Transformed> {\n\tconst target = newWriteableStream<Transformed>(reducer);\n\n\tstream.on('data', data => target.write(transformer.data(data)));\n\tstream.on('end', () => target.end());\n\tstream.on('error', error => target.error(transformer.error ? transformer.error(error) : error));\n\n\treturn target;\n}\n\nexport interface IReadableStreamObservable {\n\n\t/**\n\t * A promise to await the `end` or `error` event\n\t * of a stream.\n\t */\n\terrorOrEnd: () => Promise<void>;\n}\n\n/**\n * Helper to observe a stream for certain events through\n * a promise based API.\n */\nexport function observe(stream: ReadableStream<unknown>): IReadableStreamObservable {\n\n\t// A stream is closed when it ended or errord\n\t// We install this listener right from the\n\t// beginning to catch the events early.\n\tconst errorOrEnd = Promise.race([\n\t\tnew Promise<void>(resolve => stream.on('end', () => resolve())),\n\t\tnew Promise<void>(resolve => stream.on('error', () => resolve()))\n\t]);\n\n\treturn {\n\t\terrorOrEnd(): Promise<void> {\n\n\t\t\t// We need to ensure the stream is flowing so that our\n\t\t\t// listeners are getting triggered. It is possible that\n\t\t\t// the stream is not flowing because no `data` listener\n\t\t\t// was attached yet.\n\t\t\tstream.resume();\n\n\t\t\treturn errorOrEnd;\n\t\t}\n\t};\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CharCode } from 'vs/base/common/charCode';\nimport { Constants } from 'vs/base/common/uint';\n\nexport function isFalsyOrWhitespace(str: string | undefined): boolean {\n\tif (!str || typeof str !== 'string') {\n\t\treturn true;\n\t}\n\treturn str.trim().length === 0;\n}\n\nconst _formatRegexp = /{(\\d+)}/g;\n\n/**\n * Helper to produce a string with a variable number of arguments. Insert variable segments\n * into the string using the {n} notation where N is the index of the argument following the string.\n * @param value string to which formatting is applied\n * @param args replacements for {n}-entries\n */\nexport function format(value: string, ...args: any[]): string {\n\tif (args.length === 0) {\n\t\treturn value;\n\t}\n\treturn value.replace(_formatRegexp, function (match, group) {\n\t\tconst idx = parseInt(group, 10);\n\t\treturn isNaN(idx) || idx < 0 || idx >= args.length ?\n\t\t\tmatch :\n\t\t\targs[idx];\n\t});\n}\n\n/**\n * Converts HTML characters inside the string to use entities instead. Makes the string safe from\n * being used e.g. in HTMLElement.innerHTML.\n */\nexport function escape(html: string): string {\n\treturn html.replace(/[<>&]/g, function (match) {\n\t\tswitch (match) {\n\t\t\tcase '<': return '&lt;';\n\t\t\tcase '>': return '&gt;';\n\t\t\tcase '&': return '&amp;';\n\t\t\tdefault: return match;\n\t\t}\n\t});\n}\n\n/**\n * Escapes regular expression characters in a given string\n */\nexport function escapeRegExpCharacters(value: string): string {\n\treturn value.replace(/[\\\\\\{\\}\\*\\+\\?\\|\\^\\$\\.\\[\\]\\(\\)]/g, '\\\\$&');\n}\n\n/**\n * Counts how often `character` occurs inside `value`.\n */\nexport function count(value: string, character: string): number {\n\tlet result = 0;\n\tconst ch = character.charCodeAt(0);\n\tfor (let i = value.length - 1; i >= 0; i--) {\n\t\tif (value.charCodeAt(i) === ch) {\n\t\t\tresult++;\n\t\t}\n\t}\n\treturn result;\n}\n\nexport function truncate(value: string, maxLength: number, suffix = '…'): string {\n\tif (value.length <= maxLength) {\n\t\treturn value;\n\t}\n\n\treturn `${value.substr(0, maxLength)}${suffix}`;\n}\n\n/**\n * Removes all occurrences of needle from the beginning and end of haystack.\n * @param haystack string to trim\n * @param needle the thing to trim (default is a blank)\n */\nexport function trim(haystack: string, needle: string = ' '): string {\n\tconst trimmed = ltrim(haystack, needle);\n\treturn rtrim(trimmed, needle);\n}\n\n/**\n * Removes all occurrences of needle from the beginning of haystack.\n * @param haystack string to trim\n * @param needle the thing to trim\n */\nexport function ltrim(haystack: string, needle: string): string {\n\tif (!haystack || !needle) {\n\t\treturn haystack;\n\t}\n\n\tconst needleLen = needle.length;\n\tif (needleLen === 0 || haystack.length === 0) {\n\t\treturn haystack;\n\t}\n\n\tlet offset = 0;\n\n\twhile (haystack.indexOf(needle, offset) === offset) {\n\t\toffset = offset + needleLen;\n\t}\n\treturn haystack.substring(offset);\n}\n\n/**\n * Removes all occurrences of needle from the end of haystack.\n * @param haystack string to trim\n * @param needle the thing to trim\n */\nexport function rtrim(haystack: string, needle: string): string {\n\tif (!haystack || !needle) {\n\t\treturn haystack;\n\t}\n\n\tconst needleLen = needle.length,\n\t\thaystackLen = haystack.length;\n\n\tif (needleLen === 0 || haystackLen === 0) {\n\t\treturn haystack;\n\t}\n\n\tlet offset = haystackLen,\n\t\tidx = -1;\n\n\twhile (true) {\n\t\tidx = haystack.lastIndexOf(needle, offset - 1);\n\t\tif (idx === -1 || idx + needleLen !== offset) {\n\t\t\tbreak;\n\t\t}\n\t\tif (idx === 0) {\n\t\t\treturn '';\n\t\t}\n\t\toffset = idx;\n\t}\n\n\treturn haystack.substring(0, offset);\n}\n\nexport function convertSimple2RegExpPattern(pattern: string): string {\n\treturn pattern.replace(/[\\-\\\\\\{\\}\\+\\?\\|\\^\\$\\.\\,\\[\\]\\(\\)\\#\\s]/g, '\\\\$&').replace(/[\\*]/g, '.*');\n}\n\nexport function stripWildcards(pattern: string): string {\n\treturn pattern.replace(/\\*/g, '');\n}\n\nexport interface RegExpOptions {\n\tmatchCase?: boolean;\n\twholeWord?: boolean;\n\tmultiline?: boolean;\n\tglobal?: boolean;\n\tunicode?: boolean;\n}\n\nexport function createRegExp(searchString: string, isRegex: boolean, options: RegExpOptions = {}): RegExp {\n\tif (!searchString) {\n\t\tthrow new Error('Cannot create regex from empty string');\n\t}\n\tif (!isRegex) {\n\t\tsearchString = escapeRegExpCharacters(searchString);\n\t}\n\tif (options.wholeWord) {\n\t\tif (!/\\B/.test(searchString.charAt(0))) {\n\t\t\tsearchString = '\\\\b' + searchString;\n\t\t}\n\t\tif (!/\\B/.test(searchString.charAt(searchString.length - 1))) {\n\t\t\tsearchString = searchString + '\\\\b';\n\t\t}\n\t}\n\tlet modifiers = '';\n\tif (options.global) {\n\t\tmodifiers += 'g';\n\t}\n\tif (!options.matchCase) {\n\t\tmodifiers += 'i';\n\t}\n\tif (options.multiline) {\n\t\tmodifiers += 'm';\n\t}\n\tif (options.unicode) {\n\t\tmodifiers += 'u';\n\t}\n\n\treturn new RegExp(searchString, modifiers);\n}\n\nexport function regExpLeadsToEndlessLoop(regexp: RegExp): boolean {\n\t// Exit early if it's one of these special cases which are meant to match\n\t// against an empty string\n\tif (regexp.source === '^' || regexp.source === '^$' || regexp.source === '$' || regexp.source === '^\\\\s*$') {\n\t\treturn false;\n\t}\n\n\t// We check against an empty string. If the regular expression doesn't advance\n\t// (e.g. ends in an endless loop) it will match an empty string.\n\tconst match = regexp.exec('');\n\treturn !!(match && regexp.lastIndex === 0);\n}\n\nexport function regExpContainsBackreference(regexpValue: string): boolean {\n\treturn !!regexpValue.match(/([^\\\\]|^)(\\\\\\\\)*\\\\\\d+/);\n}\n\nexport function regExpFlags(regexp: RegExp): string {\n\treturn (regexp.global ? 'g' : '')\n\t\t+ (regexp.ignoreCase ? 'i' : '')\n\t\t+ (regexp.multiline ? 'm' : '')\n\t\t+ ((regexp as any /* standalone editor compilation */).unicode ? 'u' : '');\n}\n\nexport function splitLines(str: string): string[] {\n\treturn str.split(/\\r\\n|\\r|\\n/);\n}\n\n/**\n * Returns first index of the string that is not whitespace.\n * If string is empty or contains only whitespaces, returns -1\n */\nexport function firstNonWhitespaceIndex(str: string): number {\n\tfor (let i = 0, len = str.length; i < len; i++) {\n\t\tconst chCode = str.charCodeAt(i);\n\t\tif (chCode !== CharCode.Space && chCode !== CharCode.Tab) {\n\t\t\treturn i;\n\t\t}\n\t}\n\treturn -1;\n}\n\n/**\n * Returns the leading whitespace of the string.\n * If the string contains only whitespaces, returns entire string\n */\nexport function getLeadingWhitespace(str: string, start: number = 0, end: number = str.length): string {\n\tfor (let i = start; i < end; i++) {\n\t\tconst chCode = str.charCodeAt(i);\n\t\tif (chCode !== CharCode.Space && chCode !== CharCode.Tab) {\n\t\t\treturn str.substring(start, i);\n\t\t}\n\t}\n\treturn str.substring(start, end);\n}\n\n/**\n * Returns last index of the string that is not whitespace.\n * If string is empty or contains only whitespaces, returns -1\n */\nexport function lastNonWhitespaceIndex(str: string, startIndex: number = str.length - 1): number {\n\tfor (let i = startIndex; i >= 0; i--) {\n\t\tconst chCode = str.charCodeAt(i);\n\t\tif (chCode !== CharCode.Space && chCode !== CharCode.Tab) {\n\t\t\treturn i;\n\t\t}\n\t}\n\treturn -1;\n}\n\nexport function compare(a: string, b: string): number {\n\tif (a < b) {\n\t\treturn -1;\n\t} else if (a > b) {\n\t\treturn 1;\n\t} else {\n\t\treturn 0;\n\t}\n}\n\nexport function compareSubstring(a: string, b: string, aStart: number = 0, aEnd: number = a.length, bStart: number = 0, bEnd: number = b.length): number {\n\tfor (; aStart < aEnd && bStart < bEnd; aStart++, bStart++) {\n\t\tlet codeA = a.charCodeAt(aStart);\n\t\tlet codeB = b.charCodeAt(bStart);\n\t\tif (codeA < codeB) {\n\t\t\treturn -1;\n\t\t} else if (codeA > codeB) {\n\t\t\treturn 1;\n\t\t}\n\t}\n\tconst aLen = aEnd - aStart;\n\tconst bLen = bEnd - bStart;\n\tif (aLen < bLen) {\n\t\treturn -1;\n\t} else if (aLen > bLen) {\n\t\treturn 1;\n\t}\n\treturn 0;\n}\n\nexport function compareIgnoreCase(a: string, b: string): number {\n\treturn compareSubstringIgnoreCase(a, b, 0, a.length, 0, b.length);\n}\n\nexport function compareSubstringIgnoreCase(a: string, b: string, aStart: number = 0, aEnd: number = a.length, bStart: number = 0, bEnd: number = b.length): number {\n\n\tfor (; aStart < aEnd && bStart < bEnd; aStart++, bStart++) {\n\n\t\tlet codeA = a.charCodeAt(aStart);\n\t\tlet codeB = b.charCodeAt(bStart);\n\n\t\tif (codeA === codeB) {\n\t\t\t// equal\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst diff = codeA - codeB;\n\t\tif (diff === 32 && isUpperAsciiLetter(codeB)) { //codeB =[65-90] && codeA =[97-122]\n\t\t\tcontinue;\n\n\t\t} else if (diff === -32 && isUpperAsciiLetter(codeA)) {  //codeB =[97-122] && codeA =[65-90]\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (isLowerAsciiLetter(codeA) && isLowerAsciiLetter(codeB)) {\n\t\t\t//\n\t\t\treturn diff;\n\n\t\t} else {\n\t\t\treturn compareSubstring(a.toLowerCase(), b.toLowerCase(), aStart, aEnd, bStart, bEnd);\n\t\t}\n\t}\n\n\tconst aLen = aEnd - aStart;\n\tconst bLen = bEnd - bStart;\n\n\tif (aLen < bLen) {\n\t\treturn -1;\n\t} else if (aLen > bLen) {\n\t\treturn 1;\n\t}\n\n\treturn 0;\n}\n\nexport function isLowerAsciiLetter(code: number): boolean {\n\treturn code >= CharCode.a && code <= CharCode.z;\n}\n\nexport function isUpperAsciiLetter(code: number): boolean {\n\treturn code >= CharCode.A && code <= CharCode.Z;\n}\n\nfunction isAsciiLetter(code: number): boolean {\n\treturn isLowerAsciiLetter(code) || isUpperAsciiLetter(code);\n}\n\nexport function equalsIgnoreCase(a: string, b: string): boolean {\n\treturn a.length === b.length && doEqualsIgnoreCase(a, b);\n}\n\nfunction doEqualsIgnoreCase(a: string, b: string, stopAt = a.length): boolean {\n\tfor (let i = 0; i < stopAt; i++) {\n\t\tconst codeA = a.charCodeAt(i);\n\t\tconst codeB = b.charCodeAt(i);\n\n\t\tif (codeA === codeB) {\n\t\t\tcontinue;\n\t\t}\n\n\t\t// a-z A-Z\n\t\tif (isAsciiLetter(codeA) && isAsciiLetter(codeB)) {\n\t\t\tconst diff = Math.abs(codeA - codeB);\n\t\t\tif (diff !== 0 && diff !== 32) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\t// Any other charcode\n\t\telse {\n\t\t\tif (String.fromCharCode(codeA).toLowerCase() !== String.fromCharCode(codeB).toLowerCase()) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn true;\n}\n\nexport function startsWithIgnoreCase(str: string, candidate: string): boolean {\n\tconst candidateLength = candidate.length;\n\tif (candidate.length > str.length) {\n\t\treturn false;\n\t}\n\n\treturn doEqualsIgnoreCase(str, candidate, candidateLength);\n}\n\n/**\n * @returns the length of the common prefix of the two strings.\n */\nexport function commonPrefixLength(a: string, b: string): number {\n\n\tlet i: number,\n\t\tlen = Math.min(a.length, b.length);\n\n\tfor (i = 0; i < len; i++) {\n\t\tif (a.charCodeAt(i) !== b.charCodeAt(i)) {\n\t\t\treturn i;\n\t\t}\n\t}\n\n\treturn len;\n}\n\n/**\n * @returns the length of the common suffix of the two strings.\n */\nexport function commonSuffixLength(a: string, b: string): number {\n\n\tlet i: number,\n\t\tlen = Math.min(a.length, b.length);\n\n\tconst aLastIndex = a.length - 1;\n\tconst bLastIndex = b.length - 1;\n\n\tfor (i = 0; i < len; i++) {\n\t\tif (a.charCodeAt(aLastIndex - i) !== b.charCodeAt(bLastIndex - i)) {\n\t\t\treturn i;\n\t\t}\n\t}\n\n\treturn len;\n}\n\n/**\n * See http://en.wikipedia.org/wiki/Surrogate_pair\n */\nexport function isHighSurrogate(charCode: number): boolean {\n\treturn (0xD800 <= charCode && charCode <= 0xDBFF);\n}\n\n/**\n * See http://en.wikipedia.org/wiki/Surrogate_pair\n */\nexport function isLowSurrogate(charCode: number): boolean {\n\treturn (0xDC00 <= charCode && charCode <= 0xDFFF);\n}\n\n/**\n * See http://en.wikipedia.org/wiki/Surrogate_pair\n */\nexport function computeCodePoint(highSurrogate: number, lowSurrogate: number): number {\n\treturn ((highSurrogate - 0xD800) << 10) + (lowSurrogate - 0xDC00) + 0x10000;\n}\n\n/**\n * get the code point that begins at offset `offset`\n */\nexport function getNextCodePoint(str: string, len: number, offset: number): number {\n\tconst charCode = str.charCodeAt(offset);\n\tif (isHighSurrogate(charCode) && offset + 1 < len) {\n\t\tconst nextCharCode = str.charCodeAt(offset + 1);\n\t\tif (isLowSurrogate(nextCharCode)) {\n\t\t\treturn computeCodePoint(charCode, nextCharCode);\n\t\t}\n\t}\n\treturn charCode;\n}\n\n/**\n * get the code point that ends right before offset `offset`\n */\nfunction getPrevCodePoint(str: string, offset: number): number {\n\tconst charCode = str.charCodeAt(offset - 1);\n\tif (isLowSurrogate(charCode) && offset > 1) {\n\t\tconst prevCharCode = str.charCodeAt(offset - 2);\n\t\tif (isHighSurrogate(prevCharCode)) {\n\t\t\treturn computeCodePoint(prevCharCode, charCode);\n\t\t}\n\t}\n\treturn charCode;\n}\n\nexport function nextCharLength(str: string, offset: number): number {\n\tconst graphemeBreakTree = GraphemeBreakTree.getInstance();\n\tconst initialOffset = offset;\n\tconst len = str.length;\n\n\tconst initialCodePoint = getNextCodePoint(str, len, offset);\n\toffset += (initialCodePoint >= Constants.UNICODE_SUPPLEMENTARY_PLANE_BEGIN ? 2 : 1);\n\n\tlet graphemeBreakType = graphemeBreakTree.getGraphemeBreakType(initialCodePoint);\n\twhile (offset < len) {\n\t\tconst nextCodePoint = getNextCodePoint(str, len, offset);\n\t\tconst nextGraphemeBreakType = graphemeBreakTree.getGraphemeBreakType(nextCodePoint);\n\t\tif (breakBetweenGraphemeBreakType(graphemeBreakType, nextGraphemeBreakType)) {\n\t\t\tbreak;\n\t\t}\n\t\toffset += (nextCodePoint >= Constants.UNICODE_SUPPLEMENTARY_PLANE_BEGIN ? 2 : 1);\n\t\tgraphemeBreakType = nextGraphemeBreakType;\n\t}\n\n\treturn (offset - initialOffset);\n}\n\nexport function prevCharLength(str: string, offset: number): number {\n\tconst graphemeBreakTree = GraphemeBreakTree.getInstance();\n\tconst initialOffset = offset;\n\n\tconst initialCodePoint = getPrevCodePoint(str, offset);\n\toffset -= (initialCodePoint >= Constants.UNICODE_SUPPLEMENTARY_PLANE_BEGIN ? 2 : 1);\n\n\tlet graphemeBreakType = graphemeBreakTree.getGraphemeBreakType(initialCodePoint);\n\twhile (offset > 0) {\n\t\tconst prevCodePoint = getPrevCodePoint(str, offset);\n\t\tconst prevGraphemeBreakType = graphemeBreakTree.getGraphemeBreakType(prevCodePoint);\n\t\tif (breakBetweenGraphemeBreakType(prevGraphemeBreakType, graphemeBreakType)) {\n\t\t\tbreak;\n\t\t}\n\t\toffset -= (prevCodePoint >= Constants.UNICODE_SUPPLEMENTARY_PLANE_BEGIN ? 2 : 1);\n\t\tgraphemeBreakType = prevGraphemeBreakType;\n\t}\n\n\treturn (initialOffset - offset);\n}\n\nfunction _getCharContainingOffset(str: string, offset: number): [number, number] {\n\tconst graphemeBreakTree = GraphemeBreakTree.getInstance();\n\tconst len = str.length;\n\tconst initialOffset = offset;\n\tconst initialCodePoint = getNextCodePoint(str, len, offset);\n\tconst initialGraphemeBreakType = graphemeBreakTree.getGraphemeBreakType(initialCodePoint);\n\toffset += (initialCodePoint >= Constants.UNICODE_SUPPLEMENTARY_PLANE_BEGIN ? 2 : 1);\n\n\t// extend to the right\n\tlet graphemeBreakType = initialGraphemeBreakType;\n\twhile (offset < len) {\n\t\tconst nextCodePoint = getNextCodePoint(str, len, offset);\n\t\tconst nextGraphemeBreakType = graphemeBreakTree.getGraphemeBreakType(nextCodePoint);\n\t\tif (breakBetweenGraphemeBreakType(graphemeBreakType, nextGraphemeBreakType)) {\n\t\t\tbreak;\n\t\t}\n\t\toffset += (nextCodePoint >= Constants.UNICODE_SUPPLEMENTARY_PLANE_BEGIN ? 2 : 1);\n\t\tgraphemeBreakType = nextGraphemeBreakType;\n\t}\n\tconst endOffset = offset;\n\n\t// extend to the left\n\toffset = initialOffset;\n\tgraphemeBreakType = initialGraphemeBreakType;\n\twhile (offset > 0) {\n\t\tconst prevCodePoint = getPrevCodePoint(str, offset);\n\t\tconst prevGraphemeBreakType = graphemeBreakTree.getGraphemeBreakType(prevCodePoint);\n\t\tif (breakBetweenGraphemeBreakType(prevGraphemeBreakType, graphemeBreakType)) {\n\t\t\tbreak;\n\t\t}\n\t\toffset -= (prevCodePoint >= Constants.UNICODE_SUPPLEMENTARY_PLANE_BEGIN ? 2 : 1);\n\t\tgraphemeBreakType = prevGraphemeBreakType;\n\t}\n\n\treturn [offset, endOffset];\n}\n\nexport function getCharContainingOffset(str: string, offset: number): [number, number] {\n\tif (offset > 0 && isLowSurrogate(str.charCodeAt(offset))) {\n\t\treturn _getCharContainingOffset(str, offset - 1);\n\t}\n\treturn _getCharContainingOffset(str, offset);\n}\n\n/**\n * A manual encoding of `str` to UTF8.\n * Use only in environments which do not offer native conversion methods!\n */\nexport function encodeUTF8(str: string): Uint8Array {\n\tconst strLen = str.length;\n\n\t// See https://en.wikipedia.org/wiki/UTF-8\n\n\t// first loop to establish needed buffer size\n\tlet neededSize = 0;\n\tlet strOffset = 0;\n\twhile (strOffset < strLen) {\n\t\tconst codePoint = getNextCodePoint(str, strLen, strOffset);\n\t\tstrOffset += (codePoint >= Constants.UNICODE_SUPPLEMENTARY_PLANE_BEGIN ? 2 : 1);\n\n\t\tif (codePoint < 0x0080) {\n\t\t\tneededSize += 1;\n\t\t} else if (codePoint < 0x0800) {\n\t\t\tneededSize += 2;\n\t\t} else if (codePoint < 0x10000) {\n\t\t\tneededSize += 3;\n\t\t} else {\n\t\t\tneededSize += 4;\n\t\t}\n\t}\n\n\t// second loop to actually encode\n\tconst arr = new Uint8Array(neededSize);\n\tstrOffset = 0;\n\tlet arrOffset = 0;\n\twhile (strOffset < strLen) {\n\t\tconst codePoint = getNextCodePoint(str, strLen, strOffset);\n\t\tstrOffset += (codePoint >= Constants.UNICODE_SUPPLEMENTARY_PLANE_BEGIN ? 2 : 1);\n\n\t\tif (codePoint < 0x0080) {\n\t\t\tarr[arrOffset++] = codePoint;\n\t\t} else if (codePoint < 0x0800) {\n\t\t\tarr[arrOffset++] = 0b11000000 | ((codePoint & 0b00000000000000000000011111000000) >>> 6);\n\t\t\tarr[arrOffset++] = 0b10000000 | ((codePoint & 0b00000000000000000000000000111111) >>> 0);\n\t\t} else if (codePoint < 0x10000) {\n\t\t\tarr[arrOffset++] = 0b11100000 | ((codePoint & 0b00000000000000001111000000000000) >>> 12);\n\t\t\tarr[arrOffset++] = 0b10000000 | ((codePoint & 0b00000000000000000000111111000000) >>> 6);\n\t\t\tarr[arrOffset++] = 0b10000000 | ((codePoint & 0b00000000000000000000000000111111) >>> 0);\n\t\t} else {\n\t\t\tarr[arrOffset++] = 0b11110000 | ((codePoint & 0b00000000000111000000000000000000) >>> 18);\n\t\t\tarr[arrOffset++] = 0b10000000 | ((codePoint & 0b00000000000000111111000000000000) >>> 12);\n\t\t\tarr[arrOffset++] = 0b10000000 | ((codePoint & 0b00000000000000000000111111000000) >>> 6);\n\t\t\tarr[arrOffset++] = 0b10000000 | ((codePoint & 0b00000000000000000000000000111111) >>> 0);\n\t\t}\n\t}\n\n\treturn arr;\n}\n\n/**\n * A manual decoding of a UTF8 string.\n * Use only in environments which do not offer native conversion methods!\n */\nexport function decodeUTF8(buffer: Uint8Array): string {\n\t// https://en.wikipedia.org/wiki/UTF-8\n\n\tconst len = buffer.byteLength;\n\tconst result: string[] = [];\n\tlet offset = 0;\n\twhile (offset < len) {\n\t\tconst v0 = buffer[offset];\n\t\tlet codePoint: number;\n\t\tif (v0 >= 0b11110000 && offset + 3 < len) {\n\t\t\t// 4 bytes\n\t\t\tcodePoint = (\n\t\t\t\t(((buffer[offset++] & 0b00000111) << 18) >>> 0)\n\t\t\t\t| (((buffer[offset++] & 0b00111111) << 12) >>> 0)\n\t\t\t\t| (((buffer[offset++] & 0b00111111) << 6) >>> 0)\n\t\t\t\t| (((buffer[offset++] & 0b00111111) << 0) >>> 0)\n\t\t\t);\n\t\t} else if (v0 >= 0b11100000 && offset + 2 < len) {\n\t\t\t// 3 bytes\n\t\t\tcodePoint = (\n\t\t\t\t(((buffer[offset++] & 0b00001111) << 12) >>> 0)\n\t\t\t\t| (((buffer[offset++] & 0b00111111) << 6) >>> 0)\n\t\t\t\t| (((buffer[offset++] & 0b00111111) << 0) >>> 0)\n\t\t\t);\n\t\t} else if (v0 >= 0b11000000 && offset + 1 < len) {\n\t\t\t// 2 bytes\n\t\t\tcodePoint = (\n\t\t\t\t(((buffer[offset++] & 0b00011111) << 6) >>> 0)\n\t\t\t\t| (((buffer[offset++] & 0b00111111) << 0) >>> 0)\n\t\t\t);\n\t\t} else {\n\t\t\t// 1 byte\n\t\t\tcodePoint = buffer[offset++];\n\t\t}\n\n\t\tif ((codePoint >= 0 && codePoint <= 0xD7FF) || (codePoint >= 0xE000 && codePoint <= 0xFFFF)) {\n\t\t\t// Basic Multilingual Plane\n\t\t\tresult.push(String.fromCharCode(codePoint));\n\t\t} else if (codePoint >= 0x010000 && codePoint <= 0x10FFFF) {\n\t\t\t// Supplementary Planes\n\t\t\tconst uPrime = codePoint - 0x10000;\n\t\t\tconst w1 = 0xD800 + ((uPrime & 0b11111111110000000000) >>> 10);\n\t\t\tconst w2 = 0xDC00 + ((uPrime & 0b00000000001111111111) >>> 0);\n\t\t\tresult.push(String.fromCharCode(w1));\n\t\t\tresult.push(String.fromCharCode(w2));\n\t\t} else {\n\t\t\t// illegal code point\n\t\t\tresult.push(String.fromCharCode(0xFFFD));\n\t\t}\n\t}\n\n\treturn result.join('');\n}\n\n/**\n * Generated using https://github.com/alexandrudima/unicode-utils/blob/master/generate-rtl-test.js\n */\nconst CONTAINS_RTL = /(?:[\\u05BE\\u05C0\\u05C3\\u05C6\\u05D0-\\u05F4\\u0608\\u060B\\u060D\\u061B-\\u064A\\u066D-\\u066F\\u0671-\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1-\\u07EA\\u07F4\\u07F5\\u07FA-\\u0815\\u081A\\u0824\\u0828\\u0830-\\u0858\\u085E-\\u08BD\\u200F\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFD3D\\uFD50-\\uFDFC\\uFE70-\\uFEFC]|\\uD802[\\uDC00-\\uDD1B\\uDD20-\\uDE00\\uDE10-\\uDE33\\uDE40-\\uDEE4\\uDEEB-\\uDF35\\uDF40-\\uDFFF]|\\uD803[\\uDC00-\\uDCFF]|\\uD83A[\\uDC00-\\uDCCF\\uDD00-\\uDD43\\uDD50-\\uDFFF]|\\uD83B[\\uDC00-\\uDEBB])/;\n\n/**\n * Returns true if `str` contains any Unicode character that is classified as \"R\" or \"AL\".\n */\nexport function containsRTL(str: string): boolean {\n\treturn CONTAINS_RTL.test(str);\n}\n\n/**\n * Generated using https://github.com/alexandrudima/unicode-utils/blob/master/generate-emoji-test.js\n */\nconst CONTAINS_EMOJI = /(?:[\\u231A\\u231B\\u23F0\\u23F3\\u2600-\\u27BF\\u2B50\\u2B55]|\\uD83C[\\uDDE6-\\uDDFF\\uDF00-\\uDFFF]|\\uD83D[\\uDC00-\\uDE4F\\uDE80-\\uDEFC\\uDFE0-\\uDFEB]|\\uD83E[\\uDD00-\\uDDFF\\uDE70-\\uDE73\\uDE78-\\uDE82\\uDE90-\\uDE95])/;\n\nexport function containsEmoji(str: string): boolean {\n\treturn CONTAINS_EMOJI.test(str);\n}\n\nconst IS_BASIC_ASCII = /^[\\t\\n\\r\\x20-\\x7E]*$/;\n/**\n * Returns true if `str` contains only basic ASCII characters in the range 32 - 126 (including 32 and 126) or \\n, \\r, \\t\n */\nexport function isBasicASCII(str: string): boolean {\n\treturn IS_BASIC_ASCII.test(str);\n}\n\nexport const UNUSUAL_LINE_TERMINATORS = /[\\u2028\\u2029]/; // LINE SEPARATOR (LS) or PARAGRAPH SEPARATOR (PS)\n/**\n * Returns true if `str` contains unusual line terminators, like LS or PS\n */\nexport function containsUnusualLineTerminators(str: string): boolean {\n\treturn UNUSUAL_LINE_TERMINATORS.test(str);\n}\n\nexport function containsFullWidthCharacter(str: string): boolean {\n\tfor (let i = 0, len = str.length; i < len; i++) {\n\t\tif (isFullWidthCharacter(str.charCodeAt(i))) {\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n}\n\nexport function isFullWidthCharacter(charCode: number): boolean {\n\t// Do a cheap trick to better support wrapping of wide characters, treat them as 2 columns\n\t// http://jrgraphix.net/research/unicode_blocks.php\n\t//          2E80 — 2EFF   CJK Radicals Supplement\n\t//          2F00 — 2FDF   Kangxi Radicals\n\t//          2FF0 — 2FFF   Ideographic Description Characters\n\t//          3000 — 303F   CJK Symbols and Punctuation\n\t//          3040 — 309F   Hiragana\n\t//          30A0 — 30FF   Katakana\n\t//          3100 — 312F   Bopomofo\n\t//          3130 — 318F   Hangul Compatibility Jamo\n\t//          3190 — 319F   Kanbun\n\t//          31A0 — 31BF   Bopomofo Extended\n\t//          31F0 — 31FF   Katakana Phonetic Extensions\n\t//          3200 — 32FF   Enclosed CJK Letters and Months\n\t//          3300 — 33FF   CJK Compatibility\n\t//          3400 — 4DBF   CJK Unified Ideographs Extension A\n\t//          4DC0 — 4DFF   Yijing Hexagram Symbols\n\t//          4E00 — 9FFF   CJK Unified Ideographs\n\t//          A000 — A48F   Yi Syllables\n\t//          A490 — A4CF   Yi Radicals\n\t//          AC00 — D7AF   Hangul Syllables\n\t// [IGNORE] D800 — DB7F   High Surrogates\n\t// [IGNORE] DB80 — DBFF   High Private Use Surrogates\n\t// [IGNORE] DC00 — DFFF   Low Surrogates\n\t// [IGNORE] E000 — F8FF   Private Use Area\n\t//          F900 — FAFF   CJK Compatibility Ideographs\n\t// [IGNORE] FB00 — FB4F   Alphabetic Presentation Forms\n\t// [IGNORE] FB50 — FDFF   Arabic Presentation Forms-A\n\t// [IGNORE] FE00 — FE0F   Variation Selectors\n\t// [IGNORE] FE20 — FE2F   Combining Half Marks\n\t// [IGNORE] FE30 — FE4F   CJK Compatibility Forms\n\t// [IGNORE] FE50 — FE6F   Small Form Variants\n\t// [IGNORE] FE70 — FEFF   Arabic Presentation Forms-B\n\t//          FF00 — FFEF   Halfwidth and Fullwidth Forms\n\t//               [https://en.wikipedia.org/wiki/Halfwidth_and_fullwidth_forms]\n\t//               of which FF01 - FF5E fullwidth ASCII of 21 to 7E\n\t// [IGNORE]    and FF65 - FFDC halfwidth of Katakana and Hangul\n\t// [IGNORE] FFF0 — FFFF   Specials\n\tcharCode = +charCode; // @perf\n\treturn (\n\t\t(charCode >= 0x2E80 && charCode <= 0xD7AF)\n\t\t|| (charCode >= 0xF900 && charCode <= 0xFAFF)\n\t\t|| (charCode >= 0xFF01 && charCode <= 0xFF5E)\n\t);\n}\n\n/**\n * A fast function (therefore imprecise) to check if code points are emojis.\n * Generated using https://github.com/alexandrudima/unicode-utils/blob/master/generate-emoji-test.js\n */\nexport function isEmojiImprecise(x: number): boolean {\n\treturn (\n\t\t(x >= 0x1F1E6 && x <= 0x1F1FF) || (x >= 9728 && x <= 10175) || (x >= 127744 && x <= 128591)\n\t\t|| (x >= 128640 && x <= 128764) || (x >= 128992 && x <= 129003) || (x >= 129280 && x <= 129535)\n\t\t|| (x >= 129648 && x <= 129651) || (x >= 129656 && x <= 129666) || (x >= 129680 && x <= 129685)\n\t);\n}\n\n/**\n * Given a string and a max length returns a shorted version. Shorting\n * happens at favorable positions - such as whitespace or punctuation characters.\n */\nexport function lcut(text: string, n: number) {\n\tif (text.length < n) {\n\t\treturn text;\n\t}\n\n\tconst re = /\\b/g;\n\tlet i = 0;\n\twhile (re.test(text)) {\n\t\tif (text.length - re.lastIndex < n) {\n\t\t\tbreak;\n\t\t}\n\n\t\ti = re.lastIndex;\n\t\tre.lastIndex += 1;\n\t}\n\n\treturn text.substring(i).replace(/^\\s/, '');\n}\n\n// Escape codes\n// http://en.wikipedia.org/wiki/ANSI_escape_code\nconst EL = /\\x1B\\x5B[12]?K/g; // Erase in line\nconst COLOR_START = /\\x1b\\[\\d+m/g; // Color\nconst COLOR_END = /\\x1b\\[0?m/g; // Color\n\nexport function removeAnsiEscapeCodes(str: string): string {\n\tif (str) {\n\t\tstr = str.replace(EL, '');\n\t\tstr = str.replace(COLOR_START, '');\n\t\tstr = str.replace(COLOR_END, '');\n\t}\n\n\treturn str;\n}\n\n// -- UTF-8 BOM\n\nexport const UTF8_BOM_CHARACTER = String.fromCharCode(CharCode.UTF8_BOM);\n\nexport function startsWithUTF8BOM(str: string): boolean {\n\treturn !!(str && str.length > 0 && str.charCodeAt(0) === CharCode.UTF8_BOM);\n}\n\nexport function stripUTF8BOM(str: string): string {\n\treturn startsWithUTF8BOM(str) ? str.substr(1) : str;\n}\n\n/**\n * Checks if the characters of the provided query string are included in the\n * target string. The characters do not have to be contiguous within the string.\n */\nexport function fuzzyContains(target: string, query: string): boolean {\n\tif (!target || !query) {\n\t\treturn false; // return early if target or query are undefined\n\t}\n\n\tif (target.length < query.length) {\n\t\treturn false; // impossible for query to be contained in target\n\t}\n\n\tconst queryLen = query.length;\n\tconst targetLower = target.toLowerCase();\n\n\tlet index = 0;\n\tlet lastIndexOf = -1;\n\twhile (index < queryLen) {\n\t\tconst indexOf = targetLower.indexOf(query[index], lastIndexOf + 1);\n\t\tif (indexOf < 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tlastIndexOf = indexOf;\n\n\t\tindex++;\n\t}\n\n\treturn true;\n}\n\nexport function containsUppercaseCharacter(target: string, ignoreEscapedChars = false): boolean {\n\tif (!target) {\n\t\treturn false;\n\t}\n\n\tif (ignoreEscapedChars) {\n\t\ttarget = target.replace(/\\\\./g, '');\n\t}\n\n\treturn target.toLowerCase() !== target;\n}\n\nexport function uppercaseFirstLetter(str: string): string {\n\treturn str.charAt(0).toUpperCase() + str.slice(1);\n}\n\nexport function getNLines(str: string, n = 1): string {\n\tif (n === 0) {\n\t\treturn '';\n\t}\n\n\tlet idx = -1;\n\tdo {\n\t\tidx = str.indexOf('\\n', idx + 1);\n\t\tn--;\n\t} while (n > 0 && idx >= 0);\n\n\tif (idx === -1) {\n\t\treturn str;\n\t}\n\n\tif (str[idx - 1] === '\\r') {\n\t\tidx--;\n\t}\n\n\treturn str.substr(0, idx);\n}\n\n/**\n * Produces 'a'-'z', followed by 'A'-'Z'... followed by 'a'-'z', etc.\n */\nexport function singleLetterHash(n: number): string {\n\tconst LETTERS_CNT = (CharCode.Z - CharCode.A + 1);\n\n\tn = n % (2 * LETTERS_CNT);\n\n\tif (n < LETTERS_CNT) {\n\t\treturn String.fromCharCode(CharCode.a + n);\n\t}\n\n\treturn String.fromCharCode(CharCode.A + n - LETTERS_CNT);\n}\n\n//#region Unicode Grapheme Break\n\nexport function getGraphemeBreakType(codePoint: number): GraphemeBreakType {\n\tconst graphemeBreakTree = GraphemeBreakTree.getInstance();\n\treturn graphemeBreakTree.getGraphemeBreakType(codePoint);\n}\n\nexport function breakBetweenGraphemeBreakType(breakTypeA: GraphemeBreakType, breakTypeB: GraphemeBreakType): boolean {\n\t// http://www.unicode.org/reports/tr29/#Grapheme_Cluster_Boundary_Rules\n\n\t// !!! Let's make the common case a bit faster\n\tif (breakTypeA === GraphemeBreakType.Other) {\n\t\t// see https://www.unicode.org/Public/13.0.0/ucd/auxiliary/GraphemeBreakTest-13.0.0d10.html#table\n\t\treturn (breakTypeB !== GraphemeBreakType.Extend && breakTypeB !== GraphemeBreakType.SpacingMark);\n\t}\n\n\t// Do not break between a CR and LF. Otherwise, break before and after controls.\n\t// GB3                                        CR × LF\n\t// GB4                       (Control | CR | LF) ÷\n\t// GB5                                           ÷ (Control | CR | LF)\n\tif (breakTypeA === GraphemeBreakType.CR) {\n\t\tif (breakTypeB === GraphemeBreakType.LF) {\n\t\t\treturn false; // GB3\n\t\t}\n\t}\n\tif (breakTypeA === GraphemeBreakType.Control || breakTypeA === GraphemeBreakType.CR || breakTypeA === GraphemeBreakType.LF) {\n\t\treturn true; // GB4\n\t}\n\tif (breakTypeB === GraphemeBreakType.Control || breakTypeB === GraphemeBreakType.CR || breakTypeB === GraphemeBreakType.LF) {\n\t\treturn true; // GB5\n\t}\n\n\t// Do not break Hangul syllable sequences.\n\t// GB6                                         L × (L | V | LV | LVT)\n\t// GB7                                  (LV | V) × (V | T)\n\t// GB8                                 (LVT | T) × T\n\tif (breakTypeA === GraphemeBreakType.L) {\n\t\tif (breakTypeB === GraphemeBreakType.L || breakTypeB === GraphemeBreakType.V || breakTypeB === GraphemeBreakType.LV || breakTypeB === GraphemeBreakType.LVT) {\n\t\t\treturn false; // GB6\n\t\t}\n\t}\n\tif (breakTypeA === GraphemeBreakType.LV || breakTypeA === GraphemeBreakType.V) {\n\t\tif (breakTypeB === GraphemeBreakType.V || breakTypeB === GraphemeBreakType.T) {\n\t\t\treturn false; // GB7\n\t\t}\n\t}\n\tif (breakTypeA === GraphemeBreakType.LVT || breakTypeA === GraphemeBreakType.T) {\n\t\tif (breakTypeB === GraphemeBreakType.T) {\n\t\t\treturn false; // GB8\n\t\t}\n\t}\n\n\t// Do not break before extending characters or ZWJ.\n\t// GB9                                           × (Extend | ZWJ)\n\tif (breakTypeB === GraphemeBreakType.Extend || breakTypeB === GraphemeBreakType.ZWJ) {\n\t\treturn false; // GB9\n\t}\n\n\t// The GB9a and GB9b rules only apply to extended grapheme clusters:\n\t// Do not break before SpacingMarks, or after Prepend characters.\n\t// GB9a                                          × SpacingMark\n\t// GB9b                                  Prepend ×\n\tif (breakTypeB === GraphemeBreakType.SpacingMark) {\n\t\treturn false; // GB9a\n\t}\n\tif (breakTypeA === GraphemeBreakType.Prepend) {\n\t\treturn false; // GB9b\n\t}\n\n\t// Do not break within emoji modifier sequences or emoji zwj sequences.\n\t// GB11    \\p{Extended_Pictographic} Extend* ZWJ × \\p{Extended_Pictographic}\n\tif (breakTypeA === GraphemeBreakType.ZWJ && breakTypeB === GraphemeBreakType.Extended_Pictographic) {\n\t\t// Note: we are not implementing the rule entirely here to avoid introducing states\n\t\treturn false; // GB11\n\t}\n\n\t// GB12                          sot (RI RI)* RI × RI\n\t// GB13                        [^RI] (RI RI)* RI × RI\n\tif (breakTypeA === GraphemeBreakType.Regional_Indicator && breakTypeB === GraphemeBreakType.Regional_Indicator) {\n\t\t// Note: we are not implementing the rule entirely here to avoid introducing states\n\t\treturn false; // GB12 & GB13\n\t}\n\n\t// GB999                                     Any ÷ Any\n\treturn true;\n}\n\nexport const enum GraphemeBreakType {\n\tOther = 0,\n\tPrepend = 1,\n\tCR = 2,\n\tLF = 3,\n\tControl = 4,\n\tExtend = 5,\n\tRegional_Indicator = 6,\n\tSpacingMark = 7,\n\tL = 8,\n\tV = 9,\n\tT = 10,\n\tLV = 11,\n\tLVT = 12,\n\tZWJ = 13,\n\tExtended_Pictographic = 14\n}\n\nclass GraphemeBreakTree {\n\n\tprivate static _INSTANCE: GraphemeBreakTree | null = null;\n\tpublic static getInstance(): GraphemeBreakTree {\n\t\tif (!GraphemeBreakTree._INSTANCE) {\n\t\t\tGraphemeBreakTree._INSTANCE = new GraphemeBreakTree();\n\t\t}\n\t\treturn GraphemeBreakTree._INSTANCE;\n\t}\n\n\tprivate readonly _data: number[];\n\n\tconstructor() {\n\t\tthis._data = getGraphemeBreakRawData();\n\t}\n\n\tpublic getGraphemeBreakType(codePoint: number): GraphemeBreakType {\n\t\t// !!! Let's make 7bit ASCII a bit faster: 0..31\n\t\tif (codePoint < 32) {\n\t\t\tif (codePoint === CharCode.LineFeed) {\n\t\t\t\treturn GraphemeBreakType.LF;\n\t\t\t}\n\t\t\tif (codePoint === CharCode.CarriageReturn) {\n\t\t\t\treturn GraphemeBreakType.CR;\n\t\t\t}\n\t\t\treturn GraphemeBreakType.Control;\n\t\t}\n\t\t// !!! Let's make 7bit ASCII a bit faster: 32..126\n\t\tif (codePoint < 127) {\n\t\t\treturn GraphemeBreakType.Other;\n\t\t}\n\n\t\tconst data = this._data;\n\t\tconst nodeCount = data.length / 3;\n\t\tlet nodeIndex = 1;\n\t\twhile (nodeIndex <= nodeCount) {\n\t\t\tif (codePoint < data[3 * nodeIndex]) {\n\t\t\t\t// go left\n\t\t\t\tnodeIndex = 2 * nodeIndex;\n\t\t\t} else if (codePoint > data[3 * nodeIndex + 1]) {\n\t\t\t\t// go right\n\t\t\t\tnodeIndex = 2 * nodeIndex + 1;\n\t\t\t} else {\n\t\t\t\t// hit\n\t\t\t\treturn data[3 * nodeIndex + 2];\n\t\t\t}\n\t\t}\n\n\t\treturn GraphemeBreakType.Other;\n\t}\n}\n\nfunction getGraphemeBreakRawData(): number[] {\n\t// generated using https://github.com/alexandrudima/unicode-utils/blob/master/generate-grapheme-break.js\n\treturn JSON.parse('[0,0,0,51592,51592,11,44424,44424,11,72251,72254,5,7150,7150,7,48008,48008,11,55176,55176,11,128420,128420,14,3276,3277,5,9979,9980,14,46216,46216,11,49800,49800,11,53384,53384,11,70726,70726,5,122915,122916,5,129320,129327,14,2558,2558,5,5906,5908,5,9762,9763,14,43360,43388,8,45320,45320,11,47112,47112,11,48904,48904,11,50696,50696,11,52488,52488,11,54280,54280,11,70082,70083,1,71350,71350,7,73111,73111,5,127892,127893,14,128726,128727,14,129473,129474,14,2027,2035,5,2901,2902,5,3784,3789,5,6754,6754,5,8418,8420,5,9877,9877,14,11088,11088,14,44008,44008,5,44872,44872,11,45768,45768,11,46664,46664,11,47560,47560,11,48456,48456,11,49352,49352,11,50248,50248,11,51144,51144,11,52040,52040,11,52936,52936,11,53832,53832,11,54728,54728,11,69811,69814,5,70459,70460,5,71096,71099,7,71998,71998,5,72874,72880,5,119149,119149,7,127374,127374,14,128335,128335,14,128482,128482,14,128765,128767,14,129399,129400,14,129680,129685,14,1476,1477,5,2377,2380,7,2759,2760,5,3137,3140,7,3458,3459,7,4153,4154,5,6432,6434,5,6978,6978,5,7675,7679,5,9723,9726,14,9823,9823,14,9919,9923,14,10035,10036,14,42736,42737,5,43596,43596,5,44200,44200,11,44648,44648,11,45096,45096,11,45544,45544,11,45992,45992,11,46440,46440,11,46888,46888,11,47336,47336,11,47784,47784,11,48232,48232,11,48680,48680,11,49128,49128,11,49576,49576,11,50024,50024,11,50472,50472,11,50920,50920,11,51368,51368,11,51816,51816,11,52264,52264,11,52712,52712,11,53160,53160,11,53608,53608,11,54056,54056,11,54504,54504,11,54952,54952,11,68108,68111,5,69933,69940,5,70197,70197,7,70498,70499,7,70845,70845,5,71229,71229,5,71727,71735,5,72154,72155,5,72344,72345,5,73023,73029,5,94095,94098,5,121403,121452,5,126981,127182,14,127538,127546,14,127990,127990,14,128391,128391,14,128445,128449,14,128500,128505,14,128752,128752,14,129160,129167,14,129356,129356,14,129432,129442,14,129648,129651,14,129751,131069,14,173,173,4,1757,1757,1,2274,2274,1,2494,2494,5,2641,2641,5,2876,2876,5,3014,3016,7,3262,3262,7,3393,3396,5,3570,3571,7,3968,3972,5,4228,4228,7,6086,6086,5,6679,6680,5,6912,6915,5,7080,7081,5,7380,7392,5,8252,8252,14,9096,9096,14,9748,9749,14,9784,9786,14,9833,9850,14,9890,9894,14,9938,9938,14,9999,9999,14,10085,10087,14,12349,12349,14,43136,43137,7,43454,43456,7,43755,43755,7,44088,44088,11,44312,44312,11,44536,44536,11,44760,44760,11,44984,44984,11,45208,45208,11,45432,45432,11,45656,45656,11,45880,45880,11,46104,46104,11,46328,46328,11,46552,46552,11,46776,46776,11,47000,47000,11,47224,47224,11,47448,47448,11,47672,47672,11,47896,47896,11,48120,48120,11,48344,48344,11,48568,48568,11,48792,48792,11,49016,49016,11,49240,49240,11,49464,49464,11,49688,49688,11,49912,49912,11,50136,50136,11,50360,50360,11,50584,50584,11,50808,50808,11,51032,51032,11,51256,51256,11,51480,51480,11,51704,51704,11,51928,51928,11,52152,52152,11,52376,52376,11,52600,52600,11,52824,52824,11,53048,53048,11,53272,53272,11,53496,53496,11,53720,53720,11,53944,53944,11,54168,54168,11,54392,54392,11,54616,54616,11,54840,54840,11,55064,55064,11,65438,65439,5,69633,69633,5,69837,69837,1,70018,70018,7,70188,70190,7,70368,70370,7,70465,70468,7,70712,70719,5,70835,70840,5,70850,70851,5,71132,71133,5,71340,71340,7,71458,71461,5,71985,71989,7,72002,72002,7,72193,72202,5,72281,72283,5,72766,72766,7,72885,72886,5,73104,73105,5,92912,92916,5,113824,113827,4,119173,119179,5,121505,121519,5,125136,125142,5,127279,127279,14,127489,127490,14,127570,127743,14,127900,127901,14,128254,128254,14,128369,128370,14,128400,128400,14,128425,128432,14,128468,128475,14,128489,128494,14,128715,128720,14,128745,128745,14,128759,128760,14,129004,129023,14,129296,129304,14,129340,129342,14,129388,129392,14,129404,129407,14,129454,129455,14,129485,129487,14,129659,129663,14,129719,129727,14,917536,917631,5,13,13,2,1160,1161,5,1564,1564,4,1807,1807,1,2085,2087,5,2363,2363,7,2402,2403,5,2507,2508,7,2622,2624,7,2691,2691,7,2786,2787,5,2881,2884,5,3006,3006,5,3072,3072,5,3170,3171,5,3267,3268,7,3330,3331,7,3406,3406,1,3538,3540,5,3655,3662,5,3897,3897,5,4038,4038,5,4184,4185,5,4352,4447,8,6068,6069,5,6155,6157,5,6448,6449,7,6742,6742,5,6783,6783,5,6966,6970,5,7042,7042,7,7143,7143,7,7212,7219,5,7412,7412,5,8206,8207,4,8294,8303,4,8596,8601,14,9410,9410,14,9742,9742,14,9757,9757,14,9770,9770,14,9794,9794,14,9828,9828,14,9855,9855,14,9882,9882,14,9900,9903,14,9929,9933,14,9963,9967,14,9987,9988,14,10006,10006,14,10062,10062,14,10175,10175,14,11744,11775,5,42607,42607,5,43043,43044,7,43263,43263,5,43444,43445,7,43569,43570,5,43698,43700,5,43766,43766,5,44032,44032,11,44144,44144,11,44256,44256,11,44368,44368,11,44480,44480,11,44592,44592,11,44704,44704,11,44816,44816,11,44928,44928,11,45040,45040,11,45152,45152,11,45264,45264,11,45376,45376,11,45488,45488,11,45600,45600,11,45712,45712,11,45824,45824,11,45936,45936,11,46048,46048,11,46160,46160,11,46272,46272,11,46384,46384,11,46496,46496,11,46608,46608,11,46720,46720,11,46832,46832,11,46944,46944,11,47056,47056,11,47168,47168,11,47280,47280,11,47392,47392,11,47504,47504,11,47616,47616,11,47728,47728,11,47840,47840,11,47952,47952,11,48064,48064,11,48176,48176,11,48288,48288,11,48400,48400,11,48512,48512,11,48624,48624,11,48736,48736,11,48848,48848,11,48960,48960,11,49072,49072,11,49184,49184,11,49296,49296,11,49408,49408,11,49520,49520,11,49632,49632,11,49744,49744,11,49856,49856,11,49968,49968,11,50080,50080,11,50192,50192,11,50304,50304,11,50416,50416,11,50528,50528,11,50640,50640,11,50752,50752,11,50864,50864,11,50976,50976,11,51088,51088,11,51200,51200,11,51312,51312,11,51424,51424,11,51536,51536,11,51648,51648,11,51760,51760,11,51872,51872,11,51984,51984,11,52096,52096,11,52208,52208,11,52320,52320,11,52432,52432,11,52544,52544,11,52656,52656,11,52768,52768,11,52880,52880,11,52992,52992,11,53104,53104,11,53216,53216,11,53328,53328,11,53440,53440,11,53552,53552,11,53664,53664,11,53776,53776,11,53888,53888,11,54000,54000,11,54112,54112,11,54224,54224,11,54336,54336,11,54448,54448,11,54560,54560,11,54672,54672,11,54784,54784,11,54896,54896,11,55008,55008,11,55120,55120,11,64286,64286,5,66272,66272,5,68900,68903,5,69762,69762,7,69817,69818,5,69927,69931,5,70003,70003,5,70070,70078,5,70094,70094,7,70194,70195,7,70206,70206,5,70400,70401,5,70463,70463,7,70475,70477,7,70512,70516,5,70722,70724,5,70832,70832,5,70842,70842,5,70847,70848,5,71088,71089,7,71102,71102,7,71219,71226,5,71231,71232,5,71342,71343,7,71453,71455,5,71463,71467,5,71737,71738,5,71995,71996,5,72000,72000,7,72145,72147,7,72160,72160,5,72249,72249,7,72273,72278,5,72330,72342,5,72752,72758,5,72850,72871,5,72882,72883,5,73018,73018,5,73031,73031,5,73109,73109,5,73461,73462,7,94031,94031,5,94192,94193,7,119142,119142,7,119155,119162,4,119362,119364,5,121476,121476,5,122888,122904,5,123184,123190,5,126976,126979,14,127184,127231,14,127344,127345,14,127405,127461,14,127514,127514,14,127561,127567,14,127778,127779,14,127896,127896,14,127985,127986,14,127995,127999,5,128326,128328,14,128360,128366,14,128378,128378,14,128394,128397,14,128405,128406,14,128422,128423,14,128435,128443,14,128453,128464,14,128479,128480,14,128484,128487,14,128496,128498,14,128640,128709,14,128723,128724,14,128736,128741,14,128747,128748,14,128755,128755,14,128762,128762,14,128981,128991,14,129096,129103,14,129292,129292,14,129311,129311,14,129329,129330,14,129344,129349,14,129360,129374,14,129394,129394,14,129402,129402,14,129413,129425,14,129445,129450,14,129466,129471,14,129483,129483,14,129511,129535,14,129653,129655,14,129667,129670,14,129705,129711,14,129731,129743,14,917505,917505,4,917760,917999,5,10,10,3,127,159,4,768,879,5,1471,1471,5,1536,1541,1,1648,1648,5,1767,1768,5,1840,1866,5,2070,2073,5,2137,2139,5,2307,2307,7,2366,2368,7,2382,2383,7,2434,2435,7,2497,2500,5,2519,2519,5,2563,2563,7,2631,2632,5,2677,2677,5,2750,2752,7,2763,2764,7,2817,2817,5,2879,2879,5,2891,2892,7,2914,2915,5,3008,3008,5,3021,3021,5,3076,3076,5,3146,3149,5,3202,3203,7,3264,3265,7,3271,3272,7,3298,3299,5,3390,3390,5,3402,3404,7,3426,3427,5,3535,3535,5,3544,3550,7,3635,3635,7,3763,3763,7,3893,3893,5,3953,3966,5,3981,3991,5,4145,4145,7,4157,4158,5,4209,4212,5,4237,4237,5,4520,4607,10,5970,5971,5,6071,6077,5,6089,6099,5,6277,6278,5,6439,6440,5,6451,6456,7,6683,6683,5,6744,6750,5,6765,6770,7,6846,6846,5,6964,6964,5,6972,6972,5,7019,7027,5,7074,7077,5,7083,7085,5,7146,7148,7,7154,7155,7,7222,7223,5,7394,7400,5,7416,7417,5,8204,8204,5,8233,8233,4,8288,8292,4,8413,8416,5,8482,8482,14,8986,8987,14,9193,9203,14,9654,9654,14,9733,9733,14,9745,9745,14,9752,9752,14,9760,9760,14,9766,9766,14,9774,9775,14,9792,9792,14,9800,9811,14,9825,9826,14,9831,9831,14,9852,9853,14,9872,9873,14,9880,9880,14,9885,9887,14,9896,9897,14,9906,9916,14,9926,9927,14,9936,9936,14,9941,9960,14,9974,9974,14,9982,9985,14,9992,9997,14,10002,10002,14,10017,10017,14,10055,10055,14,10071,10071,14,10145,10145,14,11013,11015,14,11503,11505,5,12334,12335,5,12951,12951,14,42612,42621,5,43014,43014,5,43047,43047,7,43204,43205,5,43335,43345,5,43395,43395,7,43450,43451,7,43561,43566,5,43573,43574,5,43644,43644,5,43710,43711,5,43758,43759,7,44005,44005,5,44012,44012,7,44060,44060,11,44116,44116,11,44172,44172,11,44228,44228,11,44284,44284,11,44340,44340,11,44396,44396,11,44452,44452,11,44508,44508,11,44564,44564,11,44620,44620,11,44676,44676,11,44732,44732,11,44788,44788,11,44844,44844,11,44900,44900,11,44956,44956,11,45012,45012,11,45068,45068,11,45124,45124,11,45180,45180,11,45236,45236,11,45292,45292,11,45348,45348,11,45404,45404,11,45460,45460,11,45516,45516,11,45572,45572,11,45628,45628,11,45684,45684,11,45740,45740,11,45796,45796,11,45852,45852,11,45908,45908,11,45964,45964,11,46020,46020,11,46076,46076,11,46132,46132,11,46188,46188,11,46244,46244,11,46300,46300,11,46356,46356,11,46412,46412,11,46468,46468,11,46524,46524,11,46580,46580,11,46636,46636,11,46692,46692,11,46748,46748,11,46804,46804,11,46860,46860,11,46916,46916,11,46972,46972,11,47028,47028,11,47084,47084,11,47140,47140,11,47196,47196,11,47252,47252,11,47308,47308,11,47364,47364,11,47420,47420,11,47476,47476,11,47532,47532,11,47588,47588,11,47644,47644,11,47700,47700,11,47756,47756,11,47812,47812,11,47868,47868,11,47924,47924,11,47980,47980,11,48036,48036,11,48092,48092,11,48148,48148,11,48204,48204,11,48260,48260,11,48316,48316,11,48372,48372,11,48428,48428,11,48484,48484,11,48540,48540,11,48596,48596,11,48652,48652,11,48708,48708,11,48764,48764,11,48820,48820,11,48876,48876,11,48932,48932,11,48988,48988,11,49044,49044,11,49100,49100,11,49156,49156,11,49212,49212,11,49268,49268,11,49324,49324,11,49380,49380,11,49436,49436,11,49492,49492,11,49548,49548,11,49604,49604,11,49660,49660,11,49716,49716,11,49772,49772,11,49828,49828,11,49884,49884,11,49940,49940,11,49996,49996,11,50052,50052,11,50108,50108,11,50164,50164,11,50220,50220,11,50276,50276,11,50332,50332,11,50388,50388,11,50444,50444,11,50500,50500,11,50556,50556,11,50612,50612,11,50668,50668,11,50724,50724,11,50780,50780,11,50836,50836,11,50892,50892,11,50948,50948,11,51004,51004,11,51060,51060,11,51116,51116,11,51172,51172,11,51228,51228,11,51284,51284,11,51340,51340,11,51396,51396,11,51452,51452,11,51508,51508,11,51564,51564,11,51620,51620,11,51676,51676,11,51732,51732,11,51788,51788,11,51844,51844,11,51900,51900,11,51956,51956,11,52012,52012,11,52068,52068,11,52124,52124,11,52180,52180,11,52236,52236,11,52292,52292,11,52348,52348,11,52404,52404,11,52460,52460,11,52516,52516,11,52572,52572,11,52628,52628,11,52684,52684,11,52740,52740,11,52796,52796,11,52852,52852,11,52908,52908,11,52964,52964,11,53020,53020,11,53076,53076,11,53132,53132,11,53188,53188,11,53244,53244,11,53300,53300,11,53356,53356,11,53412,53412,11,53468,53468,11,53524,53524,11,53580,53580,11,53636,53636,11,53692,53692,11,53748,53748,11,53804,53804,11,53860,53860,11,53916,53916,11,53972,53972,11,54028,54028,11,54084,54084,11,54140,54140,11,54196,54196,11,54252,54252,11,54308,54308,11,54364,54364,11,54420,54420,11,54476,54476,11,54532,54532,11,54588,54588,11,54644,54644,11,54700,54700,11,54756,54756,11,54812,54812,11,54868,54868,11,54924,54924,11,54980,54980,11,55036,55036,11,55092,55092,11,55148,55148,11,55216,55238,9,65056,65071,5,65529,65531,4,68097,68099,5,68159,68159,5,69446,69456,5,69688,69702,5,69808,69810,7,69815,69816,7,69821,69821,1,69888,69890,5,69932,69932,7,69957,69958,7,70016,70017,5,70067,70069,7,70079,70080,7,70089,70092,5,70095,70095,5,70191,70193,5,70196,70196,5,70198,70199,5,70367,70367,5,70371,70378,5,70402,70403,7,70462,70462,5,70464,70464,5,70471,70472,7,70487,70487,5,70502,70508,5,70709,70711,7,70720,70721,7,70725,70725,7,70750,70750,5,70833,70834,7,70841,70841,7,70843,70844,7,70846,70846,7,70849,70849,7,71087,71087,5,71090,71093,5,71100,71101,5,71103,71104,5,71216,71218,7,71227,71228,7,71230,71230,7,71339,71339,5,71341,71341,5,71344,71349,5,71351,71351,5,71456,71457,7,71462,71462,7,71724,71726,7,71736,71736,7,71984,71984,5,71991,71992,7,71997,71997,7,71999,71999,1,72001,72001,1,72003,72003,5,72148,72151,5,72156,72159,7,72164,72164,7,72243,72248,5,72250,72250,1,72263,72263,5,72279,72280,7,72324,72329,1,72343,72343,7,72751,72751,7,72760,72765,5,72767,72767,5,72873,72873,7,72881,72881,7,72884,72884,7,73009,73014,5,73020,73021,5,73030,73030,1,73098,73102,7,73107,73108,7,73110,73110,7,73459,73460,5,78896,78904,4,92976,92982,5,94033,94087,7,94180,94180,5,113821,113822,5,119141,119141,5,119143,119145,5,119150,119154,5,119163,119170,5,119210,119213,5,121344,121398,5,121461,121461,5,121499,121503,5,122880,122886,5,122907,122913,5,122918,122922,5,123628,123631,5,125252,125258,5,126980,126980,14,127183,127183,14,127245,127247,14,127340,127343,14,127358,127359,14,127377,127386,14,127462,127487,6,127491,127503,14,127535,127535,14,127548,127551,14,127568,127569,14,127744,127777,14,127780,127891,14,127894,127895,14,127897,127899,14,127902,127984,14,127987,127989,14,127991,127994,14,128000,128253,14,128255,128317,14,128329,128334,14,128336,128359,14,128367,128368,14,128371,128377,14,128379,128390,14,128392,128393,14,128398,128399,14,128401,128404,14,128407,128419,14,128421,128421,14,128424,128424,14,128433,128434,14,128444,128444,14,128450,128452,14,128465,128467,14,128476,128478,14,128481,128481,14,128483,128483,14,128488,128488,14,128495,128495,14,128499,128499,14,128506,128591,14,128710,128714,14,128721,128722,14,128725,128725,14,128728,128735,14,128742,128744,14,128746,128746,14,128749,128751,14,128753,128754,14,128756,128758,14,128761,128761,14,128763,128764,14,128884,128895,14,128992,129003,14,129036,129039,14,129114,129119,14,129198,129279,14,129293,129295,14,129305,129310,14,129312,129319,14,129328,129328,14,129331,129338,14,129343,129343,14,129351,129355,14,129357,129359,14,129375,129387,14,129393,129393,14,129395,129398,14,129401,129401,14,129403,129403,14,129408,129412,14,129426,129431,14,129443,129444,14,129451,129453,14,129456,129465,14,129472,129472,14,129475,129482,14,129484,129484,14,129488,129510,14,129536,129647,14,129652,129652,14,129656,129658,14,129664,129666,14,129671,129679,14,129686,129704,14,129712,129718,14,129728,129730,14,129744,129750,14,917504,917504,4,917506,917535,4,917632,917759,4,918000,921599,4,0,9,4,11,12,4,14,31,4,169,169,14,174,174,14,1155,1159,5,1425,1469,5,1473,1474,5,1479,1479,5,1552,1562,5,1611,1631,5,1750,1756,5,1759,1764,5,1770,1773,5,1809,1809,5,1958,1968,5,2045,2045,5,2075,2083,5,2089,2093,5,2259,2273,5,2275,2306,5,2362,2362,5,2364,2364,5,2369,2376,5,2381,2381,5,2385,2391,5,2433,2433,5,2492,2492,5,2495,2496,7,2503,2504,7,2509,2509,5,2530,2531,5,2561,2562,5,2620,2620,5,2625,2626,5,2635,2637,5,2672,2673,5,2689,2690,5,2748,2748,5,2753,2757,5,2761,2761,7,2765,2765,5,2810,2815,5,2818,2819,7,2878,2878,5,2880,2880,7,2887,2888,7,2893,2893,5,2903,2903,5,2946,2946,5,3007,3007,7,3009,3010,7,3018,3020,7,3031,3031,5,3073,3075,7,3134,3136,5,3142,3144,5,3157,3158,5,3201,3201,5,3260,3260,5,3263,3263,5,3266,3266,5,3270,3270,5,3274,3275,7,3285,3286,5,3328,3329,5,3387,3388,5,3391,3392,7,3398,3400,7,3405,3405,5,3415,3415,5,3457,3457,5,3530,3530,5,3536,3537,7,3542,3542,5,3551,3551,5,3633,3633,5,3636,3642,5,3761,3761,5,3764,3772,5,3864,3865,5,3895,3895,5,3902,3903,7,3967,3967,7,3974,3975,5,3993,4028,5,4141,4144,5,4146,4151,5,4155,4156,7,4182,4183,7,4190,4192,5,4226,4226,5,4229,4230,5,4253,4253,5,4448,4519,9,4957,4959,5,5938,5940,5,6002,6003,5,6070,6070,7,6078,6085,7,6087,6088,7,6109,6109,5,6158,6158,4,6313,6313,5,6435,6438,7,6441,6443,7,6450,6450,5,6457,6459,5,6681,6682,7,6741,6741,7,6743,6743,7,6752,6752,5,6757,6764,5,6771,6780,5,6832,6845,5,6847,6848,5,6916,6916,7,6965,6965,5,6971,6971,7,6973,6977,7,6979,6980,7,7040,7041,5,7073,7073,7,7078,7079,7,7082,7082,7,7142,7142,5,7144,7145,5,7149,7149,5,7151,7153,5,7204,7211,7,7220,7221,7,7376,7378,5,7393,7393,7,7405,7405,5,7415,7415,7,7616,7673,5,8203,8203,4,8205,8205,13,8232,8232,4,8234,8238,4,8265,8265,14,8293,8293,4,8400,8412,5,8417,8417,5,8421,8432,5,8505,8505,14,8617,8618,14,9000,9000,14,9167,9167,14,9208,9210,14,9642,9643,14,9664,9664,14,9728,9732,14,9735,9741,14,9743,9744,14,9746,9746,14,9750,9751,14,9753,9756,14,9758,9759,14,9761,9761,14,9764,9765,14,9767,9769,14,9771,9773,14,9776,9783,14,9787,9791,14,9793,9793,14,9795,9799,14,9812,9822,14,9824,9824,14,9827,9827,14,9829,9830,14,9832,9832,14,9851,9851,14,9854,9854,14,9856,9861,14,9874,9876,14,9878,9879,14,9881,9881,14,9883,9884,14,9888,9889,14,9895,9895,14,9898,9899,14,9904,9905,14,9917,9918,14,9924,9925,14,9928,9928,14,9934,9935,14,9937,9937,14,9939,9940,14,9961,9962,14,9968,9973,14,9975,9978,14,9981,9981,14,9986,9986,14,9989,9989,14,9998,9998,14,10000,10001,14,10004,10004,14,10013,10013,14,10024,10024,14,10052,10052,14,10060,10060,14,10067,10069,14,10083,10084,14,10133,10135,14,10160,10160,14,10548,10549,14,11035,11036,14,11093,11093,14,11647,11647,5,12330,12333,5,12336,12336,14,12441,12442,5,12953,12953,14,42608,42610,5,42654,42655,5,43010,43010,5,43019,43019,5,43045,43046,5,43052,43052,5,43188,43203,7,43232,43249,5,43302,43309,5,43346,43347,7,43392,43394,5,43443,43443,5,43446,43449,5,43452,43453,5,43493,43493,5,43567,43568,7,43571,43572,7,43587,43587,5,43597,43597,7,43696,43696,5,43703,43704,5,43713,43713,5,43756,43757,5,43765,43765,7,44003,44004,7,44006,44007,7,44009,44010,7,44013,44013,5,44033,44059,12,44061,44087,12,44089,44115,12,44117,44143,12,44145,44171,12,44173,44199,12,44201,44227,12,44229,44255,12,44257,44283,12,44285,44311,12,44313,44339,12,44341,44367,12,44369,44395,12,44397,44423,12,44425,44451,12,44453,44479,12,44481,44507,12,44509,44535,12,44537,44563,12,44565,44591,12,44593,44619,12,44621,44647,12,44649,44675,12,44677,44703,12,44705,44731,12,44733,44759,12,44761,44787,12,44789,44815,12,44817,44843,12,44845,44871,12,44873,44899,12,44901,44927,12,44929,44955,12,44957,44983,12,44985,45011,12,45013,45039,12,45041,45067,12,45069,45095,12,45097,45123,12,45125,45151,12,45153,45179,12,45181,45207,12,45209,45235,12,45237,45263,12,45265,45291,12,45293,45319,12,45321,45347,12,45349,45375,12,45377,45403,12,45405,45431,12,45433,45459,12,45461,45487,12,45489,45515,12,45517,45543,12,45545,45571,12,45573,45599,12,45601,45627,12,45629,45655,12,45657,45683,12,45685,45711,12,45713,45739,12,45741,45767,12,45769,45795,12,45797,45823,12,45825,45851,12,45853,45879,12,45881,45907,12,45909,45935,12,45937,45963,12,45965,45991,12,45993,46019,12,46021,46047,12,46049,46075,12,46077,46103,12,46105,46131,12,46133,46159,12,46161,46187,12,46189,46215,12,46217,46243,12,46245,46271,12,46273,46299,12,46301,46327,12,46329,46355,12,46357,46383,12,46385,46411,12,46413,46439,12,46441,46467,12,46469,46495,12,46497,46523,12,46525,46551,12,46553,46579,12,46581,46607,12,46609,46635,12,46637,46663,12,46665,46691,12,46693,46719,12,46721,46747,12,46749,46775,12,46777,46803,12,46805,46831,12,46833,46859,12,46861,46887,12,46889,46915,12,46917,46943,12,46945,46971,12,46973,46999,12,47001,47027,12,47029,47055,12,47057,47083,12,47085,47111,12,47113,47139,12,47141,47167,12,47169,47195,12,47197,47223,12,47225,47251,12,47253,47279,12,47281,47307,12,47309,47335,12,47337,47363,12,47365,47391,12,47393,47419,12,47421,47447,12,47449,47475,12,47477,47503,12,47505,47531,12,47533,47559,12,47561,47587,12,47589,47615,12,47617,47643,12,47645,47671,12,47673,47699,12,47701,47727,12,47729,47755,12,47757,47783,12,47785,47811,12,47813,47839,12,47841,47867,12,47869,47895,12,47897,47923,12,47925,47951,12,47953,47979,12,47981,48007,12,48009,48035,12,48037,48063,12,48065,48091,12,48093,48119,12,48121,48147,12,48149,48175,12,48177,48203,12,48205,48231,12,48233,48259,12,48261,48287,12,48289,48315,12,48317,48343,12,48345,48371,12,48373,48399,12,48401,48427,12,48429,48455,12,48457,48483,12,48485,48511,12,48513,48539,12,48541,48567,12,48569,48595,12,48597,48623,12,48625,48651,12,48653,48679,12,48681,48707,12,48709,48735,12,48737,48763,12,48765,48791,12,48793,48819,12,48821,48847,12,48849,48875,12,48877,48903,12,48905,48931,12,48933,48959,12,48961,48987,12,48989,49015,12,49017,49043,12,49045,49071,12,49073,49099,12,49101,49127,12,49129,49155,12,49157,49183,12,49185,49211,12,49213,49239,12,49241,49267,12,49269,49295,12,49297,49323,12,49325,49351,12,49353,49379,12,49381,49407,12,49409,49435,12,49437,49463,12,49465,49491,12,49493,49519,12,49521,49547,12,49549,49575,12,49577,49603,12,49605,49631,12,49633,49659,12,49661,49687,12,49689,49715,12,49717,49743,12,49745,49771,12,49773,49799,12,49801,49827,12,49829,49855,12,49857,49883,12,49885,49911,12,49913,49939,12,49941,49967,12,49969,49995,12,49997,50023,12,50025,50051,12,50053,50079,12,50081,50107,12,50109,50135,12,50137,50163,12,50165,50191,12,50193,50219,12,50221,50247,12,50249,50275,12,50277,50303,12,50305,50331,12,50333,50359,12,50361,50387,12,50389,50415,12,50417,50443,12,50445,50471,12,50473,50499,12,50501,50527,12,50529,50555,12,50557,50583,12,50585,50611,12,50613,50639,12,50641,50667,12,50669,50695,12,50697,50723,12,50725,50751,12,50753,50779,12,50781,50807,12,50809,50835,12,50837,50863,12,50865,50891,12,50893,50919,12,50921,50947,12,50949,50975,12,50977,51003,12,51005,51031,12,51033,51059,12,51061,51087,12,51089,51115,12,51117,51143,12,51145,51171,12,51173,51199,12,51201,51227,12,51229,51255,12,51257,51283,12,51285,51311,12,51313,51339,12,51341,51367,12,51369,51395,12,51397,51423,12,51425,51451,12,51453,51479,12,51481,51507,12,51509,51535,12,51537,51563,12,51565,51591,12,51593,51619,12,51621,51647,12,51649,51675,12,51677,51703,12,51705,51731,12,51733,51759,12,51761,51787,12,51789,51815,12,51817,51843,12,51845,51871,12,51873,51899,12,51901,51927,12,51929,51955,12,51957,51983,12,51985,52011,12,52013,52039,12,52041,52067,12,52069,52095,12,52097,52123,12,52125,52151,12,52153,52179,12,52181,52207,12,52209,52235,12,52237,52263,12,52265,52291,12,52293,52319,12,52321,52347,12,52349,52375,12,52377,52403,12,52405,52431,12,52433,52459,12,52461,52487,12,52489,52515,12,52517,52543,12,52545,52571,12,52573,52599,12,52601,52627,12,52629,52655,12,52657,52683,12,52685,52711,12,52713,52739,12,52741,52767,12,52769,52795,12,52797,52823,12,52825,52851,12,52853,52879,12,52881,52907,12,52909,52935,12,52937,52963,12,52965,52991,12,52993,53019,12,53021,53047,12,53049,53075,12,53077,53103,12,53105,53131,12,53133,53159,12,53161,53187,12,53189,53215,12,53217,53243,12,53245,53271,12,53273,53299,12,53301,53327,12,53329,53355,12,53357,53383,12,53385,53411,12,53413,53439,12,53441,53467,12,53469,53495,12,53497,53523,12,53525,53551,12,53553,53579,12,53581,53607,12,53609,53635,12,53637,53663,12,53665,53691,12,53693,53719,12,53721,53747,12,53749,53775,12,53777,53803,12,53805,53831,12,53833,53859,12,53861,53887,12,53889,53915,12,53917,53943,12,53945,53971,12,53973,53999,12,54001,54027,12,54029,54055,12,54057,54083,12,54085,54111,12,54113,54139,12,54141,54167,12,54169,54195,12,54197,54223,12,54225,54251,12,54253,54279,12,54281,54307,12,54309,54335,12,54337,54363,12,54365,54391,12,54393,54419,12,54421,54447,12,54449,54475,12,54477,54503,12,54505,54531,12,54533,54559,12,54561,54587,12,54589,54615,12,54617,54643,12,54645,54671,12,54673,54699,12,54701,54727,12,54729,54755,12,54757,54783,12,54785,54811,12,54813,54839,12,54841,54867,12,54869,54895,12,54897,54923,12,54925,54951,12,54953,54979,12,54981,55007,12,55009,55035,12,55037,55063,12,55065,55091,12,55093,55119,12,55121,55147,12,55149,55175,12,55177,55203,12,55243,55291,10,65024,65039,5,65279,65279,4,65520,65528,4,66045,66045,5,66422,66426,5,68101,68102,5,68152,68154,5,68325,68326,5,69291,69292,5,69632,69632,7,69634,69634,7,69759,69761,5]');\n}\n\n//#endregion\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as strings from 'vs/base/common/strings';\nimport * as streams from 'vs/base/common/stream';\n\ndeclare const Buffer: any;\n\nconst hasBuffer = (typeof Buffer !== 'undefined');\nconst hasTextEncoder = (typeof TextEncoder !== 'undefined');\nconst hasTextDecoder = (typeof TextDecoder !== 'undefined');\n\nlet textEncoder: TextEncoder | null;\nlet textDecoder: TextDecoder | null;\n\nexport class VSBuffer {\n\n\tstatic alloc(byteLength: number): VSBuffer {\n\t\tif (hasBuffer) {\n\t\t\treturn new VSBuffer(Buffer.allocUnsafe(byteLength));\n\t\t} else {\n\t\t\treturn new VSBuffer(new Uint8Array(byteLength));\n\t\t}\n\t}\n\n\tstatic wrap(actual: Uint8Array): VSBuffer {\n\t\tif (hasBuffer && !(Buffer.isBuffer(actual))) {\n\t\t\t// https://nodejs.org/dist/latest-v10.x/docs/api/buffer.html#buffer_class_method_buffer_from_arraybuffer_byteoffset_length\n\t\t\t// Create a zero-copy Buffer wrapper around the ArrayBuffer pointed to by the Uint8Array\n\t\t\tactual = Buffer.from(actual.buffer, actual.byteOffset, actual.byteLength);\n\t\t}\n\t\treturn new VSBuffer(actual);\n\t}\n\n\tstatic fromString(source: string, options?: { dontUseNodeBuffer?: boolean; }): VSBuffer {\n\t\tconst dontUseNodeBuffer = options?.dontUseNodeBuffer || false;\n\t\tif (!dontUseNodeBuffer && hasBuffer) {\n\t\t\treturn new VSBuffer(Buffer.from(source));\n\t\t} else if (hasTextEncoder) {\n\t\t\tif (!textEncoder) {\n\t\t\t\ttextEncoder = new TextEncoder();\n\t\t\t}\n\t\t\treturn new VSBuffer(textEncoder.encode(source));\n\t\t} else {\n\t\t\treturn new VSBuffer(strings.encodeUTF8(source));\n\t\t}\n\t}\n\n\tstatic concat(buffers: VSBuffer[], totalLength?: number): VSBuffer {\n\t\tif (typeof totalLength === 'undefined') {\n\t\t\ttotalLength = 0;\n\t\t\tfor (let i = 0, len = buffers.length; i < len; i++) {\n\t\t\t\ttotalLength += buffers[i].byteLength;\n\t\t\t}\n\t\t}\n\n\t\tconst ret = VSBuffer.alloc(totalLength);\n\t\tlet offset = 0;\n\t\tfor (let i = 0, len = buffers.length; i < len; i++) {\n\t\t\tconst element = buffers[i];\n\t\t\tret.set(element, offset);\n\t\t\toffset += element.byteLength;\n\t\t}\n\n\t\treturn ret;\n\t}\n\n\treadonly buffer: Uint8Array;\n\treadonly byteLength: number;\n\n\tprivate constructor(buffer: Uint8Array) {\n\t\tthis.buffer = buffer;\n\t\tthis.byteLength = this.buffer.byteLength;\n\t}\n\n\ttoString(): string {\n\t\tif (hasBuffer) {\n\t\t\treturn this.buffer.toString();\n\t\t} else if (hasTextDecoder) {\n\t\t\tif (!textDecoder) {\n\t\t\t\ttextDecoder = new TextDecoder();\n\t\t\t}\n\t\t\treturn textDecoder.decode(this.buffer);\n\t\t} else {\n\t\t\treturn strings.decodeUTF8(this.buffer);\n\t\t}\n\t}\n\n\tslice(start?: number, end?: number): VSBuffer {\n\t\t// IMPORTANT: use subarray instead of slice because TypedArray#slice\n\t\t// creates shallow copy and NodeBuffer#slice doesn't. The use of subarray\n\t\t// ensures the same, performant, behaviour.\n\t\treturn new VSBuffer(this.buffer.subarray(start!/*bad lib.d.ts*/, end));\n\t}\n\n\tset(array: VSBuffer, offset?: number): void;\n\tset(array: Uint8Array, offset?: number): void;\n\tset(array: VSBuffer | Uint8Array, offset?: number): void {\n\t\tif (array instanceof VSBuffer) {\n\t\t\tthis.buffer.set(array.buffer, offset);\n\t\t} else {\n\t\t\tthis.buffer.set(array, offset);\n\t\t}\n\t}\n\n\treadUInt32BE(offset: number): number {\n\t\treturn readUInt32BE(this.buffer, offset);\n\t}\n\n\twriteUInt32BE(value: number, offset: number): void {\n\t\twriteUInt32BE(this.buffer, value, offset);\n\t}\n\n\treadUInt32LE(offset: number): number {\n\t\treturn readUInt32LE(this.buffer, offset);\n\t}\n\n\twriteUInt32LE(value: number, offset: number): void {\n\t\twriteUInt32LE(this.buffer, value, offset);\n\t}\n\n\treadUInt8(offset: number): number {\n\t\treturn readUInt8(this.buffer, offset);\n\t}\n\n\twriteUInt8(value: number, offset: number): void {\n\t\twriteUInt8(this.buffer, value, offset);\n\t}\n}\n\nexport function readUInt16LE(source: Uint8Array, offset: number): number {\n\treturn (\n\t\t((source[offset + 0] << 0) >>> 0) |\n\t\t((source[offset + 1] << 8) >>> 0)\n\t);\n}\n\nexport function writeUInt16LE(destination: Uint8Array, value: number, offset: number): void {\n\tdestination[offset + 0] = (value & 0b11111111);\n\tvalue = value >>> 8;\n\tdestination[offset + 1] = (value & 0b11111111);\n}\n\nexport function readUInt32BE(source: Uint8Array, offset: number): number {\n\treturn (\n\t\tsource[offset] * 2 ** 24\n\t\t+ source[offset + 1] * 2 ** 16\n\t\t+ source[offset + 2] * 2 ** 8\n\t\t+ source[offset + 3]\n\t);\n}\n\nexport function writeUInt32BE(destination: Uint8Array, value: number, offset: number): void {\n\tdestination[offset + 3] = value;\n\tvalue = value >>> 8;\n\tdestination[offset + 2] = value;\n\tvalue = value >>> 8;\n\tdestination[offset + 1] = value;\n\tvalue = value >>> 8;\n\tdestination[offset] = value;\n}\n\nexport function readUInt32LE(source: Uint8Array, offset: number): number {\n\treturn (\n\t\t((source[offset + 0] << 0) >>> 0) |\n\t\t((source[offset + 1] << 8) >>> 0) |\n\t\t((source[offset + 2] << 16) >>> 0) |\n\t\t((source[offset + 3] << 24) >>> 0)\n\t);\n}\n\nexport function writeUInt32LE(destination: Uint8Array, value: number, offset: number): void {\n\tdestination[offset + 0] = (value & 0b11111111);\n\tvalue = value >>> 8;\n\tdestination[offset + 1] = (value & 0b11111111);\n\tvalue = value >>> 8;\n\tdestination[offset + 2] = (value & 0b11111111);\n\tvalue = value >>> 8;\n\tdestination[offset + 3] = (value & 0b11111111);\n}\n\nexport function readUInt8(source: Uint8Array, offset: number): number {\n\treturn source[offset];\n}\n\nexport function writeUInt8(destination: Uint8Array, value: number, offset: number): void {\n\tdestination[offset] = value;\n}\n\nexport interface VSBufferReadable extends streams.Readable<VSBuffer> { }\n\nexport interface VSBufferReadableStream extends streams.ReadableStream<VSBuffer> { }\n\nexport interface VSBufferWriteableStream extends streams.WriteableStream<VSBuffer> { }\n\nexport interface VSBufferReadableBufferedStream extends streams.ReadableBufferedStream<VSBuffer> { }\n\nexport function readableToBuffer(readable: VSBufferReadable): VSBuffer {\n\treturn streams.consumeReadable<VSBuffer>(readable, chunks => VSBuffer.concat(chunks));\n}\n\nexport function bufferToReadable(buffer: VSBuffer): VSBufferReadable {\n\treturn streams.toReadable<VSBuffer>(buffer);\n}\n\nexport function streamToBuffer(stream: streams.ReadableStream<VSBuffer>): Promise<VSBuffer> {\n\treturn streams.consumeStream<VSBuffer>(stream, chunks => VSBuffer.concat(chunks));\n}\n\nexport async function bufferedStreamToBuffer(bufferedStream: streams.ReadableBufferedStream<VSBuffer>): Promise<VSBuffer> {\n\tif (bufferedStream.ended) {\n\t\treturn VSBuffer.concat(bufferedStream.buffer);\n\t}\n\n\treturn VSBuffer.concat([\n\n\t\t// Include already read chunks...\n\t\t...bufferedStream.buffer,\n\n\t\t// ...and all additional chunks\n\t\tawait streamToBuffer(bufferedStream.stream)\n\t]);\n}\n\nexport function bufferToStream(buffer: VSBuffer): streams.ReadableStream<VSBuffer> {\n\treturn streams.toStream<VSBuffer>(buffer, chunks => VSBuffer.concat(chunks));\n}\n\nexport function streamToBufferReadableStream(stream: streams.ReadableStreamEvents<Uint8Array | string>): streams.ReadableStream<VSBuffer> {\n\treturn streams.transform<Uint8Array | string, VSBuffer>(stream, { data: data => typeof data === 'string' ? VSBuffer.fromString(data) : VSBuffer.wrap(data) }, chunks => VSBuffer.concat(chunks));\n}\n\nexport function newWriteableBufferStream(options?: streams.WriteableStreamOptions): streams.WriteableStream<VSBuffer> {\n\treturn streams.newWriteableStream<VSBuffer>(chunks => VSBuffer.concat(chunks), options);\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as strings from 'vs/base/common/strings';\n\n/**\n * Return a hash value for an object.\n */\nexport function hash(obj: any): number {\n\treturn doHash(obj, 0);\n}\n\nexport function doHash(obj: any, hashVal: number): number {\n\tswitch (typeof obj) {\n\t\tcase 'object':\n\t\t\tif (obj === null) {\n\t\t\t\treturn numberHash(349, hashVal);\n\t\t\t} else if (Array.isArray(obj)) {\n\t\t\t\treturn arrayHash(obj, hashVal);\n\t\t\t}\n\t\t\treturn objectHash(obj, hashVal);\n\t\tcase 'string':\n\t\t\treturn stringHash(obj, hashVal);\n\t\tcase 'boolean':\n\t\t\treturn booleanHash(obj, hashVal);\n\t\tcase 'number':\n\t\t\treturn numberHash(obj, hashVal);\n\t\tcase 'undefined':\n\t\t\treturn numberHash(937, hashVal);\n\t\tdefault:\n\t\t\treturn numberHash(617, hashVal);\n\t}\n}\n\nfunction numberHash(val: number, initialHashVal: number): number {\n\treturn (((initialHashVal << 5) - initialHashVal) + val) | 0;  // hashVal * 31 + ch, keep as int32\n}\n\nfunction booleanHash(b: boolean, initialHashVal: number): number {\n\treturn numberHash(b ? 433 : 863, initialHashVal);\n}\n\nexport function stringHash(s: string, hashVal: number) {\n\thashVal = numberHash(149417, hashVal);\n\tfor (let i = 0, length = s.length; i < length; i++) {\n\t\thashVal = numberHash(s.charCodeAt(i), hashVal);\n\t}\n\treturn hashVal;\n}\n\nfunction arrayHash(arr: any[], initialHashVal: number): number {\n\tinitialHashVal = numberHash(104579, initialHashVal);\n\treturn arr.reduce((hashVal, item) => doHash(item, hashVal), initialHashVal);\n}\n\nfunction objectHash(obj: any, initialHashVal: number): number {\n\tinitialHashVal = numberHash(181387, initialHashVal);\n\treturn Object.keys(obj).sort().reduce((hashVal, key) => {\n\t\thashVal = stringHash(key, hashVal);\n\t\treturn doHash(obj[key], hashVal);\n\t}, initialHashVal);\n}\n\nexport class Hasher {\n\n\tprivate _value = 0;\n\n\tget value(): number {\n\t\treturn this._value;\n\t}\n\n\thash(obj: any): number {\n\t\tthis._value = doHash(obj, this._value);\n\t\treturn this._value;\n\t}\n}\n\nconst enum SHA1Constant {\n\tBLOCK_SIZE = 64, // 512 / 8\n\tUNICODE_REPLACEMENT = 0xFFFD,\n}\n\nfunction leftRotate(value: number, bits: number, totalBits: number = 32): number {\n\t// delta + bits = totalBits\n\tconst delta = totalBits - bits;\n\n\t// All ones, expect `delta` zeros aligned to the right\n\tconst mask = ~((1 << delta) - 1);\n\n\t// Join (value left-shifted `bits` bits) with (masked value right-shifted `delta` bits)\n\treturn ((value << bits) | ((mask & value) >>> delta)) >>> 0;\n}\n\nfunction fill(dest: Uint8Array, index: number = 0, count: number = dest.byteLength, value: number = 0): void {\n\tfor (let i = 0; i < count; i++) {\n\t\tdest[index + i] = value;\n\t}\n}\n\nfunction leftPad(value: string, length: number, char: string = '0'): string {\n\twhile (value.length < length) {\n\t\tvalue = char + value;\n\t}\n\treturn value;\n}\n\nexport function toHexString(buffer: ArrayBuffer): string;\nexport function toHexString(value: number, bitsize?: number): string;\nexport function toHexString(bufferOrValue: ArrayBuffer | number, bitsize: number = 32): string {\n\tif (bufferOrValue instanceof ArrayBuffer) {\n\t\treturn Array.from(new Uint8Array(bufferOrValue)).map(b => b.toString(16).padStart(2, '0')).join('');\n\t}\n\n\treturn leftPad((bufferOrValue >>> 0).toString(16), bitsize / 4);\n}\n\n/**\n * A SHA1 implementation that works with strings and does not allocate.\n */\nexport class StringSHA1 {\n\tprivate static _bigBlock32 = new DataView(new ArrayBuffer(320)); // 80 * 4 = 320\n\n\tprivate _h0 = 0x67452301;\n\tprivate _h1 = 0xEFCDAB89;\n\tprivate _h2 = 0x98BADCFE;\n\tprivate _h3 = 0x10325476;\n\tprivate _h4 = 0xC3D2E1F0;\n\n\tprivate readonly _buff: Uint8Array;\n\tprivate readonly _buffDV: DataView;\n\tprivate _buffLen: number;\n\tprivate _totalLen: number;\n\tprivate _leftoverHighSurrogate: number;\n\tprivate _finished: boolean;\n\n\tconstructor() {\n\t\tthis._buff = new Uint8Array(SHA1Constant.BLOCK_SIZE + 3 /* to fit any utf-8 */);\n\t\tthis._buffDV = new DataView(this._buff.buffer);\n\t\tthis._buffLen = 0;\n\t\tthis._totalLen = 0;\n\t\tthis._leftoverHighSurrogate = 0;\n\t\tthis._finished = false;\n\t}\n\n\tpublic update(str: string): void {\n\t\tconst strLen = str.length;\n\t\tif (strLen === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst buff = this._buff;\n\t\tlet buffLen = this._buffLen;\n\t\tlet leftoverHighSurrogate = this._leftoverHighSurrogate;\n\t\tlet charCode: number;\n\t\tlet offset: number;\n\n\t\tif (leftoverHighSurrogate !== 0) {\n\t\t\tcharCode = leftoverHighSurrogate;\n\t\t\toffset = -1;\n\t\t\tleftoverHighSurrogate = 0;\n\t\t} else {\n\t\t\tcharCode = str.charCodeAt(0);\n\t\t\toffset = 0;\n\t\t}\n\n\t\twhile (true) {\n\t\t\tlet codePoint = charCode;\n\t\t\tif (strings.isHighSurrogate(charCode)) {\n\t\t\t\tif (offset + 1 < strLen) {\n\t\t\t\t\tconst nextCharCode = str.charCodeAt(offset + 1);\n\t\t\t\t\tif (strings.isLowSurrogate(nextCharCode)) {\n\t\t\t\t\t\toffset++;\n\t\t\t\t\t\tcodePoint = strings.computeCodePoint(charCode, nextCharCode);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// illegal => unicode replacement character\n\t\t\t\t\t\tcodePoint = SHA1Constant.UNICODE_REPLACEMENT;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// last character is a surrogate pair\n\t\t\t\t\tleftoverHighSurrogate = charCode;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else if (strings.isLowSurrogate(charCode)) {\n\t\t\t\t// illegal => unicode replacement character\n\t\t\t\tcodePoint = SHA1Constant.UNICODE_REPLACEMENT;\n\t\t\t}\n\n\t\t\tbuffLen = this._push(buff, buffLen, codePoint);\n\t\t\toffset++;\n\t\t\tif (offset < strLen) {\n\t\t\t\tcharCode = str.charCodeAt(offset);\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tthis._buffLen = buffLen;\n\t\tthis._leftoverHighSurrogate = leftoverHighSurrogate;\n\t}\n\n\tprivate _push(buff: Uint8Array, buffLen: number, codePoint: number): number {\n\t\tif (codePoint < 0x0080) {\n\t\t\tbuff[buffLen++] = codePoint;\n\t\t} else if (codePoint < 0x0800) {\n\t\t\tbuff[buffLen++] = 0b11000000 | ((codePoint & 0b00000000000000000000011111000000) >>> 6);\n\t\t\tbuff[buffLen++] = 0b10000000 | ((codePoint & 0b00000000000000000000000000111111) >>> 0);\n\t\t} else if (codePoint < 0x10000) {\n\t\t\tbuff[buffLen++] = 0b11100000 | ((codePoint & 0b00000000000000001111000000000000) >>> 12);\n\t\t\tbuff[buffLen++] = 0b10000000 | ((codePoint & 0b00000000000000000000111111000000) >>> 6);\n\t\t\tbuff[buffLen++] = 0b10000000 | ((codePoint & 0b00000000000000000000000000111111) >>> 0);\n\t\t} else {\n\t\t\tbuff[buffLen++] = 0b11110000 | ((codePoint & 0b00000000000111000000000000000000) >>> 18);\n\t\t\tbuff[buffLen++] = 0b10000000 | ((codePoint & 0b00000000000000111111000000000000) >>> 12);\n\t\t\tbuff[buffLen++] = 0b10000000 | ((codePoint & 0b00000000000000000000111111000000) >>> 6);\n\t\t\tbuff[buffLen++] = 0b10000000 | ((codePoint & 0b00000000000000000000000000111111) >>> 0);\n\t\t}\n\n\t\tif (buffLen >= SHA1Constant.BLOCK_SIZE) {\n\t\t\tthis._step();\n\t\t\tbuffLen -= SHA1Constant.BLOCK_SIZE;\n\t\t\tthis._totalLen += SHA1Constant.BLOCK_SIZE;\n\t\t\t// take last 3 in case of UTF8 overflow\n\t\t\tbuff[0] = buff[SHA1Constant.BLOCK_SIZE + 0];\n\t\t\tbuff[1] = buff[SHA1Constant.BLOCK_SIZE + 1];\n\t\t\tbuff[2] = buff[SHA1Constant.BLOCK_SIZE + 2];\n\t\t}\n\n\t\treturn buffLen;\n\t}\n\n\tpublic digest(): string {\n\t\tif (!this._finished) {\n\t\t\tthis._finished = true;\n\t\t\tif (this._leftoverHighSurrogate) {\n\t\t\t\t// illegal => unicode replacement character\n\t\t\t\tthis._leftoverHighSurrogate = 0;\n\t\t\t\tthis._buffLen = this._push(this._buff, this._buffLen, SHA1Constant.UNICODE_REPLACEMENT);\n\t\t\t}\n\t\t\tthis._totalLen += this._buffLen;\n\t\t\tthis._wrapUp();\n\t\t}\n\n\t\treturn toHexString(this._h0) + toHexString(this._h1) + toHexString(this._h2) + toHexString(this._h3) + toHexString(this._h4);\n\t}\n\n\tprivate _wrapUp(): void {\n\t\tthis._buff[this._buffLen++] = 0x80;\n\t\tfill(this._buff, this._buffLen);\n\n\t\tif (this._buffLen > 56) {\n\t\t\tthis._step();\n\t\t\tfill(this._buff);\n\t\t}\n\n\t\t// this will fit because the mantissa can cover up to 52 bits\n\t\tconst ml = 8 * this._totalLen;\n\n\t\tthis._buffDV.setUint32(56, Math.floor(ml / 4294967296), false);\n\t\tthis._buffDV.setUint32(60, ml % 4294967296, false);\n\n\t\tthis._step();\n\t}\n\n\tprivate _step(): void {\n\t\tconst bigBlock32 = StringSHA1._bigBlock32;\n\t\tconst data = this._buffDV;\n\n\t\tfor (let j = 0; j < 64 /* 16*4 */; j += 4) {\n\t\t\tbigBlock32.setUint32(j, data.getUint32(j, false), false);\n\t\t}\n\n\t\tfor (let j = 64; j < 320 /* 80*4 */; j += 4) {\n\t\t\tbigBlock32.setUint32(j, leftRotate((bigBlock32.getUint32(j - 12, false) ^ bigBlock32.getUint32(j - 32, false) ^ bigBlock32.getUint32(j - 56, false) ^ bigBlock32.getUint32(j - 64, false)), 1), false);\n\t\t}\n\n\t\tlet a = this._h0;\n\t\tlet b = this._h1;\n\t\tlet c = this._h2;\n\t\tlet d = this._h3;\n\t\tlet e = this._h4;\n\n\t\tlet f: number, k: number;\n\t\tlet temp: number;\n\n\t\tfor (let j = 0; j < 80; j++) {\n\t\t\tif (j < 20) {\n\t\t\t\tf = (b & c) | ((~b) & d);\n\t\t\t\tk = 0x5A827999;\n\t\t\t} else if (j < 40) {\n\t\t\t\tf = b ^ c ^ d;\n\t\t\t\tk = 0x6ED9EBA1;\n\t\t\t} else if (j < 60) {\n\t\t\t\tf = (b & c) | (b & d) | (c & d);\n\t\t\t\tk = 0x8F1BBCDC;\n\t\t\t} else {\n\t\t\t\tf = b ^ c ^ d;\n\t\t\t\tk = 0xCA62C1D6;\n\t\t\t}\n\n\t\t\ttemp = (leftRotate(a, 5) + f + e + k + bigBlock32.getUint32(j * 4, false)) & 0xffffffff;\n\t\t\te = d;\n\t\t\td = c;\n\t\t\tc = leftRotate(b, 30);\n\t\t\tb = a;\n\t\t\ta = temp;\n\t\t}\n\n\t\tthis._h0 = (this._h0 + a) & 0xffffffff;\n\t\tthis._h1 = (this._h1 + b) & 0xffffffff;\n\t\tthis._h2 = (this._h2 + c) & 0xffffffff;\n\t\tthis._h3 = (this._h3 + d) & 0xffffffff;\n\t\tthis._h4 = (this._h4 + e) & 0xffffffff;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as strings from 'vs/base/common/strings';\n\nenum Severity {\n\tIgnore = 0,\n\tInfo = 1,\n\tWarning = 2,\n\tError = 3\n}\n\nnamespace Severity {\n\n\tconst _error = 'error';\n\tconst _warning = 'warning';\n\tconst _warn = 'warn';\n\tconst _info = 'info';\n\n\t/**\n\t * Parses 'error', 'warning', 'warn', 'info' in call casings\n\t * and falls back to ignore.\n\t */\n\texport function fromValue(value: string): Severity {\n\t\tif (!value) {\n\t\t\treturn Severity.Ignore;\n\t\t}\n\n\t\tif (strings.equalsIgnoreCase(_error, value)) {\n\t\t\treturn Severity.Error;\n\t\t}\n\n\t\tif (strings.equalsIgnoreCase(_warning, value) || strings.equalsIgnoreCase(_warn, value)) {\n\t\t\treturn Severity.Warning;\n\t\t}\n\n\t\tif (strings.equalsIgnoreCase(_info, value)) {\n\t\t\treturn Severity.Info;\n\t\t}\n\t\treturn Severity.Ignore;\n\t}\n}\n\nexport default Severity;\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI, UriComponents } from 'vs/base/common/uri';\n\n/**\n * @returns whether the provided parameter is a JavaScript Array or not.\n */\nexport function isArray<T>(array: T | {}): array is T extends readonly any[] ? (unknown extends T ? never : readonly any[]) : any[] {\n\treturn Array.isArray(array);\n}\n\n/**\n * @returns whether the provided parameter is a JavaScript String or not.\n */\nexport function isString(str: any): str is string {\n\treturn (typeof str === 'string');\n}\n\n/**\n * @returns whether the provided parameter is a JavaScript Array and each element in the array is a string.\n */\nexport function isStringArray(value: any): value is string[] {\n\treturn Array.isArray(value) && (<any[]>value).every(elem => isString(elem));\n}\n\n/**\n *\n * @returns whether the provided parameter is of type `object` but **not**\n *\t`null`, an `array`, a `regexp`, nor a `date`.\n */\nexport function isObject(obj: any): obj is Object {\n\t// The method can't do a type cast since there are type (like strings) which\n\t// are subclasses of any put not positvely matched by the function. Hence type\n\t// narrowing results in wrong results.\n\treturn typeof obj === 'object'\n\t\t&& obj !== null\n\t\t&& !Array.isArray(obj)\n\t\t&& !(obj instanceof RegExp)\n\t\t&& !(obj instanceof Date);\n}\n\n/**\n * In **contrast** to just checking `typeof` this will return `false` for `NaN`.\n * @returns whether the provided parameter is a JavaScript Number or not.\n */\nexport function isNumber(obj: any): obj is number {\n\treturn (typeof obj === 'number' && !isNaN(obj));\n}\n\n/**\n * @returns whether the provided parameter is a JavaScript Boolean or not.\n */\nexport function isBoolean(obj: any): obj is boolean {\n\treturn (obj === true || obj === false);\n}\n\n/**\n * @returns whether the provided parameter is undefined.\n */\nexport function isUndefined(obj: any): obj is undefined {\n\treturn (typeof obj === 'undefined');\n}\n\n/**\n * @returns whether the provided parameter is defined.\n */\nexport function isDefined<T>(arg: T | null | undefined): arg is T {\n\treturn !isUndefinedOrNull(arg);\n}\n\n/**\n * @returns whether the provided parameter is undefined or null.\n */\nexport function isUndefinedOrNull(obj: any): obj is undefined | null {\n\treturn (isUndefined(obj) || obj === null);\n}\n\n\nexport function assertType(condition: any, type?: string): asserts condition {\n\tif (!condition) {\n\t\tthrow new Error(type ? `Unexpected type, expected '${type}'` : 'Unexpected type');\n\t}\n}\n\n/**\n * Asserts that the argument passed in is neither undefined nor null.\n */\nexport function assertIsDefined<T>(arg: T | null | undefined): T {\n\tif (isUndefinedOrNull(arg)) {\n\t\tthrow new Error('Assertion Failed: argument is undefined or null');\n\t}\n\n\treturn arg;\n}\n\n/**\n * Asserts that each argument passed in is neither undefined nor null.\n */\nexport function assertAllDefined<T1, T2>(t1: T1 | null | undefined, t2: T2 | null | undefined): [T1, T2];\nexport function assertAllDefined<T1, T2, T3>(t1: T1 | null | undefined, t2: T2 | null | undefined, t3: T3 | null | undefined): [T1, T2, T3];\nexport function assertAllDefined<T1, T2, T3, T4>(t1: T1 | null | undefined, t2: T2 | null | undefined, t3: T3 | null | undefined, t4: T4 | null | undefined): [T1, T2, T3, T4];\nexport function assertAllDefined(...args: (unknown | null | undefined)[]): unknown[] {\n\tconst result = [];\n\n\tfor (let i = 0; i < args.length; i++) {\n\t\tconst arg = args[i];\n\n\t\tif (isUndefinedOrNull(arg)) {\n\t\t\tthrow new Error(`Assertion Failed: argument at index ${i} is undefined or null`);\n\t\t}\n\n\t\tresult.push(arg);\n\t}\n\n\treturn result;\n}\n\nconst hasOwnProperty = Object.prototype.hasOwnProperty;\n\n/**\n * @returns whether the provided parameter is an empty JavaScript Object or not.\n */\nexport function isEmptyObject(obj: any): obj is any {\n\tif (!isObject(obj)) {\n\t\treturn false;\n\t}\n\n\tfor (let key in obj) {\n\t\tif (hasOwnProperty.call(obj, key)) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}\n\n/**\n * @returns whether the provided parameter is a JavaScript Function or not.\n */\nexport function isFunction(obj: any): obj is Function {\n\treturn (typeof obj === 'function');\n}\n\n/**\n * @returns whether the provided parameters is are JavaScript Function or not.\n */\nexport function areFunctions(...objects: any[]): boolean {\n\treturn objects.length > 0 && objects.every(isFunction);\n}\n\nexport type TypeConstraint = string | Function;\n\nexport function validateConstraints(args: any[], constraints: Array<TypeConstraint | undefined>): void {\n\tconst len = Math.min(args.length, constraints.length);\n\tfor (let i = 0; i < len; i++) {\n\t\tvalidateConstraint(args[i], constraints[i]);\n\t}\n}\n\nexport function validateConstraint(arg: any, constraint: TypeConstraint | undefined): void {\n\n\tif (isString(constraint)) {\n\t\tif (typeof arg !== constraint) {\n\t\t\tthrow new Error(`argument does not match constraint: typeof ${constraint}`);\n\t\t}\n\t} else if (isFunction(constraint)) {\n\t\ttry {\n\t\t\tif (arg instanceof constraint) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t} catch {\n\t\t\t// ignore\n\t\t}\n\t\tif (!isUndefinedOrNull(arg) && arg.constructor === constraint) {\n\t\t\treturn;\n\t\t}\n\t\tif (constraint.length === 1 && constraint.call(undefined, arg) === true) {\n\t\t\treturn;\n\t\t}\n\t\tthrow new Error(`argument does not match one of these constraints: arg instanceof constraint, arg.constructor === constraint, nor constraint(arg) === true`);\n\t}\n}\n\nexport function getAllPropertyNames(obj: object): string[] {\n\tlet res: string[] = [];\n\tlet proto = Object.getPrototypeOf(obj);\n\twhile (Object.prototype !== proto) {\n\t\tres = res.concat(Object.getOwnPropertyNames(proto));\n\t\tproto = Object.getPrototypeOf(proto);\n\t}\n\treturn res;\n}\n\nexport function getAllMethodNames(obj: object): string[] {\n\tconst methods: string[] = [];\n\tfor (const prop of getAllPropertyNames(obj)) {\n\t\tif (typeof (obj as any)[prop] === 'function') {\n\t\t\tmethods.push(prop);\n\t\t}\n\t}\n\treturn methods;\n}\n\nexport function createProxyObject<T extends object>(methodNames: string[], invoke: (method: string, args: any[]) => any): T {\n\tconst createProxyMethod = (method: string): () => any => {\n\t\treturn function () {\n\t\t\tconst args = Array.prototype.slice.call(arguments, 0);\n\t\t\treturn invoke(method, args);\n\t\t};\n\t};\n\n\tlet result = {} as T;\n\tfor (const methodName of methodNames) {\n\t\t(<any>result)[methodName] = createProxyMethod(methodName);\n\t}\n\treturn result;\n}\n\n/**\n * Converts null to undefined, passes all other values through.\n */\nexport function withNullAsUndefined<T>(x: T | null): T | undefined {\n\treturn x === null ? undefined : x;\n}\n\n/**\n * Converts undefined to null, passes all other values through.\n */\nexport function withUndefinedAsNull<T>(x: T | undefined): T | null {\n\treturn typeof x === 'undefined' ? null : x;\n}\n\n/**\n * Allows to add a first parameter to functions of a type.\n */\nexport type AddFirstParameterToFunctions<Target, TargetFunctionsReturnType, FirstParameter> = {\n\n\t//  For every property\n\t[K in keyof Target]:\n\n\t// Function: add param to function\n\tTarget[K] extends (...args: any) => TargetFunctionsReturnType ? (firstArg: FirstParameter, ...args: Parameters<Target[K]>) => ReturnType<Target[K]> :\n\n\t// Else: just leave as is\n\tTarget[K]\n};\n\n/**\n * Mapped-type that replaces all occurrences of URI with UriComponents\n */\nexport type UriDto<T> = { [K in keyof T]: T[K] extends URI\n\t? UriComponents\n\t: UriDto<T[K]> };\n\n/**\n * Mapped-type that replaces all occurrences of URI with UriComponents and\n * drops all functions.\n */\nexport type Dto<T> = T extends { toJSON(): infer U }\n\t? U\n\t: T extends object\n\t? { [k in keyof T]: Dto<T[k]>; }\n\t: T;\n\nexport function NotImplementedProxy<T>(name: string): { new(): T } {\n\treturn <any>class {\n\t\tconstructor() {\n\t\t\treturn new Proxy({}, {\n\t\t\t\tget(target: any, prop: PropertyKey) {\n\t\t\t\t\tif (target[prop]) {\n\t\t\t\t\t\treturn target[prop];\n\t\t\t\t\t}\n\t\t\t\t\tthrow new Error(`Not Implemented: ${name}->${String(prop)}`);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { isWindows } from 'vs/base/common/platform';\nimport { startsWithIgnoreCase, equalsIgnoreCase, rtrim } from 'vs/base/common/strings';\nimport { CharCode } from 'vs/base/common/charCode';\nimport { sep, posix, isAbsolute, join, normalize } from 'vs/base/common/path';\nimport { isNumber } from 'vs/base/common/types';\n\nexport function isPathSeparator(code: number) {\n\treturn code === CharCode.Slash || code === CharCode.Backslash;\n}\n\n/**\n * Takes a Windows OS path and changes backward slashes to forward slashes.\n * This should only be done for OS paths from Windows (or user provided paths potentially from Windows).\n * Using it on a Linux or MaxOS path might change it.\n */\nexport function toSlashes(osPath: string) {\n\treturn osPath.replace(/[\\\\/]/g, posix.sep);\n}\n\n/**\n * Computes the _root_ this path, like `getRoot('c:\\files') === c:\\`,\n * `getRoot('files:///files/path') === files:///`,\n * or `getRoot('\\\\server\\shares\\path') === \\\\server\\shares\\`\n */\nexport function getRoot(path: string, sep: string = posix.sep): string {\n\n\tif (!path) {\n\t\treturn '';\n\t}\n\n\tconst len = path.length;\n\tconst firstLetter = path.charCodeAt(0);\n\tif (isPathSeparator(firstLetter)) {\n\t\tif (isPathSeparator(path.charCodeAt(1))) {\n\t\t\t// UNC candidate \\\\localhost\\shares\\ddd\n\t\t\t//               ^^^^^^^^^^^^^^^^^^^\n\t\t\tif (!isPathSeparator(path.charCodeAt(2))) {\n\t\t\t\tlet pos = 3;\n\t\t\t\tconst start = pos;\n\t\t\t\tfor (; pos < len; pos++) {\n\t\t\t\t\tif (isPathSeparator(path.charCodeAt(pos))) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (start !== pos && !isPathSeparator(path.charCodeAt(pos + 1))) {\n\t\t\t\t\tpos += 1;\n\t\t\t\t\tfor (; pos < len; pos++) {\n\t\t\t\t\t\tif (isPathSeparator(path.charCodeAt(pos))) {\n\t\t\t\t\t\t\treturn path.slice(0, pos + 1) // consume this separator\n\t\t\t\t\t\t\t\t.replace(/[\\\\/]/g, sep);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// /user/far\n\t\t// ^\n\t\treturn sep;\n\n\t} else if (isWindowsDriveLetter(firstLetter)) {\n\t\t// check for windows drive letter c:\\ or c:\n\n\t\tif (path.charCodeAt(1) === CharCode.Colon) {\n\t\t\tif (isPathSeparator(path.charCodeAt(2))) {\n\t\t\t\t// C:\\fff\n\t\t\t\t// ^^^\n\t\t\t\treturn path.slice(0, 2) + sep;\n\t\t\t} else {\n\t\t\t\t// C:\n\t\t\t\t// ^^\n\t\t\t\treturn path.slice(0, 2);\n\t\t\t}\n\t\t}\n\t}\n\n\t// check for URI\n\t// scheme://authority/path\n\t// ^^^^^^^^^^^^^^^^^^^\n\tlet pos = path.indexOf('://');\n\tif (pos !== -1) {\n\t\tpos += 3; // 3 -> \"://\".length\n\t\tfor (; pos < len; pos++) {\n\t\t\tif (isPathSeparator(path.charCodeAt(pos))) {\n\t\t\t\treturn path.slice(0, pos + 1); // consume this separator\n\t\t\t}\n\t\t}\n\t}\n\n\treturn '';\n}\n\n/**\n * Check if the path follows this pattern: `\\\\hostname\\sharename`.\n *\n * @see https://msdn.microsoft.com/en-us/library/gg465305.aspx\n * @return A boolean indication if the path is a UNC path, on none-windows\n * always false.\n */\nexport function isUNC(path: string): boolean {\n\tif (!isWindows) {\n\t\t// UNC is a windows concept\n\t\treturn false;\n\t}\n\n\tif (!path || path.length < 5) {\n\t\t// at least \\\\a\\b\n\t\treturn false;\n\t}\n\n\tlet code = path.charCodeAt(0);\n\tif (code !== CharCode.Backslash) {\n\t\treturn false;\n\t}\n\tcode = path.charCodeAt(1);\n\tif (code !== CharCode.Backslash) {\n\t\treturn false;\n\t}\n\tlet pos = 2;\n\tconst start = pos;\n\tfor (; pos < path.length; pos++) {\n\t\tcode = path.charCodeAt(pos);\n\t\tif (code === CharCode.Backslash) {\n\t\t\tbreak;\n\t\t}\n\t}\n\tif (start === pos) {\n\t\treturn false;\n\t}\n\tcode = path.charCodeAt(pos + 1);\n\tif (isNaN(code) || code === CharCode.Backslash) {\n\t\treturn false;\n\t}\n\treturn true;\n}\n\n// Reference: https://en.wikipedia.org/wiki/Filename\nconst WINDOWS_INVALID_FILE_CHARS = /[\\\\/:\\*\\?\"<>\\|]/g;\nconst UNIX_INVALID_FILE_CHARS = /[\\\\/]/g;\nconst WINDOWS_FORBIDDEN_NAMES = /^(con|prn|aux|clock\\$|nul|lpt[0-9]|com[0-9])(\\.(.*?))?$/i;\nexport function isValidBasename(name: string | null | undefined, isWindowsOS: boolean = isWindows): boolean {\n\tconst invalidFileChars = isWindowsOS ? WINDOWS_INVALID_FILE_CHARS : UNIX_INVALID_FILE_CHARS;\n\n\tif (!name || name.length === 0 || /^\\s+$/.test(name)) {\n\t\treturn false; // require a name that is not just whitespace\n\t}\n\n\tinvalidFileChars.lastIndex = 0; // the holy grail of software development\n\tif (invalidFileChars.test(name)) {\n\t\treturn false; // check for certain invalid file characters\n\t}\n\n\tif (isWindowsOS && WINDOWS_FORBIDDEN_NAMES.test(name)) {\n\t\treturn false; // check for certain invalid file names\n\t}\n\n\tif (name === '.' || name === '..') {\n\t\treturn false; // check for reserved values\n\t}\n\n\tif (isWindowsOS && name[name.length - 1] === '.') {\n\t\treturn false; // Windows: file cannot end with a \".\"\n\t}\n\n\tif (isWindowsOS && name.length !== name.trim().length) {\n\t\treturn false; // Windows: file cannot end with a whitespace\n\t}\n\n\tif (name.length > 255) {\n\t\treturn false; // most file systems do not allow files > 255 length\n\t}\n\n\treturn true;\n}\n\nexport function isEqual(pathA: string, pathB: string, ignoreCase?: boolean): boolean {\n\tconst identityEquals = (pathA === pathB);\n\tif (!ignoreCase || identityEquals) {\n\t\treturn identityEquals;\n\t}\n\n\tif (!pathA || !pathB) {\n\t\treturn false;\n\t}\n\n\treturn equalsIgnoreCase(pathA, pathB);\n}\n\nexport function isEqualOrParent(base: string, parentCandidate: string, ignoreCase?: boolean, separator = sep): boolean {\n\tif (base === parentCandidate) {\n\t\treturn true;\n\t}\n\n\tif (!base || !parentCandidate) {\n\t\treturn false;\n\t}\n\n\tif (parentCandidate.length > base.length) {\n\t\treturn false;\n\t}\n\n\tif (ignoreCase) {\n\t\tconst beginsWith = startsWithIgnoreCase(base, parentCandidate);\n\t\tif (!beginsWith) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (parentCandidate.length === base.length) {\n\t\t\treturn true; // same path, different casing\n\t\t}\n\n\t\tlet sepOffset = parentCandidate.length;\n\t\tif (parentCandidate.charAt(parentCandidate.length - 1) === separator) {\n\t\t\tsepOffset--; // adjust the expected sep offset in case our candidate already ends in separator character\n\t\t}\n\n\t\treturn base.charAt(sepOffset) === separator;\n\t}\n\n\tif (parentCandidate.charAt(parentCandidate.length - 1) !== separator) {\n\t\tparentCandidate += separator;\n\t}\n\n\treturn base.indexOf(parentCandidate) === 0;\n}\n\nexport function isWindowsDriveLetter(char0: number): boolean {\n\treturn char0 >= CharCode.A && char0 <= CharCode.Z || char0 >= CharCode.a && char0 <= CharCode.z;\n}\n\nexport function sanitizeFilePath(candidate: string, cwd: string): string {\n\n\t// Special case: allow to open a drive letter without trailing backslash\n\tif (isWindows && candidate.endsWith(':')) {\n\t\tcandidate += sep;\n\t}\n\n\t// Ensure absolute\n\tif (!isAbsolute(candidate)) {\n\t\tcandidate = join(cwd, candidate);\n\t}\n\n\t// Ensure normalized\n\tcandidate = normalize(candidate);\n\n\t// Ensure no trailing slash/backslash\n\tif (isWindows) {\n\t\tcandidate = rtrim(candidate, sep);\n\n\t\t// Special case: allow to open drive root ('C:\\')\n\t\tif (candidate.endsWith(':')) {\n\t\t\tcandidate += sep;\n\t\t}\n\n\t} else {\n\t\tcandidate = rtrim(candidate, sep);\n\n\t\t// Special case: allow to open root ('/')\n\t\tif (!candidate) {\n\t\t\tcandidate = sep;\n\t\t}\n\t}\n\n\treturn candidate;\n}\n\nexport function isRootOrDriveLetter(path: string): boolean {\n\tconst pathNormalized = normalize(path);\n\n\tif (isWindows) {\n\t\tif (path.length > 3) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn hasDriveLetter(pathNormalized) &&\n\t\t\t(path.length === 2 || pathNormalized.charCodeAt(2) === CharCode.Backslash);\n\t}\n\n\treturn pathNormalized === posix.sep;\n}\n\nexport function hasDriveLetter(path: string): boolean {\n\tif (isWindows) {\n\t\treturn isWindowsDriveLetter(path.charCodeAt(0)) && path.charCodeAt(1) === CharCode.Colon;\n\t}\n\n\treturn false;\n}\n\nexport function getDriveLetter(path: string): string | undefined {\n\treturn hasDriveLetter(path) ? path[0] : undefined;\n}\n\nexport function indexOfPath(path: string, candidate: string, ignoreCase?: boolean): number {\n\tif (candidate.length > path.length) {\n\t\treturn -1;\n\t}\n\n\tif (path === candidate) {\n\t\treturn 0;\n\t}\n\n\tif (ignoreCase) {\n\t\tpath = path.toLowerCase();\n\t\tcandidate = candidate.toLowerCase();\n\t}\n\n\treturn path.indexOf(candidate);\n}\n\nexport interface IPathWithLineAndColumn {\n\tpath: string;\n\tline?: number;\n\tcolumn?: number;\n}\n\nexport function parseLineAndColumnAware(rawPath: string): IPathWithLineAndColumn {\n\tconst segments = rawPath.split(':'); // C:\\file.txt:<line>:<column>\n\n\tlet path: string | undefined = undefined;\n\tlet line: number | undefined = undefined;\n\tlet column: number | undefined = undefined;\n\n\tsegments.forEach(segment => {\n\t\tconst segmentAsNumber = Number(segment);\n\t\tif (!isNumber(segmentAsNumber)) {\n\t\t\tpath = !!path ? [path, segment].join(':') : segment; // a colon can well be part of a path (e.g. C:\\...)\n\t\t} else if (line === undefined) {\n\t\t\tline = segmentAsNumber;\n\t\t} else if (column === undefined) {\n\t\t\tcolumn = segmentAsNumber;\n\t\t}\n\t});\n\n\tif (!path) {\n\t\tthrow new Error('Format for `--goto` should be: `FILE:LINE(:COLUMN)`');\n\t}\n\n\treturn {\n\t\tpath,\n\t\tline: line !== undefined ? line : undefined,\n\t\tcolumn: column !== undefined ? column : line !== undefined ? 1 : undefined // if we have a line, make sure column is also set\n\t};\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { isObject, isUndefinedOrNull, isArray } from 'vs/base/common/types';\n\nexport function deepClone<T>(obj: T): T {\n\tif (!obj || typeof obj !== 'object') {\n\t\treturn obj;\n\t}\n\tif (obj instanceof RegExp) {\n\t\t// See https://github.com/microsoft/TypeScript/issues/10990\n\t\treturn obj as any;\n\t}\n\tconst result: any = Array.isArray(obj) ? [] : {};\n\tObject.keys(<any>obj).forEach((key: string) => {\n\t\tif ((<any>obj)[key] && typeof (<any>obj)[key] === 'object') {\n\t\t\tresult[key] = deepClone((<any>obj)[key]);\n\t\t} else {\n\t\t\tresult[key] = (<any>obj)[key];\n\t\t}\n\t});\n\treturn result;\n}\n\nexport function deepFreeze<T>(obj: T): T {\n\tif (!obj || typeof obj !== 'object') {\n\t\treturn obj;\n\t}\n\tconst stack: any[] = [obj];\n\twhile (stack.length > 0) {\n\t\tconst obj = stack.shift();\n\t\tObject.freeze(obj);\n\t\tfor (const key in obj) {\n\t\t\tif (_hasOwnProperty.call(obj, key)) {\n\t\t\t\tconst prop = obj[key];\n\t\t\t\tif (typeof prop === 'object' && !Object.isFrozen(prop)) {\n\t\t\t\t\tstack.push(prop);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn obj;\n}\n\nconst _hasOwnProperty = Object.prototype.hasOwnProperty;\n\nexport function cloneAndChange(obj: any, changer: (orig: any) => any): any {\n\treturn _cloneAndChange(obj, changer, new Set());\n}\n\nfunction _cloneAndChange(obj: any, changer: (orig: any) => any, seen: Set<any>): any {\n\tif (isUndefinedOrNull(obj)) {\n\t\treturn obj;\n\t}\n\n\tconst changed = changer(obj);\n\tif (typeof changed !== 'undefined') {\n\t\treturn changed;\n\t}\n\n\tif (isArray(obj)) {\n\t\tconst r1: any[] = [];\n\t\tfor (const e of obj) {\n\t\t\tr1.push(_cloneAndChange(e, changer, seen));\n\t\t}\n\t\treturn r1;\n\t}\n\n\tif (isObject(obj)) {\n\t\tif (seen.has(obj)) {\n\t\t\tthrow new Error('Cannot clone recursive data-structure');\n\t\t}\n\t\tseen.add(obj);\n\t\tconst r2 = {};\n\t\tfor (let i2 in obj) {\n\t\t\tif (_hasOwnProperty.call(obj, i2)) {\n\t\t\t\t(r2 as any)[i2] = _cloneAndChange(obj[i2], changer, seen);\n\t\t\t}\n\t\t}\n\t\tseen.delete(obj);\n\t\treturn r2;\n\t}\n\n\treturn obj;\n}\n\n/**\n * Copies all properties of source into destination. The optional parameter \"overwrite\" allows to control\n * if existing properties on the destination should be overwritten or not. Defaults to true (overwrite).\n */\nexport function mixin(destination: any, source: any, overwrite: boolean = true): any {\n\tif (!isObject(destination)) {\n\t\treturn source;\n\t}\n\n\tif (isObject(source)) {\n\t\tObject.keys(source).forEach(key => {\n\t\t\tif (key in destination) {\n\t\t\t\tif (overwrite) {\n\t\t\t\t\tif (isObject(destination[key]) && isObject(source[key])) {\n\t\t\t\t\t\tmixin(destination[key], source[key], overwrite);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdestination[key] = source[key];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tdestination[key] = source[key];\n\t\t\t}\n\t\t});\n\t}\n\treturn destination;\n}\n\nexport function equals(one: any, other: any): boolean {\n\tif (one === other) {\n\t\treturn true;\n\t}\n\tif (one === null || one === undefined || other === null || other === undefined) {\n\t\treturn false;\n\t}\n\tif (typeof one !== typeof other) {\n\t\treturn false;\n\t}\n\tif (typeof one !== 'object') {\n\t\treturn false;\n\t}\n\tif ((Array.isArray(one)) !== (Array.isArray(other))) {\n\t\treturn false;\n\t}\n\n\tlet i: number;\n\tlet key: string;\n\n\tif (Array.isArray(one)) {\n\t\tif (one.length !== other.length) {\n\t\t\treturn false;\n\t\t}\n\t\tfor (i = 0; i < one.length; i++) {\n\t\t\tif (!equals(one[i], other[i])) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t} else {\n\t\tconst oneKeys: string[] = [];\n\n\t\tfor (key in one) {\n\t\t\toneKeys.push(key);\n\t\t}\n\t\toneKeys.sort();\n\t\tconst otherKeys: string[] = [];\n\t\tfor (key in other) {\n\t\t\totherKeys.push(key);\n\t\t}\n\t\totherKeys.sort();\n\t\tif (!equals(oneKeys, otherKeys)) {\n\t\t\treturn false;\n\t\t}\n\t\tfor (i = 0; i < oneKeys.length; i++) {\n\t\t\tif (!equals(one[oneKeys[i]], other[oneKeys[i]])) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\treturn true;\n}\n\n/**\n * Calls `JSON.Stringify` with a replacer to break apart any circular references.\n * This prevents `JSON`.stringify` from throwing the exception\n *  \"Uncaught TypeError: Converting circular structure to JSON\"\n */\nexport function safeStringify(obj: any): string {\n\tconst seen = new Set<any>();\n\treturn JSON.stringify(obj, (key, value) => {\n\t\tif (isObject(value) || Array.isArray(value)) {\n\t\t\tif (seen.has(value)) {\n\t\t\t\treturn '[Circular]';\n\t\t\t} else {\n\t\t\t\tseen.add(value);\n\t\t\t}\n\t\t}\n\t\treturn value;\n\t});\n}\n\nexport function getOrDefault<T, R>(obj: T, fn: (obj: T) => R | undefined, defaultValue: R): R {\n\tconst result = fn(obj);\n\treturn typeof result === 'undefined' ? defaultValue : result;\n}\n\ntype obj = { [key: string]: any; };\n/**\n * Returns an object that has keys for each value that is different in the base object. Keys\n * that do not exist in the target but in the base object are not considered.\n *\n * Note: This is not a deep-diffing method, so the values are strictly taken into the resulting\n * object if they differ.\n *\n * @param base the object to diff against\n * @param obj the object to use for diffing\n */\nexport function distinct(base: obj, target: obj): obj {\n\tconst result = Object.create(null);\n\n\tif (!base || !target) {\n\t\treturn result;\n\t}\n\n\tconst targetKeys = Object.keys(target);\n\ttargetKeys.forEach(k => {\n\t\tconst baseValue = base[k];\n\t\tconst targetValue = target[k];\n\n\t\tif (!equals(baseValue, targetValue)) {\n\t\t\tresult[k] = targetValue;\n\t\t}\n\t});\n\n\treturn result;\n}\n\nexport function getCaseInsensitive(target: obj, key: string): any {\n\tconst lowercaseKey = key.toLowerCase();\n\tconst equivalentKey = Object.keys(target).find(k => k.toLowerCase() === lowercaseKey);\n\treturn equivalentKey ? target[equivalentKey] : target[key];\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nexport const enum Constants {\n\t/**\n\t * MAX SMI (SMall Integer) as defined in v8.\n\t * one bit is lost for boxing/unboxing flag.\n\t * one bit is lost for sign flag.\n\t * See https://thibaultlaurens.github.io/javascript/2013/04/29/how-the-v8-engine-works/#tagged-values\n\t */\n\tMAX_SAFE_SMALL_INTEGER = 1 << 30,\n\n\t/**\n\t * MIN SMI (SMall Integer) as defined in v8.\n\t * one bit is lost for boxing/unboxing flag.\n\t * one bit is lost for sign flag.\n\t * See https://thibaultlaurens.github.io/javascript/2013/04/29/how-the-v8-engine-works/#tagged-values\n\t */\n\tMIN_SAFE_SMALL_INTEGER = -(1 << 30),\n\n\t/**\n\t * Max unsigned integer that fits on 8 bits.\n\t */\n\tMAX_UINT_8 = 255, // 2^8 - 1\n\n\t/**\n\t * Max unsigned integer that fits on 16 bits.\n\t */\n\tMAX_UINT_16 = 65535, // 2^16 - 1\n\n\t/**\n\t * Max unsigned integer that fits on 32 bits.\n\t */\n\tMAX_UINT_32 = 4294967295, // 2^32 - 1\n\n\tUNICODE_SUPPLEMENTARY_PLANE_BEGIN = 0x010000\n}\n\nexport function toUint8(v: number): number {\n\tif (v < 0) {\n\t\treturn 0;\n\t}\n\tif (v > Constants.MAX_UINT_8) {\n\t\treturn Constants.MAX_UINT_8;\n\t}\n\treturn v | 0;\n}\n\nexport function toUint32(v: number): number {\n\tif (v < 0) {\n\t\treturn 0;\n\t}\n\tif (v > Constants.MAX_UINT_32) {\n\t\treturn Constants.MAX_UINT_32;\n\t}\n\treturn v | 0;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { isWindows } from 'vs/base/common/platform';\nimport { CharCode } from 'vs/base/common/charCode';\nimport * as paths from 'vs/base/common/path';\n\nconst _schemePattern = /^\\w[\\w\\d+.-]*$/;\nconst _singleSlashStart = /^\\//;\nconst _doubleSlashStart = /^\\/\\//;\n\nfunction _validateUri(ret: URI, _strict?: boolean): void {\n\n\t// scheme, must be set\n\tif (!ret.scheme && _strict) {\n\t\tthrow new Error(`[UriError]: Scheme is missing: {scheme: \"\", authority: \"${ret.authority}\", path: \"${ret.path}\", query: \"${ret.query}\", fragment: \"${ret.fragment}\"}`);\n\t}\n\n\t// scheme, https://tools.ietf.org/html/rfc3986#section-3.1\n\t// ALPHA *( ALPHA / DIGIT / \"+\" / \"-\" / \".\" )\n\tif (ret.scheme && !_schemePattern.test(ret.scheme)) {\n\t\tthrow new Error('[UriError]: Scheme contains illegal characters.');\n\t}\n\n\t// path, http://tools.ietf.org/html/rfc3986#section-3.3\n\t// If a URI contains an authority component, then the path component\n\t// must either be empty or begin with a slash (\"/\") character.  If a URI\n\t// does not contain an authority component, then the path cannot begin\n\t// with two slash characters (\"//\").\n\tif (ret.path) {\n\t\tif (ret.authority) {\n\t\t\tif (!_singleSlashStart.test(ret.path)) {\n\t\t\t\tthrow new Error('[UriError]: If a URI contains an authority component, then the path component must either be empty or begin with a slash (\"/\") character');\n\t\t\t}\n\t\t} else {\n\t\t\tif (_doubleSlashStart.test(ret.path)) {\n\t\t\t\tthrow new Error('[UriError]: If a URI does not contain an authority component, then the path cannot begin with two slash characters (\"//\")');\n\t\t\t}\n\t\t}\n\t}\n}\n\n// for a while we allowed uris *without* schemes and this is the migration\n// for them, e.g. an uri without scheme and without strict-mode warns and falls\n// back to the file-scheme. that should cause the least carnage and still be a\n// clear warning\nfunction _schemeFix(scheme: string, _strict: boolean): string {\n\tif (!scheme && !_strict) {\n\t\treturn 'file';\n\t}\n\treturn scheme;\n}\n\n// implements a bit of https://tools.ietf.org/html/rfc3986#section-5\nfunction _referenceResolution(scheme: string, path: string): string {\n\n\t// the slash-character is our 'default base' as we don't\n\t// support constructing URIs relative to other URIs. This\n\t// also means that we alter and potentially break paths.\n\t// see https://tools.ietf.org/html/rfc3986#section-5.1.4\n\tswitch (scheme) {\n\t\tcase 'https':\n\t\tcase 'http':\n\t\tcase 'file':\n\t\t\tif (!path) {\n\t\t\t\tpath = _slash;\n\t\t\t} else if (path[0] !== _slash) {\n\t\t\t\tpath = _slash + path;\n\t\t\t}\n\t\t\tbreak;\n\t}\n\treturn path;\n}\n\nconst _empty = '';\nconst _slash = '/';\nconst _regexp = /^(([^:/?#]+?):)?(\\/\\/([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?/;\n\n/**\n * Uniform Resource Identifier (URI) http://tools.ietf.org/html/rfc3986.\n * This class is a simple parser which creates the basic component parts\n * (http://tools.ietf.org/html/rfc3986#section-3) with minimal validation\n * and encoding.\n *\n * ```txt\n *       foo://example.com:8042/over/there?name=ferret#nose\n *       \\_/   \\______________/\\_________/ \\_________/ \\__/\n *        |           |            |            |        |\n *     scheme     authority       path        query   fragment\n *        |   _____________________|__\n *       / \\ /                        \\\n *       urn:example:animal:ferret:nose\n * ```\n */\nexport class URI implements UriComponents {\n\n\tstatic isUri(thing: any): thing is URI {\n\t\tif (thing instanceof URI) {\n\t\t\treturn true;\n\t\t}\n\t\tif (!thing) {\n\t\t\treturn false;\n\t\t}\n\t\treturn typeof (<URI>thing).authority === 'string'\n\t\t\t&& typeof (<URI>thing).fragment === 'string'\n\t\t\t&& typeof (<URI>thing).path === 'string'\n\t\t\t&& typeof (<URI>thing).query === 'string'\n\t\t\t&& typeof (<URI>thing).scheme === 'string'\n\t\t\t&& typeof (<URI>thing).fsPath === 'string'\n\t\t\t&& typeof (<URI>thing).with === 'function'\n\t\t\t&& typeof (<URI>thing).toString === 'function';\n\t}\n\n\t/**\n\t * scheme is the 'http' part of 'http://www.msft.com/some/path?query#fragment'.\n\t * The part before the first colon.\n\t */\n\treadonly scheme: string;\n\n\t/**\n\t * authority is the 'www.msft.com' part of 'http://www.msft.com/some/path?query#fragment'.\n\t * The part between the first double slashes and the next slash.\n\t */\n\treadonly authority: string;\n\n\t/**\n\t * path is the '/some/path' part of 'http://www.msft.com/some/path?query#fragment'.\n\t */\n\treadonly path: string;\n\n\t/**\n\t * query is the 'query' part of 'http://www.msft.com/some/path?query#fragment'.\n\t */\n\treadonly query: string;\n\n\t/**\n\t * fragment is the 'fragment' part of 'http://www.msft.com/some/path?query#fragment'.\n\t */\n\treadonly fragment: string;\n\n\t/**\n\t * @internal\n\t */\n\tprotected constructor(scheme: string, authority?: string, path?: string, query?: string, fragment?: string, _strict?: boolean);\n\n\t/**\n\t * @internal\n\t */\n\tprotected constructor(components: UriComponents);\n\n\t/**\n\t * @internal\n\t */\n\tprotected constructor(schemeOrData: string | UriComponents, authority?: string, path?: string, query?: string, fragment?: string, _strict: boolean = false) {\n\n\t\tif (typeof schemeOrData === 'object') {\n\t\t\tthis.scheme = schemeOrData.scheme || _empty;\n\t\t\tthis.authority = schemeOrData.authority || _empty;\n\t\t\tthis.path = schemeOrData.path || _empty;\n\t\t\tthis.query = schemeOrData.query || _empty;\n\t\t\tthis.fragment = schemeOrData.fragment || _empty;\n\t\t\t// no validation because it's this URI\n\t\t\t// that creates uri components.\n\t\t\t// _validateUri(this);\n\t\t} else {\n\t\t\tthis.scheme = _schemeFix(schemeOrData, _strict);\n\t\t\tthis.authority = authority || _empty;\n\t\t\tthis.path = _referenceResolution(this.scheme, path || _empty);\n\t\t\tthis.query = query || _empty;\n\t\t\tthis.fragment = fragment || _empty;\n\n\t\t\t_validateUri(this, _strict);\n\t\t}\n\t}\n\n\t// ---- filesystem path -----------------------\n\n\t/**\n\t * Returns a string representing the corresponding file system path of this URI.\n\t * Will handle UNC paths, normalizes windows drive letters to lower-case, and uses the\n\t * platform specific path separator.\n\t *\n\t * * Will *not* validate the path for invalid characters and semantics.\n\t * * Will *not* look at the scheme of this URI.\n\t * * The result shall *not* be used for display purposes but for accessing a file on disk.\n\t *\n\t *\n\t * The *difference* to `URI#path` is the use of the platform specific separator and the handling\n\t * of UNC paths. See the below sample of a file-uri with an authority (UNC path).\n\t *\n\t * ```ts\n\t\tconst u = URI.parse('file://server/c$/folder/file.txt')\n\t\tu.authority === 'server'\n\t\tu.path === '/shares/c$/file.txt'\n\t\tu.fsPath === '\\\\server\\c$\\folder\\file.txt'\n\t```\n\t *\n\t * Using `URI#path` to read a file (using fs-apis) would not be enough because parts of the path,\n\t * namely the server name, would be missing. Therefore `URI#fsPath` exists - it's sugar to ease working\n\t * with URIs that represent files on disk (`file` scheme).\n\t */\n\tget fsPath(): string {\n\t\t// if (this.scheme !== 'file') {\n\t\t// \tconsole.warn(`[UriError] calling fsPath with scheme ${this.scheme}`);\n\t\t// }\n\t\treturn uriToFsPath(this, false);\n\t}\n\n\t// ---- modify to new -------------------------\n\n\twith(change: { scheme?: string; authority?: string | null; path?: string | null; query?: string | null; fragment?: string | null }): URI {\n\n\t\tif (!change) {\n\t\t\treturn this;\n\t\t}\n\n\t\tlet { scheme, authority, path, query, fragment } = change;\n\t\tif (scheme === undefined) {\n\t\t\tscheme = this.scheme;\n\t\t} else if (scheme === null) {\n\t\t\tscheme = _empty;\n\t\t}\n\t\tif (authority === undefined) {\n\t\t\tauthority = this.authority;\n\t\t} else if (authority === null) {\n\t\t\tauthority = _empty;\n\t\t}\n\t\tif (path === undefined) {\n\t\t\tpath = this.path;\n\t\t} else if (path === null) {\n\t\t\tpath = _empty;\n\t\t}\n\t\tif (query === undefined) {\n\t\t\tquery = this.query;\n\t\t} else if (query === null) {\n\t\t\tquery = _empty;\n\t\t}\n\t\tif (fragment === undefined) {\n\t\t\tfragment = this.fragment;\n\t\t} else if (fragment === null) {\n\t\t\tfragment = _empty;\n\t\t}\n\n\t\tif (scheme === this.scheme\n\t\t\t&& authority === this.authority\n\t\t\t&& path === this.path\n\t\t\t&& query === this.query\n\t\t\t&& fragment === this.fragment) {\n\n\t\t\treturn this;\n\t\t}\n\n\t\treturn new Uri(scheme, authority, path, query, fragment);\n\t}\n\n\t// ---- parse & validate ------------------------\n\n\t/**\n\t * Creates a new URI from a string, e.g. `http://www.msft.com/some/path`,\n\t * `file:///usr/home`, or `scheme:with/path`.\n\t *\n\t * @param value A string which represents an URI (see `URI#toString`).\n\t */\n\tstatic parse(value: string, _strict: boolean = false): URI {\n\t\tconst match = _regexp.exec(value);\n\t\tif (!match) {\n\t\t\treturn new Uri(_empty, _empty, _empty, _empty, _empty);\n\t\t}\n\t\treturn new Uri(\n\t\t\tmatch[2] || _empty,\n\t\t\tpercentDecode(match[4] || _empty),\n\t\t\tpercentDecode(match[5] || _empty),\n\t\t\tpercentDecode(match[7] || _empty),\n\t\t\tpercentDecode(match[9] || _empty),\n\t\t\t_strict\n\t\t);\n\t}\n\n\t/**\n\t * Creates a new URI from a file system path, e.g. `c:\\my\\files`,\n\t * `/usr/home`, or `\\\\server\\share\\some\\path`.\n\t *\n\t * The *difference* between `URI#parse` and `URI#file` is that the latter treats the argument\n\t * as path, not as stringified-uri. E.g. `URI.file(path)` is **not the same as**\n\t * `URI.parse('file://' + path)` because the path might contain characters that are\n\t * interpreted (# and ?). See the following sample:\n\t * ```ts\n\tconst good = URI.file('/coding/c#/project1');\n\tgood.scheme === 'file';\n\tgood.path === '/coding/c#/project1';\n\tgood.fragment === '';\n\tconst bad = URI.parse('file://' + '/coding/c#/project1');\n\tbad.scheme === 'file';\n\tbad.path === '/coding/c'; // path is now broken\n\tbad.fragment === '/project1';\n\t```\n\t *\n\t * @param path A file system path (see `URI#fsPath`)\n\t */\n\tstatic file(path: string): URI {\n\n\t\tlet authority = _empty;\n\n\t\t// normalize to fwd-slashes on windows,\n\t\t// on other systems bwd-slashes are valid\n\t\t// filename character, eg /f\\oo/ba\\r.txt\n\t\tif (isWindows) {\n\t\t\tpath = path.replace(/\\\\/g, _slash);\n\t\t}\n\n\t\t// check for authority as used in UNC shares\n\t\t// or use the path as given\n\t\tif (path[0] === _slash && path[1] === _slash) {\n\t\t\tconst idx = path.indexOf(_slash, 2);\n\t\t\tif (idx === -1) {\n\t\t\t\tauthority = path.substring(2);\n\t\t\t\tpath = _slash;\n\t\t\t} else {\n\t\t\t\tauthority = path.substring(2, idx);\n\t\t\t\tpath = path.substring(idx) || _slash;\n\t\t\t}\n\t\t}\n\n\t\treturn new Uri('file', authority, path, _empty, _empty);\n\t}\n\n\tstatic from(components: { scheme: string; authority?: string; path?: string; query?: string; fragment?: string }): URI {\n\t\treturn new Uri(\n\t\t\tcomponents.scheme,\n\t\t\tcomponents.authority,\n\t\t\tcomponents.path,\n\t\t\tcomponents.query,\n\t\t\tcomponents.fragment,\n\t\t);\n\t}\n\n\t/**\n\t * Join a URI path with path fragments and normalizes the resulting path.\n\t *\n\t * @param uri The input URI.\n\t * @param pathFragment The path fragment to add to the URI path.\n\t * @returns The resulting URI.\n\t */\n\tstatic joinPath(uri: URI, ...pathFragment: string[]): URI {\n\t\tif (!uri.path) {\n\t\t\tthrow new Error(`[UriError]: cannot call joinPath on URI without path`);\n\t\t}\n\t\tlet newPath: string;\n\t\tif (isWindows && uri.scheme === 'file') {\n\t\t\tnewPath = URI.file(paths.win32.join(uriToFsPath(uri, true), ...pathFragment)).path;\n\t\t} else {\n\t\t\tnewPath = paths.posix.join(uri.path, ...pathFragment);\n\t\t}\n\t\treturn uri.with({ path: newPath });\n\t}\n\n\t// ---- printing/externalize ---------------------------\n\n\t/**\n\t * Creates a string representation for this URI. It's guaranteed that calling\n\t * `URI.parse` with the result of this function creates an URI which is equal\n\t * to this URI.\n\t *\n\t * * The result shall *not* be used for display purposes but for externalization or transport.\n\t * * The result will be encoded using the percentage encoding and encoding happens mostly\n\t * ignore the scheme-specific encoding rules.\n\t *\n\t * @param skipEncoding Do not encode the result, default is `false`\n\t */\n\ttoString(skipEncoding: boolean = false): string {\n\t\treturn _asFormatted(this, skipEncoding);\n\t}\n\n\ttoJSON(): UriComponents {\n\t\treturn this;\n\t}\n\n\tstatic revive(data: UriComponents | URI): URI;\n\tstatic revive(data: UriComponents | URI | undefined): URI | undefined;\n\tstatic revive(data: UriComponents | URI | null): URI | null;\n\tstatic revive(data: UriComponents | URI | undefined | null): URI | undefined | null;\n\tstatic revive(data: UriComponents | URI | undefined | null): URI | undefined | null {\n\t\tif (!data) {\n\t\t\treturn data;\n\t\t} else if (data instanceof URI) {\n\t\t\treturn data;\n\t\t} else {\n\t\t\tconst result = new Uri(data);\n\t\t\tresult._formatted = (<UriState>data).external;\n\t\t\tresult._fsPath = (<UriState>data)._sep === _pathSepMarker ? (<UriState>data).fsPath : null;\n\t\t\treturn result;\n\t\t}\n\t}\n}\n\nexport interface UriComponents {\n\tscheme: string;\n\tauthority: string;\n\tpath: string;\n\tquery: string;\n\tfragment: string;\n}\n\ninterface UriState extends UriComponents {\n\t$mid: number;\n\texternal: string;\n\tfsPath: string;\n\t_sep: 1 | undefined;\n}\n\nconst _pathSepMarker = isWindows ? 1 : undefined;\n\n// This class exists so that URI is compatibile with vscode.Uri (API).\nclass Uri extends URI {\n\n\t_formatted: string | null = null;\n\t_fsPath: string | null = null;\n\n\tget fsPath(): string {\n\t\tif (!this._fsPath) {\n\t\t\tthis._fsPath = uriToFsPath(this, false);\n\t\t}\n\t\treturn this._fsPath;\n\t}\n\n\ttoString(skipEncoding: boolean = false): string {\n\t\tif (!skipEncoding) {\n\t\t\tif (!this._formatted) {\n\t\t\t\tthis._formatted = _asFormatted(this, false);\n\t\t\t}\n\t\t\treturn this._formatted;\n\t\t} else {\n\t\t\t// we don't cache that\n\t\t\treturn _asFormatted(this, true);\n\t\t}\n\t}\n\n\ttoJSON(): UriComponents {\n\t\tconst res = <UriState>{\n\t\t\t$mid: 1\n\t\t};\n\t\t// cached state\n\t\tif (this._fsPath) {\n\t\t\tres.fsPath = this._fsPath;\n\t\t\tres._sep = _pathSepMarker;\n\t\t}\n\t\tif (this._formatted) {\n\t\t\tres.external = this._formatted;\n\t\t}\n\t\t// uri components\n\t\tif (this.path) {\n\t\t\tres.path = this.path;\n\t\t}\n\t\tif (this.scheme) {\n\t\t\tres.scheme = this.scheme;\n\t\t}\n\t\tif (this.authority) {\n\t\t\tres.authority = this.authority;\n\t\t}\n\t\tif (this.query) {\n\t\t\tres.query = this.query;\n\t\t}\n\t\tif (this.fragment) {\n\t\t\tres.fragment = this.fragment;\n\t\t}\n\t\treturn res;\n\t}\n}\n\n// reserved characters: https://tools.ietf.org/html/rfc3986#section-2.2\nconst encodeTable: { [ch: number]: string } = {\n\t[CharCode.Colon]: '%3A', // gen-delims\n\t[CharCode.Slash]: '%2F',\n\t[CharCode.QuestionMark]: '%3F',\n\t[CharCode.Hash]: '%23',\n\t[CharCode.OpenSquareBracket]: '%5B',\n\t[CharCode.CloseSquareBracket]: '%5D',\n\t[CharCode.AtSign]: '%40',\n\n\t[CharCode.ExclamationMark]: '%21', // sub-delims\n\t[CharCode.DollarSign]: '%24',\n\t[CharCode.Ampersand]: '%26',\n\t[CharCode.SingleQuote]: '%27',\n\t[CharCode.OpenParen]: '%28',\n\t[CharCode.CloseParen]: '%29',\n\t[CharCode.Asterisk]: '%2A',\n\t[CharCode.Plus]: '%2B',\n\t[CharCode.Comma]: '%2C',\n\t[CharCode.Semicolon]: '%3B',\n\t[CharCode.Equals]: '%3D',\n\n\t[CharCode.Space]: '%20',\n};\n\nfunction encodeURIComponentFast(uriComponent: string, allowSlash: boolean): string {\n\tlet res: string | undefined = undefined;\n\tlet nativeEncodePos = -1;\n\n\tfor (let pos = 0; pos < uriComponent.length; pos++) {\n\t\tconst code = uriComponent.charCodeAt(pos);\n\n\t\t// unreserved characters: https://tools.ietf.org/html/rfc3986#section-2.3\n\t\tif (\n\t\t\t(code >= CharCode.a && code <= CharCode.z)\n\t\t\t|| (code >= CharCode.A && code <= CharCode.Z)\n\t\t\t|| (code >= CharCode.Digit0 && code <= CharCode.Digit9)\n\t\t\t|| code === CharCode.Dash\n\t\t\t|| code === CharCode.Period\n\t\t\t|| code === CharCode.Underline\n\t\t\t|| code === CharCode.Tilde\n\t\t\t|| (allowSlash && code === CharCode.Slash)\n\t\t) {\n\t\t\t// check if we are delaying native encode\n\t\t\tif (nativeEncodePos !== -1) {\n\t\t\t\tres += encodeURIComponent(uriComponent.substring(nativeEncodePos, pos));\n\t\t\t\tnativeEncodePos = -1;\n\t\t\t}\n\t\t\t// check if we write into a new string (by default we try to return the param)\n\t\t\tif (res !== undefined) {\n\t\t\t\tres += uriComponent.charAt(pos);\n\t\t\t}\n\n\t\t} else {\n\t\t\t// encoding needed, we need to allocate a new string\n\t\t\tif (res === undefined) {\n\t\t\t\tres = uriComponent.substr(0, pos);\n\t\t\t}\n\n\t\t\t// check with default table first\n\t\t\tconst escaped = encodeTable[code];\n\t\t\tif (escaped !== undefined) {\n\n\t\t\t\t// check if we are delaying native encode\n\t\t\t\tif (nativeEncodePos !== -1) {\n\t\t\t\t\tres += encodeURIComponent(uriComponent.substring(nativeEncodePos, pos));\n\t\t\t\t\tnativeEncodePos = -1;\n\t\t\t\t}\n\n\t\t\t\t// append escaped variant to result\n\t\t\t\tres += escaped;\n\n\t\t\t} else if (nativeEncodePos === -1) {\n\t\t\t\t// use native encode only when needed\n\t\t\t\tnativeEncodePos = pos;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (nativeEncodePos !== -1) {\n\t\tres += encodeURIComponent(uriComponent.substring(nativeEncodePos));\n\t}\n\n\treturn res !== undefined ? res : uriComponent;\n}\n\nfunction encodeURIComponentMinimal(path: string): string {\n\tlet res: string | undefined = undefined;\n\tfor (let pos = 0; pos < path.length; pos++) {\n\t\tconst code = path.charCodeAt(pos);\n\t\tif (code === CharCode.Hash || code === CharCode.QuestionMark) {\n\t\t\tif (res === undefined) {\n\t\t\t\tres = path.substr(0, pos);\n\t\t\t}\n\t\t\tres += encodeTable[code];\n\t\t} else {\n\t\t\tif (res !== undefined) {\n\t\t\t\tres += path[pos];\n\t\t\t}\n\t\t}\n\t}\n\treturn res !== undefined ? res : path;\n}\n\n/**\n * Compute `fsPath` for the given uri\n */\nexport function uriToFsPath(uri: URI, keepDriveLetterCasing: boolean): string {\n\n\tlet value: string;\n\tif (uri.authority && uri.path.length > 1 && uri.scheme === 'file') {\n\t\t// unc path: file://shares/c$/far/boo\n\t\tvalue = `//${uri.authority}${uri.path}`;\n\t} else if (\n\t\turi.path.charCodeAt(0) === CharCode.Slash\n\t\t&& (uri.path.charCodeAt(1) >= CharCode.A && uri.path.charCodeAt(1) <= CharCode.Z || uri.path.charCodeAt(1) >= CharCode.a && uri.path.charCodeAt(1) <= CharCode.z)\n\t\t&& uri.path.charCodeAt(2) === CharCode.Colon\n\t) {\n\t\tif (!keepDriveLetterCasing) {\n\t\t\t// windows drive letter: file:///c:/far/boo\n\t\t\tvalue = uri.path[1].toLowerCase() + uri.path.substr(2);\n\t\t} else {\n\t\t\tvalue = uri.path.substr(1);\n\t\t}\n\t} else {\n\t\t// other path\n\t\tvalue = uri.path;\n\t}\n\tif (isWindows) {\n\t\tvalue = value.replace(/\\//g, '\\\\');\n\t}\n\treturn value;\n}\n\n/**\n * Create the external version of a uri\n */\nfunction _asFormatted(uri: URI, skipEncoding: boolean): string {\n\n\tconst encoder = !skipEncoding\n\t\t? encodeURIComponentFast\n\t\t: encodeURIComponentMinimal;\n\n\tlet res = '';\n\tlet { scheme, authority, path, query, fragment } = uri;\n\tif (scheme) {\n\t\tres += scheme;\n\t\tres += ':';\n\t}\n\tif (authority || scheme === 'file') {\n\t\tres += _slash;\n\t\tres += _slash;\n\t}\n\tif (authority) {\n\t\tlet idx = authority.indexOf('@');\n\t\tif (idx !== -1) {\n\t\t\t// <user>@<auth>\n\t\t\tconst userinfo = authority.substr(0, idx);\n\t\t\tauthority = authority.substr(idx + 1);\n\t\t\tidx = userinfo.indexOf(':');\n\t\t\tif (idx === -1) {\n\t\t\t\tres += encoder(userinfo, false);\n\t\t\t} else {\n\t\t\t\t// <user>:<pass>@<auth>\n\t\t\t\tres += encoder(userinfo.substr(0, idx), false);\n\t\t\t\tres += ':';\n\t\t\t\tres += encoder(userinfo.substr(idx + 1), false);\n\t\t\t}\n\t\t\tres += '@';\n\t\t}\n\t\tauthority = authority.toLowerCase();\n\t\tidx = authority.indexOf(':');\n\t\tif (idx === -1) {\n\t\t\tres += encoder(authority, false);\n\t\t} else {\n\t\t\t// <auth>:<port>\n\t\t\tres += encoder(authority.substr(0, idx), false);\n\t\t\tres += authority.substr(idx);\n\t\t}\n\t}\n\tif (path) {\n\t\t// lower-case windows drive letters in /C:/fff or C:/fff\n\t\tif (path.length >= 3 && path.charCodeAt(0) === CharCode.Slash && path.charCodeAt(2) === CharCode.Colon) {\n\t\t\tconst code = path.charCodeAt(1);\n\t\t\tif (code >= CharCode.A && code <= CharCode.Z) {\n\t\t\t\tpath = `/${String.fromCharCode(code + 32)}:${path.substr(3)}`; // \"/c:\".length === 3\n\t\t\t}\n\t\t} else if (path.length >= 2 && path.charCodeAt(1) === CharCode.Colon) {\n\t\t\tconst code = path.charCodeAt(0);\n\t\t\tif (code >= CharCode.A && code <= CharCode.Z) {\n\t\t\t\tpath = `${String.fromCharCode(code + 32)}:${path.substr(2)}`; // \"/c:\".length === 3\n\t\t\t}\n\t\t}\n\t\t// encode the rest of the path\n\t\tres += encoder(path, true);\n\t}\n\tif (query) {\n\t\tres += '?';\n\t\tres += encoder(query, false);\n\t}\n\tif (fragment) {\n\t\tres += '#';\n\t\tres += !skipEncoding ? encodeURIComponentFast(fragment, false) : fragment;\n\t}\n\treturn res;\n}\n\n// --- decode\n\nfunction decodeURIComponentGraceful(str: string): string {\n\ttry {\n\t\treturn decodeURIComponent(str);\n\t} catch {\n\t\tif (str.length > 3) {\n\t\t\treturn str.substr(0, 3) + decodeURIComponentGraceful(str.substr(3));\n\t\t} else {\n\t\t\treturn str;\n\t\t}\n\t}\n}\n\nconst _rEncodedAsHex = /(%[0-9A-Za-z][0-9A-Za-z])+/g;\n\nfunction percentDecode(str: string): string {\n\tif (!str.match(_rEncodedAsHex)) {\n\t\treturn str;\n\t}\n\treturn str.replace(_rEncodedAsHex, (match) => decodeURIComponentGraceful(match));\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from 'vs/base/common/uri';\nimport { CharCode } from 'vs/base/common/charCode';\nimport { compareSubstringIgnoreCase, compare, compareSubstring, compareIgnoreCase } from 'vs/base/common/strings';\n\nexport function getOrSet<K, V>(map: Map<K, V>, key: K, value: V): V {\n\tlet result = map.get(key);\n\tif (result === undefined) {\n\t\tresult = value;\n\t\tmap.set(key, result);\n\t}\n\n\treturn result;\n}\n\nexport function mapToString<K, V>(map: Map<K, V>): string {\n\tconst entries: string[] = [];\n\tmap.forEach((value, key) => {\n\t\tentries.push(`${key} => ${value}`);\n\t});\n\n\treturn `Map(${map.size}) {${entries.join(', ')}}`;\n}\n\nexport function setToString<K>(set: Set<K>): string {\n\tconst entries: K[] = [];\n\tset.forEach(value => {\n\t\tentries.push(value);\n\t});\n\n\treturn `Set(${set.size}) {${entries.join(', ')}}`;\n}\n\nexport interface IKeyIterator<K> {\n\treset(key: K): this;\n\tnext(): this;\n\n\thasNext(): boolean;\n\tcmp(a: string): number;\n\tvalue(): string;\n}\n\nexport class StringIterator implements IKeyIterator<string> {\n\n\tprivate _value: string = '';\n\tprivate _pos: number = 0;\n\n\treset(key: string): this {\n\t\tthis._value = key;\n\t\tthis._pos = 0;\n\t\treturn this;\n\t}\n\n\tnext(): this {\n\t\tthis._pos += 1;\n\t\treturn this;\n\t}\n\n\thasNext(): boolean {\n\t\treturn this._pos < this._value.length - 1;\n\t}\n\n\tcmp(a: string): number {\n\t\tconst aCode = a.charCodeAt(0);\n\t\tconst thisCode = this._value.charCodeAt(this._pos);\n\t\treturn aCode - thisCode;\n\t}\n\n\tvalue(): string {\n\t\treturn this._value[this._pos];\n\t}\n}\n\nexport class ConfigKeysIterator implements IKeyIterator<string> {\n\n\tprivate _value!: string;\n\tprivate _from!: number;\n\tprivate _to!: number;\n\n\tconstructor(\n\t\tprivate readonly _caseSensitive: boolean = true\n\t) { }\n\n\treset(key: string): this {\n\t\tthis._value = key;\n\t\tthis._from = 0;\n\t\tthis._to = 0;\n\t\treturn this.next();\n\t}\n\n\thasNext(): boolean {\n\t\treturn this._to < this._value.length;\n\t}\n\n\tnext(): this {\n\t\t// this._data = key.split(/[\\\\/]/).filter(s => !!s);\n\t\tthis._from = this._to;\n\t\tlet justSeps = true;\n\t\tfor (; this._to < this._value.length; this._to++) {\n\t\t\tconst ch = this._value.charCodeAt(this._to);\n\t\t\tif (ch === CharCode.Period) {\n\t\t\t\tif (justSeps) {\n\t\t\t\t\tthis._from++;\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tjustSeps = false;\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\tcmp(a: string): number {\n\t\treturn this._caseSensitive\n\t\t\t? compareSubstring(a, this._value, 0, a.length, this._from, this._to)\n\t\t\t: compareSubstringIgnoreCase(a, this._value, 0, a.length, this._from, this._to);\n\t}\n\n\tvalue(): string {\n\t\treturn this._value.substring(this._from, this._to);\n\t}\n}\n\nexport class PathIterator implements IKeyIterator<string> {\n\n\tprivate _value!: string;\n\tprivate _from!: number;\n\tprivate _to!: number;\n\n\tconstructor(\n\t\tprivate readonly _splitOnBackslash: boolean = true,\n\t\tprivate readonly _caseSensitive: boolean = true\n\t) { }\n\n\treset(key: string): this {\n\t\tthis._value = key.replace(/\\\\$|\\/$/, '');\n\t\tthis._from = 0;\n\t\tthis._to = 0;\n\t\treturn this.next();\n\t}\n\n\thasNext(): boolean {\n\t\treturn this._to < this._value.length;\n\t}\n\n\tnext(): this {\n\t\t// this._data = key.split(/[\\\\/]/).filter(s => !!s);\n\t\tthis._from = this._to;\n\t\tlet justSeps = true;\n\t\tfor (; this._to < this._value.length; this._to++) {\n\t\t\tconst ch = this._value.charCodeAt(this._to);\n\t\t\tif (ch === CharCode.Slash || this._splitOnBackslash && ch === CharCode.Backslash) {\n\t\t\t\tif (justSeps) {\n\t\t\t\t\tthis._from++;\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tjustSeps = false;\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\tcmp(a: string): number {\n\t\treturn this._caseSensitive\n\t\t\t? compareSubstring(a, this._value, 0, a.length, this._from, this._to)\n\t\t\t: compareSubstringIgnoreCase(a, this._value, 0, a.length, this._from, this._to);\n\t}\n\n\tvalue(): string {\n\t\treturn this._value.substring(this._from, this._to);\n\t}\n}\n\nconst enum UriIteratorState {\n\tScheme = 1, Authority = 2, Path = 3, Query = 4, Fragment = 5\n}\n\nexport class UriIterator implements IKeyIterator<URI> {\n\n\tprivate _pathIterator!: PathIterator;\n\tprivate _value!: URI;\n\tprivate _states: UriIteratorState[] = [];\n\tprivate _stateIdx: number = 0;\n\n\tconstructor(private readonly _ignorePathCasing: (uri: URI) => boolean) { }\n\n\treset(key: URI): this {\n\t\tthis._value = key;\n\t\tthis._states = [];\n\t\tif (this._value.scheme) {\n\t\t\tthis._states.push(UriIteratorState.Scheme);\n\t\t}\n\t\tif (this._value.authority) {\n\t\t\tthis._states.push(UriIteratorState.Authority);\n\t\t}\n\t\tif (this._value.path) {\n\t\t\tthis._pathIterator = new PathIterator(false, !this._ignorePathCasing(key));\n\t\t\tthis._pathIterator.reset(key.path);\n\t\t\tif (this._pathIterator.value()) {\n\t\t\t\tthis._states.push(UriIteratorState.Path);\n\t\t\t}\n\t\t}\n\t\tif (this._value.query) {\n\t\t\tthis._states.push(UriIteratorState.Query);\n\t\t}\n\t\tif (this._value.fragment) {\n\t\t\tthis._states.push(UriIteratorState.Fragment);\n\t\t}\n\t\tthis._stateIdx = 0;\n\t\treturn this;\n\t}\n\n\tnext(): this {\n\t\tif (this._states[this._stateIdx] === UriIteratorState.Path && this._pathIterator.hasNext()) {\n\t\t\tthis._pathIterator.next();\n\t\t} else {\n\t\t\tthis._stateIdx += 1;\n\t\t}\n\t\treturn this;\n\t}\n\n\thasNext(): boolean {\n\t\treturn (this._states[this._stateIdx] === UriIteratorState.Path && this._pathIterator.hasNext())\n\t\t\t|| this._stateIdx < this._states.length - 1;\n\t}\n\n\tcmp(a: string): number {\n\t\tif (this._states[this._stateIdx] === UriIteratorState.Scheme) {\n\t\t\treturn compareIgnoreCase(a, this._value.scheme);\n\t\t} else if (this._states[this._stateIdx] === UriIteratorState.Authority) {\n\t\t\treturn compareIgnoreCase(a, this._value.authority);\n\t\t} else if (this._states[this._stateIdx] === UriIteratorState.Path) {\n\t\t\treturn this._pathIterator.cmp(a);\n\t\t} else if (this._states[this._stateIdx] === UriIteratorState.Query) {\n\t\t\treturn compare(a, this._value.query);\n\t\t} else if (this._states[this._stateIdx] === UriIteratorState.Fragment) {\n\t\t\treturn compare(a, this._value.fragment);\n\t\t}\n\t\tthrow new Error();\n\t}\n\n\tvalue(): string {\n\t\tif (this._states[this._stateIdx] === UriIteratorState.Scheme) {\n\t\t\treturn this._value.scheme;\n\t\t} else if (this._states[this._stateIdx] === UriIteratorState.Authority) {\n\t\t\treturn this._value.authority;\n\t\t} else if (this._states[this._stateIdx] === UriIteratorState.Path) {\n\t\t\treturn this._pathIterator.value();\n\t\t} else if (this._states[this._stateIdx] === UriIteratorState.Query) {\n\t\t\treturn this._value.query;\n\t\t} else if (this._states[this._stateIdx] === UriIteratorState.Fragment) {\n\t\t\treturn this._value.fragment;\n\t\t}\n\t\tthrow new Error();\n\t}\n}\n\nclass TernarySearchTreeNode<K, V> {\n\tsegment!: string;\n\tvalue: V | undefined;\n\tkey!: K;\n\tleft: TernarySearchTreeNode<K, V> | undefined;\n\tmid: TernarySearchTreeNode<K, V> | undefined;\n\tright: TernarySearchTreeNode<K, V> | undefined;\n\n\tisEmpty(): boolean {\n\t\treturn !this.left && !this.mid && !this.right && !this.value;\n\t}\n}\n\nexport class TernarySearchTree<K, V> {\n\n\tstatic forUris<E>(ignorePathCasing: (key: URI) => boolean = () => false): TernarySearchTree<URI, E> {\n\t\treturn new TernarySearchTree<URI, E>(new UriIterator(ignorePathCasing));\n\t}\n\n\tstatic forPaths<E>(): TernarySearchTree<string, E> {\n\t\treturn new TernarySearchTree<string, E>(new PathIterator());\n\t}\n\n\tstatic forStrings<E>(): TernarySearchTree<string, E> {\n\t\treturn new TernarySearchTree<string, E>(new StringIterator());\n\t}\n\n\tstatic forConfigKeys<E>(): TernarySearchTree<string, E> {\n\t\treturn new TernarySearchTree<string, E>(new ConfigKeysIterator());\n\t}\n\n\tprivate _iter: IKeyIterator<K>;\n\tprivate _root: TernarySearchTreeNode<K, V> | undefined;\n\n\tconstructor(segments: IKeyIterator<K>) {\n\t\tthis._iter = segments;\n\t}\n\n\tclear(): void {\n\t\tthis._root = undefined;\n\t}\n\n\tset(key: K, element: V): V | undefined {\n\t\tconst iter = this._iter.reset(key);\n\t\tlet node: TernarySearchTreeNode<K, V>;\n\n\t\tif (!this._root) {\n\t\t\tthis._root = new TernarySearchTreeNode<K, V>();\n\t\t\tthis._root.segment = iter.value();\n\t\t}\n\n\t\tnode = this._root;\n\t\twhile (true) {\n\t\t\tconst val = iter.cmp(node.segment);\n\t\t\tif (val > 0) {\n\t\t\t\t// left\n\t\t\t\tif (!node.left) {\n\t\t\t\t\tnode.left = new TernarySearchTreeNode<K, V>();\n\t\t\t\t\tnode.left.segment = iter.value();\n\t\t\t\t}\n\t\t\t\tnode = node.left;\n\n\t\t\t} else if (val < 0) {\n\t\t\t\t// right\n\t\t\t\tif (!node.right) {\n\t\t\t\t\tnode.right = new TernarySearchTreeNode<K, V>();\n\t\t\t\t\tnode.right.segment = iter.value();\n\t\t\t\t}\n\t\t\t\tnode = node.right;\n\n\t\t\t} else if (iter.hasNext()) {\n\t\t\t\t// mid\n\t\t\t\titer.next();\n\t\t\t\tif (!node.mid) {\n\t\t\t\t\tnode.mid = new TernarySearchTreeNode<K, V>();\n\t\t\t\t\tnode.mid.segment = iter.value();\n\t\t\t\t}\n\t\t\t\tnode = node.mid;\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tconst oldElement = node.value;\n\t\tnode.value = element;\n\t\tnode.key = key;\n\t\treturn oldElement;\n\t}\n\n\tget(key: K): V | undefined {\n\t\treturn this._getNode(key)?.value;\n\t}\n\n\tprivate _getNode(key: K) {\n\t\tconst iter = this._iter.reset(key);\n\t\tlet node = this._root;\n\t\twhile (node) {\n\t\t\tconst val = iter.cmp(node.segment);\n\t\t\tif (val > 0) {\n\t\t\t\t// left\n\t\t\t\tnode = node.left;\n\t\t\t} else if (val < 0) {\n\t\t\t\t// right\n\t\t\t\tnode = node.right;\n\t\t\t} else if (iter.hasNext()) {\n\t\t\t\t// mid\n\t\t\t\titer.next();\n\t\t\t\tnode = node.mid;\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn node;\n\t}\n\n\thas(key: K): boolean {\n\t\tconst node = this._getNode(key);\n\t\treturn !(node?.value === undefined && node?.mid === undefined);\n\t}\n\n\tdelete(key: K): void {\n\t\treturn this._delete(key, false);\n\t}\n\n\tdeleteSuperstr(key: K): void {\n\t\treturn this._delete(key, true);\n\t}\n\n\tprivate _delete(key: K, superStr: boolean): void {\n\t\tconst iter = this._iter.reset(key);\n\t\tconst stack: [-1 | 0 | 1, TernarySearchTreeNode<K, V>][] = [];\n\t\tlet node = this._root;\n\n\t\t// find and unset node\n\t\twhile (node) {\n\t\t\tconst val = iter.cmp(node.segment);\n\t\t\tif (val > 0) {\n\t\t\t\t// left\n\t\t\t\tstack.push([1, node]);\n\t\t\t\tnode = node.left;\n\t\t\t} else if (val < 0) {\n\t\t\t\t// right\n\t\t\t\tstack.push([-1, node]);\n\t\t\t\tnode = node.right;\n\t\t\t} else if (iter.hasNext()) {\n\t\t\t\t// mid\n\t\t\t\titer.next();\n\t\t\t\tstack.push([0, node]);\n\t\t\t\tnode = node.mid;\n\t\t\t} else {\n\t\t\t\tif (superStr) {\n\t\t\t\t\t// remove children\n\t\t\t\t\tnode.left = undefined;\n\t\t\t\t\tnode.mid = undefined;\n\t\t\t\t\tnode.right = undefined;\n\t\t\t\t} else {\n\t\t\t\t\t// remove element\n\t\t\t\t\tnode.value = undefined;\n\t\t\t\t}\n\n\t\t\t\t// clean up empty nodes\n\t\t\t\twhile (stack.length > 0 && node.isEmpty()) {\n\t\t\t\t\tlet [dir, parent] = stack.pop()!;\n\t\t\t\t\tswitch (dir) {\n\t\t\t\t\t\tcase 1: parent.left = undefined; break;\n\t\t\t\t\t\tcase 0: parent.mid = undefined; break;\n\t\t\t\t\t\tcase -1: parent.right = undefined; break;\n\t\t\t\t\t}\n\t\t\t\t\tnode = parent;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tfindSubstr(key: K): V | undefined {\n\t\tconst iter = this._iter.reset(key);\n\t\tlet node = this._root;\n\t\tlet candidate: V | undefined = undefined;\n\t\twhile (node) {\n\t\t\tconst val = iter.cmp(node.segment);\n\t\t\tif (val > 0) {\n\t\t\t\t// left\n\t\t\t\tnode = node.left;\n\t\t\t} else if (val < 0) {\n\t\t\t\t// right\n\t\t\t\tnode = node.right;\n\t\t\t} else if (iter.hasNext()) {\n\t\t\t\t// mid\n\t\t\t\titer.next();\n\t\t\t\tcandidate = node.value || candidate;\n\t\t\t\tnode = node.mid;\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn node && node.value || candidate;\n\t}\n\n\tfindSuperstr(key: K): IterableIterator<[K, V]> | undefined {\n\t\tconst iter = this._iter.reset(key);\n\t\tlet node = this._root;\n\t\twhile (node) {\n\t\t\tconst val = iter.cmp(node.segment);\n\t\t\tif (val > 0) {\n\t\t\t\t// left\n\t\t\t\tnode = node.left;\n\t\t\t} else if (val < 0) {\n\t\t\t\t// right\n\t\t\t\tnode = node.right;\n\t\t\t} else if (iter.hasNext()) {\n\t\t\t\t// mid\n\t\t\t\titer.next();\n\t\t\t\tnode = node.mid;\n\t\t\t} else {\n\t\t\t\t// collect\n\t\t\t\tif (!node.mid) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t} else {\n\t\t\t\t\treturn this._entries(node.mid);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tforEach(callback: (value: V, index: K) => any): void {\n\t\tfor (const [key, value] of this) {\n\t\t\tcallback(value, key);\n\t\t}\n\t}\n\n\t*[Symbol.iterator](): IterableIterator<[K, V]> {\n\t\tyield* this._entries(this._root);\n\t}\n\n\tprivate *_entries(node: TernarySearchTreeNode<K, V> | undefined): IterableIterator<[K, V]> {\n\t\tif (node) {\n\t\t\t// left\n\t\t\tyield* this._entries(node.left);\n\n\t\t\t// node\n\t\t\tif (node.value) {\n\t\t\t\t// callback(node.value, this._iter.join(parts));\n\t\t\t\tyield [node.key, node.value];\n\t\t\t}\n\t\t\t// mid\n\t\t\tyield* this._entries(node.mid);\n\n\t\t\t// right\n\t\t\tyield* this._entries(node.right);\n\t\t}\n\t}\n}\n\ninterface ResourceMapKeyFn {\n\t(resource: URI): string;\n}\n\nexport class ResourceMap<T> implements Map<URI, T> {\n\n\tprivate static readonly defaultToKey = (resource: URI) => resource.toString();\n\n\treadonly [Symbol.toStringTag] = 'ResourceMap';\n\n\tprivate readonly map: Map<string, T>;\n\tprivate readonly toKey: ResourceMapKeyFn;\n\n\t/**\n\t *\n\t * @param toKey Custom uri identity function, e.g use an existing `IExtUri#getComparison`-util\n\t */\n\tconstructor(toKey?: ResourceMapKeyFn);\n\n\t/**\n\t *\n\t * @param other Another resource which this maps is created from\n\t * @param toKey Custom uri identity function, e.g use an existing `IExtUri#getComparison`-util\n\t */\n\tconstructor(other?: ResourceMap<T>, toKey?: ResourceMapKeyFn);\n\n\tconstructor(mapOrKeyFn?: ResourceMap<T> | ResourceMapKeyFn, toKey?: ResourceMapKeyFn) {\n\t\tif (mapOrKeyFn instanceof ResourceMap) {\n\t\t\tthis.map = new Map(mapOrKeyFn.map);\n\t\t\tthis.toKey = toKey ?? ResourceMap.defaultToKey;\n\t\t} else {\n\t\t\tthis.map = new Map();\n\t\t\tthis.toKey = mapOrKeyFn ?? ResourceMap.defaultToKey;\n\t\t}\n\t}\n\n\tset(resource: URI, value: T): this {\n\t\tthis.map.set(this.toKey(resource), value);\n\t\treturn this;\n\t}\n\n\tget(resource: URI): T | undefined {\n\t\treturn this.map.get(this.toKey(resource));\n\t}\n\n\thas(resource: URI): boolean {\n\t\treturn this.map.has(this.toKey(resource));\n\t}\n\n\tget size(): number {\n\t\treturn this.map.size;\n\t}\n\n\tclear(): void {\n\t\tthis.map.clear();\n\t}\n\n\tdelete(resource: URI): boolean {\n\t\treturn this.map.delete(this.toKey(resource));\n\t}\n\n\tforEach(clb: (value: T, key: URI, map: Map<URI, T>) => void, thisArg?: any): void {\n\t\tif (typeof thisArg !== 'undefined') {\n\t\t\tclb = clb.bind(thisArg);\n\t\t}\n\t\tfor (let [index, value] of this.map) {\n\t\t\tclb(value, URI.parse(index), <any>this);\n\t\t}\n\t}\n\n\tvalues(): IterableIterator<T> {\n\t\treturn this.map.values();\n\t}\n\n\t*keys(): IterableIterator<URI> {\n\t\tfor (let key of this.map.keys()) {\n\t\t\tyield URI.parse(key);\n\t\t}\n\t}\n\n\t*entries(): IterableIterator<[URI, T]> {\n\t\tfor (let tuple of this.map.entries()) {\n\t\t\tyield [URI.parse(tuple[0]), tuple[1]];\n\t\t}\n\t}\n\n\t*[Symbol.iterator](): IterableIterator<[URI, T]> {\n\t\tfor (let item of this.map) {\n\t\t\tyield [URI.parse(item[0]), item[1]];\n\t\t}\n\t}\n}\n\ninterface Item<K, V> {\n\tprevious: Item<K, V> | undefined;\n\tnext: Item<K, V> | undefined;\n\tkey: K;\n\tvalue: V;\n}\n\nexport const enum Touch {\n\tNone = 0,\n\tAsOld = 1,\n\tAsNew = 2\n}\n\nexport class LinkedMap<K, V> implements Map<K, V> {\n\n\treadonly [Symbol.toStringTag] = 'LinkedMap';\n\n\tprivate _map: Map<K, Item<K, V>>;\n\tprivate _head: Item<K, V> | undefined;\n\tprivate _tail: Item<K, V> | undefined;\n\tprivate _size: number;\n\n\tprivate _state: number;\n\n\tconstructor() {\n\t\tthis._map = new Map<K, Item<K, V>>();\n\t\tthis._head = undefined;\n\t\tthis._tail = undefined;\n\t\tthis._size = 0;\n\t\tthis._state = 0;\n\t}\n\n\tclear(): void {\n\t\tthis._map.clear();\n\t\tthis._head = undefined;\n\t\tthis._tail = undefined;\n\t\tthis._size = 0;\n\t\tthis._state++;\n\t}\n\n\tisEmpty(): boolean {\n\t\treturn !this._head && !this._tail;\n\t}\n\n\tget size(): number {\n\t\treturn this._size;\n\t}\n\n\tget first(): V | undefined {\n\t\treturn this._head?.value;\n\t}\n\n\tget last(): V | undefined {\n\t\treturn this._tail?.value;\n\t}\n\n\thas(key: K): boolean {\n\t\treturn this._map.has(key);\n\t}\n\n\tget(key: K, touch: Touch = Touch.None): V | undefined {\n\t\tconst item = this._map.get(key);\n\t\tif (!item) {\n\t\t\treturn undefined;\n\t\t}\n\t\tif (touch !== Touch.None) {\n\t\t\tthis.touch(item, touch);\n\t\t}\n\t\treturn item.value;\n\t}\n\n\tset(key: K, value: V, touch: Touch = Touch.None): this {\n\t\tlet item = this._map.get(key);\n\t\tif (item) {\n\t\t\titem.value = value;\n\t\t\tif (touch !== Touch.None) {\n\t\t\t\tthis.touch(item, touch);\n\t\t\t}\n\t\t} else {\n\t\t\titem = { key, value, next: undefined, previous: undefined };\n\t\t\tswitch (touch) {\n\t\t\t\tcase Touch.None:\n\t\t\t\t\tthis.addItemLast(item);\n\t\t\t\t\tbreak;\n\t\t\t\tcase Touch.AsOld:\n\t\t\t\t\tthis.addItemFirst(item);\n\t\t\t\t\tbreak;\n\t\t\t\tcase Touch.AsNew:\n\t\t\t\t\tthis.addItemLast(item);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthis.addItemLast(item);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tthis._map.set(key, item);\n\t\t\tthis._size++;\n\t\t}\n\t\treturn this;\n\t}\n\n\tdelete(key: K): boolean {\n\t\treturn !!this.remove(key);\n\t}\n\n\tremove(key: K): V | undefined {\n\t\tconst item = this._map.get(key);\n\t\tif (!item) {\n\t\t\treturn undefined;\n\t\t}\n\t\tthis._map.delete(key);\n\t\tthis.removeItem(item);\n\t\tthis._size--;\n\t\treturn item.value;\n\t}\n\n\tshift(): V | undefined {\n\t\tif (!this._head && !this._tail) {\n\t\t\treturn undefined;\n\t\t}\n\t\tif (!this._head || !this._tail) {\n\t\t\tthrow new Error('Invalid list');\n\t\t}\n\t\tconst item = this._head;\n\t\tthis._map.delete(item.key);\n\t\tthis.removeItem(item);\n\t\tthis._size--;\n\t\treturn item.value;\n\t}\n\n\tforEach(callbackfn: (value: V, key: K, map: LinkedMap<K, V>) => void, thisArg?: any): void {\n\t\tconst state = this._state;\n\t\tlet current = this._head;\n\t\twhile (current) {\n\t\t\tif (thisArg) {\n\t\t\t\tcallbackfn.bind(thisArg)(current.value, current.key, this);\n\t\t\t} else {\n\t\t\t\tcallbackfn(current.value, current.key, this);\n\t\t\t}\n\t\t\tif (this._state !== state) {\n\t\t\t\tthrow new Error(`LinkedMap got modified during iteration.`);\n\t\t\t}\n\t\t\tcurrent = current.next;\n\t\t}\n\t}\n\n\tkeys(): IterableIterator<K> {\n\t\tconst map = this;\n\t\tconst state = this._state;\n\t\tlet current = this._head;\n\t\tconst iterator: IterableIterator<K> = {\n\t\t\t[Symbol.iterator]() {\n\t\t\t\treturn iterator;\n\t\t\t},\n\t\t\tnext(): IteratorResult<K> {\n\t\t\t\tif (map._state !== state) {\n\t\t\t\t\tthrow new Error(`LinkedMap got modified during iteration.`);\n\t\t\t\t}\n\t\t\t\tif (current) {\n\t\t\t\t\tconst result = { value: current.key, done: false };\n\t\t\t\t\tcurrent = current.next;\n\t\t\t\t\treturn result;\n\t\t\t\t} else {\n\t\t\t\t\treturn { value: undefined, done: true };\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\treturn iterator;\n\t}\n\n\tvalues(): IterableIterator<V> {\n\t\tconst map = this;\n\t\tconst state = this._state;\n\t\tlet current = this._head;\n\t\tconst iterator: IterableIterator<V> = {\n\t\t\t[Symbol.iterator]() {\n\t\t\t\treturn iterator;\n\t\t\t},\n\t\t\tnext(): IteratorResult<V> {\n\t\t\t\tif (map._state !== state) {\n\t\t\t\t\tthrow new Error(`LinkedMap got modified during iteration.`);\n\t\t\t\t}\n\t\t\t\tif (current) {\n\t\t\t\t\tconst result = { value: current.value, done: false };\n\t\t\t\t\tcurrent = current.next;\n\t\t\t\t\treturn result;\n\t\t\t\t} else {\n\t\t\t\t\treturn { value: undefined, done: true };\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\treturn iterator;\n\t}\n\n\tentries(): IterableIterator<[K, V]> {\n\t\tconst map = this;\n\t\tconst state = this._state;\n\t\tlet current = this._head;\n\t\tconst iterator: IterableIterator<[K, V]> = {\n\t\t\t[Symbol.iterator]() {\n\t\t\t\treturn iterator;\n\t\t\t},\n\t\t\tnext(): IteratorResult<[K, V]> {\n\t\t\t\tif (map._state !== state) {\n\t\t\t\t\tthrow new Error(`LinkedMap got modified during iteration.`);\n\t\t\t\t}\n\t\t\t\tif (current) {\n\t\t\t\t\tconst result: IteratorResult<[K, V]> = { value: [current.key, current.value], done: false };\n\t\t\t\t\tcurrent = current.next;\n\t\t\t\t\treturn result;\n\t\t\t\t} else {\n\t\t\t\t\treturn { value: undefined, done: true };\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\treturn iterator;\n\t}\n\n\t[Symbol.iterator](): IterableIterator<[K, V]> {\n\t\treturn this.entries();\n\t}\n\n\tprotected trimOld(newSize: number) {\n\t\tif (newSize >= this.size) {\n\t\t\treturn;\n\t\t}\n\t\tif (newSize === 0) {\n\t\t\tthis.clear();\n\t\t\treturn;\n\t\t}\n\t\tlet current = this._head;\n\t\tlet currentSize = this.size;\n\t\twhile (current && currentSize > newSize) {\n\t\t\tthis._map.delete(current.key);\n\t\t\tcurrent = current.next;\n\t\t\tcurrentSize--;\n\t\t}\n\t\tthis._head = current;\n\t\tthis._size = currentSize;\n\t\tif (current) {\n\t\t\tcurrent.previous = undefined;\n\t\t}\n\t\tthis._state++;\n\t}\n\n\tprivate addItemFirst(item: Item<K, V>): void {\n\t\t// First time Insert\n\t\tif (!this._head && !this._tail) {\n\t\t\tthis._tail = item;\n\t\t} else if (!this._head) {\n\t\t\tthrow new Error('Invalid list');\n\t\t} else {\n\t\t\titem.next = this._head;\n\t\t\tthis._head.previous = item;\n\t\t}\n\t\tthis._head = item;\n\t\tthis._state++;\n\t}\n\n\tprivate addItemLast(item: Item<K, V>): void {\n\t\t// First time Insert\n\t\tif (!this._head && !this._tail) {\n\t\t\tthis._head = item;\n\t\t} else if (!this._tail) {\n\t\t\tthrow new Error('Invalid list');\n\t\t} else {\n\t\t\titem.previous = this._tail;\n\t\t\tthis._tail.next = item;\n\t\t}\n\t\tthis._tail = item;\n\t\tthis._state++;\n\t}\n\n\tprivate removeItem(item: Item<K, V>): void {\n\t\tif (item === this._head && item === this._tail) {\n\t\t\tthis._head = undefined;\n\t\t\tthis._tail = undefined;\n\t\t}\n\t\telse if (item === this._head) {\n\t\t\t// This can only happend if size === 1 which is handle\n\t\t\t// by the case above.\n\t\t\tif (!item.next) {\n\t\t\t\tthrow new Error('Invalid list');\n\t\t\t}\n\t\t\titem.next.previous = undefined;\n\t\t\tthis._head = item.next;\n\t\t}\n\t\telse if (item === this._tail) {\n\t\t\t// This can only happend if size === 1 which is handle\n\t\t\t// by the case above.\n\t\t\tif (!item.previous) {\n\t\t\t\tthrow new Error('Invalid list');\n\t\t\t}\n\t\t\titem.previous.next = undefined;\n\t\t\tthis._tail = item.previous;\n\t\t}\n\t\telse {\n\t\t\tconst next = item.next;\n\t\t\tconst previous = item.previous;\n\t\t\tif (!next || !previous) {\n\t\t\t\tthrow new Error('Invalid list');\n\t\t\t}\n\t\t\tnext.previous = previous;\n\t\t\tprevious.next = next;\n\t\t}\n\t\titem.next = undefined;\n\t\titem.previous = undefined;\n\t\tthis._state++;\n\t}\n\n\tprivate touch(item: Item<K, V>, touch: Touch): void {\n\t\tif (!this._head || !this._tail) {\n\t\t\tthrow new Error('Invalid list');\n\t\t}\n\t\tif ((touch !== Touch.AsOld && touch !== Touch.AsNew)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (touch === Touch.AsOld) {\n\t\t\tif (item === this._head) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst next = item.next;\n\t\t\tconst previous = item.previous;\n\n\t\t\t// Unlink the item\n\t\t\tif (item === this._tail) {\n\t\t\t\t// previous must be defined since item was not head but is tail\n\t\t\t\t// So there are more than on item in the map\n\t\t\t\tprevious!.next = undefined;\n\t\t\t\tthis._tail = previous;\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Both next and previous are not undefined since item was neither head nor tail.\n\t\t\t\tnext!.previous = previous;\n\t\t\t\tprevious!.next = next;\n\t\t\t}\n\n\t\t\t// Insert the node at head\n\t\t\titem.previous = undefined;\n\t\t\titem.next = this._head;\n\t\t\tthis._head.previous = item;\n\t\t\tthis._head = item;\n\t\t\tthis._state++;\n\t\t} else if (touch === Touch.AsNew) {\n\t\t\tif (item === this._tail) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst next = item.next;\n\t\t\tconst previous = item.previous;\n\n\t\t\t// Unlink the item.\n\t\t\tif (item === this._head) {\n\t\t\t\t// next must be defined since item was not tail but is head\n\t\t\t\t// So there are more than on item in the map\n\t\t\t\tnext!.previous = undefined;\n\t\t\t\tthis._head = next;\n\t\t\t} else {\n\t\t\t\t// Both next and previous are not undefined since item was neither head nor tail.\n\t\t\t\tnext!.previous = previous;\n\t\t\t\tprevious!.next = next;\n\t\t\t}\n\t\t\titem.next = undefined;\n\t\t\titem.previous = this._tail;\n\t\t\tthis._tail.next = item;\n\t\t\tthis._tail = item;\n\t\t\tthis._state++;\n\t\t}\n\t}\n\n\ttoJSON(): [K, V][] {\n\t\tconst data: [K, V][] = [];\n\n\t\tthis.forEach((value, key) => {\n\t\t\tdata.push([key, value]);\n\t\t});\n\n\t\treturn data;\n\t}\n\n\tfromJSON(data: [K, V][]): void {\n\t\tthis.clear();\n\n\t\tfor (const [key, value] of data) {\n\t\t\tthis.set(key, value);\n\t\t}\n\t}\n}\n\nexport class LRUCache<K, V> extends LinkedMap<K, V> {\n\n\tprivate _limit: number;\n\tprivate _ratio: number;\n\n\tconstructor(limit: number, ratio: number = 1) {\n\t\tsuper();\n\t\tthis._limit = limit;\n\t\tthis._ratio = Math.min(Math.max(0, ratio), 1);\n\t}\n\n\tget limit(): number {\n\t\treturn this._limit;\n\t}\n\n\tset limit(limit: number) {\n\t\tthis._limit = limit;\n\t\tthis.checkTrim();\n\t}\n\n\tget ratio(): number {\n\t\treturn this._ratio;\n\t}\n\n\tset ratio(ratio: number) {\n\t\tthis._ratio = Math.min(Math.max(0, ratio), 1);\n\t\tthis.checkTrim();\n\t}\n\n\tget(key: K, touch: Touch = Touch.AsNew): V | undefined {\n\t\treturn super.get(key, touch);\n\t}\n\n\tpeek(key: K): V | undefined {\n\t\treturn super.get(key, Touch.None);\n\t}\n\n\tset(key: K, value: V): this {\n\t\tsuper.set(key, value, Touch.AsNew);\n\t\tthis.checkTrim();\n\t\treturn this;\n\t}\n\n\tprivate checkTrim() {\n\t\tif (this.size > this._limit) {\n\t\t\tthis.trimOld(Math.round(this._limit * this._ratio));\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CharCode } from 'vs/base/common/charCode';\nimport { LRUCache } from 'vs/base/common/map';\nimport * as strings from 'vs/base/common/strings';\n\nexport interface IFilter {\n\t// Returns null if word doesn't match.\n\t(word: string, wordToMatchAgainst: string): IMatch[] | null;\n}\n\nexport interface IMatch {\n\tstart: number;\n\tend: number;\n}\n\n// Combined filters\n\n/**\n * @returns A filter which combines the provided set\n * of filters with an or. The *first* filters that\n * matches defined the return value of the returned\n * filter.\n */\nexport function or(...filter: IFilter[]): IFilter {\n\treturn function (word: string, wordToMatchAgainst: string): IMatch[] | null {\n\t\tfor (let i = 0, len = filter.length; i < len; i++) {\n\t\t\tconst match = filter[i](word, wordToMatchAgainst);\n\t\t\tif (match) {\n\t\t\t\treturn match;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t};\n}\n\n// Prefix\n\nexport const matchesStrictPrefix: IFilter = _matchesPrefix.bind(undefined, false);\nexport const matchesPrefix: IFilter = _matchesPrefix.bind(undefined, true);\n\nfunction _matchesPrefix(ignoreCase: boolean, word: string, wordToMatchAgainst: string): IMatch[] | null {\n\tif (!wordToMatchAgainst || wordToMatchAgainst.length < word.length) {\n\t\treturn null;\n\t}\n\n\tlet matches: boolean;\n\tif (ignoreCase) {\n\t\tmatches = strings.startsWithIgnoreCase(wordToMatchAgainst, word);\n\t} else {\n\t\tmatches = wordToMatchAgainst.indexOf(word) === 0;\n\t}\n\n\tif (!matches) {\n\t\treturn null;\n\t}\n\n\treturn word.length > 0 ? [{ start: 0, end: word.length }] : [];\n}\n\n// Contiguous Substring\n\nexport function matchesContiguousSubString(word: string, wordToMatchAgainst: string): IMatch[] | null {\n\tconst index = wordToMatchAgainst.toLowerCase().indexOf(word.toLowerCase());\n\tif (index === -1) {\n\t\treturn null;\n\t}\n\n\treturn [{ start: index, end: index + word.length }];\n}\n\n// Substring\n\nexport function matchesSubString(word: string, wordToMatchAgainst: string): IMatch[] | null {\n\treturn _matchesSubString(word.toLowerCase(), wordToMatchAgainst.toLowerCase(), 0, 0);\n}\n\nfunction _matchesSubString(word: string, wordToMatchAgainst: string, i: number, j: number): IMatch[] | null {\n\tif (i === word.length) {\n\t\treturn [];\n\t} else if (j === wordToMatchAgainst.length) {\n\t\treturn null;\n\t} else {\n\t\tif (word[i] === wordToMatchAgainst[j]) {\n\t\t\tlet result: IMatch[] | null = null;\n\t\t\tif (result = _matchesSubString(word, wordToMatchAgainst, i + 1, j + 1)) {\n\t\t\t\treturn join({ start: j, end: j + 1 }, result);\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\n\t\treturn _matchesSubString(word, wordToMatchAgainst, i, j + 1);\n\t}\n}\n\n// CamelCase\n\nfunction isLower(code: number): boolean {\n\treturn CharCode.a <= code && code <= CharCode.z;\n}\n\nexport function isUpper(code: number): boolean {\n\treturn CharCode.A <= code && code <= CharCode.Z;\n}\n\nfunction isNumber(code: number): boolean {\n\treturn CharCode.Digit0 <= code && code <= CharCode.Digit9;\n}\n\nfunction isWhitespace(code: number): boolean {\n\treturn (\n\t\tcode === CharCode.Space\n\t\t|| code === CharCode.Tab\n\t\t|| code === CharCode.LineFeed\n\t\t|| code === CharCode.CarriageReturn\n\t);\n}\n\nconst wordSeparators = new Set<number>();\n'`~!@#$%^&*()-=+[{]}\\\\|;:\\'\",.<>/?'\n\t.split('')\n\t.forEach(s => wordSeparators.add(s.charCodeAt(0)));\n\nfunction isWordSeparator(code: number): boolean {\n\treturn isWhitespace(code) || wordSeparators.has(code);\n}\n\nfunction charactersMatch(codeA: number, codeB: number): boolean {\n\treturn (codeA === codeB) || (isWordSeparator(codeA) && isWordSeparator(codeB));\n}\n\nfunction isAlphanumeric(code: number): boolean {\n\treturn isLower(code) || isUpper(code) || isNumber(code);\n}\n\nfunction join(head: IMatch, tail: IMatch[]): IMatch[] {\n\tif (tail.length === 0) {\n\t\ttail = [head];\n\t} else if (head.end === tail[0].start) {\n\t\ttail[0].start = head.start;\n\t} else {\n\t\ttail.unshift(head);\n\t}\n\treturn tail;\n}\n\nfunction nextAnchor(camelCaseWord: string, start: number): number {\n\tfor (let i = start; i < camelCaseWord.length; i++) {\n\t\tconst c = camelCaseWord.charCodeAt(i);\n\t\tif (isUpper(c) || isNumber(c) || (i > 0 && !isAlphanumeric(camelCaseWord.charCodeAt(i - 1)))) {\n\t\t\treturn i;\n\t\t}\n\t}\n\treturn camelCaseWord.length;\n}\n\nfunction _matchesCamelCase(word: string, camelCaseWord: string, i: number, j: number): IMatch[] | null {\n\tif (i === word.length) {\n\t\treturn [];\n\t} else if (j === camelCaseWord.length) {\n\t\treturn null;\n\t} else if (word[i] !== camelCaseWord[j].toLowerCase()) {\n\t\treturn null;\n\t} else {\n\t\tlet result: IMatch[] | null = null;\n\t\tlet nextUpperIndex = j + 1;\n\t\tresult = _matchesCamelCase(word, camelCaseWord, i + 1, j + 1);\n\t\twhile (!result && (nextUpperIndex = nextAnchor(camelCaseWord, nextUpperIndex)) < camelCaseWord.length) {\n\t\t\tresult = _matchesCamelCase(word, camelCaseWord, i + 1, nextUpperIndex);\n\t\t\tnextUpperIndex++;\n\t\t}\n\t\treturn result === null ? null : join({ start: j, end: j + 1 }, result);\n\t}\n}\n\ninterface ICamelCaseAnalysis {\n\tupperPercent: number;\n\tlowerPercent: number;\n\talphaPercent: number;\n\tnumericPercent: number;\n}\n\n// Heuristic to avoid computing camel case matcher for words that don't\n// look like camelCaseWords.\nfunction analyzeCamelCaseWord(word: string): ICamelCaseAnalysis {\n\tlet upper = 0, lower = 0, alpha = 0, numeric = 0, code = 0;\n\n\tfor (let i = 0; i < word.length; i++) {\n\t\tcode = word.charCodeAt(i);\n\n\t\tif (isUpper(code)) { upper++; }\n\t\tif (isLower(code)) { lower++; }\n\t\tif (isAlphanumeric(code)) { alpha++; }\n\t\tif (isNumber(code)) { numeric++; }\n\t}\n\n\tconst upperPercent = upper / word.length;\n\tconst lowerPercent = lower / word.length;\n\tconst alphaPercent = alpha / word.length;\n\tconst numericPercent = numeric / word.length;\n\n\treturn { upperPercent, lowerPercent, alphaPercent, numericPercent };\n}\n\nfunction isUpperCaseWord(analysis: ICamelCaseAnalysis): boolean {\n\tconst { upperPercent, lowerPercent } = analysis;\n\treturn lowerPercent === 0 && upperPercent > 0.6;\n}\n\nfunction isCamelCaseWord(analysis: ICamelCaseAnalysis): boolean {\n\tconst { upperPercent, lowerPercent, alphaPercent, numericPercent } = analysis;\n\treturn lowerPercent > 0.2 && upperPercent < 0.8 && alphaPercent > 0.6 && numericPercent < 0.2;\n}\n\n// Heuristic to avoid computing camel case matcher for words that don't\n// look like camel case patterns.\nfunction isCamelCasePattern(word: string): boolean {\n\tlet upper = 0, lower = 0, code = 0, whitespace = 0;\n\n\tfor (let i = 0; i < word.length; i++) {\n\t\tcode = word.charCodeAt(i);\n\n\t\tif (isUpper(code)) { upper++; }\n\t\tif (isLower(code)) { lower++; }\n\t\tif (isWhitespace(code)) { whitespace++; }\n\t}\n\n\tif ((upper === 0 || lower === 0) && whitespace === 0) {\n\t\treturn word.length <= 30;\n\t} else {\n\t\treturn upper <= 5;\n\t}\n}\n\nexport function matchesCamelCase(word: string, camelCaseWord: string): IMatch[] | null {\n\tif (!camelCaseWord) {\n\t\treturn null;\n\t}\n\n\tcamelCaseWord = camelCaseWord.trim();\n\n\tif (camelCaseWord.length === 0) {\n\t\treturn null;\n\t}\n\n\tif (!isCamelCasePattern(word)) {\n\t\treturn null;\n\t}\n\n\tif (camelCaseWord.length > 60) {\n\t\treturn null;\n\t}\n\n\tconst analysis = analyzeCamelCaseWord(camelCaseWord);\n\n\tif (!isCamelCaseWord(analysis)) {\n\t\tif (!isUpperCaseWord(analysis)) {\n\t\t\treturn null;\n\t\t}\n\n\t\tcamelCaseWord = camelCaseWord.toLowerCase();\n\t}\n\n\tlet result: IMatch[] | null = null;\n\tlet i = 0;\n\n\tword = word.toLowerCase();\n\twhile (i < camelCaseWord.length && (result = _matchesCamelCase(word, camelCaseWord, 0, i)) === null) {\n\t\ti = nextAnchor(camelCaseWord, i + 1);\n\t}\n\n\treturn result;\n}\n\n// Matches beginning of words supporting non-ASCII languages\n// If `contiguous` is true then matches word with beginnings of the words in the target. E.g. \"pul\" will match \"Git: Pull\"\n// Otherwise also matches sub string of the word with beginnings of the words in the target. E.g. \"gp\" or \"g p\" will match \"Git: Pull\"\n// Useful in cases where the target is words (e.g. command labels)\n\nexport function matchesWords(word: string, target: string, contiguous: boolean = false): IMatch[] | null {\n\tif (!target || target.length === 0) {\n\t\treturn null;\n\t}\n\n\tlet result: IMatch[] | null = null;\n\tlet i = 0;\n\n\tword = word.toLowerCase();\n\ttarget = target.toLowerCase();\n\twhile (i < target.length && (result = _matchesWords(word, target, 0, i, contiguous)) === null) {\n\t\ti = nextWord(target, i + 1);\n\t}\n\n\treturn result;\n}\n\nfunction _matchesWords(word: string, target: string, i: number, j: number, contiguous: boolean): IMatch[] | null {\n\tif (i === word.length) {\n\t\treturn [];\n\t} else if (j === target.length) {\n\t\treturn null;\n\t} else if (!charactersMatch(word.charCodeAt(i), target.charCodeAt(j))) {\n\t\treturn null;\n\t} else {\n\t\tlet result: IMatch[] | null = null;\n\t\tlet nextWordIndex = j + 1;\n\t\tresult = _matchesWords(word, target, i + 1, j + 1, contiguous);\n\t\tif (!contiguous) {\n\t\t\twhile (!result && (nextWordIndex = nextWord(target, nextWordIndex)) < target.length) {\n\t\t\t\tresult = _matchesWords(word, target, i + 1, nextWordIndex, contiguous);\n\t\t\t\tnextWordIndex++;\n\t\t\t}\n\t\t}\n\t\treturn result === null ? null : join({ start: j, end: j + 1 }, result);\n\t}\n}\n\nfunction nextWord(word: string, start: number): number {\n\tfor (let i = start; i < word.length; i++) {\n\t\tif (isWordSeparator(word.charCodeAt(i)) ||\n\t\t\t(i > 0 && isWordSeparator(word.charCodeAt(i - 1)))) {\n\t\t\treturn i;\n\t\t}\n\t}\n\treturn word.length;\n}\n\n// Fuzzy\n\nconst fuzzyContiguousFilter = or(matchesPrefix, matchesCamelCase, matchesContiguousSubString);\nconst fuzzySeparateFilter = or(matchesPrefix, matchesCamelCase, matchesSubString);\nconst fuzzyRegExpCache = new LRUCache<string, RegExp>(10000); // bounded to 10000 elements\n\nexport function matchesFuzzy(word: string, wordToMatchAgainst: string, enableSeparateSubstringMatching = false): IMatch[] | null {\n\tif (typeof word !== 'string' || typeof wordToMatchAgainst !== 'string') {\n\t\treturn null; // return early for invalid input\n\t}\n\n\t// Form RegExp for wildcard matches\n\tlet regexp = fuzzyRegExpCache.get(word);\n\tif (!regexp) {\n\t\tregexp = new RegExp(strings.convertSimple2RegExpPattern(word), 'i');\n\t\tfuzzyRegExpCache.set(word, regexp);\n\t}\n\n\t// RegExp Filter\n\tconst match = regexp.exec(wordToMatchAgainst);\n\tif (match) {\n\t\treturn [{ start: match.index, end: match.index + match[0].length }];\n\t}\n\n\t// Default Filter\n\treturn enableSeparateSubstringMatching ? fuzzySeparateFilter(word, wordToMatchAgainst) : fuzzyContiguousFilter(word, wordToMatchAgainst);\n}\n\n/**\n * Match pattern againt word in a fuzzy way. As in IntelliSense and faster and more\n * powerfull than `matchesFuzzy`\n */\nexport function matchesFuzzy2(pattern: string, word: string): IMatch[] | null {\n\tconst score = fuzzyScore(pattern, pattern.toLowerCase(), 0, word, word.toLowerCase(), 0, true);\n\treturn score ? createMatches(score) : null;\n}\n\nexport function anyScore(pattern: string, lowPattern: string, _patternPos: number, word: string, lowWord: string, _wordPos: number): FuzzyScore {\n\tconst result = fuzzyScore(pattern, lowPattern, 0, word, lowWord, 0, true);\n\tif (result) {\n\t\treturn result;\n\t}\n\tlet matches: number[] = [];\n\tlet score = 0;\n\tlet idx = _wordPos;\n\tfor (let patternPos = 0; patternPos < lowPattern.length && patternPos < _maxLen; ++patternPos) {\n\t\tconst wordPos = lowWord.indexOf(lowPattern.charAt(patternPos), idx);\n\t\tif (wordPos >= 0) {\n\t\t\tscore += 1;\n\t\t\tmatches.unshift(wordPos);\n\t\t\tidx = wordPos + 1;\n\t\t} else if (matches.length > 0) {\n\t\t\t// once we have started matching things\n\t\t\t// we need to match the remaining pattern\n\t\t\t// characters\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn [score, _wordPos, ...matches];\n}\n\n//#region --- fuzzyScore ---\n\nexport function createMatches(score: undefined | FuzzyScore): IMatch[] {\n\tif (typeof score === 'undefined') {\n\t\treturn [];\n\t}\n\tconst res: IMatch[] = [];\n\tconst wordPos = score[1];\n\tfor (let i = score.length - 1; i > 1; i--) {\n\t\tconst pos = score[i] + wordPos;\n\t\tconst last = res[res.length - 1];\n\t\tif (last && last.end === pos) {\n\t\t\tlast.end = pos + 1;\n\t\t} else {\n\t\t\tres.push({ start: pos, end: pos + 1 });\n\t\t}\n\t}\n\treturn res;\n}\n\nconst _maxLen = 128;\n\nfunction initTable() {\n\tconst table: number[][] = [];\n\tconst row: number[] = [];\n\tfor (let i = 0; i <= _maxLen; i++) {\n\t\trow[i] = 0;\n\t}\n\tfor (let i = 0; i <= _maxLen; i++) {\n\t\ttable.push(row.slice(0));\n\t}\n\treturn table;\n}\n\nfunction initArr(maxLen: number) {\n\tconst row: number[] = [];\n\tfor (let i = 0; i <= maxLen; i++) {\n\t\trow[i] = 0;\n\t}\n\treturn row;\n}\n\nconst _minWordMatchPos = initArr(2 * _maxLen); // min word position for a certain pattern position\nconst _maxWordMatchPos = initArr(2 * _maxLen); // max word position for a certain pattern position\nconst _diag = initTable(); // the length of a contiguous diagonal match\nconst _table = initTable();\nconst _arrows = <Arrow[][]>initTable();\nconst _debug = false;\n\nfunction printTable(table: number[][], pattern: string, patternLen: number, word: string, wordLen: number): string {\n\tfunction pad(s: string, n: number, pad = ' ') {\n\t\twhile (s.length < n) {\n\t\t\ts = pad + s;\n\t\t}\n\t\treturn s;\n\t}\n\tlet ret = ` |   |${word.split('').map(c => pad(c, 3)).join('|')}\\n`;\n\n\tfor (let i = 0; i <= patternLen; i++) {\n\t\tif (i === 0) {\n\t\t\tret += ' |';\n\t\t} else {\n\t\t\tret += `${pattern[i - 1]}|`;\n\t\t}\n\t\tret += table[i].slice(0, wordLen + 1).map(n => pad(n.toString(), 3)).join('|') + '\\n';\n\t}\n\treturn ret;\n}\n\nfunction printTables(pattern: string, patternStart: number, word: string, wordStart: number): void {\n\tpattern = pattern.substr(patternStart);\n\tword = word.substr(wordStart);\n\tconsole.log(printTable(_table, pattern, pattern.length, word, word.length));\n\tconsole.log(printTable(_arrows, pattern, pattern.length, word, word.length));\n\tconsole.log(printTable(_diag, pattern, pattern.length, word, word.length));\n}\n\nfunction isSeparatorAtPos(value: string, index: number): boolean {\n\tif (index < 0 || index >= value.length) {\n\t\treturn false;\n\t}\n\tconst code = value.codePointAt(index);\n\tswitch (code) {\n\t\tcase CharCode.Underline:\n\t\tcase CharCode.Dash:\n\t\tcase CharCode.Period:\n\t\tcase CharCode.Space:\n\t\tcase CharCode.Slash:\n\t\tcase CharCode.Backslash:\n\t\tcase CharCode.SingleQuote:\n\t\tcase CharCode.DoubleQuote:\n\t\tcase CharCode.Colon:\n\t\tcase CharCode.DollarSign:\n\t\tcase CharCode.LessThan:\n\t\tcase CharCode.OpenParen:\n\t\tcase CharCode.OpenSquareBracket:\n\t\t\treturn true;\n\t\tcase undefined:\n\t\t\treturn false;\n\t\tdefault:\n\t\t\tif (strings.isEmojiImprecise(code)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t}\n}\n\nfunction isWhitespaceAtPos(value: string, index: number): boolean {\n\tif (index < 0 || index >= value.length) {\n\t\treturn false;\n\t}\n\tconst code = value.charCodeAt(index);\n\tswitch (code) {\n\t\tcase CharCode.Space:\n\t\tcase CharCode.Tab:\n\t\t\treturn true;\n\t\tdefault:\n\t\t\treturn false;\n\t}\n}\n\nfunction isUpperCaseAtPos(pos: number, word: string, wordLow: string): boolean {\n\treturn word[pos] !== wordLow[pos];\n}\n\nexport function isPatternInWord(patternLow: string, patternPos: number, patternLen: number, wordLow: string, wordPos: number, wordLen: number, fillMinWordPosArr = false): boolean {\n\twhile (patternPos < patternLen && wordPos < wordLen) {\n\t\tif (patternLow[patternPos] === wordLow[wordPos]) {\n\t\t\tif (fillMinWordPosArr) {\n\t\t\t\t// Remember the min word position for each pattern position\n\t\t\t\t_minWordMatchPos[patternPos] = wordPos;\n\t\t\t}\n\t\t\tpatternPos += 1;\n\t\t}\n\t\twordPos += 1;\n\t}\n\treturn patternPos === patternLen; // pattern must be exhausted\n}\n\nconst enum Arrow { Diag = 1, Left = 2, LeftLeft = 3 }\n\n/**\n * An array representating a fuzzy match.\n *\n * 0. the score\n * 1. the offset at which matching started\n * 2. `<match_pos_N>`\n * 3. `<match_pos_1>`\n * 4. `<match_pos_0>` etc\n */\nexport type FuzzyScore = [score: number, wordStart: number, ...matches: number[]];// [number, number, number];\n\nexport namespace FuzzyScore {\n\t/**\n\t * No matches and value `-100`\n\t */\n\texport const Default: FuzzyScore = ([-100, 0]);\n\n\texport function isDefault(score?: FuzzyScore): score is [-100, 0, 0] {\n\t\treturn !score || (score[0] === -100 && score[1] === 0 && score[2] === 0);\n\t}\n}\n\nexport interface FuzzyScorer {\n\t(pattern: string, lowPattern: string, patternPos: number, word: string, lowWord: string, wordPos: number, firstMatchCanBeWeak: boolean): FuzzyScore | undefined;\n}\n\nexport function fuzzyScore(pattern: string, patternLow: string, patternStart: number, word: string, wordLow: string, wordStart: number, firstMatchCanBeWeak: boolean): FuzzyScore | undefined {\n\n\tconst patternLen = pattern.length > _maxLen ? _maxLen : pattern.length;\n\tconst wordLen = word.length > _maxLen ? _maxLen : word.length;\n\n\tif (patternStart >= patternLen || wordStart >= wordLen || (patternLen - patternStart) > (wordLen - wordStart)) {\n\t\treturn undefined;\n\t}\n\n\t// Run a simple check if the characters of pattern occur\n\t// (in order) at all in word. If that isn't the case we\n\t// stop because no match will be possible\n\tif (!isPatternInWord(patternLow, patternStart, patternLen, wordLow, wordStart, wordLen, true)) {\n\t\treturn undefined;\n\t}\n\n\t// Find the max matching word position for each pattern position\n\t// NOTE: the min matching word position was filled in above, in the `isPatternInWord` call\n\t_fillInMaxWordMatchPos(patternLen, wordLen, patternStart, wordStart, patternLow, wordLow);\n\n\tlet row: number = 1;\n\tlet column: number = 1;\n\tlet patternPos = patternStart;\n\tlet wordPos = wordStart;\n\n\tconst hasStrongFirstMatch = [false];\n\n\t// There will be a match, fill in tables\n\tfor (row = 1, patternPos = patternStart; patternPos < patternLen; row++, patternPos++) {\n\n\t\t// Reduce search space to possible matching word positions and to possible access from next row\n\t\tconst minWordMatchPos = _minWordMatchPos[patternPos];\n\t\tconst maxWordMatchPos = _maxWordMatchPos[patternPos];\n\t\tconst nextMaxWordMatchPos = (patternPos + 1 < patternLen ? _maxWordMatchPos[patternPos + 1] : wordLen);\n\n\t\tfor (column = minWordMatchPos - wordStart + 1, wordPos = minWordMatchPos; wordPos < nextMaxWordMatchPos; column++, wordPos++) {\n\n\t\t\tlet score = Number.MIN_SAFE_INTEGER;\n\t\t\tlet canComeDiag = false;\n\n\t\t\tif (wordPos <= maxWordMatchPos) {\n\t\t\t\tscore = _doScore(\n\t\t\t\t\tpattern, patternLow, patternPos, patternStart,\n\t\t\t\t\tword, wordLow, wordPos, wordLen, wordStart,\n\t\t\t\t\t_diag[row - 1][column - 1] === 0,\n\t\t\t\t\thasStrongFirstMatch\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tlet diagScore = 0;\n\t\t\tif (score !== Number.MAX_SAFE_INTEGER) {\n\t\t\t\tcanComeDiag = true;\n\t\t\t\tdiagScore = score + _table[row - 1][column - 1];\n\t\t\t}\n\n\t\t\tconst canComeLeft = wordPos > minWordMatchPos;\n\t\t\tconst leftScore = canComeLeft ? _table[row][column - 1] + (_diag[row][column - 1] > 0 ? -5 : 0) : 0; // penalty for a gap start\n\n\t\t\tconst canComeLeftLeft = wordPos > minWordMatchPos + 1 && _diag[row][column - 1] > 0;\n\t\t\tconst leftLeftScore = canComeLeftLeft ? _table[row][column - 2] + (_diag[row][column - 2] > 0 ? -5 : 0) : 0; // penalty for a gap start\n\n\t\t\tif (canComeLeftLeft && (!canComeLeft || leftLeftScore >= leftScore) && (!canComeDiag || leftLeftScore >= diagScore)) {\n\t\t\t\t// always prefer choosing left left to jump over a diagonal because that means a match is earlier in the word\n\t\t\t\t_table[row][column] = leftLeftScore;\n\t\t\t\t_arrows[row][column] = Arrow.LeftLeft;\n\t\t\t\t_diag[row][column] = 0;\n\t\t\t} else if (canComeLeft && (!canComeDiag || leftScore >= diagScore)) {\n\t\t\t\t// always prefer choosing left since that means a match is earlier in the word\n\t\t\t\t_table[row][column] = leftScore;\n\t\t\t\t_arrows[row][column] = Arrow.Left;\n\t\t\t\t_diag[row][column] = 0;\n\t\t\t} else if (canComeDiag) {\n\t\t\t\t_table[row][column] = diagScore;\n\t\t\t\t_arrows[row][column] = Arrow.Diag;\n\t\t\t\t_diag[row][column] = _diag[row - 1][column - 1] + 1;\n\t\t\t} else {\n\t\t\t\tthrow new Error(`not possible`);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (_debug) {\n\t\tprintTables(pattern, patternStart, word, wordStart);\n\t}\n\n\tif (!hasStrongFirstMatch[0] && !firstMatchCanBeWeak) {\n\t\treturn undefined;\n\t}\n\n\trow--;\n\tcolumn--;\n\n\tconst result: FuzzyScore = [_table[row][column], wordStart];\n\n\tlet backwardsDiagLength = 0;\n\tlet maxMatchColumn = 0;\n\n\twhile (row >= 1) {\n\t\t// Find the column where we go diagonally up\n\t\tlet diagColumn = column;\n\t\tdo {\n\t\t\tconst arrow = _arrows[row][diagColumn];\n\t\t\tif (arrow === Arrow.LeftLeft) {\n\t\t\t\tdiagColumn = diagColumn - 2;\n\t\t\t} else if (arrow === Arrow.Left) {\n\t\t\t\tdiagColumn = diagColumn - 1;\n\t\t\t} else {\n\t\t\t\t// found the diagonal\n\t\t\t\tbreak;\n\t\t\t}\n\t\t} while (diagColumn >= 1);\n\n\t\t// Overturn the \"forwards\" decision if keeping the \"backwards\" diagonal would give a better match\n\t\tif (\n\t\t\tbackwardsDiagLength > 1 // only if we would have a contiguous match of 3 characters\n\t\t\t&& patternLow[patternStart + row - 1] === wordLow[wordStart + column - 1] // only if we can do a contiguous match diagonally\n\t\t\t&& !isUpperCaseAtPos(diagColumn + wordStart - 1, word, wordLow) // only if the forwards chose diagonal is not an uppercase\n\t\t\t&& backwardsDiagLength + 1 > _diag[row][diagColumn] // only if our contiguous match would be longer than the \"forwards\" contiguous match\n\t\t) {\n\t\t\tdiagColumn = column;\n\t\t}\n\n\t\tif (diagColumn === column) {\n\t\t\t// this is a contiguous match\n\t\t\tbackwardsDiagLength++;\n\t\t} else {\n\t\t\tbackwardsDiagLength = 1;\n\t\t}\n\n\t\tif (!maxMatchColumn) {\n\t\t\t// remember the last matched column\n\t\t\tmaxMatchColumn = diagColumn;\n\t\t}\n\n\t\trow--;\n\t\tcolumn = diagColumn - 1;\n\t\tresult.push(column);\n\t}\n\n\tif (wordLen === patternLen) {\n\t\t// the word matches the pattern with all characters!\n\t\t// giving the score a total match boost (to come up ahead other words)\n\t\tresult[0] += 2;\n\t}\n\n\t// Add 1 penalty for each skipped character in the word\n\tconst skippedCharsCount = maxMatchColumn - patternLen;\n\tresult[0] -= skippedCharsCount;\n\n\treturn result;\n}\n\nfunction _fillInMaxWordMatchPos(patternLen: number, wordLen: number, patternStart: number, wordStart: number, patternLow: string, wordLow: string) {\n\tlet patternPos = patternLen - 1;\n\tlet wordPos = wordLen - 1;\n\twhile (patternPos >= patternStart && wordPos >= wordStart) {\n\t\tif (patternLow[patternPos] === wordLow[wordPos]) {\n\t\t\t_maxWordMatchPos[patternPos] = wordPos;\n\t\t\tpatternPos--;\n\t\t}\n\t\twordPos--;\n\t}\n}\n\nfunction _doScore(\n\tpattern: string, patternLow: string, patternPos: number, patternStart: number,\n\tword: string, wordLow: string, wordPos: number, wordLen: number, wordStart: number,\n\tnewMatchStart: boolean,\n\toutFirstMatchStrong: boolean[],\n): number {\n\tif (patternLow[patternPos] !== wordLow[wordPos]) {\n\t\treturn Number.MIN_SAFE_INTEGER;\n\t}\n\n\tlet score = 1;\n\tlet isGapLocation = false;\n\tif (wordPos === (patternPos - patternStart)) {\n\t\t// common prefix: `foobar <-> foobaz`\n\t\t//                            ^^^^^\n\t\tscore = pattern[patternPos] === word[wordPos] ? 7 : 5;\n\n\t} else if (isUpperCaseAtPos(wordPos, word, wordLow) && (wordPos === 0 || !isUpperCaseAtPos(wordPos - 1, word, wordLow))) {\n\t\t// hitting upper-case: `foo <-> forOthers`\n\t\t//                              ^^ ^\n\t\tscore = pattern[patternPos] === word[wordPos] ? 7 : 5;\n\t\tisGapLocation = true;\n\n\t} else if (isSeparatorAtPos(wordLow, wordPos) && (wordPos === 0 || !isSeparatorAtPos(wordLow, wordPos - 1))) {\n\t\t// hitting a separator: `. <-> foo.bar`\n\t\t//                                ^\n\t\tscore = 5;\n\n\t} else if (isSeparatorAtPos(wordLow, wordPos - 1) || isWhitespaceAtPos(wordLow, wordPos - 1)) {\n\t\t// post separator: `foo <-> bar_foo`\n\t\t//                              ^^^\n\t\tscore = 5;\n\t\tisGapLocation = true;\n\t}\n\n\tif (score > 1 && patternPos === patternStart) {\n\t\toutFirstMatchStrong[0] = true;\n\t}\n\n\tif (!isGapLocation) {\n\t\tisGapLocation = isUpperCaseAtPos(wordPos, word, wordLow) || isSeparatorAtPos(wordLow, wordPos - 1) || isWhitespaceAtPos(wordLow, wordPos - 1);\n\t}\n\n\t//\n\tif (patternPos === patternStart) { // first character in pattern\n\t\tif (wordPos > wordStart) {\n\t\t\t// the first pattern character would match a word character that is not at the word start\n\t\t\t// so introduce a penalty to account for the gap preceding this match\n\t\t\tscore -= isGapLocation ? 3 : 5;\n\t\t}\n\t} else {\n\t\tif (newMatchStart) {\n\t\t\t// this would be the beginning of a new match (i.e. there would be a gap before this location)\n\t\t\tscore += isGapLocation ? 2 : 0;\n\t\t} else {\n\t\t\t// this is part of a contiguous match, so give it a slight bonus, but do so only if it would not be a prefered gap location\n\t\t\tscore += isGapLocation ? 0 : 1;\n\t\t}\n\t}\n\n\tif (wordPos + 1 === wordLen) {\n\t\t// we always penalize gaps, but this gives unfair advantages to a match that would match the last character in the word\n\t\t// so pretend there is a gap after the last character in the word to normalize things\n\t\tscore -= isGapLocation ? 3 : 5;\n\t}\n\n\treturn score;\n}\n\n//#endregion\n\n\n//#region --- graceful ---\n\nexport function fuzzyScoreGracefulAggressive(pattern: string, lowPattern: string, patternPos: number, word: string, lowWord: string, wordPos: number, firstMatchCanBeWeak: boolean): FuzzyScore | undefined {\n\treturn fuzzyScoreWithPermutations(pattern, lowPattern, patternPos, word, lowWord, wordPos, true, firstMatchCanBeWeak);\n}\n\nexport function fuzzyScoreGraceful(pattern: string, lowPattern: string, patternPos: number, word: string, lowWord: string, wordPos: number, firstMatchCanBeWeak: boolean): FuzzyScore | undefined {\n\treturn fuzzyScoreWithPermutations(pattern, lowPattern, patternPos, word, lowWord, wordPos, false, firstMatchCanBeWeak);\n}\n\nfunction fuzzyScoreWithPermutations(pattern: string, lowPattern: string, patternPos: number, word: string, lowWord: string, wordPos: number, aggressive: boolean, firstMatchCanBeWeak: boolean): FuzzyScore | undefined {\n\tlet top = fuzzyScore(pattern, lowPattern, patternPos, word, lowWord, wordPos, firstMatchCanBeWeak);\n\n\tif (top && !aggressive) {\n\t\t// when using the original pattern yield a result we`\n\t\t// return it unless we are aggressive and try to find\n\t\t// a better alignment, e.g. `cno` -> `^co^ns^ole` or `^c^o^nsole`.\n\t\treturn top;\n\t}\n\n\tif (pattern.length >= 3) {\n\t\t// When the pattern is long enough then try a few (max 7)\n\t\t// permutations of the pattern to find a better match. The\n\t\t// permutations only swap neighbouring characters, e.g\n\t\t// `cnoso` becomes `conso`, `cnsoo`, `cnoos`.\n\t\tconst tries = Math.min(7, pattern.length - 1);\n\t\tfor (let movingPatternPos = patternPos + 1; movingPatternPos < tries; movingPatternPos++) {\n\t\t\tconst newPattern = nextTypoPermutation(pattern, movingPatternPos);\n\t\t\tif (newPattern) {\n\t\t\t\tconst candidate = fuzzyScore(newPattern, newPattern.toLowerCase(), patternPos, word, lowWord, wordPos, firstMatchCanBeWeak);\n\t\t\t\tif (candidate) {\n\t\t\t\t\tcandidate[0] -= 3; // permutation penalty\n\t\t\t\t\tif (!top || candidate[0] > top[0]) {\n\t\t\t\t\t\ttop = candidate;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn top;\n}\n\nfunction nextTypoPermutation(pattern: string, patternPos: number): string | undefined {\n\n\tif (patternPos + 1 >= pattern.length) {\n\t\treturn undefined;\n\t}\n\n\tconst swap1 = pattern[patternPos];\n\tconst swap2 = pattern[patternPos + 1];\n\n\tif (swap1 === swap2) {\n\t\treturn undefined;\n\t}\n\n\treturn pattern.slice(0, patternPos)\n\t\t+ swap2\n\t\t+ swap1\n\t\t+ pattern.slice(patternPos + 2);\n}\n\n//#endregion\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { compareAnything } from 'vs/base/common/comparers';\nimport { matchesPrefix, IMatch, isUpper, fuzzyScore, createMatches as createFuzzyMatches } from 'vs/base/common/filters';\nimport { sep } from 'vs/base/common/path';\nimport { isWindows, isLinux } from 'vs/base/common/platform';\nimport { stripWildcards, equalsIgnoreCase } from 'vs/base/common/strings';\nimport { CharCode } from 'vs/base/common/charCode';\n\n//#region Fuzzy scorer\n\nexport type FuzzyScore = [number /* score */, number[] /* match positions */];\nexport type FuzzyScorerCache = { [key: string]: IItemScore };\n\nconst NO_MATCH = 0;\nconst NO_SCORE: FuzzyScore = [NO_MATCH, []];\n\n// const DEBUG = false;\n// const DEBUG_MATRIX = false;\n\nexport function scoreFuzzy(target: string, query: string, queryLower: string, fuzzy: boolean): FuzzyScore {\n\tif (!target || !query) {\n\t\treturn NO_SCORE; // return early if target or query are undefined\n\t}\n\n\tconst targetLength = target.length;\n\tconst queryLength = query.length;\n\n\tif (targetLength < queryLength) {\n\t\treturn NO_SCORE; // impossible for query to be contained in target\n\t}\n\n\t// if (DEBUG) {\n\t// \tconsole.group(`Target: ${target}, Query: ${query}`);\n\t// }\n\n\tconst targetLower = target.toLowerCase();\n\n\t// When not searching fuzzy, we require the query to be contained fully\n\t// in the target string contiguously.\n\tif (!fuzzy) {\n\t\tif (!targetLower.includes(queryLower)) {\n\t\t\t// if (DEBUG) {\n\t\t\t// \tconsole.log(`Characters not matching consecutively ${queryLower} within ${targetLower}`);\n\t\t\t// }\n\n\t\t\treturn NO_SCORE;\n\t\t}\n\t}\n\n\tconst res = doScoreFuzzy(query, queryLower, queryLength, target, targetLower, targetLength);\n\n\t// if (DEBUG) {\n\t// \tconsole.log(`%cFinal Score: ${res[0]}`, 'font-weight: bold');\n\t// \tconsole.groupEnd();\n\t// }\n\n\treturn res;\n}\n\nfunction doScoreFuzzy(query: string, queryLower: string, queryLength: number, target: string, targetLower: string, targetLength: number): FuzzyScore {\n\tconst scores: number[] = [];\n\tconst matches: number[] = [];\n\n\t//\n\t// Build Scorer Matrix:\n\t//\n\t// The matrix is composed of query q and target t. For each index we score\n\t// q[i] with t[i] and compare that with the previous score. If the score is\n\t// equal or larger, we keep the match. In addition to the score, we also keep\n\t// the length of the consecutive matches to use as boost for the score.\n\t//\n\t//      t   a   r   g   e   t\n\t//  q\n\t//  u\n\t//  e\n\t//  r\n\t//  y\n\t//\n\tfor (let queryIndex = 0; queryIndex < queryLength; queryIndex++) {\n\t\tconst queryIndexOffset = queryIndex * targetLength;\n\t\tconst queryIndexPreviousOffset = queryIndexOffset - targetLength;\n\n\t\tconst queryIndexGtNull = queryIndex > 0;\n\n\t\tconst queryCharAtIndex = query[queryIndex];\n\t\tconst queryLowerCharAtIndex = queryLower[queryIndex];\n\n\t\tfor (let targetIndex = 0; targetIndex < targetLength; targetIndex++) {\n\t\t\tconst targetIndexGtNull = targetIndex > 0;\n\n\t\t\tconst currentIndex = queryIndexOffset + targetIndex;\n\t\t\tconst leftIndex = currentIndex - 1;\n\t\t\tconst diagIndex = queryIndexPreviousOffset + targetIndex - 1;\n\n\t\t\tconst leftScore = targetIndexGtNull ? scores[leftIndex] : 0;\n\t\t\tconst diagScore = queryIndexGtNull && targetIndexGtNull ? scores[diagIndex] : 0;\n\n\t\t\tconst matchesSequenceLength = queryIndexGtNull && targetIndexGtNull ? matches[diagIndex] : 0;\n\n\t\t\t// If we are not matching on the first query character any more, we only produce a\n\t\t\t// score if we had a score previously for the last query index (by looking at the diagScore).\n\t\t\t// This makes sure that the query always matches in sequence on the target. For example\n\t\t\t// given a target of \"ede\" and a query of \"de\", we would otherwise produce a wrong high score\n\t\t\t// for query[1] (\"e\") matching on target[0] (\"e\") because of the \"beginning of word\" boost.\n\t\t\tlet score: number;\n\t\t\tif (!diagScore && queryIndexGtNull) {\n\t\t\t\tscore = 0;\n\t\t\t} else {\n\t\t\t\tscore = computeCharScore(queryCharAtIndex, queryLowerCharAtIndex, target, targetLower, targetIndex, matchesSequenceLength);\n\t\t\t}\n\n\t\t\t// We have a score and its equal or larger than the left score\n\t\t\t// Match: sequence continues growing from previous diag value\n\t\t\t// Score: increases by diag score value\n\t\t\tif (score && diagScore + score >= leftScore) {\n\t\t\t\tmatches[currentIndex] = matchesSequenceLength + 1;\n\t\t\t\tscores[currentIndex] = diagScore + score;\n\t\t\t}\n\n\t\t\t// We either have no score or the score is lower than the left score\n\t\t\t// Match: reset to 0\n\t\t\t// Score: pick up from left hand side\n\t\t\telse {\n\t\t\t\tmatches[currentIndex] = NO_MATCH;\n\t\t\t\tscores[currentIndex] = leftScore;\n\t\t\t}\n\t\t}\n\t}\n\n\t// Restore Positions (starting from bottom right of matrix)\n\tconst positions: number[] = [];\n\tlet queryIndex = queryLength - 1;\n\tlet targetIndex = targetLength - 1;\n\twhile (queryIndex >= 0 && targetIndex >= 0) {\n\t\tconst currentIndex = queryIndex * targetLength + targetIndex;\n\t\tconst match = matches[currentIndex];\n\t\tif (match === NO_MATCH) {\n\t\t\ttargetIndex--; // go left\n\t\t} else {\n\t\t\tpositions.push(targetIndex);\n\n\t\t\t// go up and left\n\t\t\tqueryIndex--;\n\t\t\ttargetIndex--;\n\t\t}\n\t}\n\n\t// Print matrix\n\t// if (DEBUG_MATRIX) {\n\t// printMatrix(query, target, matches, scores);\n\t// }\n\n\treturn [scores[queryLength * targetLength - 1], positions.reverse()];\n}\n\nfunction computeCharScore(queryCharAtIndex: string, queryLowerCharAtIndex: string, target: string, targetLower: string, targetIndex: number, matchesSequenceLength: number): number {\n\tlet score = 0;\n\n\tif (!considerAsEqual(queryLowerCharAtIndex, targetLower[targetIndex])) {\n\t\treturn score; // no match of characters\n\t}\n\n\t// Character match bonus\n\tscore += 1;\n\n\t// if (DEBUG) {\n\t// console.groupCollapsed(`%cCharacter match bonus: +1 (char: ${queryLowerCharAtIndex} at index ${targetIndex}, total score: ${score})`, 'font-weight: normal');\n\t// }\n\n\t// Consecutive match bonus\n\tif (matchesSequenceLength > 0) {\n\t\tscore += (matchesSequenceLength * 5);\n\n\t\t// if (DEBUG) {\n\t\t// console.log(`Consecutive match bonus: +${matchesSequenceLength * 5}`);\n\t\t// }\n\t}\n\n\t// Same case bonus\n\tif (queryCharAtIndex === target[targetIndex]) {\n\t\tscore += 1;\n\n\t\t// if (DEBUG) {\n\t\t// \tconsole.log('Same case bonus: +1');\n\t\t// }\n\t}\n\n\t// Start of word bonus\n\tif (targetIndex === 0) {\n\t\tscore += 8;\n\n\t\t// if (DEBUG) {\n\t\t// \tconsole.log('Start of word bonus: +8');\n\t\t// }\n\t}\n\n\telse {\n\n\t\t// After separator bonus\n\t\tconst separatorBonus = scoreSeparatorAtPos(target.charCodeAt(targetIndex - 1));\n\t\tif (separatorBonus) {\n\t\t\tscore += separatorBonus;\n\n\t\t\t// if (DEBUG) {\n\t\t\t// console.log(`After separtor bonus: +${separatorBonus}`);\n\t\t\t// }\n\t\t}\n\n\t\t// Inside word upper case bonus (camel case)\n\t\telse if (isUpper(target.charCodeAt(targetIndex))) {\n\t\t\tscore += 2;\n\n\t\t\t// if (DEBUG) {\n\t\t\t// \tconsole.log('Inside word upper case bonus: +2');\n\t\t\t// }\n\t\t}\n\t}\n\n\t// if (DEBUG) {\n\t// \tconsole.groupEnd();\n\t// }\n\n\treturn score;\n}\n\nfunction considerAsEqual(a: string, b: string): boolean {\n\tif (a === b) {\n\t\treturn true;\n\t}\n\n\t// Special case path spearators: ignore platform differences\n\tif (a === '/' || a === '\\\\') {\n\t\treturn b === '/' || b === '\\\\';\n\t}\n\n\treturn false;\n}\n\nfunction scoreSeparatorAtPos(charCode: number): number {\n\tswitch (charCode) {\n\t\tcase CharCode.Slash:\n\t\tcase CharCode.Backslash:\n\t\t\treturn 5; // prefer path separators...\n\t\tcase CharCode.Underline:\n\t\tcase CharCode.Dash:\n\t\tcase CharCode.Period:\n\t\tcase CharCode.Space:\n\t\tcase CharCode.SingleQuote:\n\t\tcase CharCode.DoubleQuote:\n\t\tcase CharCode.Colon:\n\t\t\treturn 4; // ...over other separators\n\t\tdefault:\n\t\t\treturn 0;\n\t}\n}\n\n// function printMatrix(query: string, target: string, matches: number[], scores: number[]): void {\n// \tconsole.log('\\t' + target.split('').join('\\t'));\n// \tfor (let queryIndex = 0; queryIndex < query.length; queryIndex++) {\n// \t\tlet line = query[queryIndex] + '\\t';\n// \t\tfor (let targetIndex = 0; targetIndex < target.length; targetIndex++) {\n// \t\t\tconst currentIndex = queryIndex * target.length + targetIndex;\n// \t\t\tline = line + 'M' + matches[currentIndex] + '/' + 'S' + scores[currentIndex] + '\\t';\n// \t\t}\n\n// \t\tconsole.log(line);\n// \t}\n// }\n\n//#endregion\n\n\n//#region Alternate fuzzy scorer implementation that is e.g. used for symbols\n\nexport type FuzzyScore2 = [number | undefined /* score */, IMatch[]];\n\nconst NO_SCORE2: FuzzyScore2 = [undefined, []];\n\nexport function scoreFuzzy2(target: string, query: IPreparedQuery | IPreparedQueryPiece, patternStart = 0, wordStart = 0): FuzzyScore2 {\n\n\t// Score: multiple inputs\n\tconst preparedQuery = query as IPreparedQuery;\n\tif (preparedQuery.values && preparedQuery.values.length > 1) {\n\t\treturn doScoreFuzzy2Multiple(target, preparedQuery.values, patternStart, wordStart);\n\t}\n\n\t// Score: single input\n\treturn doScoreFuzzy2Single(target, query, patternStart, wordStart);\n}\n\nfunction doScoreFuzzy2Multiple(target: string, query: IPreparedQueryPiece[], patternStart: number, wordStart: number): FuzzyScore2 {\n\tlet totalScore = 0;\n\tconst totalMatches: IMatch[] = [];\n\n\tfor (const queryPiece of query) {\n\t\tconst [score, matches] = doScoreFuzzy2Single(target, queryPiece, patternStart, wordStart);\n\t\tif (typeof score !== 'number') {\n\t\t\t// if a single query value does not match, return with\n\t\t\t// no score entirely, we require all queries to match\n\t\t\treturn NO_SCORE2;\n\t\t}\n\n\t\ttotalScore += score;\n\t\ttotalMatches.push(...matches);\n\t}\n\n\t// if we have a score, ensure that the positions are\n\t// sorted in ascending order and distinct\n\treturn [totalScore, normalizeMatches(totalMatches)];\n}\n\nfunction doScoreFuzzy2Single(target: string, query: IPreparedQueryPiece, patternStart: number, wordStart: number): FuzzyScore2 {\n\tconst score = fuzzyScore(query.original, query.originalLowercase, patternStart, target, target.toLowerCase(), wordStart, true);\n\tif (!score) {\n\t\treturn NO_SCORE2;\n\t}\n\n\treturn [score[0], createFuzzyMatches(score)];\n}\n\n//#endregion\n\n\n//#region Item (label, description, path) scorer\n\n/**\n * Scoring on structural items that have a label and optional description.\n */\nexport interface IItemScore {\n\n\t/**\n\t * Overall score.\n\t */\n\tscore: number;\n\n\t/**\n\t * Matches within the label.\n\t */\n\tlabelMatch?: IMatch[];\n\n\t/**\n\t * Matches within the description.\n\t */\n\tdescriptionMatch?: IMatch[];\n}\n\nconst NO_ITEM_SCORE: IItemScore = Object.freeze({ score: 0 });\n\nexport interface IItemAccessor<T> {\n\n\t/**\n\t * Just the label of the item to score on.\n\t */\n\tgetItemLabel(item: T): string | undefined;\n\n\t/**\n\t * The optional description of the item to score on.\n\t */\n\tgetItemDescription(item: T): string | undefined;\n\n\t/**\n\t * If the item is a file, the path of the file to score on.\n\t */\n\tgetItemPath(file: T): string | undefined;\n}\n\nconst PATH_IDENTITY_SCORE = 1 << 18;\nconst LABEL_PREFIX_SCORE_THRESHOLD = 1 << 17;\nconst LABEL_SCORE_THRESHOLD = 1 << 16;\n\nexport function scoreItemFuzzy<T>(item: T, query: IPreparedQuery, fuzzy: boolean, accessor: IItemAccessor<T>, cache: FuzzyScorerCache): IItemScore {\n\tif (!item || !query.normalized) {\n\t\treturn NO_ITEM_SCORE; // we need an item and query to score on at least\n\t}\n\n\tconst label = accessor.getItemLabel(item);\n\tif (!label) {\n\t\treturn NO_ITEM_SCORE; // we need a label at least\n\t}\n\n\tconst description = accessor.getItemDescription(item);\n\n\t// in order to speed up scoring, we cache the score with a unique hash based on:\n\t// - label\n\t// - description (if provided)\n\t// - query (normalized)\n\t// - number of query pieces (i.e. 'hello world' and 'helloworld' are different)\n\t// - whether fuzzy matching is enabled or not\n\tlet cacheHash: string;\n\tif (description) {\n\t\tcacheHash = `${label}${description}${query.normalized}${Array.isArray(query.values) ? query.values.length : ''}${fuzzy}`;\n\t} else {\n\t\tcacheHash = `${label}${query.normalized}${Array.isArray(query.values) ? query.values.length : ''}${fuzzy}`;\n\t}\n\n\tconst cached = cache[cacheHash];\n\tif (cached) {\n\t\treturn cached;\n\t}\n\n\tconst itemScore = doScoreItemFuzzy(label, description, accessor.getItemPath(item), query, fuzzy);\n\tcache[cacheHash] = itemScore;\n\n\treturn itemScore;\n}\n\nfunction doScoreItemFuzzy(label: string, description: string | undefined, path: string | undefined, query: IPreparedQuery, fuzzy: boolean): IItemScore {\n\tconst preferLabelMatches = !path || !query.containsPathSeparator;\n\n\t// Treat identity matches on full path highest\n\tif (path && (isLinux ? query.pathNormalized === path : equalsIgnoreCase(query.pathNormalized, path))) {\n\t\treturn { score: PATH_IDENTITY_SCORE, labelMatch: [{ start: 0, end: label.length }], descriptionMatch: description ? [{ start: 0, end: description.length }] : undefined };\n\t}\n\n\t// Score: multiple inputs\n\tif (query.values && query.values.length > 1) {\n\t\treturn doScoreItemFuzzyMultiple(label, description, path, query.values, preferLabelMatches, fuzzy);\n\t}\n\n\t// Score: single input\n\treturn doScoreItemFuzzySingle(label, description, path, query, preferLabelMatches, fuzzy);\n}\n\nfunction doScoreItemFuzzyMultiple(label: string, description: string | undefined, path: string | undefined, query: IPreparedQueryPiece[], preferLabelMatches: boolean, fuzzy: boolean): IItemScore {\n\tlet totalScore = 0;\n\tconst totalLabelMatches: IMatch[] = [];\n\tconst totalDescriptionMatches: IMatch[] = [];\n\n\tfor (const queryPiece of query) {\n\t\tconst { score, labelMatch, descriptionMatch } = doScoreItemFuzzySingle(label, description, path, queryPiece, preferLabelMatches, fuzzy);\n\t\tif (score === NO_MATCH) {\n\t\t\t// if a single query value does not match, return with\n\t\t\t// no score entirely, we require all queries to match\n\t\t\treturn NO_ITEM_SCORE;\n\t\t}\n\n\t\ttotalScore += score;\n\t\tif (labelMatch) {\n\t\t\ttotalLabelMatches.push(...labelMatch);\n\t\t}\n\n\t\tif (descriptionMatch) {\n\t\t\ttotalDescriptionMatches.push(...descriptionMatch);\n\t\t}\n\t}\n\n\t// if we have a score, ensure that the positions are\n\t// sorted in ascending order and distinct\n\treturn {\n\t\tscore: totalScore,\n\t\tlabelMatch: normalizeMatches(totalLabelMatches),\n\t\tdescriptionMatch: normalizeMatches(totalDescriptionMatches)\n\t};\n}\n\nfunction doScoreItemFuzzySingle(label: string, description: string | undefined, path: string | undefined, query: IPreparedQueryPiece, preferLabelMatches: boolean, fuzzy: boolean): IItemScore {\n\n\t// Prefer label matches if told so or we have no description\n\tif (preferLabelMatches || !description) {\n\t\tconst [labelScore, labelPositions] = scoreFuzzy(label, query.normalized, query.normalizedLowercase, fuzzy);\n\t\tif (labelScore) {\n\n\t\t\t// If we have a prefix match on the label, we give a much\n\t\t\t// higher baseScore to elevate these matches over others\n\t\t\t// This ensures that typing a file name wins over results\n\t\t\t// that are present somewhere in the label, but not the\n\t\t\t// beginning.\n\t\t\tconst labelPrefixMatch = matchesPrefix(query.normalized, label);\n\t\t\tlet baseScore: number;\n\t\t\tif (labelPrefixMatch) {\n\t\t\t\tbaseScore = LABEL_PREFIX_SCORE_THRESHOLD;\n\n\t\t\t\t// We give another boost to labels that are short, e.g. given\n\t\t\t\t// files \"window.ts\" and \"windowActions.ts\" and a query of\n\t\t\t\t// \"window\", we want \"window.ts\" to receive a higher score.\n\t\t\t\t// As such we compute the percentage the query has within the\n\t\t\t\t// label and add that to the baseScore.\n\t\t\t\tconst prefixLengthBoost = Math.round((query.normalized.length / label.length) * 100);\n\t\t\t\tbaseScore += prefixLengthBoost;\n\t\t\t} else {\n\t\t\t\tbaseScore = LABEL_SCORE_THRESHOLD;\n\t\t\t}\n\n\t\t\treturn { score: baseScore + labelScore, labelMatch: labelPrefixMatch || createMatches(labelPositions) };\n\t\t}\n\t}\n\n\t// Finally compute description + label scores if we have a description\n\tif (description) {\n\t\tlet descriptionPrefix = description;\n\t\tif (!!path) {\n\t\t\tdescriptionPrefix = `${description}${sep}`; // assume this is a file path\n\t\t}\n\n\t\tconst descriptionPrefixLength = descriptionPrefix.length;\n\t\tconst descriptionAndLabel = `${descriptionPrefix}${label}`;\n\n\t\tconst [labelDescriptionScore, labelDescriptionPositions] = scoreFuzzy(descriptionAndLabel, query.normalized, query.normalizedLowercase, fuzzy);\n\t\tif (labelDescriptionScore) {\n\t\t\tconst labelDescriptionMatches = createMatches(labelDescriptionPositions);\n\t\t\tconst labelMatch: IMatch[] = [];\n\t\t\tconst descriptionMatch: IMatch[] = [];\n\n\t\t\t// We have to split the matches back onto the label and description portions\n\t\t\tlabelDescriptionMatches.forEach(h => {\n\n\t\t\t\t// Match overlaps label and description part, we need to split it up\n\t\t\t\tif (h.start < descriptionPrefixLength && h.end > descriptionPrefixLength) {\n\t\t\t\t\tlabelMatch.push({ start: 0, end: h.end - descriptionPrefixLength });\n\t\t\t\t\tdescriptionMatch.push({ start: h.start, end: descriptionPrefixLength });\n\t\t\t\t}\n\n\t\t\t\t// Match on label part\n\t\t\t\telse if (h.start >= descriptionPrefixLength) {\n\t\t\t\t\tlabelMatch.push({ start: h.start - descriptionPrefixLength, end: h.end - descriptionPrefixLength });\n\t\t\t\t}\n\n\t\t\t\t// Match on description part\n\t\t\t\telse {\n\t\t\t\t\tdescriptionMatch.push(h);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn { score: labelDescriptionScore, labelMatch, descriptionMatch };\n\t\t}\n\t}\n\n\treturn NO_ITEM_SCORE;\n}\n\nfunction createMatches(offsets: number[] | undefined): IMatch[] {\n\tconst ret: IMatch[] = [];\n\tif (!offsets) {\n\t\treturn ret;\n\t}\n\n\tlet last: IMatch | undefined;\n\tfor (const pos of offsets) {\n\t\tif (last && last.end === pos) {\n\t\t\tlast.end += 1;\n\t\t} else {\n\t\t\tlast = { start: pos, end: pos + 1 };\n\t\t\tret.push(last);\n\t\t}\n\t}\n\n\treturn ret;\n}\n\nfunction normalizeMatches(matches: IMatch[]): IMatch[] {\n\n\t// sort matches by start to be able to normalize\n\tconst sortedMatches = matches.sort((matchA, matchB) => {\n\t\treturn matchA.start - matchB.start;\n\t});\n\n\t// merge matches that overlap\n\tconst normalizedMatches: IMatch[] = [];\n\tlet currentMatch: IMatch | undefined = undefined;\n\tfor (const match of sortedMatches) {\n\n\t\t// if we have no current match or the matches\n\t\t// do not overlap, we take it as is and remember\n\t\t// it for future merging\n\t\tif (!currentMatch || !matchOverlaps(currentMatch, match)) {\n\t\t\tcurrentMatch = match;\n\t\t\tnormalizedMatches.push(match);\n\t\t}\n\n\t\t// otherwise we merge the matches\n\t\telse {\n\t\t\tcurrentMatch.start = Math.min(currentMatch.start, match.start);\n\t\t\tcurrentMatch.end = Math.max(currentMatch.end, match.end);\n\t\t}\n\t}\n\n\treturn normalizedMatches;\n}\n\nfunction matchOverlaps(matchA: IMatch, matchB: IMatch): boolean {\n\tif (matchA.end < matchB.start) {\n\t\treturn false;\t// A ends before B starts\n\t}\n\n\tif (matchB.end < matchA.start) {\n\t\treturn false; // B ends before A starts\n\t}\n\n\treturn true;\n}\n\n//#endregion\n\n\n//#region Comparers\n\nexport function compareItemsByFuzzyScore<T>(itemA: T, itemB: T, query: IPreparedQuery, fuzzy: boolean, accessor: IItemAccessor<T>, cache: FuzzyScorerCache): number {\n\tconst itemScoreA = scoreItemFuzzy(itemA, query, fuzzy, accessor, cache);\n\tconst itemScoreB = scoreItemFuzzy(itemB, query, fuzzy, accessor, cache);\n\n\tconst scoreA = itemScoreA.score;\n\tconst scoreB = itemScoreB.score;\n\n\t// 1.) identity matches have highest score\n\tif (scoreA === PATH_IDENTITY_SCORE || scoreB === PATH_IDENTITY_SCORE) {\n\t\tif (scoreA !== scoreB) {\n\t\t\treturn scoreA === PATH_IDENTITY_SCORE ? -1 : 1;\n\t\t}\n\t}\n\n\t// 2.) matches on label are considered higher compared to label+description matches\n\tif (scoreA > LABEL_SCORE_THRESHOLD || scoreB > LABEL_SCORE_THRESHOLD) {\n\t\tif (scoreA !== scoreB) {\n\t\t\treturn scoreA > scoreB ? -1 : 1;\n\t\t}\n\n\t\t// prefer more compact matches over longer in label (unless this is a prefix match where\n\t\t// longer prefix matches are actually preferred)\n\t\tif (scoreA < LABEL_PREFIX_SCORE_THRESHOLD && scoreB < LABEL_PREFIX_SCORE_THRESHOLD) {\n\t\t\tconst comparedByMatchLength = compareByMatchLength(itemScoreA.labelMatch, itemScoreB.labelMatch);\n\t\t\tif (comparedByMatchLength !== 0) {\n\t\t\t\treturn comparedByMatchLength;\n\t\t\t}\n\t\t}\n\n\t\t// prefer shorter labels over longer labels\n\t\tconst labelA = accessor.getItemLabel(itemA) || '';\n\t\tconst labelB = accessor.getItemLabel(itemB) || '';\n\t\tif (labelA.length !== labelB.length) {\n\t\t\treturn labelA.length - labelB.length;\n\t\t}\n\t}\n\n\t// 3.) compare by score in label+description\n\tif (scoreA !== scoreB) {\n\t\treturn scoreA > scoreB ? -1 : 1;\n\t}\n\n\t// 4.) scores are identical: prefer matches in label over non-label matches\n\tconst itemAHasLabelMatches = Array.isArray(itemScoreA.labelMatch) && itemScoreA.labelMatch.length > 0;\n\tconst itemBHasLabelMatches = Array.isArray(itemScoreB.labelMatch) && itemScoreB.labelMatch.length > 0;\n\tif (itemAHasLabelMatches && !itemBHasLabelMatches) {\n\t\treturn -1;\n\t} else if (itemBHasLabelMatches && !itemAHasLabelMatches) {\n\t\treturn 1;\n\t}\n\n\t// 5.) scores are identical: prefer more compact matches (label and description)\n\tconst itemAMatchDistance = computeLabelAndDescriptionMatchDistance(itemA, itemScoreA, accessor);\n\tconst itemBMatchDistance = computeLabelAndDescriptionMatchDistance(itemB, itemScoreB, accessor);\n\tif (itemAMatchDistance && itemBMatchDistance && itemAMatchDistance !== itemBMatchDistance) {\n\t\treturn itemBMatchDistance > itemAMatchDistance ? -1 : 1;\n\t}\n\n\t// 6.) scores are identical: start to use the fallback compare\n\treturn fallbackCompare(itemA, itemB, query, accessor);\n}\n\nfunction computeLabelAndDescriptionMatchDistance<T>(item: T, score: IItemScore, accessor: IItemAccessor<T>): number {\n\tlet matchStart: number = -1;\n\tlet matchEnd: number = -1;\n\n\t// If we have description matches, the start is first of description match\n\tif (score.descriptionMatch && score.descriptionMatch.length) {\n\t\tmatchStart = score.descriptionMatch[0].start;\n\t}\n\n\t// Otherwise, the start is the first label match\n\telse if (score.labelMatch && score.labelMatch.length) {\n\t\tmatchStart = score.labelMatch[0].start;\n\t}\n\n\t// If we have label match, the end is the last label match\n\t// If we had a description match, we add the length of the description\n\t// as offset to the end to indicate this.\n\tif (score.labelMatch && score.labelMatch.length) {\n\t\tmatchEnd = score.labelMatch[score.labelMatch.length - 1].end;\n\t\tif (score.descriptionMatch && score.descriptionMatch.length) {\n\t\t\tconst itemDescription = accessor.getItemDescription(item);\n\t\t\tif (itemDescription) {\n\t\t\t\tmatchEnd += itemDescription.length;\n\t\t\t}\n\t\t}\n\t}\n\n\t// If we have just a description match, the end is the last description match\n\telse if (score.descriptionMatch && score.descriptionMatch.length) {\n\t\tmatchEnd = score.descriptionMatch[score.descriptionMatch.length - 1].end;\n\t}\n\n\treturn matchEnd - matchStart;\n}\n\nfunction compareByMatchLength(matchesA?: IMatch[], matchesB?: IMatch[]): number {\n\tif ((!matchesA && !matchesB) || ((!matchesA || !matchesA.length) && (!matchesB || !matchesB.length))) {\n\t\treturn 0; // make sure to not cause bad comparing when matches are not provided\n\t}\n\n\tif (!matchesB || !matchesB.length) {\n\t\treturn -1;\n\t}\n\n\tif (!matchesA || !matchesA.length) {\n\t\treturn 1;\n\t}\n\n\t// Compute match length of A (first to last match)\n\tconst matchStartA = matchesA[0].start;\n\tconst matchEndA = matchesA[matchesA.length - 1].end;\n\tconst matchLengthA = matchEndA - matchStartA;\n\n\t// Compute match length of B (first to last match)\n\tconst matchStartB = matchesB[0].start;\n\tconst matchEndB = matchesB[matchesB.length - 1].end;\n\tconst matchLengthB = matchEndB - matchStartB;\n\n\t// Prefer shorter match length\n\treturn matchLengthA === matchLengthB ? 0 : matchLengthB < matchLengthA ? 1 : -1;\n}\n\nfunction fallbackCompare<T>(itemA: T, itemB: T, query: IPreparedQuery, accessor: IItemAccessor<T>): number {\n\n\t// check for label + description length and prefer shorter\n\tconst labelA = accessor.getItemLabel(itemA) || '';\n\tconst labelB = accessor.getItemLabel(itemB) || '';\n\n\tconst descriptionA = accessor.getItemDescription(itemA);\n\tconst descriptionB = accessor.getItemDescription(itemB);\n\n\tconst labelDescriptionALength = labelA.length + (descriptionA ? descriptionA.length : 0);\n\tconst labelDescriptionBLength = labelB.length + (descriptionB ? descriptionB.length : 0);\n\n\tif (labelDescriptionALength !== labelDescriptionBLength) {\n\t\treturn labelDescriptionALength - labelDescriptionBLength;\n\t}\n\n\t// check for path length and prefer shorter\n\tconst pathA = accessor.getItemPath(itemA);\n\tconst pathB = accessor.getItemPath(itemB);\n\n\tif (pathA && pathB && pathA.length !== pathB.length) {\n\t\treturn pathA.length - pathB.length;\n\t}\n\n\t// 7.) finally we have equal scores and equal length, we fallback to comparer\n\n\t// compare by label\n\tif (labelA !== labelB) {\n\t\treturn compareAnything(labelA, labelB, query.normalized);\n\t}\n\n\t// compare by description\n\tif (descriptionA && descriptionB && descriptionA !== descriptionB) {\n\t\treturn compareAnything(descriptionA, descriptionB, query.normalized);\n\t}\n\n\t// compare by path\n\tif (pathA && pathB && pathA !== pathB) {\n\t\treturn compareAnything(pathA, pathB, query.normalized);\n\t}\n\n\t// equal\n\treturn 0;\n}\n\n//#endregion\n\n\n//#region Query Normalizer\n\nexport interface IPreparedQueryPiece {\n\n\t/**\n\t * The original query as provided as input.\n\t */\n\toriginal: string;\n\toriginalLowercase: string;\n\n\t/**\n\t * Original normalized to platform separators:\n\t * - Windows: \\\n\t * - Posix: /\n\t */\n\tpathNormalized: string;\n\n\t/**\n\t * In addition to the normalized path, will have\n\t * whitespace and wildcards removed.\n\t */\n\tnormalized: string;\n\tnormalizedLowercase: string;\n}\n\nexport interface IPreparedQuery extends IPreparedQueryPiece {\n\n\t/**\n\t * Query split by spaces into pieces.\n\t */\n\tvalues: IPreparedQueryPiece[] | undefined;\n\n\t/**\n\t * Whether the query contains path separator(s) or not.\n\t */\n\tcontainsPathSeparator: boolean;\n}\n\n/**\n * Helper function to prepare a search value for scoring by removing unwanted characters\n * and allowing to score on multiple pieces separated by whitespace character.\n */\nconst MULTIPLE_QUERY_VALUES_SEPARATOR = ' ';\nexport function prepareQuery(original: string): IPreparedQuery {\n\tif (typeof original !== 'string') {\n\t\toriginal = '';\n\t}\n\n\tconst originalLowercase = original.toLowerCase();\n\tconst { pathNormalized, normalized, normalizedLowercase } = normalizeQuery(original);\n\tconst containsPathSeparator = pathNormalized.indexOf(sep) >= 0;\n\n\tlet values: IPreparedQueryPiece[] | undefined = undefined;\n\n\tconst originalSplit = original.split(MULTIPLE_QUERY_VALUES_SEPARATOR);\n\tif (originalSplit.length > 1) {\n\t\tfor (const originalPiece of originalSplit) {\n\t\t\tconst {\n\t\t\t\tpathNormalized: pathNormalizedPiece,\n\t\t\t\tnormalized: normalizedPiece,\n\t\t\t\tnormalizedLowercase: normalizedLowercasePiece\n\t\t\t} = normalizeQuery(originalPiece);\n\n\t\t\tif (normalizedPiece) {\n\t\t\t\tif (!values) {\n\t\t\t\t\tvalues = [];\n\t\t\t\t}\n\n\t\t\t\tvalues.push({\n\t\t\t\t\toriginal: originalPiece,\n\t\t\t\t\toriginalLowercase: originalPiece.toLowerCase(),\n\t\t\t\t\tpathNormalized: pathNormalizedPiece,\n\t\t\t\t\tnormalized: normalizedPiece,\n\t\t\t\t\tnormalizedLowercase: normalizedLowercasePiece\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\treturn { original, originalLowercase, pathNormalized, normalized, normalizedLowercase, values, containsPathSeparator };\n}\n\nfunction normalizeQuery(original: string): { pathNormalized: string, normalized: string, normalizedLowercase: string } {\n\tlet pathNormalized: string;\n\tif (isWindows) {\n\t\tpathNormalized = original.replace(/\\//g, sep); // Help Windows users to search for paths when using slash\n\t} else {\n\t\tpathNormalized = original.replace(/\\\\/g, sep); // Help macOS/Linux users to search for paths when using backslash\n\t}\n\n\tconst normalized = stripWildcards(pathNormalized).replace(/\\s/g, '');\n\n\treturn {\n\t\tpathNormalized,\n\t\tnormalized,\n\t\tnormalizedLowercase: normalized.toLowerCase()\n\t};\n}\n\nexport function pieceToQuery(piece: IPreparedQueryPiece): IPreparedQuery;\nexport function pieceToQuery(pieces: IPreparedQueryPiece[]): IPreparedQuery;\nexport function pieceToQuery(arg1: IPreparedQueryPiece | IPreparedQueryPiece[]): IPreparedQuery {\n\tif (Array.isArray(arg1)) {\n\t\treturn prepareQuery(arg1.map(piece => piece.original).join(MULTIPLE_QUERY_VALUES_SEPARATOR));\n\t}\n\n\treturn prepareQuery(arg1.original);\n}\n\n//#endregion\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as strings from 'vs/base/common/strings';\nimport * as extpath from 'vs/base/common/extpath';\nimport * as paths from 'vs/base/common/path';\nimport { LRUCache } from 'vs/base/common/map';\nimport { CharCode } from 'vs/base/common/charCode';\nimport { isThenable } from 'vs/base/common/async';\n\nexport interface IExpression {\n\t[pattern: string]: boolean | SiblingClause;\n}\n\nexport interface IRelativePattern {\n\tbase: string;\n\tpattern: string;\n}\n\nexport function getEmptyExpression(): IExpression {\n\treturn Object.create(null);\n}\n\nexport interface SiblingClause {\n\twhen: string;\n}\n\nconst GLOBSTAR = '**';\nconst GLOB_SPLIT = '/';\nconst PATH_REGEX = '[/\\\\\\\\]';\t\t// any slash or backslash\nconst NO_PATH_REGEX = '[^/\\\\\\\\]';\t// any non-slash and non-backslash\nconst ALL_FORWARD_SLASHES = /\\//g;\n\nfunction starsToRegExp(starCount: number): string {\n\tswitch (starCount) {\n\t\tcase 0:\n\t\t\treturn '';\n\t\tcase 1:\n\t\t\treturn `${NO_PATH_REGEX}*?`; // 1 star matches any number of characters except path separator (/ and \\) - non greedy (?)\n\t\tdefault:\n\t\t\t// Matches:  (Path Sep OR Path Val followed by Path Sep OR Path Sep followed by Path Val) 0-many times\n\t\t\t// Group is non capturing because we don't need to capture at all (?:...)\n\t\t\t// Overall we use non-greedy matching because it could be that we match too much\n\t\t\treturn `(?:${PATH_REGEX}|${NO_PATH_REGEX}+${PATH_REGEX}|${PATH_REGEX}${NO_PATH_REGEX}+)*?`;\n\t}\n}\n\nexport function splitGlobAware(pattern: string, splitChar: string): string[] {\n\tif (!pattern) {\n\t\treturn [];\n\t}\n\n\tconst segments: string[] = [];\n\n\tlet inBraces = false;\n\tlet inBrackets = false;\n\n\tlet curVal = '';\n\tfor (const char of pattern) {\n\t\tswitch (char) {\n\t\t\tcase splitChar:\n\t\t\t\tif (!inBraces && !inBrackets) {\n\t\t\t\t\tsegments.push(curVal);\n\t\t\t\t\tcurVal = '';\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase '{':\n\t\t\t\tinBraces = true;\n\t\t\t\tbreak;\n\t\t\tcase '}':\n\t\t\t\tinBraces = false;\n\t\t\t\tbreak;\n\t\t\tcase '[':\n\t\t\t\tinBrackets = true;\n\t\t\t\tbreak;\n\t\t\tcase ']':\n\t\t\t\tinBrackets = false;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tcurVal += char;\n\t}\n\n\t// Tail\n\tif (curVal) {\n\t\tsegments.push(curVal);\n\t}\n\n\treturn segments;\n}\n\nfunction parseRegExp(pattern: string): string {\n\tif (!pattern) {\n\t\treturn '';\n\t}\n\n\tlet regEx = '';\n\n\t// Split up into segments for each slash found\n\tconst segments = splitGlobAware(pattern, GLOB_SPLIT);\n\n\t// Special case where we only have globstars\n\tif (segments.every(s => s === GLOBSTAR)) {\n\t\tregEx = '.*';\n\t}\n\n\t// Build regex over segments\n\telse {\n\t\tlet previousSegmentWasGlobStar = false;\n\t\tsegments.forEach((segment, index) => {\n\n\t\t\t// Globstar is special\n\t\t\tif (segment === GLOBSTAR) {\n\n\t\t\t\t// if we have more than one globstar after another, just ignore it\n\t\t\t\tif (!previousSegmentWasGlobStar) {\n\t\t\t\t\tregEx += starsToRegExp(2);\n\t\t\t\t\tpreviousSegmentWasGlobStar = true;\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// States\n\t\t\tlet inBraces = false;\n\t\t\tlet braceVal = '';\n\n\t\t\tlet inBrackets = false;\n\t\t\tlet bracketVal = '';\n\n\t\t\tfor (const char of segment) {\n\t\t\t\t// Support brace expansion\n\t\t\t\tif (char !== '}' && inBraces) {\n\t\t\t\t\tbraceVal += char;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Support brackets\n\t\t\t\tif (inBrackets && (char !== ']' || !bracketVal) /* ] is literally only allowed as first character in brackets to match it */) {\n\t\t\t\t\tlet res: string;\n\n\t\t\t\t\t// range operator\n\t\t\t\t\tif (char === '-') {\n\t\t\t\t\t\tres = char;\n\t\t\t\t\t}\n\n\t\t\t\t\t// negation operator (only valid on first index in bracket)\n\t\t\t\t\telse if ((char === '^' || char === '!') && !bracketVal) {\n\t\t\t\t\t\tres = '^';\n\t\t\t\t\t}\n\n\t\t\t\t\t// glob split matching is not allowed within character ranges\n\t\t\t\t\t// see http://man7.org/linux/man-pages/man7/glob.7.html\n\t\t\t\t\telse if (char === GLOB_SPLIT) {\n\t\t\t\t\t\tres = '';\n\t\t\t\t\t}\n\n\t\t\t\t\t// anything else gets escaped\n\t\t\t\t\telse {\n\t\t\t\t\t\tres = strings.escapeRegExpCharacters(char);\n\t\t\t\t\t}\n\n\t\t\t\t\tbracketVal += res;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tswitch (char) {\n\t\t\t\t\tcase '{':\n\t\t\t\t\t\tinBraces = true;\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tcase '[':\n\t\t\t\t\t\tinBrackets = true;\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tcase '}':\n\t\t\t\t\t\tconst choices = splitGlobAware(braceVal, ',');\n\n\t\t\t\t\t\t// Converts {foo,bar} => [foo|bar]\n\t\t\t\t\t\tconst braceRegExp = `(?:${choices.map(c => parseRegExp(c)).join('|')})`;\n\n\t\t\t\t\t\tregEx += braceRegExp;\n\n\t\t\t\t\t\tinBraces = false;\n\t\t\t\t\t\tbraceVal = '';\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase ']':\n\t\t\t\t\t\tregEx += ('[' + bracketVal + ']');\n\n\t\t\t\t\t\tinBrackets = false;\n\t\t\t\t\t\tbracketVal = '';\n\n\t\t\t\t\t\tbreak;\n\n\n\t\t\t\t\tcase '?':\n\t\t\t\t\t\tregEx += NO_PATH_REGEX; // 1 ? matches any single character except path separator (/ and \\)\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tcase '*':\n\t\t\t\t\t\tregEx += starsToRegExp(1);\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tregEx += strings.escapeRegExpCharacters(char);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Tail: Add the slash we had split on if there is more to come and the remaining pattern is not a globstar\n\t\t\t// For example if pattern: some/**/*.js we want the \"/\" after some to be included in the RegEx to prevent\n\t\t\t// a folder called \"something\" to match as well.\n\t\t\t// However, if pattern: some/**, we tolerate that we also match on \"something\" because our globstar behaviour\n\t\t\t// is to match 0-N segments.\n\t\t\tif (index < segments.length - 1 && (segments[index + 1] !== GLOBSTAR || index + 2 < segments.length)) {\n\t\t\t\tregEx += PATH_REGEX;\n\t\t\t}\n\n\t\t\t// reset state\n\t\t\tpreviousSegmentWasGlobStar = false;\n\t\t});\n\t}\n\n\treturn regEx;\n}\n\n// regexes to check for trival glob patterns that just check for String#endsWith\nconst T1 = /^\\*\\*\\/\\*\\.[\\w\\.-]+$/; \t\t\t\t\t\t   \t\t\t// **/*.something\nconst T2 = /^\\*\\*\\/([\\w\\.-]+)\\/?$/; \t\t\t\t\t\t\t   \t\t\t// **/something\nconst T3 = /^{\\*\\*\\/[\\*\\.]?[\\w\\.-]+\\/?(,\\*\\*\\/[\\*\\.]?[\\w\\.-]+\\/?)*}$/; \t// {**/*.something,**/*.else} or {**/package.json,**/project.json}\nconst T3_2 = /^{\\*\\*\\/[\\*\\.]?[\\w\\.-]+(\\/(\\*\\*)?)?(,\\*\\*\\/[\\*\\.]?[\\w\\.-]+(\\/(\\*\\*)?)?)*}$/; \t// Like T3, with optional trailing /**\nconst T4 = /^\\*\\*((\\/[\\w\\.-]+)+)\\/?$/; \t\t\t\t\t\t   \t\t\t// **/something/else\nconst T5 = /^([\\w\\.-]+(\\/[\\w\\.-]+)*)\\/?$/; \t\t\t\t\t\t   \t\t// something/else\n\nexport type ParsedPattern = (path: string, basename?: string) => boolean;\n\n// The ParsedExpression returns a Promise iff hasSibling returns a Promise.\nexport type ParsedExpression = (path: string, basename?: string, hasSibling?: (name: string) => boolean | Promise<boolean>) => string | null | Promise<string | null> /* the matching pattern */;\n\nexport interface IGlobOptions {\n\t/**\n\t * Simplify patterns for use as exclusion filters during tree traversal to skip entire subtrees. Cannot be used outside of a tree traversal.\n\t */\n\ttrimForExclusions?: boolean;\n}\n\ninterface ParsedStringPattern {\n\t(path: string, basename?: string): string | null | Promise<string | null> /* the matching pattern */;\n\tbasenames?: string[];\n\tpatterns?: string[];\n\tallBasenames?: string[];\n\tallPaths?: string[];\n}\ninterface ParsedExpressionPattern {\n\t(path: string, basename?: string, name?: string, hasSibling?: (name: string) => boolean | Promise<boolean>): string | null | Promise<string | null> /* the matching pattern */;\n\trequiresSiblings?: boolean;\n\tallBasenames?: string[];\n\tallPaths?: string[];\n}\n\nconst CACHE = new LRUCache<string, ParsedStringPattern>(10000); // bounded to 10000 elements\n\nconst FALSE = function () {\n\treturn false;\n};\n\nconst NULL = function (): string | null {\n\treturn null;\n};\n\nfunction parsePattern(arg1: string | IRelativePattern, options: IGlobOptions): ParsedStringPattern {\n\tif (!arg1) {\n\t\treturn NULL;\n\t}\n\n\t// Handle IRelativePattern\n\tlet pattern: string;\n\tif (typeof arg1 !== 'string') {\n\t\tpattern = arg1.pattern;\n\t} else {\n\t\tpattern = arg1;\n\t}\n\n\t// Whitespace trimming\n\tpattern = pattern.trim();\n\n\t// Check cache\n\tconst patternKey = `${pattern}_${!!options.trimForExclusions}`;\n\tlet parsedPattern = CACHE.get(patternKey);\n\tif (parsedPattern) {\n\t\treturn wrapRelativePattern(parsedPattern, arg1);\n\t}\n\n\t// Check for Trivias\n\tlet match: RegExpExecArray | null;\n\tif (T1.test(pattern)) { // common pattern: **/*.txt just need endsWith check\n\t\tconst base = pattern.substr(4); // '**/*'.length === 4\n\t\tparsedPattern = function (path, basename) {\n\t\t\treturn typeof path === 'string' && path.endsWith(base) ? pattern : null;\n\t\t};\n\t} else if (match = T2.exec(trimForExclusions(pattern, options))) { // common pattern: **/some.txt just need basename check\n\t\tparsedPattern = trivia2(match[1], pattern);\n\t} else if ((options.trimForExclusions ? T3_2 : T3).test(pattern)) { // repetition of common patterns (see above) {**/*.txt,**/*.png}\n\t\tparsedPattern = trivia3(pattern, options);\n\t} else if (match = T4.exec(trimForExclusions(pattern, options))) { // common pattern: **/something/else just need endsWith check\n\t\tparsedPattern = trivia4and5(match[1].substr(1), pattern, true);\n\t} else if (match = T5.exec(trimForExclusions(pattern, options))) { // common pattern: something/else just need equals check\n\t\tparsedPattern = trivia4and5(match[1], pattern, false);\n\t}\n\n\t// Otherwise convert to pattern\n\telse {\n\t\tparsedPattern = toRegExp(pattern);\n\t}\n\n\t// Cache\n\tCACHE.set(patternKey, parsedPattern);\n\n\treturn wrapRelativePattern(parsedPattern, arg1);\n}\n\nfunction wrapRelativePattern(parsedPattern: ParsedStringPattern, arg2: string | IRelativePattern): ParsedStringPattern {\n\tif (typeof arg2 === 'string') {\n\t\treturn parsedPattern;\n\t}\n\n\treturn function (path, basename) {\n\t\tif (!extpath.isEqualOrParent(path, arg2.base)) {\n\t\t\treturn null;\n\t\t}\n\t\treturn parsedPattern(paths.relative(arg2.base, path), basename);\n\t};\n}\n\nfunction trimForExclusions(pattern: string, options: IGlobOptions): string {\n\treturn options.trimForExclusions && pattern.endsWith('/**') ? pattern.substr(0, pattern.length - 2) : pattern; // dropping **, tailing / is dropped later\n}\n\n// common pattern: **/some.txt just need basename check\nfunction trivia2(base: string, originalPattern: string): ParsedStringPattern {\n\tconst slashBase = `/${base}`;\n\tconst backslashBase = `\\\\${base}`;\n\tconst parsedPattern: ParsedStringPattern = function (path, basename) {\n\t\tif (typeof path !== 'string') {\n\t\t\treturn null;\n\t\t}\n\t\tif (basename) {\n\t\t\treturn basename === base ? originalPattern : null;\n\t\t}\n\t\treturn path === base || path.endsWith(slashBase) || path.endsWith(backslashBase) ? originalPattern : null;\n\t};\n\tconst basenames = [base];\n\tparsedPattern.basenames = basenames;\n\tparsedPattern.patterns = [originalPattern];\n\tparsedPattern.allBasenames = basenames;\n\treturn parsedPattern;\n}\n\n// repetition of common patterns (see above) {**/*.txt,**/*.png}\nfunction trivia3(pattern: string, options: IGlobOptions): ParsedStringPattern {\n\tconst parsedPatterns = aggregateBasenameMatches(pattern.slice(1, -1).split(',')\n\t\t.map(pattern => parsePattern(pattern, options))\n\t\t.filter(pattern => pattern !== NULL), pattern);\n\tconst n = parsedPatterns.length;\n\tif (!n) {\n\t\treturn NULL;\n\t}\n\tif (n === 1) {\n\t\treturn <ParsedStringPattern>parsedPatterns[0];\n\t}\n\tconst parsedPattern: ParsedStringPattern = function (path: string, basename?: string) {\n\t\tfor (let i = 0, n = parsedPatterns.length; i < n; i++) {\n\t\t\tif ((<ParsedStringPattern>parsedPatterns[i])(path, basename)) {\n\t\t\t\treturn pattern;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t};\n\tconst withBasenames = parsedPatterns.find(pattern => !!(<ParsedStringPattern>pattern).allBasenames);\n\tif (withBasenames) {\n\t\tparsedPattern.allBasenames = (<ParsedStringPattern>withBasenames).allBasenames;\n\t}\n\tconst allPaths = parsedPatterns.reduce((all, current) => current.allPaths ? all.concat(current.allPaths) : all, <string[]>[]);\n\tif (allPaths.length) {\n\t\tparsedPattern.allPaths = allPaths;\n\t}\n\treturn parsedPattern;\n}\n\n// common patterns: **/something/else just need endsWith check, something/else just needs and equals check\nfunction trivia4and5(targetPath: string, pattern: string, matchPathEnds: boolean): ParsedStringPattern {\n\tconst usingPosixSep = paths.sep === paths.posix.sep;\n\tconst nativePath = usingPosixSep ? targetPath : targetPath.replace(ALL_FORWARD_SLASHES, paths.sep);\n\tconst nativePathEnd = paths.sep + nativePath;\n\tconst targetPathEnd = paths.posix.sep + targetPath;\n\n\tconst parsedPattern: ParsedStringPattern = matchPathEnds ? function (testPath, basename) {\n\t\treturn typeof testPath === 'string' &&\n\t\t\t((testPath === nativePath || testPath.endsWith(nativePathEnd))\n\t\t\t\t|| !usingPosixSep && (testPath === targetPath || testPath.endsWith(targetPathEnd)))\n\t\t\t? pattern : null;\n\t} : function (testPath, basename) {\n\t\treturn typeof testPath === 'string' &&\n\t\t\t(testPath === nativePath\n\t\t\t\t|| (!usingPosixSep && testPath === targetPath))\n\t\t\t? pattern : null;\n\t};\n\tparsedPattern.allPaths = [(matchPathEnds ? '*/' : './') + targetPath];\n\treturn parsedPattern;\n}\n\nfunction toRegExp(pattern: string): ParsedStringPattern {\n\ttry {\n\t\tconst regExp = new RegExp(`^${parseRegExp(pattern)}$`);\n\t\treturn function (path: string) {\n\t\t\tregExp.lastIndex = 0; // reset RegExp to its initial state to reuse it!\n\t\t\treturn typeof path === 'string' && regExp.test(path) ? pattern : null;\n\t\t};\n\t} catch (error) {\n\t\treturn NULL;\n\t}\n}\n\n/**\n * Simplified glob matching. Supports a subset of glob patterns:\n * - * matches anything inside a path segment\n * - ? matches 1 character inside a path segment\n * - ** matches anything including an empty path segment\n * - simple brace expansion ({js,ts} => js or ts)\n * - character ranges (using [...])\n */\nexport function match(pattern: string | IRelativePattern, path: string): boolean;\nexport function match(expression: IExpression, path: string, hasSibling?: (name: string) => boolean): string /* the matching pattern */;\nexport function match(arg1: string | IExpression | IRelativePattern, path: string, hasSibling?: (name: string) => boolean): boolean | string | null | Promise<string | null> {\n\tif (!arg1 || typeof path !== 'string') {\n\t\treturn false;\n\t}\n\n\treturn parse(<IExpression>arg1)(path, undefined, hasSibling);\n}\n\n/**\n * Simplified glob matching. Supports a subset of glob patterns:\n * - * matches anything inside a path segment\n * - ? matches 1 character inside a path segment\n * - ** matches anything including an empty path segment\n * - simple brace expansion ({js,ts} => js or ts)\n * - character ranges (using [...])\n */\nexport function parse(pattern: string | IRelativePattern, options?: IGlobOptions): ParsedPattern;\nexport function parse(expression: IExpression, options?: IGlobOptions): ParsedExpression;\nexport function parse(arg1: string | IExpression | IRelativePattern, options: IGlobOptions = {}): ParsedPattern | ParsedExpression {\n\tif (!arg1) {\n\t\treturn FALSE;\n\t}\n\n\t// Glob with String\n\tif (typeof arg1 === 'string' || isRelativePattern(arg1)) {\n\t\tconst parsedPattern = parsePattern(arg1, options);\n\t\tif (parsedPattern === NULL) {\n\t\t\treturn FALSE;\n\t\t}\n\t\tconst resultPattern: ParsedPattern & { allBasenames?: string[]; allPaths?: string[]; } = function (path: string, basename?: string) {\n\t\t\treturn !!parsedPattern(path, basename);\n\t\t};\n\t\tif (parsedPattern.allBasenames) {\n\t\t\tresultPattern.allBasenames = parsedPattern.allBasenames;\n\t\t}\n\t\tif (parsedPattern.allPaths) {\n\t\t\tresultPattern.allPaths = parsedPattern.allPaths;\n\t\t}\n\t\treturn resultPattern;\n\t}\n\n\t// Glob with Expression\n\treturn parsedExpression(<IExpression>arg1, options);\n}\n\nexport function hasSiblingPromiseFn(siblingsFn?: () => Promise<string[]>) {\n\tif (!siblingsFn) {\n\t\treturn undefined;\n\t}\n\n\tlet siblings: Promise<Record<string, true>>;\n\treturn (name: string) => {\n\t\tif (!siblings) {\n\t\t\tsiblings = (siblingsFn() || Promise.resolve([]))\n\t\t\t\t.then(list => list ? listToMap(list) : {});\n\t\t}\n\t\treturn siblings.then(map => !!map[name]);\n\t};\n}\n\nexport function hasSiblingFn(siblingsFn?: () => string[]) {\n\tif (!siblingsFn) {\n\t\treturn undefined;\n\t}\n\n\tlet siblings: Record<string, true>;\n\treturn (name: string) => {\n\t\tif (!siblings) {\n\t\t\tconst list = siblingsFn();\n\t\t\tsiblings = list ? listToMap(list) : {};\n\t\t}\n\t\treturn !!siblings[name];\n\t};\n}\n\nfunction listToMap(list: string[]) {\n\tconst map: Record<string, true> = {};\n\tfor (const key of list) {\n\t\tmap[key] = true;\n\t}\n\treturn map;\n}\n\nexport function isRelativePattern(obj: unknown): obj is IRelativePattern {\n\tconst rp = obj as IRelativePattern;\n\n\treturn rp && typeof rp.base === 'string' && typeof rp.pattern === 'string';\n}\n\nexport function getBasenameTerms(patternOrExpression: ParsedPattern | ParsedExpression): string[] {\n\treturn (<ParsedStringPattern>patternOrExpression).allBasenames || [];\n}\n\nexport function getPathTerms(patternOrExpression: ParsedPattern | ParsedExpression): string[] {\n\treturn (<ParsedStringPattern>patternOrExpression).allPaths || [];\n}\n\nfunction parsedExpression(expression: IExpression, options: IGlobOptions): ParsedExpression {\n\tconst parsedPatterns = aggregateBasenameMatches(Object.getOwnPropertyNames(expression)\n\t\t.map(pattern => parseExpressionPattern(pattern, expression[pattern], options))\n\t\t.filter(pattern => pattern !== NULL));\n\n\tconst n = parsedPatterns.length;\n\tif (!n) {\n\t\treturn NULL;\n\t}\n\n\tif (!parsedPatterns.some(parsedPattern => !!(<ParsedExpressionPattern>parsedPattern).requiresSiblings)) {\n\t\tif (n === 1) {\n\t\t\treturn <ParsedStringPattern>parsedPatterns[0];\n\t\t}\n\n\t\tconst resultExpression: ParsedStringPattern = function (path: string, basename?: string) {\n\t\t\tfor (let i = 0, n = parsedPatterns.length; i < n; i++) {\n\t\t\t\t// Pattern matches path\n\t\t\t\tconst result = (<ParsedStringPattern>parsedPatterns[i])(path, basename);\n\t\t\t\tif (result) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn null;\n\t\t};\n\n\t\tconst withBasenames = parsedPatterns.find(pattern => !!(<ParsedStringPattern>pattern).allBasenames);\n\t\tif (withBasenames) {\n\t\t\tresultExpression.allBasenames = (<ParsedStringPattern>withBasenames).allBasenames;\n\t\t}\n\n\t\tconst allPaths = parsedPatterns.reduce((all, current) => current.allPaths ? all.concat(current.allPaths) : all, <string[]>[]);\n\t\tif (allPaths.length) {\n\t\t\tresultExpression.allPaths = allPaths;\n\t\t}\n\n\t\treturn resultExpression;\n\t}\n\n\tconst resultExpression: ParsedStringPattern = function (path: string, basename?: string, hasSibling?: (name: string) => boolean | Promise<boolean>) {\n\t\tlet name: string | undefined = undefined;\n\n\t\tfor (let i = 0, n = parsedPatterns.length; i < n; i++) {\n\t\t\t// Pattern matches path\n\t\t\tconst parsedPattern = (<ParsedExpressionPattern>parsedPatterns[i]);\n\t\t\tif (parsedPattern.requiresSiblings && hasSibling) {\n\t\t\t\tif (!basename) {\n\t\t\t\t\tbasename = paths.basename(path);\n\t\t\t\t}\n\t\t\t\tif (!name) {\n\t\t\t\t\tname = basename.substr(0, basename.length - paths.extname(path).length);\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst result = parsedPattern(path, basename, name, hasSibling);\n\t\t\tif (result) {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t};\n\n\tconst withBasenames = parsedPatterns.find(pattern => !!(<ParsedStringPattern>pattern).allBasenames);\n\tif (withBasenames) {\n\t\tresultExpression.allBasenames = (<ParsedStringPattern>withBasenames).allBasenames;\n\t}\n\n\tconst allPaths = parsedPatterns.reduce((all, current) => current.allPaths ? all.concat(current.allPaths) : all, <string[]>[]);\n\tif (allPaths.length) {\n\t\tresultExpression.allPaths = allPaths;\n\t}\n\n\treturn resultExpression;\n}\n\nfunction parseExpressionPattern(pattern: string, value: boolean | SiblingClause, options: IGlobOptions): (ParsedStringPattern | ParsedExpressionPattern) {\n\tif (value === false) {\n\t\treturn NULL; // pattern is disabled\n\t}\n\n\tconst parsedPattern = parsePattern(pattern, options);\n\tif (parsedPattern === NULL) {\n\t\treturn NULL;\n\t}\n\n\t// Expression Pattern is <boolean>\n\tif (typeof value === 'boolean') {\n\t\treturn parsedPattern;\n\t}\n\n\t// Expression Pattern is <SiblingClause>\n\tif (value) {\n\t\tconst when = (<SiblingClause>value).when;\n\t\tif (typeof when === 'string') {\n\t\t\tconst result: ParsedExpressionPattern = (path: string, basename?: string, name?: string, hasSibling?: (name: string) => boolean | Promise<boolean>) => {\n\t\t\t\tif (!hasSibling || !parsedPattern(path, basename)) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tconst clausePattern = when.replace('$(basename)', name!);\n\t\t\t\tconst matched = hasSibling(clausePattern);\n\t\t\t\treturn isThenable(matched) ?\n\t\t\t\t\tmatched.then(m => m ? pattern : null) :\n\t\t\t\t\tmatched ? pattern : null;\n\t\t\t};\n\t\t\tresult.requiresSiblings = true;\n\t\t\treturn result;\n\t\t}\n\t}\n\n\t// Expression is Anything\n\treturn parsedPattern;\n}\n\nfunction aggregateBasenameMatches(parsedPatterns: Array<ParsedStringPattern | ParsedExpressionPattern>, result?: string): Array<ParsedStringPattern | ParsedExpressionPattern> {\n\tconst basenamePatterns = parsedPatterns.filter(parsedPattern => !!(<ParsedStringPattern>parsedPattern).basenames);\n\tif (basenamePatterns.length < 2) {\n\t\treturn parsedPatterns;\n\t}\n\n\tconst basenames = basenamePatterns.reduce<string[]>((all, current) => {\n\t\tconst basenames = (<ParsedStringPattern>current).basenames;\n\t\treturn basenames ? all.concat(basenames) : all;\n\t}, <string[]>[]);\n\tlet patterns: string[];\n\tif (result) {\n\t\tpatterns = [];\n\t\tfor (let i = 0, n = basenames.length; i < n; i++) {\n\t\t\tpatterns.push(result);\n\t\t}\n\t} else {\n\t\tpatterns = basenamePatterns.reduce((all, current) => {\n\t\t\tconst patterns = (<ParsedStringPattern>current).patterns;\n\t\t\treturn patterns ? all.concat(patterns) : all;\n\t\t}, <string[]>[]);\n\t}\n\tconst aggregate: ParsedStringPattern = function (path, basename) {\n\t\tif (typeof path !== 'string') {\n\t\t\treturn null;\n\t\t}\n\t\tif (!basename) {\n\t\t\tlet i: number;\n\t\t\tfor (i = path.length; i > 0; i--) {\n\t\t\t\tconst ch = path.charCodeAt(i - 1);\n\t\t\t\tif (ch === CharCode.Slash || ch === CharCode.Backslash) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbasename = path.substr(i);\n\t\t}\n\t\tconst index = basenames.indexOf(basename);\n\t\treturn index !== -1 ? patterns[index] : null;\n\t};\n\taggregate.basenames = basenames;\n\taggregate.patterns = patterns;\n\taggregate.allBasenames = basenames;\n\n\tconst aggregatedPatterns = parsedPatterns.filter(parsedPattern => !(<ParsedStringPattern>parsedPattern).basenames);\n\taggregatedPatterns.push(aggregate);\n\treturn aggregatedPatterns;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { matchesFuzzy, IMatch } from 'vs/base/common/filters';\nimport { ltrim } from 'vs/base/common/strings';\n\nexport const iconStartMarker = '$(';\n\nconst escapeIconsRegex = /(\\\\)?\\$\\([a-z0-9\\-]+?(?:~[a-z0-9\\-]*?)?\\)/gi;\nexport function escapeIcons(text: string): string {\n\treturn text.replace(escapeIconsRegex, (match, escaped) => escaped ? match : `\\\\${match}`);\n}\n\nconst markdownEscapedIconsRegex = /\\\\\\$\\([a-z0-9\\-]+?(?:~[a-z0-9\\-]*?)?\\)/gi;\nexport function markdownEscapeEscapedIcons(text: string): string {\n\t// Need to add an extra \\ for escaping in markdown\n\treturn text.replace(markdownEscapedIconsRegex, match => `\\\\${match}`);\n}\n\nconst markdownUnescapeIconsRegex = /(\\\\)?\\$\\\\\\(([a-z0-9\\-]+?(?:~[a-z0-9\\-]*?)?)\\\\\\)/gi;\nexport function markdownUnescapeIcons(text: string): string {\n\treturn text.replace(markdownUnescapeIconsRegex, (match, escaped, iconId) => escaped ? match : `$(${iconId})`);\n}\n\nconst stripIconsRegex = /(\\s)?(\\\\)?\\$\\([a-z0-9\\-]+?(?:~[a-z0-9\\-]*?)?\\)(\\s)?/gi;\nexport function stripIcons(text: string): string {\n\tif (text.indexOf(iconStartMarker) === -1) {\n\t\treturn text;\n\t}\n\n\treturn text.replace(stripIconsRegex, (match, preWhitespace, escaped, postWhitespace) => escaped ? match : preWhitespace || postWhitespace || '');\n}\n\n\nexport interface IParsedLabelWithIcons {\n\treadonly text: string;\n\treadonly iconOffsets?: readonly number[];\n}\n\nexport function parseLabelWithIcons(text: string): IParsedLabelWithIcons {\n\tconst firstIconIndex = text.indexOf(iconStartMarker);\n\tif (firstIconIndex === -1) {\n\t\treturn { text }; // return early if the word does not include an icon\n\t}\n\n\treturn doParseLabelWithIcons(text, firstIconIndex);\n}\n\nfunction doParseLabelWithIcons(text: string, firstIconIndex: number): IParsedLabelWithIcons {\n\tconst iconOffsets: number[] = [];\n\tlet textWithoutIcons: string = '';\n\n\tfunction appendChars(chars: string) {\n\t\tif (chars) {\n\t\t\ttextWithoutIcons += chars;\n\n\t\t\tfor (const _ of chars) {\n\t\t\t\ticonOffsets.push(iconsOffset); // make sure to fill in icon offsets\n\t\t\t}\n\t\t}\n\t}\n\n\tlet currentIconStart = -1;\n\tlet currentIconValue: string = '';\n\tlet iconsOffset = 0;\n\n\tlet char: string;\n\tlet nextChar: string;\n\n\tlet offset = firstIconIndex;\n\tconst length = text.length;\n\n\t// Append all characters until the first icon\n\tappendChars(text.substr(0, firstIconIndex));\n\n\t// example: $(file-symlink-file) my cool $(other-icon) entry\n\twhile (offset < length) {\n\t\tchar = text[offset];\n\t\tnextChar = text[offset + 1];\n\n\t\t// beginning of icon: some value $( <--\n\t\tif (char === iconStartMarker[0] && nextChar === iconStartMarker[1]) {\n\t\t\tcurrentIconStart = offset;\n\n\t\t\t// if we had a previous potential icon value without\n\t\t\t// the closing ')', it was actually not an icon and\n\t\t\t// so we have to add it to the actual value\n\t\t\tappendChars(currentIconValue);\n\n\t\t\tcurrentIconValue = iconStartMarker;\n\n\t\t\toffset++; // jump over '('\n\t\t}\n\n\t\t// end of icon: some value $(some-icon) <--\n\t\telse if (char === ')' && currentIconStart !== -1) {\n\t\t\tconst currentIconLength = offset - currentIconStart + 1; // +1 to include the closing ')'\n\t\t\ticonsOffset += currentIconLength;\n\t\t\tcurrentIconStart = -1;\n\t\t\tcurrentIconValue = '';\n\t\t}\n\n\t\t// within icon\n\t\telse if (currentIconStart !== -1) {\n\t\t\t// Make sure this is a real icon name\n\t\t\tif (/^[a-z0-9\\-]$/i.test(char)) {\n\t\t\t\tcurrentIconValue += char;\n\t\t\t} else {\n\t\t\t\t// This is not a real icon, treat it as text\n\t\t\t\tappendChars(currentIconValue);\n\n\t\t\t\tcurrentIconStart = -1;\n\t\t\t\tcurrentIconValue = '';\n\t\t\t}\n\t\t}\n\n\t\t// any value outside of icon\n\t\telse {\n\t\t\tappendChars(char);\n\t\t}\n\n\t\toffset++;\n\t}\n\n\t// if we had a previous potential icon value without\n\t// the closing ')', it was actually not an icon and\n\t// so we have to add it to the actual value\n\tappendChars(currentIconValue);\n\n\treturn { text: textWithoutIcons, iconOffsets };\n}\n\nexport function matchesFuzzyIconAware(query: string, target: IParsedLabelWithIcons, enableSeparateSubstringMatching = false): IMatch[] | null {\n\tconst { text, iconOffsets } = target;\n\n\t// Return early if there are no icon markers in the word to match against\n\tif (!iconOffsets || iconOffsets.length === 0) {\n\t\treturn matchesFuzzy(query, text, enableSeparateSubstringMatching);\n\t}\n\n\t// Trim the word to match against because it could have leading\n\t// whitespace now if the word started with an icon\n\tconst wordToMatchAgainstWithoutIconsTrimmed = ltrim(text, ' ');\n\tconst leadingWhitespaceOffset = text.length - wordToMatchAgainstWithoutIconsTrimmed.length;\n\n\t// match on value without icon\n\tconst matches = matchesFuzzy(query, wordToMatchAgainstWithoutIconsTrimmed, enableSeparateSubstringMatching);\n\n\t// Map matches back to offsets with icon and trimming\n\tif (matches) {\n\t\tfor (const match of matches) {\n\t\t\tconst iconOffset = iconOffsets[match.start + leadingWhitespaceOffset] /* icon offsets at index */ + leadingWhitespaceOffset /* overall leading whitespace offset */;\n\t\t\tmatch.start += iconOffset;\n\t\t\tmatch.end += iconOffset;\n\t\t}\n\t}\n\n\treturn matches;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { equals } from 'vs/base/common/arrays';\nimport { UriComponents } from 'vs/base/common/uri';\nimport { escapeIcons } from 'vs/base/common/iconLabels';\nimport { illegalArgument } from 'vs/base/common/errors';\n\nexport interface IMarkdownString {\n\treadonly value: string;\n\treadonly isTrusted?: boolean;\n\treadonly supportThemeIcons?: boolean;\n\turis?: { [href: string]: UriComponents };\n}\n\nexport const enum MarkdownStringTextNewlineStyle {\n\tParagraph = 0,\n\tBreak = 1,\n}\n\nexport class MarkdownString implements IMarkdownString {\n\n\tpublic value: string;\n\tpublic isTrusted?: boolean;\n\tpublic supportThemeIcons?: boolean;\n\n\tconstructor(\n\t\tvalue: string = '',\n\t\tisTrustedOrOptions: boolean | { isTrusted?: boolean, supportThemeIcons?: boolean } = false,\n\t) {\n\t\tthis.value = value;\n\t\tif (typeof this.value !== 'string') {\n\t\t\tthrow illegalArgument('value');\n\t\t}\n\n\t\tif (typeof isTrustedOrOptions === 'boolean') {\n\t\t\tthis.isTrusted = isTrustedOrOptions;\n\t\t\tthis.supportThemeIcons = false;\n\t\t}\n\t\telse {\n\t\t\tthis.isTrusted = isTrustedOrOptions.isTrusted ?? undefined;\n\t\t\tthis.supportThemeIcons = isTrustedOrOptions.supportThemeIcons ?? false;\n\t\t}\n\t}\n\n\tappendText(value: string, newlineStyle: MarkdownStringTextNewlineStyle = MarkdownStringTextNewlineStyle.Paragraph): MarkdownString {\n\t\tthis.value += escapeMarkdownSyntaxTokens(this.supportThemeIcons ? escapeIcons(value) : value)\n\t\t\t.replace(/([ \\t]+)/g, (_match, g1) => '&nbsp;'.repeat(g1.length))\n\t\t\t.replace(/^>/gm, '\\\\>')\n\t\t\t.replace(/\\n/g, newlineStyle === MarkdownStringTextNewlineStyle.Break ? '\\\\\\n' : '\\n\\n');\n\n\t\treturn this;\n\t}\n\n\tappendMarkdown(value: string): MarkdownString {\n\t\tthis.value += value;\n\t\treturn this;\n\t}\n\n\tappendCodeblock(langId: string, code: string): MarkdownString {\n\t\tthis.value += '\\n```';\n\t\tthis.value += langId;\n\t\tthis.value += '\\n';\n\t\tthis.value += code;\n\t\tthis.value += '\\n```\\n';\n\t\treturn this;\n\t}\n}\n\nexport function isEmptyMarkdownString(oneOrMany: IMarkdownString | IMarkdownString[] | null | undefined): boolean {\n\tif (isMarkdownString(oneOrMany)) {\n\t\treturn !oneOrMany.value;\n\t} else if (Array.isArray(oneOrMany)) {\n\t\treturn oneOrMany.every(isEmptyMarkdownString);\n\t} else {\n\t\treturn true;\n\t}\n}\n\nexport function isMarkdownString(thing: any): thing is IMarkdownString {\n\tif (thing instanceof MarkdownString) {\n\t\treturn true;\n\t} else if (thing && typeof thing === 'object') {\n\t\treturn typeof (<IMarkdownString>thing).value === 'string'\n\t\t\t&& (typeof (<IMarkdownString>thing).isTrusted === 'boolean' || (<IMarkdownString>thing).isTrusted === undefined)\n\t\t\t&& (typeof (<IMarkdownString>thing).supportThemeIcons === 'boolean' || (<IMarkdownString>thing).supportThemeIcons === undefined);\n\t}\n\treturn false;\n}\n\nexport function markedStringsEquals(a: IMarkdownString | IMarkdownString[], b: IMarkdownString | IMarkdownString[]): boolean {\n\tif (!a && !b) {\n\t\treturn true;\n\t} else if (!a || !b) {\n\t\treturn false;\n\t} else if (Array.isArray(a) && Array.isArray(b)) {\n\t\treturn equals(a, b, markdownStringEqual);\n\t} else if (isMarkdownString(a) && isMarkdownString(b)) {\n\t\treturn markdownStringEqual(a, b);\n\t} else {\n\t\treturn false;\n\t}\n}\n\nfunction markdownStringEqual(a: IMarkdownString, b: IMarkdownString): boolean {\n\tif (a === b) {\n\t\treturn true;\n\t} else if (!a || !b) {\n\t\treturn false;\n\t} else {\n\t\treturn a.value === b.value && a.isTrusted === b.isTrusted && a.supportThemeIcons === b.supportThemeIcons;\n\t}\n}\n\nexport function escapeMarkdownSyntaxTokens(text: string): string {\n\t// escape markdown syntax tokens: http://daringfireball.net/projects/markdown/syntax#backslash\n\treturn text.replace(/[\\\\`*_{}[\\]()#+\\-.!]/g, '\\\\$&');\n}\n\nexport function removeMarkdownEscapes(text: string): string {\n\tif (!text) {\n\t\treturn text;\n\t}\n\treturn text.replace(/\\\\([\\\\`*_{}[\\]()#+\\-.!])/g, '$1');\n}\n\nexport function parseHrefAndDimensions(href: string): { href: string, dimensions: string[] } {\n\tconst dimensions: string[] = [];\n\tconst splitted = href.split('|').map(s => s.trim());\n\thref = splitted[0];\n\tconst parameters = splitted[1];\n\tif (parameters) {\n\t\tconst heightFromParams = /height=(\\d+)/.exec(parameters);\n\t\tconst widthFromParams = /width=(\\d+)/.exec(parameters);\n\t\tconst height = heightFromParams ? heightFromParams[1] : '';\n\t\tconst width = widthFromParams ? widthFromParams[1] : '';\n\t\tconst widthIsFinite = isFinite(parseInt(width));\n\t\tconst heightIsFinite = isFinite(parseInt(height));\n\t\tif (widthIsFinite) {\n\t\t\tdimensions.push(`width=\"${width}\"`);\n\t\t}\n\t\tif (heightIsFinite) {\n\t\t\tdimensions.push(`height=\"${height}\"`);\n\t\t}\n\t}\n\treturn { href, dimensions };\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { VSBuffer } from 'vs/base/common/buffer';\nimport { regExpFlags } from 'vs/base/common/strings';\nimport { URI, UriComponents } from 'vs/base/common/uri';\n\nexport function stringify(obj: any): string {\n\treturn JSON.stringify(obj, replacer);\n}\n\nexport function parse(text: string): any {\n\tlet data = JSON.parse(text);\n\tdata = revive(data);\n\treturn data;\n}\n\nexport interface MarshalledObject {\n\t$mid: number;\n}\n\nfunction replacer(key: string, value: any): any {\n\t// URI is done via toJSON-member\n\tif (value instanceof RegExp) {\n\t\treturn {\n\t\t\t$mid: 2,\n\t\t\tsource: value.source,\n\t\t\tflags: regExpFlags(value),\n\t\t};\n\t}\n\treturn value;\n}\n\n\ntype Deserialize<T> = T extends UriComponents ? URI\n\t: T extends object\n\t? Revived<T>\n\t: T;\n\nexport type Revived<T> = { [K in keyof T]: Deserialize<T[K]> };\n\nexport function revive<T = any>(obj: any, depth = 0): Revived<T> {\n\tif (!obj || depth > 200) {\n\t\treturn obj;\n\t}\n\n\tif (typeof obj === 'object') {\n\n\t\tswitch ((<MarshalledObject>obj).$mid) {\n\t\t\tcase 1: return <any>URI.revive(obj);\n\t\t\tcase 2: return <any>new RegExp(obj.source, obj.flags);\n\t\t}\n\n\t\tif (\n\t\t\tobj instanceof VSBuffer\n\t\t\t|| obj instanceof Uint8Array\n\t\t) {\n\t\t\treturn <any>obj;\n\t\t}\n\n\t\tif (Array.isArray(obj)) {\n\t\t\tfor (let i = 0; i < obj.length; ++i) {\n\t\t\t\tobj[i] = revive(obj[i], depth + 1);\n\t\t\t}\n\t\t} else {\n\t\t\t// walk object\n\t\t\tfor (const key in obj) {\n\t\t\t\tif (Object.hasOwnProperty.call(obj, key)) {\n\t\t\t\t\tobj[key] = revive(obj[key], depth + 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn obj;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from 'vs/base/common/uri';\nimport * as platform from 'vs/base/common/platform';\n\nexport namespace Schemas {\n\n\t/**\n\t * A schema that is used for models that exist in memory\n\t * only and that have no correspondence on a server or such.\n\t */\n\texport const inMemory = 'inmemory';\n\n\t/**\n\t * A schema that is used for setting files\n\t */\n\texport const vscode = 'vscode';\n\n\t/**\n\t * A schema that is used for internal private files\n\t */\n\texport const internal = 'private';\n\n\t/**\n\t * A walk-through document.\n\t */\n\texport const walkThrough = 'walkThrough';\n\n\t/**\n\t * An embedded code snippet.\n\t */\n\texport const walkThroughSnippet = 'walkThroughSnippet';\n\n\texport const http = 'http';\n\n\texport const https = 'https';\n\n\texport const file = 'file';\n\n\texport const mailto = 'mailto';\n\n\texport const untitled = 'untitled';\n\n\texport const data = 'data';\n\n\texport const command = 'command';\n\n\texport const vscodeRemote = 'vscode-remote';\n\n\texport const vscodeRemoteResource = 'vscode-remote-resource';\n\n\texport const userData = 'vscode-userdata';\n\n\texport const vscodeCustomEditor = 'vscode-custom-editor';\n\n\texport const vscodeNotebook = 'vscode-notebook';\n\n\texport const vscodeNotebookCell = 'vscode-notebook-cell';\n\n\texport const vscodeNotebookCellMetadata = 'vscode-notebook-cell-metadata';\n\n\texport const vscodeSettings = 'vscode-settings';\n\n\texport const webviewPanel = 'webview-panel';\n\n\t/**\n\t * Scheme used for loading the wrapper html and script in webviews.\n\t */\n\texport const vscodeWebview = 'vscode-webview';\n\n\t/**\n\t * Scheme used for loading resources inside of webviews.\n\t */\n\texport const vscodeWebviewResource = 'vscode-webview-resource';\n\n\t/**\n\t * Scheme used for extension pages\n\t */\n\texport const extension = 'extension';\n\n\t/**\n\t * Scheme used as a replacement of `file` scheme to load\n\t * files with our custom protocol handler (desktop only).\n\t */\n\texport const vscodeFileResource = 'vscode-file';\n}\n\nclass RemoteAuthoritiesImpl {\n\tprivate readonly _hosts: { [authority: string]: string | undefined; } = Object.create(null);\n\tprivate readonly _ports: { [authority: string]: number | undefined; } = Object.create(null);\n\tprivate readonly _connectionTokens: { [authority: string]: string | undefined; } = Object.create(null);\n\tprivate _preferredWebSchema: 'http' | 'https' = 'http';\n\tprivate _delegate: ((uri: URI) => URI) | null = null;\n\n\tsetPreferredWebSchema(schema: 'http' | 'https') {\n\t\tthis._preferredWebSchema = schema;\n\t}\n\n\tsetDelegate(delegate: (uri: URI) => URI): void {\n\t\tthis._delegate = delegate;\n\t}\n\n\tset(authority: string, host: string, port: number): void {\n\t\tthis._hosts[authority] = host;\n\t\tthis._ports[authority] = port;\n\t}\n\n\tsetConnectionToken(authority: string, connectionToken: string): void {\n\t\tthis._connectionTokens[authority] = connectionToken;\n\t}\n\n\trewrite(uri: URI): URI {\n\t\tif (this._delegate) {\n\t\t\treturn this._delegate(uri);\n\t\t}\n\t\tconst authority = uri.authority;\n\t\tlet host = this._hosts[authority];\n\t\tif (host && host.indexOf(':') !== -1) {\n\t\t\thost = `[${host}]`;\n\t\t}\n\t\t// const port = this._ports[authority];\n\t\tconst connectionToken = this._connectionTokens[authority];\n\t\tlet query = `path=${encodeURIComponent(uri.path)}`;\n\t\tif (typeof connectionToken === 'string') {\n\t\t\tquery += `&tkn=${encodeURIComponent(connectionToken)}`;\n\t\t}\n\t\t// NOTE@coder: Changed this to work against the current path.\n\t\treturn URI.from({\n\t\t\tscheme: platform.isWeb ? this._preferredWebSchema : Schemas.vscodeRemoteResource,\n\t\t\tauthority: window.location.host,\n\t\t\tpath: `${window.location.pathname.replace(/\\/+$/, '')}/vscode-remote-resource`,\n\t\t\tquery\n\t\t});\n\t}\n}\n\nexport const RemoteAuthorities = new RemoteAuthoritiesImpl();\n\nclass FileAccessImpl {\n\n\tprivate readonly FALLBACK_AUTHORITY = 'vscode-app';\n\n\t/**\n\t * Returns a URI to use in contexts where the browser is responsible\n\t * for loading (e.g. fetch()) or when used within the DOM.\n\t *\n\t * **Note:** use `dom.ts#asCSSUrl` whenever the URL is to be used in CSS context.\n\t */\n\tasBrowserUri(uri: URI): URI;\n\tasBrowserUri(moduleId: string, moduleIdToUrl: { toUrl(moduleId: string): string }, __forceCodeFileUri?: boolean): URI;\n\tasBrowserUri(uriOrModule: URI | string, moduleIdToUrl?: { toUrl(moduleId: string): string }, __forceCodeFileUri?: boolean): URI {\n\t\tconst uri = this.toUri(uriOrModule, moduleIdToUrl);\n\n\t\t// Handle remote URIs via `RemoteAuthorities`\n\t\tif (uri.scheme === Schemas.vscodeRemote) {\n\t\t\treturn RemoteAuthorities.rewrite(uri);\n\t\t}\n\n\t\t// Only convert the URI if we are in a native context and it has `file:` scheme\n\t\t// and we have explicitly enabled the conversion (sandbox, or ENABLE_VSCODE_BROWSER_CODE_LOADING)\n\t\tif (platform.isNative && (__forceCodeFileUri || platform.isPreferringBrowserCodeLoad) && uri.scheme === Schemas.file) {\n\t\t\treturn uri.with({\n\t\t\t\tscheme: Schemas.vscodeFileResource,\n\t\t\t\t// We need to provide an authority here so that it can serve\n\t\t\t\t// as origin for network and loading matters in chromium.\n\t\t\t\t// If the URI is not coming with an authority already, we\n\t\t\t\t// add our own\n\t\t\t\tauthority: uri.authority || this.FALLBACK_AUTHORITY,\n\t\t\t\tquery: null,\n\t\t\t\tfragment: null\n\t\t\t});\n\t\t}\n\n\t\treturn uri;\n\t}\n\n\t/**\n\t * Returns the `file` URI to use in contexts where node.js\n\t * is responsible for loading.\n\t */\n\tasFileUri(uri: URI): URI;\n\tasFileUri(moduleId: string, moduleIdToUrl: { toUrl(moduleId: string): string }): URI;\n\tasFileUri(uriOrModule: URI | string, moduleIdToUrl?: { toUrl(moduleId: string): string }): URI {\n\t\tconst uri = this.toUri(uriOrModule, moduleIdToUrl);\n\n\t\t// Only convert the URI if it is `vscode-file:` scheme\n\t\tif (uri.scheme === Schemas.vscodeFileResource) {\n\t\t\treturn uri.with({\n\t\t\t\tscheme: Schemas.file,\n\t\t\t\t// Only preserve the `authority` if it is different from\n\t\t\t\t// our fallback authority. This ensures we properly preserve\n\t\t\t\t// Windows UNC paths that come with their own authority.\n\t\t\t\tauthority: uri.authority !== this.FALLBACK_AUTHORITY ? uri.authority : null,\n\t\t\t\tquery: null,\n\t\t\t\tfragment: null\n\t\t\t});\n\t\t}\n\n\t\treturn uri;\n\t}\n\n\tprivate toUri(uriOrModule: URI | string, moduleIdToUrl?: { toUrl(moduleId: string): string }): URI {\n\t\tif (URI.isUri(uriOrModule)) {\n\t\t\treturn uriOrModule;\n\t\t}\n\n\t\treturn URI.parse(moduleIdToUrl!.toUrl(uriOrModule));\n\t}\n}\n\nexport const FileAccess = new FileAccessImpl();\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { LRUCache } from 'vs/base/common/map';\n\n/**\n * The normalize() method returns the Unicode Normalization Form of a given string. The form will be\n * the Normalization Form Canonical Composition.\n *\n * @see {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/normalize}\n */\nexport const canNormalize = typeof (String.prototype as any /* standalone editor compilation */).normalize === 'function';\n\nconst nfcCache = new LRUCache<string, string>(10000); // bounded to 10000 elements\nexport function normalizeNFC(str: string): string {\n\treturn normalize(str, 'NFC', nfcCache);\n}\n\nconst nfdCache = new LRUCache<string, string>(10000); // bounded to 10000 elements\nexport function normalizeNFD(str: string): string {\n\treturn normalize(str, 'NFD', nfdCache);\n}\n\nconst nonAsciiCharactersPattern = /[^\\u0000-\\u0080]/;\nfunction normalize(str: string, form: string, normalizedCache: LRUCache<string, string>): string {\n\tif (!canNormalize || !str) {\n\t\treturn str;\n\t}\n\n\tconst cached = normalizedCache.get(str);\n\tif (cached) {\n\t\treturn cached;\n\t}\n\n\tlet res: string;\n\tif (nonAsciiCharactersPattern.test(str)) {\n\t\tres = (<any>str).normalize(form);\n\t} else {\n\t\tres = str;\n\t}\n\n\t// Use the cache for fast lookup\n\tnormalizedCache.set(str, res);\n\n\treturn res;\n}\n\nexport const removeAccents: (str: string) => string = (function () {\n\tif (!canNormalize) {\n\t\t// no ES6 features...\n\t\treturn function (str: string) { return str; };\n\t} else {\n\t\t// transform into NFD form and remove accents\n\t\t// see: https://stackoverflow.com/questions/990904/remove-accents-diacritics-in-a-string-in-javascript/37511463#37511463\n\t\tconst regex = /[\\u0300-\\u036f]/g;\n\t\treturn function (str: string) {\n\t\t\treturn normalizeNFD(str).replace(regex, '');\n\t\t};\n\t}\n})();\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as extpath from 'vs/base/common/extpath';\nimport * as paths from 'vs/base/common/path';\nimport { URI, uriToFsPath } from 'vs/base/common/uri';\nimport { equalsIgnoreCase, compare as strCompare } from 'vs/base/common/strings';\nimport { Schemas } from 'vs/base/common/network';\nimport { isWindows, isLinux } from 'vs/base/common/platform';\nimport { CharCode } from 'vs/base/common/charCode';\n\nexport function originalFSPath(uri: URI): string {\n\treturn uriToFsPath(uri, true);\n}\n\n//#region IExtUri\n\nexport interface IExtUri {\n\n\t// --- identity\n\n\t/**\n\t * Compares two uris.\n\t *\n\t * @param uri1 Uri\n\t * @param uri2 Uri\n\t * @param ignoreFragment Ignore the fragment (defaults to `false`)\n\t */\n\tcompare(uri1: URI, uri2: URI, ignoreFragment?: boolean): number;\n\n\t/**\n\t * Tests whether two uris are equal\n\t *\n\t * @param uri1 Uri\n\t * @param uri2 Uri\n\t * @param ignoreFragment Ignore the fragment (defaults to `false`)\n\t */\n\tisEqual(uri1: URI | undefined, uri2: URI | undefined, ignoreFragment?: boolean): boolean;\n\n\t/**\n\t * Tests whether a `candidate` URI is a parent or equal of a given `base` URI.\n\t *\n\t * @param base A uri which is \"longer\"\n\t * @param parentCandidate A uri which is \"shorter\" then `base`\n\t * @param ignoreFragment Ignore the fragment (defaults to `false`)\n\t */\n\tisEqualOrParent(base: URI, parentCandidate: URI, ignoreFragment?: boolean): boolean;\n\n\t/**\n\t * Creates a key from a resource URI to be used to resource comparison and for resource maps.\n\t * @see ResourceMap\n\t * @param uri Uri\n\t * @param ignoreFragment Ignore the fragment (defaults to `false`)\n\t */\n\tgetComparisonKey(uri: URI, ignoreFragment?: boolean): string;\n\n\t/**\n\t * Whether the casing of the path-component of the uri should be ignored.\n\t */\n\tignorePathCasing(uri: URI): boolean;\n\n\t// --- path math\n\n\tbasenameOrAuthority(resource: URI): string;\n\n\t/**\n\t * Returns the basename of the path component of an uri.\n\t * @param resource\n\t */\n\tbasename(resource: URI): string;\n\n\t/**\n\t * Returns the extension of the path component of an uri.\n\t * @param resource\n\t */\n\textname(resource: URI): string;\n\t/**\n\t * Return a URI representing the directory of a URI path.\n\t *\n\t * @param resource The input URI.\n\t * @returns The URI representing the directory of the input URI.\n\t */\n\tdirname(resource: URI): URI;\n\t/**\n\t * Join a URI path with path fragments and normalizes the resulting path.\n\t *\n\t * @param resource The input URI.\n\t * @param pathFragment The path fragment to add to the URI path.\n\t * @returns The resulting URI.\n\t */\n\tjoinPath(resource: URI, ...pathFragment: string[]): URI\n\t/**\n\t * Normalizes the path part of a URI: Resolves `.` and `..` elements with directory names.\n\t *\n\t * @param resource The URI to normalize the path.\n\t * @returns The URI with the normalized path.\n\t */\n\tnormalizePath(resource: URI): URI;\n\t/**\n\t *\n\t * @param from\n\t * @param to\n\t */\n\trelativePath(from: URI, to: URI): string | undefined;\n\t/**\n\t * Resolves an absolute or relative path against a base URI.\n\t * The path can be relative or absolute posix or a Windows path\n\t */\n\tresolvePath(base: URI, path: string): URI;\n\n\t// --- misc\n\n\t/**\n\t * Returns true if the URI path is absolute.\n\t */\n\tisAbsolutePath(resource: URI): boolean;\n\t/**\n\t * Tests whether the two authorities are the same\n\t */\n\tisEqualAuthority(a1: string, a2: string): boolean;\n\t/**\n\t * Returns true if the URI path has a trailing path separator\n\t */\n\thasTrailingPathSeparator(resource: URI, sep?: string): boolean;\n\t/**\n\t * Removes a trailing path separator, if there's one.\n\t * Important: Doesn't remove the first slash, it would make the URI invalid\n\t */\n\tremoveTrailingPathSeparator(resource: URI, sep?: string): URI;\n\t/**\n\t * Adds a trailing path separator to the URI if there isn't one already.\n\t * For example, c:\\ would be unchanged, but c:\\users would become c:\\users\\\n\t */\n\taddTrailingPathSeparator(resource: URI, sep?: string): URI;\n}\n\nexport class ExtUri implements IExtUri {\n\n\tconstructor(private _ignorePathCasing: (uri: URI) => boolean) { }\n\n\tcompare(uri1: URI, uri2: URI, ignoreFragment: boolean = false): number {\n\t\tif (uri1 === uri2) {\n\t\t\treturn 0;\n\t\t}\n\t\treturn strCompare(this.getComparisonKey(uri1, ignoreFragment), this.getComparisonKey(uri2, ignoreFragment));\n\t}\n\n\tisEqual(uri1: URI | undefined, uri2: URI | undefined, ignoreFragment: boolean = false): boolean {\n\t\tif (uri1 === uri2) {\n\t\t\treturn true;\n\t\t}\n\t\tif (!uri1 || !uri2) {\n\t\t\treturn false;\n\t\t}\n\t\treturn this.getComparisonKey(uri1, ignoreFragment) === this.getComparisonKey(uri2, ignoreFragment);\n\t}\n\n\tgetComparisonKey(uri: URI, ignoreFragment: boolean = false): string {\n\t\treturn uri.with({\n\t\t\tpath: this._ignorePathCasing(uri) ? uri.path.toLowerCase() : undefined,\n\t\t\tfragment: ignoreFragment ? null : undefined\n\t\t}).toString();\n\t}\n\n\tignorePathCasing(uri: URI): boolean {\n\t\treturn this._ignorePathCasing(uri);\n\t}\n\n\tisEqualOrParent(base: URI, parentCandidate: URI, ignoreFragment: boolean = false): boolean {\n\t\tif (base.scheme === parentCandidate.scheme) {\n\t\t\tif (base.scheme === Schemas.file) {\n\t\t\t\treturn extpath.isEqualOrParent(originalFSPath(base), originalFSPath(parentCandidate), this._ignorePathCasing(base)) && base.query === parentCandidate.query && (ignoreFragment || base.fragment === parentCandidate.fragment);\n\t\t\t}\n\t\t\tif (isEqualAuthority(base.authority, parentCandidate.authority)) {\n\t\t\t\treturn extpath.isEqualOrParent(base.path, parentCandidate.path, this._ignorePathCasing(base), '/') && base.query === parentCandidate.query && (ignoreFragment || base.fragment === parentCandidate.fragment);\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\t// --- path math\n\n\tjoinPath(resource: URI, ...pathFragment: string[]): URI {\n\t\treturn URI.joinPath(resource, ...pathFragment);\n\t}\n\n\tbasenameOrAuthority(resource: URI): string {\n\t\treturn basename(resource) || resource.authority;\n\t}\n\n\tbasename(resource: URI): string {\n\t\treturn paths.posix.basename(resource.path);\n\t}\n\n\textname(resource: URI): string {\n\t\treturn paths.posix.extname(resource.path);\n\t}\n\n\tdirname(resource: URI): URI {\n\t\tif (resource.path.length === 0) {\n\t\t\treturn resource;\n\t\t}\n\t\tlet dirname;\n\t\tif (resource.scheme === Schemas.file) {\n\t\t\tdirname = URI.file(paths.dirname(originalFSPath(resource))).path;\n\t\t} else {\n\t\t\tdirname = paths.posix.dirname(resource.path);\n\t\t\tif (resource.authority && dirname.length && dirname.charCodeAt(0) !== CharCode.Slash) {\n\t\t\t\tconsole.error(`dirname(\"${resource.toString})) resulted in a relative path`);\n\t\t\t\tdirname = '/'; // If a URI contains an authority component, then the path component must either be empty or begin with a CharCode.Slash (\"/\") character\n\t\t\t}\n\t\t}\n\t\treturn resource.with({\n\t\t\tpath: dirname\n\t\t});\n\t}\n\n\tnormalizePath(resource: URI): URI {\n\t\tif (!resource.path.length) {\n\t\t\treturn resource;\n\t\t}\n\t\tlet normalizedPath: string;\n\t\tif (resource.scheme === Schemas.file) {\n\t\t\tnormalizedPath = URI.file(paths.normalize(originalFSPath(resource))).path;\n\t\t} else {\n\t\t\tnormalizedPath = paths.posix.normalize(resource.path);\n\t\t}\n\t\treturn resource.with({\n\t\t\tpath: normalizedPath\n\t\t});\n\t}\n\n\trelativePath(from: URI, to: URI): string | undefined {\n\t\tif (from.scheme !== to.scheme || !isEqualAuthority(from.authority, to.authority)) {\n\t\t\treturn undefined;\n\t\t}\n\t\tif (from.scheme === Schemas.file) {\n\t\t\tconst relativePath = paths.relative(originalFSPath(from), originalFSPath(to));\n\t\t\treturn isWindows ? extpath.toSlashes(relativePath) : relativePath;\n\t\t}\n\t\tlet fromPath = from.path || '/', toPath = to.path || '/';\n\t\tif (this._ignorePathCasing(from)) {\n\t\t\t// make casing of fromPath match toPath\n\t\t\tlet i = 0;\n\t\t\tfor (const len = Math.min(fromPath.length, toPath.length); i < len; i++) {\n\t\t\t\tif (fromPath.charCodeAt(i) !== toPath.charCodeAt(i)) {\n\t\t\t\t\tif (fromPath.charAt(i).toLowerCase() !== toPath.charAt(i).toLowerCase()) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfromPath = toPath.substr(0, i) + fromPath.substr(i);\n\t\t}\n\t\treturn paths.posix.relative(fromPath, toPath);\n\t}\n\n\tresolvePath(base: URI, path: string): URI {\n\t\tif (base.scheme === Schemas.file) {\n\t\t\tconst newURI = URI.file(paths.resolve(originalFSPath(base), path));\n\t\t\treturn base.with({\n\t\t\t\tauthority: newURI.authority,\n\t\t\t\tpath: newURI.path\n\t\t\t});\n\t\t}\n\t\tif (path.indexOf('/') === -1) { // no slashes? it's likely a Windows path\n\t\t\tpath = extpath.toSlashes(path);\n\t\t\tif (/^[a-zA-Z]:(\\/|$)/.test(path)) { // starts with a drive letter\n\t\t\t\tpath = '/' + path;\n\t\t\t}\n\t\t}\n\t\treturn base.with({\n\t\t\tpath: paths.posix.resolve(base.path, path)\n\t\t});\n\t}\n\n\t// --- misc\n\n\tisAbsolutePath(resource: URI): boolean {\n\t\treturn !!resource.path && resource.path[0] === '/';\n\t}\n\n\tisEqualAuthority(a1: string, a2: string) {\n\t\treturn a1 === a2 || equalsIgnoreCase(a1, a2);\n\t}\n\n\thasTrailingPathSeparator(resource: URI, sep: string = paths.sep): boolean {\n\t\tif (resource.scheme === Schemas.file) {\n\t\t\tconst fsp = originalFSPath(resource);\n\t\t\treturn fsp.length > extpath.getRoot(fsp).length && fsp[fsp.length - 1] === sep;\n\t\t} else {\n\t\t\tconst p = resource.path;\n\t\t\treturn (p.length > 1 && p.charCodeAt(p.length - 1) === CharCode.Slash) && !(/^[a-zA-Z]:(\\/$|\\\\$)/.test(resource.fsPath)); // ignore the slash at offset 0\n\t\t}\n\t}\n\n\tremoveTrailingPathSeparator(resource: URI, sep: string = paths.sep): URI {\n\t\t// Make sure that the path isn't a drive letter. A trailing separator there is not removable.\n\t\tif (hasTrailingPathSeparator(resource, sep)) {\n\t\t\treturn resource.with({ path: resource.path.substr(0, resource.path.length - 1) });\n\t\t}\n\t\treturn resource;\n\t}\n\n\taddTrailingPathSeparator(resource: URI, sep: string = paths.sep): URI {\n\t\tlet isRootSep: boolean = false;\n\t\tif (resource.scheme === Schemas.file) {\n\t\t\tconst fsp = originalFSPath(resource);\n\t\t\tisRootSep = ((fsp !== undefined) && (fsp.length === extpath.getRoot(fsp).length) && (fsp[fsp.length - 1] === sep));\n\t\t} else {\n\t\t\tsep = '/';\n\t\t\tconst p = resource.path;\n\t\t\tisRootSep = p.length === 1 && p.charCodeAt(p.length - 1) === CharCode.Slash;\n\t\t}\n\t\tif (!isRootSep && !hasTrailingPathSeparator(resource, sep)) {\n\t\t\treturn resource.with({ path: resource.path + '/' });\n\t\t}\n\t\treturn resource;\n\t}\n}\n\n\n/**\n * Unbiased utility that takes uris \"as they are\". This means it can be interchanged with\n * uri#toString() usages. The following is true\n * ```\n * assertEqual(aUri.toString() === bUri.toString(), exturi.isEqual(aUri, bUri))\n * ```\n */\nexport const extUri = new ExtUri(() => false);\n\n/**\n * BIASED utility that _mostly_ ignored the case of urs paths. ONLY use this util if you\n * understand what you are doing.\n *\n * This utility is INCOMPATIBLE with `uri.toString()`-usages and both CANNOT be used interchanged.\n *\n * When dealing with uris from files or documents, `extUri` (the unbiased friend)is sufficient\n * because those uris come from a \"trustworthy source\". When creating unknown uris it's always\n * better to use `IUriIdentityService` which exposes an `IExtUri`-instance which knows when path\n * casing matters.\n */\nexport const extUriBiasedIgnorePathCase = new ExtUri(uri => {\n\t// A file scheme resource is in the same platform as code, so ignore case for non linux platforms\n\t// Resource can be from another platform. Lowering the case as an hack. Should come from File system provider\n\treturn uri.scheme === Schemas.file ? !isLinux : true;\n});\n\n\n/**\n * BIASED utility that always ignores the casing of uris paths. ONLY use this util if you\n * understand what you are doing.\n *\n * This utility is INCOMPATIBLE with `uri.toString()`-usages and both CANNOT be used interchanged.\n *\n * When dealing with uris from files or documents, `extUri` (the unbiased friend)is sufficient\n * because those uris come from a \"trustworthy source\". When creating unknown uris it's always\n * better to use `IUriIdentityService` which exposes an `IExtUri`-instance which knows when path\n * casing matters.\n */\nexport const extUriIgnorePathCase = new ExtUri(_ => true);\n\nexport const isEqual = extUri.isEqual.bind(extUri);\nexport const isEqualOrParent = extUri.isEqualOrParent.bind(extUri);\nexport const getComparisonKey = extUri.getComparisonKey.bind(extUri);\nexport const basenameOrAuthority = extUri.basenameOrAuthority.bind(extUri);\nexport const basename = extUri.basename.bind(extUri);\nexport const extname = extUri.extname.bind(extUri);\nexport const dirname = extUri.dirname.bind(extUri);\nexport const joinPath = extUri.joinPath.bind(extUri);\nexport const normalizePath = extUri.normalizePath.bind(extUri);\nexport const relativePath = extUri.relativePath.bind(extUri);\nexport const resolvePath = extUri.resolvePath.bind(extUri);\nexport const isAbsolutePath = extUri.isAbsolutePath.bind(extUri);\nexport const isEqualAuthority = extUri.isEqualAuthority.bind(extUri);\nexport const hasTrailingPathSeparator = extUri.hasTrailingPathSeparator.bind(extUri);\nexport const removeTrailingPathSeparator = extUri.removeTrailingPathSeparator.bind(extUri);\nexport const addTrailingPathSeparator = extUri.addTrailingPathSeparator.bind(extUri);\n\n//#endregion\n\nexport function distinctParents<T>(items: T[], resourceAccessor: (item: T) => URI): T[] {\n\tconst distinctParents: T[] = [];\n\tfor (let i = 0; i < items.length; i++) {\n\t\tconst candidateResource = resourceAccessor(items[i]);\n\t\tif (items.some((otherItem, index) => {\n\t\t\tif (index === i) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn isEqualOrParent(candidateResource, resourceAccessor(otherItem));\n\t\t})) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tdistinctParents.push(items[i]);\n\t}\n\n\treturn distinctParents;\n}\n\n/**\n * Data URI related helpers.\n */\nexport namespace DataUri {\n\n\texport const META_DATA_LABEL = 'label';\n\texport const META_DATA_DESCRIPTION = 'description';\n\texport const META_DATA_SIZE = 'size';\n\texport const META_DATA_MIME = 'mime';\n\n\texport function parseMetaData(dataUri: URI): Map<string, string> {\n\t\tconst metadata = new Map<string, string>();\n\n\t\t// Given a URI of:  data:image/png;size:2313;label:SomeLabel;description:SomeDescription;base64,77+9UE5...\n\t\t// the metadata is: size:2313;label:SomeLabel;description:SomeDescription\n\t\tconst meta = dataUri.path.substring(dataUri.path.indexOf(';') + 1, dataUri.path.lastIndexOf(';'));\n\t\tmeta.split(';').forEach(property => {\n\t\t\tconst [key, value] = property.split(':');\n\t\t\tif (key && value) {\n\t\t\t\tmetadata.set(key, value);\n\t\t\t}\n\t\t});\n\n\t\t// Given a URI of:  data:image/png;size:2313;label:SomeLabel;description:SomeDescription;base64,77+9UE5...\n\t\t// the mime is: image/png\n\t\tconst mime = dataUri.path.substring(0, dataUri.path.indexOf(';'));\n\t\tif (mime) {\n\t\t\tmetadata.set(META_DATA_MIME, mime);\n\t\t}\n\n\t\treturn metadata;\n\t}\n}\n\nexport function toLocalResource(resource: URI, authority: string | undefined, localScheme: string): URI {\n\tif (authority) {\n\t\tlet path = resource.path;\n\t\tif (path && path[0] !== paths.posix.sep) {\n\t\t\tpath = paths.posix.sep + path;\n\t\t}\n\n\t\treturn resource.with({ scheme: localScheme, authority, path });\n\t}\n\n\treturn resource.with({ scheme: localScheme });\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from 'vs/base/common/uri';\nimport { posix, normalize, win32, sep } from 'vs/base/common/path';\nimport { startsWithIgnoreCase, rtrim } from 'vs/base/common/strings';\nimport { Schemas } from 'vs/base/common/network';\nimport { isLinux, isWindows, isMacintosh } from 'vs/base/common/platform';\nimport { isEqual, basename, relativePath } from 'vs/base/common/resources';\nimport { hasDriveLetter, isRootOrDriveLetter } from 'vs/base/common/extpath';\n\nexport interface IWorkspaceFolderProvider {\n\tgetWorkspaceFolder(resource: URI): { uri: URI, name?: string; } | null;\n\tgetWorkspace(): {\n\t\tfolders: { uri: URI, name?: string; }[];\n\t};\n}\n\nexport interface IUserHomeProvider {\n\tuserHome?: URI;\n}\n\n/**\n * @deprecated use LabelService instead\n */\nexport function getPathLabel(resource: URI | string, userHomeProvider?: IUserHomeProvider, rootProvider?: IWorkspaceFolderProvider): string {\n\tif (typeof resource === 'string') {\n\t\tresource = URI.file(resource);\n\t}\n\n\t// return early if we can resolve a relative path label from the root\n\tif (rootProvider) {\n\t\tconst baseResource = rootProvider.getWorkspaceFolder(resource);\n\t\tif (baseResource) {\n\t\t\tconst hasMultipleRoots = rootProvider.getWorkspace().folders.length > 1;\n\n\t\t\tlet pathLabel: string;\n\t\t\tif (isEqual(baseResource.uri, resource)) {\n\t\t\t\tpathLabel = ''; // no label if paths are identical\n\t\t\t} else {\n\t\t\t\tpathLabel = relativePath(baseResource.uri, resource)!;\n\t\t\t}\n\n\t\t\tif (hasMultipleRoots) {\n\t\t\t\tconst rootName = baseResource.name ? baseResource.name : basename(baseResource.uri);\n\t\t\t\tpathLabel = pathLabel ? (rootName + ' • ' + pathLabel) : rootName; // always show root basename if there are multiple\n\t\t\t}\n\n\t\t\treturn pathLabel;\n\t\t}\n\t}\n\n\t// return if the resource is neither file:// nor untitled:// and no baseResource was provided\n\tif (resource.scheme !== Schemas.file && resource.scheme !== Schemas.untitled) {\n\t\treturn resource.with({ query: null, fragment: null }).toString(true);\n\t}\n\n\t// convert c:\\something => C:\\something\n\tif (hasDriveLetter(resource.fsPath)) {\n\t\treturn normalize(normalizeDriveLetter(resource.fsPath));\n\t}\n\n\t// normalize and tildify (macOS, Linux only)\n\tlet res = normalize(resource.fsPath);\n\tif (!isWindows && userHomeProvider?.userHome) {\n\t\tres = tildify(res, userHomeProvider.userHome.fsPath);\n\t}\n\n\treturn res;\n}\n\nexport function getBaseLabel(resource: URI | string): string;\nexport function getBaseLabel(resource: URI | string | undefined): string | undefined;\nexport function getBaseLabel(resource: URI | string | undefined): string | undefined {\n\tif (!resource) {\n\t\treturn undefined;\n\t}\n\n\tif (typeof resource === 'string') {\n\t\tresource = URI.file(resource);\n\t}\n\n\tconst base = basename(resource) || (resource.scheme === Schemas.file ? resource.fsPath : resource.path) /* can be empty string if '/' is passed in */;\n\n\t// convert c: => C:\n\tif (isWindows && isRootOrDriveLetter(base)) {\n\t\treturn normalizeDriveLetter(base);\n\t}\n\n\treturn base;\n}\n\nexport function normalizeDriveLetter(path: string): string {\n\tif (hasDriveLetter(path)) {\n\t\treturn path.charAt(0).toUpperCase() + path.slice(1);\n\t}\n\n\treturn path;\n}\n\nlet normalizedUserHomeCached: { original: string; normalized: string; } = Object.create(null);\nexport function tildify(path: string, userHome: string): string {\n\tif (isWindows || !path || !userHome) {\n\t\treturn path; // unsupported\n\t}\n\n\t// Keep a normalized user home path as cache to prevent accumulated string creation\n\tlet normalizedUserHome = normalizedUserHomeCached.original === userHome ? normalizedUserHomeCached.normalized : undefined;\n\tif (!normalizedUserHome) {\n\t\tnormalizedUserHome = `${rtrim(userHome, posix.sep)}${posix.sep}`;\n\t\tnormalizedUserHomeCached = { original: userHome, normalized: normalizedUserHome };\n\t}\n\n\t// Linux: case sensitive, macOS: case insensitive\n\tif (isLinux ? path.startsWith(normalizedUserHome) : startsWithIgnoreCase(path, normalizedUserHome)) {\n\t\tpath = `~/${path.substr(normalizedUserHome.length)}`;\n\t}\n\n\treturn path;\n}\n\nexport function untildify(path: string, userHome: string): string {\n\treturn path.replace(/^~($|\\/|\\\\)/, `${userHome}$1`);\n}\n\n/**\n * Shortens the paths but keeps them easy to distinguish.\n * Replaces not important parts with ellipsis.\n * Every shorten path matches only one original path and vice versa.\n *\n * Algorithm for shortening paths is as follows:\n * 1. For every path in list, find unique substring of that path.\n * 2. Unique substring along with ellipsis is shortened path of that path.\n * 3. To find unique substring of path, consider every segment of length from 1 to path.length of path from end of string\n *    and if present segment is not substring to any other paths then present segment is unique path,\n *    else check if it is not present as suffix of any other path and present segment is suffix of path itself,\n *    if it is true take present segment as unique path.\n * 4. Apply ellipsis to unique segment according to whether segment is present at start/in-between/end of path.\n *\n * Example 1\n * 1. consider 2 paths i.e. ['a\\\\b\\\\c\\\\d', 'a\\\\f\\\\b\\\\c\\\\d']\n * 2. find unique path of first path,\n * \ta. 'd' is present in path2 and is suffix of path2, hence not unique of present path.\n * \tb. 'c' is present in path2 and 'c' is not suffix of present path, similarly for 'b' and 'a' also.\n * \tc. 'd\\\\c' is suffix of path2.\n *  d. 'b\\\\c' is not suffix of present path.\n *  e. 'a\\\\b' is not present in path2, hence unique path is 'a\\\\b...'.\n * 3. for path2, 'f' is not present in path1 hence unique is '...\\\\f\\\\...'.\n *\n * Example 2\n * 1. consider 2 paths i.e. ['a\\\\b', 'a\\\\b\\\\c'].\n * \ta. Even if 'b' is present in path2, as 'b' is suffix of path1 and is not suffix of path2, unique path will be '...\\\\b'.\n * 2. for path2, 'c' is not present in path1 hence unique path is '..\\\\c'.\n */\nconst ellipsis = '\\u2026';\nconst unc = '\\\\\\\\';\nconst home = '~';\nexport function shorten(paths: string[], pathSeparator: string = sep): string[] {\n\tconst shortenedPaths: string[] = new Array(paths.length);\n\n\t// for every path\n\tlet match = false;\n\tfor (let pathIndex = 0; pathIndex < paths.length; pathIndex++) {\n\t\tlet path = paths[pathIndex];\n\n\t\tif (path === '') {\n\t\t\tshortenedPaths[pathIndex] = `.${pathSeparator}`;\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (!path) {\n\t\t\tshortenedPaths[pathIndex] = path;\n\t\t\tcontinue;\n\t\t}\n\n\t\tmatch = true;\n\n\t\t// trim for now and concatenate unc path (e.g. \\\\network) or root path (/etc, ~/etc) later\n\t\tlet prefix = '';\n\t\tif (path.indexOf(unc) === 0) {\n\t\t\tprefix = path.substr(0, path.indexOf(unc) + unc.length);\n\t\t\tpath = path.substr(path.indexOf(unc) + unc.length);\n\t\t} else if (path.indexOf(pathSeparator) === 0) {\n\t\t\tprefix = path.substr(0, path.indexOf(pathSeparator) + pathSeparator.length);\n\t\t\tpath = path.substr(path.indexOf(pathSeparator) + pathSeparator.length);\n\t\t} else if (path.indexOf(home) === 0) {\n\t\t\tprefix = path.substr(0, path.indexOf(home) + home.length);\n\t\t\tpath = path.substr(path.indexOf(home) + home.length);\n\t\t}\n\n\t\t// pick the first shortest subpath found\n\t\tconst segments: string[] = path.split(pathSeparator);\n\t\tfor (let subpathLength = 1; match && subpathLength <= segments.length; subpathLength++) {\n\t\t\tfor (let start = segments.length - subpathLength; match && start >= 0; start--) {\n\t\t\t\tmatch = false;\n\t\t\t\tlet subpath = segments.slice(start, start + subpathLength).join(pathSeparator);\n\n\t\t\t\t// that is unique to any other path\n\t\t\t\tfor (let otherPathIndex = 0; !match && otherPathIndex < paths.length; otherPathIndex++) {\n\n\t\t\t\t\t// suffix subpath treated specially as we consider no match 'x' and 'x/...'\n\t\t\t\t\tif (otherPathIndex !== pathIndex && paths[otherPathIndex] && paths[otherPathIndex].indexOf(subpath) > -1) {\n\t\t\t\t\t\tconst isSubpathEnding: boolean = (start + subpathLength === segments.length);\n\n\t\t\t\t\t\t// Adding separator as prefix for subpath, such that 'endsWith(src, trgt)' considers subpath as directory name instead of plain string.\n\t\t\t\t\t\t// prefix is not added when either subpath is root directory or path[otherPathIndex] does not have multiple directories.\n\t\t\t\t\t\tconst subpathWithSep: string = (start > 0 && paths[otherPathIndex].indexOf(pathSeparator) > -1) ? pathSeparator + subpath : subpath;\n\t\t\t\t\t\tconst isOtherPathEnding: boolean = paths[otherPathIndex].endsWith(subpathWithSep);\n\n\t\t\t\t\t\tmatch = !isSubpathEnding || isOtherPathEnding;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// found unique subpath\n\t\t\t\tif (!match) {\n\t\t\t\t\tlet result = '';\n\n\t\t\t\t\t// preserve disk drive or root prefix\n\t\t\t\t\tif (segments[0].endsWith(':') || prefix !== '') {\n\t\t\t\t\t\tif (start === 1) {\n\t\t\t\t\t\t\t// extend subpath to include disk drive prefix\n\t\t\t\t\t\t\tstart = 0;\n\t\t\t\t\t\t\tsubpathLength++;\n\t\t\t\t\t\t\tsubpath = segments[0] + pathSeparator + subpath;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (start > 0) {\n\t\t\t\t\t\t\tresult = segments[0] + pathSeparator;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresult = prefix + result;\n\t\t\t\t\t}\n\n\t\t\t\t\t// add ellipsis at the beginning if neeeded\n\t\t\t\t\tif (start > 0) {\n\t\t\t\t\t\tresult = result + ellipsis + pathSeparator;\n\t\t\t\t\t}\n\n\t\t\t\t\tresult = result + subpath;\n\n\t\t\t\t\t// add ellipsis at the end if needed\n\t\t\t\t\tif (start + subpathLength < segments.length) {\n\t\t\t\t\t\tresult = result + pathSeparator + ellipsis;\n\t\t\t\t\t}\n\n\t\t\t\t\tshortenedPaths[pathIndex] = result;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (match) {\n\t\t\tshortenedPaths[pathIndex] = path; // use full path if no unique subpaths found\n\t\t}\n\t}\n\n\treturn shortenedPaths;\n}\n\nexport interface ISeparator {\n\tlabel: string;\n}\n\nenum Type {\n\tTEXT,\n\tVARIABLE,\n\tSEPARATOR\n}\n\ninterface ISegment {\n\tvalue: string;\n\ttype: Type;\n}\n\n/**\n * Helper to insert values for specific template variables into the string. E.g. \"this $(is) a $(template)\" can be\n * passed to this function together with an object that maps \"is\" and \"template\" to strings to have them replaced.\n * @param value string to which templating is applied\n * @param values the values of the templates to use\n */\nexport function template(template: string, values: { [key: string]: string | ISeparator | undefined | null; } = Object.create(null)): string {\n\tconst segments: ISegment[] = [];\n\n\tlet inVariable = false;\n\tlet curVal = '';\n\tfor (const char of template) {\n\t\t// Beginning of variable\n\t\tif (char === '$' || (inVariable && char === '{')) {\n\t\t\tif (curVal) {\n\t\t\t\tsegments.push({ value: curVal, type: Type.TEXT });\n\t\t\t}\n\n\t\t\tcurVal = '';\n\t\t\tinVariable = true;\n\t\t}\n\n\t\t// End of variable\n\t\telse if (char === '}' && inVariable) {\n\t\t\tconst resolved = values[curVal];\n\n\t\t\t// Variable\n\t\t\tif (typeof resolved === 'string') {\n\t\t\t\tif (resolved.length) {\n\t\t\t\t\tsegments.push({ value: resolved, type: Type.VARIABLE });\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Separator\n\t\t\telse if (resolved) {\n\t\t\t\tconst prevSegment = segments[segments.length - 1];\n\t\t\t\tif (!prevSegment || prevSegment.type !== Type.SEPARATOR) {\n\t\t\t\t\tsegments.push({ value: resolved.label, type: Type.SEPARATOR }); // prevent duplicate separators\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcurVal = '';\n\t\t\tinVariable = false;\n\t\t}\n\n\t\t// Text or Variable Name\n\t\telse {\n\t\t\tcurVal += char;\n\t\t}\n\t}\n\n\t// Tail\n\tif (curVal && !inVariable) {\n\t\tsegments.push({ value: curVal, type: Type.TEXT });\n\t}\n\n\treturn segments.filter((segment, index) => {\n\n\t\t// Only keep separator if we have values to the left and right\n\t\tif (segment.type === Type.SEPARATOR) {\n\t\t\tconst left = segments[index - 1];\n\t\t\tconst right = segments[index + 1];\n\n\t\t\treturn [left, right].every(segment => segment && (segment.type === Type.VARIABLE || segment.type === Type.TEXT) && segment.value.length > 0);\n\t\t}\n\n\t\t// accept any TEXT and VARIABLE\n\t\treturn true;\n\t}).map(segment => segment.value).join('');\n}\n\n/**\n * Handles mnemonics for menu items. Depending on OS:\n * - Windows: Supported via & character (replace && with &)\n * -   Linux: Supported via & character (replace && with &)\n * -   macOS: Unsupported (replace && with empty string)\n */\nexport function mnemonicMenuLabel(label: string, forceDisableMnemonics?: boolean): string {\n\tif (isMacintosh || forceDisableMnemonics) {\n\t\treturn label.replace(/\\(&&\\w\\)|&&/g, '').replace(/&/g, isMacintosh ? '&' : '&&');\n\t}\n\n\treturn label.replace(/&&|&/g, m => m === '&' ? '&&' : '&');\n}\n\n/**\n * Handles mnemonics for buttons. Depending on OS:\n * - Windows: Supported via & character (replace && with & and & with && for escaping)\n * -   Linux: Supported via _ character (replace && with _)\n * -   macOS: Unsupported (replace && with empty string)\n */\nexport function mnemonicButtonLabel(label: string, forceDisableMnemonics?: boolean): string {\n\tif (isMacintosh || forceDisableMnemonics) {\n\t\treturn label.replace(/\\(&&\\w\\)|&&/g, '');\n\t}\n\n\tif (isWindows) {\n\t\treturn label.replace(/&&|&/g, m => m === '&' ? '&&' : '&');\n\t}\n\n\treturn label.replace(/&&/g, '_');\n}\n\nexport function unmnemonicLabel(label: string): string {\n\treturn label.replace(/&/g, '&&');\n}\n\n/**\n * Splits a path in name and parent path, supporting both '/' and '\\'\n */\nexport function splitName(fullPath: string): { name: string, parentPath: string; } {\n\tconst p = fullPath.indexOf('/') !== -1 ? posix : win32;\n\tconst name = p.basename(fullPath);\n\tconst parentPath = p.dirname(fullPath);\n\tif (name.length) {\n\t\treturn { name, parentPath };\n\t}\n\t// only the root segment\n\treturn { name: parentPath, parentPath: '' };\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { MarshalledObject } from 'vs/base/common/marshalling';\nimport { Schemas } from './network';\n\nexport interface IURITransformer {\n\ttransformIncoming(uri: UriComponents): UriComponents;\n\ttransformOutgoing(uri: UriComponents): UriComponents;\n\ttransformOutgoingURI(uri: URI): URI;\n\ttransformOutgoingScheme(scheme: string): string;\n}\n\nexport interface UriParts {\n\tscheme: string;\n\tauthority?: string;\n\tpath?: string;\n}\n\nexport interface IRawURITransformer {\n\ttransformIncoming(uri: UriParts): UriParts;\n\ttransformOutgoing(uri: UriParts): UriParts;\n\ttransformOutgoingScheme(scheme: string): string;\n}\n\nfunction toJSON(uri: URI): UriComponents {\n\treturn <UriComponents><any>uri.toJSON();\n}\n\nexport class URITransformer implements IURITransformer {\n\n\tconstructor(private readonly remoteAuthority: string) {\n\t}\n\n\t// NOTE@coder: Coming in from the browser it'll be vscode-remote so it needs\n\t// to be transformed into file.\n\tpublic transformIncoming(uri: UriComponents): UriComponents {\n\t\treturn uri.scheme === Schemas.vscodeRemote\n\t\t\t? toJSON(URI.file(uri.path))\n\t\t\t: uri;\n\t}\n\n\t// NOTE@coder: Going out to the browser it'll be file so it needs to be\n\t// transformed into vscode-remote.\n\tpublic transformOutgoing(uri: UriComponents): UriComponents {\n\t\treturn uri.scheme === Schemas.file\n\t\t\t? toJSON(URI.from({ authority: this.remoteAuthority, scheme: Schemas.vscodeRemote, path: uri.path }))\n\t\t\t: uri;\n\t}\n\n\tpublic transformOutgoingURI(uri: URI): URI {\n\t\treturn uri.scheme === Schemas.file\n\t\t\t? URI.from({ authority: this.remoteAuthority, scheme: Schemas.vscodeRemote, path:uri.path })\n\t\t\t: uri;\n\t}\n\n\tpublic transformOutgoingScheme(scheme: string): string {\n\t\treturn scheme === Schemas.file\n\t\t\t? Schemas.vscodeRemote\n\t\t\t: scheme;\n\t}\n}\n\nexport const DefaultURITransformer: IURITransformer = new class {\n\ttransformIncoming(uri: UriComponents) {\n\t\treturn uri;\n\t}\n\n\ttransformOutgoing(uri: UriComponents): UriComponents {\n\t\treturn uri;\n\t}\n\n\ttransformOutgoingURI(uri: URI): URI {\n\t\treturn uri;\n\t}\n\n\ttransformOutgoingScheme(scheme: string): string {\n\t\treturn scheme;\n\t}\n};\n\nfunction _transformOutgoingURIs(obj: any, transformer: IURITransformer, depth: number): any {\n\n\tif (!obj || depth > 200) {\n\t\treturn null;\n\t}\n\n\tif (typeof obj === 'object') {\n\t\tif (obj instanceof URI) {\n\t\t\treturn transformer.transformOutgoing(obj);\n\t\t}\n\n\t\t// walk object (or array)\n\t\tfor (let key in obj) {\n\t\t\tif (Object.hasOwnProperty.call(obj, key)) {\n\t\t\t\tconst r = _transformOutgoingURIs(obj[key], transformer, depth + 1);\n\t\t\t\tif (r !== null) {\n\t\t\t\t\tobj[key] = r;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn null;\n}\n\nexport function transformOutgoingURIs<T>(obj: T, transformer: IURITransformer): T {\n\tconst result = _transformOutgoingURIs(obj, transformer, 0);\n\tif (result === null) {\n\t\t// no change\n\t\treturn obj;\n\t}\n\treturn result;\n}\n\n\nfunction _transformIncomingURIs(obj: any, transformer: IURITransformer, revive: boolean, depth: number): any {\n\n\tif (!obj || depth > 200) {\n\t\treturn null;\n\t}\n\n\tif (typeof obj === 'object') {\n\n\t\tif ((<MarshalledObject>obj).$mid === 1) {\n\t\t\treturn revive ? URI.revive(transformer.transformIncoming(obj)) : transformer.transformIncoming(obj);\n\t\t}\n\n\t\t// walk object (or array)\n\t\tfor (let key in obj) {\n\t\t\tif (Object.hasOwnProperty.call(obj, key)) {\n\t\t\t\tconst r = _transformIncomingURIs(obj[key], transformer, revive, depth + 1);\n\t\t\t\tif (r !== null) {\n\t\t\t\t\tobj[key] = r;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn null;\n}\n\nexport function transformIncomingURIs<T>(obj: T, transformer: IURITransformer): T {\n\tconst result = _transformIncomingURIs(obj, transformer, false, 0);\n\tif (result === null) {\n\t\t// no change\n\t\treturn obj;\n\t}\n\treturn result;\n}\n\nexport function transformAndReviveIncomingURIs<T>(obj: T, transformer: IURITransformer): T {\n\tconst result = _transformIncomingURIs(obj, transformer, true, 0);\n\tif (result === null) {\n\t\t// no change\n\t\treturn obj;\n\t}\n\treturn result;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n\nconst _UUIDPattern = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;\n\nexport function isUUID(value: string): boolean {\n\treturn _UUIDPattern.test(value);\n}\n\n// prep-work\nconst _data = new Uint8Array(16);\nconst _hex: string[] = [];\nfor (let i = 0; i < 256; i++) {\n\t_hex.push(i.toString(16).padStart(2, '0'));\n}\n\n// todo@jrieken\n// 1. node nodejs use`crypto#randomBytes`, see: https://nodejs.org/docs/latest/api/crypto.html#crypto_crypto_randombytes_size_callback\n// 2. use browser-crypto\nconst _fillRandomValues = function (bucket: Uint8Array): Uint8Array {\n\tfor (let i = 0; i < bucket.length; i++) {\n\t\tbucket[i] = Math.floor(Math.random() * 256);\n\t}\n\treturn bucket;\n};\n\nexport function generateUuid(): string {\n\t// get data\n\t_fillRandomValues(_data);\n\n\t// set version bits\n\t_data[6] = (_data[6] & 0x0f) | 0x40;\n\t_data[8] = (_data[8] & 0x3f) | 0x80;\n\n\t// print as string\n\tlet i = 0;\n\tlet result = '';\n\tresult += _hex[_data[i++]];\n\tresult += _hex[_data[i++]];\n\tresult += _hex[_data[i++]];\n\tresult += _hex[_data[i++]];\n\tresult += '-';\n\tresult += _hex[_data[i++]];\n\tresult += _hex[_data[i++]];\n\tresult += '-';\n\tresult += _hex[_data[i++]];\n\tresult += _hex[_data[i++]];\n\tresult += '-';\n\tresult += _hex[_data[i++]];\n\tresult += _hex[_data[i++]];\n\tresult += '-';\n\tresult += _hex[_data[i++]];\n\tresult += _hex[_data[i++]];\n\tresult += _hex[_data[i++]];\n\tresult += _hex[_data[i++]];\n\tresult += _hex[_data[i++]];\n\tresult += _hex[_data[i++]];\n\treturn result;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as sd from 'string_decoder';\nimport { CharCode } from 'vs/base/common/charCode';\n\n/**\n * Convenient way to iterate over output line by line. This helper accommodates for the fact that\n * a buffer might not end with new lines all the way.\n *\n * To use:\n * - call the write method\n * - forEach() over the result to get the lines\n */\nexport class LineDecoder {\n\tprivate stringDecoder: sd.StringDecoder;\n\tprivate remaining: string | null;\n\n\tconstructor(encoding: string = 'utf8') {\n\t\tthis.stringDecoder = new sd.StringDecoder(encoding);\n\t\tthis.remaining = null;\n\t}\n\n\twrite(buffer: Buffer): string[] {\n\t\tconst result: string[] = [];\n\t\tconst value = this.remaining\n\t\t\t? this.remaining + this.stringDecoder.write(buffer)\n\t\t\t: this.stringDecoder.write(buffer);\n\n\t\tif (value.length < 1) {\n\t\t\treturn result;\n\t\t}\n\t\tlet start = 0;\n\t\tlet ch: number;\n\t\tlet idx = start;\n\t\twhile (idx < value.length) {\n\t\t\tch = value.charCodeAt(idx);\n\t\t\tif (ch === CharCode.CarriageReturn || ch === CharCode.LineFeed) {\n\t\t\t\tresult.push(value.substring(start, idx));\n\t\t\t\tidx++;\n\t\t\t\tif (idx < value.length) {\n\t\t\t\t\tconst lastChar = ch;\n\t\t\t\t\tch = value.charCodeAt(idx);\n\t\t\t\t\tif ((lastChar === CharCode.CarriageReturn && ch === CharCode.LineFeed) || (lastChar === CharCode.LineFeed && ch === CharCode.CarriageReturn)) {\n\t\t\t\t\t\tidx++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tstart = idx;\n\t\t\t} else {\n\t\t\t\tidx++;\n\t\t\t}\n\t\t}\n\t\tthis.remaining = start < value.length ? value.substr(start) : null;\n\t\treturn result;\n\t}\n\n\tend(): string | null {\n\t\treturn this.remaining;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as fs from 'fs';\nimport { tmpdir } from 'os';\nimport { join } from 'vs/base/common/path';\nimport { Queue } from 'vs/base/common/async';\nimport { isMacintosh, isWindows } from 'vs/base/common/platform';\nimport { Event } from 'vs/base/common/event';\nimport { promisify } from 'util';\nimport { isRootOrDriveLetter } from 'vs/base/common/extpath';\nimport { generateUuid } from 'vs/base/common/uuid';\nimport { normalizeNFC } from 'vs/base/common/normalization';\n\n// See https://github.com/microsoft/vscode/issues/30180\nconst WIN32_MAX_FILE_SIZE = 300 * 1024 * 1024; // 300 MB\nconst GENERAL_MAX_FILE_SIZE = 16 * 1024 * 1024 * 1024; // 16 GB\n\n// See https://github.com/v8/v8/blob/5918a23a3d571b9625e5cce246bdd5b46ff7cd8b/src/heap/heap.cc#L149\nconst WIN32_MAX_HEAP_SIZE = 700 * 1024 * 1024; // 700 MB\nconst GENERAL_MAX_HEAP_SIZE = 700 * 2 * 1024 * 1024; // 1400 MB\n\nexport const MAX_FILE_SIZE = process.arch === 'ia32' ? WIN32_MAX_FILE_SIZE : GENERAL_MAX_FILE_SIZE;\nexport const MAX_HEAP_SIZE = process.arch === 'ia32' ? WIN32_MAX_HEAP_SIZE : GENERAL_MAX_HEAP_SIZE;\n\nexport enum RimRafMode {\n\n\t/**\n\t * Slow version that unlinks each file and folder.\n\t */\n\tUNLINK,\n\n\t/**\n\t * Fast version that first moves the file/folder\n\t * into a temp directory and then deletes that\n\t * without waiting for it.\n\t */\n\tMOVE\n}\n\nexport async function rimraf(path: string, mode = RimRafMode.UNLINK): Promise<void> {\n\tif (isRootOrDriveLetter(path)) {\n\t\tthrow new Error('rimraf - will refuse to recursively delete root');\n\t}\n\n\t// delete: via unlink\n\tif (mode === RimRafMode.UNLINK) {\n\t\treturn rimrafUnlink(path);\n\t}\n\n\t// delete: via move\n\treturn rimrafMove(path);\n}\n\nasync function rimrafUnlink(path: string): Promise<void> {\n\ttry {\n\t\tconst stat = await lstat(path);\n\n\t\t// Folder delete (recursive) - NOT for symbolic links though!\n\t\tif (stat.isDirectory() && !stat.isSymbolicLink()) {\n\n\t\t\t// Children\n\t\t\tconst children = await readdir(path);\n\t\t\tawait Promise.all(children.map(child => rimrafUnlink(join(path, child))));\n\n\t\t\t// Folder\n\t\t\tawait promisify(fs.rmdir)(path);\n\t\t}\n\n\t\t// Single file delete\n\t\telse {\n\n\t\t\t// chmod as needed to allow for unlink\n\t\t\tconst mode = stat.mode;\n\t\t\tif (!(mode & fs.constants.S_IWUSR)) {\n\t\t\t\tawait chmod(path, mode | fs.constants.S_IWUSR);\n\t\t\t}\n\n\t\t\treturn unlink(path);\n\t\t}\n\t} catch (error) {\n\t\tif (error.code !== 'ENOENT') {\n\t\t\tthrow error;\n\t\t}\n\t}\n}\n\nasync function rimrafMove(path: string): Promise<void> {\n\ttry {\n\t\tconst pathInTemp = join(tmpdir(), generateUuid());\n\t\ttry {\n\t\t\tawait rename(path, pathInTemp);\n\t\t} catch (error) {\n\t\t\treturn rimrafUnlink(path); // if rename fails, delete without tmp dir\n\t\t}\n\n\t\t// Delete but do not return as promise\n\t\trimrafUnlink(pathInTemp);\n\t} catch (error) {\n\t\tif (error.code !== 'ENOENT') {\n\t\t\tthrow error;\n\t\t}\n\t}\n}\n\nexport function rimrafSync(path: string): void {\n\tif (isRootOrDriveLetter(path)) {\n\t\tthrow new Error('rimraf - will refuse to recursively delete root');\n\t}\n\n\ttry {\n\t\tconst stat = fs.lstatSync(path);\n\n\t\t// Folder delete (recursive) - NOT for symbolic links though!\n\t\tif (stat.isDirectory() && !stat.isSymbolicLink()) {\n\n\t\t\t// Children\n\t\t\tconst children = readdirSync(path);\n\t\t\tchildren.map(child => rimrafSync(join(path, child)));\n\n\t\t\t// Folder\n\t\t\tfs.rmdirSync(path);\n\t\t}\n\n\t\t// Single file delete\n\t\telse {\n\n\t\t\t// chmod as needed to allow for unlink\n\t\t\tconst mode = stat.mode;\n\t\t\tif (!(mode & fs.constants.S_IWUSR)) {\n\t\t\t\tfs.chmodSync(path, mode | fs.constants.S_IWUSR);\n\t\t\t}\n\n\t\t\treturn fs.unlinkSync(path);\n\t\t}\n\t} catch (error) {\n\t\tif (error.code !== 'ENOENT') {\n\t\t\tthrow error;\n\t\t}\n\t}\n}\n\nexport async function readdir(path: string): Promise<string[]> {\n\treturn handleDirectoryChildren(await promisify(fs.readdir)(path));\n}\n\nexport async function readdirWithFileTypes(path: string): Promise<fs.Dirent[]> {\n\tconst children = await promisify(fs.readdir)(path, { withFileTypes: true });\n\n\t// Mac: uses NFD unicode form on disk, but we want NFC\n\t// See also https://github.com/nodejs/node/issues/2165\n\tif (isMacintosh) {\n\t\tfor (const child of children) {\n\t\t\tchild.name = normalizeNFC(child.name);\n\t\t}\n\t}\n\n\treturn children;\n}\n\nexport function readdirSync(path: string): string[] {\n\treturn handleDirectoryChildren(fs.readdirSync(path));\n}\n\nfunction handleDirectoryChildren(children: string[]): string[] {\n\t// Mac: uses NFD unicode form on disk, but we want NFC\n\t// See also https://github.com/nodejs/node/issues/2165\n\tif (isMacintosh) {\n\t\treturn children.map(child => normalizeNFC(child));\n\t}\n\n\treturn children;\n}\n\nexport function exists(path: string): Promise<boolean> {\n\treturn promisify(fs.exists)(path);\n}\n\nexport function chmod(path: string, mode: number): Promise<void> {\n\treturn promisify(fs.chmod)(path, mode);\n}\n\nexport function stat(path: string): Promise<fs.Stats> {\n\treturn promisify(fs.stat)(path);\n}\n\nexport interface IStatAndLink {\n\n\t// The stats of the file. If the file is a symbolic\n\t// link, the stats will be of that target file and\n\t// not the link itself.\n\t// If the file is a symbolic link pointing to a non\n\t// existing file, the stat will be of the link and\n\t// the `dangling` flag will indicate this.\n\tstat: fs.Stats;\n\n\t// Will be provided if the resource is a symbolic link\n\t// on disk. Use the `dangling` flag to find out if it\n\t// points to a resource that does not exist on disk.\n\tsymbolicLink?: { dangling: boolean };\n}\n\nexport async function statLink(path: string): Promise<IStatAndLink> {\n\n\t// First stat the link\n\tlet lstats: fs.Stats | undefined;\n\ttry {\n\t\tlstats = await lstat(path);\n\n\t\t// Return early if the stat is not a symbolic link at all\n\t\tif (!lstats.isSymbolicLink()) {\n\t\t\treturn { stat: lstats };\n\t\t}\n\t} catch (error) {\n\t\t/* ignore - use stat() instead */\n\t}\n\n\t// If the stat is a symbolic link or failed to stat, use fs.stat()\n\t// which for symbolic links will stat the target they point to\n\ttry {\n\t\tconst stats = await stat(path);\n\n\t\treturn { stat: stats, symbolicLink: lstats?.isSymbolicLink() ? { dangling: false } : undefined };\n\t} catch (error) {\n\n\t\t// If the link points to a non-existing file we still want\n\t\t// to return it as result while setting dangling: true flag\n\t\tif (error.code === 'ENOENT' && lstats) {\n\t\t\treturn { stat: lstats, symbolicLink: { dangling: true } };\n\t\t}\n\n\t\t// Windows: workaround a node.js bug where reparse points\n\t\t// are not supported (https://github.com/nodejs/node/issues/36790)\n\t\tif (isWindows && error.code === 'EACCES' && lstats) {\n\t\t\ttry {\n\t\t\t\tconst stats = await stat(await readlink(path));\n\n\t\t\t\treturn { stat: stats, symbolicLink: lstats.isSymbolicLink() ? { dangling: false } : undefined };\n\t\t\t} catch (error) {\n\n\t\t\t\t// If the link points to a non-existing file we still want\n\t\t\t\t// to return it as result while setting dangling: true flag\n\t\t\t\tif (error.code === 'ENOENT') {\n\t\t\t\t\treturn { stat: lstats, symbolicLink: { dangling: true } };\n\t\t\t\t}\n\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t}\n\n\t\tthrow error;\n\t}\n}\n\nexport function lstat(path: string): Promise<fs.Stats> {\n\treturn promisify(fs.lstat)(path);\n}\n\nexport function rename(oldPath: string, newPath: string): Promise<void> {\n\treturn promisify(fs.rename)(oldPath, newPath);\n}\n\nexport function renameIgnoreError(oldPath: string, newPath: string): Promise<void> {\n\treturn new Promise(resolve => fs.rename(oldPath, newPath, () => resolve()));\n}\n\nexport function readlink(path: string): Promise<string> {\n\treturn promisify(fs.readlink)(path);\n}\n\nexport function unlink(path: string): Promise<void> {\n\treturn promisify(fs.unlink)(path);\n}\n\nexport function symlink(target: string, path: string, type?: string): Promise<void> {\n\treturn promisify(fs.symlink)(target, path, type);\n}\n\nexport function truncate(path: string, len: number): Promise<void> {\n\treturn promisify(fs.truncate)(path, len);\n}\n\nexport function readFile(path: string): Promise<Buffer>;\nexport function readFile(path: string, encoding: string): Promise<string>;\nexport function readFile(path: string, encoding?: string): Promise<Buffer | string> {\n\treturn promisify(fs.readFile)(path, encoding);\n}\n\nexport async function mkdirp(path: string, mode?: number): Promise<void> {\n\treturn promisify(fs.mkdir)(path, { mode, recursive: true });\n}\n\n// According to node.js docs (https://nodejs.org/docs/v6.5.0/api/fs.html#fs_fs_writefile_file_data_options_callback)\n// it is not safe to call writeFile() on the same path multiple times without waiting for the callback to return.\n// Therefor we use a Queue on the path that is given to us to sequentialize calls to the same path properly.\nconst writeFilePathQueues: Map<string, Queue<void>> = new Map();\n\nexport function writeFile(path: string, data: string, options?: IWriteFileOptions): Promise<void>;\nexport function writeFile(path: string, data: Buffer, options?: IWriteFileOptions): Promise<void>;\nexport function writeFile(path: string, data: Uint8Array, options?: IWriteFileOptions): Promise<void>;\nexport function writeFile(path: string, data: string | Buffer | Uint8Array, options?: IWriteFileOptions): Promise<void>;\nexport function writeFile(path: string, data: string | Buffer | Uint8Array, options?: IWriteFileOptions): Promise<void> {\n\tconst queueKey = toQueueKey(path);\n\n\treturn ensureWriteFileQueue(queueKey).queue(() => {\n\t\tconst ensuredOptions = ensureWriteOptions(options);\n\n\t\treturn new Promise((resolve, reject) => doWriteFileAndFlush(path, data, ensuredOptions, error => error ? reject(error) : resolve()));\n\t});\n}\n\nfunction toQueueKey(path: string): string {\n\tlet queueKey = path;\n\tif (isWindows || isMacintosh) {\n\t\tqueueKey = queueKey.toLowerCase(); // accommodate for case insensitive file systems\n\t}\n\n\treturn queueKey;\n}\n\nfunction ensureWriteFileQueue(queueKey: string): Queue<void> {\n\tconst existingWriteFileQueue = writeFilePathQueues.get(queueKey);\n\tif (existingWriteFileQueue) {\n\t\treturn existingWriteFileQueue;\n\t}\n\n\tconst writeFileQueue = new Queue<void>();\n\twriteFilePathQueues.set(queueKey, writeFileQueue);\n\n\tconst onFinish = Event.once(writeFileQueue.onFinished);\n\tonFinish(() => {\n\t\twriteFilePathQueues.delete(queueKey);\n\t\twriteFileQueue.dispose();\n\t});\n\n\treturn writeFileQueue;\n}\n\nexport interface IWriteFileOptions {\n\tmode?: number;\n\tflag?: string;\n}\n\ninterface IEnsuredWriteFileOptions extends IWriteFileOptions {\n\tmode: number;\n\tflag: string;\n}\n\nlet canFlush = true;\n\n// Calls fs.writeFile() followed by a fs.sync() call to flush the changes to disk\n// We do this in cases where we want to make sure the data is really on disk and\n// not in some cache.\n//\n// See https://github.com/nodejs/node/blob/v5.10.0/lib/fs.js#L1194\nfunction doWriteFileAndFlush(path: string, data: string | Buffer | Uint8Array, options: IEnsuredWriteFileOptions, callback: (error: Error | null) => void): void {\n\tif (!canFlush) {\n\t\treturn fs.writeFile(path, data, { mode: options.mode, flag: options.flag }, callback);\n\t}\n\n\t// Open the file with same flags and mode as fs.writeFile()\n\tfs.open(path, options.flag, options.mode, (openError, fd) => {\n\t\tif (openError) {\n\t\t\treturn callback(openError);\n\t\t}\n\n\t\t// It is valid to pass a fd handle to fs.writeFile() and this will keep the handle open!\n\t\tfs.writeFile(fd, data, writeError => {\n\t\t\tif (writeError) {\n\t\t\t\treturn fs.close(fd, () => callback(writeError)); // still need to close the handle on error!\n\t\t\t}\n\n\t\t\t// Flush contents (not metadata) of the file to disk\n\t\t\tfs.fdatasync(fd, (syncError: Error | null) => {\n\n\t\t\t\t// In some exotic setups it is well possible that node fails to sync\n\t\t\t\t// In that case we disable flushing and warn to the console\n\t\t\t\tif (syncError) {\n\t\t\t\t\tconsole.warn('[node.js fs] fdatasync is now disabled for this session because it failed: ', syncError);\n\t\t\t\t\tcanFlush = false;\n\t\t\t\t}\n\n\t\t\t\treturn fs.close(fd, closeError => callback(closeError));\n\t\t\t});\n\t\t});\n\t});\n}\n\nexport function writeFileSync(path: string, data: string | Buffer, options?: IWriteFileOptions): void {\n\tconst ensuredOptions = ensureWriteOptions(options);\n\n\tif (!canFlush) {\n\t\treturn fs.writeFileSync(path, data, { mode: ensuredOptions.mode, flag: ensuredOptions.flag });\n\t}\n\n\t// Open the file with same flags and mode as fs.writeFile()\n\tconst fd = fs.openSync(path, ensuredOptions.flag, ensuredOptions.mode);\n\n\ttry {\n\n\t\t// It is valid to pass a fd handle to fs.writeFile() and this will keep the handle open!\n\t\tfs.writeFileSync(fd, data);\n\n\t\t// Flush contents (not metadata) of the file to disk\n\t\ttry {\n\t\t\tfs.fdatasyncSync(fd);\n\t\t} catch (syncError) {\n\t\t\tconsole.warn('[node.js fs] fdatasyncSync is now disabled for this session because it failed: ', syncError);\n\t\t\tcanFlush = false;\n\t\t}\n\t} finally {\n\t\tfs.closeSync(fd);\n\t}\n}\n\nfunction ensureWriteOptions(options?: IWriteFileOptions): IEnsuredWriteFileOptions {\n\tif (!options) {\n\t\treturn { mode: 0o666 /* default node.js mode for files */, flag: 'w' };\n\t}\n\n\treturn {\n\t\tmode: typeof options.mode === 'number' ? options.mode : 0o666 /* default node.js mode for files */,\n\t\tflag: typeof options.flag === 'string' ? options.flag : 'w'\n\t};\n}\n\nexport async function readDirsInDir(dirPath: string): Promise<string[]> {\n\tconst children = await readdir(dirPath);\n\tconst directories: string[] = [];\n\n\tfor (const child of children) {\n\t\tif (await dirExists(join(dirPath, child))) {\n\t\t\tdirectories.push(child);\n\t\t}\n\t}\n\n\treturn directories;\n}\n\nexport async function dirExists(path: string): Promise<boolean> {\n\ttry {\n\t\tconst { stat, symbolicLink } = await statLink(path);\n\n\t\treturn stat.isDirectory() && symbolicLink?.dangling !== true;\n\t} catch (error) {\n\t\t// Ignore, path might not exist\n\t}\n\n\treturn false;\n}\n\nexport async function fileExists(path: string): Promise<boolean> {\n\ttry {\n\t\tconst { stat, symbolicLink } = await statLink(path);\n\n\t\treturn stat.isFile() && symbolicLink?.dangling !== true;\n\t} catch (error) {\n\t\t// Ignore, path might not exist\n\t}\n\n\treturn false;\n}\n\nexport function whenDeleted(path: string): Promise<void> {\n\n\t// Complete when wait marker file is deleted\n\treturn new Promise<void>(resolve => {\n\t\tlet running = false;\n\t\tconst interval = setInterval(() => {\n\t\t\tif (!running) {\n\t\t\t\trunning = true;\n\t\t\t\tfs.exists(path, exists => {\n\t\t\t\t\trunning = false;\n\n\t\t\t\t\tif (!exists) {\n\t\t\t\t\t\tclearInterval(interval);\n\t\t\t\t\t\tresolve(undefined);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}, 1000);\n\t});\n}\n\nexport async function move(source: string, target: string): Promise<void> {\n\tif (source === target) {\n\t\treturn;\n\t}\n\n\tasync function updateMtime(path: string): Promise<void> {\n\t\tconst stat = await lstat(path);\n\t\tif (stat.isDirectory() || stat.isSymbolicLink()) {\n\t\t\treturn; // only for files\n\t\t}\n\n\t\tconst fd = await promisify(fs.open)(path, 'a');\n\t\ttry {\n\t\t\tawait promisify(fs.futimes)(fd, stat.atime, new Date());\n\t\t} catch (error) {\n\t\t\t//ignore\n\t\t}\n\n\t\treturn promisify(fs.close)(fd);\n\t}\n\n\ttry {\n\t\tawait rename(source, target);\n\t\tawait updateMtime(target);\n\t} catch (error) {\n\n\t\t// In two cases we fallback to classic copy and delete:\n\t\t//\n\t\t// 1.) The EXDEV error indicates that source and target are on different devices\n\t\t// In this case, fallback to using a copy() operation as there is no way to\n\t\t// rename() between different devices.\n\t\t//\n\t\t// 2.) The user tries to rename a file/folder that ends with a dot. This is not\n\t\t// really possible to move then, at least on UNC devices.\n\t\tif (source.toLowerCase() !== target.toLowerCase() && error.code === 'EXDEV' || source.endsWith('.')) {\n\t\t\tawait copy(source, target);\n\t\t\tawait rimraf(source, RimRafMode.MOVE);\n\t\t\tawait updateMtime(target);\n\t\t} else {\n\t\t\tthrow error;\n\t\t}\n\t}\n}\n\n// When copying a file or folder, we want to preserve the mode\n// it had and as such provide it when creating. However, modes\n// can go beyond what we expect (see link below), so we mask it.\n// (https://github.com/nodejs/node-v0.x-archive/issues/3045#issuecomment-4862588)\n//\n// The `copy` method is very old so we should probably revisit\n// it's implementation and check wether this mask is still needed.\nconst COPY_MODE_MASK = 0o777;\n\nexport async function copy(source: string, target: string, handledSourcesIn?: { [path: string]: boolean }): Promise<void> {\n\n\t// Keep track of paths already copied to prevent\n\t// cycles from symbolic links to cause issues\n\tconst handledSources = handledSourcesIn ?? Object.create(null);\n\tif (handledSources[source]) {\n\t\treturn;\n\t} else {\n\t\thandledSources[source] = true;\n\t}\n\n\tconst { stat, symbolicLink } = await statLink(source);\n\tif (symbolicLink?.dangling) {\n\t\treturn; // skip over dangling symbolic links (https://github.com/microsoft/vscode/issues/111621)\n\t}\n\n\tif (!stat.isDirectory()) {\n\t\treturn doCopyFile(source, target, stat.mode & COPY_MODE_MASK);\n\t}\n\n\t// Create folder\n\tawait mkdirp(target, stat.mode & COPY_MODE_MASK);\n\n\t// Copy each file recursively\n\tconst files = await readdir(source);\n\tfor (let i = 0; i < files.length; i++) {\n\t\tconst file = files[i];\n\t\tawait copy(join(source, file), join(target, file), handledSources);\n\t}\n}\n\nasync function doCopyFile(source: string, target: string, mode: number): Promise<void> {\n\treturn new Promise((resolve, reject) => {\n\t\tconst reader = fs.createReadStream(source);\n\t\tconst writer = fs.createWriteStream(target, { mode });\n\n\t\tlet finished = false;\n\t\tconst finish = (error?: Error) => {\n\t\t\tif (!finished) {\n\t\t\t\tfinished = true;\n\n\t\t\t\t// in error cases, pass to callback\n\t\t\t\tif (error) {\n\t\t\t\t\treturn reject(error);\n\t\t\t\t}\n\n\t\t\t\t// we need to explicitly chmod because of https://github.com/nodejs/node/issues/1104\n\t\t\t\tfs.chmod(target, mode, error => error ? reject(error) : resolve());\n\t\t\t}\n\t\t};\n\n\t\t// handle errors properly\n\t\treader.once('error', error => finish(error));\n\t\twriter.once('error', error => finish(error));\n\n\t\t// we are done (underlying fd has been closed)\n\t\twriter.once('close', () => finish());\n\n\t\t// start piping\n\t\treader.pipe(writer);\n\t});\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as fs from 'fs';\nimport { rtrim } from 'vs/base/common/strings';\nimport { sep, join, normalize, dirname, basename } from 'vs/base/common/path';\nimport { readdirSync } from 'vs/base/node/pfs';\nimport { promisify } from 'util';\n\n/**\n * Copied from: https://github.com/microsoft/vscode-node-debug/blob/master/src/node/pathUtilities.ts#L83\n *\n * Given an absolute, normalized, and existing file path 'realcase' returns the exact path that the file has on disk.\n * On a case insensitive file system, the returned path might differ from the original path by character casing.\n * On a case sensitive file system, the returned path will always be identical to the original path.\n * In case of errors, null is returned. But you cannot use this function to verify that a path exists.\n * realcaseSync does not handle '..' or '.' path segments and it does not take the locale into account.\n */\nexport function realcaseSync(path: string): string | null {\n\tconst dir = dirname(path);\n\tif (path === dir) {\t// end recursion\n\t\treturn path;\n\t}\n\n\tconst name = (basename(path) /* can be '' for windows drive letters */ || path).toLowerCase();\n\ttry {\n\t\tconst entries = readdirSync(dir);\n\t\tconst found = entries.filter(e => e.toLowerCase() === name);\t// use a case insensitive search\n\t\tif (found.length === 1) {\n\t\t\t// on a case sensitive filesystem we cannot determine here, whether the file exists or not, hence we need the 'file exists' precondition\n\t\t\tconst prefix = realcaseSync(dir);   // recurse\n\t\t\tif (prefix) {\n\t\t\t\treturn join(prefix, found[0]);\n\t\t\t}\n\t\t} else if (found.length > 1) {\n\t\t\t// must be a case sensitive $filesystem\n\t\t\tconst ix = found.indexOf(name);\n\t\t\tif (ix >= 0) {\t// case sensitive\n\t\t\t\tconst prefix = realcaseSync(dir);   // recurse\n\t\t\t\tif (prefix) {\n\t\t\t\t\treturn join(prefix, found[ix]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (error) {\n\t\t// silently ignore error\n\t}\n\n\treturn null;\n}\n\nexport async function realpath(path: string): Promise<string> {\n\ttry {\n\t\treturn await promisify(fs.realpath)(path);\n\t} catch (error) {\n\n\t\t// We hit an error calling fs.realpath(). Since fs.realpath() is doing some path normalization\n\t\t// we now do a similar normalization and then try again if we can access the path with read\n\t\t// permissions at least. If that succeeds, we return that path.\n\t\t// fs.realpath() is resolving symlinks and that can fail in certain cases. The workaround is\n\t\t// to not resolve links but to simply see if the path is read accessible or not.\n\t\tconst normalizedPath = normalizePath(path);\n\n\t\tawait promisify(fs.access)(normalizedPath, fs.constants.R_OK);\n\n\t\treturn normalizedPath;\n\t}\n}\n\nexport function realpathSync(path: string): string {\n\ttry {\n\t\treturn fs.realpathSync(path);\n\t} catch (error) {\n\n\t\t// We hit an error calling fs.realpathSync(). Since fs.realpathSync() is doing some path normalization\n\t\t// we now do a similar normalization and then try again if we can access the path with read\n\t\t// permissions at least. If that succeeds, we return that path.\n\t\t// fs.realpath() is resolving symlinks and that can fail in certain cases. The workaround is\n\t\t// to not resolve links but to simply see if the path is read accessible or not.\n\t\tconst normalizedPath = normalizePath(path);\n\t\tfs.accessSync(normalizedPath, fs.constants.R_OK); // throws in case of an error\n\n\t\treturn normalizedPath;\n\t}\n}\n\nfunction normalizePath(path: string): string {\n\treturn rtrim(normalize(path), sep);\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as pfs from 'vs/base/node/pfs';\nimport * as os from 'os';\nimport * as path from 'vs/base/common/path';\nimport { env } from 'vs/base/common/process';\n\nconst WindowsPowerShell64BitLabel = 'Windows PowerShell';\nconst WindowsPowerShell32BitLabel = 'Windows PowerShell (x86)';\n\n// This is required, since parseInt(\"7-preview\") will return 7.\nconst IntRegex: RegExp = /^\\d+$/;\n\nconst PwshMsixRegex: RegExp = /^Microsoft.PowerShell_.*/;\nconst PwshPreviewMsixRegex: RegExp = /^Microsoft.PowerShellPreview_.*/;\n\n// The platform details descriptor for the platform we're on\nconst isProcess64Bit: boolean = process.arch === 'x64';\nconst isOS64Bit: boolean = isProcess64Bit || os.arch() === 'x64';\n\nexport interface IPowerShellExeDetails {\n\treadonly displayName: string;\n\treadonly exePath: string;\n}\n\nexport interface IPossiblePowerShellExe extends IPowerShellExeDetails {\n\texists(): Promise<boolean>;\n}\n\nclass PossiblePowerShellExe implements IPossiblePowerShellExe {\n\tconstructor(\n\t\tpublic readonly exePath: string,\n\t\tpublic readonly displayName: string,\n\t\tprivate knownToExist?: boolean) { }\n\n\tpublic async exists(): Promise<boolean> {\n\t\tif (this.knownToExist === undefined) {\n\t\t\tthis.knownToExist = await pfs.fileExists(this.exePath);\n\t\t}\n\t\treturn this.knownToExist;\n\t}\n}\n\nfunction getProgramFilesPath(\n\t{ useAlternateBitness = false }: { useAlternateBitness?: boolean } = {}): string | null {\n\n\tif (!useAlternateBitness) {\n\t\t// Just use the native system bitness\n\t\treturn env.ProgramFiles || null;\n\t}\n\n\t// We might be a 64-bit process looking for 32-bit program files\n\tif (isProcess64Bit) {\n\t\treturn env['ProgramFiles(x86)'] || null;\n\t}\n\n\t// We might be a 32-bit process looking for 64-bit program files\n\tif (isOS64Bit) {\n\t\treturn env.ProgramW6432 || null;\n\t}\n\n\t// We're a 32-bit process on 32-bit Windows, there is no other Program Files dir\n\treturn null;\n}\n\nfunction getSystem32Path({ useAlternateBitness = false }: { useAlternateBitness?: boolean } = {}): string {\n\tconst windir: string = env.windir!;\n\n\tif (!useAlternateBitness) {\n\t\t// Just use the native system bitness\n\t\treturn path.join(windir, 'System32');\n\t}\n\n\t// We might be a 64-bit process looking for 32-bit system32\n\tif (isProcess64Bit) {\n\t\treturn path.join(windir, 'SysWOW64');\n\t}\n\n\t// We might be a 32-bit process looking for 64-bit system32\n\tif (isOS64Bit) {\n\t\treturn path.join(windir, 'Sysnative');\n\t}\n\n\t// We're on a 32-bit Windows, so no alternate bitness\n\treturn path.join(windir, 'System32');\n}\n\nasync function findPSCoreWindowsInstallation(\n\t{ useAlternateBitness = false, findPreview = false }:\n\t\t{ useAlternateBitness?: boolean; findPreview?: boolean } = {}): Promise<IPossiblePowerShellExe | null> {\n\n\tconst programFilesPath = getProgramFilesPath({ useAlternateBitness });\n\tif (!programFilesPath) {\n\t\treturn null;\n\t}\n\n\tconst powerShellInstallBaseDir = path.join(programFilesPath, 'PowerShell');\n\n\t// Ensure the base directory exists\n\tif (!await pfs.dirExists(powerShellInstallBaseDir)) {\n\t\treturn null;\n\t}\n\n\tlet highestSeenVersion: number = -1;\n\tlet pwshExePath: string | null = null;\n\tfor (const item of await pfs.readdir(powerShellInstallBaseDir)) {\n\n\t\tlet currentVersion: number = -1;\n\t\tif (findPreview) {\n\t\t\t// We are looking for something like \"7-preview\"\n\n\t\t\t// Preview dirs all have dashes in them\n\t\t\tconst dashIndex = item.indexOf('-');\n\t\t\tif (dashIndex < 0) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Verify that the part before the dash is an integer\n\t\t\t// and that the part after the dash is \"preview\"\n\t\t\tconst intPart: string = item.substring(0, dashIndex);\n\t\t\tif (!IntRegex.test(intPart) || item.substring(dashIndex + 1) !== 'preview') {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tcurrentVersion = parseInt(intPart, 10);\n\t\t} else {\n\t\t\t// Search for a directory like \"6\" or \"7\"\n\t\t\tif (!IntRegex.test(item)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tcurrentVersion = parseInt(item, 10);\n\t\t}\n\n\t\t// Ensure we haven't already seen a higher version\n\t\tif (currentVersion <= highestSeenVersion) {\n\t\t\tcontinue;\n\t\t}\n\n\t\t// Now look for the file\n\t\tconst exePath = path.join(powerShellInstallBaseDir, item, 'pwsh.exe');\n\t\tif (!await pfs.fileExists(exePath)) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tpwshExePath = exePath;\n\t\thighestSeenVersion = currentVersion;\n\t}\n\n\tif (!pwshExePath) {\n\t\treturn null;\n\t}\n\n\tconst bitness: string = programFilesPath.includes('x86') ? ' (x86)' : '';\n\tconst preview: string = findPreview ? ' Preview' : '';\n\n\treturn new PossiblePowerShellExe(pwshExePath, `PowerShell${preview}${bitness}`, true);\n}\n\nasync function findPSCoreMsix({ findPreview }: { findPreview?: boolean } = {}): Promise<IPossiblePowerShellExe | null> {\n\t// We can't proceed if there's no LOCALAPPDATA path\n\tif (!env.LOCALAPPDATA) {\n\t\treturn null;\n\t}\n\n\t// Find the base directory for MSIX application exe shortcuts\n\tconst msixAppDir = path.join(env.LOCALAPPDATA, 'Microsoft', 'WindowsApps');\n\n\tif (!await pfs.dirExists(msixAppDir)) {\n\t\treturn null;\n\t}\n\n\t// Define whether we're looking for the preview or the stable\n\tconst { pwshMsixDirRegex, pwshMsixName } = findPreview\n\t\t? { pwshMsixDirRegex: PwshPreviewMsixRegex, pwshMsixName: 'PowerShell Preview (Store)' }\n\t\t: { pwshMsixDirRegex: PwshMsixRegex, pwshMsixName: 'PowerShell (Store)' };\n\n\t// We should find only one such application, so return on the first one\n\tfor (const subdir of await pfs.readdir(msixAppDir)) {\n\t\tif (pwshMsixDirRegex.test(subdir)) {\n\t\t\tconst pwshMsixPath = path.join(msixAppDir, subdir, 'pwsh.exe');\n\t\t\treturn new PossiblePowerShellExe(pwshMsixPath, pwshMsixName);\n\t\t}\n\t}\n\n\t// If we find nothing, return null\n\treturn null;\n}\n\nfunction findPSCoreDotnetGlobalTool(): IPossiblePowerShellExe {\n\tconst dotnetGlobalToolExePath: string = path.join(os.homedir(), '.dotnet', 'tools', 'pwsh.exe');\n\n\treturn new PossiblePowerShellExe(dotnetGlobalToolExePath, '.NET Core PowerShell Global Tool');\n}\n\nfunction findWinPS({ useAlternateBitness = false }: { useAlternateBitness?: boolean } = {}): IPossiblePowerShellExe | null {\n\n\t// x86 and ARM only have one WinPS on them\n\tif (!isOS64Bit && useAlternateBitness) {\n\t\treturn null;\n\t}\n\n\tconst systemFolderPath = getSystem32Path({ useAlternateBitness });\n\n\tconst winPSPath = path.join(systemFolderPath, 'WindowsPowerShell', 'v1.0', 'powershell.exe');\n\n\tlet displayName: string;\n\tif (isProcess64Bit) {\n\t\tdisplayName = useAlternateBitness\n\t\t\t? WindowsPowerShell32BitLabel\n\t\t\t: WindowsPowerShell64BitLabel;\n\t} else if (isOS64Bit) {\n\t\tdisplayName = useAlternateBitness\n\t\t\t? WindowsPowerShell64BitLabel\n\t\t\t: WindowsPowerShell32BitLabel;\n\t} else {\n\t\t// NOTE: ARM Windows devices also have Windows PowerShell x86 on them. There is no\n\t\t// \"ARM Windows PowerShell\".\n\t\tdisplayName = WindowsPowerShell32BitLabel;\n\t}\n\n\treturn new PossiblePowerShellExe(winPSPath, displayName, true);\n}\n\n/**\n * Iterates through all the possible well-known PowerShell installations on a machine.\n * Returned values may not exist, but come with an .exists property\n * which will check whether the executable exists.\n */\nasync function* enumerateDefaultPowerShellInstallations(): AsyncIterable<IPossiblePowerShellExe> {\n\t// Find PSCore stable first\n\tlet pwshExe = await findPSCoreWindowsInstallation();\n\tif (pwshExe) {\n\t\tyield pwshExe;\n\t}\n\n\t// Windows may have a 32-bit pwsh.exe\n\tpwshExe = await findPSCoreWindowsInstallation({ useAlternateBitness: true });\n\tif (pwshExe) {\n\t\tyield pwshExe;\n\t}\n\n\t// Also look for the MSIX/UWP installation\n\tpwshExe = await findPSCoreMsix();\n\tif (pwshExe) {\n\t\tyield pwshExe;\n\t}\n\n\t// Look for the .NET global tool\n\t// Some older versions of PowerShell have a bug in this where startup will fail,\n\t// but this is fixed in newer versions\n\tpwshExe = findPSCoreDotnetGlobalTool();\n\tif (pwshExe) {\n\t\tyield pwshExe;\n\t}\n\n\t// Look for PSCore preview\n\tpwshExe = await findPSCoreWindowsInstallation({ findPreview: true });\n\tif (pwshExe) {\n\t\tyield pwshExe;\n\t}\n\n\t// Find a preview MSIX\n\tpwshExe = await findPSCoreMsix({ findPreview: true });\n\tif (pwshExe) {\n\t\tyield pwshExe;\n\t}\n\n\t// Look for pwsh-preview with the opposite bitness\n\tpwshExe = await findPSCoreWindowsInstallation({ useAlternateBitness: true, findPreview: true });\n\tif (pwshExe) {\n\t\tyield pwshExe;\n\t}\n\n\t// Finally, get Windows PowerShell\n\n\t// Get the natural Windows PowerShell for the process bitness\n\tpwshExe = findWinPS();\n\tif (pwshExe) {\n\t\tyield pwshExe;\n\t}\n\n\t// Get the alternate bitness Windows PowerShell\n\tpwshExe = findWinPS({ useAlternateBitness: true });\n\tif (pwshExe) {\n\t\tyield pwshExe;\n\t}\n}\n\n/**\n * Iterates through PowerShell installations on the machine according\n * to configuration passed in through the constructor.\n * PowerShell items returned by this object are verified\n * to exist on the filesystem.\n */\nexport async function* enumeratePowerShellInstallations(): AsyncIterable<IPowerShellExeDetails> {\n\t// Get the default PowerShell installations first\n\tfor await (const defaultPwsh of enumerateDefaultPowerShellInstallations()) {\n\t\tif (await defaultPwsh.exists()) {\n\t\t\tyield defaultPwsh;\n\t\t}\n\t}\n}\n\n/**\n* Returns the first available PowerShell executable found in the search order.\n*/\nexport async function getFirstAvailablePowerShellInstallation(): Promise<IPowerShellExeDetails | null> {\n\tfor await (const pwsh of enumeratePowerShellInstallations()) {\n\t\treturn pwsh;\n\t}\n\treturn null;\n}\n","import { logger } from \"@coder/logger\"\nimport * as http from \"http\"\nimport * as proxyAgent from \"proxy-agent\"\nimport * as proxyFromEnv from \"proxy-from-env\"\n\n/**\n * This file has nothing to do with the code-server proxy.\n * It is to support $HTTP_PROXY, $HTTPS_PROXY and $NO_PROXY.\n *\n * - https://github.com/cdr/code-server/issues/124\n * - https://www.npmjs.com/package/proxy-agent\n * - https://www.npmjs.com/package/proxy-from-env\n *\n * This file exists in two locations:\n * - src/node/proxy_agent.ts\n * - lib/vscode/src/vs/base/node/proxy_agent.ts\n * The second is a symlink to the first.\n */\n\n/**\n * monkeyPatch patches the node http,https modules to route all requests through the\n * agent we get from the proxy-agent package.\n *\n * This approach only works if there is no code specifying an explicit agent when making\n * a request.\n *\n * None of our code ever passes in a explicit agent to the http,https modules.\n * VS Code's does sometimes but only when a user sets the http.proxy configuration.\n * See https://code.visualstudio.com/docs/setup/network#_legacy-proxy-server-support\n *\n * Even if they do, it's probably the same proxy so we should be fine! And those knobs\n * are deprecated anyway.\n */\nexport function monkeyPatch(inVSCode: boolean): void {\n  if (shouldEnableProxy()) {\n    const http = require(\"http\")\n    const https = require(\"https\")\n\n    // If we do not pass in a proxy URL, proxy-agent will get the URL from the environment.\n    // See https://www.npmjs.com/package/proxy-from-env.\n    // Also see shouldEnableProxy.\n    const pa = newProxyAgent(inVSCode)\n    http.globalAgent = pa\n    https.globalAgent = pa\n  }\n}\n\nfunction newProxyAgent(inVSCode: boolean): http.Agent {\n  // The reasoning for this split is that VS Code's build process does not have\n  // esModuleInterop enabled but the code-server one does. As a result depending on where\n  // we execute, we either have a default attribute or we don't.\n  //\n  // I can't enable esModuleInterop in VS Code's build process as it breaks and spits out\n  // a huge number of errors. And we can't use require as otherwise the modules won't be\n  // included in the final product.\n  if (inVSCode) {\n    return new (proxyAgent as any)()\n  } else {\n    return new (proxyAgent as any).default()\n  }\n}\n\n// If they have $NO_PROXY set to example.com then this check won't work!\n// But that's drastically unlikely.\nfunction shouldEnableProxy(): boolean {\n  let shouldEnable = false\n\n  const httpProxy = proxyFromEnv.getProxyForUrl(`http://example.com`)\n  if (httpProxy) {\n    shouldEnable = true\n    logger.debug(`using $HTTP_PROXY ${httpProxy}`)\n  }\n\n  const httpsProxy = proxyFromEnv.getProxyForUrl(`https://example.com`)\n  if (httpsProxy) {\n    shouldEnable = true\n    logger.debug(`using $HTTPS_PROXY ${httpsProxy}`)\n  }\n\n  return shouldEnable\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Event, Emitter, Relay, EventMultiplexer } from 'vs/base/common/event';\nimport { IDisposable, toDisposable, combinedDisposable, DisposableStore } from 'vs/base/common/lifecycle';\nimport { CancelablePromise, createCancelablePromise, timeout } from 'vs/base/common/async';\nimport { CancellationToken, CancellationTokenSource } from 'vs/base/common/cancellation';\nimport * as errors from 'vs/base/common/errors';\nimport { VSBuffer } from 'vs/base/common/buffer';\nimport { getRandomElement } from 'vs/base/common/arrays';\nimport { isFunction, isUndefinedOrNull } from 'vs/base/common/types';\nimport { revive } from 'vs/base/common/marshalling';\nimport * as strings from 'vs/base/common/strings';\n\n/**\n * An `IChannel` is an abstraction over a collection of commands.\n * You can `call` several commands on a channel, each taking at\n * most one single argument. A `call` always returns a promise\n * with at most one single return value.\n */\nexport interface IChannel {\n\tcall<T>(command: string, arg?: any, cancellationToken?: CancellationToken): Promise<T>;\n\tlisten<T>(event: string, arg?: any): Event<T>;\n}\n\n/**\n * An `IServerChannel` is the counter part to `IChannel`,\n * on the server-side. You should implement this interface\n * if you'd like to handle remote promises or events.\n */\nexport interface IServerChannel<TContext = string> {\n\tcall<T>(ctx: TContext, command: string, arg?: any, cancellationToken?: CancellationToken): Promise<T>;\n\tlisten<T>(ctx: TContext, event: string, arg?: any): Event<T>;\n}\n\nexport const enum RequestType {\n\tPromise = 100,\n\tPromiseCancel = 101,\n\tEventListen = 102,\n\tEventDispose = 103\n}\n\nfunction requestTypeToStr(type: RequestType): string {\n\tswitch (type) {\n\t\tcase RequestType.Promise:\n\t\t\treturn 'req';\n\t\tcase RequestType.PromiseCancel:\n\t\t\treturn 'cancel';\n\t\tcase RequestType.EventListen:\n\t\t\treturn 'subscribe';\n\t\tcase RequestType.EventDispose:\n\t\t\treturn 'unsubscribe';\n\t}\n}\n\ntype IRawPromiseRequest = { type: RequestType.Promise; id: number; channelName: string; name: string; arg: any; };\ntype IRawPromiseCancelRequest = { type: RequestType.PromiseCancel, id: number };\ntype IRawEventListenRequest = { type: RequestType.EventListen; id: number; channelName: string; name: string; arg: any; };\ntype IRawEventDisposeRequest = { type: RequestType.EventDispose, id: number };\ntype IRawRequest = IRawPromiseRequest | IRawPromiseCancelRequest | IRawEventListenRequest | IRawEventDisposeRequest;\n\nexport const enum ResponseType {\n\tInitialize = 200,\n\tPromiseSuccess = 201,\n\tPromiseError = 202,\n\tPromiseErrorObj = 203,\n\tEventFire = 204\n}\n\nfunction responseTypeToStr(type: ResponseType): string {\n\tswitch (type) {\n\t\tcase ResponseType.Initialize:\n\t\t\treturn `init`;\n\t\tcase ResponseType.PromiseSuccess:\n\t\t\treturn `reply:`;\n\t\tcase ResponseType.PromiseError:\n\t\tcase ResponseType.PromiseErrorObj:\n\t\t\treturn `replyErr:`;\n\t\tcase ResponseType.EventFire:\n\t\t\treturn `event:`;\n\t}\n}\n\ntype IRawInitializeResponse = { type: ResponseType.Initialize };\ntype IRawPromiseSuccessResponse = { type: ResponseType.PromiseSuccess; id: number; data: any };\ntype IRawPromiseErrorResponse = { type: ResponseType.PromiseError; id: number; data: { message: string, name: string, stack: string[] | undefined } };\ntype IRawPromiseErrorObjResponse = { type: ResponseType.PromiseErrorObj; id: number; data: any };\ntype IRawEventFireResponse = { type: ResponseType.EventFire; id: number; data: any };\ntype IRawResponse = IRawInitializeResponse | IRawPromiseSuccessResponse | IRawPromiseErrorResponse | IRawPromiseErrorObjResponse | IRawEventFireResponse;\n\ninterface IHandler {\n\t(response: IRawResponse): void;\n}\n\nexport interface IMessagePassingProtocol {\n\tsend(buffer: VSBuffer): void;\n\tonMessage: Event<VSBuffer>;\n\t/**\n\t * Wait for the write buffer (if applicable) to become empty.\n\t */\n\tdrain?(): Promise<void>;\n}\n\nenum State {\n\tUninitialized,\n\tIdle\n}\n\n/**\n * An `IChannelServer` hosts a collection of channels. You are\n * able to register channels onto it, provided a channel name.\n */\nexport interface IChannelServer<TContext = string> {\n\tregisterChannel(channelName: string, channel: IServerChannel<TContext>): void;\n}\n\n/**\n * An `IChannelClient` has access to a collection of channels. You\n * are able to get those channels, given their channel name.\n */\nexport interface IChannelClient {\n\tgetChannel<T extends IChannel>(channelName: string): T;\n}\n\nexport interface Client<TContext> {\n\treadonly ctx: TContext;\n}\n\nexport interface IConnectionHub<TContext> {\n\treadonly connections: Connection<TContext>[];\n\treadonly onDidAddConnection: Event<Connection<TContext>>;\n\treadonly onDidRemoveConnection: Event<Connection<TContext>>;\n}\n\n/**\n * An `IClientRouter` is responsible for routing calls to specific\n * channels, in scenarios in which there are multiple possible\n * channels (each from a separate client) to pick from.\n */\nexport interface IClientRouter<TContext = string> {\n\trouteCall(hub: IConnectionHub<TContext>, command: string, arg?: any, cancellationToken?: CancellationToken): Promise<Client<TContext>>;\n\trouteEvent(hub: IConnectionHub<TContext>, event: string, arg?: any): Promise<Client<TContext>>;\n}\n\n/**\n * Similar to the `IChannelClient`, you can get channels from this\n * collection of channels. The difference being that in the\n * `IRoutingChannelClient`, there are multiple clients providing\n * the same channel. You'll need to pass in an `IClientRouter` in\n * order to pick the right one.\n */\nexport interface IRoutingChannelClient<TContext = string> {\n\tgetChannel<T extends IChannel>(channelName: string, router?: IClientRouter<TContext>): T;\n}\n\ninterface IReader {\n\tread(bytes: number): VSBuffer;\n}\n\ninterface IWriter {\n\twrite(buffer: VSBuffer): void;\n}\n\nclass BufferReader implements IReader {\n\n\tprivate pos = 0;\n\n\tconstructor(private buffer: VSBuffer) { }\n\n\tread(bytes: number): VSBuffer {\n\t\tconst result = this.buffer.slice(this.pos, this.pos + bytes);\n\t\tthis.pos += result.byteLength;\n\t\treturn result;\n\t}\n}\n\nclass BufferWriter implements IWriter {\n\n\tprivate buffers: VSBuffer[] = [];\n\n\tget buffer(): VSBuffer {\n\t\treturn VSBuffer.concat(this.buffers);\n\t}\n\n\twrite(buffer: VSBuffer): void {\n\t\tthis.buffers.push(buffer);\n\t}\n}\n\nenum DataType {\n\tUndefined = 0,\n\tString = 1,\n\tBuffer = 2,\n\tVSBuffer = 3,\n\tArray = 4,\n\tObject = 5\n}\n\nfunction createSizeBuffer(size: number): VSBuffer {\n\tconst result = VSBuffer.alloc(4);\n\tresult.writeUInt32BE(size, 0);\n\treturn result;\n}\n\nfunction readSizeBuffer(reader: IReader): number {\n\treturn reader.read(4).readUInt32BE(0);\n}\n\nfunction createOneByteBuffer(value: number): VSBuffer {\n\tconst result = VSBuffer.alloc(1);\n\tresult.writeUInt8(value, 0);\n\treturn result;\n}\n\nconst BufferPresets = {\n\tUndefined: createOneByteBuffer(DataType.Undefined),\n\tString: createOneByteBuffer(DataType.String),\n\tBuffer: createOneByteBuffer(DataType.Buffer),\n\tVSBuffer: createOneByteBuffer(DataType.VSBuffer),\n\tArray: createOneByteBuffer(DataType.Array),\n\tObject: createOneByteBuffer(DataType.Object),\n};\n\ndeclare const Buffer: any;\nconst hasBuffer = (typeof Buffer !== 'undefined');\n\nfunction serialize(writer: IWriter, data: any): void {\n\tif (typeof data === 'undefined') {\n\t\twriter.write(BufferPresets.Undefined);\n\t} else if (typeof data === 'string') {\n\t\tconst buffer = VSBuffer.fromString(data);\n\t\twriter.write(BufferPresets.String);\n\t\twriter.write(createSizeBuffer(buffer.byteLength));\n\t\twriter.write(buffer);\n\t} else if (hasBuffer && Buffer.isBuffer(data)) {\n\t\tconst buffer = VSBuffer.wrap(data);\n\t\twriter.write(BufferPresets.Buffer);\n\t\twriter.write(createSizeBuffer(buffer.byteLength));\n\t\twriter.write(buffer);\n\t} else if (data instanceof VSBuffer) {\n\t\twriter.write(BufferPresets.VSBuffer);\n\t\twriter.write(createSizeBuffer(data.byteLength));\n\t\twriter.write(data);\n\t} else if (Array.isArray(data)) {\n\t\twriter.write(BufferPresets.Array);\n\t\twriter.write(createSizeBuffer(data.length));\n\n\t\tfor (const el of data) {\n\t\t\tserialize(writer, el);\n\t\t}\n\t} else {\n\t\tconst buffer = VSBuffer.fromString(JSON.stringify(data));\n\t\twriter.write(BufferPresets.Object);\n\t\twriter.write(createSizeBuffer(buffer.byteLength));\n\t\twriter.write(buffer);\n\t}\n}\n\nfunction deserialize(reader: IReader): any {\n\tconst type = reader.read(1).readUInt8(0);\n\n\tswitch (type) {\n\t\tcase DataType.Undefined: return undefined;\n\t\tcase DataType.String: return reader.read(readSizeBuffer(reader)).toString();\n\t\tcase DataType.Buffer: return reader.read(readSizeBuffer(reader)).buffer;\n\t\tcase DataType.VSBuffer: return reader.read(readSizeBuffer(reader));\n\t\tcase DataType.Array: {\n\t\t\tconst length = readSizeBuffer(reader);\n\t\t\tconst result: any[] = [];\n\n\t\t\tfor (let i = 0; i < length; i++) {\n\t\t\t\tresult.push(deserialize(reader));\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\t\tcase DataType.Object: return JSON.parse(reader.read(readSizeBuffer(reader)).toString());\n\t}\n}\n\ninterface PendingRequest {\n\trequest: IRawPromiseRequest | IRawEventListenRequest;\n\ttimeoutTimer: any;\n}\n\nexport class ChannelServer<TContext = string> implements IChannelServer<TContext>, IDisposable {\n\n\tprivate channels = new Map<string, IServerChannel<TContext>>();\n\tprivate activeRequests = new Map<number, IDisposable>();\n\tprivate protocolListener: IDisposable | null;\n\n\t// Requests might come in for channels which are not yet registered.\n\t// They will timeout after `timeoutDelay`.\n\tprivate pendingRequests = new Map<string, PendingRequest[]>();\n\n\tconstructor(private protocol: IMessagePassingProtocol, private ctx: TContext, private logger: IIPCLogger | null = null, private timeoutDelay: number = 1000) {\n\t\tthis.protocolListener = this.protocol.onMessage(msg => this.onRawMessage(msg));\n\t\tthis.sendResponse({ type: ResponseType.Initialize });\n\t}\n\n\tregisterChannel(channelName: string, channel: IServerChannel<TContext>): void {\n\t\tthis.channels.set(channelName, channel);\n\n\t\t// https://github.com/microsoft/vscode/issues/72531\n\t\tsetTimeout(() => this.flushPendingRequests(channelName), 0);\n\t}\n\n\tprivate sendResponse(response: IRawResponse): void {\n\t\tswitch (response.type) {\n\t\t\tcase ResponseType.Initialize: {\n\t\t\t\tconst msgLength = this.send([response.type]);\n\t\t\t\tif (this.logger) {\n\t\t\t\t\tthis.logger.logOutgoing(msgLength, 0, RequestInitiator.OtherSide, responseTypeToStr(response.type));\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcase ResponseType.PromiseSuccess:\n\t\t\tcase ResponseType.PromiseError:\n\t\t\tcase ResponseType.EventFire:\n\t\t\tcase ResponseType.PromiseErrorObj: {\n\t\t\t\tconst msgLength = this.send([response.type, response.id], response.data);\n\t\t\t\tif (this.logger) {\n\t\t\t\t\tthis.logger.logOutgoing(msgLength, response.id, RequestInitiator.OtherSide, responseTypeToStr(response.type), response.data);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate send(header: any, body: any = undefined): number {\n\t\tconst writer = new BufferWriter();\n\t\tserialize(writer, header);\n\t\tserialize(writer, body);\n\t\treturn this.sendBuffer(writer.buffer);\n\t}\n\n\tprivate sendBuffer(message: VSBuffer): number {\n\t\ttry {\n\t\t\tthis.protocol.send(message);\n\t\t\treturn message.byteLength;\n\t\t} catch (err) {\n\t\t\t// noop\n\t\t\treturn 0;\n\t\t}\n\t}\n\n\tprivate onRawMessage(message: VSBuffer): void {\n\t\tconst reader = new BufferReader(message);\n\t\tconst header = deserialize(reader);\n\t\tconst body = deserialize(reader);\n\t\tconst type = header[0] as RequestType;\n\n\t\tswitch (type) {\n\t\t\tcase RequestType.Promise:\n\t\t\t\tif (this.logger) {\n\t\t\t\t\tthis.logger.logIncoming(message.byteLength, header[1], RequestInitiator.OtherSide, `${requestTypeToStr(type)}: ${header[2]}.${header[3]}`, body);\n\t\t\t\t}\n\t\t\t\treturn this.onPromise({ type, id: header[1], channelName: header[2], name: header[3], arg: body });\n\t\t\tcase RequestType.EventListen:\n\t\t\t\tif (this.logger) {\n\t\t\t\t\tthis.logger.logIncoming(message.byteLength, header[1], RequestInitiator.OtherSide, `${requestTypeToStr(type)}: ${header[2]}.${header[3]}`, body);\n\t\t\t\t}\n\t\t\t\treturn this.onEventListen({ type, id: header[1], channelName: header[2], name: header[3], arg: body });\n\t\t\tcase RequestType.PromiseCancel:\n\t\t\t\tif (this.logger) {\n\t\t\t\t\tthis.logger.logIncoming(message.byteLength, header[1], RequestInitiator.OtherSide, `${requestTypeToStr(type)}`);\n\t\t\t\t}\n\t\t\t\treturn this.disposeActiveRequest({ type, id: header[1] });\n\t\t\tcase RequestType.EventDispose:\n\t\t\t\tif (this.logger) {\n\t\t\t\t\tthis.logger.logIncoming(message.byteLength, header[1], RequestInitiator.OtherSide, `${requestTypeToStr(type)}`);\n\t\t\t\t}\n\t\t\t\treturn this.disposeActiveRequest({ type, id: header[1] });\n\t\t}\n\t}\n\n\tprivate onPromise(request: IRawPromiseRequest): void {\n\t\tconst channel = this.channels.get(request.channelName);\n\n\t\tif (!channel) {\n\t\t\tthis.collectPendingRequest(request);\n\t\t\treturn;\n\t\t}\n\n\t\tconst cancellationTokenSource = new CancellationTokenSource();\n\t\tlet promise: Promise<any>;\n\n\t\ttry {\n\t\t\tpromise = channel.call(this.ctx, request.name, request.arg, cancellationTokenSource.token);\n\t\t} catch (err) {\n\t\t\tpromise = Promise.reject(err);\n\t\t}\n\n\t\tconst id = request.id;\n\n\t\tpromise.then(data => {\n\t\t\tthis.sendResponse(<IRawResponse>{ id, data, type: ResponseType.PromiseSuccess });\n\t\t\tthis.activeRequests.delete(request.id);\n\t\t}, err => {\n\t\t\tif (err instanceof Error) {\n\t\t\t\tthis.sendResponse(<IRawResponse>{\n\t\t\t\t\tid, data: {\n\t\t\t\t\t\tmessage: err.message,\n\t\t\t\t\t\tname: err.name,\n\t\t\t\t\t\tstack: err.stack ? (err.stack.split ? err.stack.split('\\n') : err.stack) : undefined\n\t\t\t\t\t}, type: ResponseType.PromiseError\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.sendResponse(<IRawResponse>{ id, data: err, type: ResponseType.PromiseErrorObj });\n\t\t\t}\n\n\t\t\tthis.activeRequests.delete(request.id);\n\t\t});\n\n\t\tconst disposable = toDisposable(() => cancellationTokenSource.cancel());\n\t\tthis.activeRequests.set(request.id, disposable);\n\t}\n\n\tprivate onEventListen(request: IRawEventListenRequest): void {\n\t\tconst channel = this.channels.get(request.channelName);\n\n\t\tif (!channel) {\n\t\t\tthis.collectPendingRequest(request);\n\t\t\treturn;\n\t\t}\n\n\t\tconst id = request.id;\n\t\tconst event = channel.listen(this.ctx, request.name, request.arg);\n\t\tconst disposable = event(data => this.sendResponse(<IRawResponse>{ id, data, type: ResponseType.EventFire }));\n\n\t\tthis.activeRequests.set(request.id, disposable);\n\t}\n\n\tprivate disposeActiveRequest(request: IRawRequest): void {\n\t\tconst disposable = this.activeRequests.get(request.id);\n\n\t\tif (disposable) {\n\t\t\tdisposable.dispose();\n\t\t\tthis.activeRequests.delete(request.id);\n\t\t}\n\t}\n\n\tprivate collectPendingRequest(request: IRawPromiseRequest | IRawEventListenRequest): void {\n\t\tlet pendingRequests = this.pendingRequests.get(request.channelName);\n\n\t\tif (!pendingRequests) {\n\t\t\tpendingRequests = [];\n\t\t\tthis.pendingRequests.set(request.channelName, pendingRequests);\n\t\t}\n\n\t\tconst timer = setTimeout(() => {\n\t\t\tconsole.error(`Unknown channel: ${request.channelName}`);\n\n\t\t\tif (request.type === RequestType.Promise) {\n\t\t\t\tthis.sendResponse(<IRawResponse>{\n\t\t\t\t\tid: request.id,\n\t\t\t\t\tdata: { name: 'Unknown channel', message: `Channel name '${request.channelName}' timed out after ${this.timeoutDelay}ms`, stack: undefined },\n\t\t\t\t\ttype: ResponseType.PromiseError\n\t\t\t\t});\n\t\t\t}\n\t\t}, this.timeoutDelay);\n\n\t\tpendingRequests.push({ request, timeoutTimer: timer });\n\t}\n\n\tprivate flushPendingRequests(channelName: string): void {\n\t\tconst requests = this.pendingRequests.get(channelName);\n\n\t\tif (requests) {\n\t\t\tfor (const request of requests) {\n\t\t\t\tclearTimeout(request.timeoutTimer);\n\n\t\t\t\tswitch (request.request.type) {\n\t\t\t\t\tcase RequestType.Promise: this.onPromise(request.request); break;\n\t\t\t\t\tcase RequestType.EventListen: this.onEventListen(request.request); break;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.pendingRequests.delete(channelName);\n\t\t}\n\t}\n\n\tpublic dispose(): void {\n\t\tif (this.protocolListener) {\n\t\t\tthis.protocolListener.dispose();\n\t\t\tthis.protocolListener = null;\n\t\t}\n\t\tthis.activeRequests.forEach(d => d.dispose());\n\t\tthis.activeRequests.clear();\n\t}\n}\n\nexport const enum RequestInitiator {\n\tLocalSide = 0,\n\tOtherSide = 1\n}\n\nexport interface IIPCLogger {\n\tlogIncoming(msgLength: number, requestId: number, initiator: RequestInitiator, str: string, data?: any): void;\n\tlogOutgoing(msgLength: number, requestId: number, initiator: RequestInitiator, str: string, data?: any): void;\n}\n\nexport class ChannelClient implements IChannelClient, IDisposable {\n\n\tprivate isDisposed: boolean = false;\n\tprivate state: State = State.Uninitialized;\n\tprivate activeRequests = new Set<IDisposable>();\n\tprivate handlers = new Map<number, IHandler>();\n\tprivate lastRequestId: number = 0;\n\tprivate protocolListener: IDisposable | null;\n\tprivate logger: IIPCLogger | null;\n\n\tprivate readonly _onDidInitialize = new Emitter<void>();\n\treadonly onDidInitialize = this._onDidInitialize.event;\n\n\tconstructor(private protocol: IMessagePassingProtocol, logger: IIPCLogger | null = null) {\n\t\tthis.protocolListener = this.protocol.onMessage(msg => this.onBuffer(msg));\n\t\tthis.logger = logger;\n\t}\n\n\tgetChannel<T extends IChannel>(channelName: string): T {\n\t\tconst that = this;\n\n\t\treturn {\n\t\t\tcall(command: string, arg?: any, cancellationToken?: CancellationToken) {\n\t\t\t\tif (that.isDisposed) {\n\t\t\t\t\treturn Promise.reject(errors.canceled());\n\t\t\t\t}\n\t\t\t\treturn that.requestPromise(channelName, command, arg, cancellationToken);\n\t\t\t},\n\t\t\tlisten(event: string, arg: any) {\n\t\t\t\tif (that.isDisposed) {\n\t\t\t\t\treturn Promise.reject(errors.canceled());\n\t\t\t\t}\n\t\t\t\treturn that.requestEvent(channelName, event, arg);\n\t\t\t}\n\t\t} as T;\n\t}\n\n\tprivate requestPromise(channelName: string, name: string, arg?: any, cancellationToken = CancellationToken.None): Promise<any> {\n\t\tconst id = this.lastRequestId++;\n\t\tconst type = RequestType.Promise;\n\t\tconst request: IRawRequest = { id, type, channelName, name, arg };\n\n\t\tif (cancellationToken.isCancellationRequested) {\n\t\t\treturn Promise.reject(errors.canceled());\n\t\t}\n\n\t\tlet disposable: IDisposable;\n\n\t\tconst result = new Promise((c, e) => {\n\t\t\tif (cancellationToken.isCancellationRequested) {\n\t\t\t\treturn e(errors.canceled());\n\t\t\t}\n\n\t\t\tconst doRequest = () => {\n\t\t\t\tconst handler: IHandler = response => {\n\t\t\t\t\tswitch (response.type) {\n\t\t\t\t\t\tcase ResponseType.PromiseSuccess:\n\t\t\t\t\t\t\tthis.handlers.delete(id);\n\t\t\t\t\t\t\tc(response.data);\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase ResponseType.PromiseError:\n\t\t\t\t\t\t\tthis.handlers.delete(id);\n\t\t\t\t\t\t\tconst error = new Error(response.data.message);\n\t\t\t\t\t\t\t(<any>error).stack = response.data.stack;\n\t\t\t\t\t\t\terror.name = response.data.name;\n\t\t\t\t\t\t\te(error);\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase ResponseType.PromiseErrorObj:\n\t\t\t\t\t\t\tthis.handlers.delete(id);\n\t\t\t\t\t\t\te(response.data);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tthis.handlers.set(id, handler);\n\t\t\t\tthis.sendRequest(request);\n\t\t\t};\n\n\t\t\tlet uninitializedPromise: CancelablePromise<void> | null = null;\n\t\t\tif (this.state === State.Idle) {\n\t\t\t\tdoRequest();\n\t\t\t} else {\n\t\t\t\tuninitializedPromise = createCancelablePromise(_ => this.whenInitialized());\n\t\t\t\tuninitializedPromise.then(() => {\n\t\t\t\t\tuninitializedPromise = null;\n\t\t\t\t\tdoRequest();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst cancel = () => {\n\t\t\t\tif (uninitializedPromise) {\n\t\t\t\t\tuninitializedPromise.cancel();\n\t\t\t\t\tuninitializedPromise = null;\n\t\t\t\t} else {\n\t\t\t\t\tthis.sendRequest({ id, type: RequestType.PromiseCancel });\n\t\t\t\t}\n\n\t\t\t\te(errors.canceled());\n\t\t\t};\n\n\t\t\tconst cancellationTokenListener = cancellationToken.onCancellationRequested(cancel);\n\t\t\tdisposable = combinedDisposable(toDisposable(cancel), cancellationTokenListener);\n\t\t\tthis.activeRequests.add(disposable);\n\t\t});\n\n\t\treturn result.finally(() => { this.activeRequests.delete(disposable); });\n\t}\n\n\tprivate requestEvent(channelName: string, name: string, arg?: any): Event<any> {\n\t\tconst id = this.lastRequestId++;\n\t\tconst type = RequestType.EventListen;\n\t\tconst request: IRawRequest = { id, type, channelName, name, arg };\n\n\t\tlet uninitializedPromise: CancelablePromise<void> | null = null;\n\n\t\tconst emitter = new Emitter<any>({\n\t\t\tonFirstListenerAdd: () => {\n\t\t\t\tuninitializedPromise = createCancelablePromise(_ => this.whenInitialized());\n\t\t\t\tuninitializedPromise.then(() => {\n\t\t\t\t\tuninitializedPromise = null;\n\t\t\t\t\tthis.activeRequests.add(emitter);\n\t\t\t\t\tthis.sendRequest(request);\n\t\t\t\t});\n\t\t\t},\n\t\t\tonLastListenerRemove: () => {\n\t\t\t\tif (uninitializedPromise) {\n\t\t\t\t\tuninitializedPromise.cancel();\n\t\t\t\t\tuninitializedPromise = null;\n\t\t\t\t} else {\n\t\t\t\t\tthis.activeRequests.delete(emitter);\n\t\t\t\t\tthis.sendRequest({ id, type: RequestType.EventDispose });\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tconst handler: IHandler = (res: IRawResponse) => emitter.fire((res as IRawEventFireResponse).data);\n\t\tthis.handlers.set(id, handler);\n\n\t\treturn emitter.event;\n\t}\n\n\tprivate sendRequest(request: IRawRequest): void {\n\t\tswitch (request.type) {\n\t\t\tcase RequestType.Promise:\n\t\t\tcase RequestType.EventListen: {\n\t\t\t\tconst msgLength = this.send([request.type, request.id, request.channelName, request.name], request.arg);\n\t\t\t\tif (this.logger) {\n\t\t\t\t\tthis.logger.logOutgoing(msgLength, request.id, RequestInitiator.LocalSide, `${requestTypeToStr(request.type)}: ${request.channelName}.${request.name}`, request.arg);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcase RequestType.PromiseCancel:\n\t\t\tcase RequestType.EventDispose: {\n\t\t\t\tconst msgLength = this.send([request.type, request.id]);\n\t\t\t\tif (this.logger) {\n\t\t\t\t\tthis.logger.logOutgoing(msgLength, request.id, RequestInitiator.LocalSide, requestTypeToStr(request.type));\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate send(header: any, body: any = undefined): number {\n\t\tconst writer = new BufferWriter();\n\t\tserialize(writer, header);\n\t\tserialize(writer, body);\n\t\treturn this.sendBuffer(writer.buffer);\n\t}\n\n\tprivate sendBuffer(message: VSBuffer): number {\n\t\ttry {\n\t\t\tthis.protocol.send(message);\n\t\t\treturn message.byteLength;\n\t\t} catch (err) {\n\t\t\t// noop\n\t\t\treturn 0;\n\t\t}\n\t}\n\n\tprivate onBuffer(message: VSBuffer): void {\n\t\tconst reader = new BufferReader(message);\n\t\tconst header = deserialize(reader);\n\t\tconst body = deserialize(reader);\n\t\tconst type: ResponseType = header[0];\n\n\t\tswitch (type) {\n\t\t\tcase ResponseType.Initialize:\n\t\t\t\tif (this.logger) {\n\t\t\t\t\tthis.logger.logIncoming(message.byteLength, 0, RequestInitiator.LocalSide, responseTypeToStr(type));\n\t\t\t\t}\n\t\t\t\treturn this.onResponse({ type: header[0] });\n\n\t\t\tcase ResponseType.PromiseSuccess:\n\t\t\tcase ResponseType.PromiseError:\n\t\t\tcase ResponseType.EventFire:\n\t\t\tcase ResponseType.PromiseErrorObj:\n\t\t\t\tif (this.logger) {\n\t\t\t\t\tthis.logger.logIncoming(message.byteLength, header[1], RequestInitiator.LocalSide, responseTypeToStr(type), body);\n\t\t\t\t}\n\t\t\t\treturn this.onResponse({ type: header[0], id: header[1], data: body });\n\t\t}\n\t}\n\n\tprivate onResponse(response: IRawResponse): void {\n\t\tif (response.type === ResponseType.Initialize) {\n\t\t\tthis.state = State.Idle;\n\t\t\tthis._onDidInitialize.fire();\n\t\t\treturn;\n\t\t}\n\n\t\tconst handler = this.handlers.get(response.id);\n\n\t\tif (handler) {\n\t\t\thandler(response);\n\t\t}\n\t}\n\n\tprivate whenInitialized(): Promise<void> {\n\t\tif (this.state === State.Idle) {\n\t\t\treturn Promise.resolve();\n\t\t} else {\n\t\t\treturn Event.toPromise(this.onDidInitialize);\n\t\t}\n\t}\n\n\tdispose(): void {\n\t\tthis.isDisposed = true;\n\t\tif (this.protocolListener) {\n\t\t\tthis.protocolListener.dispose();\n\t\t\tthis.protocolListener = null;\n\t\t}\n\t\tthis.activeRequests.forEach(p => p.dispose());\n\t\tthis.activeRequests.clear();\n\t}\n}\n\nexport interface ClientConnectionEvent {\n\tprotocol: IMessagePassingProtocol;\n\tonDidClientDisconnect: Event<void>;\n}\n\ninterface Connection<TContext> extends Client<TContext> {\n\treadonly channelServer: ChannelServer<TContext>;\n\treadonly channelClient: ChannelClient;\n}\n\n/**\n * An `IPCServer` is both a channel server and a routing channel\n * client.\n *\n * As the owner of a protocol, you should extend both this\n * and the `IPCClient` classes to get IPC implementations\n * for your protocol.\n */\nexport class IPCServer<TContext = string> implements IChannelServer<TContext>, IRoutingChannelClient<TContext>, IConnectionHub<TContext>, IDisposable {\n\n\tprivate channels = new Map<string, IServerChannel<TContext>>();\n\tprivate _connections = new Set<Connection<TContext>>();\n\n\tprivate readonly _onDidAddConnection = new Emitter<Connection<TContext>>();\n\treadonly onDidAddConnection: Event<Connection<TContext>> = this._onDidAddConnection.event;\n\n\tprivate readonly _onDidRemoveConnection = new Emitter<Connection<TContext>>();\n\treadonly onDidRemoveConnection: Event<Connection<TContext>> = this._onDidRemoveConnection.event;\n\n\tget connections(): Connection<TContext>[] {\n\t\tconst result: Connection<TContext>[] = [];\n\t\tthis._connections.forEach(ctx => result.push(ctx));\n\t\treturn result;\n\t}\n\n\tconstructor(onDidClientConnect: Event<ClientConnectionEvent>) {\n\t\tonDidClientConnect(({ protocol, onDidClientDisconnect }) => {\n\t\t\tconst onFirstMessage = Event.once(protocol.onMessage);\n\n\t\t\tonFirstMessage(msg => {\n\t\t\t\tconst reader = new BufferReader(msg);\n\t\t\t\tconst ctx = deserialize(reader) as TContext;\n\n\t\t\t\tconst channelServer = new ChannelServer(protocol, ctx);\n\t\t\t\tconst channelClient = new ChannelClient(protocol);\n\n\t\t\t\tthis.channels.forEach((channel, name) => channelServer.registerChannel(name, channel));\n\n\t\t\t\tconst connection: Connection<TContext> = { channelServer, channelClient, ctx };\n\t\t\t\tthis._connections.add(connection);\n\t\t\t\tthis._onDidAddConnection.fire(connection);\n\n\t\t\t\tonDidClientDisconnect(() => {\n\t\t\t\t\tchannelServer.dispose();\n\t\t\t\t\tchannelClient.dispose();\n\t\t\t\t\tthis._connections.delete(connection);\n\t\t\t\t\tthis._onDidRemoveConnection.fire(connection);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Get a channel from a remote client. When passed a router,\n\t * one can specify which client it wants to call and listen to/from.\n\t * Otherwise, when calling without a router, a random client will\n\t * be selected and when listening without a router, every client\n\t * will be listened to.\n\t */\n\tgetChannel<T extends IChannel>(channelName: string, router: IClientRouter<TContext>): T;\n\tgetChannel<T extends IChannel>(channelName: string, clientFilter: (client: Client<TContext>) => boolean): T;\n\tgetChannel<T extends IChannel>(channelName: string, routerOrClientFilter: IClientRouter<TContext> | ((client: Client<TContext>) => boolean)): T {\n\t\tconst that = this;\n\n\t\treturn {\n\t\t\tcall(command: string, arg?: any, cancellationToken?: CancellationToken): Promise<T> {\n\t\t\t\tlet connectionPromise: Promise<Client<TContext>>;\n\n\t\t\t\tif (isFunction(routerOrClientFilter)) {\n\t\t\t\t\t// when no router is provided, we go random client picking\n\t\t\t\t\tlet connection = getRandomElement(that.connections.filter(routerOrClientFilter));\n\n\t\t\t\t\tconnectionPromise = connection\n\t\t\t\t\t\t// if we found a client, let's call on it\n\t\t\t\t\t\t? Promise.resolve(connection)\n\t\t\t\t\t\t// else, let's wait for a client to come along\n\t\t\t\t\t\t: Event.toPromise(Event.filter(that.onDidAddConnection, routerOrClientFilter));\n\t\t\t\t} else {\n\t\t\t\t\tconnectionPromise = routerOrClientFilter.routeCall(that, command, arg);\n\t\t\t\t}\n\n\t\t\t\tconst channelPromise = connectionPromise\n\t\t\t\t\t.then(connection => (connection as Connection<TContext>).channelClient.getChannel(channelName));\n\n\t\t\t\treturn getDelayedChannel(channelPromise)\n\t\t\t\t\t.call(command, arg, cancellationToken);\n\t\t\t},\n\t\t\tlisten(event: string, arg: any): Event<T> {\n\t\t\t\tif (isFunction(routerOrClientFilter)) {\n\t\t\t\t\treturn that.getMulticastEvent(channelName, routerOrClientFilter, event, arg);\n\t\t\t\t}\n\n\t\t\t\tconst channelPromise = routerOrClientFilter.routeEvent(that, event, arg)\n\t\t\t\t\t.then(connection => (connection as Connection<TContext>).channelClient.getChannel(channelName));\n\n\t\t\t\treturn getDelayedChannel(channelPromise)\n\t\t\t\t\t.listen(event, arg);\n\t\t\t}\n\t\t} as T;\n\t}\n\n\tprivate getMulticastEvent<T extends IChannel>(channelName: string, clientFilter: (client: Client<TContext>) => boolean, eventName: string, arg: any): Event<T> {\n\t\tconst that = this;\n\t\tlet disposables = new DisposableStore();\n\n\t\t// Create an emitter which hooks up to all clients\n\t\t// as soon as first listener is added. It also\n\t\t// disconnects from all clients as soon as the last listener\n\t\t// is removed.\n\t\tconst emitter = new Emitter<T>({\n\t\t\tonFirstListenerAdd: () => {\n\t\t\t\tdisposables = new DisposableStore();\n\n\t\t\t\t// The event multiplexer is useful since the active\n\t\t\t\t// client list is dynamic. We need to hook up and disconnection\n\t\t\t\t// to/from clients as they come and go.\n\t\t\t\tconst eventMultiplexer = new EventMultiplexer<T>();\n\t\t\t\tconst map = new Map<Connection<TContext>, IDisposable>();\n\n\t\t\t\tconst onDidAddConnection = (connection: Connection<TContext>) => {\n\t\t\t\t\tconst channel = connection.channelClient.getChannel(channelName);\n\t\t\t\t\tconst event = channel.listen<T>(eventName, arg);\n\t\t\t\t\tconst disposable = eventMultiplexer.add(event);\n\n\t\t\t\t\tmap.set(connection, disposable);\n\t\t\t\t};\n\n\t\t\t\tconst onDidRemoveConnection = (connection: Connection<TContext>) => {\n\t\t\t\t\tconst disposable = map.get(connection);\n\n\t\t\t\t\tif (!disposable) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tdisposable.dispose();\n\t\t\t\t\tmap.delete(connection);\n\t\t\t\t};\n\n\t\t\t\tthat.connections.filter(clientFilter).forEach(onDidAddConnection);\n\t\t\t\tEvent.filter(that.onDidAddConnection, clientFilter)(onDidAddConnection, undefined, disposables);\n\t\t\t\tthat.onDidRemoveConnection(onDidRemoveConnection, undefined, disposables);\n\t\t\t\teventMultiplexer.event(emitter.fire, emitter, disposables);\n\n\t\t\t\tdisposables.add(eventMultiplexer);\n\t\t\t},\n\t\t\tonLastListenerRemove: () => {\n\t\t\t\tdisposables.dispose();\n\t\t\t}\n\t\t});\n\n\t\treturn emitter.event;\n\t}\n\n\tregisterChannel(channelName: string, channel: IServerChannel<TContext>): void {\n\t\tthis.channels.set(channelName, channel);\n\n\t\tthis._connections.forEach(connection => {\n\t\t\tconnection.channelServer.registerChannel(channelName, channel);\n\t\t});\n\t}\n\n\tdispose(): void {\n\t\tthis.channels.clear();\n\t\tthis._connections.clear();\n\t\tthis._onDidAddConnection.dispose();\n\t\tthis._onDidRemoveConnection.dispose();\n\t}\n}\n\n/**\n * An `IPCClient` is both a channel client and a channel server.\n *\n * As the owner of a protocol, you should extend both this\n * and the `IPCClient` classes to get IPC implementations\n * for your protocol.\n */\nexport class IPCClient<TContext = string> implements IChannelClient, IChannelServer<TContext>, IDisposable {\n\n\tprivate channelClient: ChannelClient;\n\tprivate channelServer: ChannelServer<TContext>;\n\n\tconstructor(protocol: IMessagePassingProtocol, ctx: TContext, ipcLogger: IIPCLogger | null = null) {\n\t\tconst writer = new BufferWriter();\n\t\tserialize(writer, ctx);\n\t\tprotocol.send(writer.buffer);\n\n\t\tthis.channelClient = new ChannelClient(protocol, ipcLogger);\n\t\tthis.channelServer = new ChannelServer(protocol, ctx, ipcLogger);\n\t}\n\n\tgetChannel<T extends IChannel>(channelName: string): T {\n\t\treturn this.channelClient.getChannel(channelName) as T;\n\t}\n\n\tregisterChannel(channelName: string, channel: IServerChannel<TContext>): void {\n\t\tthis.channelServer.registerChannel(channelName, channel);\n\t}\n\n\tdispose(): void {\n\t\tthis.channelClient.dispose();\n\t\tthis.channelServer.dispose();\n\t}\n}\n\nexport function getDelayedChannel<T extends IChannel>(promise: Promise<T>): T {\n\treturn {\n\t\tcall(command: string, arg?: any, cancellationToken?: CancellationToken): Promise<T> {\n\t\t\treturn promise.then(c => c.call<T>(command, arg, cancellationToken));\n\t\t},\n\n\t\tlisten<T>(event: string, arg?: any): Event<T> {\n\t\t\tconst relay = new Relay<any>();\n\t\t\tpromise.then(c => relay.input = c.listen(event, arg));\n\t\t\treturn relay.event;\n\t\t}\n\t} as T;\n}\n\nexport function getNextTickChannel<T extends IChannel>(channel: T): T {\n\tlet didTick = false;\n\n\treturn {\n\t\tcall<T>(command: string, arg?: any, cancellationToken?: CancellationToken): Promise<T> {\n\t\t\tif (didTick) {\n\t\t\t\treturn channel.call(command, arg, cancellationToken);\n\t\t\t}\n\n\t\t\treturn timeout(0)\n\t\t\t\t.then(() => didTick = true)\n\t\t\t\t.then(() => channel.call<T>(command, arg, cancellationToken));\n\t\t},\n\t\tlisten<T>(event: string, arg?: any): Event<T> {\n\t\t\tif (didTick) {\n\t\t\t\treturn channel.listen<T>(event, arg);\n\t\t\t}\n\n\t\t\tconst relay = new Relay<T>();\n\n\t\t\ttimeout(0)\n\t\t\t\t.then(() => didTick = true)\n\t\t\t\t.then(() => relay.input = channel.listen<T>(event, arg));\n\n\t\t\treturn relay.event;\n\t\t}\n\t} as T;\n}\n\nexport class StaticRouter<TContext = string> implements IClientRouter<TContext> {\n\n\tconstructor(private fn: (ctx: TContext) => boolean | Promise<boolean>) { }\n\n\trouteCall(hub: IConnectionHub<TContext>): Promise<Client<TContext>> {\n\t\treturn this.route(hub);\n\t}\n\n\trouteEvent(hub: IConnectionHub<TContext>): Promise<Client<TContext>> {\n\t\treturn this.route(hub);\n\t}\n\n\tprivate async route(hub: IConnectionHub<TContext>): Promise<Client<TContext>> {\n\t\tfor (const connection of hub.connections) {\n\t\t\tif (await Promise.resolve(this.fn(connection.ctx))) {\n\t\t\t\treturn Promise.resolve(connection);\n\t\t\t}\n\t\t}\n\n\t\tawait Event.toPromise(hub.onDidAddConnection);\n\t\treturn await this.route(hub);\n\t}\n}\n\n\n//#region createChannelReceiver / createChannelSender\n\n/**\n * Use both `createChannelReceiver` and `createChannelSender`\n * for automated process <=> process communication over methods\n * and events. You do not need to spell out each method on both\n * sides, a proxy will take care of this.\n *\n * Rules:\n * - if marshalling is enabled, only `URI` and `RegExp` is converted\n *   automatically for you\n * - events must follow the naming convention `onUppercase`\n * - `CancellationToken` is currently not supported\n * - if a context is provided, you can use `AddFirstParameterToFunctions`\n *   utility to signal this in the receiving side type\n */\n\nexport interface IBaseChannelOptions {\n\n\t/**\n\t * Disables automatic marshalling of `URI`.\n\t * If marshalling is disabled, `UriComponents`\n\t * must be used instead.\n\t */\n\tdisableMarshalling?: boolean;\n}\n\nexport interface IChannelReceiverOptions extends IBaseChannelOptions { }\n\nexport function createChannelReceiver(service: unknown, options?: IChannelReceiverOptions): IServerChannel {\n\tconst handler = service as { [key: string]: unknown };\n\tconst disableMarshalling = options && options.disableMarshalling;\n\n\t// Buffer any event that should be supported by\n\t// iterating over all property keys and finding them\n\tconst mapEventNameToEvent = new Map<string, Event<unknown>>();\n\tfor (const key in handler) {\n\t\tif (propertyIsEvent(key)) {\n\t\t\tmapEventNameToEvent.set(key, Event.buffer(handler[key] as Event<unknown>, true));\n\t\t}\n\t}\n\n\treturn new class implements IServerChannel {\n\n\t\tlisten<T>(_: unknown, event: string): Event<T> {\n\t\t\tconst eventImpl = mapEventNameToEvent.get(event);\n\t\t\tif (eventImpl) {\n\t\t\t\treturn eventImpl as Event<T>;\n\t\t\t}\n\n\t\t\tthrow new Error(`Event not found: ${event}`);\n\t\t}\n\n\t\tcall(_: unknown, command: string, args?: any[]): Promise<any> {\n\t\t\tconst target = handler[command];\n\t\t\tif (typeof target === 'function') {\n\n\t\t\t\t// Revive unless marshalling disabled\n\t\t\t\tif (!disableMarshalling && Array.isArray(args)) {\n\t\t\t\t\tfor (let i = 0; i < args.length; i++) {\n\t\t\t\t\t\targs[i] = revive(args[i]);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn target.apply(handler, args);\n\t\t\t}\n\n\t\t\tthrow new Error(`Method not found: ${command}`);\n\t\t}\n\t};\n}\n\nexport interface IChannelSenderOptions extends IBaseChannelOptions {\n\n\t/**\n\t * If provided, will add the value of `context`\n\t * to each method call to the target.\n\t */\n\tcontext?: unknown;\n\n\t/**\n\t * If provided, will not proxy any of the properties\n\t * that are part of the Map but rather return that value.\n\t */\n\tproperties?: Map<string, unknown>;\n}\n\nexport function createChannelSender<T>(channel: IChannel, options?: IChannelSenderOptions): T {\n\tconst disableMarshalling = options && options.disableMarshalling;\n\n\treturn new Proxy({}, {\n\t\tget(_target: T, propKey: PropertyKey) {\n\t\t\tif (typeof propKey === 'string') {\n\n\t\t\t\t// Check for predefined values\n\t\t\t\tif (options?.properties?.has(propKey)) {\n\t\t\t\t\treturn options.properties.get(propKey);\n\t\t\t\t}\n\n\t\t\t\t// Event\n\t\t\t\tif (propertyIsEvent(propKey)) {\n\t\t\t\t\treturn channel.listen(propKey);\n\t\t\t\t}\n\n\t\t\t\t// Function\n\t\t\t\treturn async function (...args: any[]) {\n\n\t\t\t\t\t// Add context if any\n\t\t\t\t\tlet methodArgs: any[];\n\t\t\t\t\tif (options && !isUndefinedOrNull(options.context)) {\n\t\t\t\t\t\tmethodArgs = [options.context, ...args];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmethodArgs = args;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst result = await channel.call(propKey, methodArgs);\n\n\t\t\t\t\t// Revive unless marshalling disabled\n\t\t\t\t\tif (!disableMarshalling) {\n\t\t\t\t\t\treturn revive(result);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn result;\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tthrow new Error(`Property not found: ${String(propKey)}`);\n\t\t}\n\t}) as T;\n}\n\nfunction propertyIsEvent(name: string): boolean {\n\t// Assume a property is an event if it has a form of \"onSomething\"\n\treturn name[0] === 'o' && name[1] === 'n' && strings.isUpperAsciiLetter(name.charCodeAt(2));\n}\n\n//#endregion\n\n\nconst colorTables = [\n\t['#2977B1', '#FC802D', '#34A13A', '#D3282F', '#9366BA'],\n\t['#8B564C', '#E177C0', '#7F7F7F', '#BBBE3D', '#2EBECD']\n];\n\nfunction prettyWithoutArrays(data: any): any {\n\tif (Array.isArray(data)) {\n\t\treturn data;\n\t}\n\tif (data && typeof data === 'object' && typeof data.toString === 'function') {\n\t\tlet result = data.toString();\n\t\tif (result !== '[object Object]') {\n\t\t\treturn result;\n\t\t}\n\t}\n\treturn data;\n}\n\nfunction pretty(data: any): any {\n\tif (Array.isArray(data)) {\n\t\treturn data.map(prettyWithoutArrays);\n\t}\n\treturn prettyWithoutArrays(data);\n}\n\nexport function logWithColors(direction: string, totalLength: number, msgLength: number, req: number, initiator: RequestInitiator, str: string, data: any): void {\n\tdata = pretty(data);\n\n\tconst colorTable = colorTables[initiator];\n\tconst color = colorTable[req % colorTable.length];\n\tlet args = [`%c[${direction}]%c[${String(totalLength).padStart(7, ' ')}]%c[len: ${String(msgLength).padStart(5, ' ')}]%c${String(req).padStart(5, ' ')} - ${str}`, 'color: darkgreen', 'color: grey', 'color: grey', `color: ${color}`];\n\tif (/\\($/.test(str)) {\n\t\targs = args.concat(data);\n\t\targs.push(')');\n\t} else {\n\t\targs.push(data);\n\t}\n\tconsole.log.apply(console, args as [string, ...string[]]);\n}\n\nexport class IPCLogger implements IIPCLogger {\n\tprivate _totalIncoming = 0;\n\tprivate _totalOutgoing = 0;\n\n\tconstructor(\n\t\tprivate readonly _outgoingPrefix: string,\n\t\tprivate readonly _incomingPrefix: string,\n\t) { }\n\n\tpublic logOutgoing(msgLength: number, requestId: number, initiator: RequestInitiator, str: string, data?: any): void {\n\t\tthis._totalOutgoing += msgLength;\n\t\tlogWithColors(this._outgoingPrefix, this._totalOutgoing, msgLength, requestId, initiator, str, data);\n\t}\n\n\tpublic logIncoming(msgLength: number, requestId: number, initiator: RequestInitiator, str: string, data?: any): void {\n\t\tthis._totalIncoming += msgLength;\n\t\tlogWithColors(this._incomingPrefix, this._totalIncoming, msgLength, requestId, initiator, str, data);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Event, Emitter } from 'vs/base/common/event';\nimport { IMessagePassingProtocol, IPCClient, IIPCLogger } from 'vs/base/parts/ipc/common/ipc';\nimport { IDisposable, Disposable, dispose } from 'vs/base/common/lifecycle';\nimport { VSBuffer } from 'vs/base/common/buffer';\nimport * as platform from 'vs/base/common/platform';\nimport * as process from 'vs/base/common/process';\n\nexport interface ISocket extends IDisposable {\n\tonData(listener: (e: VSBuffer) => void): IDisposable;\n\tonClose(listener: () => void): IDisposable;\n\tonEnd(listener: () => void): IDisposable;\n\twrite(buffer: VSBuffer): void;\n\tend(): void;\n\tdrain(): Promise<void>;\n}\n\nlet emptyBuffer: VSBuffer | null = null;\nfunction getEmptyBuffer(): VSBuffer {\n\tif (!emptyBuffer) {\n\t\temptyBuffer = VSBuffer.alloc(0);\n\t}\n\treturn emptyBuffer;\n}\n\nexport class ChunkStream {\n\n\tprivate _chunks: VSBuffer[];\n\tprivate _totalLength: number;\n\n\tpublic get byteLength() {\n\t\treturn this._totalLength;\n\t}\n\n\tconstructor() {\n\t\tthis._chunks = [];\n\t\tthis._totalLength = 0;\n\t}\n\n\tpublic acceptChunk(buff: VSBuffer) {\n\t\tthis._chunks.push(buff);\n\t\tthis._totalLength += buff.byteLength;\n\t}\n\n\tpublic read(byteCount: number): VSBuffer {\n\t\treturn this._read(byteCount, true);\n\t}\n\n\tpublic peek(byteCount: number): VSBuffer {\n\t\treturn this._read(byteCount, false);\n\t}\n\n\tprivate _read(byteCount: number, advance: boolean): VSBuffer {\n\n\t\tif (byteCount === 0) {\n\t\t\treturn getEmptyBuffer();\n\t\t}\n\n\t\tif (byteCount > this._totalLength) {\n\t\t\tthrow new Error(`Cannot read so many bytes!`);\n\t\t}\n\n\t\tif (this._chunks[0].byteLength === byteCount) {\n\t\t\t// super fast path, precisely first chunk must be returned\n\t\t\tconst result = this._chunks[0];\n\t\t\tif (advance) {\n\t\t\t\tthis._chunks.shift();\n\t\t\t\tthis._totalLength -= byteCount;\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\n\t\tif (this._chunks[0].byteLength > byteCount) {\n\t\t\t// fast path, the reading is entirely within the first chunk\n\t\t\tconst result = this._chunks[0].slice(0, byteCount);\n\t\t\tif (advance) {\n\t\t\t\tthis._chunks[0] = this._chunks[0].slice(byteCount);\n\t\t\t\tthis._totalLength -= byteCount;\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\n\t\tlet result = VSBuffer.alloc(byteCount);\n\t\tlet resultOffset = 0;\n\t\tlet chunkIndex = 0;\n\t\twhile (byteCount > 0) {\n\t\t\tconst chunk = this._chunks[chunkIndex];\n\t\t\tif (chunk.byteLength > byteCount) {\n\t\t\t\t// this chunk will survive\n\t\t\t\tconst chunkPart = chunk.slice(0, byteCount);\n\t\t\t\tresult.set(chunkPart, resultOffset);\n\t\t\t\tresultOffset += byteCount;\n\n\t\t\t\tif (advance) {\n\t\t\t\t\tthis._chunks[chunkIndex] = chunk.slice(byteCount);\n\t\t\t\t\tthis._totalLength -= byteCount;\n\t\t\t\t}\n\n\t\t\t\tbyteCount -= byteCount;\n\t\t\t} else {\n\t\t\t\t// this chunk will be entirely read\n\t\t\t\tresult.set(chunk, resultOffset);\n\t\t\t\tresultOffset += chunk.byteLength;\n\n\t\t\t\tif (advance) {\n\t\t\t\t\tthis._chunks.shift();\n\t\t\t\t\tthis._totalLength -= chunk.byteLength;\n\t\t\t\t} else {\n\t\t\t\t\tchunkIndex++;\n\t\t\t\t}\n\n\t\t\t\tbyteCount -= chunk.byteLength;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n}\n\nconst enum ProtocolMessageType {\n\tNone = 0,\n\tRegular = 1,\n\tControl = 2,\n\tAck = 3,\n\tKeepAlive = 4,\n\tDisconnect = 5,\n\tReplayRequest = 6\n}\n\nexport const enum ProtocolConstants {\n\tHeaderLength = 13,\n\t/**\n\t * Send an Acknowledge message at most 2 seconds later...\n\t */\n\tAcknowledgeTime = 2000, // 2 seconds\n\t/**\n\t * If there is a message that has been unacknowledged for 10 seconds, consider the connection closed...\n\t */\n\tAcknowledgeTimeoutTime = 20000, // 20 seconds\n\t/**\n\t * Send at least a message every 5s for keep alive reasons.\n\t */\n\tKeepAliveTime = 5000, // 5 seconds\n\t/**\n\t * If there is no message received for 10 seconds, consider the connection closed...\n\t */\n\tKeepAliveTimeoutTime = 20000, // 20 seconds\n\t/**\n\t * If there is no reconnection within this time-frame, consider the connection permanently closed...\n\t */\n\tReconnectionGraceTime = 3 * 60 * 60 * 1000, // 3hrs\n\t/**\n\t * Maximal grace time between the first and the last reconnection...\n\t */\n\tReconnectionShortGraceTime = 5 * 60 * 1000, // 5min\n}\n\nclass ProtocolMessage {\n\n\tpublic writtenTime: number;\n\n\tconstructor(\n\t\tpublic readonly type: ProtocolMessageType,\n\t\tpublic readonly id: number,\n\t\tpublic readonly ack: number,\n\t\tpublic readonly data: VSBuffer\n\t) {\n\t\tthis.writtenTime = 0;\n\t}\n\n\tpublic get size(): number {\n\t\treturn this.data.byteLength;\n\t}\n}\n\nclass ProtocolReader extends Disposable {\n\n\tprivate readonly _socket: ISocket;\n\tprivate _isDisposed: boolean;\n\tprivate readonly _incomingData: ChunkStream;\n\tpublic lastReadTime: number;\n\n\tprivate readonly _onMessage = this._register(new Emitter<ProtocolMessage>());\n\tpublic readonly onMessage: Event<ProtocolMessage> = this._onMessage.event;\n\n\tprivate readonly _state = {\n\t\treadHead: true,\n\t\treadLen: ProtocolConstants.HeaderLength,\n\t\tmessageType: ProtocolMessageType.None,\n\t\tid: 0,\n\t\tack: 0\n\t};\n\n\tconstructor(socket: ISocket) {\n\t\tsuper();\n\t\tthis._socket = socket;\n\t\tthis._isDisposed = false;\n\t\tthis._incomingData = new ChunkStream();\n\t\tthis._register(this._socket.onData(data => this.acceptChunk(data)));\n\t\tthis.lastReadTime = Date.now();\n\t}\n\n\tpublic acceptChunk(data: VSBuffer | null): void {\n\t\tif (!data || data.byteLength === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.lastReadTime = Date.now();\n\n\t\tthis._incomingData.acceptChunk(data);\n\n\t\twhile (this._incomingData.byteLength >= this._state.readLen) {\n\n\t\t\tconst buff = this._incomingData.read(this._state.readLen);\n\n\t\t\tif (this._state.readHead) {\n\t\t\t\t// buff is the header\n\n\t\t\t\t// save new state => next time will read the body\n\t\t\t\tthis._state.readHead = false;\n\t\t\t\tthis._state.readLen = buff.readUInt32BE(9);\n\t\t\t\tthis._state.messageType = buff.readUInt8(0);\n\t\t\t\tthis._state.id = buff.readUInt32BE(1);\n\t\t\t\tthis._state.ack = buff.readUInt32BE(5);\n\t\t\t} else {\n\t\t\t\t// buff is the body\n\t\t\t\tconst messageType = this._state.messageType;\n\t\t\t\tconst id = this._state.id;\n\t\t\t\tconst ack = this._state.ack;\n\n\t\t\t\t// save new state => next time will read the header\n\t\t\t\tthis._state.readHead = true;\n\t\t\t\tthis._state.readLen = ProtocolConstants.HeaderLength;\n\t\t\t\tthis._state.messageType = ProtocolMessageType.None;\n\t\t\t\tthis._state.id = 0;\n\t\t\t\tthis._state.ack = 0;\n\n\t\t\t\tthis._onMessage.fire(new ProtocolMessage(messageType, id, ack, buff));\n\n\t\t\t\tif (this._isDisposed) {\n\t\t\t\t\t// check if an event listener lead to our disposal\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic readEntireBuffer(): VSBuffer {\n\t\treturn this._incomingData.read(this._incomingData.byteLength);\n\t}\n\n\tpublic dispose(): void {\n\t\tthis._isDisposed = true;\n\t\tsuper.dispose();\n\t}\n}\n\nclass ProtocolWriter {\n\n\tprivate _isDisposed: boolean;\n\tprivate readonly _socket: ISocket;\n\tprivate _data: VSBuffer[];\n\tprivate _totalLength: number;\n\tpublic lastWriteTime: number;\n\n\tconstructor(socket: ISocket) {\n\t\tthis._isDisposed = false;\n\t\tthis._socket = socket;\n\t\tthis._data = [];\n\t\tthis._totalLength = 0;\n\t\tthis.lastWriteTime = 0;\n\t}\n\n\tpublic dispose(): void {\n\t\ttry {\n\t\t\tthis.flush();\n\t\t} catch (err) {\n\t\t\t// ignore error, since the socket could be already closed\n\t\t}\n\t\tthis._isDisposed = true;\n\t}\n\n\tpublic drain(): Promise<void> {\n\t\tthis.flush();\n\t\treturn this._socket.drain();\n\t}\n\n\tpublic flush(): void {\n\t\t// flush\n\t\tthis._writeNow();\n\t}\n\n\tpublic write(msg: ProtocolMessage) {\n\t\tif (this._isDisposed) {\n\t\t\t// ignore: there could be left-over promises which complete and then\n\t\t\t// decide to write a response, etc...\n\t\t\treturn;\n\t\t}\n\t\tmsg.writtenTime = Date.now();\n\t\tthis.lastWriteTime = Date.now();\n\t\tconst header = VSBuffer.alloc(ProtocolConstants.HeaderLength);\n\t\theader.writeUInt8(msg.type, 0);\n\t\theader.writeUInt32BE(msg.id, 1);\n\t\theader.writeUInt32BE(msg.ack, 5);\n\t\theader.writeUInt32BE(msg.data.byteLength, 9);\n\t\tthis._writeSoon(header, msg.data);\n\t}\n\n\tprivate _bufferAdd(head: VSBuffer, body: VSBuffer): boolean {\n\t\tconst wasEmpty = this._totalLength === 0;\n\t\tthis._data.push(head, body);\n\t\tthis._totalLength += head.byteLength + body.byteLength;\n\t\treturn wasEmpty;\n\t}\n\n\tprivate _bufferTake(): VSBuffer {\n\t\tconst ret = VSBuffer.concat(this._data, this._totalLength);\n\t\tthis._data.length = 0;\n\t\tthis._totalLength = 0;\n\t\treturn ret;\n\t}\n\n\tprivate _writeSoon(header: VSBuffer, data: VSBuffer): void {\n\t\tif (this._bufferAdd(header, data)) {\n\t\t\tplatform.setImmediate(() => {\n\t\t\t\tthis._writeNow();\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate _writeNow(): void {\n\t\tif (this._totalLength === 0) {\n\t\t\treturn;\n\t\t}\n\t\tthis._socket.write(this._bufferTake());\n\t}\n}\n\n/**\n * A message has the following format:\n * ```\n *     /-------------------------------|------\\\n *     |             HEADER            |      |\n *     |-------------------------------| DATA |\n *     | TYPE | ID | ACK | DATA_LENGTH |      |\n *     \\-------------------------------|------/\n * ```\n * The header is 9 bytes and consists of:\n *  - TYPE is 1 byte (ProtocolMessageType) - the message type\n *  - ID is 4 bytes (u32be) - the message id (can be 0 to indicate to be ignored)\n *  - ACK is 4 bytes (u32be) - the acknowledged message id (can be 0 to indicate to be ignored)\n *  - DATA_LENGTH is 4 bytes (u32be) - the length in bytes of DATA\n *\n * Only Regular messages are counted, other messages are not counted, nor acknowledged.\n */\nexport class Protocol extends Disposable implements IMessagePassingProtocol {\n\n\tprivate _socket: ISocket;\n\tprivate _socketWriter: ProtocolWriter;\n\tprivate _socketReader: ProtocolReader;\n\n\tprivate readonly _onMessage = new Emitter<VSBuffer>();\n\treadonly onMessage: Event<VSBuffer> = this._onMessage.event;\n\n\tprivate readonly _onDidDispose = new Emitter<void>();\n\treadonly onDidDispose: Event<void> = this._onDidDispose.event;\n\n\tconstructor(socket: ISocket) {\n\t\tsuper();\n\t\tthis._socket = socket;\n\t\tthis._socketWriter = this._register(new ProtocolWriter(this._socket));\n\t\tthis._socketReader = this._register(new ProtocolReader(this._socket));\n\n\t\tthis._register(this._socketReader.onMessage((msg) => {\n\t\t\tif (msg.type === ProtocolMessageType.Regular) {\n\t\t\t\tthis._onMessage.fire(msg.data);\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this._socket.onClose(() => this._onDidDispose.fire()));\n\t}\n\n\tdrain(): Promise<void> {\n\t\treturn this._socketWriter.drain();\n\t}\n\n\tgetSocket(): ISocket {\n\t\treturn this._socket;\n\t}\n\n\tsendDisconnect(): void {\n\t\t// Nothing to do...\n\t}\n\n\tsend(buffer: VSBuffer): void {\n\t\tthis._socketWriter.write(new ProtocolMessage(ProtocolMessageType.Regular, 0, 0, buffer));\n\t}\n}\n\nexport class Client<TContext = string> extends IPCClient<TContext> {\n\n\tstatic fromSocket<TContext = string>(socket: ISocket, id: TContext): Client<TContext> {\n\t\treturn new Client(new Protocol(socket), id);\n\t}\n\n\tget onDidDispose(): Event<void> { return this.protocol.onDidDispose; }\n\n\tconstructor(private protocol: Protocol | PersistentProtocol, id: TContext, ipcLogger: IIPCLogger | null = null) {\n\t\tsuper(protocol, id, ipcLogger);\n\t}\n\n\tdispose(): void {\n\t\tsuper.dispose();\n\t\tconst socket = this.protocol.getSocket();\n\t\tthis.protocol.sendDisconnect();\n\t\tthis.protocol.dispose();\n\t\tsocket.end();\n\t}\n}\n\n/**\n * Will ensure no messages are lost if there are no event listeners.\n */\nexport class BufferedEmitter<T> {\n\tprivate _emitter: Emitter<T>;\n\tpublic readonly event: Event<T>;\n\n\tprivate _hasListeners = false;\n\tprivate _isDeliveringMessages = false;\n\tprivate _bufferedMessages: T[] = [];\n\n\tconstructor() {\n\t\tthis._emitter = new Emitter<T>({\n\t\t\tonFirstListenerAdd: () => {\n\t\t\t\tthis._hasListeners = true;\n\t\t\t\t// it is important to deliver these messages after this call, but before\n\t\t\t\t// other messages have a chance to be received (to guarantee in order delivery)\n\t\t\t\t// that's why we're using here nextTick and not other types of timeouts\n\t\t\t\tprocess.nextTick(() => this._deliverMessages());\n\t\t\t},\n\t\t\tonLastListenerRemove: () => {\n\t\t\t\tthis._hasListeners = false;\n\t\t\t}\n\t\t});\n\n\t\tthis.event = this._emitter.event;\n\t}\n\n\tprivate _deliverMessages(): void {\n\t\tif (this._isDeliveringMessages) {\n\t\t\treturn;\n\t\t}\n\t\tthis._isDeliveringMessages = true;\n\t\twhile (this._hasListeners && this._bufferedMessages.length > 0) {\n\t\t\tthis._emitter.fire(this._bufferedMessages.shift()!);\n\t\t}\n\t\tthis._isDeliveringMessages = false;\n\t}\n\n\tpublic fire(event: T): void {\n\t\tif (this._hasListeners) {\n\t\t\tif (this._bufferedMessages.length > 0) {\n\t\t\t\tthis._bufferedMessages.push(event);\n\t\t\t} else {\n\t\t\t\tthis._emitter.fire(event);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._bufferedMessages.push(event);\n\t\t}\n\t}\n\n\tpublic flushBuffer(): void {\n\t\tthis._bufferedMessages = [];\n\t}\n}\n\nclass QueueElement<T> {\n\tpublic readonly data: T;\n\tpublic next: QueueElement<T> | null;\n\n\tconstructor(data: T) {\n\t\tthis.data = data;\n\t\tthis.next = null;\n\t}\n}\n\nclass Queue<T> {\n\n\tprivate _first: QueueElement<T> | null;\n\tprivate _last: QueueElement<T> | null;\n\n\tconstructor() {\n\t\tthis._first = null;\n\t\tthis._last = null;\n\t}\n\n\tpublic peek(): T | null {\n\t\tif (!this._first) {\n\t\t\treturn null;\n\t\t}\n\t\treturn this._first.data;\n\t}\n\n\tpublic toArray(): T[] {\n\t\tlet result: T[] = [], resultLen = 0;\n\t\tlet it = this._first;\n\t\twhile (it) {\n\t\t\tresult[resultLen++] = it.data;\n\t\t\tit = it.next;\n\t\t}\n\t\treturn result;\n\t}\n\n\tpublic pop(): void {\n\t\tif (!this._first) {\n\t\t\treturn;\n\t\t}\n\t\tif (this._first === this._last) {\n\t\t\tthis._first = null;\n\t\t\tthis._last = null;\n\t\t\treturn;\n\t\t}\n\t\tthis._first = this._first.next;\n\t}\n\n\tpublic push(item: T): void {\n\t\tconst element = new QueueElement(item);\n\t\tif (!this._first) {\n\t\t\tthis._first = element;\n\t\t\tthis._last = element;\n\t\t\treturn;\n\t\t}\n\t\tthis._last!.next = element;\n\t\tthis._last = element;\n\t}\n}\n\nclass LoadEstimator {\n\n\tprivate static _HISTORY_LENGTH = 10;\n\tprivate static _INSTANCE: LoadEstimator | null = null;\n\tpublic static getInstance(): LoadEstimator {\n\t\tif (!LoadEstimator._INSTANCE) {\n\t\t\tLoadEstimator._INSTANCE = new LoadEstimator();\n\t\t}\n\t\treturn LoadEstimator._INSTANCE;\n\t}\n\n\tprivate lastRuns: number[];\n\n\tconstructor() {\n\t\tthis.lastRuns = [];\n\t\tconst now = Date.now();\n\t\tfor (let i = 0; i < LoadEstimator._HISTORY_LENGTH; i++) {\n\t\t\tthis.lastRuns[i] = now - 1000 * i;\n\t\t}\n\t\tsetInterval(() => {\n\t\t\tfor (let i = LoadEstimator._HISTORY_LENGTH; i >= 1; i--) {\n\t\t\t\tthis.lastRuns[i] = this.lastRuns[i - 1];\n\t\t\t}\n\t\t\tthis.lastRuns[0] = Date.now();\n\t\t}, 1000);\n\t}\n\n\t/**\n\t * returns an estimative number, from 0 (low load) to 1 (high load)\n\t */\n\tpublic load(): number {\n\t\tconst now = Date.now();\n\t\tconst historyLimit = (1 + LoadEstimator._HISTORY_LENGTH) * 1000;\n\t\tlet score = 0;\n\t\tfor (let i = 0; i < LoadEstimator._HISTORY_LENGTH; i++) {\n\t\t\tif (now - this.lastRuns[i] <= historyLimit) {\n\t\t\t\tscore++;\n\t\t\t}\n\t\t}\n\t\treturn 1 - score / LoadEstimator._HISTORY_LENGTH;\n\t}\n\n\tpublic hasHighLoad(): boolean {\n\t\treturn this.load() >= 0.5;\n\t}\n}\n\n/**\n * Same as Protocol, but will actually track messages and acks.\n * Moreover, it will ensure no messages are lost if there are no event listeners.\n */\nexport class PersistentProtocol implements IMessagePassingProtocol {\n\n\tprivate _isReconnecting: boolean;\n\n\tprivate _outgoingUnackMsg: Queue<ProtocolMessage>;\n\tprivate _outgoingMsgId: number;\n\tprivate _outgoingAckId: number;\n\tprivate _outgoingAckTimeout: any | null;\n\n\tprivate _incomingMsgId: number;\n\tprivate _incomingAckId: number;\n\tprivate _incomingMsgLastTime: number;\n\tprivate _incomingAckTimeout: any | null;\n\n\tprivate _outgoingKeepAliveTimeout: any | null;\n\tprivate _incomingKeepAliveTimeout: any | null;\n\n\tprivate _lastReplayRequestTime: number;\n\n\tprivate _socket: ISocket;\n\tprivate _socketWriter: ProtocolWriter;\n\tprivate _socketReader: ProtocolReader;\n\tprivate _socketDisposables: IDisposable[];\n\n\tprivate readonly _loadEstimator = LoadEstimator.getInstance();\n\n\tprivate readonly _onControlMessage = new BufferedEmitter<VSBuffer>();\n\treadonly onControlMessage: Event<VSBuffer> = this._onControlMessage.event;\n\n\tprivate readonly _onMessage = new BufferedEmitter<VSBuffer>();\n\treadonly onMessage: Event<VSBuffer> = this._onMessage.event;\n\n\tprivate readonly _onDidDispose = new BufferedEmitter<void>();\n\treadonly onDidDispose: Event<void> = this._onDidDispose.event;\n\n\tprivate readonly _onSocketClose = new BufferedEmitter<void>();\n\treadonly onSocketClose: Event<void> = this._onSocketClose.event;\n\n\tprivate readonly _onSocketTimeout = new BufferedEmitter<void>();\n\treadonly onSocketTimeout: Event<void> = this._onSocketTimeout.event;\n\n\tpublic get unacknowledgedCount(): number {\n\t\treturn this._outgoingMsgId - this._outgoingAckId;\n\t}\n\n\tconstructor(socket: ISocket, initialChunk: VSBuffer | null = null) {\n\t\tthis._isReconnecting = false;\n\t\tthis._outgoingUnackMsg = new Queue<ProtocolMessage>();\n\t\tthis._outgoingMsgId = 0;\n\t\tthis._outgoingAckId = 0;\n\t\tthis._outgoingAckTimeout = null;\n\n\t\tthis._incomingMsgId = 0;\n\t\tthis._incomingAckId = 0;\n\t\tthis._incomingMsgLastTime = 0;\n\t\tthis._incomingAckTimeout = null;\n\n\t\tthis._outgoingKeepAliveTimeout = null;\n\t\tthis._incomingKeepAliveTimeout = null;\n\n\t\tthis._lastReplayRequestTime = 0;\n\n\t\tthis._socketDisposables = [];\n\t\tthis._socket = socket;\n\t\tthis._socketWriter = new ProtocolWriter(this._socket);\n\t\tthis._socketDisposables.push(this._socketWriter);\n\t\tthis._socketReader = new ProtocolReader(this._socket);\n\t\tthis._socketDisposables.push(this._socketReader);\n\t\tthis._socketDisposables.push(this._socketReader.onMessage(msg => this._receiveMessage(msg)));\n\t\tthis._socketDisposables.push(this._socket.onClose(() => this._onSocketClose.fire()));\n\t\tif (initialChunk) {\n\t\t\tthis._socketReader.acceptChunk(initialChunk);\n\t\t}\n\n\t\tthis._sendKeepAliveCheck();\n\t\tthis._recvKeepAliveCheck();\n\t}\n\n\tdispose(): void {\n\t\tif (this._outgoingAckTimeout) {\n\t\t\tclearTimeout(this._outgoingAckTimeout);\n\t\t\tthis._outgoingAckTimeout = null;\n\t\t}\n\t\tif (this._incomingAckTimeout) {\n\t\t\tclearTimeout(this._incomingAckTimeout);\n\t\t\tthis._incomingAckTimeout = null;\n\t\t}\n\t\tif (this._outgoingKeepAliveTimeout) {\n\t\t\tclearTimeout(this._outgoingKeepAliveTimeout);\n\t\t\tthis._outgoingKeepAliveTimeout = null;\n\t\t}\n\t\tif (this._incomingKeepAliveTimeout) {\n\t\t\tclearTimeout(this._incomingKeepAliveTimeout);\n\t\t\tthis._incomingKeepAliveTimeout = null;\n\t\t}\n\t\tthis._socketDisposables = dispose(this._socketDisposables);\n\t}\n\n\tdrain(): Promise<void> {\n\t\treturn this._socketWriter.drain();\n\t}\n\n\tsendDisconnect(): void {\n\t\tconst msg = new ProtocolMessage(ProtocolMessageType.Disconnect, 0, 0, getEmptyBuffer());\n\t\tthis._socketWriter.write(msg);\n\t\tthis._socketWriter.flush();\n\t}\n\n\tprivate _sendKeepAliveCheck(): void {\n\t\tif (this._outgoingKeepAliveTimeout) {\n\t\t\t// there will be a check in the near future\n\t\t\treturn;\n\t\t}\n\n\t\tconst timeSinceLastOutgoingMsg = Date.now() - this._socketWriter.lastWriteTime;\n\t\tif (timeSinceLastOutgoingMsg >= ProtocolConstants.KeepAliveTime) {\n\t\t\t// sufficient time has passed since last message was written,\n\t\t\t// and no message from our side needed to be sent in the meantime,\n\t\t\t// so we will send a message containing only a keep alive.\n\t\t\tconst msg = new ProtocolMessage(ProtocolMessageType.KeepAlive, 0, 0, getEmptyBuffer());\n\t\t\tthis._socketWriter.write(msg);\n\t\t\tthis._sendKeepAliveCheck();\n\t\t\treturn;\n\t\t}\n\n\t\tthis._outgoingKeepAliveTimeout = setTimeout(() => {\n\t\t\tthis._outgoingKeepAliveTimeout = null;\n\t\t\tthis._sendKeepAliveCheck();\n\t\t}, ProtocolConstants.KeepAliveTime - timeSinceLastOutgoingMsg + 5);\n\t}\n\n\tprivate _recvKeepAliveCheck(): void {\n\t\tif (this._incomingKeepAliveTimeout) {\n\t\t\t// there will be a check in the near future\n\t\t\treturn;\n\t\t}\n\n\t\tconst timeSinceLastIncomingMsg = Date.now() - this._socketReader.lastReadTime;\n\t\tif (timeSinceLastIncomingMsg >= ProtocolConstants.KeepAliveTimeoutTime) {\n\t\t\t// It's been a long time since we received a server message\n\t\t\t// But this might be caused by the event loop being busy and failing to read messages\n\t\t\tif (!this._loadEstimator.hasHighLoad()) {\n\t\t\t\t// Trash the socket\n\t\t\t\tthis._onSocketTimeout.fire(undefined);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis._incomingKeepAliveTimeout = setTimeout(() => {\n\t\t\tthis._incomingKeepAliveTimeout = null;\n\t\t\tthis._recvKeepAliveCheck();\n\t\t}, Math.max(ProtocolConstants.KeepAliveTimeoutTime - timeSinceLastIncomingMsg, 0) + 5);\n\t}\n\n\tpublic getSocket(): ISocket {\n\t\treturn this._socket;\n\t}\n\n\tpublic getMillisSinceLastIncomingData(): number {\n\t\treturn Date.now() - this._socketReader.lastReadTime;\n\t}\n\n\tpublic beginAcceptReconnection(socket: ISocket, initialDataChunk: VSBuffer | null): void {\n\t\tthis._isReconnecting = true;\n\n\t\tthis._socketDisposables = dispose(this._socketDisposables);\n\t\tthis._onControlMessage.flushBuffer();\n\t\tthis._onSocketClose.flushBuffer();\n\t\tthis._onSocketTimeout.flushBuffer();\n\t\tthis._socket.dispose();\n\n\t\tthis._lastReplayRequestTime = 0;\n\n\t\tthis._socket = socket;\n\t\tthis._socketWriter = new ProtocolWriter(this._socket);\n\t\tthis._socketDisposables.push(this._socketWriter);\n\t\tthis._socketReader = new ProtocolReader(this._socket);\n\t\tthis._socketDisposables.push(this._socketReader);\n\t\tthis._socketDisposables.push(this._socketReader.onMessage(msg => this._receiveMessage(msg)));\n\t\tthis._socketDisposables.push(this._socket.onClose(() => this._onSocketClose.fire()));\n\t\tthis._socketReader.acceptChunk(initialDataChunk);\n\t}\n\n\tpublic endAcceptReconnection(): void {\n\t\tthis._isReconnecting = false;\n\n\t\t// Send again all unacknowledged messages\n\t\tconst toSend = this._outgoingUnackMsg.toArray();\n\t\tfor (let i = 0, len = toSend.length; i < len; i++) {\n\t\t\tthis._socketWriter.write(toSend[i]);\n\t\t}\n\t\tthis._recvAckCheck();\n\n\t\tthis._sendKeepAliveCheck();\n\t\tthis._recvKeepAliveCheck();\n\t}\n\n\tpublic acceptDisconnect(): void {\n\t\tthis._onDidDispose.fire();\n\t}\n\n\tprivate _receiveMessage(msg: ProtocolMessage): void {\n\t\tif (msg.ack > this._outgoingAckId) {\n\t\t\tthis._outgoingAckId = msg.ack;\n\t\t\tdo {\n\t\t\t\tconst first = this._outgoingUnackMsg.peek();\n\t\t\t\tif (first && first.id <= msg.ack) {\n\t\t\t\t\t// this message has been confirmed, remove it\n\t\t\t\t\tthis._outgoingUnackMsg.pop();\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} while (true);\n\t\t}\n\n\t\tif (msg.type === ProtocolMessageType.Regular) {\n\t\t\tif (msg.id > this._incomingMsgId) {\n\t\t\t\tif (msg.id !== this._incomingMsgId + 1) {\n\t\t\t\t\t// in case we missed some messages we ask the other party to resend them\n\t\t\t\t\tconst now = Date.now();\n\t\t\t\t\tif (now - this._lastReplayRequestTime > 10000) {\n\t\t\t\t\t\t// send a replay request at most once every 10s\n\t\t\t\t\t\tthis._lastReplayRequestTime = now;\n\t\t\t\t\t\tthis._socketWriter.write(new ProtocolMessage(ProtocolMessageType.ReplayRequest, 0, 0, getEmptyBuffer()));\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis._incomingMsgId = msg.id;\n\t\t\t\t\tthis._incomingMsgLastTime = Date.now();\n\t\t\t\t\tthis._sendAckCheck();\n\t\t\t\t\tthis._onMessage.fire(msg.data);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (msg.type === ProtocolMessageType.Control) {\n\t\t\tthis._onControlMessage.fire(msg.data);\n\t\t} else if (msg.type === ProtocolMessageType.Disconnect) {\n\t\t\tthis._onDidDispose.fire();\n\t\t} else if (msg.type === ProtocolMessageType.ReplayRequest) {\n\t\t\t// Send again all unacknowledged messages\n\t\t\tconst toSend = this._outgoingUnackMsg.toArray();\n\t\t\tfor (let i = 0, len = toSend.length; i < len; i++) {\n\t\t\t\tthis._socketWriter.write(toSend[i]);\n\t\t\t}\n\t\t\tthis._recvAckCheck();\n\t\t}\n\t}\n\n\treadEntireBuffer(): VSBuffer {\n\t\treturn this._socketReader.readEntireBuffer();\n\t}\n\n\tflush(): void {\n\t\tthis._socketWriter.flush();\n\t}\n\n\tsend(buffer: VSBuffer): void {\n\t\tconst myId = ++this._outgoingMsgId;\n\t\tthis._incomingAckId = this._incomingMsgId;\n\t\tconst msg = new ProtocolMessage(ProtocolMessageType.Regular, myId, this._incomingAckId, buffer);\n\t\tthis._outgoingUnackMsg.push(msg);\n\t\tif (!this._isReconnecting) {\n\t\t\tthis._socketWriter.write(msg);\n\t\t\tthis._recvAckCheck();\n\t\t}\n\t}\n\n\t/**\n\t * Send a message which will not be part of the regular acknowledge flow.\n\t * Use this for early control messages which are repeated in case of reconnection.\n\t */\n\tsendControl(buffer: VSBuffer): void {\n\t\tconst msg = new ProtocolMessage(ProtocolMessageType.Control, 0, 0, buffer);\n\t\tthis._socketWriter.write(msg);\n\t}\n\n\tprivate _sendAckCheck(): void {\n\t\tif (this._incomingMsgId <= this._incomingAckId) {\n\t\t\t// nothink to acknowledge\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._incomingAckTimeout) {\n\t\t\t// there will be a check in the near future\n\t\t\treturn;\n\t\t}\n\n\t\tconst timeSinceLastIncomingMsg = Date.now() - this._incomingMsgLastTime;\n\t\tif (timeSinceLastIncomingMsg >= ProtocolConstants.AcknowledgeTime) {\n\t\t\t// sufficient time has passed since this message has been received,\n\t\t\t// and no message from our side needed to be sent in the meantime,\n\t\t\t// so we will send a message containing only an ack.\n\t\t\tthis._sendAck();\n\t\t\treturn;\n\t\t}\n\n\t\tthis._incomingAckTimeout = setTimeout(() => {\n\t\t\tthis._incomingAckTimeout = null;\n\t\t\tthis._sendAckCheck();\n\t\t}, ProtocolConstants.AcknowledgeTime - timeSinceLastIncomingMsg + 5);\n\t}\n\n\tprivate _recvAckCheck(): void {\n\t\tif (this._outgoingMsgId <= this._outgoingAckId) {\n\t\t\t// everything has been acknowledged\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._outgoingAckTimeout) {\n\t\t\t// there will be a check in the near future\n\t\t\treturn;\n\t\t}\n\n\t\tconst oldestUnacknowledgedMsg = this._outgoingUnackMsg.peek()!;\n\t\tconst timeSinceOldestUnacknowledgedMsg = Date.now() - oldestUnacknowledgedMsg.writtenTime;\n\t\tif (timeSinceOldestUnacknowledgedMsg >= ProtocolConstants.AcknowledgeTimeoutTime) {\n\t\t\t// It's been a long time since our sent message was acknowledged\n\t\t\t// But this might be caused by the event loop being busy and failing to read messages\n\t\t\tif (!this._loadEstimator.hasHighLoad()) {\n\t\t\t\t// Trash the socket\n\t\t\t\tthis._onSocketTimeout.fire(undefined);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis._outgoingAckTimeout = setTimeout(() => {\n\t\t\tthis._outgoingAckTimeout = null;\n\t\t\tthis._recvAckCheck();\n\t\t}, Math.max(ProtocolConstants.AcknowledgeTimeoutTime - timeSinceOldestUnacknowledgedMsg, 0) + 5);\n\t}\n\n\tprivate _sendAck(): void {\n\t\tif (this._incomingMsgId <= this._incomingAckId) {\n\t\t\t// nothink to acknowledge\n\t\t\treturn;\n\t\t}\n\n\t\tthis._incomingAckId = this._incomingMsgId;\n\t\tconst msg = new ProtocolMessage(ProtocolMessageType.Ack, 0, this._incomingAckId, getEmptyBuffer());\n\t\tthis._socketWriter.write(msg);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { toUint8 } from 'vs/base/common/uint';\n\n/**\n * A fast character classifier that uses a compact array for ASCII values.\n */\nexport class CharacterClassifier<T extends number> {\n\t/**\n\t * Maintain a compact (fully initialized ASCII map for quickly classifying ASCII characters - used more often in code).\n\t */\n\tprotected _asciiMap: Uint8Array;\n\n\t/**\n\t * The entire map (sparse array).\n\t */\n\tprotected _map: Map<number, number>;\n\n\tprotected _defaultValue: number;\n\n\tconstructor(_defaultValue: T) {\n\t\tlet defaultValue = toUint8(_defaultValue);\n\n\t\tthis._defaultValue = defaultValue;\n\t\tthis._asciiMap = CharacterClassifier._createAsciiMap(defaultValue);\n\t\tthis._map = new Map<number, number>();\n\t}\n\n\tprivate static _createAsciiMap(defaultValue: number): Uint8Array {\n\t\tlet asciiMap: Uint8Array = new Uint8Array(256);\n\t\tfor (let i = 0; i < 256; i++) {\n\t\t\tasciiMap[i] = defaultValue;\n\t\t}\n\t\treturn asciiMap;\n\t}\n\n\tpublic set(charCode: number, _value: T): void {\n\t\tlet value = toUint8(_value);\n\n\t\tif (charCode >= 0 && charCode < 256) {\n\t\t\tthis._asciiMap[charCode] = value;\n\t\t} else {\n\t\t\tthis._map.set(charCode, value);\n\t\t}\n\t}\n\n\tpublic get(charCode: number): T {\n\t\tif (charCode >= 0 && charCode < 256) {\n\t\t\treturn <T>this._asciiMap[charCode];\n\t\t} else {\n\t\t\treturn <T>(this._map.get(charCode) || this._defaultValue);\n\t\t}\n\t}\n}\n\nconst enum Boolean {\n\tFalse = 0,\n\tTrue = 1\n}\n\nexport class CharacterSet {\n\n\tprivate readonly _actual: CharacterClassifier<Boolean>;\n\n\tconstructor() {\n\t\tthis._actual = new CharacterClassifier<Boolean>(Boolean.False);\n\t}\n\n\tpublic add(charCode: number): void {\n\t\tthis._actual.set(charCode, Boolean.True);\n\t}\n\n\tpublic has(charCode: number): boolean {\n\t\treturn (this._actual.get(charCode) === Boolean.True);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CharCode } from 'vs/base/common/charCode';\nimport { CharacterClassifier } from 'vs/editor/common/core/characterClassifier';\n\nexport const enum WordCharacterClass {\n\tRegular = 0,\n\tWhitespace = 1,\n\tWordSeparator = 2\n}\n\nexport class WordCharacterClassifier extends CharacterClassifier<WordCharacterClass> {\n\n\tconstructor(wordSeparators: string) {\n\t\tsuper(WordCharacterClass.Regular);\n\n\t\tfor (let i = 0, len = wordSeparators.length; i < len; i++) {\n\t\t\tthis.set(wordSeparators.charCodeAt(i), WordCharacterClass.WordSeparator);\n\t\t}\n\n\t\tthis.set(CharCode.Space, WordCharacterClass.Whitespace);\n\t\tthis.set(CharCode.Tab, WordCharacterClass.Whitespace);\n\t}\n\n}\n\nfunction once<R>(computeFn: (input: string) => R): (input: string) => R {\n\tlet cache: { [key: string]: R; } = {}; // TODO@Alex unbounded cache\n\treturn (input: string): R => {\n\t\tif (!cache.hasOwnProperty(input)) {\n\t\t\tcache[input] = computeFn(input);\n\t\t}\n\t\treturn cache[input];\n\t};\n}\n\nexport const getMapForWordSeparators = once<WordCharacterClassifier>(\n\t(input) => new WordCharacterClassifier(input)\n);\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n/**\n * A position in the editor. This interface is suitable for serialization.\n */\nexport interface IPosition {\n\t/**\n\t * line number (starts at 1)\n\t */\n\treadonly lineNumber: number;\n\t/**\n\t * column (the first character in a line is between column 1 and column 2)\n\t */\n\treadonly column: number;\n}\n\n/**\n * A position in the editor.\n */\nexport class Position {\n\t/**\n\t * line number (starts at 1)\n\t */\n\tpublic readonly lineNumber: number;\n\t/**\n\t * column (the first character in a line is between column 1 and column 2)\n\t */\n\tpublic readonly column: number;\n\n\tconstructor(lineNumber: number, column: number) {\n\t\tthis.lineNumber = lineNumber;\n\t\tthis.column = column;\n\t}\n\n\t/**\n\t * Create a new position from this position.\n\t *\n\t * @param newLineNumber new line number\n\t * @param newColumn new column\n\t */\n\twith(newLineNumber: number = this.lineNumber, newColumn: number = this.column): Position {\n\t\tif (newLineNumber === this.lineNumber && newColumn === this.column) {\n\t\t\treturn this;\n\t\t} else {\n\t\t\treturn new Position(newLineNumber, newColumn);\n\t\t}\n\t}\n\n\t/**\n\t * Derive a new position from this position.\n\t *\n\t * @param deltaLineNumber line number delta\n\t * @param deltaColumn column delta\n\t */\n\tdelta(deltaLineNumber: number = 0, deltaColumn: number = 0): Position {\n\t\treturn this.with(this.lineNumber + deltaLineNumber, this.column + deltaColumn);\n\t}\n\n\t/**\n\t * Test if this position equals other position\n\t */\n\tpublic equals(other: IPosition): boolean {\n\t\treturn Position.equals(this, other);\n\t}\n\n\t/**\n\t * Test if position `a` equals position `b`\n\t */\n\tpublic static equals(a: IPosition | null, b: IPosition | null): boolean {\n\t\tif (!a && !b) {\n\t\t\treturn true;\n\t\t}\n\t\treturn (\n\t\t\t!!a &&\n\t\t\t!!b &&\n\t\t\ta.lineNumber === b.lineNumber &&\n\t\t\ta.column === b.column\n\t\t);\n\t}\n\n\t/**\n\t * Test if this position is before other position.\n\t * If the two positions are equal, the result will be false.\n\t */\n\tpublic isBefore(other: IPosition): boolean {\n\t\treturn Position.isBefore(this, other);\n\t}\n\n\t/**\n\t * Test if position `a` is before position `b`.\n\t * If the two positions are equal, the result will be false.\n\t */\n\tpublic static isBefore(a: IPosition, b: IPosition): boolean {\n\t\tif (a.lineNumber < b.lineNumber) {\n\t\t\treturn true;\n\t\t}\n\t\tif (b.lineNumber < a.lineNumber) {\n\t\t\treturn false;\n\t\t}\n\t\treturn a.column < b.column;\n\t}\n\n\t/**\n\t * Test if this position is before other position.\n\t * If the two positions are equal, the result will be true.\n\t */\n\tpublic isBeforeOrEqual(other: IPosition): boolean {\n\t\treturn Position.isBeforeOrEqual(this, other);\n\t}\n\n\t/**\n\t * Test if position `a` is before position `b`.\n\t * If the two positions are equal, the result will be true.\n\t */\n\tpublic static isBeforeOrEqual(a: IPosition, b: IPosition): boolean {\n\t\tif (a.lineNumber < b.lineNumber) {\n\t\t\treturn true;\n\t\t}\n\t\tif (b.lineNumber < a.lineNumber) {\n\t\t\treturn false;\n\t\t}\n\t\treturn a.column <= b.column;\n\t}\n\n\t/**\n\t * A function that compares positions, useful for sorting\n\t */\n\tpublic static compare(a: IPosition, b: IPosition): number {\n\t\tlet aLineNumber = a.lineNumber | 0;\n\t\tlet bLineNumber = b.lineNumber | 0;\n\n\t\tif (aLineNumber === bLineNumber) {\n\t\t\tlet aColumn = a.column | 0;\n\t\t\tlet bColumn = b.column | 0;\n\t\t\treturn aColumn - bColumn;\n\t\t}\n\n\t\treturn aLineNumber - bLineNumber;\n\t}\n\n\t/**\n\t * Clone this position.\n\t */\n\tpublic clone(): Position {\n\t\treturn new Position(this.lineNumber, this.column);\n\t}\n\n\t/**\n\t * Convert to a human-readable representation.\n\t */\n\tpublic toString(): string {\n\t\treturn '(' + this.lineNumber + ',' + this.column + ')';\n\t}\n\n\t// ---\n\n\t/**\n\t * Create a `Position` from an `IPosition`.\n\t */\n\tpublic static lift(pos: IPosition): Position {\n\t\treturn new Position(pos.lineNumber, pos.column);\n\t}\n\n\t/**\n\t * Test if `obj` is an `IPosition`.\n\t */\n\tpublic static isIPosition(obj: any): obj is IPosition {\n\t\treturn (\n\t\t\tobj\n\t\t\t&& (typeof obj.lineNumber === 'number')\n\t\t\t&& (typeof obj.column === 'number')\n\t\t);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IPosition, Position } from 'vs/editor/common/core/position';\n\n/**\n * A range in the editor. This interface is suitable for serialization.\n */\nexport interface IRange {\n\t/**\n\t * Line number on which the range starts (starts at 1).\n\t */\n\treadonly startLineNumber: number;\n\t/**\n\t * Column on which the range starts in line `startLineNumber` (starts at 1).\n\t */\n\treadonly startColumn: number;\n\t/**\n\t * Line number on which the range ends.\n\t */\n\treadonly endLineNumber: number;\n\t/**\n\t * Column on which the range ends in line `endLineNumber`.\n\t */\n\treadonly endColumn: number;\n}\n\n/**\n * A range in the editor. (startLineNumber,startColumn) is <= (endLineNumber,endColumn)\n */\nexport class Range {\n\n\t/**\n\t * Line number on which the range starts (starts at 1).\n\t */\n\tpublic readonly startLineNumber: number;\n\t/**\n\t * Column on which the range starts in line `startLineNumber` (starts at 1).\n\t */\n\tpublic readonly startColumn: number;\n\t/**\n\t * Line number on which the range ends.\n\t */\n\tpublic readonly endLineNumber: number;\n\t/**\n\t * Column on which the range ends in line `endLineNumber`.\n\t */\n\tpublic readonly endColumn: number;\n\n\tconstructor(startLineNumber: number, startColumn: number, endLineNumber: number, endColumn: number) {\n\t\tif ((startLineNumber > endLineNumber) || (startLineNumber === endLineNumber && startColumn > endColumn)) {\n\t\t\tthis.startLineNumber = endLineNumber;\n\t\t\tthis.startColumn = endColumn;\n\t\t\tthis.endLineNumber = startLineNumber;\n\t\t\tthis.endColumn = startColumn;\n\t\t} else {\n\t\t\tthis.startLineNumber = startLineNumber;\n\t\t\tthis.startColumn = startColumn;\n\t\t\tthis.endLineNumber = endLineNumber;\n\t\t\tthis.endColumn = endColumn;\n\t\t}\n\t}\n\n\t/**\n\t * Test if this range is empty.\n\t */\n\tpublic isEmpty(): boolean {\n\t\treturn Range.isEmpty(this);\n\t}\n\n\t/**\n\t * Test if `range` is empty.\n\t */\n\tpublic static isEmpty(range: IRange): boolean {\n\t\treturn (range.startLineNumber === range.endLineNumber && range.startColumn === range.endColumn);\n\t}\n\n\t/**\n\t * Test if position is in this range. If the position is at the edges, will return true.\n\t */\n\tpublic containsPosition(position: IPosition): boolean {\n\t\treturn Range.containsPosition(this, position);\n\t}\n\n\t/**\n\t * Test if `position` is in `range`. If the position is at the edges, will return true.\n\t */\n\tpublic static containsPosition(range: IRange, position: IPosition): boolean {\n\t\tif (position.lineNumber < range.startLineNumber || position.lineNumber > range.endLineNumber) {\n\t\t\treturn false;\n\t\t}\n\t\tif (position.lineNumber === range.startLineNumber && position.column < range.startColumn) {\n\t\t\treturn false;\n\t\t}\n\t\tif (position.lineNumber === range.endLineNumber && position.column > range.endColumn) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * Test if range is in this range. If the range is equal to this range, will return true.\n\t */\n\tpublic containsRange(range: IRange): boolean {\n\t\treturn Range.containsRange(this, range);\n\t}\n\n\t/**\n\t * Test if `otherRange` is in `range`. If the ranges are equal, will return true.\n\t */\n\tpublic static containsRange(range: IRange, otherRange: IRange): boolean {\n\t\tif (otherRange.startLineNumber < range.startLineNumber || otherRange.endLineNumber < range.startLineNumber) {\n\t\t\treturn false;\n\t\t}\n\t\tif (otherRange.startLineNumber > range.endLineNumber || otherRange.endLineNumber > range.endLineNumber) {\n\t\t\treturn false;\n\t\t}\n\t\tif (otherRange.startLineNumber === range.startLineNumber && otherRange.startColumn < range.startColumn) {\n\t\t\treturn false;\n\t\t}\n\t\tif (otherRange.endLineNumber === range.endLineNumber && otherRange.endColumn > range.endColumn) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * Test if `range` is strictly in this range. `range` must start after and end before this range for the result to be true.\n\t */\n\tpublic strictContainsRange(range: IRange): boolean {\n\t\treturn Range.strictContainsRange(this, range);\n\t}\n\n\t/**\n\t * Test if `otherRange` is strinctly in `range` (must start after, and end before). If the ranges are equal, will return false.\n\t */\n\tpublic static strictContainsRange(range: IRange, otherRange: IRange): boolean {\n\t\tif (otherRange.startLineNumber < range.startLineNumber || otherRange.endLineNumber < range.startLineNumber) {\n\t\t\treturn false;\n\t\t}\n\t\tif (otherRange.startLineNumber > range.endLineNumber || otherRange.endLineNumber > range.endLineNumber) {\n\t\t\treturn false;\n\t\t}\n\t\tif (otherRange.startLineNumber === range.startLineNumber && otherRange.startColumn <= range.startColumn) {\n\t\t\treturn false;\n\t\t}\n\t\tif (otherRange.endLineNumber === range.endLineNumber && otherRange.endColumn >= range.endColumn) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * A reunion of the two ranges.\n\t * The smallest position will be used as the start point, and the largest one as the end point.\n\t */\n\tpublic plusRange(range: IRange): Range {\n\t\treturn Range.plusRange(this, range);\n\t}\n\n\t/**\n\t * A reunion of the two ranges.\n\t * The smallest position will be used as the start point, and the largest one as the end point.\n\t */\n\tpublic static plusRange(a: IRange, b: IRange): Range {\n\t\tlet startLineNumber: number;\n\t\tlet startColumn: number;\n\t\tlet endLineNumber: number;\n\t\tlet endColumn: number;\n\n\t\tif (b.startLineNumber < a.startLineNumber) {\n\t\t\tstartLineNumber = b.startLineNumber;\n\t\t\tstartColumn = b.startColumn;\n\t\t} else if (b.startLineNumber === a.startLineNumber) {\n\t\t\tstartLineNumber = b.startLineNumber;\n\t\t\tstartColumn = Math.min(b.startColumn, a.startColumn);\n\t\t} else {\n\t\t\tstartLineNumber = a.startLineNumber;\n\t\t\tstartColumn = a.startColumn;\n\t\t}\n\n\t\tif (b.endLineNumber > a.endLineNumber) {\n\t\t\tendLineNumber = b.endLineNumber;\n\t\t\tendColumn = b.endColumn;\n\t\t} else if (b.endLineNumber === a.endLineNumber) {\n\t\t\tendLineNumber = b.endLineNumber;\n\t\t\tendColumn = Math.max(b.endColumn, a.endColumn);\n\t\t} else {\n\t\t\tendLineNumber = a.endLineNumber;\n\t\t\tendColumn = a.endColumn;\n\t\t}\n\n\t\treturn new Range(startLineNumber, startColumn, endLineNumber, endColumn);\n\t}\n\n\t/**\n\t * A intersection of the two ranges.\n\t */\n\tpublic intersectRanges(range: IRange): Range | null {\n\t\treturn Range.intersectRanges(this, range);\n\t}\n\n\t/**\n\t * A intersection of the two ranges.\n\t */\n\tpublic static intersectRanges(a: IRange, b: IRange): Range | null {\n\t\tlet resultStartLineNumber = a.startLineNumber;\n\t\tlet resultStartColumn = a.startColumn;\n\t\tlet resultEndLineNumber = a.endLineNumber;\n\t\tlet resultEndColumn = a.endColumn;\n\t\tlet otherStartLineNumber = b.startLineNumber;\n\t\tlet otherStartColumn = b.startColumn;\n\t\tlet otherEndLineNumber = b.endLineNumber;\n\t\tlet otherEndColumn = b.endColumn;\n\n\t\tif (resultStartLineNumber < otherStartLineNumber) {\n\t\t\tresultStartLineNumber = otherStartLineNumber;\n\t\t\tresultStartColumn = otherStartColumn;\n\t\t} else if (resultStartLineNumber === otherStartLineNumber) {\n\t\t\tresultStartColumn = Math.max(resultStartColumn, otherStartColumn);\n\t\t}\n\n\t\tif (resultEndLineNumber > otherEndLineNumber) {\n\t\t\tresultEndLineNumber = otherEndLineNumber;\n\t\t\tresultEndColumn = otherEndColumn;\n\t\t} else if (resultEndLineNumber === otherEndLineNumber) {\n\t\t\tresultEndColumn = Math.min(resultEndColumn, otherEndColumn);\n\t\t}\n\n\t\t// Check if selection is now empty\n\t\tif (resultStartLineNumber > resultEndLineNumber) {\n\t\t\treturn null;\n\t\t}\n\t\tif (resultStartLineNumber === resultEndLineNumber && resultStartColumn > resultEndColumn) {\n\t\t\treturn null;\n\t\t}\n\t\treturn new Range(resultStartLineNumber, resultStartColumn, resultEndLineNumber, resultEndColumn);\n\t}\n\n\t/**\n\t * Test if this range equals other.\n\t */\n\tpublic equalsRange(other: IRange | null): boolean {\n\t\treturn Range.equalsRange(this, other);\n\t}\n\n\t/**\n\t * Test if range `a` equals `b`.\n\t */\n\tpublic static equalsRange(a: IRange | null, b: IRange | null): boolean {\n\t\treturn (\n\t\t\t!!a &&\n\t\t\t!!b &&\n\t\t\ta.startLineNumber === b.startLineNumber &&\n\t\t\ta.startColumn === b.startColumn &&\n\t\t\ta.endLineNumber === b.endLineNumber &&\n\t\t\ta.endColumn === b.endColumn\n\t\t);\n\t}\n\n\t/**\n\t * Return the end position (which will be after or equal to the start position)\n\t */\n\tpublic getEndPosition(): Position {\n\t\treturn Range.getEndPosition(this);\n\t}\n\n\t/**\n\t * Return the end position (which will be after or equal to the start position)\n\t */\n\tpublic static getEndPosition(range: IRange): Position {\n\t\treturn new Position(range.endLineNumber, range.endColumn);\n\t}\n\n\t/**\n\t * Return the start position (which will be before or equal to the end position)\n\t */\n\tpublic getStartPosition(): Position {\n\t\treturn Range.getStartPosition(this);\n\t}\n\n\t/**\n\t * Return the start position (which will be before or equal to the end position)\n\t */\n\tpublic static getStartPosition(range: IRange): Position {\n\t\treturn new Position(range.startLineNumber, range.startColumn);\n\t}\n\n\t/**\n\t * Transform to a user presentable string representation.\n\t */\n\tpublic toString(): string {\n\t\treturn '[' + this.startLineNumber + ',' + this.startColumn + ' -> ' + this.endLineNumber + ',' + this.endColumn + ']';\n\t}\n\n\t/**\n\t * Create a new range using this range's start position, and using endLineNumber and endColumn as the end position.\n\t */\n\tpublic setEndPosition(endLineNumber: number, endColumn: number): Range {\n\t\treturn new Range(this.startLineNumber, this.startColumn, endLineNumber, endColumn);\n\t}\n\n\t/**\n\t * Create a new range using this range's end position, and using startLineNumber and startColumn as the start position.\n\t */\n\tpublic setStartPosition(startLineNumber: number, startColumn: number): Range {\n\t\treturn new Range(startLineNumber, startColumn, this.endLineNumber, this.endColumn);\n\t}\n\n\t/**\n\t * Create a new empty range using this range's start position.\n\t */\n\tpublic collapseToStart(): Range {\n\t\treturn Range.collapseToStart(this);\n\t}\n\n\t/**\n\t * Create a new empty range using this range's start position.\n\t */\n\tpublic static collapseToStart(range: IRange): Range {\n\t\treturn new Range(range.startLineNumber, range.startColumn, range.startLineNumber, range.startColumn);\n\t}\n\n\t// ---\n\n\tpublic static fromPositions(start: IPosition, end: IPosition = start): Range {\n\t\treturn new Range(start.lineNumber, start.column, end.lineNumber, end.column);\n\t}\n\n\t/**\n\t * Create a `Range` from an `IRange`.\n\t */\n\tpublic static lift(range: undefined | null): null;\n\tpublic static lift(range: IRange): Range;\n\tpublic static lift(range: IRange | undefined | null): Range | null {\n\t\tif (!range) {\n\t\t\treturn null;\n\t\t}\n\t\treturn new Range(range.startLineNumber, range.startColumn, range.endLineNumber, range.endColumn);\n\t}\n\n\t/**\n\t * Test if `obj` is an `IRange`.\n\t */\n\tpublic static isIRange(obj: any): obj is IRange {\n\t\treturn (\n\t\t\tobj\n\t\t\t&& (typeof obj.startLineNumber === 'number')\n\t\t\t&& (typeof obj.startColumn === 'number')\n\t\t\t&& (typeof obj.endLineNumber === 'number')\n\t\t\t&& (typeof obj.endColumn === 'number')\n\t\t);\n\t}\n\n\t/**\n\t * Test if the two ranges are touching in any way.\n\t */\n\tpublic static areIntersectingOrTouching(a: IRange, b: IRange): boolean {\n\t\t// Check if `a` is before `b`\n\t\tif (a.endLineNumber < b.startLineNumber || (a.endLineNumber === b.startLineNumber && a.endColumn < b.startColumn)) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Check if `b` is before `a`\n\t\tif (b.endLineNumber < a.startLineNumber || (b.endLineNumber === a.startLineNumber && b.endColumn < a.startColumn)) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// These ranges must intersect\n\t\treturn true;\n\t}\n\n\t/**\n\t * Test if the two ranges are intersecting. If the ranges are touching it returns true.\n\t */\n\tpublic static areIntersecting(a: IRange, b: IRange): boolean {\n\t\t// Check if `a` is before `b`\n\t\tif (a.endLineNumber < b.startLineNumber || (a.endLineNumber === b.startLineNumber && a.endColumn <= b.startColumn)) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Check if `b` is before `a`\n\t\tif (b.endLineNumber < a.startLineNumber || (b.endLineNumber === a.startLineNumber && b.endColumn <= a.startColumn)) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// These ranges must intersect\n\t\treturn true;\n\t}\n\n\t/**\n\t * A function that compares ranges, useful for sorting ranges\n\t * It will first compare ranges on the startPosition and then on the endPosition\n\t */\n\tpublic static compareRangesUsingStarts(a: IRange | null | undefined, b: IRange | null | undefined): number {\n\t\tif (a && b) {\n\t\t\tconst aStartLineNumber = a.startLineNumber | 0;\n\t\t\tconst bStartLineNumber = b.startLineNumber | 0;\n\n\t\t\tif (aStartLineNumber === bStartLineNumber) {\n\t\t\t\tconst aStartColumn = a.startColumn | 0;\n\t\t\t\tconst bStartColumn = b.startColumn | 0;\n\n\t\t\t\tif (aStartColumn === bStartColumn) {\n\t\t\t\t\tconst aEndLineNumber = a.endLineNumber | 0;\n\t\t\t\t\tconst bEndLineNumber = b.endLineNumber | 0;\n\n\t\t\t\t\tif (aEndLineNumber === bEndLineNumber) {\n\t\t\t\t\t\tconst aEndColumn = a.endColumn | 0;\n\t\t\t\t\t\tconst bEndColumn = b.endColumn | 0;\n\t\t\t\t\t\treturn aEndColumn - bEndColumn;\n\t\t\t\t\t}\n\t\t\t\t\treturn aEndLineNumber - bEndLineNumber;\n\t\t\t\t}\n\t\t\t\treturn aStartColumn - bStartColumn;\n\t\t\t}\n\t\t\treturn aStartLineNumber - bStartLineNumber;\n\t\t}\n\t\tconst aExists = (a ? 1 : 0);\n\t\tconst bExists = (b ? 1 : 0);\n\t\treturn aExists - bExists;\n\t}\n\n\t/**\n\t * A function that compares ranges, useful for sorting ranges\n\t * It will first compare ranges on the endPosition and then on the startPosition\n\t */\n\tpublic static compareRangesUsingEnds(a: IRange, b: IRange): number {\n\t\tif (a.endLineNumber === b.endLineNumber) {\n\t\t\tif (a.endColumn === b.endColumn) {\n\t\t\t\tif (a.startLineNumber === b.startLineNumber) {\n\t\t\t\t\treturn a.startColumn - b.startColumn;\n\t\t\t\t}\n\t\t\t\treturn a.startLineNumber - b.startLineNumber;\n\t\t\t}\n\t\t\treturn a.endColumn - b.endColumn;\n\t\t}\n\t\treturn a.endLineNumber - b.endLineNumber;\n\t}\n\n\t/**\n\t * Test if the range spans multiple lines.\n\t */\n\tpublic static spansMultipleLines(range: IRange): boolean {\n\t\treturn range.endLineNumber > range.startLineNumber;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IPosition, Position } from 'vs/editor/common/core/position';\nimport { Range } from 'vs/editor/common/core/range';\n\n/**\n * A selection in the editor.\n * The selection is a range that has an orientation.\n */\nexport interface ISelection {\n\t/**\n\t * The line number on which the selection has started.\n\t */\n\treadonly selectionStartLineNumber: number;\n\t/**\n\t * The column on `selectionStartLineNumber` where the selection has started.\n\t */\n\treadonly selectionStartColumn: number;\n\t/**\n\t * The line number on which the selection has ended.\n\t */\n\treadonly positionLineNumber: number;\n\t/**\n\t * The column on `positionLineNumber` where the selection has ended.\n\t */\n\treadonly positionColumn: number;\n}\n\n/**\n * The direction of a selection.\n */\nexport const enum SelectionDirection {\n\t/**\n\t * The selection starts above where it ends.\n\t */\n\tLTR,\n\t/**\n\t * The selection starts below where it ends.\n\t */\n\tRTL\n}\n\n/**\n * A selection in the editor.\n * The selection is a range that has an orientation.\n */\nexport class Selection extends Range {\n\t/**\n\t * The line number on which the selection has started.\n\t */\n\tpublic readonly selectionStartLineNumber: number;\n\t/**\n\t * The column on `selectionStartLineNumber` where the selection has started.\n\t */\n\tpublic readonly selectionStartColumn: number;\n\t/**\n\t * The line number on which the selection has ended.\n\t */\n\tpublic readonly positionLineNumber: number;\n\t/**\n\t * The column on `positionLineNumber` where the selection has ended.\n\t */\n\tpublic readonly positionColumn: number;\n\n\tconstructor(selectionStartLineNumber: number, selectionStartColumn: number, positionLineNumber: number, positionColumn: number) {\n\t\tsuper(selectionStartLineNumber, selectionStartColumn, positionLineNumber, positionColumn);\n\t\tthis.selectionStartLineNumber = selectionStartLineNumber;\n\t\tthis.selectionStartColumn = selectionStartColumn;\n\t\tthis.positionLineNumber = positionLineNumber;\n\t\tthis.positionColumn = positionColumn;\n\t}\n\n\t/**\n\t * Transform to a human-readable representation.\n\t */\n\tpublic toString(): string {\n\t\treturn '[' + this.selectionStartLineNumber + ',' + this.selectionStartColumn + ' -> ' + this.positionLineNumber + ',' + this.positionColumn + ']';\n\t}\n\n\t/**\n\t * Test if equals other selection.\n\t */\n\tpublic equalsSelection(other: ISelection): boolean {\n\t\treturn (\n\t\t\tSelection.selectionsEqual(this, other)\n\t\t);\n\t}\n\n\t/**\n\t * Test if the two selections are equal.\n\t */\n\tpublic static selectionsEqual(a: ISelection, b: ISelection): boolean {\n\t\treturn (\n\t\t\ta.selectionStartLineNumber === b.selectionStartLineNumber &&\n\t\t\ta.selectionStartColumn === b.selectionStartColumn &&\n\t\t\ta.positionLineNumber === b.positionLineNumber &&\n\t\t\ta.positionColumn === b.positionColumn\n\t\t);\n\t}\n\n\t/**\n\t * Get directions (LTR or RTL).\n\t */\n\tpublic getDirection(): SelectionDirection {\n\t\tif (this.selectionStartLineNumber === this.startLineNumber && this.selectionStartColumn === this.startColumn) {\n\t\t\treturn SelectionDirection.LTR;\n\t\t}\n\t\treturn SelectionDirection.RTL;\n\t}\n\n\t/**\n\t * Create a new selection with a different `positionLineNumber` and `positionColumn`.\n\t */\n\tpublic setEndPosition(endLineNumber: number, endColumn: number): Selection {\n\t\tif (this.getDirection() === SelectionDirection.LTR) {\n\t\t\treturn new Selection(this.startLineNumber, this.startColumn, endLineNumber, endColumn);\n\t\t}\n\t\treturn new Selection(endLineNumber, endColumn, this.startLineNumber, this.startColumn);\n\t}\n\n\t/**\n\t * Get the position at `positionLineNumber` and `positionColumn`.\n\t */\n\tpublic getPosition(): Position {\n\t\treturn new Position(this.positionLineNumber, this.positionColumn);\n\t}\n\n\t/**\n\t * Create a new selection with a different `selectionStartLineNumber` and `selectionStartColumn`.\n\t */\n\tpublic setStartPosition(startLineNumber: number, startColumn: number): Selection {\n\t\tif (this.getDirection() === SelectionDirection.LTR) {\n\t\t\treturn new Selection(startLineNumber, startColumn, this.endLineNumber, this.endColumn);\n\t\t}\n\t\treturn new Selection(this.endLineNumber, this.endColumn, startLineNumber, startColumn);\n\t}\n\n\t// ----\n\n\t/**\n\t * Create a `Selection` from one or two positions\n\t */\n\tpublic static fromPositions(start: IPosition, end: IPosition = start): Selection {\n\t\treturn new Selection(start.lineNumber, start.column, end.lineNumber, end.column);\n\t}\n\n\t/**\n\t * Create a `Selection` from an `ISelection`.\n\t */\n\tpublic static liftSelection(sel: ISelection): Selection {\n\t\treturn new Selection(sel.selectionStartLineNumber, sel.selectionStartColumn, sel.positionLineNumber, sel.positionColumn);\n\t}\n\n\t/**\n\t * `a` equals `b`.\n\t */\n\tpublic static selectionsArrEqual(a: ISelection[], b: ISelection[]): boolean {\n\t\tif (a && !b || !a && b) {\n\t\t\treturn false;\n\t\t}\n\t\tif (!a && !b) {\n\t\t\treturn true;\n\t\t}\n\t\tif (a.length !== b.length) {\n\t\t\treturn false;\n\t\t}\n\t\tfor (let i = 0, len = a.length; i < len; i++) {\n\t\t\tif (!this.selectionsEqual(a[i], b[i])) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * Test if `obj` is an `ISelection`.\n\t */\n\tpublic static isISelection(obj: any): obj is ISelection {\n\t\treturn (\n\t\t\tobj\n\t\t\t&& (typeof obj.selectionStartLineNumber === 'number')\n\t\t\t&& (typeof obj.selectionStartColumn === 'number')\n\t\t\t&& (typeof obj.positionLineNumber === 'number')\n\t\t\t&& (typeof obj.positionColumn === 'number')\n\t\t);\n\t}\n\n\t/**\n\t * Create with a direction.\n\t */\n\tpublic static createWithDirection(startLineNumber: number, startColumn: number, endLineNumber: number, endColumn: number, direction: SelectionDirection): Selection {\n\n\t\tif (direction === SelectionDirection.LTR) {\n\t\t\treturn new Selection(startLineNumber, startColumn, endLineNumber, endColumn);\n\t\t}\n\n\t\treturn new Selection(endLineNumber, endColumn, startLineNumber, startColumn);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Event } from 'vs/base/common/event';\nimport { IMarkdownString } from 'vs/base/common/htmlContent';\nimport { IDisposable } from 'vs/base/common/lifecycle';\nimport { URI } from 'vs/base/common/uri';\nimport { LineTokens } from 'vs/editor/common/core/lineTokens';\nimport { IPosition, Position } from 'vs/editor/common/core/position';\nimport { IRange, Range } from 'vs/editor/common/core/range';\nimport { Selection } from 'vs/editor/common/core/selection';\nimport { IModelContentChange, IModelContentChangedEvent, IModelDecorationsChangedEvent, IModelLanguageChangedEvent, IModelLanguageConfigurationChangedEvent, IModelOptionsChangedEvent, IModelTokensChangedEvent, ModelRawContentChangedEvent } from 'vs/editor/common/model/textModelEvents';\nimport { SearchData } from 'vs/editor/common/model/textModelSearch';\nimport { LanguageId, LanguageIdentifier, FormattingOptions } from 'vs/editor/common/modes';\nimport { ThemeColor } from 'vs/platform/theme/common/themeService';\nimport { MultilineTokens, MultilineTokens2 } from 'vs/editor/common/model/tokensStore';\nimport { TextChange } from 'vs/editor/common/model/textChange';\n\n/**\n * Vertical Lane in the overview ruler of the editor.\n */\nexport enum OverviewRulerLane {\n\tLeft = 1,\n\tCenter = 2,\n\tRight = 4,\n\tFull = 7\n}\n\n/**\n * Position in the minimap to render the decoration.\n */\nexport enum MinimapPosition {\n\tInline = 1,\n\tGutter = 2\n}\n\nexport interface IDecorationOptions {\n\t/**\n\t * CSS color to render.\n\t * e.g.: rgba(100, 100, 100, 0.5) or a color from the color registry\n\t */\n\tcolor: string | ThemeColor | undefined;\n\t/**\n\t * CSS color to render.\n\t * e.g.: rgba(100, 100, 100, 0.5) or a color from the color registry\n\t */\n\tdarkColor?: string | ThemeColor;\n}\n\n/**\n * Options for rendering a model decoration in the overview ruler.\n */\nexport interface IModelDecorationOverviewRulerOptions extends IDecorationOptions {\n\t/**\n\t * The position in the overview ruler.\n\t */\n\tposition: OverviewRulerLane;\n}\n\n/**\n * Options for rendering a model decoration in the overview ruler.\n */\nexport interface IModelDecorationMinimapOptions extends IDecorationOptions {\n\t/**\n\t * The position in the overview ruler.\n\t */\n\tposition: MinimapPosition;\n}\n\n/**\n * Options for a model decoration.\n */\nexport interface IModelDecorationOptions {\n\t/**\n\t * Customize the growing behavior of the decoration when typing at the edges of the decoration.\n\t * Defaults to TrackedRangeStickiness.AlwaysGrowsWhenTypingAtEdges\n\t */\n\tstickiness?: TrackedRangeStickiness;\n\t/**\n\t * CSS class name describing the decoration.\n\t */\n\tclassName?: string | null;\n\t/**\n\t * Message to be rendered when hovering over the glyph margin decoration.\n\t */\n\tglyphMarginHoverMessage?: IMarkdownString | IMarkdownString[] | null;\n\t/**\n\t * Array of MarkdownString to render as the decoration message.\n\t */\n\thoverMessage?: IMarkdownString | IMarkdownString[] | null;\n\t/**\n\t * Should the decoration expand to encompass a whole line.\n\t */\n\tisWholeLine?: boolean;\n\t/**\n\t * Always render the decoration (even when the range it encompasses is collapsed).\n\t * @internal\n\t */\n\tshowIfCollapsed?: boolean;\n\t/**\n\t * Collapse the decoration if its entire range is being replaced via an edit.\n\t * @internal\n\t */\n\tcollapseOnReplaceEdit?: boolean;\n\t/**\n\t * Specifies the stack order of a decoration.\n\t * A decoration with greater stack order is always in front of a decoration with a lower stack order.\n\t */\n\tzIndex?: number;\n\t/**\n\t * If set, render this decoration in the overview ruler.\n\t */\n\toverviewRuler?: IModelDecorationOverviewRulerOptions | null;\n\t/**\n\t * If set, render this decoration in the minimap.\n\t */\n\tminimap?: IModelDecorationMinimapOptions | null;\n\t/**\n\t * If set, the decoration will be rendered in the glyph margin with this CSS class name.\n\t */\n\tglyphMarginClassName?: string | null;\n\t/**\n\t * If set, the decoration will be rendered in the lines decorations with this CSS class name.\n\t */\n\tlinesDecorationsClassName?: string | null;\n\t/**\n\t * If set, the decoration will be rendered in the lines decorations with this CSS class name, but only for the first line in case of line wrapping.\n\t */\n\tfirstLineDecorationClassName?: string | null;\n\t/**\n\t * If set, the decoration will be rendered in the margin (covering its full width) with this CSS class name.\n\t */\n\tmarginClassName?: string | null;\n\t/**\n\t * If set, the decoration will be rendered inline with the text with this CSS class name.\n\t * Please use this only for CSS rules that must impact the text. For example, use `className`\n\t * to have a background color decoration.\n\t */\n\tinlineClassName?: string | null;\n\t/**\n\t * If there is an `inlineClassName` which affects letter spacing.\n\t */\n\tinlineClassNameAffectsLetterSpacing?: boolean;\n\t/**\n\t * If set, the decoration will be rendered before the text with this CSS class name.\n\t */\n\tbeforeContentClassName?: string | null;\n\t/**\n\t * If set, the decoration will be rendered after the text with this CSS class name.\n\t */\n\tafterContentClassName?: string | null;\n}\n\n/**\n * New model decorations.\n */\nexport interface IModelDeltaDecoration {\n\t/**\n\t * Range that this decoration covers.\n\t */\n\trange: IRange;\n\t/**\n\t * Options associated with this decoration.\n\t */\n\toptions: IModelDecorationOptions;\n}\n\n/**\n * A decoration in the model.\n */\nexport interface IModelDecoration {\n\t/**\n\t * Identifier for a decoration.\n\t */\n\treadonly id: string;\n\t/**\n\t * Identifier for a decoration's owner.\n\t */\n\treadonly ownerId: number;\n\t/**\n\t * Range that this decoration covers.\n\t */\n\treadonly range: Range;\n\t/**\n\t * Options associated with this decoration.\n\t */\n\treadonly options: IModelDecorationOptions;\n}\n\n/**\n * An accessor that can add, change or remove model decorations.\n * @internal\n */\nexport interface IModelDecorationsChangeAccessor {\n\t/**\n\t * Add a new decoration.\n\t * @param range Range that this decoration covers.\n\t * @param options Options associated with this decoration.\n\t * @return An unique identifier associated with this decoration.\n\t */\n\taddDecoration(range: IRange, options: IModelDecorationOptions): string;\n\t/**\n\t * Change the range that an existing decoration covers.\n\t * @param id The unique identifier associated with the decoration.\n\t * @param newRange The new range that this decoration covers.\n\t */\n\tchangeDecoration(id: string, newRange: IRange): void;\n\t/**\n\t * Change the options associated with an existing decoration.\n\t * @param id The unique identifier associated with the decoration.\n\t * @param newOptions The new options associated with this decoration.\n\t */\n\tchangeDecorationOptions(id: string, newOptions: IModelDecorationOptions): void;\n\t/**\n\t * Remove an existing decoration.\n\t * @param id The unique identifier associated with the decoration.\n\t */\n\tremoveDecoration(id: string): void;\n\t/**\n\t * Perform a minimum amount of operations, in order to transform the decorations\n\t * identified by `oldDecorations` to the decorations described by `newDecorations`\n\t * and returns the new identifiers associated with the resulting decorations.\n\t *\n\t * @param oldDecorations Array containing previous decorations identifiers.\n\t * @param newDecorations Array describing what decorations should result after the call.\n\t * @return An array containing the new decorations identifiers.\n\t */\n\tdeltaDecorations(oldDecorations: string[], newDecorations: IModelDeltaDecoration[]): string[];\n}\n\n/**\n * Word inside a model.\n */\nexport interface IWordAtPosition {\n\t/**\n\t * The word.\n\t */\n\treadonly word: string;\n\t/**\n\t * The column where the word starts.\n\t */\n\treadonly startColumn: number;\n\t/**\n\t * The column where the word ends.\n\t */\n\treadonly endColumn: number;\n}\n\n/**\n * End of line character preference.\n */\nexport const enum EndOfLinePreference {\n\t/**\n\t * Use the end of line character identified in the text buffer.\n\t */\n\tTextDefined = 0,\n\t/**\n\t * Use line feed (\\n) as the end of line character.\n\t */\n\tLF = 1,\n\t/**\n\t * Use carriage return and line feed (\\r\\n) as the end of line character.\n\t */\n\tCRLF = 2\n}\n\n/**\n * The default end of line to use when instantiating models.\n */\nexport const enum DefaultEndOfLine {\n\t/**\n\t * Use line feed (\\n) as the end of line character.\n\t */\n\tLF = 1,\n\t/**\n\t * Use carriage return and line feed (\\r\\n) as the end of line character.\n\t */\n\tCRLF = 2\n}\n\n/**\n * End of line character preference.\n */\nexport const enum EndOfLineSequence {\n\t/**\n\t * Use line feed (\\n) as the end of line character.\n\t */\n\tLF = 0,\n\t/**\n\t * Use carriage return and line feed (\\r\\n) as the end of line character.\n\t */\n\tCRLF = 1\n}\n\n/**\n * An identifier for a single edit operation.\n * @internal\n */\nexport interface ISingleEditOperationIdentifier {\n\t/**\n\t * Identifier major\n\t */\n\tmajor: number;\n\t/**\n\t * Identifier minor\n\t */\n\tminor: number;\n}\n\n/**\n * A single edit operation, that acts as a simple replace.\n * i.e. Replace text at `range` with `text` in model.\n */\nexport interface ISingleEditOperation {\n\t/**\n\t * The range to replace. This can be empty to emulate a simple insert.\n\t */\n\trange: IRange;\n\t/**\n\t * The text to replace with. This can be null to emulate a simple delete.\n\t */\n\ttext: string | null;\n\t/**\n\t * This indicates that this operation has \"insert\" semantics.\n\t * i.e. forceMoveMarkers = true => if `range` is collapsed, all markers at the position will be moved.\n\t */\n\tforceMoveMarkers?: boolean;\n}\n\n/**\n * A single edit operation, that has an identifier.\n */\nexport interface IIdentifiedSingleEditOperation {\n\t/**\n\t * An identifier associated with this single edit operation.\n\t * @internal\n\t */\n\tidentifier?: ISingleEditOperationIdentifier | null;\n\t/**\n\t * The range to replace. This can be empty to emulate a simple insert.\n\t */\n\trange: IRange;\n\t/**\n\t * The text to replace with. This can be null to emulate a simple delete.\n\t */\n\ttext: string | null;\n\t/**\n\t * This indicates that this operation has \"insert\" semantics.\n\t * i.e. forceMoveMarkers = true => if `range` is collapsed, all markers at the position will be moved.\n\t */\n\tforceMoveMarkers?: boolean;\n\t/**\n\t * This indicates that this operation is inserting automatic whitespace\n\t * that can be removed on next model edit operation if `config.trimAutoWhitespace` is true.\n\t * @internal\n\t */\n\tisAutoWhitespaceEdit?: boolean;\n\t/**\n\t * This indicates that this operation is in a set of operations that are tracked and should not be \"simplified\".\n\t * @internal\n\t */\n\t_isTracked?: boolean;\n}\n\nexport interface IValidEditOperation {\n\t/**\n\t * An identifier associated with this single edit operation.\n\t * @internal\n\t */\n\tidentifier: ISingleEditOperationIdentifier | null;\n\t/**\n\t * The range to replace. This can be empty to emulate a simple insert.\n\t */\n\trange: Range;\n\t/**\n\t * The text to replace with. This can be empty to emulate a simple delete.\n\t */\n\ttext: string;\n\t/**\n\t * @internal\n\t */\n\ttextChange: TextChange;\n}\n\n/**\n * A callback that can compute the cursor state after applying a series of edit operations.\n */\nexport interface ICursorStateComputer {\n\t/**\n\t * A callback that can compute the resulting cursors state after some edit operations have been executed.\n\t */\n\t(inverseEditOperations: IValidEditOperation[]): Selection[] | null;\n}\n\nexport class TextModelResolvedOptions {\n\t_textModelResolvedOptionsBrand: void;\n\n\treadonly tabSize: number;\n\treadonly indentSize: number;\n\treadonly insertSpaces: boolean;\n\treadonly defaultEOL: DefaultEndOfLine;\n\treadonly trimAutoWhitespace: boolean;\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(src: {\n\t\ttabSize: number;\n\t\tindentSize: number;\n\t\tinsertSpaces: boolean;\n\t\tdefaultEOL: DefaultEndOfLine;\n\t\ttrimAutoWhitespace: boolean;\n\t}) {\n\t\tthis.tabSize = Math.max(1, src.tabSize | 0);\n\t\tthis.indentSize = src.tabSize | 0;\n\t\tthis.insertSpaces = Boolean(src.insertSpaces);\n\t\tthis.defaultEOL = src.defaultEOL | 0;\n\t\tthis.trimAutoWhitespace = Boolean(src.trimAutoWhitespace);\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic equals(other: TextModelResolvedOptions): boolean {\n\t\treturn (\n\t\t\tthis.tabSize === other.tabSize\n\t\t\t&& this.indentSize === other.indentSize\n\t\t\t&& this.insertSpaces === other.insertSpaces\n\t\t\t&& this.defaultEOL === other.defaultEOL\n\t\t\t&& this.trimAutoWhitespace === other.trimAutoWhitespace\n\t\t);\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tpublic createChangeEvent(newOpts: TextModelResolvedOptions): IModelOptionsChangedEvent {\n\t\treturn {\n\t\t\ttabSize: this.tabSize !== newOpts.tabSize,\n\t\t\tindentSize: this.indentSize !== newOpts.indentSize,\n\t\t\tinsertSpaces: this.insertSpaces !== newOpts.insertSpaces,\n\t\t\ttrimAutoWhitespace: this.trimAutoWhitespace !== newOpts.trimAutoWhitespace,\n\t\t};\n\t}\n}\n\n/**\n * @internal\n */\nexport interface ITextModelCreationOptions {\n\ttabSize: number;\n\tindentSize: number;\n\tinsertSpaces: boolean;\n\tdetectIndentation: boolean;\n\ttrimAutoWhitespace: boolean;\n\tdefaultEOL: DefaultEndOfLine;\n\tisForSimpleWidget: boolean;\n\tlargeFileOptimizations: boolean;\n}\n\nexport interface ITextModelUpdateOptions {\n\ttabSize?: number;\n\tindentSize?: number;\n\tinsertSpaces?: boolean;\n\ttrimAutoWhitespace?: boolean;\n}\n\nexport class FindMatch {\n\t_findMatchBrand: void;\n\n\tpublic readonly range: Range;\n\tpublic readonly matches: string[] | null;\n\n\t/**\n\t * @internal\n\t */\n\tconstructor(range: Range, matches: string[] | null) {\n\t\tthis.range = range;\n\t\tthis.matches = matches;\n\t}\n}\n\n/**\n * @internal\n */\nexport interface IFoundBracket {\n\trange: Range;\n\topen: string[];\n\tclose: string[];\n\tisOpen: boolean;\n}\n\n/**\n * Describes the behavior of decorations when typing/editing near their edges.\n * Note: Please do not edit the values, as they very carefully match `DecorationRangeBehavior`\n */\nexport const enum TrackedRangeStickiness {\n\tAlwaysGrowsWhenTypingAtEdges = 0,\n\tNeverGrowsWhenTypingAtEdges = 1,\n\tGrowsOnlyWhenTypingBefore = 2,\n\tGrowsOnlyWhenTypingAfter = 3,\n}\n\n/**\n * @internal\n */\nexport interface IActiveIndentGuideInfo {\n\tstartLineNumber: number;\n\tendLineNumber: number;\n\tindent: number;\n}\n\n/**\n * Text snapshot that works like an iterator.\n * Will try to return chunks of roughly ~64KB size.\n * Will return null when finished.\n *\n * @internal\n */\nexport interface ITextSnapshot {\n\tread(): string | null;\n}\n\n/**\n * A model.\n */\nexport interface ITextModel {\n\n\t/**\n\t * Gets the resource associated with this editor model.\n\t */\n\treadonly uri: URI;\n\n\t/**\n\t * A unique identifier associated with this model.\n\t */\n\treadonly id: string;\n\n\t/**\n\t * This model is constructed for a simple widget code editor.\n\t * @internal\n\t */\n\treadonly isForSimpleWidget: boolean;\n\n\t/**\n\t * If true, the text model might contain RTL.\n\t * If false, the text model **contains only** contain LTR.\n\t * @internal\n\t */\n\tmightContainRTL(): boolean;\n\n\t/**\n\t * If true, the text model might contain LINE SEPARATOR (LS), PARAGRAPH SEPARATOR (PS).\n\t * If false, the text model definitely does not contain these.\n\t * @internal\n\t */\n\tmightContainUnusualLineTerminators(): boolean;\n\n\t/**\n\t * @internal\n\t */\n\tremoveUnusualLineTerminators(selections?: Selection[]): void;\n\n\t/**\n\t * If true, the text model might contain non basic ASCII.\n\t * If false, the text model **contains only** basic ASCII.\n\t * @internal\n\t */\n\tmightContainNonBasicASCII(): boolean;\n\n\t/**\n\t * Get the resolved options for this model.\n\t */\n\tgetOptions(): TextModelResolvedOptions;\n\n\t/**\n\t * Get the formatting options for this model.\n\t * @internal\n\t */\n\tgetFormattingOptions(): FormattingOptions;\n\n\t/**\n\t * Get the current version id of the model.\n\t * Anytime a change happens to the model (even undo/redo),\n\t * the version id is incremented.\n\t */\n\tgetVersionId(): number;\n\n\t/**\n\t * Get the alternative version id of the model.\n\t * This alternative version id is not always incremented,\n\t * it will return the same values in the case of undo-redo.\n\t */\n\tgetAlternativeVersionId(): number;\n\n\t/**\n\t * Replace the entire text buffer value contained in this model.\n\t */\n\tsetValue(newValue: string): void;\n\n\t/**\n\t * Get the text stored in this model.\n\t * @param eol The end of line character preference. Defaults to `EndOfLinePreference.TextDefined`.\n\t * @param preserverBOM Preserve a BOM character if it was detected when the model was constructed.\n\t * @return The text.\n\t */\n\tgetValue(eol?: EndOfLinePreference, preserveBOM?: boolean): string;\n\n\t/**\n\t * Get the text stored in this model.\n\t * @param preserverBOM Preserve a BOM character if it was detected when the model was constructed.\n\t * @return The text snapshot (it is safe to consume it asynchronously).\n\t * @internal\n\t */\n\tcreateSnapshot(preserveBOM?: boolean): ITextSnapshot;\n\n\t/**\n\t * Get the length of the text stored in this model.\n\t */\n\tgetValueLength(eol?: EndOfLinePreference, preserveBOM?: boolean): number;\n\n\t/**\n\t * Check if the raw text stored in this model equals another raw text.\n\t * @internal\n\t */\n\tequalsTextBuffer(other: ITextBuffer): boolean;\n\n\t/**\n\t * Get the underling text buffer.\n\t * @internal\n\t */\n\tgetTextBuffer(): ITextBuffer;\n\n\t/**\n\t * Get the text in a certain range.\n\t * @param range The range describing what text to get.\n\t * @param eol The end of line character preference. This will only be used for multiline ranges. Defaults to `EndOfLinePreference.TextDefined`.\n\t * @return The text.\n\t */\n\tgetValueInRange(range: IRange, eol?: EndOfLinePreference): string;\n\n\t/**\n\t * Get the length of text in a certain range.\n\t * @param range The range describing what text length to get.\n\t * @return The text length.\n\t */\n\tgetValueLengthInRange(range: IRange): number;\n\n\t/**\n\t * Get the character count of text in a certain range.\n\t * @param range The range describing what text length to get.\n\t */\n\tgetCharacterCountInRange(range: IRange): number;\n\n\t/**\n\t * Splits characters in two buckets. First bucket (A) is of characters that\n\t * sit in lines with length < `LONG_LINE_BOUNDARY`. Second bucket (B) is of\n\t * characters that sit in lines with length >= `LONG_LINE_BOUNDARY`.\n\t * If count(B) > count(A) return true. Returns false otherwise.\n\t * @internal\n\t */\n\tisDominatedByLongLines(): boolean;\n\n\t/**\n\t * Get the number of lines in the model.\n\t */\n\tgetLineCount(): number;\n\n\t/**\n\t * Get the text for a certain line.\n\t */\n\tgetLineContent(lineNumber: number): string;\n\n\t/**\n\t * Get the text length for a certain line.\n\t */\n\tgetLineLength(lineNumber: number): number;\n\n\t/**\n\t * Get the text for all lines.\n\t */\n\tgetLinesContent(): string[];\n\n\t/**\n\t * Get the end of line sequence predominantly used in the text buffer.\n\t * @return EOL char sequence (e.g.: '\\n' or '\\r\\n').\n\t */\n\tgetEOL(): string;\n\n\t/**\n\t * Get the end of line sequence predominantly used in the text buffer.\n\t */\n\tgetEndOfLineSequence(): EndOfLineSequence;\n\n\t/**\n\t * Get the minimum legal column for line at `lineNumber`\n\t */\n\tgetLineMinColumn(lineNumber: number): number;\n\n\t/**\n\t * Get the maximum legal column for line at `lineNumber`\n\t */\n\tgetLineMaxColumn(lineNumber: number): number;\n\n\t/**\n\t * Returns the column before the first non whitespace character for line at `lineNumber`.\n\t * Returns 0 if line is empty or contains only whitespace.\n\t */\n\tgetLineFirstNonWhitespaceColumn(lineNumber: number): number;\n\n\t/**\n\t * Returns the column after the last non whitespace character for line at `lineNumber`.\n\t * Returns 0 if line is empty or contains only whitespace.\n\t */\n\tgetLineLastNonWhitespaceColumn(lineNumber: number): number;\n\n\t/**\n\t * Create a valid position,\n\t */\n\tvalidatePosition(position: IPosition): Position;\n\n\t/**\n\t * Advances the given position by the given offset (negative offsets are also accepted)\n\t * and returns it as a new valid position.\n\t *\n\t * If the offset and position are such that their combination goes beyond the beginning or\n\t * end of the model, throws an exception.\n\t *\n\t * If the offset is such that the new position would be in the middle of a multi-byte\n\t * line terminator, throws an exception.\n\t */\n\tmodifyPosition(position: IPosition, offset: number): Position;\n\n\t/**\n\t * Create a valid range.\n\t */\n\tvalidateRange(range: IRange): Range;\n\n\t/**\n\t * Converts the position to a zero-based offset.\n\t *\n\t * The position will be [adjusted](#TextDocument.validatePosition).\n\t *\n\t * @param position A position.\n\t * @return A valid zero-based offset.\n\t */\n\tgetOffsetAt(position: IPosition): number;\n\n\t/**\n\t * Converts a zero-based offset to a position.\n\t *\n\t * @param offset A zero-based offset.\n\t * @return A valid [position](#Position).\n\t */\n\tgetPositionAt(offset: number): Position;\n\n\t/**\n\t * Get a range covering the entire model\n\t */\n\tgetFullModelRange(): Range;\n\n\t/**\n\t * Returns if the model was disposed or not.\n\t */\n\tisDisposed(): boolean;\n\n\t/**\n\t * @internal\n\t */\n\ttokenizeViewport(startLineNumber: number, endLineNumber: number): void;\n\n\t/**\n\t * This model is so large that it would not be a good idea to sync it over\n\t * to web workers or other places.\n\t * @internal\n\t */\n\tisTooLargeForSyncing(): boolean;\n\n\t/**\n\t * The file is so large, that even tokenization is disabled.\n\t * @internal\n\t */\n\tisTooLargeForTokenization(): boolean;\n\n\t/**\n\t * Search the model.\n\t * @param searchString The string used to search. If it is a regular expression, set `isRegex` to true.\n\t * @param searchOnlyEditableRange Limit the searching to only search inside the editable range of the model.\n\t * @param isRegex Used to indicate that `searchString` is a regular expression.\n\t * @param matchCase Force the matching to match lower/upper case exactly.\n\t * @param wordSeparators Force the matching to match entire words only. Pass null otherwise.\n\t * @param captureMatches The result will contain the captured groups.\n\t * @param limitResultCount Limit the number of results\n\t * @return The ranges where the matches are. It is empty if not matches have been found.\n\t */\n\tfindMatches(searchString: string, searchOnlyEditableRange: boolean, isRegex: boolean, matchCase: boolean, wordSeparators: string | null, captureMatches: boolean, limitResultCount?: number): FindMatch[];\n\t/**\n\t * Search the model.\n\t * @param searchString The string used to search. If it is a regular expression, set `isRegex` to true.\n\t * @param searchScope Limit the searching to only search inside these ranges.\n\t * @param isRegex Used to indicate that `searchString` is a regular expression.\n\t * @param matchCase Force the matching to match lower/upper case exactly.\n\t * @param wordSeparators Force the matching to match entire words only. Pass null otherwise.\n\t * @param captureMatches The result will contain the captured groups.\n\t * @param limitResultCount Limit the number of results\n\t * @return The ranges where the matches are. It is empty if no matches have been found.\n\t */\n\tfindMatches(searchString: string, searchScope: IRange | IRange[], isRegex: boolean, matchCase: boolean, wordSeparators: string | null, captureMatches: boolean, limitResultCount?: number): FindMatch[];\n\t/**\n\t * Search the model for the next match. Loops to the beginning of the model if needed.\n\t * @param searchString The string used to search. If it is a regular expression, set `isRegex` to true.\n\t * @param searchStart Start the searching at the specified position.\n\t * @param isRegex Used to indicate that `searchString` is a regular expression.\n\t * @param matchCase Force the matching to match lower/upper case exactly.\n\t * @param wordSeparators Force the matching to match entire words only. Pass null otherwise.\n\t * @param captureMatches The result will contain the captured groups.\n\t * @return The range where the next match is. It is null if no next match has been found.\n\t */\n\tfindNextMatch(searchString: string, searchStart: IPosition, isRegex: boolean, matchCase: boolean, wordSeparators: string | null, captureMatches: boolean): FindMatch | null;\n\t/**\n\t * Search the model for the previous match. Loops to the end of the model if needed.\n\t * @param searchString The string used to search. If it is a regular expression, set `isRegex` to true.\n\t * @param searchStart Start the searching at the specified position.\n\t * @param isRegex Used to indicate that `searchString` is a regular expression.\n\t * @param matchCase Force the matching to match lower/upper case exactly.\n\t * @param wordSeparators Force the matching to match entire words only. Pass null otherwise.\n\t * @param captureMatches The result will contain the captured groups.\n\t * @return The range where the previous match is. It is null if no previous match has been found.\n\t */\n\tfindPreviousMatch(searchString: string, searchStart: IPosition, isRegex: boolean, matchCase: boolean, wordSeparators: string | null, captureMatches: boolean): FindMatch | null;\n\n\t/**\n\t * @internal\n\t */\n\tsetTokens(tokens: MultilineTokens[]): void;\n\n\t/**\n\t * @internal\n\t */\n\tsetSemanticTokens(tokens: MultilineTokens2[] | null, isComplete: boolean): void;\n\n\t/**\n\t * @internal\n\t */\n\tsetPartialSemanticTokens(range: Range, tokens: MultilineTokens2[] | null): void;\n\n\t/**\n\t * @internal\n\t */\n\thasCompleteSemanticTokens(): boolean;\n\n\t/**\n\t * @internal\n\t */\n\thasSomeSemanticTokens(): boolean;\n\n\t/**\n\t * Flush all tokenization state.\n\t * @internal\n\t */\n\tresetTokenization(): void;\n\n\t/**\n\t * Force tokenization information for `lineNumber` to be accurate.\n\t * @internal\n\t */\n\tforceTokenization(lineNumber: number): void;\n\n\t/**\n\t * If it is cheap, force tokenization information for `lineNumber` to be accurate.\n\t * This is based on a heuristic.\n\t * @internal\n\t */\n\ttokenizeIfCheap(lineNumber: number): void;\n\n\t/**\n\t * Check if calling `forceTokenization` for this `lineNumber` will be cheap (time-wise).\n\t * This is based on a heuristic.\n\t * @internal\n\t */\n\tisCheapToTokenize(lineNumber: number): boolean;\n\n\t/**\n\t * Get the tokens for the line `lineNumber`.\n\t * The tokens might be inaccurate. Use `forceTokenization` to ensure accurate tokens.\n\t * @internal\n\t */\n\tgetLineTokens(lineNumber: number): LineTokens;\n\n\t/**\n\t * Get the language associated with this model.\n\t * @internal\n\t */\n\tgetLanguageIdentifier(): LanguageIdentifier;\n\n\t/**\n\t * Get the language associated with this model.\n\t */\n\tgetModeId(): string;\n\n\t/**\n\t * Set the current language mode associated with the model.\n\t * @internal\n\t */\n\tsetMode(languageIdentifier: LanguageIdentifier): void;\n\n\t/**\n\t * Returns the real (inner-most) language mode at a given position.\n\t * The result might be inaccurate. Use `forceTokenization` to ensure accurate tokens.\n\t * @internal\n\t */\n\tgetLanguageIdAtPosition(lineNumber: number, column: number): LanguageId;\n\n\t/**\n\t * Get the word under or besides `position`.\n\t * @param position The position to look for a word.\n\t * @return The word under or besides `position`. Might be null.\n\t */\n\tgetWordAtPosition(position: IPosition): IWordAtPosition | null;\n\n\t/**\n\t * Get the word under or besides `position` trimmed to `position`.column\n\t * @param position The position to look for a word.\n\t * @return The word under or besides `position`. Will never be null.\n\t */\n\tgetWordUntilPosition(position: IPosition): IWordAtPosition;\n\n\t/**\n\t * Find the matching bracket of `request` up, counting brackets.\n\t * @param request The bracket we're searching for\n\t * @param position The position at which to start the search.\n\t * @return The range of the matching bracket, or null if the bracket match was not found.\n\t * @internal\n\t */\n\tfindMatchingBracketUp(bracket: string, position: IPosition): Range | null;\n\n\t/**\n\t * Find the first bracket in the model before `position`.\n\t * @param position The position at which to start the search.\n\t * @return The info for the first bracket before `position`, or null if there are no more brackets before `positions`.\n\t * @internal\n\t */\n\tfindPrevBracket(position: IPosition): IFoundBracket | null;\n\n\t/**\n\t * Find the first bracket in the model after `position`.\n\t * @param position The position at which to start the search.\n\t * @return The info for the first bracket after `position`, or null if there are no more brackets after `positions`.\n\t * @internal\n\t */\n\tfindNextBracket(position: IPosition): IFoundBracket | null;\n\n\t/**\n\t * Find the enclosing brackets that contain `position`.\n\t * @param position The position at which to start the search.\n\t * @internal\n\t */\n\tfindEnclosingBrackets(position: IPosition, maxDuration?: number): [Range, Range] | null;\n\n\t/**\n\t * Given a `position`, if the position is on top or near a bracket,\n\t * find the matching bracket of that bracket and return the ranges of both brackets.\n\t * @param position The position at which to look for a bracket.\n\t * @internal\n\t */\n\tmatchBracket(position: IPosition): [Range, Range] | null;\n\n\t/**\n\t * @internal\n\t */\n\tgetActiveIndentGuide(lineNumber: number, minLineNumber: number, maxLineNumber: number): IActiveIndentGuideInfo;\n\n\t/**\n\t * @internal\n\t */\n\tgetLinesIndentGuides(startLineNumber: number, endLineNumber: number): number[];\n\n\t/**\n\t * Change the decorations. The callback will be called with a change accessor\n\t * that becomes invalid as soon as the callback finishes executing.\n\t * This allows for all events to be queued up until the change\n\t * is completed. Returns whatever the callback returns.\n\t * @param ownerId Identifies the editor id in which these decorations should appear. If no `ownerId` is provided, the decorations will appear in all editors that attach this model.\n\t * @internal\n\t */\n\tchangeDecorations<T>(callback: (changeAccessor: IModelDecorationsChangeAccessor) => T, ownerId?: number): T | null;\n\n\t/**\n\t * Perform a minimum amount of operations, in order to transform the decorations\n\t * identified by `oldDecorations` to the decorations described by `newDecorations`\n\t * and returns the new identifiers associated with the resulting decorations.\n\t *\n\t * @param oldDecorations Array containing previous decorations identifiers.\n\t * @param newDecorations Array describing what decorations should result after the call.\n\t * @param ownerId Identifies the editor id in which these decorations should appear. If no `ownerId` is provided, the decorations will appear in all editors that attach this model.\n\t * @return An array containing the new decorations identifiers.\n\t */\n\tdeltaDecorations(oldDecorations: string[], newDecorations: IModelDeltaDecoration[], ownerId?: number): string[];\n\n\t/**\n\t * Remove all decorations that have been added with this specific ownerId.\n\t * @param ownerId The owner id to search for.\n\t * @internal\n\t */\n\tremoveAllDecorationsWithOwnerId(ownerId: number): void;\n\n\t/**\n\t * Get the options associated with a decoration.\n\t * @param id The decoration id.\n\t * @return The decoration options or null if the decoration was not found.\n\t */\n\tgetDecorationOptions(id: string): IModelDecorationOptions | null;\n\n\t/**\n\t * Get the range associated with a decoration.\n\t * @param id The decoration id.\n\t * @return The decoration range or null if the decoration was not found.\n\t */\n\tgetDecorationRange(id: string): Range | null;\n\n\t/**\n\t * Gets all the decorations for the line `lineNumber` as an array.\n\t * @param lineNumber The line number\n\t * @param ownerId If set, it will ignore decorations belonging to other owners.\n\t * @param filterOutValidation If set, it will ignore decorations specific to validation (i.e. warnings, errors).\n\t * @return An array with the decorations\n\t */\n\tgetLineDecorations(lineNumber: number, ownerId?: number, filterOutValidation?: boolean): IModelDecoration[];\n\n\t/**\n\t * Gets all the decorations for the lines between `startLineNumber` and `endLineNumber` as an array.\n\t * @param startLineNumber The start line number\n\t * @param endLineNumber The end line number\n\t * @param ownerId If set, it will ignore decorations belonging to other owners.\n\t * @param filterOutValidation If set, it will ignore decorations specific to validation (i.e. warnings, errors).\n\t * @return An array with the decorations\n\t */\n\tgetLinesDecorations(startLineNumber: number, endLineNumber: number, ownerId?: number, filterOutValidation?: boolean): IModelDecoration[];\n\n\t/**\n\t * Gets all the decorations in a range as an array. Only `startLineNumber` and `endLineNumber` from `range` are used for filtering.\n\t * So for now it returns all the decorations on the same line as `range`.\n\t * @param range The range to search in\n\t * @param ownerId If set, it will ignore decorations belonging to other owners.\n\t * @param filterOutValidation If set, it will ignore decorations specific to validation (i.e. warnings, errors).\n\t * @return An array with the decorations\n\t */\n\tgetDecorationsInRange(range: IRange, ownerId?: number, filterOutValidation?: boolean): IModelDecoration[];\n\n\t/**\n\t * Gets all the decorations as an array.\n\t * @param ownerId If set, it will ignore decorations belonging to other owners.\n\t * @param filterOutValidation If set, it will ignore decorations specific to validation (i.e. warnings, errors).\n\t */\n\tgetAllDecorations(ownerId?: number, filterOutValidation?: boolean): IModelDecoration[];\n\n\t/**\n\t * Gets all the decorations that should be rendered in the overview ruler as an array.\n\t * @param ownerId If set, it will ignore decorations belonging to other owners.\n\t * @param filterOutValidation If set, it will ignore decorations specific to validation (i.e. warnings, errors).\n\t */\n\tgetOverviewRulerDecorations(ownerId?: number, filterOutValidation?: boolean): IModelDecoration[];\n\n\t/**\n\t * @internal\n\t */\n\t_getTrackedRange(id: string): Range | null;\n\n\t/**\n\t * @internal\n\t */\n\t_setTrackedRange(id: string | null, newRange: null, newStickiness: TrackedRangeStickiness): null;\n\t/**\n\t * @internal\n\t */\n\t_setTrackedRange(id: string | null, newRange: Range, newStickiness: TrackedRangeStickiness): string;\n\n\t/**\n\t * Normalize a string containing whitespace according to indentation rules (converts to spaces or to tabs).\n\t */\n\tnormalizeIndentation(str: string): string;\n\n\t/**\n\t * Change the options of this model.\n\t */\n\tupdateOptions(newOpts: ITextModelUpdateOptions): void;\n\n\t/**\n\t * Detect the indentation options for this model from its content.\n\t */\n\tdetectIndentation(defaultInsertSpaces: boolean, defaultTabSize: number): void;\n\n\t/**\n\t * Close the current undo-redo element.\n\t * This offers a way to create an undo/redo stop point.\n\t */\n\tpushStackElement(): void;\n\n\t/**\n\t * Open the current undo-redo element.\n\t * This offers a way to remove the current undo/redo stop point.\n\t */\n\tpopStackElement(): void;\n\n\t/**\n\t * Push edit operations, basically editing the model. This is the preferred way\n\t * of editing the model. The edit operations will land on the undo stack.\n\t * @param beforeCursorState The cursor state before the edit operations. This cursor state will be returned when `undo` or `redo` are invoked.\n\t * @param editOperations The edit operations.\n\t * @param cursorStateComputer A callback that can compute the resulting cursors state after the edit operations have been executed.\n\t * @return The cursor state returned by the `cursorStateComputer`.\n\t */\n\tpushEditOperations(beforeCursorState: Selection[] | null, editOperations: IIdentifiedSingleEditOperation[], cursorStateComputer: ICursorStateComputer): Selection[] | null;\n\n\t/**\n\t * Change the end of line sequence. This is the preferred way of\n\t * changing the eol sequence. This will land on the undo stack.\n\t */\n\tpushEOL(eol: EndOfLineSequence): void;\n\n\t/**\n\t * Edit the model without adding the edits to the undo stack.\n\t * This can have dire consequences on the undo stack! See @pushEditOperations for the preferred way.\n\t * @param operations The edit operations.\n\t * @return If desired, the inverse edit operations, that, when applied, will bring the model back to the previous state.\n\t */\n\tapplyEdits(operations: IIdentifiedSingleEditOperation[]): void;\n\tapplyEdits(operations: IIdentifiedSingleEditOperation[], computeUndoEdits: false): void;\n\tapplyEdits(operations: IIdentifiedSingleEditOperation[], computeUndoEdits: true): IValidEditOperation[];\n\n\t/**\n\t * Change the end of line sequence without recording in the undo stack.\n\t * This can have dire consequences on the undo stack! See @pushEOL for the preferred way.\n\t */\n\tsetEOL(eol: EndOfLineSequence): void;\n\n\t/**\n\t * @internal\n\t */\n\t_applyUndo(changes: TextChange[], eol: EndOfLineSequence, resultingAlternativeVersionId: number, resultingSelection: Selection[] | null): void;\n\n\t/**\n\t * @internal\n\t */\n\t_applyRedo(changes: TextChange[], eol: EndOfLineSequence, resultingAlternativeVersionId: number, resultingSelection: Selection[] | null): void;\n\n\t/**\n\t * Undo edit operations until the previous undo/redo point.\n\t * The inverse edit operations will be pushed on the redo stack.\n\t * @internal\n\t */\n\tundo(): void | Promise<void>;\n\n\t/**\n\t * Is there anything in the undo stack?\n\t * @internal\n\t */\n\tcanUndo(): boolean;\n\n\t/**\n\t * Redo edit operations until the next undo/redo point.\n\t * The inverse edit operations will be pushed on the undo stack.\n\t * @internal\n\t */\n\tredo(): void | Promise<void>;\n\n\t/**\n\t * Is there anything in the redo stack?\n\t * @internal\n\t */\n\tcanRedo(): boolean;\n\n\t/**\n\t * @deprecated Please use `onDidChangeContent` instead.\n\t * An event emitted when the contents of the model have changed.\n\t * @internal\n\t * @event\n\t */\n\tonDidChangeRawContentFast(listener: (e: ModelRawContentChangedEvent) => void): IDisposable;\n\t/**\n\t * @deprecated Please use `onDidChangeContent` instead.\n\t * An event emitted when the contents of the model have changed.\n\t * @internal\n\t * @event\n\t */\n\tonDidChangeRawContent(listener: (e: ModelRawContentChangedEvent) => void): IDisposable;\n\t/**\n\t * An event emitted when the contents of the model have changed.\n\t * @event\n\t */\n\tonDidChangeContent(listener: (e: IModelContentChangedEvent) => void): IDisposable;\n\t/**\n\t * An event emitted when decorations of the model have changed.\n\t * @event\n\t */\n\tonDidChangeDecorations(listener: (e: IModelDecorationsChangedEvent) => void): IDisposable;\n\t/**\n\t * An event emitted when the model options have changed.\n\t * @event\n\t */\n\tonDidChangeOptions(listener: (e: IModelOptionsChangedEvent) => void): IDisposable;\n\t/**\n\t * An event emitted when the language associated with the model has changed.\n\t * @event\n\t */\n\tonDidChangeLanguage(listener: (e: IModelLanguageChangedEvent) => void): IDisposable;\n\t/**\n\t * An event emitted when the language configuration associated with the model has changed.\n\t * @event\n\t */\n\tonDidChangeLanguageConfiguration(listener: (e: IModelLanguageConfigurationChangedEvent) => void): IDisposable;\n\t/**\n\t * An event emitted when the tokens associated with the model have changed.\n\t * @event\n\t * @internal\n\t */\n\tonDidChangeTokens(listener: (e: IModelTokensChangedEvent) => void): IDisposable;\n\t/**\n\t * An event emitted when the model has been attached to the first editor or detached from the last editor.\n\t * @event\n\t * @internal\n\t */\n\tonDidChangeAttached(listener: () => void): IDisposable;\n\t/**\n\t * An event emitted right before disposing the model.\n\t * @event\n\t */\n\tonWillDispose(listener: () => void): IDisposable;\n\n\t/**\n\t * Destroy this model. This will unbind the model from the mode\n\t * and make all necessary clean-up to release this object to the GC.\n\t */\n\tdispose(): void;\n\n\t/**\n\t * @internal\n\t */\n\tonBeforeAttached(): void;\n\n\t/**\n\t * @internal\n\t */\n\tonBeforeDetached(): void;\n\n\t/**\n\t * Returns if this model is attached to an editor or not.\n\t * @internal\n\t */\n\tisAttachedToEditor(): boolean;\n\n\t/**\n\t * Returns the count of editors this model is attached to.\n\t * @internal\n\t */\n\tgetAttachedEditorCount(): number;\n}\n\n/**\n * @internal\n */\nexport interface ITextBufferBuilder {\n\tacceptChunk(chunk: string): void;\n\tfinish(): ITextBufferFactory;\n}\n\n/**\n * @internal\n */\nexport interface ITextBufferFactory {\n\tcreate(defaultEOL: DefaultEndOfLine): { textBuffer: ITextBuffer; disposable: IDisposable; };\n\tgetFirstLineText(lengthLimit: number): string;\n}\n\n/**\n * @internal\n */\nexport const enum ModelConstants {\n\tFIRST_LINE_DETECTION_LENGTH_LIMIT = 1000\n}\n\n/**\n * @internal\n */\nexport class ValidAnnotatedEditOperation implements IIdentifiedSingleEditOperation {\n\tconstructor(\n\t\tpublic readonly identifier: ISingleEditOperationIdentifier | null,\n\t\tpublic readonly range: Range,\n\t\tpublic readonly text: string | null,\n\t\tpublic readonly forceMoveMarkers: boolean,\n\t\tpublic readonly isAutoWhitespaceEdit: boolean,\n\t\tpublic readonly _isTracked: boolean,\n\t) { }\n}\n\n/**\n * @internal\n */\nexport interface IReadonlyTextBuffer {\n\tonDidChangeContent: Event<void>;\n\tequals(other: ITextBuffer): boolean;\n\tmightContainRTL(): boolean;\n\tmightContainUnusualLineTerminators(): boolean;\n\tresetMightContainUnusualLineTerminators(): void;\n\tmightContainNonBasicASCII(): boolean;\n\tgetBOM(): string;\n\tgetEOL(): string;\n\n\tgetOffsetAt(lineNumber: number, column: number): number;\n\tgetPositionAt(offset: number): Position;\n\tgetRangeAt(offset: number, length: number): Range;\n\n\tgetValueInRange(range: Range, eol: EndOfLinePreference): string;\n\tcreateSnapshot(preserveBOM: boolean): ITextSnapshot;\n\tgetValueLengthInRange(range: Range, eol: EndOfLinePreference): number;\n\tgetCharacterCountInRange(range: Range, eol: EndOfLinePreference): number;\n\tgetLength(): number;\n\tgetLineCount(): number;\n\tgetLinesContent(): string[];\n\tgetLineContent(lineNumber: number): string;\n\tgetLineCharCode(lineNumber: number, index: number): number;\n\tgetCharCode(offset: number): number;\n\tgetLineLength(lineNumber: number): number;\n\tgetLineFirstNonWhitespaceColumn(lineNumber: number): number;\n\tgetLineLastNonWhitespaceColumn(lineNumber: number): number;\n\tfindMatchesLineByLine(searchRange: Range, searchData: SearchData, captureMatches: boolean, limitResultCount: number): FindMatch[];\n}\n\n/**\n * @internal\n */\nexport interface ITextBuffer extends IReadonlyTextBuffer {\n\tsetEOL(newEOL: '\\r\\n' | '\\n'): void;\n\tapplyEdits(rawOperations: ValidAnnotatedEditOperation[], recordTrimAutoWhitespace: boolean, computeUndoEdits: boolean): ApplyEditsResult;\n}\n\n/**\n * @internal\n */\nexport class ApplyEditsResult {\n\n\tconstructor(\n\t\tpublic readonly reverseEdits: IValidEditOperation[] | null,\n\t\tpublic readonly changes: IInternalModelContentChange[],\n\t\tpublic readonly trimAutoWhitespaceLineNumbers: number[] | null\n\t) { }\n\n}\n\n/**\n * @internal\n */\nexport interface IInternalModelContentChange extends IModelContentChange {\n\trange: Range;\n\tforceMoveMarkers: boolean;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CharCode } from 'vs/base/common/charCode';\nimport * as strings from 'vs/base/common/strings';\nimport { WordCharacterClass, WordCharacterClassifier, getMapForWordSeparators } from 'vs/editor/common/controller/wordCharacterClassifier';\nimport { Position } from 'vs/editor/common/core/position';\nimport { Range } from 'vs/editor/common/core/range';\nimport { EndOfLinePreference, FindMatch } from 'vs/editor/common/model';\nimport { TextModel } from 'vs/editor/common/model/textModel';\n\nconst LIMIT_FIND_COUNT = 999;\n\nexport class SearchParams {\n\tpublic readonly searchString: string;\n\tpublic readonly isRegex: boolean;\n\tpublic readonly matchCase: boolean;\n\tpublic readonly wordSeparators: string | null;\n\n\tconstructor(searchString: string, isRegex: boolean, matchCase: boolean, wordSeparators: string | null) {\n\t\tthis.searchString = searchString;\n\t\tthis.isRegex = isRegex;\n\t\tthis.matchCase = matchCase;\n\t\tthis.wordSeparators = wordSeparators;\n\t}\n\n\tpublic parseSearchRequest(): SearchData | null {\n\t\tif (this.searchString === '') {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Try to create a RegExp out of the params\n\t\tlet multiline: boolean;\n\t\tif (this.isRegex) {\n\t\t\tmultiline = isMultilineRegexSource(this.searchString);\n\t\t} else {\n\t\t\tmultiline = (this.searchString.indexOf('\\n') >= 0);\n\t\t}\n\n\t\tlet regex: RegExp | null = null;\n\t\ttry {\n\t\t\tregex = strings.createRegExp(this.searchString, this.isRegex, {\n\t\t\t\tmatchCase: this.matchCase,\n\t\t\t\twholeWord: false,\n\t\t\t\tmultiline: multiline,\n\t\t\t\tglobal: true,\n\t\t\t\tunicode: true\n\t\t\t});\n\t\t} catch (err) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (!regex) {\n\t\t\treturn null;\n\t\t}\n\n\t\tlet canUseSimpleSearch = (!this.isRegex && !multiline);\n\t\tif (canUseSimpleSearch && this.searchString.toLowerCase() !== this.searchString.toUpperCase()) {\n\t\t\t// casing might make a difference\n\t\t\tcanUseSimpleSearch = this.matchCase;\n\t\t}\n\n\t\treturn new SearchData(regex, this.wordSeparators ? getMapForWordSeparators(this.wordSeparators) : null, canUseSimpleSearch ? this.searchString : null);\n\t}\n}\n\nexport function isMultilineRegexSource(searchString: string): boolean {\n\tif (!searchString || searchString.length === 0) {\n\t\treturn false;\n\t}\n\n\tfor (let i = 0, len = searchString.length; i < len; i++) {\n\t\tconst chCode = searchString.charCodeAt(i);\n\n\t\tif (chCode === CharCode.Backslash) {\n\n\t\t\t// move to next char\n\t\t\ti++;\n\n\t\t\tif (i >= len) {\n\t\t\t\t// string ends with a \\\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tconst nextChCode = searchString.charCodeAt(i);\n\t\t\tif (nextChCode === CharCode.n || nextChCode === CharCode.r || nextChCode === CharCode.W || nextChCode === CharCode.w) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn false;\n}\n\nexport class SearchData {\n\n\t/**\n\t * The regex to search for. Always defined.\n\t */\n\tpublic readonly regex: RegExp;\n\t/**\n\t * The word separator classifier.\n\t */\n\tpublic readonly wordSeparators: WordCharacterClassifier | null;\n\t/**\n\t * The simple string to search for (if possible).\n\t */\n\tpublic readonly simpleSearch: string | null;\n\n\tconstructor(regex: RegExp, wordSeparators: WordCharacterClassifier | null, simpleSearch: string | null) {\n\t\tthis.regex = regex;\n\t\tthis.wordSeparators = wordSeparators;\n\t\tthis.simpleSearch = simpleSearch;\n\t}\n}\n\nexport function createFindMatch(range: Range, rawMatches: RegExpExecArray, captureMatches: boolean): FindMatch {\n\tif (!captureMatches) {\n\t\treturn new FindMatch(range, null);\n\t}\n\tlet matches: string[] = [];\n\tfor (let i = 0, len = rawMatches.length; i < len; i++) {\n\t\tmatches[i] = rawMatches[i];\n\t}\n\treturn new FindMatch(range, matches);\n}\n\nclass LineFeedCounter {\n\n\tprivate readonly _lineFeedsOffsets: number[];\n\n\tconstructor(text: string) {\n\t\tlet lineFeedsOffsets: number[] = [];\n\t\tlet lineFeedsOffsetsLen = 0;\n\t\tfor (let i = 0, textLen = text.length; i < textLen; i++) {\n\t\t\tif (text.charCodeAt(i) === CharCode.LineFeed) {\n\t\t\t\tlineFeedsOffsets[lineFeedsOffsetsLen++] = i;\n\t\t\t}\n\t\t}\n\t\tthis._lineFeedsOffsets = lineFeedsOffsets;\n\t}\n\n\tpublic findLineFeedCountBeforeOffset(offset: number): number {\n\t\tconst lineFeedsOffsets = this._lineFeedsOffsets;\n\t\tlet min = 0;\n\t\tlet max = lineFeedsOffsets.length - 1;\n\n\t\tif (max === -1) {\n\t\t\t// no line feeds\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (offset <= lineFeedsOffsets[0]) {\n\t\t\t// before first line feed\n\t\t\treturn 0;\n\t\t}\n\n\t\twhile (min < max) {\n\t\t\tconst mid = min + ((max - min) / 2 >> 0);\n\n\t\t\tif (lineFeedsOffsets[mid] >= offset) {\n\t\t\t\tmax = mid - 1;\n\t\t\t} else {\n\t\t\t\tif (lineFeedsOffsets[mid + 1] >= offset) {\n\t\t\t\t\t// bingo!\n\t\t\t\t\tmin = mid;\n\t\t\t\t\tmax = mid;\n\t\t\t\t} else {\n\t\t\t\t\tmin = mid + 1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn min + 1;\n\t}\n}\n\nexport class TextModelSearch {\n\n\tpublic static findMatches(model: TextModel, searchParams: SearchParams, searchRange: Range, captureMatches: boolean, limitResultCount: number): FindMatch[] {\n\t\tconst searchData = searchParams.parseSearchRequest();\n\t\tif (!searchData) {\n\t\t\treturn [];\n\t\t}\n\n\t\tif (searchData.regex.multiline) {\n\t\t\treturn this._doFindMatchesMultiline(model, searchRange, new Searcher(searchData.wordSeparators, searchData.regex), captureMatches, limitResultCount);\n\t\t}\n\t\treturn this._doFindMatchesLineByLine(model, searchRange, searchData, captureMatches, limitResultCount);\n\t}\n\n\t/**\n\t * Multiline search always executes on the lines concatenated with \\n.\n\t * We must therefore compensate for the count of \\n in case the model is CRLF\n\t */\n\tprivate static _getMultilineMatchRange(model: TextModel, deltaOffset: number, text: string, lfCounter: LineFeedCounter | null, matchIndex: number, match0: string): Range {\n\t\tlet startOffset: number;\n\t\tlet lineFeedCountBeforeMatch = 0;\n\t\tif (lfCounter) {\n\t\t\tlineFeedCountBeforeMatch = lfCounter.findLineFeedCountBeforeOffset(matchIndex);\n\t\t\tstartOffset = deltaOffset + matchIndex + lineFeedCountBeforeMatch /* add as many \\r as there were \\n */;\n\t\t} else {\n\t\t\tstartOffset = deltaOffset + matchIndex;\n\t\t}\n\n\t\tlet endOffset: number;\n\t\tif (lfCounter) {\n\t\t\tlet lineFeedCountBeforeEndOfMatch = lfCounter.findLineFeedCountBeforeOffset(matchIndex + match0.length);\n\t\t\tlet lineFeedCountInMatch = lineFeedCountBeforeEndOfMatch - lineFeedCountBeforeMatch;\n\t\t\tendOffset = startOffset + match0.length + lineFeedCountInMatch /* add as many \\r as there were \\n */;\n\t\t} else {\n\t\t\tendOffset = startOffset + match0.length;\n\t\t}\n\n\t\tconst startPosition = model.getPositionAt(startOffset);\n\t\tconst endPosition = model.getPositionAt(endOffset);\n\t\treturn new Range(startPosition.lineNumber, startPosition.column, endPosition.lineNumber, endPosition.column);\n\t}\n\n\tprivate static _doFindMatchesMultiline(model: TextModel, searchRange: Range, searcher: Searcher, captureMatches: boolean, limitResultCount: number): FindMatch[] {\n\t\tconst deltaOffset = model.getOffsetAt(searchRange.getStartPosition());\n\t\t// We always execute multiline search over the lines joined with \\n\n\t\t// This makes it that \\n will match the EOL for both CRLF and LF models\n\t\t// We compensate for offset errors in `_getMultilineMatchRange`\n\t\tconst text = model.getValueInRange(searchRange, EndOfLinePreference.LF);\n\t\tconst lfCounter = (model.getEOL() === '\\r\\n' ? new LineFeedCounter(text) : null);\n\n\t\tconst result: FindMatch[] = [];\n\t\tlet counter = 0;\n\n\t\tlet m: RegExpExecArray | null;\n\t\tsearcher.reset(0);\n\t\twhile ((m = searcher.next(text))) {\n\t\t\tresult[counter++] = createFindMatch(this._getMultilineMatchRange(model, deltaOffset, text, lfCounter, m.index, m[0]), m, captureMatches);\n\t\t\tif (counter >= limitResultCount) {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate static _doFindMatchesLineByLine(model: TextModel, searchRange: Range, searchData: SearchData, captureMatches: boolean, limitResultCount: number): FindMatch[] {\n\t\tconst result: FindMatch[] = [];\n\t\tlet resultLen = 0;\n\n\t\t// Early case for a search range that starts & stops on the same line number\n\t\tif (searchRange.startLineNumber === searchRange.endLineNumber) {\n\t\t\tconst text = model.getLineContent(searchRange.startLineNumber).substring(searchRange.startColumn - 1, searchRange.endColumn - 1);\n\t\t\tresultLen = this._findMatchesInLine(searchData, text, searchRange.startLineNumber, searchRange.startColumn - 1, resultLen, result, captureMatches, limitResultCount);\n\t\t\treturn result;\n\t\t}\n\n\t\t// Collect results from first line\n\t\tconst text = model.getLineContent(searchRange.startLineNumber).substring(searchRange.startColumn - 1);\n\t\tresultLen = this._findMatchesInLine(searchData, text, searchRange.startLineNumber, searchRange.startColumn - 1, resultLen, result, captureMatches, limitResultCount);\n\n\t\t// Collect results from middle lines\n\t\tfor (let lineNumber = searchRange.startLineNumber + 1; lineNumber < searchRange.endLineNumber && resultLen < limitResultCount; lineNumber++) {\n\t\t\tresultLen = this._findMatchesInLine(searchData, model.getLineContent(lineNumber), lineNumber, 0, resultLen, result, captureMatches, limitResultCount);\n\t\t}\n\n\t\t// Collect results from last line\n\t\tif (resultLen < limitResultCount) {\n\t\t\tconst text = model.getLineContent(searchRange.endLineNumber).substring(0, searchRange.endColumn - 1);\n\t\t\tresultLen = this._findMatchesInLine(searchData, text, searchRange.endLineNumber, 0, resultLen, result, captureMatches, limitResultCount);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate static _findMatchesInLine(searchData: SearchData, text: string, lineNumber: number, deltaOffset: number, resultLen: number, result: FindMatch[], captureMatches: boolean, limitResultCount: number): number {\n\t\tconst wordSeparators = searchData.wordSeparators;\n\t\tif (!captureMatches && searchData.simpleSearch) {\n\t\t\tconst searchString = searchData.simpleSearch;\n\t\t\tconst searchStringLen = searchString.length;\n\t\t\tconst textLength = text.length;\n\n\t\t\tlet lastMatchIndex = -searchStringLen;\n\t\t\twhile ((lastMatchIndex = text.indexOf(searchString, lastMatchIndex + searchStringLen)) !== -1) {\n\t\t\t\tif (!wordSeparators || isValidMatch(wordSeparators, text, textLength, lastMatchIndex, searchStringLen)) {\n\t\t\t\t\tresult[resultLen++] = new FindMatch(new Range(lineNumber, lastMatchIndex + 1 + deltaOffset, lineNumber, lastMatchIndex + 1 + searchStringLen + deltaOffset), null);\n\t\t\t\t\tif (resultLen >= limitResultCount) {\n\t\t\t\t\t\treturn resultLen;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn resultLen;\n\t\t}\n\n\t\tconst searcher = new Searcher(searchData.wordSeparators, searchData.regex);\n\t\tlet m: RegExpExecArray | null;\n\t\t// Reset regex to search from the beginning\n\t\tsearcher.reset(0);\n\t\tdo {\n\t\t\tm = searcher.next(text);\n\t\t\tif (m) {\n\t\t\t\tresult[resultLen++] = createFindMatch(new Range(lineNumber, m.index + 1 + deltaOffset, lineNumber, m.index + 1 + m[0].length + deltaOffset), m, captureMatches);\n\t\t\t\tif (resultLen >= limitResultCount) {\n\t\t\t\t\treturn resultLen;\n\t\t\t\t}\n\t\t\t}\n\t\t} while (m);\n\t\treturn resultLen;\n\t}\n\n\tpublic static findNextMatch(model: TextModel, searchParams: SearchParams, searchStart: Position, captureMatches: boolean): FindMatch | null {\n\t\tconst searchData = searchParams.parseSearchRequest();\n\t\tif (!searchData) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst searcher = new Searcher(searchData.wordSeparators, searchData.regex);\n\n\t\tif (searchData.regex.multiline) {\n\t\t\treturn this._doFindNextMatchMultiline(model, searchStart, searcher, captureMatches);\n\t\t}\n\t\treturn this._doFindNextMatchLineByLine(model, searchStart, searcher, captureMatches);\n\t}\n\n\tprivate static _doFindNextMatchMultiline(model: TextModel, searchStart: Position, searcher: Searcher, captureMatches: boolean): FindMatch | null {\n\t\tconst searchTextStart = new Position(searchStart.lineNumber, 1);\n\t\tconst deltaOffset = model.getOffsetAt(searchTextStart);\n\t\tconst lineCount = model.getLineCount();\n\t\t// We always execute multiline search over the lines joined with \\n\n\t\t// This makes it that \\n will match the EOL for both CRLF and LF models\n\t\t// We compensate for offset errors in `_getMultilineMatchRange`\n\t\tconst text = model.getValueInRange(new Range(searchTextStart.lineNumber, searchTextStart.column, lineCount, model.getLineMaxColumn(lineCount)), EndOfLinePreference.LF);\n\t\tconst lfCounter = (model.getEOL() === '\\r\\n' ? new LineFeedCounter(text) : null);\n\t\tsearcher.reset(searchStart.column - 1);\n\t\tlet m = searcher.next(text);\n\t\tif (m) {\n\t\t\treturn createFindMatch(\n\t\t\t\tthis._getMultilineMatchRange(model, deltaOffset, text, lfCounter, m.index, m[0]),\n\t\t\t\tm,\n\t\t\t\tcaptureMatches\n\t\t\t);\n\t\t}\n\n\t\tif (searchStart.lineNumber !== 1 || searchStart.column !== 1) {\n\t\t\t// Try again from the top\n\t\t\treturn this._doFindNextMatchMultiline(model, new Position(1, 1), searcher, captureMatches);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tprivate static _doFindNextMatchLineByLine(model: TextModel, searchStart: Position, searcher: Searcher, captureMatches: boolean): FindMatch | null {\n\t\tconst lineCount = model.getLineCount();\n\t\tconst startLineNumber = searchStart.lineNumber;\n\n\t\t// Look in first line\n\t\tconst text = model.getLineContent(startLineNumber);\n\t\tconst r = this._findFirstMatchInLine(searcher, text, startLineNumber, searchStart.column, captureMatches);\n\t\tif (r) {\n\t\t\treturn r;\n\t\t}\n\n\t\tfor (let i = 1; i <= lineCount; i++) {\n\t\t\tconst lineIndex = (startLineNumber + i - 1) % lineCount;\n\t\t\tconst text = model.getLineContent(lineIndex + 1);\n\t\t\tconst r = this._findFirstMatchInLine(searcher, text, lineIndex + 1, 1, captureMatches);\n\t\t\tif (r) {\n\t\t\t\treturn r;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tprivate static _findFirstMatchInLine(searcher: Searcher, text: string, lineNumber: number, fromColumn: number, captureMatches: boolean): FindMatch | null {\n\t\t// Set regex to search from column\n\t\tsearcher.reset(fromColumn - 1);\n\t\tconst m: RegExpExecArray | null = searcher.next(text);\n\t\tif (m) {\n\t\t\treturn createFindMatch(\n\t\t\t\tnew Range(lineNumber, m.index + 1, lineNumber, m.index + 1 + m[0].length),\n\t\t\t\tm,\n\t\t\t\tcaptureMatches\n\t\t\t);\n\t\t}\n\t\treturn null;\n\t}\n\n\tpublic static findPreviousMatch(model: TextModel, searchParams: SearchParams, searchStart: Position, captureMatches: boolean): FindMatch | null {\n\t\tconst searchData = searchParams.parseSearchRequest();\n\t\tif (!searchData) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst searcher = new Searcher(searchData.wordSeparators, searchData.regex);\n\n\t\tif (searchData.regex.multiline) {\n\t\t\treturn this._doFindPreviousMatchMultiline(model, searchStart, searcher, captureMatches);\n\t\t}\n\t\treturn this._doFindPreviousMatchLineByLine(model, searchStart, searcher, captureMatches);\n\t}\n\n\tprivate static _doFindPreviousMatchMultiline(model: TextModel, searchStart: Position, searcher: Searcher, captureMatches: boolean): FindMatch | null {\n\t\tconst matches = this._doFindMatchesMultiline(model, new Range(1, 1, searchStart.lineNumber, searchStart.column), searcher, captureMatches, 10 * LIMIT_FIND_COUNT);\n\t\tif (matches.length > 0) {\n\t\t\treturn matches[matches.length - 1];\n\t\t}\n\n\t\tconst lineCount = model.getLineCount();\n\t\tif (searchStart.lineNumber !== lineCount || searchStart.column !== model.getLineMaxColumn(lineCount)) {\n\t\t\t// Try again with all content\n\t\t\treturn this._doFindPreviousMatchMultiline(model, new Position(lineCount, model.getLineMaxColumn(lineCount)), searcher, captureMatches);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tprivate static _doFindPreviousMatchLineByLine(model: TextModel, searchStart: Position, searcher: Searcher, captureMatches: boolean): FindMatch | null {\n\t\tconst lineCount = model.getLineCount();\n\t\tconst startLineNumber = searchStart.lineNumber;\n\n\t\t// Look in first line\n\t\tconst text = model.getLineContent(startLineNumber).substring(0, searchStart.column - 1);\n\t\tconst r = this._findLastMatchInLine(searcher, text, startLineNumber, captureMatches);\n\t\tif (r) {\n\t\t\treturn r;\n\t\t}\n\n\t\tfor (let i = 1; i <= lineCount; i++) {\n\t\t\tconst lineIndex = (lineCount + startLineNumber - i - 1) % lineCount;\n\t\t\tconst text = model.getLineContent(lineIndex + 1);\n\t\t\tconst r = this._findLastMatchInLine(searcher, text, lineIndex + 1, captureMatches);\n\t\t\tif (r) {\n\t\t\t\treturn r;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tprivate static _findLastMatchInLine(searcher: Searcher, text: string, lineNumber: number, captureMatches: boolean): FindMatch | null {\n\t\tlet bestResult: FindMatch | null = null;\n\t\tlet m: RegExpExecArray | null;\n\t\tsearcher.reset(0);\n\t\twhile ((m = searcher.next(text))) {\n\t\t\tbestResult = createFindMatch(new Range(lineNumber, m.index + 1, lineNumber, m.index + 1 + m[0].length), m, captureMatches);\n\t\t}\n\t\treturn bestResult;\n\t}\n}\n\nfunction leftIsWordBounday(wordSeparators: WordCharacterClassifier, text: string, textLength: number, matchStartIndex: number, matchLength: number): boolean {\n\tif (matchStartIndex === 0) {\n\t\t// Match starts at start of string\n\t\treturn true;\n\t}\n\n\tconst charBefore = text.charCodeAt(matchStartIndex - 1);\n\tif (wordSeparators.get(charBefore) !== WordCharacterClass.Regular) {\n\t\t// The character before the match is a word separator\n\t\treturn true;\n\t}\n\n\tif (charBefore === CharCode.CarriageReturn || charBefore === CharCode.LineFeed) {\n\t\t// The character before the match is line break or carriage return.\n\t\treturn true;\n\t}\n\n\tif (matchLength > 0) {\n\t\tconst firstCharInMatch = text.charCodeAt(matchStartIndex);\n\t\tif (wordSeparators.get(firstCharInMatch) !== WordCharacterClass.Regular) {\n\t\t\t// The first character inside the match is a word separator\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}\n\nfunction rightIsWordBounday(wordSeparators: WordCharacterClassifier, text: string, textLength: number, matchStartIndex: number, matchLength: number): boolean {\n\tif (matchStartIndex + matchLength === textLength) {\n\t\t// Match ends at end of string\n\t\treturn true;\n\t}\n\n\tconst charAfter = text.charCodeAt(matchStartIndex + matchLength);\n\tif (wordSeparators.get(charAfter) !== WordCharacterClass.Regular) {\n\t\t// The character after the match is a word separator\n\t\treturn true;\n\t}\n\n\tif (charAfter === CharCode.CarriageReturn || charAfter === CharCode.LineFeed) {\n\t\t// The character after the match is line break or carriage return.\n\t\treturn true;\n\t}\n\n\tif (matchLength > 0) {\n\t\tconst lastCharInMatch = text.charCodeAt(matchStartIndex + matchLength - 1);\n\t\tif (wordSeparators.get(lastCharInMatch) !== WordCharacterClass.Regular) {\n\t\t\t// The last character in the match is a word separator\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}\n\nexport function isValidMatch(wordSeparators: WordCharacterClassifier, text: string, textLength: number, matchStartIndex: number, matchLength: number): boolean {\n\treturn (\n\t\tleftIsWordBounday(wordSeparators, text, textLength, matchStartIndex, matchLength)\n\t\t&& rightIsWordBounday(wordSeparators, text, textLength, matchStartIndex, matchLength)\n\t);\n}\n\nexport class Searcher {\n\tpublic readonly _wordSeparators: WordCharacterClassifier | null;\n\tprivate readonly _searchRegex: RegExp;\n\tprivate _prevMatchStartIndex: number;\n\tprivate _prevMatchLength: number;\n\n\tconstructor(wordSeparators: WordCharacterClassifier | null, searchRegex: RegExp,) {\n\t\tthis._wordSeparators = wordSeparators;\n\t\tthis._searchRegex = searchRegex;\n\t\tthis._prevMatchStartIndex = -1;\n\t\tthis._prevMatchLength = 0;\n\t}\n\n\tpublic reset(lastIndex: number): void {\n\t\tthis._searchRegex.lastIndex = lastIndex;\n\t\tthis._prevMatchStartIndex = -1;\n\t\tthis._prevMatchLength = 0;\n\t}\n\n\tpublic next(text: string): RegExpExecArray | null {\n\t\tconst textLength = text.length;\n\n\t\tlet m: RegExpExecArray | null;\n\t\tdo {\n\t\t\tif (this._prevMatchStartIndex + this._prevMatchLength === textLength) {\n\t\t\t\t// Reached the end of the line\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tm = this._searchRegex.exec(text);\n\t\t\tif (!m) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst matchStartIndex = m.index;\n\t\t\tconst matchLength = m[0].length;\n\t\t\tif (matchStartIndex === this._prevMatchStartIndex && matchLength === this._prevMatchLength) {\n\t\t\t\tif (matchLength === 0) {\n\t\t\t\t\t// the search result is an empty string and won't advance `regex.lastIndex`, so `regex.exec` will stuck here\n\t\t\t\t\t// we attempt to recover from that by advancing by two if surrogate pair found and by one otherwise\n\t\t\t\t\tif (strings.getNextCodePoint(text, textLength, this._searchRegex.lastIndex) > 0xFFFF) {\n\t\t\t\t\t\tthis._searchRegex.lastIndex += 2;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._searchRegex.lastIndex += 1;\n\t\t\t\t\t}\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\t// Exit early if the regex matches the same range twice\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tthis._prevMatchStartIndex = matchStartIndex;\n\t\t\tthis._prevMatchLength = matchLength;\n\n\t\t\tif (!this._wordSeparators || isValidMatch(this._wordSeparators, text, textLength, matchStartIndex, matchLength)) {\n\t\t\t\treturn m;\n\t\t\t}\n\n\t\t} while (m);\n\n\t\treturn null;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IWordAtPosition } from 'vs/editor/common/model';\n\nexport const USUAL_WORD_SEPARATORS = '`~!@#$%^&*()-=+[{]}\\\\|;:\\'\",.<>/?';\n\n/**\n * Create a word definition regular expression based on default word separators.\n * Optionally provide allowed separators that should be included in words.\n *\n * The default would look like this:\n * /(-?\\d*\\.\\d\\w*)|([^\\`\\~\\!\\@\\#\\$\\%\\^\\&\\*\\(\\)\\-\\=\\+\\[\\{\\]\\}\\\\\\|\\;\\:\\'\\\"\\,\\.\\<\\>\\/\\?\\s]+)/g\n */\nfunction createWordRegExp(allowInWords: string = ''): RegExp {\n\tlet source = '(-?\\\\d*\\\\.\\\\d\\\\w*)|([^';\n\tfor (const sep of USUAL_WORD_SEPARATORS) {\n\t\tif (allowInWords.indexOf(sep) >= 0) {\n\t\t\tcontinue;\n\t\t}\n\t\tsource += '\\\\' + sep;\n\t}\n\tsource += '\\\\s]+)';\n\treturn new RegExp(source, 'g');\n}\n\n// catches numbers (including floating numbers) in the first group, and alphanum in the second\nexport const DEFAULT_WORD_REGEXP = createWordRegExp();\n\nexport function ensureValidWordDefinition(wordDefinition?: RegExp | null): RegExp {\n\tlet result: RegExp = DEFAULT_WORD_REGEXP;\n\n\tif (wordDefinition && (wordDefinition instanceof RegExp)) {\n\t\tif (!wordDefinition.global) {\n\t\t\tlet flags = 'g';\n\t\t\tif (wordDefinition.ignoreCase) {\n\t\t\t\tflags += 'i';\n\t\t\t}\n\t\t\tif (wordDefinition.multiline) {\n\t\t\t\tflags += 'm';\n\t\t\t}\n\t\t\tif ((wordDefinition as any).unicode) {\n\t\t\t\tflags += 'u';\n\t\t\t}\n\t\t\tresult = new RegExp(wordDefinition.source, flags);\n\t\t} else {\n\t\t\tresult = wordDefinition;\n\t\t}\n\t}\n\n\tresult.lastIndex = 0;\n\n\treturn result;\n}\n\nconst _defaultConfig = {\n\tmaxLen: 1000,\n\twindowSize: 15,\n\ttimeBudget: 150\n};\n\nexport function getWordAtText(column: number, wordDefinition: RegExp, text: string, textOffset: number, config = _defaultConfig): IWordAtPosition | null {\n\n\tif (text.length > config.maxLen) {\n\t\t// don't throw strings that long at the regexp\n\t\t// but use a sub-string in which a word must occur\n\t\tlet start = column - config.maxLen / 2;\n\t\tif (start < 0) {\n\t\t\tstart = 0;\n\t\t} else {\n\t\t\ttextOffset += start;\n\t\t}\n\t\ttext = text.substring(start, column + config.maxLen / 2);\n\t\treturn getWordAtText(column, wordDefinition, text, textOffset, config);\n\t}\n\n\tconst t1 = Date.now();\n\tconst pos = column - 1 - textOffset;\n\n\tlet prevRegexIndex = -1;\n\tlet match: RegExpMatchArray | null = null;\n\n\tfor (let i = 1; ; i++) {\n\t\t// check time budget\n\t\tif (Date.now() - t1 >= config.timeBudget) {\n\t\t\tbreak;\n\t\t}\n\n\t\t// reset the index at which the regexp should start matching, also know where it\n\t\t// should stop so that subsequent search don't repeat previous searches\n\t\tconst regexIndex = pos - config.windowSize * i;\n\t\twordDefinition.lastIndex = Math.max(0, regexIndex);\n\t\tconst thisMatch = _findRegexMatchEnclosingPosition(wordDefinition, text, pos, prevRegexIndex);\n\n\t\tif (!thisMatch && match) {\n\t\t\t// stop: we have something\n\t\t\tbreak;\n\t\t}\n\n\t\tmatch = thisMatch;\n\n\t\t// stop: searched at start\n\t\tif (regexIndex <= 0) {\n\t\t\tbreak;\n\t\t}\n\t\tprevRegexIndex = regexIndex;\n\t}\n\n\tif (match) {\n\t\tlet result = {\n\t\t\tword: match[0],\n\t\t\tstartColumn: textOffset + 1 + match.index!,\n\t\t\tendColumn: textOffset + 1 + match.index! + match[0].length\n\t\t};\n\t\twordDefinition.lastIndex = 0;\n\t\treturn result;\n\t}\n\n\treturn null;\n}\n\nfunction _findRegexMatchEnclosingPosition(wordDefinition: RegExp, text: string, pos: number, stopPos: number): RegExpMatchArray | null {\n\tlet match: RegExpMatchArray | null;\n\twhile (match = wordDefinition.exec(text)) {\n\t\tconst matchIndex = match.index || 0;\n\t\tif (matchIndex <= pos && wordDefinition.lastIndex >= pos) {\n\t\t\treturn match;\n\t\t} else if (stopPos > 0 && matchIndex > stopPos) {\n\t\t\treturn null;\n\t\t}\n\t}\n\treturn null;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { StandardTokenType } from 'vs/editor/common/modes';\n\n/**\n * Describes how comments for a language work.\n */\nexport interface CommentRule {\n\t/**\n\t * The line comment token, like `// this is a comment`\n\t */\n\tlineComment?: string | null;\n\t/**\n\t * The block comment character pair, like `/* block comment *&#47;`\n\t */\n\tblockComment?: CharacterPair | null;\n}\n\n/**\n * The language configuration interface defines the contract between extensions and\n * various editor features, like automatic bracket insertion, automatic indentation etc.\n */\nexport interface LanguageConfiguration {\n\t/**\n\t * The language's comment settings.\n\t */\n\tcomments?: CommentRule;\n\t/**\n\t * The language's brackets.\n\t * This configuration implicitly affects pressing Enter around these brackets.\n\t */\n\tbrackets?: CharacterPair[];\n\t/**\n\t * The language's word definition.\n\t * If the language supports Unicode identifiers (e.g. JavaScript), it is preferable\n\t * to provide a word definition that uses exclusion of known separators.\n\t * e.g.: A regex that matches anything except known separators (and dot is allowed to occur in a floating point number):\n\t *   /(-?\\d*\\.\\d\\w*)|([^\\`\\~\\!\\@\\#\\%\\^\\&\\*\\(\\)\\-\\=\\+\\[\\{\\]\\}\\\\\\|\\;\\:\\'\\\"\\,\\.\\<\\>\\/\\?\\s]+)/g\n\t */\n\twordPattern?: RegExp;\n\t/**\n\t * The language's indentation settings.\n\t */\n\tindentationRules?: IndentationRule;\n\t/**\n\t * The language's rules to be evaluated when pressing Enter.\n\t */\n\tonEnterRules?: OnEnterRule[];\n\t/**\n\t * The language's auto closing pairs. The 'close' character is automatically inserted with the\n\t * 'open' character is typed. If not set, the configured brackets will be used.\n\t */\n\tautoClosingPairs?: IAutoClosingPairConditional[];\n\t/**\n\t * The language's surrounding pairs. When the 'open' character is typed on a selection, the\n\t * selected string is surrounded by the open and close characters. If not set, the autoclosing pairs\n\t * settings will be used.\n\t */\n\tsurroundingPairs?: IAutoClosingPair[];\n\n\t/**\n\t * Defines what characters must be after the cursor for bracket or quote autoclosing to occur when using the \\'languageDefined\\' autoclosing setting.\n\t *\n\t * This is typically the set of characters which can not start an expression, such as whitespace, closing brackets, non-unary operators, etc.\n\t */\n\tautoCloseBefore?: string;\n\n\t/**\n\t * The language's folding rules.\n\t */\n\tfolding?: FoldingRules;\n\n\t/**\n\t * **Deprecated** Do not use.\n\t *\n\t * @deprecated Will be replaced by a better API soon.\n\t */\n\t__electricCharacterSupport?: {\n\t\tdocComment?: IDocComment;\n\t};\n}\n\n/**\n * Describes indentation rules for a language.\n */\nexport interface IndentationRule {\n\t/**\n\t * If a line matches this pattern, then all the lines after it should be unindented once (until another rule matches).\n\t */\n\tdecreaseIndentPattern: RegExp;\n\t/**\n\t * If a line matches this pattern, then all the lines after it should be indented once (until another rule matches).\n\t */\n\tincreaseIndentPattern: RegExp;\n\t/**\n\t * If a line matches this pattern, then **only the next line** after it should be indented once.\n\t */\n\tindentNextLinePattern?: RegExp | null;\n\t/**\n\t * If a line matches this pattern, then its indentation should not be changed and it should not be evaluated against the other rules.\n\t */\n\tunIndentedLinePattern?: RegExp | null;\n\n}\n\n/**\n * Describes language specific folding markers such as '#region' and '#endregion'.\n * The start and end regexes will be tested against the contents of all lines and must be designed efficiently:\n * - the regex should start with '^'\n * - regexp flags (i, g) are ignored\n */\nexport interface FoldingMarkers {\n\tstart: RegExp;\n\tend: RegExp;\n}\n\n/**\n * Describes folding rules for a language.\n */\nexport interface FoldingRules {\n\t/**\n\t * Used by the indentation based strategy to decide whether empty lines belong to the previous or the next block.\n\t * A language adheres to the off-side rule if blocks in that language are expressed by their indentation.\n\t * See [wikipedia](https://en.wikipedia.org/wiki/Off-side_rule) for more information.\n\t * If not set, `false` is used and empty lines belong to the previous block.\n\t */\n\toffSide?: boolean;\n\n\t/**\n\t * Region markers used by the language.\n\t */\n\tmarkers?: FoldingMarkers;\n}\n\n/**\n * Describes a rule to be evaluated when pressing Enter.\n */\nexport interface OnEnterRule {\n\t/**\n\t * This rule will only execute if the text before the cursor matches this regular expression.\n\t */\n\tbeforeText: RegExp;\n\t/**\n\t * This rule will only execute if the text after the cursor matches this regular expression.\n\t */\n\tafterText?: RegExp;\n\t/**\n\t * This rule will only execute if the text above the this line matches this regular expression.\n\t */\n\tpreviousLineText?: RegExp;\n\t/**\n\t * The action to execute.\n\t */\n\taction: EnterAction;\n}\n\n/**\n * Definition of documentation comments (e.g. Javadoc/JSdoc)\n */\nexport interface IDocComment {\n\t/**\n\t * The string that starts a doc comment (e.g. '/**')\n\t */\n\topen: string;\n\t/**\n\t * The string that appears on the last line and closes the doc comment (e.g. ' * /').\n\t */\n\tclose?: string;\n}\n\n/**\n * A tuple of two characters, like a pair of\n * opening and closing brackets.\n */\nexport type CharacterPair = [string, string];\n\nexport interface IAutoClosingPair {\n\topen: string;\n\tclose: string;\n}\n\nexport interface IAutoClosingPairConditional extends IAutoClosingPair {\n\tnotIn?: string[];\n}\n\n/**\n * Describes what to do with the indentation when pressing Enter.\n */\nexport enum IndentAction {\n\t/**\n\t * Insert new line and copy the previous line's indentation.\n\t */\n\tNone = 0,\n\t/**\n\t * Insert new line and indent once (relative to the previous line's indentation).\n\t */\n\tIndent = 1,\n\t/**\n\t * Insert two new lines:\n\t *  - the first one indented which will hold the cursor\n\t *  - the second one at the same indentation level\n\t */\n\tIndentOutdent = 2,\n\t/**\n\t * Insert new line and outdent once (relative to the previous line's indentation).\n\t */\n\tOutdent = 3\n}\n\n/**\n * Describes what to do when pressing Enter.\n */\nexport interface EnterAction {\n\t/**\n\t * Describe what to do with the indentation.\n\t */\n\tindentAction: IndentAction;\n\t/**\n\t * Describes text to be appended after the new line and after the indentation.\n\t */\n\tappendText?: string;\n\t/**\n\t * Describes the number of characters to remove from the new line's indentation.\n\t */\n\tremoveText?: number;\n}\n\n/**\n * @internal\n */\nexport interface CompleteEnterAction {\n\t/**\n\t * Describe what to do with the indentation.\n\t */\n\tindentAction: IndentAction;\n\t/**\n\t * Describes text to be appended after the new line and after the indentation.\n\t */\n\tappendText: string;\n\t/**\n\t * Describes the number of characters to remove from the new line's indentation.\n\t */\n\tremoveText: number;\n\t/**\n\t * The line's indentation minus removeText\n\t */\n\tindentation: string;\n}\n\n/**\n * @internal\n */\nexport class StandardAutoClosingPairConditional {\n\t_standardAutoClosingPairConditionalBrand: void;\n\n\treadonly open: string;\n\treadonly close: string;\n\tprivate readonly _standardTokenMask: number;\n\n\tconstructor(source: IAutoClosingPairConditional) {\n\t\tthis.open = source.open;\n\t\tthis.close = source.close;\n\n\t\t// initially allowed in all tokens\n\t\tthis._standardTokenMask = 0;\n\n\t\tif (Array.isArray(source.notIn)) {\n\t\t\tfor (let i = 0, len = source.notIn.length; i < len; i++) {\n\t\t\t\tconst notIn: string = source.notIn[i];\n\t\t\t\tswitch (notIn) {\n\t\t\t\t\tcase 'string':\n\t\t\t\t\t\tthis._standardTokenMask |= StandardTokenType.String;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'comment':\n\t\t\t\t\t\tthis._standardTokenMask |= StandardTokenType.Comment;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'regex':\n\t\t\t\t\t\tthis._standardTokenMask |= StandardTokenType.RegEx;\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic isOK(standardToken: StandardTokenType): boolean {\n\t\treturn (this._standardTokenMask & <number>standardToken) === 0;\n\t}\n}\n\n/**\n * @internal\n */\nexport class AutoClosingPairs {\n\t// it is useful to be able to get pairs using either end of open and close\n\n\t/** Key is first character of open */\n\tpublic readonly autoClosingPairsOpenByStart: Map<string, StandardAutoClosingPairConditional[]>;\n\t/** Key is last character of open */\n\tpublic readonly autoClosingPairsOpenByEnd: Map<string, StandardAutoClosingPairConditional[]>;\n\t/** Key is first character of close */\n\tpublic readonly autoClosingPairsCloseByStart: Map<string, StandardAutoClosingPairConditional[]>;\n\t/** Key is last character of close */\n\tpublic readonly autoClosingPairsCloseByEnd: Map<string, StandardAutoClosingPairConditional[]>;\n\t/** Key is close. Only has pairs that are a single character */\n\tpublic readonly autoClosingPairsCloseSingleChar: Map<string, StandardAutoClosingPairConditional[]>;\n\n\tconstructor(autoClosingPairs: StandardAutoClosingPairConditional[]) {\n\t\tthis.autoClosingPairsOpenByStart = new Map<string, StandardAutoClosingPairConditional[]>();\n\t\tthis.autoClosingPairsOpenByEnd = new Map<string, StandardAutoClosingPairConditional[]>();\n\t\tthis.autoClosingPairsCloseByStart = new Map<string, StandardAutoClosingPairConditional[]>();\n\t\tthis.autoClosingPairsCloseByEnd = new Map<string, StandardAutoClosingPairConditional[]>();\n\t\tthis.autoClosingPairsCloseSingleChar = new Map<string, StandardAutoClosingPairConditional[]>();\n\t\tfor (const pair of autoClosingPairs) {\n\t\t\tappendEntry(this.autoClosingPairsOpenByStart, pair.open.charAt(0), pair);\n\t\t\tappendEntry(this.autoClosingPairsOpenByEnd, pair.open.charAt(pair.open.length - 1), pair);\n\t\t\tappendEntry(this.autoClosingPairsCloseByStart, pair.close.charAt(0), pair);\n\t\t\tappendEntry(this.autoClosingPairsCloseByEnd, pair.close.charAt(pair.close.length - 1), pair);\n\t\t\tif (pair.close.length === 1 && pair.open.length === 1) {\n\t\t\t\tappendEntry(this.autoClosingPairsCloseSingleChar, pair.close, pair);\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction appendEntry<K, V>(target: Map<K, V[]>, key: K, value: V): void {\n\tif (target.has(key)) {\n\t\ttarget.get(key)!.push(value);\n\t} else {\n\t\ttarget.set(key, [value]);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IRelativePattern, match as matchGlobPattern } from 'vs/base/common/glob';\nimport { URI } from 'vs/base/common/uri'; // TODO@Alex\nimport { normalize } from 'vs/base/common/path';\n\nexport interface LanguageFilter {\n\treadonly language?: string;\n\treadonly scheme?: string;\n\treadonly pattern?: string | IRelativePattern;\n\t/**\n\t * This provider is implemented in the UI thread.\n\t */\n\treadonly hasAccessToAllModels?: boolean;\n\treadonly exclusive?: boolean;\n}\n\nexport type LanguageSelector = string | LanguageFilter | ReadonlyArray<string | LanguageFilter>;\n\nexport function score(selector: LanguageSelector | undefined, candidateUri: URI, candidateLanguage: string, candidateIsSynchronized: boolean): number {\n\n\tif (Array.isArray(selector)) {\n\t\t// array -> take max individual value\n\t\tlet ret = 0;\n\t\tfor (const filter of selector) {\n\t\t\tconst value = score(filter, candidateUri, candidateLanguage, candidateIsSynchronized);\n\t\t\tif (value === 10) {\n\t\t\t\treturn value; // already at the highest\n\t\t\t}\n\t\t\tif (value > ret) {\n\t\t\t\tret = value;\n\t\t\t}\n\t\t}\n\t\treturn ret;\n\n\t} else if (typeof selector === 'string') {\n\n\t\tif (!candidateIsSynchronized) {\n\t\t\treturn 0;\n\t\t}\n\n\t\t// short-hand notion, desugars to\n\t\t// 'fooLang' -> { language: 'fooLang'}\n\t\t// '*' -> { language: '*' }\n\t\tif (selector === '*') {\n\t\t\treturn 5;\n\t\t} else if (selector === candidateLanguage) {\n\t\t\treturn 10;\n\t\t} else {\n\t\t\treturn 0;\n\t\t}\n\n\t} else if (selector) {\n\t\t// filter -> select accordingly, use defaults for scheme\n\t\tconst { language, pattern, scheme, hasAccessToAllModels } = selector;\n\n\t\tif (!candidateIsSynchronized && !hasAccessToAllModels) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tlet ret = 0;\n\n\t\tif (scheme) {\n\t\t\tif (scheme === candidateUri.scheme) {\n\t\t\t\tret = 10;\n\t\t\t} else if (scheme === '*') {\n\t\t\t\tret = 5;\n\t\t\t} else {\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\n\t\tif (language) {\n\t\t\tif (language === candidateLanguage) {\n\t\t\t\tret = 10;\n\t\t\t} else if (language === '*') {\n\t\t\t\tret = Math.max(ret, 5);\n\t\t\t} else {\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\n\t\tif (pattern) {\n\t\t\tlet normalizedPattern: string | IRelativePattern;\n\t\t\tif (typeof pattern === 'string') {\n\t\t\t\tnormalizedPattern = pattern;\n\t\t\t} else {\n\t\t\t\t// Since this pattern has a `base` property, we need\n\t\t\t\t// to normalize this path first before passing it on\n\t\t\t\t// because we will compare it against `Uri.fsPath`\n\t\t\t\t// which uses platform specific separators.\n\t\t\t\t// Refs: https://github.com/microsoft/vscode/issues/99938\n\t\t\t\tnormalizedPattern = { ...pattern, base: normalize(pattern.base) };\n\t\t\t}\n\n\t\t\tif (normalizedPattern === candidateUri.fsPath || matchGlobPattern(normalizedPattern, candidateUri.fsPath)) {\n\t\t\t\tret = 10;\n\t\t\t} else {\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\n\t\treturn ret;\n\n\t} else {\n\t\treturn 0;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CharCode } from 'vs/base/common/charCode';\nimport { CharacterClassifier } from 'vs/editor/common/core/characterClassifier';\nimport { ILink } from 'vs/editor/common/modes';\n\nexport interface ILinkComputerTarget {\n\tgetLineCount(): number;\n\tgetLineContent(lineNumber: number): string;\n}\n\nexport const enum State {\n\tInvalid = 0,\n\tStart = 1,\n\tH = 2,\n\tHT = 3,\n\tHTT = 4,\n\tHTTP = 5,\n\tF = 6,\n\tFI = 7,\n\tFIL = 8,\n\tBeforeColon = 9,\n\tAfterColon = 10,\n\tAlmostThere = 11,\n\tEnd = 12,\n\tAccept = 13,\n\tLastKnownState = 14 // marker, custom states may follow\n}\n\nexport type Edge = [State, number, State];\n\nexport class Uint8Matrix {\n\n\tprivate readonly _data: Uint8Array;\n\tpublic readonly rows: number;\n\tpublic readonly cols: number;\n\n\tconstructor(rows: number, cols: number, defaultValue: number) {\n\t\tconst data = new Uint8Array(rows * cols);\n\t\tfor (let i = 0, len = rows * cols; i < len; i++) {\n\t\t\tdata[i] = defaultValue;\n\t\t}\n\n\t\tthis._data = data;\n\t\tthis.rows = rows;\n\t\tthis.cols = cols;\n\t}\n\n\tpublic get(row: number, col: number): number {\n\t\treturn this._data[row * this.cols + col];\n\t}\n\n\tpublic set(row: number, col: number, value: number): void {\n\t\tthis._data[row * this.cols + col] = value;\n\t}\n}\n\nexport class StateMachine {\n\n\tprivate readonly _states: Uint8Matrix;\n\tprivate readonly _maxCharCode: number;\n\n\tconstructor(edges: Edge[]) {\n\t\tlet maxCharCode = 0;\n\t\tlet maxState = State.Invalid;\n\t\tfor (let i = 0, len = edges.length; i < len; i++) {\n\t\t\tlet [from, chCode, to] = edges[i];\n\t\t\tif (chCode > maxCharCode) {\n\t\t\t\tmaxCharCode = chCode;\n\t\t\t}\n\t\t\tif (from > maxState) {\n\t\t\t\tmaxState = from;\n\t\t\t}\n\t\t\tif (to > maxState) {\n\t\t\t\tmaxState = to;\n\t\t\t}\n\t\t}\n\n\t\tmaxCharCode++;\n\t\tmaxState++;\n\n\t\tlet states = new Uint8Matrix(maxState, maxCharCode, State.Invalid);\n\t\tfor (let i = 0, len = edges.length; i < len; i++) {\n\t\t\tlet [from, chCode, to] = edges[i];\n\t\t\tstates.set(from, chCode, to);\n\t\t}\n\n\t\tthis._states = states;\n\t\tthis._maxCharCode = maxCharCode;\n\t}\n\n\tpublic nextState(currentState: State, chCode: number): State {\n\t\tif (chCode < 0 || chCode >= this._maxCharCode) {\n\t\t\treturn State.Invalid;\n\t\t}\n\t\treturn this._states.get(currentState, chCode);\n\t}\n}\n\n// State machine for http:// or https:// or file://\nlet _stateMachine: StateMachine | null = null;\nfunction getStateMachine(): StateMachine {\n\tif (_stateMachine === null) {\n\t\t_stateMachine = new StateMachine([\n\t\t\t[State.Start, CharCode.h, State.H],\n\t\t\t[State.Start, CharCode.H, State.H],\n\t\t\t[State.Start, CharCode.f, State.F],\n\t\t\t[State.Start, CharCode.F, State.F],\n\n\t\t\t[State.H, CharCode.t, State.HT],\n\t\t\t[State.H, CharCode.T, State.HT],\n\n\t\t\t[State.HT, CharCode.t, State.HTT],\n\t\t\t[State.HT, CharCode.T, State.HTT],\n\n\t\t\t[State.HTT, CharCode.p, State.HTTP],\n\t\t\t[State.HTT, CharCode.P, State.HTTP],\n\n\t\t\t[State.HTTP, CharCode.s, State.BeforeColon],\n\t\t\t[State.HTTP, CharCode.S, State.BeforeColon],\n\t\t\t[State.HTTP, CharCode.Colon, State.AfterColon],\n\n\t\t\t[State.F, CharCode.i, State.FI],\n\t\t\t[State.F, CharCode.I, State.FI],\n\n\t\t\t[State.FI, CharCode.l, State.FIL],\n\t\t\t[State.FI, CharCode.L, State.FIL],\n\n\t\t\t[State.FIL, CharCode.e, State.BeforeColon],\n\t\t\t[State.FIL, CharCode.E, State.BeforeColon],\n\n\t\t\t[State.BeforeColon, CharCode.Colon, State.AfterColon],\n\n\t\t\t[State.AfterColon, CharCode.Slash, State.AlmostThere],\n\n\t\t\t[State.AlmostThere, CharCode.Slash, State.End],\n\t\t]);\n\t}\n\treturn _stateMachine;\n}\n\n\nconst enum CharacterClass {\n\tNone = 0,\n\tForceTermination = 1,\n\tCannotEndIn = 2\n}\n\nlet _classifier: CharacterClassifier<CharacterClass> | null = null;\nfunction getClassifier(): CharacterClassifier<CharacterClass> {\n\tif (_classifier === null) {\n\t\t_classifier = new CharacterClassifier<CharacterClass>(CharacterClass.None);\n\n\t\tconst FORCE_TERMINATION_CHARACTERS = ' \\t<>\\'\\\"、。｡､，．：；‘“〈《「『【〔（［｛｢｣｝］）〕】』」》〉”’｀～…';\n\t\tfor (let i = 0; i < FORCE_TERMINATION_CHARACTERS.length; i++) {\n\t\t\t_classifier.set(FORCE_TERMINATION_CHARACTERS.charCodeAt(i), CharacterClass.ForceTermination);\n\t\t}\n\n\t\tconst CANNOT_END_WITH_CHARACTERS = '.,;';\n\t\tfor (let i = 0; i < CANNOT_END_WITH_CHARACTERS.length; i++) {\n\t\t\t_classifier.set(CANNOT_END_WITH_CHARACTERS.charCodeAt(i), CharacterClass.CannotEndIn);\n\t\t}\n\t}\n\treturn _classifier;\n}\n\nexport class LinkComputer {\n\n\tprivate static _createLink(classifier: CharacterClassifier<CharacterClass>, line: string, lineNumber: number, linkBeginIndex: number, linkEndIndex: number): ILink {\n\t\t// Do not allow to end link in certain characters...\n\t\tlet lastIncludedCharIndex = linkEndIndex - 1;\n\t\tdo {\n\t\t\tconst chCode = line.charCodeAt(lastIncludedCharIndex);\n\t\t\tconst chClass = classifier.get(chCode);\n\t\t\tif (chClass !== CharacterClass.CannotEndIn) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tlastIncludedCharIndex--;\n\t\t} while (lastIncludedCharIndex > linkBeginIndex);\n\n\t\t// Handle links enclosed in parens, square brackets and curlys.\n\t\tif (linkBeginIndex > 0) {\n\t\t\tconst charCodeBeforeLink = line.charCodeAt(linkBeginIndex - 1);\n\t\t\tconst lastCharCodeInLink = line.charCodeAt(lastIncludedCharIndex);\n\n\t\t\tif (\n\t\t\t\t(charCodeBeforeLink === CharCode.OpenParen && lastCharCodeInLink === CharCode.CloseParen)\n\t\t\t\t|| (charCodeBeforeLink === CharCode.OpenSquareBracket && lastCharCodeInLink === CharCode.CloseSquareBracket)\n\t\t\t\t|| (charCodeBeforeLink === CharCode.OpenCurlyBrace && lastCharCodeInLink === CharCode.CloseCurlyBrace)\n\t\t\t) {\n\t\t\t\t// Do not end in ) if ( is before the link start\n\t\t\t\t// Do not end in ] if [ is before the link start\n\t\t\t\t// Do not end in } if { is before the link start\n\t\t\t\tlastIncludedCharIndex--;\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\trange: {\n\t\t\t\tstartLineNumber: lineNumber,\n\t\t\t\tstartColumn: linkBeginIndex + 1,\n\t\t\t\tendLineNumber: lineNumber,\n\t\t\t\tendColumn: lastIncludedCharIndex + 2\n\t\t\t},\n\t\t\turl: line.substring(linkBeginIndex, lastIncludedCharIndex + 1)\n\t\t};\n\t}\n\n\tpublic static computeLinks(model: ILinkComputerTarget, stateMachine: StateMachine = getStateMachine()): ILink[] {\n\t\tconst classifier = getClassifier();\n\n\t\tlet result: ILink[] = [];\n\t\tfor (let i = 1, lineCount = model.getLineCount(); i <= lineCount; i++) {\n\t\t\tconst line = model.getLineContent(i);\n\t\t\tconst len = line.length;\n\n\t\t\tlet j = 0;\n\t\t\tlet linkBeginIndex = 0;\n\t\t\tlet linkBeginChCode = 0;\n\t\t\tlet state = State.Start;\n\t\t\tlet hasOpenParens = false;\n\t\t\tlet hasOpenSquareBracket = false;\n\t\t\tlet inSquareBrackets = false;\n\t\t\tlet hasOpenCurlyBracket = false;\n\n\t\t\twhile (j < len) {\n\n\t\t\t\tlet resetStateMachine = false;\n\t\t\t\tconst chCode = line.charCodeAt(j);\n\n\t\t\t\tif (state === State.Accept) {\n\t\t\t\t\tlet chClass: CharacterClass;\n\t\t\t\t\tswitch (chCode) {\n\t\t\t\t\t\tcase CharCode.OpenParen:\n\t\t\t\t\t\t\thasOpenParens = true;\n\t\t\t\t\t\t\tchClass = CharacterClass.None;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase CharCode.CloseParen:\n\t\t\t\t\t\t\tchClass = (hasOpenParens ? CharacterClass.None : CharacterClass.ForceTermination);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase CharCode.OpenSquareBracket:\n\t\t\t\t\t\t\tinSquareBrackets = true;\n\t\t\t\t\t\t\thasOpenSquareBracket = true;\n\t\t\t\t\t\t\tchClass = CharacterClass.None;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase CharCode.CloseSquareBracket:\n\t\t\t\t\t\t\tinSquareBrackets = false;\n\t\t\t\t\t\t\tchClass = (hasOpenSquareBracket ? CharacterClass.None : CharacterClass.ForceTermination);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase CharCode.OpenCurlyBrace:\n\t\t\t\t\t\t\thasOpenCurlyBracket = true;\n\t\t\t\t\t\t\tchClass = CharacterClass.None;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase CharCode.CloseCurlyBrace:\n\t\t\t\t\t\t\tchClass = (hasOpenCurlyBracket ? CharacterClass.None : CharacterClass.ForceTermination);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t/* The following three rules make it that ' or \" or ` are allowed inside links if the link began with a different one */\n\t\t\t\t\t\tcase CharCode.SingleQuote:\n\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.DoubleQuote || linkBeginChCode === CharCode.BackTick) ? CharacterClass.None : CharacterClass.ForceTermination;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase CharCode.DoubleQuote:\n\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.SingleQuote || linkBeginChCode === CharCode.BackTick) ? CharacterClass.None : CharacterClass.ForceTermination;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase CharCode.BackTick:\n\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.SingleQuote || linkBeginChCode === CharCode.DoubleQuote) ? CharacterClass.None : CharacterClass.ForceTermination;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase CharCode.Asterisk:\n\t\t\t\t\t\t\t// `*` terminates a link if the link began with `*`\n\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.Asterisk) ? CharacterClass.ForceTermination : CharacterClass.None;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase CharCode.Pipe:\n\t\t\t\t\t\t\t// `|` terminates a link if the link began with `|`\n\t\t\t\t\t\t\tchClass = (linkBeginChCode === CharCode.Pipe) ? CharacterClass.ForceTermination : CharacterClass.None;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase CharCode.Space:\n\t\t\t\t\t\t\t// ` ` allow space in between [ and ]\n\t\t\t\t\t\t\tchClass = (inSquareBrackets ? CharacterClass.None : CharacterClass.ForceTermination);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tchClass = classifier.get(chCode);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Check if character terminates link\n\t\t\t\t\tif (chClass === CharacterClass.ForceTermination) {\n\t\t\t\t\t\tresult.push(LinkComputer._createLink(classifier, line, i, linkBeginIndex, j));\n\t\t\t\t\t\tresetStateMachine = true;\n\t\t\t\t\t}\n\t\t\t\t} else if (state === State.End) {\n\n\t\t\t\t\tlet chClass: CharacterClass;\n\t\t\t\t\tif (chCode === CharCode.OpenSquareBracket) {\n\t\t\t\t\t\t// Allow for the authority part to contain ipv6 addresses which contain [ and ]\n\t\t\t\t\t\thasOpenSquareBracket = true;\n\t\t\t\t\t\tchClass = CharacterClass.None;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tchClass = classifier.get(chCode);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Check if character terminates link\n\t\t\t\t\tif (chClass === CharacterClass.ForceTermination) {\n\t\t\t\t\t\tresetStateMachine = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstate = State.Accept;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tstate = stateMachine.nextState(state, chCode);\n\t\t\t\t\tif (state === State.Invalid) {\n\t\t\t\t\t\tresetStateMachine = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (resetStateMachine) {\n\t\t\t\t\tstate = State.Start;\n\t\t\t\t\thasOpenParens = false;\n\t\t\t\t\thasOpenSquareBracket = false;\n\t\t\t\t\thasOpenCurlyBracket = false;\n\n\t\t\t\t\t// Record where the link started\n\t\t\t\t\tlinkBeginIndex = j + 1;\n\t\t\t\t\tlinkBeginChCode = chCode;\n\t\t\t\t}\n\n\t\t\t\tj++;\n\t\t\t}\n\n\t\t\tif (state === State.Accept) {\n\t\t\t\tresult.push(LinkComputer._createLink(classifier, line, i, linkBeginIndex, len));\n\t\t\t}\n\n\t\t}\n\n\t\treturn result;\n\t}\n}\n\n/**\n * Returns an array of all links contains in the provided\n * document. *Note* that this operation is computational\n * expensive and should not run in the UI thread.\n */\nexport function computeLinks(model: ILinkComputerTarget | null): ILink[] {\n\tif (!model || typeof model.getLineCount !== 'function' || typeof model.getLineContent !== 'function') {\n\t\t// Unknown caller!\n\t\treturn [];\n\t}\n\treturn LinkComputer.computeLinks(model);\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Color } from 'vs/base/common/color';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { IDisposable, toDisposable } from 'vs/base/common/lifecycle';\nimport { ColorId, ITokenizationRegistry, ITokenizationSupport, ITokenizationSupportChangedEvent } from 'vs/editor/common/modes';\n\nexport class TokenizationRegistryImpl implements ITokenizationRegistry {\n\n\tprivate readonly _map = new Map<string, ITokenizationSupport>();\n\tprivate readonly _promises = new Map<string, Thenable<void>>();\n\n\tprivate readonly _onDidChange = new Emitter<ITokenizationSupportChangedEvent>();\n\tpublic readonly onDidChange: Event<ITokenizationSupportChangedEvent> = this._onDidChange.event;\n\n\tprivate _colorMap: Color[] | null;\n\n\tconstructor() {\n\t\tthis._colorMap = null;\n\t}\n\n\tpublic fire(languages: string[]): void {\n\t\tthis._onDidChange.fire({\n\t\t\tchangedLanguages: languages,\n\t\t\tchangedColorMap: false\n\t\t});\n\t}\n\n\tpublic register(language: string, support: ITokenizationSupport) {\n\t\tthis._map.set(language, support);\n\t\tthis.fire([language]);\n\t\treturn toDisposable(() => {\n\t\t\tif (this._map.get(language) !== support) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._map.delete(language);\n\t\t\tthis.fire([language]);\n\t\t});\n\t}\n\n\tpublic registerPromise(language: string, supportPromise: Thenable<ITokenizationSupport | null>): IDisposable {\n\n\t\tlet registration: IDisposable | null = null;\n\t\tlet isDisposed: boolean = false;\n\n\t\tthis._promises.set(language, supportPromise.then(support => {\n\t\t\tthis._promises.delete(language);\n\t\t\tif (isDisposed || !support) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tregistration = this.register(language, support);\n\t\t}));\n\n\t\treturn toDisposable(() => {\n\t\t\tisDisposed = true;\n\t\t\tif (registration) {\n\t\t\t\tregistration.dispose();\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic getPromise(language: string): Thenable<ITokenizationSupport> | null {\n\t\tconst support = this.get(language);\n\t\tif (support) {\n\t\t\treturn Promise.resolve(support);\n\t\t}\n\t\tconst promise = this._promises.get(language);\n\t\tif (promise) {\n\t\t\treturn promise.then(_ => this.get(language)!);\n\t\t}\n\t\treturn null;\n\t}\n\n\tpublic get(language: string): ITokenizationSupport | null {\n\t\treturn (this._map.get(language) || null);\n\t}\n\n\tpublic setColorMap(colorMap: Color[]): void {\n\t\tthis._colorMap = colorMap;\n\t\tthis._onDidChange.fire({\n\t\t\tchangedLanguages: Array.from(this._map.keys()),\n\t\t\tchangedColorMap: true\n\t\t});\n\t}\n\n\tpublic getColorMap(): Color[] | null {\n\t\treturn this._colorMap;\n\t}\n\n\tpublic getDefaultBackground(): Color | null {\n\t\tif (this._colorMap && this._colorMap.length > ColorId.DefaultBackground) {\n\t\t\treturn this._colorMap[ColorId.DefaultBackground];\n\t\t}\n\t\treturn null;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { VSBuffer } from 'vs/base/common/buffer';\nimport * as platform from 'vs/base/common/platform';\n\nexport interface IFullSemanticTokensDto {\n\tid: number;\n\ttype: 'full';\n\tdata: Uint32Array;\n}\n\nexport interface IDeltaSemanticTokensDto {\n\tid: number;\n\ttype: 'delta';\n\tdeltas: { start: number; deleteCount: number; data?: Uint32Array; }[];\n}\n\nexport type ISemanticTokensDto = IFullSemanticTokensDto | IDeltaSemanticTokensDto;\n\nconst enum EncodedSemanticTokensType {\n\tFull = 1,\n\tDelta = 2\n}\n\nfunction reverseEndianness(arr: Uint8Array): void {\n\tfor (let i = 0, len = arr.length; i < len; i += 4) {\n\t\t// flip bytes 0<->3 and 1<->2\n\t\tconst b0 = arr[i + 0];\n\t\tconst b1 = arr[i + 1];\n\t\tconst b2 = arr[i + 2];\n\t\tconst b3 = arr[i + 3];\n\t\tarr[i + 0] = b3;\n\t\tarr[i + 1] = b2;\n\t\tarr[i + 2] = b1;\n\t\tarr[i + 3] = b0;\n\t}\n}\n\nfunction toLittleEndianBuffer(arr: Uint32Array): VSBuffer {\n\tconst uint8Arr = new Uint8Array(arr.buffer, arr.byteOffset, arr.length * 4);\n\tif (!platform.isLittleEndian()) {\n\t\t// the byte order must be changed\n\t\treverseEndianness(uint8Arr);\n\t}\n\treturn VSBuffer.wrap(uint8Arr);\n}\n\nfunction fromLittleEndianBuffer(buff: VSBuffer): Uint32Array {\n\tconst uint8Arr = buff.buffer;\n\tif (!platform.isLittleEndian()) {\n\t\t// the byte order must be changed\n\t\treverseEndianness(uint8Arr);\n\t}\n\tif (uint8Arr.byteOffset % 4 === 0) {\n\t\treturn new Uint32Array(uint8Arr.buffer, uint8Arr.byteOffset, uint8Arr.length / 4);\n\t} else {\n\t\t// unaligned memory access doesn't work on all platforms\n\t\tconst data = new Uint8Array(uint8Arr.byteLength);\n\t\tdata.set(uint8Arr);\n\t\treturn new Uint32Array(data.buffer, data.byteOffset, data.length / 4);\n\t}\n}\n\nexport function encodeSemanticTokensDto(semanticTokens: ISemanticTokensDto): VSBuffer {\n\tconst dest = new Uint32Array(encodeSemanticTokensDtoSize(semanticTokens));\n\tlet offset = 0;\n\tdest[offset++] = semanticTokens.id;\n\tif (semanticTokens.type === 'full') {\n\t\tdest[offset++] = EncodedSemanticTokensType.Full;\n\t\tdest[offset++] = semanticTokens.data.length;\n\t\tdest.set(semanticTokens.data, offset); offset += semanticTokens.data.length;\n\t} else {\n\t\tdest[offset++] = EncodedSemanticTokensType.Delta;\n\t\tdest[offset++] = semanticTokens.deltas.length;\n\t\tfor (const delta of semanticTokens.deltas) {\n\t\t\tdest[offset++] = delta.start;\n\t\t\tdest[offset++] = delta.deleteCount;\n\t\t\tif (delta.data) {\n\t\t\t\tdest[offset++] = delta.data.length;\n\t\t\t\tdest.set(delta.data, offset); offset += delta.data.length;\n\t\t\t} else {\n\t\t\t\tdest[offset++] = 0;\n\t\t\t}\n\t\t}\n\t}\n\treturn toLittleEndianBuffer(dest);\n}\n\nfunction encodeSemanticTokensDtoSize(semanticTokens: ISemanticTokensDto): number {\n\tlet result = 0;\n\tresult += (\n\t\t+ 1 // id\n\t\t+ 1 // type\n\t);\n\tif (semanticTokens.type === 'full') {\n\t\tresult += (\n\t\t\t+ 1 // data length\n\t\t\t+ semanticTokens.data.length\n\t\t);\n\t} else {\n\t\tresult += (\n\t\t\t+ 1 // delta count\n\t\t);\n\t\tresult += (\n\t\t\t+ 1 // start\n\t\t\t+ 1 // deleteCount\n\t\t\t+ 1 // data length\n\t\t) * semanticTokens.deltas.length;\n\t\tfor (const delta of semanticTokens.deltas) {\n\t\t\tif (delta.data) {\n\t\t\t\tresult += delta.data.length;\n\t\t\t}\n\t\t}\n\t}\n\treturn result;\n}\n\nexport function decodeSemanticTokensDto(_buff: VSBuffer): ISemanticTokensDto {\n\tconst src = fromLittleEndianBuffer(_buff);\n\tlet offset = 0;\n\tconst id = src[offset++];\n\tconst type: EncodedSemanticTokensType = src[offset++];\n\tif (type === EncodedSemanticTokensType.Full) {\n\t\tconst length = src[offset++];\n\t\tconst data = src.subarray(offset, offset + length); offset += length;\n\t\treturn {\n\t\t\tid: id,\n\t\t\ttype: 'full',\n\t\t\tdata: data\n\t\t};\n\t}\n\tconst deltaCount = src[offset++];\n\tlet deltas: { start: number; deleteCount: number; data?: Uint32Array; }[] = [];\n\tfor (let i = 0; i < deltaCount; i++) {\n\t\tconst start = src[offset++];\n\t\tconst deleteCount = src[offset++];\n\t\tconst length = src[offset++];\n\t\tlet data: Uint32Array | undefined;\n\t\tif (length > 0) {\n\t\t\tdata = src.subarray(offset, offset + length); offset += length;\n\t\t}\n\t\tdeltas[i] = { start, deleteCount, data };\n\t}\n\treturn {\n\t\tid: id,\n\t\ttype: 'delta',\n\t\tdeltas: deltas\n\t};\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { toUint32 } from 'vs/base/common/uint';\n\nexport class PrefixSumIndexOfResult {\n\t_prefixSumIndexOfResultBrand: void;\n\n\tindex: number;\n\tremainder: number;\n\n\tconstructor(index: number, remainder: number) {\n\t\tthis.index = index;\n\t\tthis.remainder = remainder;\n\t}\n}\n\nexport class PrefixSumComputer {\n\n\t/**\n\t * values[i] is the value at index i\n\t */\n\tprivate values: Uint32Array;\n\n\t/**\n\t * prefixSum[i] = SUM(heights[j]), 0 <= j <= i\n\t */\n\tprivate prefixSum: Uint32Array;\n\n\t/**\n\t * prefixSum[i], 0 <= i <= prefixSumValidIndex can be trusted\n\t */\n\tprivate readonly prefixSumValidIndex: Int32Array;\n\n\tconstructor(values: Uint32Array) {\n\t\tthis.values = values;\n\t\tthis.prefixSum = new Uint32Array(values.length);\n\t\tthis.prefixSumValidIndex = new Int32Array(1);\n\t\tthis.prefixSumValidIndex[0] = -1;\n\t}\n\n\tpublic getCount(): number {\n\t\treturn this.values.length;\n\t}\n\n\tpublic insertValues(insertIndex: number, insertValues: Uint32Array): boolean {\n\t\tinsertIndex = toUint32(insertIndex);\n\t\tconst oldValues = this.values;\n\t\tconst oldPrefixSum = this.prefixSum;\n\t\tconst insertValuesLen = insertValues.length;\n\n\t\tif (insertValuesLen === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.values = new Uint32Array(oldValues.length + insertValuesLen);\n\t\tthis.values.set(oldValues.subarray(0, insertIndex), 0);\n\t\tthis.values.set(oldValues.subarray(insertIndex), insertIndex + insertValuesLen);\n\t\tthis.values.set(insertValues, insertIndex);\n\n\t\tif (insertIndex - 1 < this.prefixSumValidIndex[0]) {\n\t\t\tthis.prefixSumValidIndex[0] = insertIndex - 1;\n\t\t}\n\n\t\tthis.prefixSum = new Uint32Array(this.values.length);\n\t\tif (this.prefixSumValidIndex[0] >= 0) {\n\t\t\tthis.prefixSum.set(oldPrefixSum.subarray(0, this.prefixSumValidIndex[0] + 1));\n\t\t}\n\t\treturn true;\n\t}\n\n\tpublic changeValue(index: number, value: number): boolean {\n\t\tindex = toUint32(index);\n\t\tvalue = toUint32(value);\n\n\t\tif (this.values[index] === value) {\n\t\t\treturn false;\n\t\t}\n\t\tthis.values[index] = value;\n\t\tif (index - 1 < this.prefixSumValidIndex[0]) {\n\t\t\tthis.prefixSumValidIndex[0] = index - 1;\n\t\t}\n\t\treturn true;\n\t}\n\n\tpublic removeValues(startIndex: number, cnt: number): boolean {\n\t\tstartIndex = toUint32(startIndex);\n\t\tcnt = toUint32(cnt);\n\n\t\tconst oldValues = this.values;\n\t\tconst oldPrefixSum = this.prefixSum;\n\n\t\tif (startIndex >= oldValues.length) {\n\t\t\treturn false;\n\t\t}\n\n\t\tlet maxCnt = oldValues.length - startIndex;\n\t\tif (cnt >= maxCnt) {\n\t\t\tcnt = maxCnt;\n\t\t}\n\n\t\tif (cnt === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.values = new Uint32Array(oldValues.length - cnt);\n\t\tthis.values.set(oldValues.subarray(0, startIndex), 0);\n\t\tthis.values.set(oldValues.subarray(startIndex + cnt), startIndex);\n\n\t\tthis.prefixSum = new Uint32Array(this.values.length);\n\t\tif (startIndex - 1 < this.prefixSumValidIndex[0]) {\n\t\t\tthis.prefixSumValidIndex[0] = startIndex - 1;\n\t\t}\n\t\tif (this.prefixSumValidIndex[0] >= 0) {\n\t\t\tthis.prefixSum.set(oldPrefixSum.subarray(0, this.prefixSumValidIndex[0] + 1));\n\t\t}\n\t\treturn true;\n\t}\n\n\tpublic getTotalValue(): number {\n\t\tif (this.values.length === 0) {\n\t\t\treturn 0;\n\t\t}\n\t\treturn this._getAccumulatedValue(this.values.length - 1);\n\t}\n\n\tpublic getAccumulatedValue(index: number): number {\n\t\tif (index < 0) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tindex = toUint32(index);\n\t\treturn this._getAccumulatedValue(index);\n\t}\n\n\tprivate _getAccumulatedValue(index: number): number {\n\t\tif (index <= this.prefixSumValidIndex[0]) {\n\t\t\treturn this.prefixSum[index];\n\t\t}\n\n\t\tlet startIndex = this.prefixSumValidIndex[0] + 1;\n\t\tif (startIndex === 0) {\n\t\t\tthis.prefixSum[0] = this.values[0];\n\t\t\tstartIndex++;\n\t\t}\n\n\t\tif (index >= this.values.length) {\n\t\t\tindex = this.values.length - 1;\n\t\t}\n\n\t\tfor (let i = startIndex; i <= index; i++) {\n\t\t\tthis.prefixSum[i] = this.prefixSum[i - 1] + this.values[i];\n\t\t}\n\t\tthis.prefixSumValidIndex[0] = Math.max(this.prefixSumValidIndex[0], index);\n\t\treturn this.prefixSum[index];\n\t}\n\n\tpublic getIndexOf(accumulatedValue: number): PrefixSumIndexOfResult {\n\t\taccumulatedValue = Math.floor(accumulatedValue); //@perf\n\n\t\t// Compute all sums (to get a fully valid prefixSum)\n\t\tthis.getTotalValue();\n\n\t\tlet low = 0;\n\t\tlet high = this.values.length - 1;\n\t\tlet mid = 0;\n\t\tlet midStop = 0;\n\t\tlet midStart = 0;\n\n\t\twhile (low <= high) {\n\t\t\tmid = low + ((high - low) / 2) | 0;\n\n\t\t\tmidStop = this.prefixSum[mid];\n\t\t\tmidStart = midStop - this.values[mid];\n\n\t\t\tif (accumulatedValue < midStart) {\n\t\t\t\thigh = mid - 1;\n\t\t\t} else if (accumulatedValue >= midStop) {\n\t\t\t\tlow = mid + 1;\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn new PrefixSumIndexOfResult(mid, accumulatedValue - midStart);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { splitLines } from 'vs/base/common/strings';\nimport { URI } from 'vs/base/common/uri';\nimport { Position } from 'vs/editor/common/core/position';\nimport { IRange } from 'vs/editor/common/core/range';\nimport { IModelContentChange } from 'vs/editor/common/model/textModelEvents';\nimport { PrefixSumComputer } from 'vs/editor/common/viewModel/prefixSumComputer';\n\nexport interface IModelChangedEvent {\n\t/**\n\t * The actual changes.\n\t */\n\treadonly changes: IModelContentChange[];\n\t/**\n\t * The (new) end-of-line character.\n\t */\n\treadonly eol: string;\n\t/**\n\t * The new version id the model has transitioned to.\n\t */\n\treadonly versionId: number;\n}\n\nexport class MirrorTextModel {\n\n\tprotected _uri: URI;\n\tprotected _lines: string[];\n\tprotected _eol: string;\n\tprotected _versionId: number;\n\tprotected _lineStarts: PrefixSumComputer | null;\n\tprivate _cachedTextValue: string | null;\n\n\tconstructor(uri: URI, lines: string[], eol: string, versionId: number) {\n\t\tthis._uri = uri;\n\t\tthis._lines = lines;\n\t\tthis._eol = eol;\n\t\tthis._versionId = versionId;\n\t\tthis._lineStarts = null;\n\t\tthis._cachedTextValue = null;\n\t}\n\n\tdispose(): void {\n\t\tthis._lines.length = 0;\n\t}\n\n\tget version(): number {\n\t\treturn this._versionId;\n\t}\n\n\tgetText(): string {\n\t\tif (this._cachedTextValue === null) {\n\t\t\tthis._cachedTextValue = this._lines.join(this._eol);\n\t\t}\n\t\treturn this._cachedTextValue;\n\t}\n\n\tonEvents(e: IModelChangedEvent): void {\n\t\tif (e.eol && e.eol !== this._eol) {\n\t\t\tthis._eol = e.eol;\n\t\t\tthis._lineStarts = null;\n\t\t}\n\n\t\t// Update my lines\n\t\tconst changes = e.changes;\n\t\tfor (const change of changes) {\n\t\t\tthis._acceptDeleteRange(change.range);\n\t\t\tthis._acceptInsertText(new Position(change.range.startLineNumber, change.range.startColumn), change.text);\n\t\t}\n\n\t\tthis._versionId = e.versionId;\n\t\tthis._cachedTextValue = null;\n\t}\n\n\tprotected _ensureLineStarts(): void {\n\t\tif (!this._lineStarts) {\n\t\t\tconst eolLength = this._eol.length;\n\t\t\tconst linesLength = this._lines.length;\n\t\t\tconst lineStartValues = new Uint32Array(linesLength);\n\t\t\tfor (let i = 0; i < linesLength; i++) {\n\t\t\t\tlineStartValues[i] = this._lines[i].length + eolLength;\n\t\t\t}\n\t\t\tthis._lineStarts = new PrefixSumComputer(lineStartValues);\n\t\t}\n\t}\n\n\t/**\n\t * All changes to a line's text go through this method\n\t */\n\tprivate _setLineText(lineIndex: number, newValue: string): void {\n\t\tthis._lines[lineIndex] = newValue;\n\t\tif (this._lineStarts) {\n\t\t\t// update prefix sum\n\t\t\tthis._lineStarts.changeValue(lineIndex, this._lines[lineIndex].length + this._eol.length);\n\t\t}\n\t}\n\n\tprivate _acceptDeleteRange(range: IRange): void {\n\n\t\tif (range.startLineNumber === range.endLineNumber) {\n\t\t\tif (range.startColumn === range.endColumn) {\n\t\t\t\t// Nothing to delete\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Delete text on the affected line\n\t\t\tthis._setLineText(range.startLineNumber - 1,\n\t\t\t\tthis._lines[range.startLineNumber - 1].substring(0, range.startColumn - 1)\n\t\t\t\t+ this._lines[range.startLineNumber - 1].substring(range.endColumn - 1)\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\t// Take remaining text on last line and append it to remaining text on first line\n\t\tthis._setLineText(range.startLineNumber - 1,\n\t\t\tthis._lines[range.startLineNumber - 1].substring(0, range.startColumn - 1)\n\t\t\t+ this._lines[range.endLineNumber - 1].substring(range.endColumn - 1)\n\t\t);\n\n\t\t// Delete middle lines\n\t\tthis._lines.splice(range.startLineNumber, range.endLineNumber - range.startLineNumber);\n\t\tif (this._lineStarts) {\n\t\t\t// update prefix sum\n\t\t\tthis._lineStarts.removeValues(range.startLineNumber, range.endLineNumber - range.startLineNumber);\n\t\t}\n\t}\n\n\tprivate _acceptInsertText(position: Position, insertText: string): void {\n\t\tif (insertText.length === 0) {\n\t\t\t// Nothing to insert\n\t\t\treturn;\n\t\t}\n\t\tlet insertLines = splitLines(insertText);\n\t\tif (insertLines.length === 1) {\n\t\t\t// Inserting text on one line\n\t\t\tthis._setLineText(position.lineNumber - 1,\n\t\t\t\tthis._lines[position.lineNumber - 1].substring(0, position.column - 1)\n\t\t\t\t+ insertLines[0]\n\t\t\t\t+ this._lines[position.lineNumber - 1].substring(position.column - 1)\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\t// Append overflowing text from first line to the end of text to insert\n\t\tinsertLines[insertLines.length - 1] += this._lines[position.lineNumber - 1].substring(position.column - 1);\n\n\t\t// Delete overflowing text from first line and insert text on first line\n\t\tthis._setLineText(position.lineNumber - 1,\n\t\t\tthis._lines[position.lineNumber - 1].substring(0, position.column - 1)\n\t\t\t+ insertLines[0]\n\t\t);\n\n\t\t// Insert new lines & store lengths\n\t\tlet newLengths = new Uint32Array(insertLines.length - 1);\n\t\tfor (let i = 1; i < insertLines.length; i++) {\n\t\t\tthis._lines.splice(position.lineNumber + i - 1, 0, insertLines[i]);\n\t\t\tnewLengths[i - 1] = insertLines[i].length + this._eol.length;\n\t\t}\n\n\t\tif (this._lineStarts) {\n\t\t\t// update prefix sum\n\t\t\tthis._lineStarts.insertValues(position.lineNumber, newLengths);\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from 'vs/nls';\n\nconst minute = 60;\nconst hour = minute * 60;\nconst day = hour * 24;\nconst week = day * 7;\nconst month = day * 30;\nconst year = day * 365;\n\nexport function fromNow(date: number | Date, appendAgoLabel?: boolean): string {\n\tif (typeof date !== 'number') {\n\t\tdate = date.getTime();\n\t}\n\n\tconst seconds = Math.round((new Date().getTime() - date) / 1000);\n\tif (seconds < -30) {\n\t\treturn localize('date.fromNow.in', 'in {0}', fromNow(new Date().getTime() + seconds * 1000, false));\n\t}\n\n\tif (seconds < 30) {\n\t\treturn localize('date.fromNow.now', 'now');\n\t}\n\n\tlet value: number;\n\tif (seconds < minute) {\n\t\tvalue = seconds;\n\n\t\tif (appendAgoLabel) {\n\t\t\treturn value === 1\n\t\t\t\t? localize('date.fromNow.seconds.singular.ago', '{0} sec ago', value)\n\t\t\t\t: localize('date.fromNow.seconds.plural.ago', '{0} secs ago', value);\n\t\t} else {\n\t\t\treturn value === 1\n\t\t\t\t? localize('date.fromNow.seconds.singular', '{0} sec', value)\n\t\t\t\t: localize('date.fromNow.seconds.plural', '{0} secs', value);\n\t\t}\n\t}\n\n\tif (seconds < hour) {\n\t\tvalue = Math.floor(seconds / minute);\n\t\tif (appendAgoLabel) {\n\t\t\treturn value === 1\n\t\t\t\t? localize('date.fromNow.minutes.singular.ago', '{0} min ago', value)\n\t\t\t\t: localize('date.fromNow.minutes.plural.ago', '{0} mins ago', value);\n\t\t} else {\n\t\t\treturn value === 1\n\t\t\t\t? localize('date.fromNow.minutes.singular', '{0} min', value)\n\t\t\t\t: localize('date.fromNow.minutes.plural', '{0} mins', value);\n\t\t}\n\t}\n\n\tif (seconds < day) {\n\t\tvalue = Math.floor(seconds / hour);\n\t\tif (appendAgoLabel) {\n\t\t\treturn value === 1\n\t\t\t\t? localize('date.fromNow.hours.singular.ago', '{0} hr ago', value)\n\t\t\t\t: localize('date.fromNow.hours.plural.ago', '{0} hrs ago', value);\n\t\t} else {\n\t\t\treturn value === 1\n\t\t\t\t? localize('date.fromNow.hours.singular', '{0} hr', value)\n\t\t\t\t: localize('date.fromNow.hours.plural', '{0} hrs', value);\n\t\t}\n\t}\n\n\tif (seconds < week) {\n\t\tvalue = Math.floor(seconds / day);\n\t\tif (appendAgoLabel) {\n\t\t\treturn value === 1\n\t\t\t\t? localize('date.fromNow.days.singular.ago', '{0} day ago', value)\n\t\t\t\t: localize('date.fromNow.days.plural.ago', '{0} days ago', value);\n\t\t} else {\n\t\t\treturn value === 1\n\t\t\t\t? localize('date.fromNow.days.singular', '{0} day', value)\n\t\t\t\t: localize('date.fromNow.days.plural', '{0} days', value);\n\t\t}\n\t}\n\n\tif (seconds < month) {\n\t\tvalue = Math.floor(seconds / week);\n\t\tif (appendAgoLabel) {\n\t\t\treturn value === 1\n\t\t\t\t? localize('date.fromNow.weeks.singular.ago', '{0} wk ago', value)\n\t\t\t\t: localize('date.fromNow.weeks.plural.ago', '{0} wks ago', value);\n\t\t} else {\n\t\t\treturn value === 1\n\t\t\t\t? localize('date.fromNow.weeks.singular', '{0} wk', value)\n\t\t\t\t: localize('date.fromNow.weeks.plural', '{0} wks', value);\n\t\t}\n\t}\n\n\tif (seconds < year) {\n\t\tvalue = Math.floor(seconds / month);\n\t\tif (appendAgoLabel) {\n\t\t\treturn value === 1\n\t\t\t\t? localize('date.fromNow.months.singular.ago', '{0} mo ago', value)\n\t\t\t\t: localize('date.fromNow.months.plural.ago', '{0} mos ago', value);\n\t\t} else {\n\t\t\treturn value === 1\n\t\t\t\t? localize('date.fromNow.months.singular', '{0} mo', value)\n\t\t\t\t: localize('date.fromNow.months.plural', '{0} mos', value);\n\t\t}\n\t}\n\n\tvalue = Math.floor(seconds / year);\n\tif (appendAgoLabel) {\n\t\treturn value === 1\n\t\t\t? localize('date.fromNow.years.singular.ago', '{0} yr ago', value)\n\t\t\t: localize('date.fromNow.years.plural.ago', '{0} yrs ago', value);\n\t} else {\n\t\treturn value === 1\n\t\t\t? localize('date.fromNow.years.singular', '{0} yr', value)\n\t\t\t: localize('date.fromNow.years.plural', '{0} yrs', value);\n\t}\n}\n\nexport function toLocalISOString(date: Date): string {\n\treturn date.getFullYear() +\n\t\t'-' + String(date.getMonth() + 1).padStart(2, '0') +\n\t\t'-' + String(date.getDate()).padStart(2, '0') +\n\t\t'T' + String(date.getHours()).padStart(2, '0') +\n\t\t':' + String(date.getMinutes()).padStart(2, '0') +\n\t\t':' + String(date.getSeconds()).padStart(2, '0') +\n\t\t'.' + (date.getMilliseconds() / 1000).toFixed(3).slice(2, 5) +\n\t\t'Z';\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as nls from 'vs/nls';\nimport * as types from 'vs/base/common/types';\nimport * as arrays from 'vs/base/common/arrays';\n\nfunction exceptionToErrorMessage(exception: any, verbose: boolean): string {\n\tif (verbose && (exception.stack || exception.stacktrace)) {\n\t\treturn nls.localize('stackTrace.format', \"{0}: {1}\", detectSystemErrorMessage(exception), stackToString(exception.stack) || stackToString(exception.stacktrace));\n\t}\n\n\treturn detectSystemErrorMessage(exception);\n}\n\nfunction stackToString(stack: string[] | string | undefined): string | undefined {\n\tif (Array.isArray(stack)) {\n\t\treturn stack.join('\\n');\n\t}\n\n\treturn stack;\n}\n\nfunction detectSystemErrorMessage(exception: any): string {\n\n\t// See https://nodejs.org/api/errors.html#errors_class_system_error\n\tif (typeof exception.code === 'string' && typeof exception.errno === 'number' && typeof exception.syscall === 'string') {\n\t\treturn nls.localize('nodeExceptionMessage', \"A system error occurred ({0})\", exception.message);\n\t}\n\n\treturn exception.message || nls.localize('error.defaultMessage', \"An unknown error occurred. Please consult the log for more details.\");\n}\n\n/**\n * Tries to generate a human readable error message out of the error. If the verbose parameter\n * is set to true, the error message will include stacktrace details if provided.\n *\n * @returns A string containing the error message.\n */\nexport function toErrorMessage(error: any = null, verbose: boolean = false): string {\n\tif (!error) {\n\t\treturn nls.localize('error.defaultMessage', \"An unknown error occurred. Please consult the log for more details.\");\n\t}\n\n\tif (Array.isArray(error)) {\n\t\tconst errors: any[] = arrays.coalesce(error);\n\t\tconst msg = toErrorMessage(errors[0], verbose);\n\n\t\tif (errors.length > 1) {\n\t\t\treturn nls.localize('error.moreErrors', \"{0} ({1} errors in total)\", msg, errors.length);\n\t\t}\n\n\t\treturn msg;\n\t}\n\n\tif (types.isString(error)) {\n\t\treturn error;\n\t}\n\n\tif (error.detail) {\n\t\tconst detail = error.detail;\n\n\t\tif (detail.error) {\n\t\t\treturn exceptionToErrorMessage(detail.error, verbose);\n\t\t}\n\n\t\tif (detail.exception) {\n\t\t\treturn exceptionToErrorMessage(detail.exception, verbose);\n\t\t}\n\t}\n\n\tif (error.stack) {\n\t\treturn exceptionToErrorMessage(error, verbose);\n\t}\n\n\tif (error.message) {\n\t\treturn error.message;\n\t}\n\n\treturn nls.localize('error.defaultMessage', \"An unknown error occurred. Please consult the log for more details.\");\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as path from 'vs/base/common/path';\nimport * as fs from 'fs';\nimport { promisify } from 'util';\nimport * as cp from 'child_process';\nimport * as nls from 'vs/nls';\nimport * as Types from 'vs/base/common/types';\nimport { IStringDictionary } from 'vs/base/common/collections';\nimport * as Objects from 'vs/base/common/objects';\nimport * as extpath from 'vs/base/common/extpath';\nimport * as Platform from 'vs/base/common/platform';\nimport { LineDecoder } from 'vs/base/node/decoder';\nimport { CommandOptions, ForkOptions, SuccessData, Source, TerminateResponse, TerminateResponseCode, Executable } from 'vs/base/common/processes';\nimport { FileAccess } from 'vs/base/common/network';\nexport { CommandOptions, ForkOptions, SuccessData, Source, TerminateResponse, TerminateResponseCode };\n\nexport type ValueCallback<T> = (value: T | Promise<T>) => void;\nexport type ErrorCallback = (error?: any) => void;\nexport type ProgressCallback<T> = (progress: T) => void;\n\nexport interface LineData {\n\tline: string;\n\tsource: Source;\n}\n\nfunction getWindowsCode(status: number): TerminateResponseCode {\n\tswitch (status) {\n\t\tcase 0:\n\t\t\treturn TerminateResponseCode.Success;\n\t\tcase 1:\n\t\t\treturn TerminateResponseCode.AccessDenied;\n\t\tcase 128:\n\t\t\treturn TerminateResponseCode.ProcessNotFound;\n\t\tdefault:\n\t\t\treturn TerminateResponseCode.Unknown;\n\t}\n}\n\nfunction terminateProcess(process: cp.ChildProcess, cwd?: string): Promise<TerminateResponse> {\n\tif (Platform.isWindows) {\n\t\ttry {\n\t\t\tconst options: any = {\n\t\t\t\tstdio: ['pipe', 'pipe', 'ignore']\n\t\t\t};\n\t\t\tif (cwd) {\n\t\t\t\toptions.cwd = cwd;\n\t\t\t}\n\t\t\tconst killProcess = cp.execFile('taskkill', ['/T', '/F', '/PID', process.pid.toString()], options);\n\t\t\treturn new Promise(resolve => {\n\t\t\t\tkillProcess.once('error', (err) => {\n\t\t\t\t\tresolve({ success: false, error: err });\n\t\t\t\t});\n\t\t\t\tkillProcess.once('exit', (code, signal) => {\n\t\t\t\t\tif (code === 0) {\n\t\t\t\t\t\tresolve({ success: true });\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresolve({ success: false, code: code !== null ? code : TerminateResponseCode.Unknown });\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t} catch (err) {\n\t\t\treturn Promise.resolve({ success: false, error: err, code: err.status ? getWindowsCode(err.status) : TerminateResponseCode.Unknown });\n\t\t}\n\t} else if (Platform.isLinux || Platform.isMacintosh) {\n\t\ttry {\n\t\t\tconst cmd = FileAccess.asFileUri('vs/base/node/terminateProcess.sh', require).fsPath;\n\t\t\treturn new Promise(resolve => {\n\t\t\t\tcp.execFile(cmd, [process.pid.toString()], { encoding: 'utf8', shell: true } as cp.ExecFileOptions, (err, stdout, stderr) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tresolve({ success: false, error: err });\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresolve({ success: true });\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t} catch (err) {\n\t\t\treturn Promise.resolve({ success: false, error: err });\n\t\t}\n\t} else {\n\t\tprocess.kill('SIGKILL');\n\t}\n\treturn Promise.resolve({ success: true });\n}\n\nexport function getWindowsShell(env = process.env as Platform.IProcessEnvironment): string {\n\treturn env['comspec'] || 'cmd.exe';\n}\n\nexport abstract class AbstractProcess<TProgressData> {\n\tprivate cmd: string;\n\tprivate args: string[];\n\tprivate options: CommandOptions | ForkOptions;\n\tprotected shell: boolean;\n\n\tprivate childProcess: cp.ChildProcess | null;\n\tprotected childProcessPromise: Promise<cp.ChildProcess> | null;\n\tprivate pidResolve: ValueCallback<number> | undefined;\n\tprotected terminateRequested: boolean;\n\n\tprivate static WellKnowCommands: IStringDictionary<boolean> = {\n\t\t'ant': true,\n\t\t'cmake': true,\n\t\t'eslint': true,\n\t\t'gradle': true,\n\t\t'grunt': true,\n\t\t'gulp': true,\n\t\t'jake': true,\n\t\t'jenkins': true,\n\t\t'jshint': true,\n\t\t'make': true,\n\t\t'maven': true,\n\t\t'msbuild': true,\n\t\t'msc': true,\n\t\t'nmake': true,\n\t\t'npm': true,\n\t\t'rake': true,\n\t\t'tsc': true,\n\t\t'xbuild': true\n\t};\n\n\tpublic constructor(executable: Executable);\n\tpublic constructor(cmd: string, args: string[] | undefined, shell: boolean, options: CommandOptions | undefined);\n\tpublic constructor(arg1: string | Executable, arg2?: string[], arg3?: boolean, arg4?: CommandOptions) {\n\t\tif (arg2 !== undefined && arg3 !== undefined && arg4 !== undefined) {\n\t\t\tthis.cmd = <string>arg1;\n\t\t\tthis.args = arg2;\n\t\t\tthis.shell = arg3;\n\t\t\tthis.options = arg4;\n\t\t} else {\n\t\t\tconst executable = <Executable>arg1;\n\t\t\tthis.cmd = executable.command;\n\t\t\tthis.shell = executable.isShellCommand;\n\t\t\tthis.args = executable.args.slice(0);\n\t\t\tthis.options = executable.options || {};\n\t\t}\n\n\t\tthis.childProcess = null;\n\t\tthis.childProcessPromise = null;\n\t\tthis.terminateRequested = false;\n\n\t\tif (this.options.env) {\n\t\t\tconst newEnv: IStringDictionary<string> = Object.create(null);\n\t\t\tObject.keys(process.env).forEach((key) => {\n\t\t\t\tnewEnv[key] = process.env[key]!;\n\t\t\t});\n\t\t\tObject.keys(this.options.env).forEach((key) => {\n\t\t\t\tnewEnv[key] = this.options.env![key]!;\n\t\t\t});\n\t\t\tthis.options.env = newEnv;\n\t\t}\n\t}\n\n\tpublic getSanitizedCommand(): string {\n\t\tlet result = this.cmd.toLowerCase();\n\t\tconst index = result.lastIndexOf(path.sep);\n\t\tif (index !== -1) {\n\t\t\tresult = result.substring(index + 1);\n\t\t}\n\t\tif (AbstractProcess.WellKnowCommands[result]) {\n\t\t\treturn result;\n\t\t}\n\t\treturn 'other';\n\t}\n\n\tpublic start(pp: ProgressCallback<TProgressData>): Promise<SuccessData> {\n\t\tif (Platform.isWindows && ((this.options && this.options.cwd && extpath.isUNC(this.options.cwd)) || !this.options && extpath.isUNC(process.cwd()))) {\n\t\t\treturn Promise.reject(new Error(nls.localize('TaskRunner.UNC', 'Can\\'t execute a shell command on a UNC drive.')));\n\t\t}\n\t\treturn this.useExec().then((useExec) => {\n\t\t\tlet cc: ValueCallback<SuccessData>;\n\t\t\tlet ee: ErrorCallback;\n\t\t\tconst result = new Promise<any>((c, e) => {\n\t\t\t\tcc = c;\n\t\t\t\tee = e;\n\t\t\t});\n\n\t\t\tif (useExec) {\n\t\t\t\tlet cmd: string = this.cmd;\n\t\t\t\tif (this.args) {\n\t\t\t\t\tcmd = cmd + ' ' + this.args.join(' ');\n\t\t\t\t}\n\t\t\t\tthis.childProcess = cp.exec(cmd, this.options, (error, stdout, stderr) => {\n\t\t\t\t\tthis.childProcess = null;\n\t\t\t\t\tconst err: any = error;\n\t\t\t\t\t// This is tricky since executing a command shell reports error back in case the executed command return an\n\t\t\t\t\t// error or the command didn't exist at all. So we can't blindly treat an error as a failed command. So we\n\t\t\t\t\t// always parse the output and report success unless the job got killed.\n\t\t\t\t\tif (err && err.killed) {\n\t\t\t\t\t\tee({ killed: this.terminateRequested, stdout: stdout.toString(), stderr: stderr.toString() });\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.handleExec(cc, pp, error, stdout as any, stderr as any);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tlet childProcess: cp.ChildProcess | null = null;\n\t\t\t\tconst closeHandler = (data: any) => {\n\t\t\t\t\tthis.childProcess = null;\n\t\t\t\t\tthis.childProcessPromise = null;\n\t\t\t\t\tthis.handleClose(data, cc, pp, ee);\n\t\t\t\t\tconst result: SuccessData = {\n\t\t\t\t\t\tterminated: this.terminateRequested\n\t\t\t\t\t};\n\t\t\t\t\tif (Types.isNumber(data)) {\n\t\t\t\t\t\tresult.cmdCode = <number>data;\n\t\t\t\t\t}\n\t\t\t\t\tcc(result);\n\t\t\t\t};\n\t\t\t\tif (this.shell && Platform.isWindows) {\n\t\t\t\t\tconst options: any = Objects.deepClone(this.options);\n\t\t\t\t\toptions.windowsVerbatimArguments = true;\n\t\t\t\t\toptions.detached = false;\n\t\t\t\t\tlet quotedCommand: boolean = false;\n\t\t\t\t\tlet quotedArg: boolean = false;\n\t\t\t\t\tconst commandLine: string[] = [];\n\t\t\t\t\tlet quoted = this.ensureQuotes(this.cmd);\n\t\t\t\t\tcommandLine.push(quoted.value);\n\t\t\t\t\tquotedCommand = quoted.quoted;\n\t\t\t\t\tif (this.args) {\n\t\t\t\t\t\tthis.args.forEach((elem) => {\n\t\t\t\t\t\t\tquoted = this.ensureQuotes(elem);\n\t\t\t\t\t\t\tcommandLine.push(quoted.value);\n\t\t\t\t\t\t\tquotedArg = quotedArg && quoted.quoted;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst args: string[] = [\n\t\t\t\t\t\t'/s',\n\t\t\t\t\t\t'/c',\n\t\t\t\t\t];\n\t\t\t\t\tif (quotedCommand) {\n\t\t\t\t\t\tif (quotedArg) {\n\t\t\t\t\t\t\targs.push('\"' + commandLine.join(' ') + '\"');\n\t\t\t\t\t\t} else if (commandLine.length > 1) {\n\t\t\t\t\t\t\targs.push('\"' + commandLine[0] + '\"' + ' ' + commandLine.slice(1).join(' '));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\targs.push('\"' + commandLine[0] + '\"');\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\targs.push(commandLine.join(' '));\n\t\t\t\t\t}\n\t\t\t\t\tchildProcess = cp.spawn(getWindowsShell(), args, options);\n\t\t\t\t} else {\n\t\t\t\t\tif (this.cmd) {\n\t\t\t\t\t\tchildProcess = cp.spawn(this.cmd, this.args, this.options);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (childProcess) {\n\t\t\t\t\tthis.childProcess = childProcess;\n\t\t\t\t\tthis.childProcessPromise = Promise.resolve(childProcess);\n\t\t\t\t\tif (this.pidResolve) {\n\t\t\t\t\t\tthis.pidResolve(Types.isNumber(childProcess.pid) ? childProcess.pid : -1);\n\t\t\t\t\t\tthis.pidResolve = undefined;\n\t\t\t\t\t}\n\t\t\t\t\tchildProcess.on('error', (error: Error) => {\n\t\t\t\t\t\tthis.childProcess = null;\n\t\t\t\t\t\tee({ terminated: this.terminateRequested, error: error });\n\t\t\t\t\t});\n\t\t\t\t\tif (childProcess.pid) {\n\t\t\t\t\t\tthis.childProcess.on('close', closeHandler);\n\t\t\t\t\t\tthis.handleSpawn(childProcess, cc!, pp, ee!, true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result;\n\t\t});\n\t}\n\n\tprotected abstract handleExec(cc: ValueCallback<SuccessData>, pp: ProgressCallback<TProgressData>, error: Error | null, stdout: Buffer, stderr: Buffer): void;\n\tprotected abstract handleSpawn(childProcess: cp.ChildProcess, cc: ValueCallback<SuccessData>, pp: ProgressCallback<TProgressData>, ee: ErrorCallback, sync: boolean): void;\n\n\tprotected handleClose(data: any, cc: ValueCallback<SuccessData>, pp: ProgressCallback<TProgressData>, ee: ErrorCallback): void {\n\t\t// Default is to do nothing.\n\t}\n\n\tprivate static readonly regexp = /^[^\"].* .*[^\"]/;\n\tprivate ensureQuotes(value: string) {\n\t\tif (AbstractProcess.regexp.test(value)) {\n\t\t\treturn {\n\t\t\t\tvalue: '\"' + value + '\"', //`\"${value}\"`,\n\t\t\t\tquoted: true\n\t\t\t};\n\t\t} else {\n\t\t\treturn {\n\t\t\t\tvalue: value,\n\t\t\t\tquoted: value.length > 0 && value[0] === '\"' && value[value.length - 1] === '\"'\n\t\t\t};\n\t\t}\n\t}\n\n\tpublic get pid(): Promise<number> {\n\t\tif (this.childProcessPromise) {\n\t\t\treturn this.childProcessPromise.then(childProcess => childProcess.pid, err => -1);\n\t\t} else {\n\t\t\treturn new Promise<number>((resolve) => {\n\t\t\t\tthis.pidResolve = resolve;\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic terminate(): Promise<TerminateResponse> {\n\t\tif (!this.childProcessPromise) {\n\t\t\treturn Promise.resolve<TerminateResponse>({ success: true });\n\t\t}\n\t\treturn this.childProcessPromise.then((childProcess) => {\n\t\t\tthis.terminateRequested = true;\n\t\t\treturn terminateProcess(childProcess, this.options.cwd).then(response => {\n\t\t\t\tif (response.success) {\n\t\t\t\t\tthis.childProcess = null;\n\t\t\t\t}\n\t\t\t\treturn response;\n\t\t\t});\n\t\t}, (err) => {\n\t\t\treturn { success: true };\n\t\t});\n\t}\n\n\tprivate useExec(): Promise<boolean> {\n\t\treturn new Promise<boolean>(resolve => {\n\t\t\tif (!this.shell || !Platform.isWindows) {\n\t\t\t\treturn resolve(false);\n\t\t\t}\n\t\t\tconst cmdShell = cp.spawn(getWindowsShell(), ['/s', '/c']);\n\t\t\tcmdShell.on('error', (error: Error) => {\n\t\t\t\treturn resolve(true);\n\t\t\t});\n\t\t\tcmdShell.on('exit', (data: any) => {\n\t\t\t\treturn resolve(false);\n\t\t\t});\n\t\t});\n\t}\n}\n\nexport class LineProcess extends AbstractProcess<LineData> {\n\n\tprivate stdoutLineDecoder: LineDecoder | null;\n\tprivate stderrLineDecoder: LineDecoder | null;\n\n\tpublic constructor(executable: Executable);\n\tpublic constructor(cmd: string, args: string[], shell: boolean, options: CommandOptions);\n\tpublic constructor(arg1: string | Executable, arg2?: string[], arg3?: boolean | ForkOptions, arg4?: CommandOptions) {\n\t\tsuper(<any>arg1, arg2, <any>arg3, arg4);\n\n\t\tthis.stdoutLineDecoder = null;\n\t\tthis.stderrLineDecoder = null;\n\t}\n\n\tprotected handleExec(cc: ValueCallback<SuccessData>, pp: ProgressCallback<LineData>, error: Error, stdout: Buffer, stderr: Buffer) {\n\t\t[stdout, stderr].forEach((buffer: Buffer, index: number) => {\n\t\t\tconst lineDecoder = new LineDecoder();\n\t\t\tconst lines = lineDecoder.write(buffer);\n\t\t\tlines.forEach((line) => {\n\t\t\t\tpp({ line: line, source: index === 0 ? Source.stdout : Source.stderr });\n\t\t\t});\n\t\t\tconst line = lineDecoder.end();\n\t\t\tif (line) {\n\t\t\t\tpp({ line: line, source: index === 0 ? Source.stdout : Source.stderr });\n\t\t\t}\n\t\t});\n\t\tcc({ terminated: this.terminateRequested, error: error });\n\t}\n\n\tprotected handleSpawn(childProcess: cp.ChildProcess, cc: ValueCallback<SuccessData>, pp: ProgressCallback<LineData>, ee: ErrorCallback, sync: boolean): void {\n\t\tconst stdoutLineDecoder = new LineDecoder();\n\t\tconst stderrLineDecoder = new LineDecoder();\n\t\tchildProcess.stdout!.on('data', (data: Buffer) => {\n\t\t\tconst lines = stdoutLineDecoder.write(data);\n\t\t\tlines.forEach(line => pp({ line: line, source: Source.stdout }));\n\t\t});\n\t\tchildProcess.stderr!.on('data', (data: Buffer) => {\n\t\t\tconst lines = stderrLineDecoder.write(data);\n\t\t\tlines.forEach(line => pp({ line: line, source: Source.stderr }));\n\t\t});\n\n\t\tthis.stdoutLineDecoder = stdoutLineDecoder;\n\t\tthis.stderrLineDecoder = stderrLineDecoder;\n\t}\n\n\tprotected handleClose(data: any, cc: ValueCallback<SuccessData>, pp: ProgressCallback<LineData>, ee: ErrorCallback): void {\n\t\tconst stdoutLine = this.stdoutLineDecoder ? this.stdoutLineDecoder.end() : null;\n\t\tif (stdoutLine) {\n\t\t\tpp({ line: stdoutLine, source: Source.stdout });\n\t\t}\n\t\tconst stderrLine = this.stderrLineDecoder ? this.stderrLineDecoder.end() : null;\n\t\tif (stderrLine) {\n\t\t\tpp({ line: stderrLine, source: Source.stderr });\n\t\t}\n\t}\n}\n\nexport interface IQueuedSender {\n\tsend: (msg: any) => void;\n}\n\n// Wrapper around process.send() that will queue any messages if the internal node.js\n// queue is filled with messages and only continue sending messages when the internal\n// queue is free again to consume messages.\n// On Windows we always wait for the send() method to return before sending the next message\n// to workaround https://github.com/nodejs/node/issues/7657 (IPC can freeze process)\nexport function createQueuedSender(childProcess: cp.ChildProcess): IQueuedSender {\n\tlet msgQueue: string[] = [];\n\tlet useQueue = false;\n\n\tconst send = function (msg: any): void {\n\t\tif (useQueue) {\n\t\t\tmsgQueue.push(msg); // add to the queue if the process cannot handle more messages\n\t\t\treturn;\n\t\t}\n\n\t\tconst result = childProcess.send(msg, (error: Error | null) => {\n\t\t\tif (error) {\n\t\t\t\tconsole.error(error); // unlikely to happen, best we can do is log this error\n\t\t\t}\n\n\t\t\tuseQueue = false; // we are good again to send directly without queue\n\n\t\t\t// now send all the messages that we have in our queue and did not send yet\n\t\t\tif (msgQueue.length > 0) {\n\t\t\t\tconst msgQueueCopy = msgQueue.slice(0);\n\t\t\t\tmsgQueue = [];\n\t\t\t\tmsgQueueCopy.forEach(entry => send(entry));\n\t\t\t}\n\t\t});\n\n\t\tif (!result || Platform.isWindows /* workaround https://github.com/nodejs/node/issues/7657 */) {\n\t\t\tuseQueue = true;\n\t\t}\n\t};\n\n\treturn { send };\n}\n\nexport namespace win32 {\n\texport async function findExecutable(command: string, cwd?: string, paths?: string[]): Promise<string> {\n\t\t// If we have an absolute path then we take it.\n\t\tif (path.isAbsolute(command)) {\n\t\t\treturn command;\n\t\t}\n\t\tif (cwd === undefined) {\n\t\t\tcwd = process.cwd();\n\t\t}\n\t\tconst dir = path.dirname(command);\n\t\tif (dir !== '.') {\n\t\t\t// We have a directory and the directory is relative (see above). Make the path absolute\n\t\t\t// to the current working directory.\n\t\t\treturn path.join(cwd, command);\n\t\t}\n\t\tif (paths === undefined && Types.isString(process.env['PATH'])) {\n\t\t\tpaths = process.env['PATH'].split(path.delimiter);\n\t\t}\n\t\t// No PATH environment. Make path absolute to the cwd.\n\t\tif (paths === undefined || paths.length === 0) {\n\t\t\treturn path.join(cwd, command);\n\t\t}\n\n\t\tasync function fileExists(path: string): Promise<boolean> {\n\t\t\tif (await promisify(fs.exists)(path)) {\n\t\t\t\treturn !((await promisify(fs.stat)(path)).isDirectory());\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\t// We have a simple file name. We get the path variable from the env\n\t\t// and try to find the executable on the path.\n\t\tfor (let pathEntry of paths) {\n\t\t\t// The path entry is absolute.\n\t\t\tlet fullPath: string;\n\t\t\tif (path.isAbsolute(pathEntry)) {\n\t\t\t\tfullPath = path.join(pathEntry, command);\n\t\t\t} else {\n\t\t\t\tfullPath = path.join(cwd, pathEntry, command);\n\t\t\t}\n\t\t\tif (await fileExists(fullPath)) {\n\t\t\t\treturn fullPath;\n\t\t\t}\n\t\t\tlet withExtension = fullPath + '.com';\n\t\t\tif (await fileExists(withExtension)) {\n\t\t\t\treturn withExtension;\n\t\t\t}\n\t\t\twithExtension = fullPath + '.exe';\n\t\t\tif (await fileExists(withExtension)) {\n\t\t\t\treturn withExtension;\n\t\t\t}\n\t\t}\n\t\treturn path.join(cwd, command);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as os from 'os';\nimport * as platform from 'vs/base/common/platform';\nimport { getFirstAvailablePowerShellInstallation } from 'vs/base/node/powershell';\nimport * as processes from 'vs/base/node/processes';\n\n/**\n * Gets the detected default shell for the _system_, not to be confused with VS Code's _default_\n * shell that the terminal uses by default.\n * @param p The platform to detect the shell of.\n */\nexport async function getSystemShell(p: platform.Platform, env = process.env as platform.IProcessEnvironment): Promise<string> {\n\tif (p === platform.Platform.Windows) {\n\t\tif (platform.isWindows) {\n\t\t\treturn getSystemShellWindows();\n\t\t}\n\t\t// Don't detect Windows shell when not on Windows\n\t\treturn processes.getWindowsShell(env);\n\t}\n\n\treturn getSystemShellUnixLike(p, env);\n}\n\nexport function getSystemShellSync(p: platform.Platform, env = process.env as platform.IProcessEnvironment): string {\n\tif (p === platform.Platform.Windows) {\n\t\tif (platform.isWindows) {\n\t\t\treturn getSystemShellWindowsSync(env);\n\t\t}\n\t\t// Don't detect Windows shell when not on Windows\n\t\treturn processes.getWindowsShell(env);\n\t}\n\n\treturn getSystemShellUnixLike(p, env);\n}\n\nlet _TERMINAL_DEFAULT_SHELL_UNIX_LIKE: string | null = null;\nfunction getSystemShellUnixLike(p: platform.Platform, env: platform.IProcessEnvironment): string {\n\t// Only use $SHELL for the current OS\n\tif (platform.isLinux && p === platform.Platform.Mac || platform.isMacintosh && p === platform.Platform.Linux) {\n\t\treturn '/bin/bash';\n\t}\n\n\tif (!_TERMINAL_DEFAULT_SHELL_UNIX_LIKE) {\n\t\tlet unixLikeTerminal: string;\n\t\tif (platform.isWindows) {\n\t\t\tunixLikeTerminal = '/bin/bash'; // for WSL\n\t\t} else {\n\t\t\tunixLikeTerminal = env['SHELL'];\n\n\t\t\tif (!unixLikeTerminal) {\n\t\t\t\ttry {\n\t\t\t\t\t// It's possible for $SHELL to be unset, this API reads /etc/passwd. See https://github.com/github/codespaces/issues/1639\n\t\t\t\t\t// Node docs: \"Throws a SystemError if a user has no username or homedir.\"\n\t\t\t\t\tunixLikeTerminal = os.userInfo().shell;\n\t\t\t\t} catch (err) { }\n\t\t\t}\n\n\t\t\tif (!unixLikeTerminal) {\n\t\t\t\tunixLikeTerminal = 'sh';\n\t\t\t}\n\n\t\t\t// Some systems have $SHELL set to /bin/false which breaks the terminal\n\t\t\tif (unixLikeTerminal === '/bin/false') {\n\t\t\t\tunixLikeTerminal = '/bin/bash';\n\t\t\t}\n\t\t}\n\t\t_TERMINAL_DEFAULT_SHELL_UNIX_LIKE = unixLikeTerminal;\n\t}\n\treturn _TERMINAL_DEFAULT_SHELL_UNIX_LIKE;\n}\n\nlet _TERMINAL_DEFAULT_SHELL_WINDOWS: string | null = null;\nasync function getSystemShellWindows(): Promise<string> {\n\tif (!_TERMINAL_DEFAULT_SHELL_WINDOWS) {\n\t\t_TERMINAL_DEFAULT_SHELL_WINDOWS = (await getFirstAvailablePowerShellInstallation())!.exePath;\n\t}\n\treturn _TERMINAL_DEFAULT_SHELL_WINDOWS;\n}\n\nfunction getSystemShellWindowsSync(env: platform.IProcessEnvironment): string {\n\tif (_TERMINAL_DEFAULT_SHELL_WINDOWS) {\n\t\treturn _TERMINAL_DEFAULT_SHELL_WINDOWS;\n\t}\n\n\tconst isAtLeastWindows10 = platform.isWindows && parseFloat(os.release()) >= 10;\n\tconst is32ProcessOn64Windows = env.hasOwnProperty('PROCESSOR_ARCHITEW6432');\n\tconst powerShellPath = `${env['windir']}\\\\${is32ProcessOn64Windows ? 'Sysnative' : 'System32'}\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe`;\n\treturn isAtLeastWindows10 ? powerShellPath : processes.getWindowsShell(env);\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as nls from 'vs/nls';\nimport * as platform from 'vs/base/common/platform';\nimport { ScrollbarVisibility } from 'vs/base/common/scrollable';\nimport { FontInfo } from 'vs/editor/common/config/fontInfo';\nimport { Constants } from 'vs/base/common/uint';\nimport { USUAL_WORD_SEPARATORS } from 'vs/editor/common/model/wordHelper';\nimport { AccessibilitySupport } from 'vs/platform/accessibility/common/accessibility';\nimport { IConfigurationPropertySchema } from 'vs/platform/configuration/common/configurationRegistry';\nimport { IJSONSchema } from 'vs/base/common/jsonSchema';\n\n//#region typed options\n\n/**\n * Configuration options for auto closing quotes and brackets\n */\nexport type EditorAutoClosingStrategy = 'always' | 'languageDefined' | 'beforeWhitespace' | 'never';\n\n/**\n * Configuration options for auto wrapping quotes and brackets\n */\nexport type EditorAutoSurroundStrategy = 'languageDefined' | 'quotes' | 'brackets' | 'never';\n\n/**\n * Configuration options for typing over closing quotes or brackets\n */\nexport type EditorAutoClosingOvertypeStrategy = 'always' | 'auto' | 'never';\n\n/**\n * Configuration options for auto indentation in the editor\n */\nexport const enum EditorAutoIndentStrategy {\n\tNone = 0,\n\tKeep = 1,\n\tBrackets = 2,\n\tAdvanced = 3,\n\tFull = 4\n}\n\n/**\n * Configuration options for the editor.\n */\nexport interface IEditorOptions {\n\t/**\n\t * This editor is used inside a diff editor.\n\t */\n\tinDiffEditor?: boolean;\n\t/**\n\t * The aria label for the editor's textarea (when it is focused).\n\t */\n\tariaLabel?: string;\n\t/**\n\t * The `tabindex` property of the editor's textarea\n\t */\n\ttabIndex?: number;\n\t/**\n\t * Render vertical lines at the specified columns.\n\t * Defaults to empty array.\n\t */\n\trulers?: (number | IRulerOption)[];\n\t/**\n\t * A string containing the word separators used when doing word navigation.\n\t * Defaults to `~!@#$%^&*()-=+[{]}\\\\|;:\\'\",.<>/?\n\t */\n\twordSeparators?: string;\n\t/**\n\t * Enable Linux primary clipboard.\n\t * Defaults to true.\n\t */\n\tselectionClipboard?: boolean;\n\t/**\n\t * Control the rendering of line numbers.\n\t * If it is a function, it will be invoked when rendering a line number and the return value will be rendered.\n\t * Otherwise, if it is a truey, line numbers will be rendered normally (equivalent of using an identity function).\n\t * Otherwise, line numbers will not be rendered.\n\t * Defaults to `on`.\n\t */\n\tlineNumbers?: LineNumbersType;\n\t/**\n\t * Controls the minimal number of visible leading and trailing lines surrounding the cursor.\n\t * Defaults to 0.\n\t*/\n\tcursorSurroundingLines?: number;\n\t/**\n\t * Controls when `cursorSurroundingLines` should be enforced\n\t * Defaults to `default`, `cursorSurroundingLines` is not enforced when cursor position is changed\n\t * by mouse.\n\t*/\n\tcursorSurroundingLinesStyle?: 'default' | 'all';\n\t/**\n\t * Render last line number when the file ends with a newline.\n\t * Defaults to true.\n\t*/\n\trenderFinalNewline?: boolean;\n\t/**\n\t * Remove unusual line terminators like LINE SEPARATOR (LS), PARAGRAPH SEPARATOR (PS).\n\t * Defaults to 'prompt'.\n\t */\n\tunusualLineTerminators?: 'auto' | 'off' | 'prompt';\n\t/**\n\t * Should the corresponding line be selected when clicking on the line number?\n\t * Defaults to true.\n\t */\n\tselectOnLineNumbers?: boolean;\n\t/**\n\t * Control the width of line numbers, by reserving horizontal space for rendering at least an amount of digits.\n\t * Defaults to 5.\n\t */\n\tlineNumbersMinChars?: number;\n\t/**\n\t * Enable the rendering of the glyph margin.\n\t * Defaults to true in vscode and to false in monaco-editor.\n\t */\n\tglyphMargin?: boolean;\n\t/**\n\t * The width reserved for line decorations (in px).\n\t * Line decorations are placed between line numbers and the editor content.\n\t * You can pass in a string in the format floating point followed by \"ch\". e.g. 1.3ch.\n\t * Defaults to 10.\n\t */\n\tlineDecorationsWidth?: number | string;\n\t/**\n\t * When revealing the cursor, a virtual padding (px) is added to the cursor, turning it into a rectangle.\n\t * This virtual padding ensures that the cursor gets revealed before hitting the edge of the viewport.\n\t * Defaults to 30 (px).\n\t */\n\trevealHorizontalRightPadding?: number;\n\t/**\n\t * Render the editor selection with rounded borders.\n\t * Defaults to true.\n\t */\n\troundedSelection?: boolean;\n\t/**\n\t * Class name to be added to the editor.\n\t */\n\textraEditorClassName?: string;\n\t/**\n\t * Should the editor be read only.\n\t * Defaults to false.\n\t */\n\treadOnly?: boolean;\n\t/**\n\t * Enable linked editing.\n\t * Defaults to false.\n\t */\n\tlinkedEditing?: boolean;\n\t/**\n\t * deprecated, use linkedEditing instead\n\t */\n\trenameOnType?: boolean;\n\t/**\n\t * Should the editor render validation decorations.\n\t * Defaults to editable.\n\t */\n\trenderValidationDecorations?: 'editable' | 'on' | 'off';\n\t/**\n\t * Control the behavior and rendering of the scrollbars.\n\t */\n\tscrollbar?: IEditorScrollbarOptions;\n\t/**\n\t * Control the behavior and rendering of the minimap.\n\t */\n\tminimap?: IEditorMinimapOptions;\n\t/**\n\t * Control the behavior of the find widget.\n\t */\n\tfind?: IEditorFindOptions;\n\t/**\n\t * Display overflow widgets as `fixed`.\n\t * Defaults to `false`.\n\t */\n\tfixedOverflowWidgets?: boolean;\n\t/**\n\t * The number of vertical lanes the overview ruler should render.\n\t * Defaults to 3.\n\t */\n\toverviewRulerLanes?: number;\n\t/**\n\t * Controls if a border should be drawn around the overview ruler.\n\t * Defaults to `true`.\n\t */\n\toverviewRulerBorder?: boolean;\n\t/**\n\t * Control the cursor animation style, possible values are 'blink', 'smooth', 'phase', 'expand' and 'solid'.\n\t * Defaults to 'blink'.\n\t */\n\tcursorBlinking?: 'blink' | 'smooth' | 'phase' | 'expand' | 'solid';\n\t/**\n\t * Zoom the font in the editor when using the mouse wheel in combination with holding Ctrl.\n\t * Defaults to false.\n\t */\n\tmouseWheelZoom?: boolean;\n\t/**\n\t * Control the mouse pointer style, either 'text' or 'default' or 'copy'\n\t * Defaults to 'text'\n\t */\n\tmouseStyle?: 'text' | 'default' | 'copy';\n\t/**\n\t * Enable smooth caret animation.\n\t * Defaults to false.\n\t */\n\tcursorSmoothCaretAnimation?: boolean;\n\t/**\n\t * Control the cursor style, either 'block' or 'line'.\n\t * Defaults to 'line'.\n\t */\n\tcursorStyle?: 'line' | 'block' | 'underline' | 'line-thin' | 'block-outline' | 'underline-thin';\n\t/**\n\t * Control the width of the cursor when cursorStyle is set to 'line'\n\t */\n\tcursorWidth?: number;\n\t/**\n\t * Enable font ligatures.\n\t * Defaults to false.\n\t */\n\tfontLigatures?: boolean | string;\n\t/**\n\t * Disable the use of `transform: translate3d(0px, 0px, 0px)` for the editor margin and lines layers.\n\t * The usage of `transform: translate3d(0px, 0px, 0px)` acts as a hint for browsers to create an extra layer.\n\t * Defaults to false.\n\t */\n\tdisableLayerHinting?: boolean;\n\t/**\n\t * Disable the optimizations for monospace fonts.\n\t * Defaults to false.\n\t */\n\tdisableMonospaceOptimizations?: boolean;\n\t/**\n\t * Should the cursor be hidden in the overview ruler.\n\t * Defaults to false.\n\t */\n\thideCursorInOverviewRuler?: boolean;\n\t/**\n\t * Enable that scrolling can go one screen size after the last line.\n\t * Defaults to true.\n\t */\n\tscrollBeyondLastLine?: boolean;\n\t/**\n\t * Enable that scrolling can go beyond the last column by a number of columns.\n\t * Defaults to 5.\n\t */\n\tscrollBeyondLastColumn?: number;\n\t/**\n\t * Enable that the editor animates scrolling to a position.\n\t * Defaults to false.\n\t */\n\tsmoothScrolling?: boolean;\n\t/**\n\t * Enable that the editor will install an interval to check if its container dom node size has changed.\n\t * Enabling this might have a severe performance impact.\n\t * Defaults to false.\n\t */\n\tautomaticLayout?: boolean;\n\t/**\n\t * Control the wrapping of the editor.\n\t * When `wordWrap` = \"off\", the lines will never wrap.\n\t * When `wordWrap` = \"on\", the lines will wrap at the viewport width.\n\t * When `wordWrap` = \"wordWrapColumn\", the lines will wrap at `wordWrapColumn`.\n\t * When `wordWrap` = \"bounded\", the lines will wrap at min(viewport width, wordWrapColumn).\n\t * Defaults to \"off\".\n\t */\n\twordWrap?: 'off' | 'on' | 'wordWrapColumn' | 'bounded';\n\t/**\n\t * Override the `wordWrap` setting.\n\t */\n\twordWrapOverride1?: 'off' | 'on' | 'inherit';\n\t/**\n\t * Override the `wordWrapOverride1` setting.\n\t */\n\twordWrapOverride2?: 'off' | 'on' | 'inherit';\n\t/**\n\t * Control the wrapping of the editor.\n\t * When `wordWrap` = \"off\", the lines will never wrap.\n\t * When `wordWrap` = \"on\", the lines will wrap at the viewport width.\n\t * When `wordWrap` = \"wordWrapColumn\", the lines will wrap at `wordWrapColumn`.\n\t * When `wordWrap` = \"bounded\", the lines will wrap at min(viewport width, wordWrapColumn).\n\t * Defaults to 80.\n\t */\n\twordWrapColumn?: number;\n\t/**\n\t * Control indentation of wrapped lines. Can be: 'none', 'same', 'indent' or 'deepIndent'.\n\t * Defaults to 'same' in vscode and to 'none' in monaco-editor.\n\t */\n\twrappingIndent?: 'none' | 'same' | 'indent' | 'deepIndent';\n\t/**\n\t * Controls the wrapping strategy to use.\n\t * Defaults to 'simple'.\n\t */\n\twrappingStrategy?: 'simple' | 'advanced';\n\t/**\n\t * Configure word wrapping characters. A break will be introduced before these characters.\n\t * Defaults to '([{‘“〈《「『【〔（［｛｢£¥＄￡￥+＋'.\n\t */\n\twordWrapBreakBeforeCharacters?: string;\n\t/**\n\t * Configure word wrapping characters. A break will be introduced after these characters.\n\t * Defaults to ' \\t})]?|/&.,;¢°′″‰℃、。｡､￠，．：；？！％・･ゝゞヽヾーァィゥェォッャュョヮヵヶぁぃぅぇぉっゃゅょゎゕゖㇰㇱㇲㇳㇴㇵㇶㇷㇸㇹㇺㇻㇼㇽㇾㇿ々〻ｧｨｩｪｫｬｭｮｯｰ”〉》」』】〕）］｝｣'.\n\t */\n\twordWrapBreakAfterCharacters?: string;\n\t/**\n\t * Performance guard: Stop rendering a line after x characters.\n\t * Defaults to 10000.\n\t * Use -1 to never stop rendering\n\t */\n\tstopRenderingLineAfter?: number;\n\t/**\n\t * Configure the editor's hover.\n\t */\n\thover?: IEditorHoverOptions;\n\t/**\n\t * Enable detecting links and making them clickable.\n\t * Defaults to true.\n\t */\n\tlinks?: boolean;\n\t/**\n\t * Enable inline color decorators and color picker rendering.\n\t */\n\tcolorDecorators?: boolean;\n\t/**\n\t * Control the behaviour of comments in the editor.\n\t */\n\tcomments?: IEditorCommentsOptions;\n\t/**\n\t * Enable custom contextmenu.\n\t * Defaults to true.\n\t */\n\tcontextmenu?: boolean;\n\t/**\n\t * A multiplier to be used on the `deltaX` and `deltaY` of mouse wheel scroll events.\n\t * Defaults to 1.\n\t */\n\tmouseWheelScrollSensitivity?: number;\n\t/**\n\t * FastScrolling mulitplier speed when pressing `Alt`\n\t * Defaults to 5.\n\t */\n\tfastScrollSensitivity?: number;\n\t/**\n\t * Enable that the editor scrolls only the predominant axis. Prevents horizontal drift when scrolling vertically on a trackpad.\n\t * Defaults to true.\n\t */\n\tscrollPredominantAxis?: boolean;\n\t/**\n\t * Enable that the selection with the mouse and keys is doing column selection.\n\t * Defaults to false.\n\t */\n\tcolumnSelection?: boolean;\n\t/**\n\t * The modifier to be used to add multiple cursors with the mouse.\n\t * Defaults to 'alt'\n\t */\n\tmultiCursorModifier?: 'ctrlCmd' | 'alt';\n\t/**\n\t * Merge overlapping selections.\n\t * Defaults to true\n\t */\n\tmultiCursorMergeOverlapping?: boolean;\n\t/**\n\t * Configure the behaviour when pasting a text with the line count equal to the cursor count.\n\t * Defaults to 'spread'.\n\t */\n\tmultiCursorPaste?: 'spread' | 'full';\n\t/**\n\t * Configure the editor's accessibility support.\n\t * Defaults to 'auto'. It is best to leave this to 'auto'.\n\t */\n\taccessibilitySupport?: 'auto' | 'off' | 'on';\n\t/**\n\t * Controls the number of lines in the editor that can be read out by a screen reader\n\t */\n\taccessibilityPageSize?: number;\n\t/**\n\t * Suggest options.\n\t */\n\tsuggest?: ISuggestOptions;\n\t/**\n\t * Smart select opptions;\n\t */\n\tsmartSelect?: ISmartSelectOptions;\n\t/**\n\t *\n\t */\n\tgotoLocation?: IGotoLocationOptions;\n\t/**\n\t * Enable quick suggestions (shadow suggestions)\n\t * Defaults to true.\n\t */\n\tquickSuggestions?: boolean | IQuickSuggestionsOptions;\n\t/**\n\t * Quick suggestions show delay (in ms)\n\t * Defaults to 10 (ms)\n\t */\n\tquickSuggestionsDelay?: number;\n\t/**\n\t * Controls the spacing around the editor.\n\t */\n\tpadding?: IEditorPaddingOptions;\n\t/**\n\t * Parameter hint options.\n\t */\n\tparameterHints?: IEditorParameterHintOptions;\n\t/**\n\t * Options for auto closing brackets.\n\t * Defaults to language defined behavior.\n\t */\n\tautoClosingBrackets?: EditorAutoClosingStrategy;\n\t/**\n\t * Options for auto closing quotes.\n\t * Defaults to language defined behavior.\n\t */\n\tautoClosingQuotes?: EditorAutoClosingStrategy;\n\t/**\n\t * Options for typing over closing quotes or brackets.\n\t */\n\tautoClosingOvertype?: EditorAutoClosingOvertypeStrategy;\n\t/**\n\t * Options for auto surrounding.\n\t * Defaults to always allowing auto surrounding.\n\t */\n\tautoSurround?: EditorAutoSurroundStrategy;\n\t/**\n\t * Controls whether the editor should automatically adjust the indentation when users type, paste, move or indent lines.\n\t * Defaults to advanced.\n\t */\n\tautoIndent?: 'none' | 'keep' | 'brackets' | 'advanced' | 'full';\n\t/**\n\t * Emulate selection behaviour of tab characters when using spaces for indentation.\n\t * This means selection will stick to tab stops.\n\t */\n\tstickyTabStops?: boolean;\n\t/**\n\t * Enable format on type.\n\t * Defaults to false.\n\t */\n\tformatOnType?: boolean;\n\t/**\n\t * Enable format on paste.\n\t * Defaults to false.\n\t */\n\tformatOnPaste?: boolean;\n\t/**\n\t * Controls if the editor should allow to move selections via drag and drop.\n\t * Defaults to false.\n\t */\n\tdragAndDrop?: boolean;\n\t/**\n\t * Enable the suggestion box to pop-up on trigger characters.\n\t * Defaults to true.\n\t */\n\tsuggestOnTriggerCharacters?: boolean;\n\t/**\n\t * Accept suggestions on ENTER.\n\t * Defaults to 'on'.\n\t */\n\tacceptSuggestionOnEnter?: 'on' | 'smart' | 'off';\n\t/**\n\t * Accept suggestions on provider defined characters.\n\t * Defaults to true.\n\t */\n\tacceptSuggestionOnCommitCharacter?: boolean;\n\t/**\n\t * Enable snippet suggestions. Default to 'true'.\n\t */\n\tsnippetSuggestions?: 'top' | 'bottom' | 'inline' | 'none';\n\t/**\n\t * Copying without a selection copies the current line.\n\t */\n\temptySelectionClipboard?: boolean;\n\t/**\n\t * Syntax highlighting is copied.\n\t */\n\tcopyWithSyntaxHighlighting?: boolean;\n\t/**\n\t * The history mode for suggestions.\n\t */\n\tsuggestSelection?: 'first' | 'recentlyUsed' | 'recentlyUsedByPrefix';\n\t/**\n\t * The font size for the suggest widget.\n\t * Defaults to the editor font size.\n\t */\n\tsuggestFontSize?: number;\n\t/**\n\t * The line height for the suggest widget.\n\t * Defaults to the editor line height.\n\t */\n\tsuggestLineHeight?: number;\n\t/**\n\t * Enable tab completion.\n\t */\n\ttabCompletion?: 'on' | 'off' | 'onlySnippets';\n\t/**\n\t * Enable selection highlight.\n\t * Defaults to true.\n\t */\n\tselectionHighlight?: boolean;\n\t/**\n\t * Enable semantic occurrences highlight.\n\t * Defaults to true.\n\t */\n\toccurrencesHighlight?: boolean;\n\t/**\n\t * Show code lens\n\t * Defaults to true.\n\t */\n\tcodeLens?: boolean;\n\t/**\n\t * Code lens font family. Defaults to editor font family.\n\t */\n\tcodeLensFontFamily?: string;\n\t/**\n\t * Code lens font size. Default to 90% of the editor font size\n\t */\n\tcodeLensFontSize?: number;\n\t/**\n\t * Control the behavior and rendering of the code action lightbulb.\n\t */\n\tlightbulb?: IEditorLightbulbOptions;\n\t/**\n\t * Timeout for running code actions on save.\n\t */\n\tcodeActionsOnSaveTimeout?: number;\n\t/**\n\t * Enable code folding.\n\t * Defaults to true.\n\t */\n\tfolding?: boolean;\n\t/**\n\t * Selects the folding strategy. 'auto' uses the strategies contributed for the current document, 'indentation' uses the indentation based folding strategy.\n\t * Defaults to 'auto'.\n\t */\n\tfoldingStrategy?: 'auto' | 'indentation';\n\t/**\n\t * Enable highlight for folded regions.\n\t * Defaults to true.\n\t */\n\tfoldingHighlight?: boolean;\n\t/**\n\t * Controls whether the fold actions in the gutter stay always visible or hide unless the mouse is over the gutter.\n\t * Defaults to 'mouseover'.\n\t */\n\tshowFoldingControls?: 'always' | 'mouseover';\n\t/**\n\t * Controls whether clicking on the empty content after a folded line will unfold the line.\n\t * Defaults to false.\n\t */\n\tunfoldOnClickAfterEndOfLine?: boolean;\n\t/**\n\t * Enable highlighting of matching brackets.\n\t * Defaults to 'always'.\n\t */\n\tmatchBrackets?: 'never' | 'near' | 'always';\n\t/**\n\t * Enable rendering of whitespace.\n\t * Defaults to none.\n\t */\n\trenderWhitespace?: 'none' | 'boundary' | 'selection' | 'trailing' | 'all';\n\t/**\n\t * Enable rendering of control characters.\n\t * Defaults to false.\n\t */\n\trenderControlCharacters?: boolean;\n\t/**\n\t * Enable rendering of indent guides.\n\t * Defaults to true.\n\t */\n\trenderIndentGuides?: boolean;\n\t/**\n\t * Enable highlighting of the active indent guide.\n\t * Defaults to true.\n\t */\n\thighlightActiveIndentGuide?: boolean;\n\t/**\n\t * Enable rendering of current line highlight.\n\t * Defaults to all.\n\t */\n\trenderLineHighlight?: 'none' | 'gutter' | 'line' | 'all';\n\t/**\n\t * Control if the current line highlight should be rendered only the editor is focused.\n\t * Defaults to false.\n\t */\n\trenderLineHighlightOnlyWhenFocus?: boolean;\n\t/**\n\t * Inserting and deleting whitespace follows tab stops.\n\t */\n\tuseTabStops?: boolean;\n\t/**\n\t * The font family\n\t */\n\tfontFamily?: string;\n\t/**\n\t * The font weight\n\t */\n\tfontWeight?: string;\n\t/**\n\t * The font size\n\t */\n\tfontSize?: number;\n\t/**\n\t * The line height\n\t */\n\tlineHeight?: number;\n\t/**\n\t * The letter spacing\n\t */\n\tletterSpacing?: number;\n\t/**\n\t * Controls fading out of unused variables.\n\t */\n\tshowUnused?: boolean;\n\t/**\n\t * Controls whether to focus the inline editor in the peek widget by default.\n\t * Defaults to false.\n\t */\n\tpeekWidgetDefaultFocus?: 'tree' | 'editor';\n\t/**\n\t * Controls whether the definition link opens element in the peek widget.\n\t * Defaults to false.\n\t */\n\tdefinitionLinkOpensInPeek?: boolean;\n\t/**\n\t * Controls strikethrough deprecated variables.\n\t */\n\tshowDeprecated?: boolean;\n\t/**\n\t * Control the behavior and rendering of the inline hints.\n\t */\n\tinlineHints?: IEditorInlineHintsOptions;\n}\n\n/**\n * @internal\n * The width of the minimap gutter, in pixels.\n */\nexport const MINIMAP_GUTTER_WIDTH = 8;\n\n/**\n * Configuration options for the diff editor.\n */\nexport interface IDiffEditorOptions extends IEditorOptions {\n\t/**\n\t * Allow the user to resize the diff editor split view.\n\t * Defaults to true.\n\t */\n\tenableSplitViewResizing?: boolean;\n\t/**\n\t * Render the differences in two side-by-side editors.\n\t * Defaults to true.\n\t */\n\trenderSideBySide?: boolean;\n\t/**\n\t * Timeout in milliseconds after which diff computation is cancelled.\n\t * Defaults to 5000.\n\t */\n\tmaxComputationTime?: number;\n\t/**\n\t * Compute the diff by ignoring leading/trailing whitespace\n\t * Defaults to true.\n\t */\n\tignoreTrimWhitespace?: boolean;\n\t/**\n\t * Render +/- indicators for added/deleted changes.\n\t * Defaults to true.\n\t */\n\trenderIndicators?: boolean;\n\t/**\n\t * Original model should be editable?\n\t * Defaults to false.\n\t */\n\toriginalEditable?: boolean;\n\t/**\n\t * Should the diff editor enable code lens?\n\t * Defaults to false.\n\t */\n\tdiffCodeLens?: boolean;\n\t/**\n\t * Is the diff editor inside another editor\n\t * Defaults to false\n\t */\n\tisInEmbeddedEditor?: boolean;\n\t/**\n\t * Is the diff editor should render overview ruler\n\t * Defaults to true\n\t */\n\trenderOverviewRuler?: boolean;\n\t/**\n\t * Control the wrapping of the diff editor.\n\t */\n\tdiffWordWrap?: 'off' | 'on' | 'inherit';\n}\n\n//#endregion\n\n/**\n * An event describing that the configuration of the editor has changed.\n */\nexport class ConfigurationChangedEvent {\n\tprivate readonly _values: boolean[];\n\t/**\n\t * @internal\n\t */\n\tconstructor(values: boolean[]) {\n\t\tthis._values = values;\n\t}\n\tpublic hasChanged(id: EditorOption): boolean {\n\t\treturn this._values[id];\n\t}\n}\n\n/**\n * @internal\n */\nexport class ValidatedEditorOptions {\n\tprivate readonly _values: any[] = [];\n\tpublic _read<T>(option: EditorOption): T {\n\t\treturn this._values[option];\n\t}\n\tpublic get<T extends EditorOption>(id: T): FindComputedEditorOptionValueById<T> {\n\t\treturn this._values[id];\n\t}\n\tpublic _write<T>(option: EditorOption, value: T): void {\n\t\tthis._values[option] = value;\n\t}\n}\n\n/**\n * All computed editor options.\n */\nexport interface IComputedEditorOptions {\n\tget<T extends EditorOption>(id: T): FindComputedEditorOptionValueById<T>;\n}\n\n//#region IEditorOption\n\n/**\n * @internal\n */\nexport interface IEnvironmentalOptions {\n\treadonly memory: ComputeOptionsMemory | null;\n\treadonly outerWidth: number;\n\treadonly outerHeight: number;\n\treadonly fontInfo: FontInfo;\n\treadonly extraEditorClassName: string;\n\treadonly isDominatedByLongLines: boolean;\n\treadonly viewLineCount: number;\n\treadonly lineNumbersDigitCount: number;\n\treadonly emptySelectionClipboard: boolean;\n\treadonly pixelRatio: number;\n\treadonly tabFocusMode: boolean;\n\treadonly accessibilitySupport: AccessibilitySupport;\n}\n\n/**\n * @internal\n */\nexport class ComputeOptionsMemory {\n\n\tpublic stableMinimapLayoutInput: IMinimapLayoutInput | null;\n\tpublic stableFitMaxMinimapScale: number;\n\tpublic stableFitRemainingWidth: number;\n\n\tconstructor() {\n\t\tthis.stableMinimapLayoutInput = null;\n\t\tthis.stableFitMaxMinimapScale = 0;\n\t\tthis.stableFitRemainingWidth = 0;\n\t}\n}\n\nexport interface IEditorOption<K1 extends EditorOption, V> {\n\treadonly id: K1;\n\treadonly name: string;\n\tdefaultValue: V;\n\t/**\n\t * @internal\n\t */\n\treadonly schema: IConfigurationPropertySchema | { [path: string]: IConfigurationPropertySchema; } | undefined;\n\t/**\n\t * @internal\n\t */\n\tvalidate(input: any): V;\n\t/**\n\t * @internal\n\t */\n\tcompute(env: IEnvironmentalOptions, options: IComputedEditorOptions, value: V): V;\n}\n\ntype PossibleKeyName0<V> = { [K in keyof IEditorOptions]: IEditorOptions[K] extends V | undefined ? K : never }[keyof IEditorOptions];\ntype PossibleKeyName<V> = NonNullable<PossibleKeyName0<V>>;\n\n/**\n * @internal\n */\nabstract class BaseEditorOption<K1 extends EditorOption, V> implements IEditorOption<K1, V> {\n\n\tpublic readonly id: K1;\n\tpublic readonly name: string;\n\tpublic readonly defaultValue: V;\n\tpublic readonly schema: IConfigurationPropertySchema | { [path: string]: IConfigurationPropertySchema; } | undefined;\n\n\tconstructor(id: K1, name: string, defaultValue: V, schema?: IConfigurationPropertySchema | { [path: string]: IConfigurationPropertySchema; }) {\n\t\tthis.id = id;\n\t\tthis.name = name;\n\t\tthis.defaultValue = defaultValue;\n\t\tthis.schema = schema;\n\t}\n\n\tpublic abstract validate(input: any): V;\n\n\tpublic compute(env: IEnvironmentalOptions, options: IComputedEditorOptions, value: V): V {\n\t\treturn value;\n\t}\n}\n\n/**\n * @internal\n */\nabstract class ComputedEditorOption<K1 extends EditorOption, V> implements IEditorOption<K1, V> {\n\n\tpublic readonly id: K1;\n\tpublic readonly name: '_never_';\n\tpublic readonly defaultValue: V;\n\tpublic readonly deps: EditorOption[] | null;\n\tpublic readonly schema: IConfigurationPropertySchema | undefined = undefined;\n\n\tconstructor(id: K1, deps: EditorOption[] | null = null) {\n\t\tthis.id = id;\n\t\tthis.name = '_never_';\n\t\tthis.defaultValue = <any>undefined;\n\t\tthis.deps = deps;\n\t}\n\n\tpublic validate(input: any): V {\n\t\treturn this.defaultValue;\n\t}\n\n\tpublic abstract compute(env: IEnvironmentalOptions, options: IComputedEditorOptions, value: V): V;\n}\n\nclass SimpleEditorOption<K1 extends EditorOption, V> implements IEditorOption<K1, V> {\n\n\tpublic readonly id: K1;\n\tpublic readonly name: PossibleKeyName<V>;\n\tpublic readonly defaultValue: V;\n\tpublic readonly schema: IConfigurationPropertySchema | undefined;\n\n\tconstructor(id: K1, name: PossibleKeyName<V>, defaultValue: V, schema?: IConfigurationPropertySchema) {\n\t\tthis.id = id;\n\t\tthis.name = name;\n\t\tthis.defaultValue = defaultValue;\n\t\tthis.schema = schema;\n\t}\n\n\tpublic validate(input: any): V {\n\t\tif (typeof input === 'undefined') {\n\t\t\treturn this.defaultValue;\n\t\t}\n\t\treturn input as any;\n\t}\n\n\tpublic compute(env: IEnvironmentalOptions, options: IComputedEditorOptions, value: V): V {\n\t\treturn value;\n\t}\n}\n\n/**\n * @internal\n */\nexport function boolean(value: any, defaultValue: boolean): boolean {\n\tif (typeof value === 'undefined') {\n\t\treturn defaultValue;\n\t}\n\tif (value === 'false') {\n\t\t// treat the string 'false' as false\n\t\treturn false;\n\t}\n\treturn Boolean(value);\n}\n\nclass EditorBooleanOption<K1 extends EditorOption> extends SimpleEditorOption<K1, boolean> {\n\n\tconstructor(id: K1, name: PossibleKeyName<boolean>, defaultValue: boolean, schema: IConfigurationPropertySchema | undefined = undefined) {\n\t\tif (typeof schema !== 'undefined') {\n\t\t\tschema.type = 'boolean';\n\t\t\tschema.default = defaultValue;\n\t\t}\n\t\tsuper(id, name, defaultValue, schema);\n\t}\n\n\tpublic validate(input: any): boolean {\n\t\treturn boolean(input, this.defaultValue);\n\t}\n}\n\nclass EditorIntOption<K1 extends EditorOption> extends SimpleEditorOption<K1, number> {\n\n\tpublic static clampedInt<T>(value: any, defaultValue: T, minimum: number, maximum: number): number | T {\n\t\tif (typeof value === 'undefined') {\n\t\t\treturn defaultValue;\n\t\t}\n\t\tlet r = parseInt(value, 10);\n\t\tif (isNaN(r)) {\n\t\t\treturn defaultValue;\n\t\t}\n\t\tr = Math.max(minimum, r);\n\t\tr = Math.min(maximum, r);\n\t\treturn r | 0;\n\t}\n\n\tpublic readonly minimum: number;\n\tpublic readonly maximum: number;\n\n\tconstructor(id: K1, name: PossibleKeyName<number>, defaultValue: number, minimum: number, maximum: number, schema: IConfigurationPropertySchema | undefined = undefined) {\n\t\tif (typeof schema !== 'undefined') {\n\t\t\tschema.type = 'integer';\n\t\t\tschema.default = defaultValue;\n\t\t\tschema.minimum = minimum;\n\t\t\tschema.maximum = maximum;\n\t\t}\n\t\tsuper(id, name, defaultValue, schema);\n\t\tthis.minimum = minimum;\n\t\tthis.maximum = maximum;\n\t}\n\n\tpublic validate(input: any): number {\n\t\treturn EditorIntOption.clampedInt(input, this.defaultValue, this.minimum, this.maximum);\n\t}\n}\n\nclass EditorFloatOption<K1 extends EditorOption> extends SimpleEditorOption<K1, number> {\n\n\tpublic static clamp(n: number, min: number, max: number): number {\n\t\tif (n < min) {\n\t\t\treturn min;\n\t\t}\n\t\tif (n > max) {\n\t\t\treturn max;\n\t\t}\n\t\treturn n;\n\t}\n\n\tpublic static float(value: any, defaultValue: number): number {\n\t\tif (typeof value === 'number') {\n\t\t\treturn value;\n\t\t}\n\t\tif (typeof value === 'undefined') {\n\t\t\treturn defaultValue;\n\t\t}\n\t\tconst r = parseFloat(value);\n\t\treturn (isNaN(r) ? defaultValue : r);\n\t}\n\n\tpublic readonly validationFn: (value: number) => number;\n\n\tconstructor(id: K1, name: PossibleKeyName<number>, defaultValue: number, validationFn: (value: number) => number, schema?: IConfigurationPropertySchema) {\n\t\tif (typeof schema !== 'undefined') {\n\t\t\tschema.type = 'number';\n\t\t\tschema.default = defaultValue;\n\t\t}\n\t\tsuper(id, name, defaultValue, schema);\n\t\tthis.validationFn = validationFn;\n\t}\n\n\tpublic validate(input: any): number {\n\t\treturn this.validationFn(EditorFloatOption.float(input, this.defaultValue));\n\t}\n}\n\nclass EditorStringOption<K1 extends EditorOption> extends SimpleEditorOption<K1, string> {\n\n\tpublic static string(value: any, defaultValue: string): string {\n\t\tif (typeof value !== 'string') {\n\t\t\treturn defaultValue;\n\t\t}\n\t\treturn value;\n\t}\n\n\tconstructor(id: K1, name: PossibleKeyName<string>, defaultValue: string, schema: IConfigurationPropertySchema | undefined = undefined) {\n\t\tif (typeof schema !== 'undefined') {\n\t\t\tschema.type = 'string';\n\t\t\tschema.default = defaultValue;\n\t\t}\n\t\tsuper(id, name, defaultValue, schema);\n\t}\n\n\tpublic validate(input: any): string {\n\t\treturn EditorStringOption.string(input, this.defaultValue);\n\t}\n}\n\n/**\n * @internal\n */\nexport function stringSet<T>(value: T | undefined, defaultValue: T, allowedValues: ReadonlyArray<T>): T {\n\tif (typeof value !== 'string') {\n\t\treturn defaultValue;\n\t}\n\tif (allowedValues.indexOf(value) === -1) {\n\t\treturn defaultValue;\n\t}\n\treturn value;\n}\n\nclass EditorStringEnumOption<K1 extends EditorOption, V extends string> extends SimpleEditorOption<K1, V> {\n\n\tprivate readonly _allowedValues: ReadonlyArray<V>;\n\n\tconstructor(id: K1, name: PossibleKeyName<V>, defaultValue: V, allowedValues: ReadonlyArray<V>, schema: IConfigurationPropertySchema | undefined = undefined) {\n\t\tif (typeof schema !== 'undefined') {\n\t\t\tschema.type = 'string';\n\t\t\tschema.enum = <any>allowedValues;\n\t\t\tschema.default = defaultValue;\n\t\t}\n\t\tsuper(id, name, defaultValue, schema);\n\t\tthis._allowedValues = allowedValues;\n\t}\n\n\tpublic validate(input: any): V {\n\t\treturn stringSet<V>(input, this.defaultValue, this._allowedValues);\n\t}\n}\n\nclass EditorEnumOption<K1 extends EditorOption, T extends string, V> extends BaseEditorOption<K1, V> {\n\n\tprivate readonly _allowedValues: T[];\n\tprivate readonly _convert: (value: T) => V;\n\n\tconstructor(id: K1, name: PossibleKeyName<T>, defaultValue: V, defaultStringValue: string, allowedValues: T[], convert: (value: T) => V, schema: IConfigurationPropertySchema | undefined = undefined) {\n\t\tif (typeof schema !== 'undefined') {\n\t\t\tschema.type = 'string';\n\t\t\tschema.enum = allowedValues;\n\t\t\tschema.default = defaultStringValue;\n\t\t}\n\t\tsuper(id, name, defaultValue, schema);\n\t\tthis._allowedValues = allowedValues;\n\t\tthis._convert = convert;\n\t}\n\n\tpublic validate(input: any): V {\n\t\tif (typeof input !== 'string') {\n\t\t\treturn this.defaultValue;\n\t\t}\n\t\tif (this._allowedValues.indexOf(<T>input) === -1) {\n\t\t\treturn this.defaultValue;\n\t\t}\n\t\treturn this._convert(<any>input);\n\t}\n}\n\n//#endregion\n\n//#region autoIndent\n\nfunction _autoIndentFromString(autoIndent: 'none' | 'keep' | 'brackets' | 'advanced' | 'full'): EditorAutoIndentStrategy {\n\tswitch (autoIndent) {\n\t\tcase 'none': return EditorAutoIndentStrategy.None;\n\t\tcase 'keep': return EditorAutoIndentStrategy.Keep;\n\t\tcase 'brackets': return EditorAutoIndentStrategy.Brackets;\n\t\tcase 'advanced': return EditorAutoIndentStrategy.Advanced;\n\t\tcase 'full': return EditorAutoIndentStrategy.Full;\n\t}\n}\n\n//#endregion\n\n//#region accessibilitySupport\n\nclass EditorAccessibilitySupport extends BaseEditorOption<EditorOption.accessibilitySupport, AccessibilitySupport> {\n\n\tconstructor() {\n\t\tsuper(\n\t\t\tEditorOption.accessibilitySupport, 'accessibilitySupport', AccessibilitySupport.Unknown,\n\t\t\t{\n\t\t\t\ttype: 'string',\n\t\t\t\tenum: ['auto', 'on', 'off'],\n\t\t\t\tenumDescriptions: [\n\t\t\t\t\tnls.localize('accessibilitySupport.auto', \"The editor will use platform APIs to detect when a Screen Reader is attached.\"),\n\t\t\t\t\tnls.localize('accessibilitySupport.on', \"The editor will be permanently optimized for usage with a Screen Reader. Word wrapping will be disabled.\"),\n\t\t\t\t\tnls.localize('accessibilitySupport.off', \"The editor will never be optimized for usage with a Screen Reader.\"),\n\t\t\t\t],\n\t\t\t\tdefault: 'auto',\n\t\t\t\tdescription: nls.localize('accessibilitySupport', \"Controls whether the editor should run in a mode where it is optimized for screen readers. Setting to on will disable word wrapping.\")\n\t\t\t}\n\t\t);\n\t}\n\n\tpublic validate(input: any): AccessibilitySupport {\n\t\tswitch (input) {\n\t\t\tcase 'auto': return AccessibilitySupport.Unknown;\n\t\t\tcase 'off': return AccessibilitySupport.Disabled;\n\t\t\tcase 'on': return AccessibilitySupport.Enabled;\n\t\t}\n\t\treturn this.defaultValue;\n\t}\n\n\tpublic compute(env: IEnvironmentalOptions, options: IComputedEditorOptions, value: AccessibilitySupport): AccessibilitySupport {\n\t\tif (value === AccessibilitySupport.Unknown) {\n\t\t\t// The editor reads the `accessibilitySupport` from the environment\n\t\t\treturn env.accessibilitySupport;\n\t\t}\n\t\treturn value;\n\t}\n}\n\n//#endregion\n\n//#region comments\n\n/**\n * Configuration options for editor comments\n */\nexport interface IEditorCommentsOptions {\n\t/**\n\t * Insert a space after the line comment token and inside the block comments tokens.\n\t * Defaults to true.\n\t */\n\tinsertSpace?: boolean;\n\t/**\n\t * Ignore empty lines when inserting line comments.\n\t * Defaults to true.\n\t */\n\tignoreEmptyLines?: boolean;\n}\n\nexport type EditorCommentsOptions = Readonly<Required<IEditorCommentsOptions>>;\n\nclass EditorComments extends BaseEditorOption<EditorOption.comments, EditorCommentsOptions> {\n\n\tconstructor() {\n\t\tconst defaults: EditorCommentsOptions = {\n\t\t\tinsertSpace: true,\n\t\t\tignoreEmptyLines: true,\n\t\t};\n\t\tsuper(\n\t\t\tEditorOption.comments, 'comments', defaults,\n\t\t\t{\n\t\t\t\t'editor.comments.insertSpace': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: defaults.insertSpace,\n\t\t\t\t\tdescription: nls.localize('comments.insertSpace', \"Controls whether a space character is inserted when commenting.\")\n\t\t\t\t},\n\t\t\t\t'editor.comments.ignoreEmptyLines': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: defaults.ignoreEmptyLines,\n\t\t\t\t\tdescription: nls.localize('comments.ignoreEmptyLines', 'Controls if empty lines should be ignored with toggle, add or remove actions for line comments.')\n\t\t\t\t},\n\t\t\t}\n\t\t);\n\t}\n\n\tpublic validate(_input: any): EditorCommentsOptions {\n\t\tif (!_input || typeof _input !== 'object') {\n\t\t\treturn this.defaultValue;\n\t\t}\n\t\tconst input = _input as IEditorCommentsOptions;\n\t\treturn {\n\t\t\tinsertSpace: boolean(input.insertSpace, this.defaultValue.insertSpace),\n\t\t\tignoreEmptyLines: boolean(input.ignoreEmptyLines, this.defaultValue.ignoreEmptyLines),\n\t\t};\n\t}\n}\n\n//#endregion\n\n//#region cursorBlinking\n\n/**\n * The kind of animation in which the editor's cursor should be rendered.\n */\nexport const enum TextEditorCursorBlinkingStyle {\n\t/**\n\t * Hidden\n\t */\n\tHidden = 0,\n\t/**\n\t * Blinking\n\t */\n\tBlink = 1,\n\t/**\n\t * Blinking with smooth fading\n\t */\n\tSmooth = 2,\n\t/**\n\t * Blinking with prolonged filled state and smooth fading\n\t */\n\tPhase = 3,\n\t/**\n\t * Expand collapse animation on the y axis\n\t */\n\tExpand = 4,\n\t/**\n\t * No-Blinking\n\t */\n\tSolid = 5\n}\n\nfunction _cursorBlinkingStyleFromString(cursorBlinkingStyle: 'blink' | 'smooth' | 'phase' | 'expand' | 'solid'): TextEditorCursorBlinkingStyle {\n\tswitch (cursorBlinkingStyle) {\n\t\tcase 'blink': return TextEditorCursorBlinkingStyle.Blink;\n\t\tcase 'smooth': return TextEditorCursorBlinkingStyle.Smooth;\n\t\tcase 'phase': return TextEditorCursorBlinkingStyle.Phase;\n\t\tcase 'expand': return TextEditorCursorBlinkingStyle.Expand;\n\t\tcase 'solid': return TextEditorCursorBlinkingStyle.Solid;\n\t}\n}\n\n//#endregion\n\n//#region cursorStyle\n\n/**\n * The style in which the editor's cursor should be rendered.\n */\nexport enum TextEditorCursorStyle {\n\t/**\n\t * As a vertical line (sitting between two characters).\n\t */\n\tLine = 1,\n\t/**\n\t * As a block (sitting on top of a character).\n\t */\n\tBlock = 2,\n\t/**\n\t * As a horizontal line (sitting under a character).\n\t */\n\tUnderline = 3,\n\t/**\n\t * As a thin vertical line (sitting between two characters).\n\t */\n\tLineThin = 4,\n\t/**\n\t * As an outlined block (sitting on top of a character).\n\t */\n\tBlockOutline = 5,\n\t/**\n\t * As a thin horizontal line (sitting under a character).\n\t */\n\tUnderlineThin = 6\n}\n\n/**\n * @internal\n */\nexport function cursorStyleToString(cursorStyle: TextEditorCursorStyle): 'line' | 'block' | 'underline' | 'line-thin' | 'block-outline' | 'underline-thin' {\n\tswitch (cursorStyle) {\n\t\tcase TextEditorCursorStyle.Line: return 'line';\n\t\tcase TextEditorCursorStyle.Block: return 'block';\n\t\tcase TextEditorCursorStyle.Underline: return 'underline';\n\t\tcase TextEditorCursorStyle.LineThin: return 'line-thin';\n\t\tcase TextEditorCursorStyle.BlockOutline: return 'block-outline';\n\t\tcase TextEditorCursorStyle.UnderlineThin: return 'underline-thin';\n\t}\n}\n\nfunction _cursorStyleFromString(cursorStyle: 'line' | 'block' | 'underline' | 'line-thin' | 'block-outline' | 'underline-thin'): TextEditorCursorStyle {\n\tswitch (cursorStyle) {\n\t\tcase 'line': return TextEditorCursorStyle.Line;\n\t\tcase 'block': return TextEditorCursorStyle.Block;\n\t\tcase 'underline': return TextEditorCursorStyle.Underline;\n\t\tcase 'line-thin': return TextEditorCursorStyle.LineThin;\n\t\tcase 'block-outline': return TextEditorCursorStyle.BlockOutline;\n\t\tcase 'underline-thin': return TextEditorCursorStyle.UnderlineThin;\n\t}\n}\n\n//#endregion\n\n//#region editorClassName\n\nclass EditorClassName extends ComputedEditorOption<EditorOption.editorClassName, string> {\n\n\tconstructor() {\n\t\tsuper(EditorOption.editorClassName, [EditorOption.mouseStyle, EditorOption.extraEditorClassName]);\n\t}\n\n\tpublic compute(env: IEnvironmentalOptions, options: IComputedEditorOptions, _: string): string {\n\t\tconst classNames = ['monaco-editor'];\n\t\tif (options.get(EditorOption.extraEditorClassName)) {\n\t\t\tclassNames.push(options.get(EditorOption.extraEditorClassName));\n\t\t}\n\t\tif (env.extraEditorClassName) {\n\t\t\tclassNames.push(env.extraEditorClassName);\n\t\t}\n\t\tif (options.get(EditorOption.mouseStyle) === 'default') {\n\t\t\tclassNames.push('mouse-default');\n\t\t} else if (options.get(EditorOption.mouseStyle) === 'copy') {\n\t\t\tclassNames.push('mouse-copy');\n\t\t}\n\n\t\tif (options.get(EditorOption.showUnused)) {\n\t\t\tclassNames.push('showUnused');\n\t\t}\n\n\t\tif (options.get(EditorOption.showDeprecated)) {\n\t\t\tclassNames.push('showDeprecated');\n\t\t}\n\n\t\treturn classNames.join(' ');\n\t}\n}\n\n//#endregion\n\n//#region emptySelectionClipboard\n\nclass EditorEmptySelectionClipboard extends EditorBooleanOption<EditorOption.emptySelectionClipboard> {\n\n\tconstructor() {\n\t\tsuper(\n\t\t\tEditorOption.emptySelectionClipboard, 'emptySelectionClipboard', true,\n\t\t\t{ description: nls.localize('emptySelectionClipboard', \"Controls whether copying without a selection copies the current line.\") }\n\t\t);\n\t}\n\n\tpublic compute(env: IEnvironmentalOptions, options: IComputedEditorOptions, value: boolean): boolean {\n\t\treturn value && env.emptySelectionClipboard;\n\t}\n}\n\n//#endregion\n\n//#region find\n\n/**\n * Configuration options for editor find widget\n */\nexport interface IEditorFindOptions {\n\t/**\n\t* Controls whether the cursor should move to find matches while typing.\n\t*/\n\tcursorMoveOnType?: boolean;\n\t/**\n\t * Controls if we seed search string in the Find Widget with editor selection.\n\t */\n\tseedSearchStringFromSelection?: boolean;\n\t/**\n\t * Controls if Find in Selection flag is turned on in the editor.\n\t */\n\tautoFindInSelection?: 'never' | 'always' | 'multiline';\n\t/*\n\t * Controls whether the Find Widget should add extra lines on top of the editor.\n\t */\n\taddExtraSpaceOnTop?: boolean;\n\t/**\n\t * @internal\n\t * Controls if the Find Widget should read or modify the shared find clipboard on macOS\n\t */\n\tglobalFindClipboard?: boolean;\n\t/**\n\t * Controls whether the search automatically restarts from the beginning (or the end) when no further matches can be found\n\t */\n\tloop?: boolean;\n}\n\nexport type EditorFindOptions = Readonly<Required<IEditorFindOptions>>;\n\nclass EditorFind extends BaseEditorOption<EditorOption.find, EditorFindOptions> {\n\n\tconstructor() {\n\t\tconst defaults: EditorFindOptions = {\n\t\t\tcursorMoveOnType: true,\n\t\t\tseedSearchStringFromSelection: true,\n\t\t\tautoFindInSelection: 'never',\n\t\t\tglobalFindClipboard: false,\n\t\t\taddExtraSpaceOnTop: true,\n\t\t\tloop: true\n\t\t};\n\t\tsuper(\n\t\t\tEditorOption.find, 'find', defaults,\n\t\t\t{\n\t\t\t\t'editor.find.cursorMoveOnType': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: defaults.cursorMoveOnType,\n\t\t\t\t\tdescription: nls.localize('find.cursorMoveOnType', \"Controls whether the cursor should jump to find matches while typing.\")\n\t\t\t\t},\n\t\t\t\t'editor.find.seedSearchStringFromSelection': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: defaults.seedSearchStringFromSelection,\n\t\t\t\t\tdescription: nls.localize('find.seedSearchStringFromSelection', \"Controls whether the search string in the Find Widget is seeded from the editor selection.\")\n\t\t\t\t},\n\t\t\t\t'editor.find.autoFindInSelection': {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tenum: ['never', 'always', 'multiline'],\n\t\t\t\t\tdefault: defaults.autoFindInSelection,\n\t\t\t\t\tenumDescriptions: [\n\t\t\t\t\t\tnls.localize('editor.find.autoFindInSelection.never', 'Never turn on Find in selection automatically (default)'),\n\t\t\t\t\t\tnls.localize('editor.find.autoFindInSelection.always', 'Always turn on Find in selection automatically'),\n\t\t\t\t\t\tnls.localize('editor.find.autoFindInSelection.multiline', 'Turn on Find in selection automatically when multiple lines of content are selected.')\n\t\t\t\t\t],\n\t\t\t\t\tdescription: nls.localize('find.autoFindInSelection', \"Controls the condition for turning on find in selection automatically.\")\n\t\t\t\t},\n\t\t\t\t'editor.find.globalFindClipboard': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: defaults.globalFindClipboard,\n\t\t\t\t\tdescription: nls.localize('find.globalFindClipboard', \"Controls whether the Find Widget should read or modify the shared find clipboard on macOS.\"),\n\t\t\t\t\tincluded: platform.isMacintosh\n\t\t\t\t},\n\t\t\t\t'editor.find.addExtraSpaceOnTop': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: defaults.addExtraSpaceOnTop,\n\t\t\t\t\tdescription: nls.localize('find.addExtraSpaceOnTop', \"Controls whether the Find Widget should add extra lines on top of the editor. When true, you can scroll beyond the first line when the Find Widget is visible.\")\n\t\t\t\t},\n\t\t\t\t'editor.find.loop': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: defaults.loop,\n\t\t\t\t\tdescription: nls.localize('find.loop', \"Controls whether the search automatically restarts from the beginning (or the end) when no further matches can be found.\")\n\t\t\t\t},\n\n\t\t\t}\n\t\t);\n\t}\n\n\tpublic validate(_input: any): EditorFindOptions {\n\t\tif (!_input || typeof _input !== 'object') {\n\t\t\treturn this.defaultValue;\n\t\t}\n\t\tconst input = _input as IEditorFindOptions;\n\t\treturn {\n\t\t\tcursorMoveOnType: boolean(input.cursorMoveOnType, this.defaultValue.cursorMoveOnType),\n\t\t\tseedSearchStringFromSelection: boolean(input.seedSearchStringFromSelection, this.defaultValue.seedSearchStringFromSelection),\n\t\t\tautoFindInSelection: typeof _input.autoFindInSelection === 'boolean'\n\t\t\t\t? (_input.autoFindInSelection ? 'always' : 'never')\n\t\t\t\t: stringSet<'never' | 'always' | 'multiline'>(input.autoFindInSelection, this.defaultValue.autoFindInSelection, ['never', 'always', 'multiline']),\n\t\t\tglobalFindClipboard: boolean(input.globalFindClipboard, this.defaultValue.globalFindClipboard),\n\t\t\taddExtraSpaceOnTop: boolean(input.addExtraSpaceOnTop, this.defaultValue.addExtraSpaceOnTop),\n\t\t\tloop: boolean(input.loop, this.defaultValue.loop),\n\t\t};\n\t}\n}\n\n//#endregion\n\n//#region fontLigatures\n\n/**\n * @internal\n */\nexport class EditorFontLigatures extends BaseEditorOption<EditorOption.fontLigatures, string> {\n\n\tpublic static OFF = '\"liga\" off, \"calt\" off';\n\tpublic static ON = '\"liga\" on, \"calt\" on';\n\n\tconstructor() {\n\t\tsuper(\n\t\t\tEditorOption.fontLigatures, 'fontLigatures', EditorFontLigatures.OFF,\n\t\t\t{\n\t\t\t\tanyOf: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\t\tdescription: nls.localize('fontLigatures', \"Enables/Disables font ligatures ('calt' and 'liga' font features). Change this to a string for fine-grained control of the 'font-feature-settings' CSS property.\"),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\tdescription: nls.localize('fontFeatureSettings', \"Explicit 'font-feature-settings' CSS property. A boolean can be passed instead if one only needs to turn on/off ligatures.\")\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tdescription: nls.localize('fontLigaturesGeneral', \"Configures font ligatures or font features. Can be either a boolean to enable/disable ligatures or a string for the value of the CSS 'font-feature-settings' property.\"),\n\t\t\t\tdefault: false\n\t\t\t}\n\t\t);\n\t}\n\n\tpublic validate(input: any): string {\n\t\tif (typeof input === 'undefined') {\n\t\t\treturn this.defaultValue;\n\t\t}\n\t\tif (typeof input === 'string') {\n\t\t\tif (input === 'false') {\n\t\t\t\treturn EditorFontLigatures.OFF;\n\t\t\t}\n\t\t\tif (input === 'true') {\n\t\t\t\treturn EditorFontLigatures.ON;\n\t\t\t}\n\t\t\treturn input;\n\t\t}\n\t\tif (Boolean(input)) {\n\t\t\treturn EditorFontLigatures.ON;\n\t\t}\n\t\treturn EditorFontLigatures.OFF;\n\t}\n}\n\n//#endregion\n\n//#region fontInfo\n\nclass EditorFontInfo extends ComputedEditorOption<EditorOption.fontInfo, FontInfo> {\n\n\tconstructor() {\n\t\tsuper(EditorOption.fontInfo);\n\t}\n\n\tpublic compute(env: IEnvironmentalOptions, options: IComputedEditorOptions, _: FontInfo): FontInfo {\n\t\treturn env.fontInfo;\n\t}\n}\n\n//#endregion\n\n//#region fontSize\n\nclass EditorFontSize extends SimpleEditorOption<EditorOption.fontSize, number> {\n\n\tconstructor() {\n\t\tsuper(\n\t\t\tEditorOption.fontSize, 'fontSize', EDITOR_FONT_DEFAULTS.fontSize,\n\t\t\t{\n\t\t\t\ttype: 'number',\n\t\t\t\tminimum: 6,\n\t\t\t\tmaximum: 100,\n\t\t\t\tdefault: EDITOR_FONT_DEFAULTS.fontSize,\n\t\t\t\tdescription: nls.localize('fontSize', \"Controls the font size in pixels.\")\n\t\t\t}\n\t\t);\n\t}\n\n\tpublic validate(input: any): number {\n\t\tlet r = EditorFloatOption.float(input, this.defaultValue);\n\t\tif (r === 0) {\n\t\t\treturn EDITOR_FONT_DEFAULTS.fontSize;\n\t\t}\n\t\treturn EditorFloatOption.clamp(r, 6, 100);\n\t}\n\tpublic compute(env: IEnvironmentalOptions, options: IComputedEditorOptions, value: number): number {\n\t\t// The final fontSize respects the editor zoom level.\n\t\t// So take the result from env.fontInfo\n\t\treturn env.fontInfo.fontSize;\n\t}\n}\n\n//#endregion\n\n//#region fontWeight\n\nclass EditorFontWeight extends BaseEditorOption<EditorOption.fontWeight, string> {\n\tprivate static SUGGESTION_VALUES = ['normal', 'bold', '100', '200', '300', '400', '500', '600', '700', '800', '900'];\n\tprivate static MINIMUM_VALUE = 1;\n\tprivate static MAXIMUM_VALUE = 1000;\n\n\tconstructor() {\n\t\tsuper(\n\t\t\tEditorOption.fontWeight, 'fontWeight', EDITOR_FONT_DEFAULTS.fontWeight,\n\t\t\t{\n\t\t\t\tanyOf: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'number',\n\t\t\t\t\t\tminimum: EditorFontWeight.MINIMUM_VALUE,\n\t\t\t\t\t\tmaximum: EditorFontWeight.MAXIMUM_VALUE,\n\t\t\t\t\t\terrorMessage: nls.localize('fontWeightErrorMessage', \"Only \\\"normal\\\" and \\\"bold\\\" keywords or numbers between 1 and 1000 are allowed.\")\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\tpattern: '^(normal|bold|1000|[1-9][0-9]{0,2})$'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tenum: EditorFontWeight.SUGGESTION_VALUES\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tdefault: EDITOR_FONT_DEFAULTS.fontWeight,\n\t\t\t\tdescription: nls.localize('fontWeight', \"Controls the font weight. Accepts \\\"normal\\\" and \\\"bold\\\" keywords or numbers between 1 and 1000.\")\n\t\t\t}\n\t\t);\n\t}\n\n\tpublic validate(input: any): string {\n\t\tif (input === 'normal' || input === 'bold') {\n\t\t\treturn input;\n\t\t}\n\t\treturn String(EditorIntOption.clampedInt(input, EDITOR_FONT_DEFAULTS.fontWeight, EditorFontWeight.MINIMUM_VALUE, EditorFontWeight.MAXIMUM_VALUE));\n\t}\n}\n\n//#endregion\n\n//#region gotoLocation\n\nexport type GoToLocationValues = 'peek' | 'gotoAndPeek' | 'goto';\n\n/**\n * Configuration options for go to location\n */\nexport interface IGotoLocationOptions {\n\n\tmultiple?: GoToLocationValues;\n\n\tmultipleDefinitions?: GoToLocationValues;\n\tmultipleTypeDefinitions?: GoToLocationValues;\n\tmultipleDeclarations?: GoToLocationValues;\n\tmultipleImplementations?: GoToLocationValues;\n\tmultipleReferences?: GoToLocationValues;\n\n\talternativeDefinitionCommand?: string;\n\talternativeTypeDefinitionCommand?: string;\n\talternativeDeclarationCommand?: string;\n\talternativeImplementationCommand?: string;\n\talternativeReferenceCommand?: string;\n}\n\nexport type GoToLocationOptions = Readonly<Required<IGotoLocationOptions>>;\n\nclass EditorGoToLocation extends BaseEditorOption<EditorOption.gotoLocation, GoToLocationOptions> {\n\n\tconstructor() {\n\t\tconst defaults: GoToLocationOptions = {\n\t\t\tmultiple: 'peek',\n\t\t\tmultipleDefinitions: 'peek',\n\t\t\tmultipleTypeDefinitions: 'peek',\n\t\t\tmultipleDeclarations: 'peek',\n\t\t\tmultipleImplementations: 'peek',\n\t\t\tmultipleReferences: 'peek',\n\t\t\talternativeDefinitionCommand: 'editor.action.goToReferences',\n\t\t\talternativeTypeDefinitionCommand: 'editor.action.goToReferences',\n\t\t\talternativeDeclarationCommand: 'editor.action.goToReferences',\n\t\t\talternativeImplementationCommand: '',\n\t\t\talternativeReferenceCommand: '',\n\t\t};\n\t\tconst jsonSubset: IJSONSchema = {\n\t\t\ttype: 'string',\n\t\t\tenum: ['peek', 'gotoAndPeek', 'goto'],\n\t\t\tdefault: defaults.multiple,\n\t\t\tenumDescriptions: [\n\t\t\t\tnls.localize('editor.gotoLocation.multiple.peek', 'Show peek view of the results (default)'),\n\t\t\t\tnls.localize('editor.gotoLocation.multiple.gotoAndPeek', 'Go to the primary result and show a peek view'),\n\t\t\t\tnls.localize('editor.gotoLocation.multiple.goto', 'Go to the primary result and enable peek-less navigation to others')\n\t\t\t]\n\t\t};\n\t\tsuper(\n\t\t\tEditorOption.gotoLocation, 'gotoLocation', defaults,\n\t\t\t{\n\t\t\t\t'editor.gotoLocation.multiple': {\n\t\t\t\t\tdeprecationMessage: nls.localize('editor.gotoLocation.multiple.deprecated', \"This setting is deprecated, please use separate settings like 'editor.editor.gotoLocation.multipleDefinitions' or 'editor.editor.gotoLocation.multipleImplementations' instead.\"),\n\t\t\t\t},\n\t\t\t\t'editor.gotoLocation.multipleDefinitions': {\n\t\t\t\t\tdescription: nls.localize('editor.editor.gotoLocation.multipleDefinitions', \"Controls the behavior the 'Go to Definition'-command when multiple target locations exist.\"),\n\t\t\t\t\t...jsonSubset,\n\t\t\t\t},\n\t\t\t\t'editor.gotoLocation.multipleTypeDefinitions': {\n\t\t\t\t\tdescription: nls.localize('editor.editor.gotoLocation.multipleTypeDefinitions', \"Controls the behavior the 'Go to Type Definition'-command when multiple target locations exist.\"),\n\t\t\t\t\t...jsonSubset,\n\t\t\t\t},\n\t\t\t\t'editor.gotoLocation.multipleDeclarations': {\n\t\t\t\t\tdescription: nls.localize('editor.editor.gotoLocation.multipleDeclarations', \"Controls the behavior the 'Go to Declaration'-command when multiple target locations exist.\"),\n\t\t\t\t\t...jsonSubset,\n\t\t\t\t},\n\t\t\t\t'editor.gotoLocation.multipleImplementations': {\n\t\t\t\t\tdescription: nls.localize('editor.editor.gotoLocation.multipleImplemenattions', \"Controls the behavior the 'Go to Implementations'-command when multiple target locations exist.\"),\n\t\t\t\t\t...jsonSubset,\n\t\t\t\t},\n\t\t\t\t'editor.gotoLocation.multipleReferences': {\n\t\t\t\t\tdescription: nls.localize('editor.editor.gotoLocation.multipleReferences', \"Controls the behavior the 'Go to References'-command when multiple target locations exist.\"),\n\t\t\t\t\t...jsonSubset,\n\t\t\t\t},\n\t\t\t\t'editor.gotoLocation.alternativeDefinitionCommand': {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdefault: defaults.alternativeDefinitionCommand,\n\t\t\t\t\tdescription: nls.localize('alternativeDefinitionCommand', \"Alternative command id that is being executed when the result of 'Go to Definition' is the current location.\")\n\t\t\t\t},\n\t\t\t\t'editor.gotoLocation.alternativeTypeDefinitionCommand': {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdefault: defaults.alternativeTypeDefinitionCommand,\n\t\t\t\t\tdescription: nls.localize('alternativeTypeDefinitionCommand', \"Alternative command id that is being executed when the result of 'Go to Type Definition' is the current location.\")\n\t\t\t\t},\n\t\t\t\t'editor.gotoLocation.alternativeDeclarationCommand': {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdefault: defaults.alternativeDeclarationCommand,\n\t\t\t\t\tdescription: nls.localize('alternativeDeclarationCommand', \"Alternative command id that is being executed when the result of 'Go to Declaration' is the current location.\")\n\t\t\t\t},\n\t\t\t\t'editor.gotoLocation.alternativeImplementationCommand': {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdefault: defaults.alternativeImplementationCommand,\n\t\t\t\t\tdescription: nls.localize('alternativeImplementationCommand', \"Alternative command id that is being executed when the result of 'Go to Implementation' is the current location.\")\n\t\t\t\t},\n\t\t\t\t'editor.gotoLocation.alternativeReferenceCommand': {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdefault: defaults.alternativeReferenceCommand,\n\t\t\t\t\tdescription: nls.localize('alternativeReferenceCommand', \"Alternative command id that is being executed when the result of 'Go to Reference' is the current location.\")\n\t\t\t\t},\n\t\t\t}\n\t\t);\n\t}\n\n\tpublic validate(_input: any): GoToLocationOptions {\n\t\tif (!_input || typeof _input !== 'object') {\n\t\t\treturn this.defaultValue;\n\t\t}\n\t\tconst input = _input as IGotoLocationOptions;\n\t\treturn {\n\t\t\tmultiple: stringSet<GoToLocationValues>(input.multiple, this.defaultValue.multiple!, ['peek', 'gotoAndPeek', 'goto']),\n\t\t\tmultipleDefinitions: input.multipleDefinitions ?? stringSet<GoToLocationValues>(input.multipleDefinitions, 'peek', ['peek', 'gotoAndPeek', 'goto']),\n\t\t\tmultipleTypeDefinitions: input.multipleTypeDefinitions ?? stringSet<GoToLocationValues>(input.multipleTypeDefinitions, 'peek', ['peek', 'gotoAndPeek', 'goto']),\n\t\t\tmultipleDeclarations: input.multipleDeclarations ?? stringSet<GoToLocationValues>(input.multipleDeclarations, 'peek', ['peek', 'gotoAndPeek', 'goto']),\n\t\t\tmultipleImplementations: input.multipleImplementations ?? stringSet<GoToLocationValues>(input.multipleImplementations, 'peek', ['peek', 'gotoAndPeek', 'goto']),\n\t\t\tmultipleReferences: input.multipleReferences ?? stringSet<GoToLocationValues>(input.multipleReferences, 'peek', ['peek', 'gotoAndPeek', 'goto']),\n\t\t\talternativeDefinitionCommand: EditorStringOption.string(input.alternativeDefinitionCommand, this.defaultValue.alternativeDefinitionCommand),\n\t\t\talternativeTypeDefinitionCommand: EditorStringOption.string(input.alternativeTypeDefinitionCommand, this.defaultValue.alternativeTypeDefinitionCommand),\n\t\t\talternativeDeclarationCommand: EditorStringOption.string(input.alternativeDeclarationCommand, this.defaultValue.alternativeDeclarationCommand),\n\t\t\talternativeImplementationCommand: EditorStringOption.string(input.alternativeImplementationCommand, this.defaultValue.alternativeImplementationCommand),\n\t\t\talternativeReferenceCommand: EditorStringOption.string(input.alternativeReferenceCommand, this.defaultValue.alternativeReferenceCommand),\n\t\t};\n\t}\n}\n\n//#endregion\n\n//#region hover\n\n/**\n * Configuration options for editor hover\n */\nexport interface IEditorHoverOptions {\n\t/**\n\t * Enable the hover.\n\t * Defaults to true.\n\t */\n\tenabled?: boolean;\n\t/**\n\t * Delay for showing the hover.\n\t * Defaults to 300.\n\t */\n\tdelay?: number;\n\t/**\n\t * Is the hover sticky such that it can be clicked and its contents selected?\n\t * Defaults to true.\n\t */\n\tsticky?: boolean;\n}\n\nexport type EditorHoverOptions = Readonly<Required<IEditorHoverOptions>>;\n\nclass EditorHover extends BaseEditorOption<EditorOption.hover, EditorHoverOptions> {\n\n\tconstructor() {\n\t\tconst defaults: EditorHoverOptions = {\n\t\t\tenabled: true,\n\t\t\tdelay: 300,\n\t\t\tsticky: true\n\t\t};\n\t\tsuper(\n\t\t\tEditorOption.hover, 'hover', defaults,\n\t\t\t{\n\t\t\t\t'editor.hover.enabled': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: defaults.enabled,\n\t\t\t\t\tdescription: nls.localize('hover.enabled', \"Controls whether the hover is shown.\")\n\t\t\t\t},\n\t\t\t\t'editor.hover.delay': {\n\t\t\t\t\ttype: 'number',\n\t\t\t\t\tdefault: defaults.delay,\n\t\t\t\t\tdescription: nls.localize('hover.delay', \"Controls the delay in milliseconds after which the hover is shown.\")\n\t\t\t\t},\n\t\t\t\t'editor.hover.sticky': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: defaults.sticky,\n\t\t\t\t\tdescription: nls.localize('hover.sticky', \"Controls whether the hover should remain visible when mouse is moved over it.\")\n\t\t\t\t},\n\t\t\t}\n\t\t);\n\t}\n\n\tpublic validate(_input: any): EditorHoverOptions {\n\t\tif (!_input || typeof _input !== 'object') {\n\t\t\treturn this.defaultValue;\n\t\t}\n\t\tconst input = _input as IEditorHoverOptions;\n\t\treturn {\n\t\t\tenabled: boolean(input.enabled, this.defaultValue.enabled),\n\t\t\tdelay: EditorIntOption.clampedInt(input.delay, this.defaultValue.delay, 0, 10000),\n\t\t\tsticky: boolean(input.sticky, this.defaultValue.sticky)\n\t\t};\n\t}\n}\n\n//#endregion\n\n//#region layoutInfo\n\n/**\n * A description for the overview ruler position.\n */\nexport interface OverviewRulerPosition {\n\t/**\n\t * Width of the overview ruler\n\t */\n\treadonly width: number;\n\t/**\n\t * Height of the overview ruler\n\t */\n\treadonly height: number;\n\t/**\n\t * Top position for the overview ruler\n\t */\n\treadonly top: number;\n\t/**\n\t * Right position for the overview ruler\n\t */\n\treadonly right: number;\n}\n\nexport const enum RenderMinimap {\n\tNone = 0,\n\tText = 1,\n\tBlocks = 2,\n}\n\n/**\n * The internal layout details of the editor.\n */\nexport interface EditorLayoutInfo {\n\n\t/**\n\t * Full editor width.\n\t */\n\treadonly width: number;\n\t/**\n\t * Full editor height.\n\t */\n\treadonly height: number;\n\n\t/**\n\t * Left position for the glyph margin.\n\t */\n\treadonly glyphMarginLeft: number;\n\t/**\n\t * The width of the glyph margin.\n\t */\n\treadonly glyphMarginWidth: number;\n\n\t/**\n\t * Left position for the line numbers.\n\t */\n\treadonly lineNumbersLeft: number;\n\t/**\n\t * The width of the line numbers.\n\t */\n\treadonly lineNumbersWidth: number;\n\n\t/**\n\t * Left position for the line decorations.\n\t */\n\treadonly decorationsLeft: number;\n\t/**\n\t * The width of the line decorations.\n\t */\n\treadonly decorationsWidth: number;\n\n\t/**\n\t * Left position for the content (actual text)\n\t */\n\treadonly contentLeft: number;\n\t/**\n\t * The width of the content (actual text)\n\t */\n\treadonly contentWidth: number;\n\n\t/**\n\t * Layout information for the minimap\n\t */\n\treadonly minimap: EditorMinimapLayoutInfo;\n\n\t/**\n\t * The number of columns (of typical characters) fitting on a viewport line.\n\t */\n\treadonly viewportColumn: number;\n\n\treadonly isWordWrapMinified: boolean;\n\treadonly isViewportWrapping: boolean;\n\treadonly wrappingColumn: number;\n\n\t/**\n\t * The width of the vertical scrollbar.\n\t */\n\treadonly verticalScrollbarWidth: number;\n\t/**\n\t * The height of the horizontal scrollbar.\n\t */\n\treadonly horizontalScrollbarHeight: number;\n\n\t/**\n\t * The position of the overview ruler.\n\t */\n\treadonly overviewRuler: OverviewRulerPosition;\n}\n\n/**\n * The internal layout details of the editor.\n */\nexport interface EditorMinimapLayoutInfo {\n\treadonly renderMinimap: RenderMinimap;\n\treadonly minimapLeft: number;\n\treadonly minimapWidth: number;\n\treadonly minimapHeightIsEditorHeight: boolean;\n\treadonly minimapIsSampling: boolean;\n\treadonly minimapScale: number;\n\treadonly minimapLineHeight: number;\n\treadonly minimapCanvasInnerWidth: number;\n\treadonly minimapCanvasInnerHeight: number;\n\treadonly minimapCanvasOuterWidth: number;\n\treadonly minimapCanvasOuterHeight: number;\n}\n\n/**\n * @internal\n */\nexport interface EditorLayoutInfoComputerEnv {\n\treadonly memory: ComputeOptionsMemory | null;\n\treadonly outerWidth: number;\n\treadonly outerHeight: number;\n\treadonly isDominatedByLongLines: boolean;\n\treadonly lineHeight: number;\n\treadonly viewLineCount: number;\n\treadonly lineNumbersDigitCount: number;\n\treadonly typicalHalfwidthCharacterWidth: number;\n\treadonly maxDigitWidth: number;\n\treadonly pixelRatio: number;\n}\n\n/**\n * @internal\n */\nexport interface IEditorLayoutComputerInput {\n\treadonly outerWidth: number;\n\treadonly outerHeight: number;\n\treadonly isDominatedByLongLines: boolean;\n\treadonly lineHeight: number;\n\treadonly lineNumbersDigitCount: number;\n\treadonly typicalHalfwidthCharacterWidth: number;\n\treadonly maxDigitWidth: number;\n\treadonly pixelRatio: number;\n\treadonly glyphMargin: boolean;\n\treadonly lineDecorationsWidth: string | number;\n\treadonly folding: boolean;\n\treadonly minimap: Readonly<Required<IEditorMinimapOptions>>;\n\treadonly scrollbar: InternalEditorScrollbarOptions;\n\treadonly lineNumbers: InternalEditorRenderLineNumbersOptions;\n\treadonly lineNumbersMinChars: number;\n\treadonly scrollBeyondLastLine: boolean;\n\treadonly wordWrap: 'wordWrapColumn' | 'on' | 'off' | 'bounded';\n\treadonly wordWrapColumn: number;\n\treadonly wordWrapMinified: boolean;\n\treadonly accessibilitySupport: AccessibilitySupport;\n}\n\n/**\n * @internal\n */\nexport interface IMinimapLayoutInput {\n\treadonly outerWidth: number;\n\treadonly outerHeight: number;\n\treadonly lineHeight: number;\n\treadonly typicalHalfwidthCharacterWidth: number;\n\treadonly pixelRatio: number;\n\treadonly scrollBeyondLastLine: boolean;\n\treadonly minimap: Readonly<Required<IEditorMinimapOptions>>;\n\treadonly verticalScrollbarWidth: number;\n\treadonly viewLineCount: number;\n\treadonly remainingWidth: number;\n\treadonly isViewportWrapping: boolean;\n}\n\n/**\n * @internal\n */\nexport class EditorLayoutInfoComputer extends ComputedEditorOption<EditorOption.layoutInfo, EditorLayoutInfo> {\n\n\tconstructor() {\n\t\tsuper(\n\t\t\tEditorOption.layoutInfo,\n\t\t\t[\n\t\t\t\tEditorOption.glyphMargin, EditorOption.lineDecorationsWidth, EditorOption.folding,\n\t\t\t\tEditorOption.minimap, EditorOption.scrollbar, EditorOption.lineNumbers,\n\t\t\t\tEditorOption.lineNumbersMinChars, EditorOption.scrollBeyondLastLine,\n\t\t\t\tEditorOption.wordWrap, EditorOption.wordWrapColumn, EditorOption.wordWrapOverride1, EditorOption.wordWrapOverride2,\n\t\t\t\tEditorOption.accessibilitySupport\n\t\t\t]\n\t\t);\n\t}\n\n\tpublic compute(env: IEnvironmentalOptions, options: IComputedEditorOptions, _: EditorLayoutInfo): EditorLayoutInfo {\n\t\treturn EditorLayoutInfoComputer.computeLayout(options, {\n\t\t\tmemory: env.memory,\n\t\t\touterWidth: env.outerWidth,\n\t\t\touterHeight: env.outerHeight,\n\t\t\tisDominatedByLongLines: env.isDominatedByLongLines,\n\t\t\tlineHeight: env.fontInfo.lineHeight,\n\t\t\tviewLineCount: env.viewLineCount,\n\t\t\tlineNumbersDigitCount: env.lineNumbersDigitCount,\n\t\t\ttypicalHalfwidthCharacterWidth: env.fontInfo.typicalHalfwidthCharacterWidth,\n\t\t\tmaxDigitWidth: env.fontInfo.maxDigitWidth,\n\t\t\tpixelRatio: env.pixelRatio\n\t\t});\n\t}\n\n\tpublic static computeContainedMinimapLineCount(input: {\n\t\tviewLineCount: number;\n\t\tscrollBeyondLastLine: boolean;\n\t\theight: number;\n\t\tlineHeight: number;\n\t\tpixelRatio: number;\n\t}): { typicalViewportLineCount: number; extraLinesBeyondLastLine: number; desiredRatio: number; minimapLineCount: number; } {\n\t\tconst typicalViewportLineCount = input.height / input.lineHeight;\n\t\tconst extraLinesBeyondLastLine = input.scrollBeyondLastLine ? (typicalViewportLineCount - 1) : 0;\n\t\tconst desiredRatio = (input.viewLineCount + extraLinesBeyondLastLine) / (input.pixelRatio * input.height);\n\t\tconst minimapLineCount = Math.floor(input.viewLineCount / desiredRatio);\n\t\treturn { typicalViewportLineCount, extraLinesBeyondLastLine, desiredRatio, minimapLineCount };\n\t}\n\n\tprivate static _computeMinimapLayout(input: IMinimapLayoutInput, memory: ComputeOptionsMemory): EditorMinimapLayoutInfo {\n\t\tconst outerWidth = input.outerWidth;\n\t\tconst outerHeight = input.outerHeight;\n\t\tconst pixelRatio = input.pixelRatio;\n\n\t\tif (!input.minimap.enabled) {\n\t\t\treturn {\n\t\t\t\trenderMinimap: RenderMinimap.None,\n\t\t\t\tminimapLeft: 0,\n\t\t\t\tminimapWidth: 0,\n\t\t\t\tminimapHeightIsEditorHeight: false,\n\t\t\t\tminimapIsSampling: false,\n\t\t\t\tminimapScale: 1,\n\t\t\t\tminimapLineHeight: 1,\n\t\t\t\tminimapCanvasInnerWidth: 0,\n\t\t\t\tminimapCanvasInnerHeight: Math.floor(pixelRatio * outerHeight),\n\t\t\t\tminimapCanvasOuterWidth: 0,\n\t\t\t\tminimapCanvasOuterHeight: outerHeight,\n\t\t\t};\n\t\t}\n\n\t\t// Can use memory if only the `viewLineCount` and `remainingWidth` have changed\n\t\tconst stableMinimapLayoutInput = memory.stableMinimapLayoutInput;\n\t\tconst couldUseMemory = (\n\t\t\tstableMinimapLayoutInput\n\t\t\t// && input.outerWidth === lastMinimapLayoutInput.outerWidth !!! INTENTIONAL OMITTED\n\t\t\t&& input.outerHeight === stableMinimapLayoutInput.outerHeight\n\t\t\t&& input.lineHeight === stableMinimapLayoutInput.lineHeight\n\t\t\t&& input.typicalHalfwidthCharacterWidth === stableMinimapLayoutInput.typicalHalfwidthCharacterWidth\n\t\t\t&& input.pixelRatio === stableMinimapLayoutInput.pixelRatio\n\t\t\t&& input.scrollBeyondLastLine === stableMinimapLayoutInput.scrollBeyondLastLine\n\t\t\t&& input.minimap.enabled === stableMinimapLayoutInput.minimap.enabled\n\t\t\t&& input.minimap.side === stableMinimapLayoutInput.minimap.side\n\t\t\t&& input.minimap.size === stableMinimapLayoutInput.minimap.size\n\t\t\t&& input.minimap.showSlider === stableMinimapLayoutInput.minimap.showSlider\n\t\t\t&& input.minimap.renderCharacters === stableMinimapLayoutInput.minimap.renderCharacters\n\t\t\t&& input.minimap.maxColumn === stableMinimapLayoutInput.minimap.maxColumn\n\t\t\t&& input.minimap.scale === stableMinimapLayoutInput.minimap.scale\n\t\t\t&& input.verticalScrollbarWidth === stableMinimapLayoutInput.verticalScrollbarWidth\n\t\t\t// && input.viewLineCount === lastMinimapLayoutInput.viewLineCount !!! INTENTIONAL OMITTED\n\t\t\t// && input.remainingWidth === lastMinimapLayoutInput.remainingWidth !!! INTENTIONAL OMITTED\n\t\t\t&& input.isViewportWrapping === stableMinimapLayoutInput.isViewportWrapping\n\t\t);\n\n\t\tconst lineHeight = input.lineHeight;\n\t\tconst typicalHalfwidthCharacterWidth = input.typicalHalfwidthCharacterWidth;\n\t\tconst scrollBeyondLastLine = input.scrollBeyondLastLine;\n\t\tconst minimapRenderCharacters = input.minimap.renderCharacters;\n\t\tlet minimapScale = (pixelRatio >= 2 ? Math.round(input.minimap.scale * 2) : input.minimap.scale);\n\t\tconst minimapMaxColumn = input.minimap.maxColumn;\n\t\tconst minimapSize = input.minimap.size;\n\t\tconst minimapSide = input.minimap.side;\n\t\tconst verticalScrollbarWidth = input.verticalScrollbarWidth;\n\t\tconst viewLineCount = input.viewLineCount;\n\t\tconst remainingWidth = input.remainingWidth;\n\t\tconst isViewportWrapping = input.isViewportWrapping;\n\n\t\tconst baseCharHeight = minimapRenderCharacters ? 2 : 3;\n\t\tlet minimapCanvasInnerHeight = Math.floor(pixelRatio * outerHeight);\n\t\tconst minimapCanvasOuterHeight = minimapCanvasInnerHeight / pixelRatio;\n\t\tlet minimapHeightIsEditorHeight = false;\n\t\tlet minimapIsSampling = false;\n\t\tlet minimapLineHeight = baseCharHeight * minimapScale;\n\t\tlet minimapCharWidth = minimapScale / pixelRatio;\n\t\tlet minimapWidthMultiplier: number = 1;\n\n\t\tif (minimapSize === 'fill' || minimapSize === 'fit') {\n\t\t\tconst { typicalViewportLineCount, extraLinesBeyondLastLine, desiredRatio, minimapLineCount } = EditorLayoutInfoComputer.computeContainedMinimapLineCount({\n\t\t\t\tviewLineCount: viewLineCount,\n\t\t\t\tscrollBeyondLastLine: scrollBeyondLastLine,\n\t\t\t\theight: outerHeight,\n\t\t\t\tlineHeight: lineHeight,\n\t\t\t\tpixelRatio: pixelRatio\n\t\t\t});\n\t\t\t// ratio is intentionally not part of the layout to avoid the layout changing all the time\n\t\t\t// when doing sampling\n\t\t\tconst ratio = viewLineCount / minimapLineCount;\n\n\t\t\tif (ratio > 1) {\n\t\t\t\tminimapHeightIsEditorHeight = true;\n\t\t\t\tminimapIsSampling = true;\n\t\t\t\tminimapScale = 1;\n\t\t\t\tminimapLineHeight = 1;\n\t\t\t\tminimapCharWidth = minimapScale / pixelRatio;\n\t\t\t} else {\n\t\t\t\tlet fitBecomesFill = false;\n\t\t\t\tlet maxMinimapScale = minimapScale + 1;\n\n\t\t\t\tif (minimapSize === 'fit') {\n\t\t\t\t\tconst effectiveMinimapHeight = Math.ceil((viewLineCount + extraLinesBeyondLastLine) * minimapLineHeight);\n\t\t\t\t\tif (isViewportWrapping && couldUseMemory && remainingWidth <= memory.stableFitRemainingWidth) {\n\t\t\t\t\t\t// There is a loop when using `fit` and viewport wrapping:\n\t\t\t\t\t\t// - view line count impacts minimap layout\n\t\t\t\t\t\t// - minimap layout impacts viewport width\n\t\t\t\t\t\t// - viewport width impacts view line count\n\t\t\t\t\t\t// To break the loop, once we go to a smaller minimap scale, we try to stick with it.\n\t\t\t\t\t\tfitBecomesFill = true;\n\t\t\t\t\t\tmaxMinimapScale = memory.stableFitMaxMinimapScale;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfitBecomesFill = (effectiveMinimapHeight > minimapCanvasInnerHeight);\n\t\t\t\t\t\tif (isViewportWrapping && fitBecomesFill) {\n\t\t\t\t\t\t\t// remember for next time\n\t\t\t\t\t\t\tmemory.stableMinimapLayoutInput = input;\n\t\t\t\t\t\t\tmemory.stableFitRemainingWidth = remainingWidth;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tmemory.stableMinimapLayoutInput = null;\n\t\t\t\t\t\t\tmemory.stableFitRemainingWidth = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (minimapSize === 'fill' || fitBecomesFill) {\n\t\t\t\t\tminimapHeightIsEditorHeight = true;\n\t\t\t\t\tconst configuredMinimapScale = minimapScale;\n\t\t\t\t\tminimapLineHeight = Math.min(lineHeight * pixelRatio, Math.max(1, Math.floor(1 / desiredRatio)));\n\t\t\t\t\tminimapScale = Math.min(maxMinimapScale, Math.max(1, Math.floor(minimapLineHeight / baseCharHeight)));\n\t\t\t\t\tif (minimapScale > configuredMinimapScale) {\n\t\t\t\t\t\tminimapWidthMultiplier = Math.min(2, minimapScale / configuredMinimapScale);\n\t\t\t\t\t}\n\t\t\t\t\tminimapCharWidth = minimapScale / pixelRatio / minimapWidthMultiplier;\n\t\t\t\t\tminimapCanvasInnerHeight = Math.ceil((Math.max(typicalViewportLineCount, viewLineCount + extraLinesBeyondLastLine)) * minimapLineHeight);\n\t\t\t\t\tif (isViewportWrapping && fitBecomesFill) {\n\t\t\t\t\t\tmemory.stableFitMaxMinimapScale = minimapScale;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Given:\n\t\t// (leaving 2px for the cursor to have space after the last character)\n\t\t// viewportColumn = (contentWidth - verticalScrollbarWidth - 2) / typicalHalfwidthCharacterWidth\n\t\t// minimapWidth = viewportColumn * minimapCharWidth\n\t\t// contentWidth = remainingWidth - minimapWidth\n\t\t// What are good values for contentWidth and minimapWidth ?\n\n\t\t// minimapWidth = ((contentWidth - verticalScrollbarWidth - 2) / typicalHalfwidthCharacterWidth) * minimapCharWidth\n\t\t// typicalHalfwidthCharacterWidth * minimapWidth = (contentWidth - verticalScrollbarWidth - 2) * minimapCharWidth\n\t\t// typicalHalfwidthCharacterWidth * minimapWidth = (remainingWidth - minimapWidth - verticalScrollbarWidth - 2) * minimapCharWidth\n\t\t// (typicalHalfwidthCharacterWidth + minimapCharWidth) * minimapWidth = (remainingWidth - verticalScrollbarWidth - 2) * minimapCharWidth\n\t\t// minimapWidth = ((remainingWidth - verticalScrollbarWidth - 2) * minimapCharWidth) / (typicalHalfwidthCharacterWidth + minimapCharWidth)\n\n\t\tconst minimapMaxWidth = Math.floor(minimapMaxColumn * minimapCharWidth);\n\t\tconst minimapWidth = Math.min(minimapMaxWidth, Math.max(0, Math.floor(((remainingWidth - verticalScrollbarWidth - 2) * minimapCharWidth) / (typicalHalfwidthCharacterWidth + minimapCharWidth))) + MINIMAP_GUTTER_WIDTH);\n\n\t\tlet minimapCanvasInnerWidth = Math.floor(pixelRatio * minimapWidth);\n\t\tconst minimapCanvasOuterWidth = minimapCanvasInnerWidth / pixelRatio;\n\t\tminimapCanvasInnerWidth = Math.floor(minimapCanvasInnerWidth * minimapWidthMultiplier);\n\n\t\tconst renderMinimap = (minimapRenderCharacters ? RenderMinimap.Text : RenderMinimap.Blocks);\n\t\tconst minimapLeft = (minimapSide === 'left' ? 0 : (outerWidth - minimapWidth - verticalScrollbarWidth));\n\n\t\treturn {\n\t\t\trenderMinimap,\n\t\t\tminimapLeft,\n\t\t\tminimapWidth,\n\t\t\tminimapHeightIsEditorHeight,\n\t\t\tminimapIsSampling,\n\t\t\tminimapScale,\n\t\t\tminimapLineHeight,\n\t\t\tminimapCanvasInnerWidth,\n\t\t\tminimapCanvasInnerHeight,\n\t\t\tminimapCanvasOuterWidth,\n\t\t\tminimapCanvasOuterHeight,\n\t\t};\n\t}\n\n\tpublic static computeLayout(options: IComputedEditorOptions, env: EditorLayoutInfoComputerEnv): EditorLayoutInfo {\n\t\tconst outerWidth = env.outerWidth | 0;\n\t\tconst outerHeight = env.outerHeight | 0;\n\t\tconst lineHeight = env.lineHeight | 0;\n\t\tconst lineNumbersDigitCount = env.lineNumbersDigitCount | 0;\n\t\tconst typicalHalfwidthCharacterWidth = env.typicalHalfwidthCharacterWidth;\n\t\tconst maxDigitWidth = env.maxDigitWidth;\n\t\tconst pixelRatio = env.pixelRatio;\n\t\tconst viewLineCount = env.viewLineCount;\n\n\t\tconst wordWrapOverride2 = options.get(EditorOption.wordWrapOverride2);\n\t\tconst wordWrapOverride1 = (wordWrapOverride2 === 'inherit' ? options.get(EditorOption.wordWrapOverride1) : wordWrapOverride2);\n\t\tconst wordWrap = (wordWrapOverride1 === 'inherit' ? options.get(EditorOption.wordWrap) : wordWrapOverride1);\n\n\t\tconst wordWrapColumn = options.get(EditorOption.wordWrapColumn);\n\t\tconst accessibilitySupport = options.get(EditorOption.accessibilitySupport);\n\t\tconst isDominatedByLongLines = env.isDominatedByLongLines;\n\n\t\tconst showGlyphMargin = options.get(EditorOption.glyphMargin);\n\t\tconst showLineNumbers = (options.get(EditorOption.lineNumbers).renderType !== RenderLineNumbersType.Off);\n\t\tconst lineNumbersMinChars = options.get(EditorOption.lineNumbersMinChars);\n\t\tconst scrollBeyondLastLine = options.get(EditorOption.scrollBeyondLastLine);\n\t\tconst minimap = options.get(EditorOption.minimap);\n\n\t\tconst scrollbar = options.get(EditorOption.scrollbar);\n\t\tconst verticalScrollbarWidth = scrollbar.verticalScrollbarSize;\n\t\tconst verticalScrollbarHasArrows = scrollbar.verticalHasArrows;\n\t\tconst scrollbarArrowSize = scrollbar.arrowSize;\n\t\tconst horizontalScrollbarHeight = scrollbar.horizontalScrollbarSize;\n\n\t\tconst rawLineDecorationsWidth = options.get(EditorOption.lineDecorationsWidth);\n\t\tconst folding = options.get(EditorOption.folding);\n\n\t\tlet lineDecorationsWidth: number;\n\t\tif (typeof rawLineDecorationsWidth === 'string' && /^\\d+(\\.\\d+)?ch$/.test(rawLineDecorationsWidth)) {\n\t\t\tconst multiple = parseFloat(rawLineDecorationsWidth.substr(0, rawLineDecorationsWidth.length - 2));\n\t\t\tlineDecorationsWidth = EditorIntOption.clampedInt(multiple * typicalHalfwidthCharacterWidth, 0, 0, 1000);\n\t\t} else {\n\t\t\tlineDecorationsWidth = EditorIntOption.clampedInt(rawLineDecorationsWidth, 0, 0, 1000);\n\t\t}\n\t\tif (folding) {\n\t\t\tlineDecorationsWidth += 16;\n\t\t}\n\n\t\tlet lineNumbersWidth = 0;\n\t\tif (showLineNumbers) {\n\t\t\tconst digitCount = Math.max(lineNumbersDigitCount, lineNumbersMinChars);\n\t\t\tlineNumbersWidth = Math.round(digitCount * maxDigitWidth);\n\t\t}\n\n\t\tlet glyphMarginWidth = 0;\n\t\tif (showGlyphMargin) {\n\t\t\tglyphMarginWidth = lineHeight;\n\t\t}\n\n\t\tlet glyphMarginLeft = 0;\n\t\tlet lineNumbersLeft = glyphMarginLeft + glyphMarginWidth;\n\t\tlet decorationsLeft = lineNumbersLeft + lineNumbersWidth;\n\t\tlet contentLeft = decorationsLeft + lineDecorationsWidth;\n\n\t\tconst remainingWidth = outerWidth - glyphMarginWidth - lineNumbersWidth - lineDecorationsWidth;\n\n\t\tlet isWordWrapMinified = false;\n\t\tlet isViewportWrapping = false;\n\t\tlet wrappingColumn = -1;\n\n\t\tif (accessibilitySupport !== AccessibilitySupport.Enabled) {\n\t\t\t// See https://github.com/microsoft/vscode/issues/27766\n\t\t\t// Never enable wrapping when a screen reader is attached\n\t\t\t// because arrow down etc. will not move the cursor in the way\n\t\t\t// a screen reader expects.\n\t\t\tif (wordWrapOverride1 === 'inherit' && isDominatedByLongLines) {\n\t\t\t\t// Force viewport width wrapping if model is dominated by long lines\n\t\t\t\tisWordWrapMinified = true;\n\t\t\t\tisViewportWrapping = true;\n\t\t\t} else if (wordWrap === 'on' || wordWrap === 'bounded') {\n\t\t\t\tisViewportWrapping = true;\n\t\t\t} else if (wordWrap === 'wordWrapColumn') {\n\t\t\t\twrappingColumn = wordWrapColumn;\n\t\t\t}\n\t\t}\n\n\t\tconst minimapLayout = EditorLayoutInfoComputer._computeMinimapLayout({\n\t\t\touterWidth: outerWidth,\n\t\t\touterHeight: outerHeight,\n\t\t\tlineHeight: lineHeight,\n\t\t\ttypicalHalfwidthCharacterWidth: typicalHalfwidthCharacterWidth,\n\t\t\tpixelRatio: pixelRatio,\n\t\t\tscrollBeyondLastLine: scrollBeyondLastLine,\n\t\t\tminimap: minimap,\n\t\t\tverticalScrollbarWidth: verticalScrollbarWidth,\n\t\t\tviewLineCount: viewLineCount,\n\t\t\tremainingWidth: remainingWidth,\n\t\t\tisViewportWrapping: isViewportWrapping,\n\t\t}, env.memory || new ComputeOptionsMemory());\n\n\t\tif (minimapLayout.renderMinimap !== RenderMinimap.None && minimapLayout.minimapLeft === 0) {\n\t\t\t// the minimap is rendered to the left, so move everything to the right\n\t\t\tglyphMarginLeft += minimapLayout.minimapWidth;\n\t\t\tlineNumbersLeft += minimapLayout.minimapWidth;\n\t\t\tdecorationsLeft += minimapLayout.minimapWidth;\n\t\t\tcontentLeft += minimapLayout.minimapWidth;\n\t\t}\n\t\tconst contentWidth = remainingWidth - minimapLayout.minimapWidth;\n\n\t\t// (leaving 2px for the cursor to have space after the last character)\n\t\tconst viewportColumn = Math.max(1, Math.floor((contentWidth - verticalScrollbarWidth - 2) / typicalHalfwidthCharacterWidth));\n\n\t\tconst verticalArrowSize = (verticalScrollbarHasArrows ? scrollbarArrowSize : 0);\n\n\t\tif (isViewportWrapping) {\n\t\t\t// compute the actual wrappingColumn\n\t\t\twrappingColumn = Math.max(1, viewportColumn);\n\t\t\tif (wordWrap === 'bounded') {\n\t\t\t\twrappingColumn = Math.min(wrappingColumn, wordWrapColumn);\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\twidth: outerWidth,\n\t\t\theight: outerHeight,\n\n\t\t\tglyphMarginLeft: glyphMarginLeft,\n\t\t\tglyphMarginWidth: glyphMarginWidth,\n\n\t\t\tlineNumbersLeft: lineNumbersLeft,\n\t\t\tlineNumbersWidth: lineNumbersWidth,\n\n\t\t\tdecorationsLeft: decorationsLeft,\n\t\t\tdecorationsWidth: lineDecorationsWidth,\n\n\t\t\tcontentLeft: contentLeft,\n\t\t\tcontentWidth: contentWidth,\n\n\t\t\tminimap: minimapLayout,\n\n\t\t\tviewportColumn: viewportColumn,\n\n\t\t\tisWordWrapMinified: isWordWrapMinified,\n\t\t\tisViewportWrapping: isViewportWrapping,\n\t\t\twrappingColumn: wrappingColumn,\n\n\t\t\tverticalScrollbarWidth: verticalScrollbarWidth,\n\t\t\thorizontalScrollbarHeight: horizontalScrollbarHeight,\n\n\t\t\toverviewRuler: {\n\t\t\t\ttop: verticalArrowSize,\n\t\t\t\twidth: verticalScrollbarWidth,\n\t\t\t\theight: (outerHeight - 2 * verticalArrowSize),\n\t\t\t\tright: 0\n\t\t\t}\n\t\t};\n\t}\n}\n\n//#endregion\n\n//#region lightbulb\n\n/**\n * Configuration options for editor lightbulb\n */\nexport interface IEditorLightbulbOptions {\n\t/**\n\t * Enable the lightbulb code action.\n\t * Defaults to true.\n\t */\n\tenabled?: boolean;\n}\n\nexport type EditorLightbulbOptions = Readonly<Required<IEditorLightbulbOptions>>;\n\nclass EditorLightbulb extends BaseEditorOption<EditorOption.lightbulb, EditorLightbulbOptions> {\n\n\tconstructor() {\n\t\tconst defaults: EditorLightbulbOptions = { enabled: true };\n\t\tsuper(\n\t\t\tEditorOption.lightbulb, 'lightbulb', defaults,\n\t\t\t{\n\t\t\t\t'editor.lightbulb.enabled': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: defaults.enabled,\n\t\t\t\t\tdescription: nls.localize('codeActions', \"Enables the code action lightbulb in the editor.\")\n\t\t\t\t},\n\t\t\t}\n\t\t);\n\t}\n\n\tpublic validate(_input: any): EditorLightbulbOptions {\n\t\tif (!_input || typeof _input !== 'object') {\n\t\t\treturn this.defaultValue;\n\t\t}\n\t\tconst input = _input as IEditorLightbulbOptions;\n\t\treturn {\n\t\t\tenabled: boolean(input.enabled, this.defaultValue.enabled)\n\t\t};\n\t}\n}\n\n//#endregion\n\n//#region inlineHints\n\n/**\n * Configuration options for editor inlineHints\n */\nexport interface IEditorInlineHintsOptions {\n\t/**\n\t * Enable the inline hints.\n\t * Defaults to true.\n\t */\n\tenabled?: boolean;\n\n\t/**\n\t * Font size of inline hints.\n\t * Default to 90% of the editor font size.\n\t */\n\tfontSize?: number;\n\n\t/**\n\t * Font family of inline hints.\n\t * Defaults to editor font family.\n\t */\n\tfontFamily?: string;\n}\n\nexport type EditorInlineHintsOptions = Readonly<Required<IEditorInlineHintsOptions>>;\n\nclass EditorInlineHints extends BaseEditorOption<EditorOption.inlineHints, EditorInlineHintsOptions> {\n\n\tconstructor() {\n\t\tconst defaults: EditorInlineHintsOptions = { enabled: true, fontSize: 0, fontFamily: EDITOR_FONT_DEFAULTS.fontFamily };\n\t\tsuper(\n\t\t\tEditorOption.inlineHints, 'inlineHints', defaults,\n\t\t\t{\n\t\t\t\t'editor.inlineHints.enabled': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: defaults.enabled,\n\t\t\t\t\tdescription: nls.localize('inlineHints.enable', \"Enables the inline hints in the editor.\")\n\t\t\t\t},\n\t\t\t\t'editor.inlineHints.fontSize': {\n\t\t\t\t\ttype: 'number',\n\t\t\t\t\tdefault: defaults.fontSize,\n\t\t\t\t\tdescription: nls.localize('inlineHints.fontSize', \"Controls font size of inline hints in the editor. When set to `0`, the 90% of `#editor.fontSize#` is used.\")\n\t\t\t\t},\n\t\t\t\t'editor.inlineHints.fontFamily': {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tdefault: defaults.fontFamily,\n\t\t\t\t\tdescription: nls.localize('inlineHints.fontFamily', \"Controls font family of inline hints in the editor.\")\n\t\t\t\t},\n\t\t\t}\n\t\t);\n\t}\n\n\tpublic validate(_input: any): EditorInlineHintsOptions {\n\t\tif (!_input || typeof _input !== 'object') {\n\t\t\treturn this.defaultValue;\n\t\t}\n\t\tconst input = _input as IEditorInlineHintsOptions;\n\t\treturn {\n\t\t\tenabled: boolean(input.enabled, this.defaultValue.enabled),\n\t\t\tfontSize: EditorIntOption.clampedInt(input.fontSize, this.defaultValue.fontSize, 0, 100),\n\t\t\tfontFamily: EditorStringOption.string(input.fontFamily, this.defaultValue.fontFamily)\n\t\t};\n\t}\n}\n\n//#endregion\n\n//#region lineHeight\n\nclass EditorLineHeight extends EditorIntOption<EditorOption.lineHeight> {\n\n\tconstructor() {\n\t\tsuper(\n\t\t\tEditorOption.lineHeight, 'lineHeight',\n\t\t\tEDITOR_FONT_DEFAULTS.lineHeight, 0, 150,\n\t\t\t{ description: nls.localize('lineHeight', \"Controls the line height. Use 0 to compute the line height from the font size.\") }\n\t\t);\n\t}\n\n\tpublic compute(env: IEnvironmentalOptions, options: IComputedEditorOptions, value: number): number {\n\t\t// The lineHeight is computed from the fontSize if it is 0.\n\t\t// Moreover, the final lineHeight respects the editor zoom level.\n\t\t// So take the result from env.fontInfo\n\t\treturn env.fontInfo.lineHeight;\n\t}\n}\n\n//#endregion\n\n//#region minimap\n\n/**\n * Configuration options for editor minimap\n */\nexport interface IEditorMinimapOptions {\n\t/**\n\t * Enable the rendering of the minimap.\n\t * Defaults to true.\n\t */\n\tenabled?: boolean;\n\t/**\n\t * Control the side of the minimap in editor.\n\t * Defaults to 'right'.\n\t */\n\tside?: 'right' | 'left';\n\t/**\n\t * Control the minimap rendering mode.\n\t * Defaults to 'actual'.\n\t */\n\tsize?: 'proportional' | 'fill' | 'fit';\n\t/**\n\t * Control the rendering of the minimap slider.\n\t * Defaults to 'mouseover'.\n\t */\n\tshowSlider?: 'always' | 'mouseover';\n\t/**\n\t * Render the actual text on a line (as opposed to color blocks).\n\t * Defaults to true.\n\t */\n\trenderCharacters?: boolean;\n\t/**\n\t * Limit the width of the minimap to render at most a certain number of columns.\n\t * Defaults to 120.\n\t */\n\tmaxColumn?: number;\n\t/**\n\t * Relative size of the font in the minimap. Defaults to 1.\n\t */\n\tscale?: number;\n}\n\nexport type EditorMinimapOptions = Readonly<Required<IEditorMinimapOptions>>;\n\nclass EditorMinimap extends BaseEditorOption<EditorOption.minimap, EditorMinimapOptions> {\n\n\tconstructor() {\n\t\tconst defaults: EditorMinimapOptions = {\n\t\t\tenabled: true,\n\t\t\tsize: 'proportional',\n\t\t\tside: 'right',\n\t\t\tshowSlider: 'mouseover',\n\t\t\trenderCharacters: true,\n\t\t\tmaxColumn: 120,\n\t\t\tscale: 1,\n\t\t};\n\t\tsuper(\n\t\t\tEditorOption.minimap, 'minimap', defaults,\n\t\t\t{\n\t\t\t\t'editor.minimap.enabled': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: defaults.enabled,\n\t\t\t\t\tdescription: nls.localize('minimap.enabled', \"Controls whether the minimap is shown.\")\n\t\t\t\t},\n\t\t\t\t'editor.minimap.size': {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tenum: ['proportional', 'fill', 'fit'],\n\t\t\t\t\tenumDescriptions: [\n\t\t\t\t\t\tnls.localize('minimap.size.proportional', \"The minimap has the same size as the editor contents (and might scroll).\"),\n\t\t\t\t\t\tnls.localize('minimap.size.fill', \"The minimap will stretch or shrink as necessary to fill the height of the editor (no scrolling).\"),\n\t\t\t\t\t\tnls.localize('minimap.size.fit', \"The minimap will shrink as necessary to never be larger than the editor (no scrolling).\"),\n\t\t\t\t\t],\n\t\t\t\t\tdefault: defaults.size,\n\t\t\t\t\tdescription: nls.localize('minimap.size', \"Controls the size of the minimap.\")\n\t\t\t\t},\n\t\t\t\t'editor.minimap.side': {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tenum: ['left', 'right'],\n\t\t\t\t\tdefault: defaults.side,\n\t\t\t\t\tdescription: nls.localize('minimap.side', \"Controls the side where to render the minimap.\")\n\t\t\t\t},\n\t\t\t\t'editor.minimap.showSlider': {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tenum: ['always', 'mouseover'],\n\t\t\t\t\tdefault: defaults.showSlider,\n\t\t\t\t\tdescription: nls.localize('minimap.showSlider', \"Controls when the minimap slider is shown.\")\n\t\t\t\t},\n\t\t\t\t'editor.minimap.scale': {\n\t\t\t\t\ttype: 'number',\n\t\t\t\t\tdefault: defaults.scale,\n\t\t\t\t\tminimum: 1,\n\t\t\t\t\tmaximum: 3,\n\t\t\t\t\tenum: [1, 2, 3],\n\t\t\t\t\tdescription: nls.localize('minimap.scale', \"Scale of content drawn in the minimap: 1, 2 or 3.\")\n\t\t\t\t},\n\t\t\t\t'editor.minimap.renderCharacters': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: defaults.renderCharacters,\n\t\t\t\t\tdescription: nls.localize('minimap.renderCharacters', \"Render the actual characters on a line as opposed to color blocks.\")\n\t\t\t\t},\n\t\t\t\t'editor.minimap.maxColumn': {\n\t\t\t\t\ttype: 'number',\n\t\t\t\t\tdefault: defaults.maxColumn,\n\t\t\t\t\tdescription: nls.localize('minimap.maxColumn', \"Limit the width of the minimap to render at most a certain number of columns.\")\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tpublic validate(_input: any): EditorMinimapOptions {\n\t\tif (!_input || typeof _input !== 'object') {\n\t\t\treturn this.defaultValue;\n\t\t}\n\t\tconst input = _input as IEditorMinimapOptions;\n\t\treturn {\n\t\t\tenabled: boolean(input.enabled, this.defaultValue.enabled),\n\t\t\tsize: stringSet<'proportional' | 'fill' | 'fit'>(input.size, this.defaultValue.size, ['proportional', 'fill', 'fit']),\n\t\t\tside: stringSet<'right' | 'left'>(input.side, this.defaultValue.side, ['right', 'left']),\n\t\t\tshowSlider: stringSet<'always' | 'mouseover'>(input.showSlider, this.defaultValue.showSlider, ['always', 'mouseover']),\n\t\t\trenderCharacters: boolean(input.renderCharacters, this.defaultValue.renderCharacters),\n\t\t\tscale: EditorIntOption.clampedInt(input.scale, 1, 1, 3),\n\t\t\tmaxColumn: EditorIntOption.clampedInt(input.maxColumn, this.defaultValue.maxColumn, 1, 10000),\n\t\t};\n\t}\n}\n\n//#endregion\n\n//#region multiCursorModifier\n\nfunction _multiCursorModifierFromString(multiCursorModifier: 'ctrlCmd' | 'alt'): 'altKey' | 'metaKey' | 'ctrlKey' {\n\tif (multiCursorModifier === 'ctrlCmd') {\n\t\treturn (platform.isMacintosh ? 'metaKey' : 'ctrlKey');\n\t}\n\treturn 'altKey';\n}\n\n//#endregion\n\n//#region padding\n\n/**\n * Configuration options for editor padding\n */\nexport interface IEditorPaddingOptions {\n\t/**\n\t * Spacing between top edge of editor and first line.\n\t */\n\ttop?: number;\n\t/**\n\t * Spacing between bottom edge of editor and last line.\n\t */\n\tbottom?: number;\n}\n\nexport interface InternalEditorPaddingOptions {\n\treadonly top: number;\n\treadonly bottom: number;\n}\n\nclass EditorPadding extends BaseEditorOption<EditorOption.padding, InternalEditorPaddingOptions> {\n\n\tconstructor() {\n\t\tsuper(\n\t\t\tEditorOption.padding, 'padding', { top: 0, bottom: 0 },\n\t\t\t{\n\t\t\t\t'editor.padding.top': {\n\t\t\t\t\ttype: 'number',\n\t\t\t\t\tdefault: 0,\n\t\t\t\t\tminimum: 0,\n\t\t\t\t\tmaximum: 1000,\n\t\t\t\t\tdescription: nls.localize('padding.top', \"Controls the amount of space between the top edge of the editor and the first line.\")\n\t\t\t\t},\n\t\t\t\t'editor.padding.bottom': {\n\t\t\t\t\ttype: 'number',\n\t\t\t\t\tdefault: 0,\n\t\t\t\t\tminimum: 0,\n\t\t\t\t\tmaximum: 1000,\n\t\t\t\t\tdescription: nls.localize('padding.bottom', \"Controls the amount of space between the bottom edge of the editor and the last line.\")\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tpublic validate(_input: any): InternalEditorPaddingOptions {\n\t\tif (!_input || typeof _input !== 'object') {\n\t\t\treturn this.defaultValue;\n\t\t}\n\t\tconst input = _input as IEditorPaddingOptions;\n\n\t\treturn {\n\t\t\ttop: EditorIntOption.clampedInt(input.top, 0, 0, 1000),\n\t\t\tbottom: EditorIntOption.clampedInt(input.bottom, 0, 0, 1000)\n\t\t};\n\t}\n}\n//#endregion\n\n//#region parameterHints\n\n/**\n * Configuration options for parameter hints\n */\nexport interface IEditorParameterHintOptions {\n\t/**\n\t * Enable parameter hints.\n\t * Defaults to true.\n\t */\n\tenabled?: boolean;\n\t/**\n\t * Enable cycling of parameter hints.\n\t * Defaults to false.\n\t */\n\tcycle?: boolean;\n}\n\nexport type InternalParameterHintOptions = Readonly<Required<IEditorParameterHintOptions>>;\n\nclass EditorParameterHints extends BaseEditorOption<EditorOption.parameterHints, InternalParameterHintOptions> {\n\n\tconstructor() {\n\t\tconst defaults: InternalParameterHintOptions = {\n\t\t\tenabled: true,\n\t\t\tcycle: false\n\t\t};\n\t\tsuper(\n\t\t\tEditorOption.parameterHints, 'parameterHints', defaults,\n\t\t\t{\n\t\t\t\t'editor.parameterHints.enabled': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: defaults.enabled,\n\t\t\t\t\tdescription: nls.localize('parameterHints.enabled', \"Enables a pop-up that shows parameter documentation and type information as you type.\")\n\t\t\t\t},\n\t\t\t\t'editor.parameterHints.cycle': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: defaults.cycle,\n\t\t\t\t\tdescription: nls.localize('parameterHints.cycle', \"Controls whether the parameter hints menu cycles or closes when reaching the end of the list.\")\n\t\t\t\t},\n\t\t\t}\n\t\t);\n\t}\n\n\tpublic validate(_input: any): InternalParameterHintOptions {\n\t\tif (!_input || typeof _input !== 'object') {\n\t\t\treturn this.defaultValue;\n\t\t}\n\t\tconst input = _input as IEditorParameterHintOptions;\n\t\treturn {\n\t\t\tenabled: boolean(input.enabled, this.defaultValue.enabled),\n\t\t\tcycle: boolean(input.cycle, this.defaultValue.cycle)\n\t\t};\n\t}\n}\n\n//#endregion\n\n//#region pixelRatio\n\nclass EditorPixelRatio extends ComputedEditorOption<EditorOption.pixelRatio, number> {\n\n\tconstructor() {\n\t\tsuper(EditorOption.pixelRatio);\n\t}\n\n\tpublic compute(env: IEnvironmentalOptions, options: IComputedEditorOptions, _: number): number {\n\t\treturn env.pixelRatio;\n\t}\n}\n\n//#endregion\n\n//#region quickSuggestions\n\n/**\n * Configuration options for quick suggestions\n */\nexport interface IQuickSuggestionsOptions {\n\tother?: boolean;\n\tcomments?: boolean;\n\tstrings?: boolean;\n}\n\nexport type ValidQuickSuggestionsOptions = boolean | Readonly<Required<IQuickSuggestionsOptions>>;\n\nclass EditorQuickSuggestions extends BaseEditorOption<EditorOption.quickSuggestions, ValidQuickSuggestionsOptions> {\n\n\tpublic readonly defaultValue: Readonly<Required<IQuickSuggestionsOptions>>;\n\n\tconstructor() {\n\t\tconst defaults: ValidQuickSuggestionsOptions = {\n\t\t\tother: true,\n\t\t\tcomments: false,\n\t\t\tstrings: false\n\t\t};\n\t\tsuper(\n\t\t\tEditorOption.quickSuggestions, 'quickSuggestions', defaults,\n\t\t\t{\n\t\t\t\tanyOf: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'object',\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tstrings: {\n\t\t\t\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\t\t\t\tdefault: defaults.strings,\n\t\t\t\t\t\t\t\tdescription: nls.localize('quickSuggestions.strings', \"Enable quick suggestions inside strings.\")\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcomments: {\n\t\t\t\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\t\t\t\tdefault: defaults.comments,\n\t\t\t\t\t\t\t\tdescription: nls.localize('quickSuggestions.comments', \"Enable quick suggestions inside comments.\")\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tother: {\n\t\t\t\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\t\t\t\tdefault: defaults.other,\n\t\t\t\t\t\t\t\tdescription: nls.localize('quickSuggestions.other', \"Enable quick suggestions outside of strings and comments.\")\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tdefault: defaults,\n\t\t\t\tdescription: nls.localize('quickSuggestions', \"Controls whether suggestions should automatically show up while typing.\")\n\t\t\t}\n\t\t);\n\t\tthis.defaultValue = defaults;\n\t}\n\n\tpublic validate(_input: any): ValidQuickSuggestionsOptions {\n\t\tif (typeof _input === 'boolean') {\n\t\t\treturn _input;\n\t\t}\n\t\tif (_input && typeof _input === 'object') {\n\t\t\tconst input = _input as IQuickSuggestionsOptions;\n\t\t\tconst opts = {\n\t\t\t\tother: boolean(input.other, this.defaultValue.other),\n\t\t\t\tcomments: boolean(input.comments, this.defaultValue.comments),\n\t\t\t\tstrings: boolean(input.strings, this.defaultValue.strings),\n\t\t\t};\n\t\t\tif (opts.other && opts.comments && opts.strings) {\n\t\t\t\treturn true; // all on\n\t\t\t} else if (!opts.other && !opts.comments && !opts.strings) {\n\t\t\t\treturn false; // all off\n\t\t\t} else {\n\t\t\t\treturn opts;\n\t\t\t}\n\t\t}\n\t\treturn this.defaultValue;\n\t}\n}\n\n//#endregion\n\n//#region renderLineNumbers\n\nexport type LineNumbersType = 'on' | 'off' | 'relative' | 'interval' | ((lineNumber: number) => string);\n\nexport const enum RenderLineNumbersType {\n\tOff = 0,\n\tOn = 1,\n\tRelative = 2,\n\tInterval = 3,\n\tCustom = 4\n}\n\nexport interface InternalEditorRenderLineNumbersOptions {\n\treadonly renderType: RenderLineNumbersType;\n\treadonly renderFn: ((lineNumber: number) => string) | null;\n}\n\nclass EditorRenderLineNumbersOption extends BaseEditorOption<EditorOption.lineNumbers, InternalEditorRenderLineNumbersOptions> {\n\n\tconstructor() {\n\t\tsuper(\n\t\t\tEditorOption.lineNumbers, 'lineNumbers', { renderType: RenderLineNumbersType.On, renderFn: null },\n\t\t\t{\n\t\t\t\ttype: 'string',\n\t\t\t\tenum: ['off', 'on', 'relative', 'interval'],\n\t\t\t\tenumDescriptions: [\n\t\t\t\t\tnls.localize('lineNumbers.off', \"Line numbers are not rendered.\"),\n\t\t\t\t\tnls.localize('lineNumbers.on', \"Line numbers are rendered as absolute number.\"),\n\t\t\t\t\tnls.localize('lineNumbers.relative', \"Line numbers are rendered as distance in lines to cursor position.\"),\n\t\t\t\t\tnls.localize('lineNumbers.interval', \"Line numbers are rendered every 10 lines.\")\n\t\t\t\t],\n\t\t\t\tdefault: 'on',\n\t\t\t\tdescription: nls.localize('lineNumbers', \"Controls the display of line numbers.\")\n\t\t\t}\n\t\t);\n\t}\n\n\tpublic validate(lineNumbers: any): InternalEditorRenderLineNumbersOptions {\n\t\tlet renderType: RenderLineNumbersType = this.defaultValue.renderType;\n\t\tlet renderFn: ((lineNumber: number) => string) | null = this.defaultValue.renderFn;\n\n\t\tif (typeof lineNumbers !== 'undefined') {\n\t\t\tif (typeof lineNumbers === 'function') {\n\t\t\t\trenderType = RenderLineNumbersType.Custom;\n\t\t\t\trenderFn = lineNumbers;\n\t\t\t} else if (lineNumbers === 'interval') {\n\t\t\t\trenderType = RenderLineNumbersType.Interval;\n\t\t\t} else if (lineNumbers === 'relative') {\n\t\t\t\trenderType = RenderLineNumbersType.Relative;\n\t\t\t} else if (lineNumbers === 'on') {\n\t\t\t\trenderType = RenderLineNumbersType.On;\n\t\t\t} else {\n\t\t\t\trenderType = RenderLineNumbersType.Off;\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\trenderType,\n\t\t\trenderFn\n\t\t};\n\t}\n}\n\n//#endregion\n\n//#region renderValidationDecorations\n\n/**\n * @internal\n */\nexport function filterValidationDecorations(options: IComputedEditorOptions): boolean {\n\tconst renderValidationDecorations = options.get(EditorOption.renderValidationDecorations);\n\tif (renderValidationDecorations === 'editable') {\n\t\treturn options.get(EditorOption.readOnly);\n\t}\n\treturn renderValidationDecorations === 'on' ? false : true;\n}\n\n//#endregion\n\n//#region rulers\n\nexport interface IRulerOption {\n\treadonly column: number;\n\treadonly color: string | null;\n}\n\nclass EditorRulers extends BaseEditorOption<EditorOption.rulers, IRulerOption[]> {\n\n\tconstructor() {\n\t\tconst defaults: IRulerOption[] = [];\n\t\tconst columnSchema: IJSONSchema = { type: 'number', description: nls.localize('rulers.size', \"Number of monospace characters at which this editor ruler will render.\") };\n\t\tsuper(\n\t\t\tEditorOption.rulers, 'rulers', defaults,\n\t\t\t{\n\t\t\t\ttype: 'array',\n\t\t\t\titems: {\n\t\t\t\t\tanyOf: [\n\t\t\t\t\t\tcolumnSchema,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: [\n\t\t\t\t\t\t\t\t'object'\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\tcolumn: columnSchema,\n\t\t\t\t\t\t\t\tcolor: {\n\t\t\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t\t\t\tdescription: nls.localize('rulers.color', \"Color of this editor ruler.\"),\n\t\t\t\t\t\t\t\t\tformat: 'color-hex'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\tdefault: defaults,\n\t\t\t\tdescription: nls.localize('rulers', \"Render vertical rulers after a certain number of monospace characters. Use multiple values for multiple rulers. No rulers are drawn if array is empty.\")\n\t\t\t}\n\t\t);\n\t}\n\n\tpublic validate(input: any): IRulerOption[] {\n\t\tif (Array.isArray(input)) {\n\t\t\tlet rulers: IRulerOption[] = [];\n\t\t\tfor (let _element of input) {\n\t\t\t\tif (typeof _element === 'number') {\n\t\t\t\t\trulers.push({\n\t\t\t\t\t\tcolumn: EditorIntOption.clampedInt(_element, 0, 0, 10000),\n\t\t\t\t\t\tcolor: null\n\t\t\t\t\t});\n\t\t\t\t} else if (_element && typeof _element === 'object') {\n\t\t\t\t\tconst element = _element as IRulerOption;\n\t\t\t\t\trulers.push({\n\t\t\t\t\t\tcolumn: EditorIntOption.clampedInt(element.column, 0, 0, 10000),\n\t\t\t\t\t\tcolor: element.color\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\trulers.sort((a, b) => a.column - b.column);\n\t\t\treturn rulers;\n\t\t}\n\t\treturn this.defaultValue;\n\t}\n}\n\n//#endregion\n\n//#region scrollbar\n\n/**\n * Configuration options for editor scrollbars\n */\nexport interface IEditorScrollbarOptions {\n\t/**\n\t * The size of arrows (if displayed).\n\t * Defaults to 11.\n\t */\n\tarrowSize?: number;\n\t/**\n\t * Render vertical scrollbar.\n\t * Defaults to 'auto'.\n\t */\n\tvertical?: 'auto' | 'visible' | 'hidden';\n\t/**\n\t * Render horizontal scrollbar.\n\t * Defaults to 'auto'.\n\t */\n\thorizontal?: 'auto' | 'visible' | 'hidden';\n\t/**\n\t * Cast horizontal and vertical shadows when the content is scrolled.\n\t * Defaults to true.\n\t */\n\tuseShadows?: boolean;\n\t/**\n\t * Render arrows at the top and bottom of the vertical scrollbar.\n\t * Defaults to false.\n\t */\n\tverticalHasArrows?: boolean;\n\t/**\n\t * Render arrows at the left and right of the horizontal scrollbar.\n\t * Defaults to false.\n\t */\n\thorizontalHasArrows?: boolean;\n\t/**\n\t * Listen to mouse wheel events and react to them by scrolling.\n\t * Defaults to true.\n\t */\n\thandleMouseWheel?: boolean;\n\t/**\n\t * Always consume mouse wheel events (always call preventDefault() and stopPropagation() on the browser events).\n\t * Defaults to true.\n\t */\n\talwaysConsumeMouseWheel?: boolean;\n\t/**\n\t * Height in pixels for the horizontal scrollbar.\n\t * Defaults to 10 (px).\n\t */\n\thorizontalScrollbarSize?: number;\n\t/**\n\t * Width in pixels for the vertical scrollbar.\n\t * Defaults to 10 (px).\n\t */\n\tverticalScrollbarSize?: number;\n\t/**\n\t * Width in pixels for the vertical slider.\n\t * Defaults to `verticalScrollbarSize`.\n\t */\n\tverticalSliderSize?: number;\n\t/**\n\t * Height in pixels for the horizontal slider.\n\t * Defaults to `horizontalScrollbarSize`.\n\t */\n\thorizontalSliderSize?: number;\n\t/**\n\t * Scroll gutter clicks move by page vs jump to position.\n\t * Defaults to false.\n\t */\n\tscrollByPage?: boolean;\n}\n\nexport interface InternalEditorScrollbarOptions {\n\treadonly arrowSize: number;\n\treadonly vertical: ScrollbarVisibility;\n\treadonly horizontal: ScrollbarVisibility;\n\treadonly useShadows: boolean;\n\treadonly verticalHasArrows: boolean;\n\treadonly horizontalHasArrows: boolean;\n\treadonly handleMouseWheel: boolean;\n\treadonly alwaysConsumeMouseWheel: boolean;\n\treadonly horizontalScrollbarSize: number;\n\treadonly horizontalSliderSize: number;\n\treadonly verticalScrollbarSize: number;\n\treadonly verticalSliderSize: number;\n\treadonly scrollByPage: boolean;\n}\n\nfunction _scrollbarVisibilityFromString(visibility: string | undefined, defaultValue: ScrollbarVisibility): ScrollbarVisibility {\n\tif (typeof visibility !== 'string') {\n\t\treturn defaultValue;\n\t}\n\tswitch (visibility) {\n\t\tcase 'hidden': return ScrollbarVisibility.Hidden;\n\t\tcase 'visible': return ScrollbarVisibility.Visible;\n\t\tdefault: return ScrollbarVisibility.Auto;\n\t}\n}\n\nclass EditorScrollbar extends BaseEditorOption<EditorOption.scrollbar, InternalEditorScrollbarOptions> {\n\n\tconstructor() {\n\t\tsuper(\n\t\t\tEditorOption.scrollbar, 'scrollbar',\n\t\t\t{\n\t\t\t\tvertical: ScrollbarVisibility.Auto,\n\t\t\t\thorizontal: ScrollbarVisibility.Auto,\n\t\t\t\tarrowSize: 11,\n\t\t\t\tuseShadows: true,\n\t\t\t\tverticalHasArrows: false,\n\t\t\t\thorizontalHasArrows: false,\n\t\t\t\thorizontalScrollbarSize: 12,\n\t\t\t\thorizontalSliderSize: 12,\n\t\t\t\tverticalScrollbarSize: 14,\n\t\t\t\tverticalSliderSize: 14,\n\t\t\t\thandleMouseWheel: true,\n\t\t\t\talwaysConsumeMouseWheel: true,\n\t\t\t\tscrollByPage: false\n\t\t\t}\n\t\t);\n\t}\n\n\tpublic validate(_input: any): InternalEditorScrollbarOptions {\n\t\tif (!_input || typeof _input !== 'object') {\n\t\t\treturn this.defaultValue;\n\t\t}\n\t\tconst input = _input as IEditorScrollbarOptions;\n\t\tconst horizontalScrollbarSize = EditorIntOption.clampedInt(input.horizontalScrollbarSize, this.defaultValue.horizontalScrollbarSize, 0, 1000);\n\t\tconst verticalScrollbarSize = EditorIntOption.clampedInt(input.verticalScrollbarSize, this.defaultValue.verticalScrollbarSize, 0, 1000);\n\t\treturn {\n\t\t\tarrowSize: EditorIntOption.clampedInt(input.arrowSize, this.defaultValue.arrowSize, 0, 1000),\n\t\t\tvertical: _scrollbarVisibilityFromString(input.vertical, this.defaultValue.vertical),\n\t\t\thorizontal: _scrollbarVisibilityFromString(input.horizontal, this.defaultValue.horizontal),\n\t\t\tuseShadows: boolean(input.useShadows, this.defaultValue.useShadows),\n\t\t\tverticalHasArrows: boolean(input.verticalHasArrows, this.defaultValue.verticalHasArrows),\n\t\t\thorizontalHasArrows: boolean(input.horizontalHasArrows, this.defaultValue.horizontalHasArrows),\n\t\t\thandleMouseWheel: boolean(input.handleMouseWheel, this.defaultValue.handleMouseWheel),\n\t\t\talwaysConsumeMouseWheel: boolean(input.alwaysConsumeMouseWheel, this.defaultValue.alwaysConsumeMouseWheel),\n\t\t\thorizontalScrollbarSize: horizontalScrollbarSize,\n\t\t\thorizontalSliderSize: EditorIntOption.clampedInt(input.horizontalSliderSize, horizontalScrollbarSize, 0, 1000),\n\t\t\tverticalScrollbarSize: verticalScrollbarSize,\n\t\t\tverticalSliderSize: EditorIntOption.clampedInt(input.verticalSliderSize, verticalScrollbarSize, 0, 1000),\n\t\t\tscrollByPage: boolean(input.scrollByPage, this.defaultValue.scrollByPage),\n\t\t};\n\t}\n}\n\n//#endregion\n\n//#region suggest\n\n/**\n * Configuration options for editor suggest widget\n */\nexport interface ISuggestOptions {\n\t/**\n\t * Overwrite word ends on accept. Default to false.\n\t */\n\tinsertMode?: 'insert' | 'replace';\n\t/**\n\t * Enable graceful matching. Defaults to true.\n\t */\n\tfilterGraceful?: boolean;\n\t/**\n\t * Prevent quick suggestions when a snippet is active. Defaults to true.\n\t */\n\tsnippetsPreventQuickSuggestions?: boolean;\n\t/**\n\t * Favours words that appear close to the cursor.\n\t */\n\tlocalityBonus?: boolean;\n\t/**\n\t * Enable using global storage for remembering suggestions.\n\t */\n\tshareSuggestSelections?: boolean;\n\t/**\n\t * Enable or disable icons in suggestions. Defaults to true.\n\t */\n\tshowIcons?: boolean;\n\t/**\n\t * Enable or disable the suggest status bar.\n\t */\n\tshowStatusBar?: boolean;\n\t/**\n\t * Show details inline with the label. Defaults to true.\n\t */\n\tshowInlineDetails?: boolean;\n\t/**\n\t * Show method-suggestions.\n\t */\n\tshowMethods?: boolean;\n\t/**\n\t * Show function-suggestions.\n\t */\n\tshowFunctions?: boolean;\n\t/**\n\t * Show constructor-suggestions.\n\t */\n\tshowConstructors?: boolean;\n\t/**\n\t * Show field-suggestions.\n\t */\n\tshowFields?: boolean;\n\t/**\n\t * Show variable-suggestions.\n\t */\n\tshowVariables?: boolean;\n\t/**\n\t * Show class-suggestions.\n\t */\n\tshowClasses?: boolean;\n\t/**\n\t * Show struct-suggestions.\n\t */\n\tshowStructs?: boolean;\n\t/**\n\t * Show interface-suggestions.\n\t */\n\tshowInterfaces?: boolean;\n\t/**\n\t * Show module-suggestions.\n\t */\n\tshowModules?: boolean;\n\t/**\n\t * Show property-suggestions.\n\t */\n\tshowProperties?: boolean;\n\t/**\n\t * Show event-suggestions.\n\t */\n\tshowEvents?: boolean;\n\t/**\n\t * Show operator-suggestions.\n\t */\n\tshowOperators?: boolean;\n\t/**\n\t * Show unit-suggestions.\n\t */\n\tshowUnits?: boolean;\n\t/**\n\t * Show value-suggestions.\n\t */\n\tshowValues?: boolean;\n\t/**\n\t * Show constant-suggestions.\n\t */\n\tshowConstants?: boolean;\n\t/**\n\t * Show enum-suggestions.\n\t */\n\tshowEnums?: boolean;\n\t/**\n\t * Show enumMember-suggestions.\n\t */\n\tshowEnumMembers?: boolean;\n\t/**\n\t * Show keyword-suggestions.\n\t */\n\tshowKeywords?: boolean;\n\t/**\n\t * Show text-suggestions.\n\t */\n\tshowWords?: boolean;\n\t/**\n\t * Show color-suggestions.\n\t */\n\tshowColors?: boolean;\n\t/**\n\t * Show file-suggestions.\n\t */\n\tshowFiles?: boolean;\n\t/**\n\t * Show reference-suggestions.\n\t */\n\tshowReferences?: boolean;\n\t/**\n\t * Show folder-suggestions.\n\t */\n\tshowFolders?: boolean;\n\t/**\n\t * Show typeParameter-suggestions.\n\t */\n\tshowTypeParameters?: boolean;\n\t/**\n\t * Show issue-suggestions.\n\t */\n\tshowIssues?: boolean;\n\t/**\n\t * Show user-suggestions.\n\t */\n\tshowUsers?: boolean;\n\t/**\n\t * Show snippet-suggestions.\n\t */\n\tshowSnippets?: boolean;\n}\n\nexport type InternalSuggestOptions = Readonly<Required<ISuggestOptions>>;\n\nclass EditorSuggest extends BaseEditorOption<EditorOption.suggest, InternalSuggestOptions> {\n\n\tconstructor() {\n\t\tconst defaults: InternalSuggestOptions = {\n\t\t\tinsertMode: 'insert',\n\t\t\tfilterGraceful: true,\n\t\t\tsnippetsPreventQuickSuggestions: true,\n\t\t\tlocalityBonus: false,\n\t\t\tshareSuggestSelections: false,\n\t\t\tshowIcons: true,\n\t\t\tshowStatusBar: false,\n\t\t\tshowInlineDetails: true,\n\t\t\tshowMethods: true,\n\t\t\tshowFunctions: true,\n\t\t\tshowConstructors: true,\n\t\t\tshowFields: true,\n\t\t\tshowVariables: true,\n\t\t\tshowClasses: true,\n\t\t\tshowStructs: true,\n\t\t\tshowInterfaces: true,\n\t\t\tshowModules: true,\n\t\t\tshowProperties: true,\n\t\t\tshowEvents: true,\n\t\t\tshowOperators: true,\n\t\t\tshowUnits: true,\n\t\t\tshowValues: true,\n\t\t\tshowConstants: true,\n\t\t\tshowEnums: true,\n\t\t\tshowEnumMembers: true,\n\t\t\tshowKeywords: true,\n\t\t\tshowWords: true,\n\t\t\tshowColors: true,\n\t\t\tshowFiles: true,\n\t\t\tshowReferences: true,\n\t\t\tshowFolders: true,\n\t\t\tshowTypeParameters: true,\n\t\t\tshowSnippets: true,\n\t\t\tshowUsers: true,\n\t\t\tshowIssues: true,\n\t\t};\n\t\tsuper(\n\t\t\tEditorOption.suggest, 'suggest', defaults,\n\t\t\t{\n\t\t\t\t'editor.suggest.insertMode': {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tenum: ['insert', 'replace'],\n\t\t\t\t\tenumDescriptions: [\n\t\t\t\t\t\tnls.localize('suggest.insertMode.insert', \"Insert suggestion without overwriting text right of the cursor.\"),\n\t\t\t\t\t\tnls.localize('suggest.insertMode.replace', \"Insert suggestion and overwrite text right of the cursor.\"),\n\t\t\t\t\t],\n\t\t\t\t\tdefault: defaults.insertMode,\n\t\t\t\t\tdescription: nls.localize('suggest.insertMode', \"Controls whether words are overwritten when accepting completions. Note that this depends on extensions opting into this feature.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.filterGraceful': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: defaults.filterGraceful,\n\t\t\t\t\tdescription: nls.localize('suggest.filterGraceful', \"Controls whether filtering and sorting suggestions accounts for small typos.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.localityBonus': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: defaults.localityBonus,\n\t\t\t\t\tdescription: nls.localize('suggest.localityBonus', \"Controls whether sorting favours words that appear close to the cursor.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.shareSuggestSelections': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: defaults.shareSuggestSelections,\n\t\t\t\t\tmarkdownDescription: nls.localize('suggest.shareSuggestSelections', \"Controls whether remembered suggestion selections are shared between multiple workspaces and windows (needs `#editor.suggestSelection#`).\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.snippetsPreventQuickSuggestions': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: defaults.snippetsPreventQuickSuggestions,\n\t\t\t\t\tdescription: nls.localize('suggest.snippetsPreventQuickSuggestions', \"Controls whether an active snippet prevents quick suggestions.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.showIcons': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: defaults.showIcons,\n\t\t\t\t\tdescription: nls.localize('suggest.showIcons', \"Controls whether to show or hide icons in suggestions.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.showStatusBar': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: defaults.showStatusBar,\n\t\t\t\t\tdescription: nls.localize('suggest.showStatusBar', \"Controls the visibility of the status bar at the bottom of the suggest widget.\")\n\t\t\t\t},\n\n\t\t\t\t'editor.suggest.showInlineDetails': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: defaults.showInlineDetails,\n\t\t\t\t\tdescription: nls.localize('suggest.showInlineDetails', \"Controls whether suggest details show inline with the label or only in the details widget\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.maxVisibleSuggestions': {\n\t\t\t\t\ttype: 'number',\n\t\t\t\t\tdeprecationMessage: nls.localize('suggest.maxVisibleSuggestions.dep', \"This setting is deprecated. The suggest widget can now be resized.\"),\n\t\t\t\t},\n\t\t\t\t'editor.suggest.filteredTypes': {\n\t\t\t\t\ttype: 'object',\n\t\t\t\t\tdeprecationMessage: nls.localize('deprecated', \"This setting is deprecated, please use separate settings like 'editor.suggest.showKeywords' or 'editor.suggest.showSnippets' instead.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.showMethods': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tmarkdownDescription: nls.localize('editor.suggest.showMethods', \"When enabled IntelliSense shows `method`-suggestions.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.showFunctions': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tmarkdownDescription: nls.localize('editor.suggest.showFunctions', \"When enabled IntelliSense shows `function`-suggestions.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.showConstructors': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tmarkdownDescription: nls.localize('editor.suggest.showConstructors', \"When enabled IntelliSense shows `constructor`-suggestions.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.showFields': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tmarkdownDescription: nls.localize('editor.suggest.showFields', \"When enabled IntelliSense shows `field`-suggestions.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.showVariables': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tmarkdownDescription: nls.localize('editor.suggest.showVariables', \"When enabled IntelliSense shows `variable`-suggestions.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.showClasses': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tmarkdownDescription: nls.localize('editor.suggest.showClasss', \"When enabled IntelliSense shows `class`-suggestions.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.showStructs': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tmarkdownDescription: nls.localize('editor.suggest.showStructs', \"When enabled IntelliSense shows `struct`-suggestions.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.showInterfaces': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tmarkdownDescription: nls.localize('editor.suggest.showInterfaces', \"When enabled IntelliSense shows `interface`-suggestions.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.showModules': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tmarkdownDescription: nls.localize('editor.suggest.showModules', \"When enabled IntelliSense shows `module`-suggestions.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.showProperties': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tmarkdownDescription: nls.localize('editor.suggest.showPropertys', \"When enabled IntelliSense shows `property`-suggestions.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.showEvents': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tmarkdownDescription: nls.localize('editor.suggest.showEvents', \"When enabled IntelliSense shows `event`-suggestions.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.showOperators': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tmarkdownDescription: nls.localize('editor.suggest.showOperators', \"When enabled IntelliSense shows `operator`-suggestions.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.showUnits': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tmarkdownDescription: nls.localize('editor.suggest.showUnits', \"When enabled IntelliSense shows `unit`-suggestions.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.showValues': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tmarkdownDescription: nls.localize('editor.suggest.showValues', \"When enabled IntelliSense shows `value`-suggestions.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.showConstants': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tmarkdownDescription: nls.localize('editor.suggest.showConstants', \"When enabled IntelliSense shows `constant`-suggestions.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.showEnums': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tmarkdownDescription: nls.localize('editor.suggest.showEnums', \"When enabled IntelliSense shows `enum`-suggestions.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.showEnumMembers': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tmarkdownDescription: nls.localize('editor.suggest.showEnumMembers', \"When enabled IntelliSense shows `enumMember`-suggestions.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.showKeywords': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tmarkdownDescription: nls.localize('editor.suggest.showKeywords', \"When enabled IntelliSense shows `keyword`-suggestions.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.showWords': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tmarkdownDescription: nls.localize('editor.suggest.showTexts', \"When enabled IntelliSense shows `text`-suggestions.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.showColors': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tmarkdownDescription: nls.localize('editor.suggest.showColors', \"When enabled IntelliSense shows `color`-suggestions.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.showFiles': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tmarkdownDescription: nls.localize('editor.suggest.showFiles', \"When enabled IntelliSense shows `file`-suggestions.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.showReferences': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tmarkdownDescription: nls.localize('editor.suggest.showReferences', \"When enabled IntelliSense shows `reference`-suggestions.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.showCustomcolors': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tmarkdownDescription: nls.localize('editor.suggest.showCustomcolors', \"When enabled IntelliSense shows `customcolor`-suggestions.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.showFolders': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tmarkdownDescription: nls.localize('editor.suggest.showFolders', \"When enabled IntelliSense shows `folder`-suggestions.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.showTypeParameters': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tmarkdownDescription: nls.localize('editor.suggest.showTypeParameters', \"When enabled IntelliSense shows `typeParameter`-suggestions.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.showSnippets': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tmarkdownDescription: nls.localize('editor.suggest.showSnippets', \"When enabled IntelliSense shows `snippet`-suggestions.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.showUsers': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tmarkdownDescription: nls.localize('editor.suggest.showUsers', \"When enabled IntelliSense shows `user`-suggestions.\")\n\t\t\t\t},\n\t\t\t\t'editor.suggest.showIssues': {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tdefault: true,\n\t\t\t\t\tmarkdownDescription: nls.localize('editor.suggest.showIssues', \"When enabled IntelliSense shows `issues`-suggestions.\")\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tpublic validate(_input: any): InternalSuggestOptions {\n\t\tif (!_input || typeof _input !== 'object') {\n\t\t\treturn this.defaultValue;\n\t\t}\n\t\tconst input = _input as ISuggestOptions;\n\t\treturn {\n\t\t\tinsertMode: stringSet(input.insertMode, this.defaultValue.insertMode, ['insert', 'replace']),\n\t\t\tfilterGraceful: boolean(input.filterGraceful, this.defaultValue.filterGraceful),\n\t\t\tsnippetsPreventQuickSuggestions: boolean(input.snippetsPreventQuickSuggestions, this.defaultValue.filterGraceful),\n\t\t\tlocalityBonus: boolean(input.localityBonus, this.defaultValue.localityBonus),\n\t\t\tshareSuggestSelections: boolean(input.shareSuggestSelections, this.defaultValue.shareSuggestSelections),\n\t\t\tshowIcons: boolean(input.showIcons, this.defaultValue.showIcons),\n\t\t\tshowStatusBar: boolean(input.showStatusBar, this.defaultValue.showStatusBar),\n\t\t\tshowInlineDetails: boolean(input.showInlineDetails, this.defaultValue.showInlineDetails),\n\t\t\tshowMethods: boolean(input.showMethods, this.defaultValue.showMethods),\n\t\t\tshowFunctions: boolean(input.showFunctions, this.defaultValue.showFunctions),\n\t\t\tshowConstructors: boolean(input.showConstructors, this.defaultValue.showConstructors),\n\t\t\tshowFields: boolean(input.showFields, this.defaultValue.showFields),\n\t\t\tshowVariables: boolean(input.showVariables, this.defaultValue.showVariables),\n\t\t\tshowClasses: boolean(input.showClasses, this.defaultValue.showClasses),\n\t\t\tshowStructs: boolean(input.showStructs, this.defaultValue.showStructs),\n\t\t\tshowInterfaces: boolean(input.showInterfaces, this.defaultValue.showInterfaces),\n\t\t\tshowModules: boolean(input.showModules, this.defaultValue.showModules),\n\t\t\tshowProperties: boolean(input.showProperties, this.defaultValue.showProperties),\n\t\t\tshowEvents: boolean(input.showEvents, this.defaultValue.showEvents),\n\t\t\tshowOperators: boolean(input.showOperators, this.defaultValue.showOperators),\n\t\t\tshowUnits: boolean(input.showUnits, this.defaultValue.showUnits),\n\t\t\tshowValues: boolean(input.showValues, this.defaultValue.showValues),\n\t\t\tshowConstants: boolean(input.showConstants, this.defaultValue.showConstants),\n\t\t\tshowEnums: boolean(input.showEnums, this.defaultValue.showEnums),\n\t\t\tshowEnumMembers: boolean(input.showEnumMembers, this.defaultValue.showEnumMembers),\n\t\t\tshowKeywords: boolean(input.showKeywords, this.defaultValue.showKeywords),\n\t\t\tshowWords: boolean(input.showWords, this.defaultValue.showWords),\n\t\t\tshowColors: boolean(input.showColors, this.defaultValue.showColors),\n\t\t\tshowFiles: boolean(input.showFiles, this.defaultValue.showFiles),\n\t\t\tshowReferences: boolean(input.showReferences, this.defaultValue.showReferences),\n\t\t\tshowFolders: boolean(input.showFolders, this.defaultValue.showFolders),\n\t\t\tshowTypeParameters: boolean(input.showTypeParameters, this.defaultValue.showTypeParameters),\n\t\t\tshowSnippets: boolean(input.showSnippets, this.defaultValue.showSnippets),\n\t\t\tshowUsers: boolean(input.showUsers, this.defaultValue.showUsers),\n\t\t\tshowIssues: boolean(input.showIssues, this.defaultValue.showIssues),\n\t\t};\n\t}\n}\n\n//#endregion\n\n//#region smart select\n\nexport interface ISmartSelectOptions {\n\tselectLeadingAndTrailingWhitespace?: boolean\n}\n\nexport type SmartSelectOptions = Readonly<Required<ISmartSelectOptions>>;\n\nclass SmartSelect extends BaseEditorOption<EditorOption.smartSelect, SmartSelectOptions> {\n\n\tconstructor() {\n\t\tsuper(\n\t\t\tEditorOption.smartSelect, 'smartSelect',\n\t\t\t{\n\t\t\t\tselectLeadingAndTrailingWhitespace: true\n\t\t\t},\n\t\t\t{\n\t\t\t\t'editor.smartSelect.selectLeadingAndTrailingWhitespace': {\n\t\t\t\t\tdescription: nls.localize('selectLeadingAndTrailingWhitespace', \"Whether leading and trailing whitespace should always be selected.\"),\n\t\t\t\t\tdefault: true,\n\t\t\t\t\ttype: 'boolean'\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tpublic validate(input: any): Readonly<Required<ISmartSelectOptions>> {\n\t\tif (!input || typeof input !== 'object') {\n\t\t\treturn this.defaultValue;\n\t\t}\n\t\treturn {\n\t\t\tselectLeadingAndTrailingWhitespace: boolean((input as ISmartSelectOptions).selectLeadingAndTrailingWhitespace, this.defaultValue.selectLeadingAndTrailingWhitespace)\n\t\t};\n\t}\n}\n\n//#endregion\n\n//#region tabFocusMode\n\nclass EditorTabFocusMode extends ComputedEditorOption<EditorOption.tabFocusMode, boolean> {\n\n\tconstructor() {\n\t\tsuper(EditorOption.tabFocusMode, [EditorOption.readOnly]);\n\t}\n\n\tpublic compute(env: IEnvironmentalOptions, options: IComputedEditorOptions, _: boolean): boolean {\n\t\tconst readOnly = options.get(EditorOption.readOnly);\n\t\treturn (readOnly ? true : env.tabFocusMode);\n\t}\n}\n\n//#endregion\n\n//#region wrappingIndent\n\n/**\n * Describes how to indent wrapped lines.\n */\nexport const enum WrappingIndent {\n\t/**\n\t * No indentation => wrapped lines begin at column 1.\n\t */\n\tNone = 0,\n\t/**\n\t * Same => wrapped lines get the same indentation as the parent.\n\t */\n\tSame = 1,\n\t/**\n\t * Indent => wrapped lines get +1 indentation toward the parent.\n\t */\n\tIndent = 2,\n\t/**\n\t * DeepIndent => wrapped lines get +2 indentation toward the parent.\n\t */\n\tDeepIndent = 3\n}\n\nfunction _wrappingIndentFromString(wrappingIndent: 'none' | 'same' | 'indent' | 'deepIndent'): WrappingIndent {\n\tswitch (wrappingIndent) {\n\t\tcase 'none': return WrappingIndent.None;\n\t\tcase 'same': return WrappingIndent.Same;\n\t\tcase 'indent': return WrappingIndent.Indent;\n\t\tcase 'deepIndent': return WrappingIndent.DeepIndent;\n\t}\n}\n\n//#endregion\n\n//#region wrappingInfo\n\nexport interface EditorWrappingInfo {\n\treadonly isDominatedByLongLines: boolean;\n\treadonly isWordWrapMinified: boolean;\n\treadonly isViewportWrapping: boolean;\n\treadonly wrappingColumn: number;\n}\n\nclass EditorWrappingInfoComputer extends ComputedEditorOption<EditorOption.wrappingInfo, EditorWrappingInfo> {\n\n\tconstructor() {\n\t\tsuper(EditorOption.wrappingInfo, [EditorOption.layoutInfo]);\n\t}\n\n\tpublic compute(env: IEnvironmentalOptions, options: IComputedEditorOptions, _: EditorWrappingInfo): EditorWrappingInfo {\n\t\tconst layoutInfo = options.get(EditorOption.layoutInfo);\n\n\t\treturn {\n\t\t\tisDominatedByLongLines: env.isDominatedByLongLines,\n\t\t\tisWordWrapMinified: layoutInfo.isWordWrapMinified,\n\t\t\tisViewportWrapping: layoutInfo.isViewportWrapping,\n\t\t\twrappingColumn: layoutInfo.wrappingColumn,\n\t\t};\n\t}\n}\n\n//#endregion\n\nconst DEFAULT_WINDOWS_FONT_FAMILY = 'Consolas, \\'Courier New\\', monospace';\nconst DEFAULT_MAC_FONT_FAMILY = 'Menlo, Monaco, \\'Courier New\\', monospace';\nconst DEFAULT_LINUX_FONT_FAMILY = '\\'Droid Sans Mono\\', \\'monospace\\', monospace, \\'Droid Sans Fallback\\'';\n\n/**\n * @internal\n */\nexport const EDITOR_FONT_DEFAULTS = {\n\tfontFamily: (\n\t\tplatform.isMacintosh ? DEFAULT_MAC_FONT_FAMILY : (platform.isLinux ? DEFAULT_LINUX_FONT_FAMILY : DEFAULT_WINDOWS_FONT_FAMILY)\n\t),\n\tfontWeight: 'normal',\n\tfontSize: (\n\t\tplatform.isMacintosh ? 12 : 14\n\t),\n\tlineHeight: 0,\n\tletterSpacing: 0,\n};\n\n/**\n * @internal\n */\nexport const EDITOR_MODEL_DEFAULTS = {\n\ttabSize: 4,\n\tindentSize: 4,\n\tinsertSpaces: true,\n\tdetectIndentation: true,\n\ttrimAutoWhitespace: true,\n\tlargeFileOptimizations: true\n};\n\n/**\n * @internal\n */\nexport const editorOptionsRegistry: IEditorOption<EditorOption, any>[] = [];\n\nfunction register<K1 extends EditorOption, V>(option: IEditorOption<K1, V>): IEditorOption<K1, V> {\n\teditorOptionsRegistry[option.id] = option;\n\treturn option;\n}\n\nexport const enum EditorOption {\n\tacceptSuggestionOnCommitCharacter,\n\tacceptSuggestionOnEnter,\n\taccessibilitySupport,\n\taccessibilityPageSize,\n\tariaLabel,\n\tautoClosingBrackets,\n\tautoClosingOvertype,\n\tautoClosingQuotes,\n\tautoIndent,\n\tautomaticLayout,\n\tautoSurround,\n\tcodeLens,\n\tcodeLensFontFamily,\n\tcodeLensFontSize,\n\tcolorDecorators,\n\tcolumnSelection,\n\tcomments,\n\tcontextmenu,\n\tcopyWithSyntaxHighlighting,\n\tcursorBlinking,\n\tcursorSmoothCaretAnimation,\n\tcursorStyle,\n\tcursorSurroundingLines,\n\tcursorSurroundingLinesStyle,\n\tcursorWidth,\n\tdisableLayerHinting,\n\tdisableMonospaceOptimizations,\n\tdragAndDrop,\n\temptySelectionClipboard,\n\textraEditorClassName,\n\tfastScrollSensitivity,\n\tfind,\n\tfixedOverflowWidgets,\n\tfolding,\n\tfoldingStrategy,\n\tfoldingHighlight,\n\tunfoldOnClickAfterEndOfLine,\n\tfontFamily,\n\tfontInfo,\n\tfontLigatures,\n\tfontSize,\n\tfontWeight,\n\tformatOnPaste,\n\tformatOnType,\n\tglyphMargin,\n\tgotoLocation,\n\thideCursorInOverviewRuler,\n\thighlightActiveIndentGuide,\n\thover,\n\tinDiffEditor,\n\tletterSpacing,\n\tlightbulb,\n\tlineDecorationsWidth,\n\tlineHeight,\n\tlineNumbers,\n\tlineNumbersMinChars,\n\tlinkedEditing,\n\tlinks,\n\tmatchBrackets,\n\tminimap,\n\tmouseStyle,\n\tmouseWheelScrollSensitivity,\n\tmouseWheelZoom,\n\tmultiCursorMergeOverlapping,\n\tmultiCursorModifier,\n\tmultiCursorPaste,\n\toccurrencesHighlight,\n\toverviewRulerBorder,\n\toverviewRulerLanes,\n\tpadding,\n\tparameterHints,\n\tpeekWidgetDefaultFocus,\n\tdefinitionLinkOpensInPeek,\n\tquickSuggestions,\n\tquickSuggestionsDelay,\n\treadOnly,\n\trenameOnType,\n\trenderControlCharacters,\n\trenderIndentGuides,\n\trenderFinalNewline,\n\trenderLineHighlight,\n\trenderLineHighlightOnlyWhenFocus,\n\trenderValidationDecorations,\n\trenderWhitespace,\n\trevealHorizontalRightPadding,\n\troundedSelection,\n\trulers,\n\tscrollbar,\n\tscrollBeyondLastColumn,\n\tscrollBeyondLastLine,\n\tscrollPredominantAxis,\n\tselectionClipboard,\n\tselectionHighlight,\n\tselectOnLineNumbers,\n\tshowFoldingControls,\n\tshowUnused,\n\tsnippetSuggestions,\n\tsmartSelect,\n\tsmoothScrolling,\n\tstickyTabStops,\n\tstopRenderingLineAfter,\n\tsuggest,\n\tsuggestFontSize,\n\tsuggestLineHeight,\n\tsuggestOnTriggerCharacters,\n\tsuggestSelection,\n\ttabCompletion,\n\ttabIndex,\n\tunusualLineTerminators,\n\tuseTabStops,\n\twordSeparators,\n\twordWrap,\n\twordWrapBreakAfterCharacters,\n\twordWrapBreakBeforeCharacters,\n\twordWrapColumn,\n\twordWrapOverride1,\n\twordWrapOverride2,\n\twrappingIndent,\n\twrappingStrategy,\n\tshowDeprecated,\n\tinlineHints,\n\t// Leave these at the end (because they have dependencies!)\n\teditorClassName,\n\tpixelRatio,\n\ttabFocusMode,\n\tlayoutInfo,\n\twrappingInfo,\n}\n\n/**\n * WORKAROUND: TS emits \"any\" for complex editor options values (anything except string, bool, enum, etc. ends up being \"any\")\n * @monacodtsreplace\n * /accessibilitySupport, any/accessibilitySupport, AccessibilitySupport/\n * /comments, any/comments, EditorCommentsOptions/\n * /find, any/find, EditorFindOptions/\n * /fontInfo, any/fontInfo, FontInfo/\n * /gotoLocation, any/gotoLocation, GoToLocationOptions/\n * /hover, any/hover, EditorHoverOptions/\n * /lightbulb, any/lightbulb, EditorLightbulbOptions/\n * /minimap, any/minimap, EditorMinimapOptions/\n * /parameterHints, any/parameterHints, InternalParameterHintOptions/\n * /quickSuggestions, any/quickSuggestions, ValidQuickSuggestionsOptions/\n * /suggest, any/suggest, InternalSuggestOptions/\n */\nexport const EditorOptions = {\n\tacceptSuggestionOnCommitCharacter: register(new EditorBooleanOption(\n\t\tEditorOption.acceptSuggestionOnCommitCharacter, 'acceptSuggestionOnCommitCharacter', true,\n\t\t{ markdownDescription: nls.localize('acceptSuggestionOnCommitCharacter', \"Controls whether suggestions should be accepted on commit characters. For example, in JavaScript, the semi-colon (`;`) can be a commit character that accepts a suggestion and types that character.\") }\n\t)),\n\tacceptSuggestionOnEnter: register(new EditorStringEnumOption(\n\t\tEditorOption.acceptSuggestionOnEnter, 'acceptSuggestionOnEnter',\n\t\t'on' as 'on' | 'smart' | 'off',\n\t\t['on', 'smart', 'off'] as const,\n\t\t{\n\t\t\tmarkdownEnumDescriptions: [\n\t\t\t\t'',\n\t\t\t\tnls.localize('acceptSuggestionOnEnterSmart', \"Only accept a suggestion with `Enter` when it makes a textual change.\"),\n\t\t\t\t''\n\t\t\t],\n\t\t\tmarkdownDescription: nls.localize('acceptSuggestionOnEnter', \"Controls whether suggestions should be accepted on `Enter`, in addition to `Tab`. Helps to avoid ambiguity between inserting new lines or accepting suggestions.\")\n\t\t}\n\t)),\n\taccessibilitySupport: register(new EditorAccessibilitySupport()),\n\taccessibilityPageSize: register(new EditorIntOption(EditorOption.accessibilityPageSize, 'accessibilityPageSize', 10, 1, Constants.MAX_SAFE_SMALL_INTEGER,\n\t\t{ description: nls.localize('accessibilityPageSize', \"Controls the number of lines in the editor that can be read out by a screen reader. Warning: this has a performance implication for numbers larger than the default.\") })),\n\tariaLabel: register(new EditorStringOption(\n\t\tEditorOption.ariaLabel, 'ariaLabel', nls.localize('editorViewAccessibleLabel', \"Editor content\")\n\t)),\n\tautoClosingBrackets: register(new EditorStringEnumOption(\n\t\tEditorOption.autoClosingBrackets, 'autoClosingBrackets',\n\t\t'languageDefined' as 'always' | 'languageDefined' | 'beforeWhitespace' | 'never',\n\t\t['always', 'languageDefined', 'beforeWhitespace', 'never'] as const,\n\t\t{\n\t\t\tenumDescriptions: [\n\t\t\t\t'',\n\t\t\t\tnls.localize('editor.autoClosingBrackets.languageDefined', \"Use language configurations to determine when to autoclose brackets.\"),\n\t\t\t\tnls.localize('editor.autoClosingBrackets.beforeWhitespace', \"Autoclose brackets only when the cursor is to the left of whitespace.\"),\n\t\t\t\t'',\n\t\t\t],\n\t\t\tdescription: nls.localize('autoClosingBrackets', \"Controls whether the editor should automatically close brackets after the user adds an opening bracket.\")\n\t\t}\n\t)),\n\tautoClosingOvertype: register(new EditorStringEnumOption(\n\t\tEditorOption.autoClosingOvertype, 'autoClosingOvertype',\n\t\t'auto' as 'always' | 'auto' | 'never',\n\t\t['always', 'auto', 'never'] as const,\n\t\t{\n\t\t\tenumDescriptions: [\n\t\t\t\t'',\n\t\t\t\tnls.localize('editor.autoClosingOvertype.auto', \"Type over closing quotes or brackets only if they were automatically inserted.\"),\n\t\t\t\t'',\n\t\t\t],\n\t\t\tdescription: nls.localize('autoClosingOvertype', \"Controls whether the editor should type over closing quotes or brackets.\")\n\t\t}\n\t)),\n\tautoClosingQuotes: register(new EditorStringEnumOption(\n\t\tEditorOption.autoClosingQuotes, 'autoClosingQuotes',\n\t\t'languageDefined' as 'always' | 'languageDefined' | 'beforeWhitespace' | 'never',\n\t\t['always', 'languageDefined', 'beforeWhitespace', 'never'] as const,\n\t\t{\n\t\t\tenumDescriptions: [\n\t\t\t\t'',\n\t\t\t\tnls.localize('editor.autoClosingQuotes.languageDefined', \"Use language configurations to determine when to autoclose quotes.\"),\n\t\t\t\tnls.localize('editor.autoClosingQuotes.beforeWhitespace', \"Autoclose quotes only when the cursor is to the left of whitespace.\"),\n\t\t\t\t'',\n\t\t\t],\n\t\t\tdescription: nls.localize('autoClosingQuotes', \"Controls whether the editor should automatically close quotes after the user adds an opening quote.\")\n\t\t}\n\t)),\n\tautoIndent: register(new EditorEnumOption(\n\t\tEditorOption.autoIndent, 'autoIndent',\n\t\tEditorAutoIndentStrategy.Full, 'full',\n\t\t['none', 'keep', 'brackets', 'advanced', 'full'],\n\t\t_autoIndentFromString,\n\t\t{\n\t\t\tenumDescriptions: [\n\t\t\t\tnls.localize('editor.autoIndent.none', \"The editor will not insert indentation automatically.\"),\n\t\t\t\tnls.localize('editor.autoIndent.keep', \"The editor will keep the current line's indentation.\"),\n\t\t\t\tnls.localize('editor.autoIndent.brackets', \"The editor will keep the current line's indentation and honor language defined brackets.\"),\n\t\t\t\tnls.localize('editor.autoIndent.advanced', \"The editor will keep the current line's indentation, honor language defined brackets and invoke special onEnterRules defined by languages.\"),\n\t\t\t\tnls.localize('editor.autoIndent.full', \"The editor will keep the current line's indentation, honor language defined brackets, invoke special onEnterRules defined by languages, and honor indentationRules defined by languages.\"),\n\t\t\t],\n\t\t\tdescription: nls.localize('autoIndent', \"Controls whether the editor should automatically adjust the indentation when users type, paste, move or indent lines.\")\n\t\t}\n\t)),\n\tautomaticLayout: register(new EditorBooleanOption(\n\t\tEditorOption.automaticLayout, 'automaticLayout', false,\n\t)),\n\tautoSurround: register(new EditorStringEnumOption(\n\t\tEditorOption.autoSurround, 'autoSurround',\n\t\t'languageDefined' as 'languageDefined' | 'quotes' | 'brackets' | 'never',\n\t\t['languageDefined', 'quotes', 'brackets', 'never'] as const,\n\t\t{\n\t\t\tenumDescriptions: [\n\t\t\t\tnls.localize('editor.autoSurround.languageDefined', \"Use language configurations to determine when to automatically surround selections.\"),\n\t\t\t\tnls.localize('editor.autoSurround.quotes', \"Surround with quotes but not brackets.\"),\n\t\t\t\tnls.localize('editor.autoSurround.brackets', \"Surround with brackets but not quotes.\"),\n\t\t\t\t''\n\t\t\t],\n\t\t\tdescription: nls.localize('autoSurround', \"Controls whether the editor should automatically surround selections when typing quotes or brackets.\")\n\t\t}\n\t)),\n\tstickyTabStops: register(new EditorBooleanOption(\n\t\tEditorOption.stickyTabStops, 'stickyTabStops', false,\n\t\t{ description: nls.localize('stickyTabStops', \"Emulate selection behaviour of tab characters when using spaces for indentation. Selection will stick to tab stops.\") }\n\t)),\n\tcodeLens: register(new EditorBooleanOption(\n\t\tEditorOption.codeLens, 'codeLens', true,\n\t\t{ description: nls.localize('codeLens', \"Controls whether the editor shows CodeLens.\") }\n\t)),\n\tcodeLensFontFamily: register(new EditorStringOption(\n\t\tEditorOption.codeLensFontFamily, 'codeLensFontFamily', '',\n\t\t{ description: nls.localize('codeLensFontFamily', \"Controls the font family for CodeLens.\") }\n\t)),\n\tcodeLensFontSize: register(new EditorIntOption(EditorOption.codeLensFontSize, 'codeLensFontSize', 0, 0, 100, {\n\t\ttype: 'number',\n\t\tdefault: 0,\n\t\tminimum: 0,\n\t\tmaximum: 100,\n\t\tdescription: nls.localize('codeLensFontSize', \"Controls the font size in pixels for CodeLens. When set to `0`, the 90% of `#editor.fontSize#` is used.\")\n\t})),\n\tcolorDecorators: register(new EditorBooleanOption(\n\t\tEditorOption.colorDecorators, 'colorDecorators', true,\n\t\t{ description: nls.localize('colorDecorators', \"Controls whether the editor should render the inline color decorators and color picker.\") }\n\t)),\n\tcolumnSelection: register(new EditorBooleanOption(\n\t\tEditorOption.columnSelection, 'columnSelection', false,\n\t\t{ description: nls.localize('columnSelection', \"Enable that the selection with the mouse and keys is doing column selection.\") }\n\t)),\n\tcomments: register(new EditorComments()),\n\tcontextmenu: register(new EditorBooleanOption(\n\t\tEditorOption.contextmenu, 'contextmenu', true,\n\t)),\n\tcopyWithSyntaxHighlighting: register(new EditorBooleanOption(\n\t\tEditorOption.copyWithSyntaxHighlighting, 'copyWithSyntaxHighlighting', true,\n\t\t{ description: nls.localize('copyWithSyntaxHighlighting', \"Controls whether syntax highlighting should be copied into the clipboard.\") }\n\t)),\n\tcursorBlinking: register(new EditorEnumOption(\n\t\tEditorOption.cursorBlinking, 'cursorBlinking',\n\t\tTextEditorCursorBlinkingStyle.Blink, 'blink',\n\t\t['blink', 'smooth', 'phase', 'expand', 'solid'],\n\t\t_cursorBlinkingStyleFromString,\n\t\t{ description: nls.localize('cursorBlinking', \"Control the cursor animation style.\") }\n\t)),\n\tcursorSmoothCaretAnimation: register(new EditorBooleanOption(\n\t\tEditorOption.cursorSmoothCaretAnimation, 'cursorSmoothCaretAnimation', false,\n\t\t{ description: nls.localize('cursorSmoothCaretAnimation', \"Controls whether the smooth caret animation should be enabled.\") }\n\t)),\n\tcursorStyle: register(new EditorEnumOption(\n\t\tEditorOption.cursorStyle, 'cursorStyle',\n\t\tTextEditorCursorStyle.Line, 'line',\n\t\t['line', 'block', 'underline', 'line-thin', 'block-outline', 'underline-thin'],\n\t\t_cursorStyleFromString,\n\t\t{ description: nls.localize('cursorStyle', \"Controls the cursor style.\") }\n\t)),\n\tcursorSurroundingLines: register(new EditorIntOption(\n\t\tEditorOption.cursorSurroundingLines, 'cursorSurroundingLines',\n\t\t0, 0, Constants.MAX_SAFE_SMALL_INTEGER,\n\t\t{ description: nls.localize('cursorSurroundingLines', \"Controls the minimal number of visible leading and trailing lines surrounding the cursor. Known as 'scrollOff' or 'scrollOffset' in some other editors.\") }\n\t)),\n\tcursorSurroundingLinesStyle: register(new EditorStringEnumOption(\n\t\tEditorOption.cursorSurroundingLinesStyle, 'cursorSurroundingLinesStyle',\n\t\t'default' as 'default' | 'all',\n\t\t['default', 'all'] as const,\n\t\t{\n\t\t\tenumDescriptions: [\n\t\t\t\tnls.localize('cursorSurroundingLinesStyle.default', \"`cursorSurroundingLines` is enforced only when triggered via the keyboard or API.\"),\n\t\t\t\tnls.localize('cursorSurroundingLinesStyle.all', \"`cursorSurroundingLines` is enforced always.\")\n\t\t\t],\n\t\t\tdescription: nls.localize('cursorSurroundingLinesStyle', \"Controls when `cursorSurroundingLines` should be enforced.\")\n\t\t}\n\t)),\n\tcursorWidth: register(new EditorIntOption(\n\t\tEditorOption.cursorWidth, 'cursorWidth',\n\t\t0, 0, Constants.MAX_SAFE_SMALL_INTEGER,\n\t\t{ markdownDescription: nls.localize('cursorWidth', \"Controls the width of the cursor when `#editor.cursorStyle#` is set to `line`.\") }\n\t)),\n\tdisableLayerHinting: register(new EditorBooleanOption(\n\t\tEditorOption.disableLayerHinting, 'disableLayerHinting', false,\n\t)),\n\tdisableMonospaceOptimizations: register(new EditorBooleanOption(\n\t\tEditorOption.disableMonospaceOptimizations, 'disableMonospaceOptimizations', false\n\t)),\n\tdragAndDrop: register(new EditorBooleanOption(\n\t\tEditorOption.dragAndDrop, 'dragAndDrop', true,\n\t\t{ description: nls.localize('dragAndDrop', \"Controls whether the editor should allow moving selections via drag and drop.\") }\n\t)),\n\temptySelectionClipboard: register(new EditorEmptySelectionClipboard()),\n\textraEditorClassName: register(new EditorStringOption(\n\t\tEditorOption.extraEditorClassName, 'extraEditorClassName', '',\n\t)),\n\tfastScrollSensitivity: register(new EditorFloatOption(\n\t\tEditorOption.fastScrollSensitivity, 'fastScrollSensitivity',\n\t\t5, x => (x <= 0 ? 5 : x),\n\t\t{ markdownDescription: nls.localize('fastScrollSensitivity', \"Scrolling speed multiplier when pressing `Alt`.\") }\n\t)),\n\tfind: register(new EditorFind()),\n\tfixedOverflowWidgets: register(new EditorBooleanOption(\n\t\tEditorOption.fixedOverflowWidgets, 'fixedOverflowWidgets', false,\n\t)),\n\tfolding: register(new EditorBooleanOption(\n\t\tEditorOption.folding, 'folding', true,\n\t\t{ description: nls.localize('folding', \"Controls whether the editor has code folding enabled.\") }\n\t)),\n\tfoldingStrategy: register(new EditorStringEnumOption(\n\t\tEditorOption.foldingStrategy, 'foldingStrategy',\n\t\t'auto' as 'auto' | 'indentation',\n\t\t['auto', 'indentation'] as const,\n\t\t{\n\t\t\tenumDescriptions: [\n\t\t\t\tnls.localize('foldingStrategy.auto', \"Use a language-specific folding strategy if available, else the indentation-based one.\"),\n\t\t\t\tnls.localize('foldingStrategy.indentation', \"Use the indentation-based folding strategy.\"),\n\t\t\t],\n\t\t\tdescription: nls.localize('foldingStrategy', \"Controls the strategy for computing folding ranges.\")\n\t\t}\n\t)),\n\tfoldingHighlight: register(new EditorBooleanOption(\n\t\tEditorOption.foldingHighlight, 'foldingHighlight', true,\n\t\t{ description: nls.localize('foldingHighlight', \"Controls whether the editor should highlight folded ranges.\") }\n\t)),\n\tunfoldOnClickAfterEndOfLine: register(new EditorBooleanOption(\n\t\tEditorOption.unfoldOnClickAfterEndOfLine, 'unfoldOnClickAfterEndOfLine', false,\n\t\t{ description: nls.localize('unfoldOnClickAfterEndOfLine', \"Controls whether clicking on the empty content after a folded line will unfold the line.\") }\n\t)),\n\tfontFamily: register(new EditorStringOption(\n\t\tEditorOption.fontFamily, 'fontFamily', EDITOR_FONT_DEFAULTS.fontFamily,\n\t\t{ description: nls.localize('fontFamily', \"Controls the font family.\") }\n\t)),\n\tfontInfo: register(new EditorFontInfo()),\n\tfontLigatures2: register(new EditorFontLigatures()),\n\tfontSize: register(new EditorFontSize()),\n\tfontWeight: register(new EditorFontWeight()),\n\tformatOnPaste: register(new EditorBooleanOption(\n\t\tEditorOption.formatOnPaste, 'formatOnPaste', false,\n\t\t{ description: nls.localize('formatOnPaste', \"Controls whether the editor should automatically format the pasted content. A formatter must be available and the formatter should be able to format a range in a document.\") }\n\t)),\n\tformatOnType: register(new EditorBooleanOption(\n\t\tEditorOption.formatOnType, 'formatOnType', false,\n\t\t{ description: nls.localize('formatOnType', \"Controls whether the editor should automatically format the line after typing.\") }\n\t)),\n\tglyphMargin: register(new EditorBooleanOption(\n\t\tEditorOption.glyphMargin, 'glyphMargin', true,\n\t\t{ description: nls.localize('glyphMargin', \"Controls whether the editor should render the vertical glyph margin. Glyph margin is mostly used for debugging.\") }\n\t)),\n\tgotoLocation: register(new EditorGoToLocation()),\n\thideCursorInOverviewRuler: register(new EditorBooleanOption(\n\t\tEditorOption.hideCursorInOverviewRuler, 'hideCursorInOverviewRuler', false,\n\t\t{ description: nls.localize('hideCursorInOverviewRuler', \"Controls whether the cursor should be hidden in the overview ruler.\") }\n\t)),\n\thighlightActiveIndentGuide: register(new EditorBooleanOption(\n\t\tEditorOption.highlightActiveIndentGuide, 'highlightActiveIndentGuide', true,\n\t\t{ description: nls.localize('highlightActiveIndentGuide', \"Controls whether the editor should highlight the active indent guide.\") }\n\t)),\n\thover: register(new EditorHover()),\n\tinDiffEditor: register(new EditorBooleanOption(\n\t\tEditorOption.inDiffEditor, 'inDiffEditor', false\n\t)),\n\tletterSpacing: register(new EditorFloatOption(\n\t\tEditorOption.letterSpacing, 'letterSpacing',\n\t\tEDITOR_FONT_DEFAULTS.letterSpacing, x => EditorFloatOption.clamp(x, -5, 20),\n\t\t{ description: nls.localize('letterSpacing', \"Controls the letter spacing in pixels.\") }\n\t)),\n\tlightbulb: register(new EditorLightbulb()),\n\tlineDecorationsWidth: register(new SimpleEditorOption(EditorOption.lineDecorationsWidth, 'lineDecorationsWidth', 10 as number | string)),\n\tlineHeight: register(new EditorLineHeight()),\n\tlineNumbers: register(new EditorRenderLineNumbersOption()),\n\tlineNumbersMinChars: register(new EditorIntOption(\n\t\tEditorOption.lineNumbersMinChars, 'lineNumbersMinChars',\n\t\t5, 1, 300\n\t)),\n\tlinkedEditing: register(new EditorBooleanOption(\n\t\tEditorOption.linkedEditing, 'linkedEditing', false,\n\t\t{ description: nls.localize('linkedEditing', \"Controls whether the editor has linked editing enabled. Depending on the language, related symbols, e.g. HTML tags, are updated while editing.\") }\n\t)),\n\tlinks: register(new EditorBooleanOption(\n\t\tEditorOption.links, 'links', true,\n\t\t{ description: nls.localize('links', \"Controls whether the editor should detect links and make them clickable.\") }\n\t)),\n\tmatchBrackets: register(new EditorStringEnumOption(\n\t\tEditorOption.matchBrackets, 'matchBrackets',\n\t\t'always' as 'never' | 'near' | 'always',\n\t\t['always', 'near', 'never'] as const,\n\t\t{ description: nls.localize('matchBrackets', \"Highlight matching brackets.\") }\n\t)),\n\tminimap: register(new EditorMinimap()),\n\tmouseStyle: register(new EditorStringEnumOption(\n\t\tEditorOption.mouseStyle, 'mouseStyle',\n\t\t'text' as 'text' | 'default' | 'copy',\n\t\t['text', 'default', 'copy'] as const,\n\t)),\n\tmouseWheelScrollSensitivity: register(new EditorFloatOption(\n\t\tEditorOption.mouseWheelScrollSensitivity, 'mouseWheelScrollSensitivity',\n\t\t1, x => (x === 0 ? 1 : x),\n\t\t{ markdownDescription: nls.localize('mouseWheelScrollSensitivity', \"A multiplier to be used on the `deltaX` and `deltaY` of mouse wheel scroll events.\") }\n\t)),\n\tmouseWheelZoom: register(new EditorBooleanOption(\n\t\tEditorOption.mouseWheelZoom, 'mouseWheelZoom', false,\n\t\t{ markdownDescription: nls.localize('mouseWheelZoom', \"Zoom the font of the editor when using mouse wheel and holding `Ctrl`.\") }\n\t)),\n\tmultiCursorMergeOverlapping: register(new EditorBooleanOption(\n\t\tEditorOption.multiCursorMergeOverlapping, 'multiCursorMergeOverlapping', true,\n\t\t{ description: nls.localize('multiCursorMergeOverlapping', \"Merge multiple cursors when they are overlapping.\") }\n\t)),\n\tmultiCursorModifier: register(new EditorEnumOption(\n\t\tEditorOption.multiCursorModifier, 'multiCursorModifier',\n\t\t'altKey', 'alt',\n\t\t['ctrlCmd', 'alt'],\n\t\t_multiCursorModifierFromString,\n\t\t{\n\t\t\tmarkdownEnumDescriptions: [\n\t\t\t\tnls.localize('multiCursorModifier.ctrlCmd', \"Maps to `Control` on Windows and Linux and to `Command` on macOS.\"),\n\t\t\t\tnls.localize('multiCursorModifier.alt', \"Maps to `Alt` on Windows and Linux and to `Option` on macOS.\")\n\t\t\t],\n\t\t\tmarkdownDescription: nls.localize({\n\t\t\t\tkey: 'multiCursorModifier',\n\t\t\t\tcomment: [\n\t\t\t\t\t'- `ctrlCmd` refers to a value the setting can take and should not be localized.',\n\t\t\t\t\t'- `Control` and `Command` refer to the modifier keys Ctrl or Cmd on the keyboard and can be localized.'\n\t\t\t\t]\n\t\t\t}, \"The modifier to be used to add multiple cursors with the mouse. The Go To Definition and Open Link mouse gestures will adapt such that they do not conflict with the multicursor modifier. [Read more](https://code.visualstudio.com/docs/editor/codebasics#_multicursor-modifier).\")\n\t\t}\n\t)),\n\tmultiCursorPaste: register(new EditorStringEnumOption(\n\t\tEditorOption.multiCursorPaste, 'multiCursorPaste',\n\t\t'spread' as 'spread' | 'full',\n\t\t['spread', 'full'] as const,\n\t\t{\n\t\t\tmarkdownEnumDescriptions: [\n\t\t\t\tnls.localize('multiCursorPaste.spread', \"Each cursor pastes a single line of the text.\"),\n\t\t\t\tnls.localize('multiCursorPaste.full', \"Each cursor pastes the full text.\")\n\t\t\t],\n\t\t\tmarkdownDescription: nls.localize('multiCursorPaste', \"Controls pasting when the line count of the pasted text matches the cursor count.\")\n\t\t}\n\t)),\n\toccurrencesHighlight: register(new EditorBooleanOption(\n\t\tEditorOption.occurrencesHighlight, 'occurrencesHighlight', true,\n\t\t{ description: nls.localize('occurrencesHighlight', \"Controls whether the editor should highlight semantic symbol occurrences.\") }\n\t)),\n\toverviewRulerBorder: register(new EditorBooleanOption(\n\t\tEditorOption.overviewRulerBorder, 'overviewRulerBorder', true,\n\t\t{ description: nls.localize('overviewRulerBorder', \"Controls whether a border should be drawn around the overview ruler.\") }\n\t)),\n\toverviewRulerLanes: register(new EditorIntOption(\n\t\tEditorOption.overviewRulerLanes, 'overviewRulerLanes',\n\t\t3, 0, 3\n\t)),\n\tpadding: register(new EditorPadding()),\n\tparameterHints: register(new EditorParameterHints()),\n\tpeekWidgetDefaultFocus: register(new EditorStringEnumOption(\n\t\tEditorOption.peekWidgetDefaultFocus, 'peekWidgetDefaultFocus',\n\t\t'tree' as 'tree' | 'editor',\n\t\t['tree', 'editor'] as const,\n\t\t{\n\t\t\tenumDescriptions: [\n\t\t\t\tnls.localize('peekWidgetDefaultFocus.tree', \"Focus the tree when opening peek\"),\n\t\t\t\tnls.localize('peekWidgetDefaultFocus.editor', \"Focus the editor when opening peek\")\n\t\t\t],\n\t\t\tdescription: nls.localize('peekWidgetDefaultFocus', \"Controls whether to focus the inline editor or the tree in the peek widget.\")\n\t\t}\n\t)),\n\tdefinitionLinkOpensInPeek: register(new EditorBooleanOption(\n\t\tEditorOption.definitionLinkOpensInPeek, 'definitionLinkOpensInPeek', false,\n\t\t{ description: nls.localize('definitionLinkOpensInPeek', \"Controls whether the Go to Definition mouse gesture always opens the peek widget.\") }\n\t)),\n\tquickSuggestions: register(new EditorQuickSuggestions()),\n\tquickSuggestionsDelay: register(new EditorIntOption(\n\t\tEditorOption.quickSuggestionsDelay, 'quickSuggestionsDelay',\n\t\t10, 0, Constants.MAX_SAFE_SMALL_INTEGER,\n\t\t{ description: nls.localize('quickSuggestionsDelay', \"Controls the delay in milliseconds after which quick suggestions will show up.\") }\n\t)),\n\treadOnly: register(new EditorBooleanOption(\n\t\tEditorOption.readOnly, 'readOnly', false,\n\t)),\n\trenameOnType: register(new EditorBooleanOption(\n\t\tEditorOption.renameOnType, 'renameOnType', false,\n\t\t{ description: nls.localize('renameOnType', \"Controls whether the editor auto renames on type.\"), markdownDeprecationMessage: nls.localize('renameOnTypeDeprecate', \"Deprecated, use `editor.linkedEditing` instead.\") }\n\t)),\n\trenderControlCharacters: register(new EditorBooleanOption(\n\t\tEditorOption.renderControlCharacters, 'renderControlCharacters', false,\n\t\t{ description: nls.localize('renderControlCharacters', \"Controls whether the editor should render control characters.\") }\n\t)),\n\trenderIndentGuides: register(new EditorBooleanOption(\n\t\tEditorOption.renderIndentGuides, 'renderIndentGuides', true,\n\t\t{ description: nls.localize('renderIndentGuides', \"Controls whether the editor should render indent guides.\") }\n\t)),\n\trenderFinalNewline: register(new EditorBooleanOption(\n\t\tEditorOption.renderFinalNewline, 'renderFinalNewline', true,\n\t\t{ description: nls.localize('renderFinalNewline', \"Render last line number when the file ends with a newline.\") }\n\t)),\n\trenderLineHighlight: register(new EditorStringEnumOption(\n\t\tEditorOption.renderLineHighlight, 'renderLineHighlight',\n\t\t'line' as 'none' | 'gutter' | 'line' | 'all',\n\t\t['none', 'gutter', 'line', 'all'] as const,\n\t\t{\n\t\t\tenumDescriptions: [\n\t\t\t\t'',\n\t\t\t\t'',\n\t\t\t\t'',\n\t\t\t\tnls.localize('renderLineHighlight.all', \"Highlights both the gutter and the current line.\"),\n\t\t\t],\n\t\t\tdescription: nls.localize('renderLineHighlight', \"Controls how the editor should render the current line highlight.\")\n\t\t}\n\t)),\n\trenderLineHighlightOnlyWhenFocus: register(new EditorBooleanOption(\n\t\tEditorOption.renderLineHighlightOnlyWhenFocus, 'renderLineHighlightOnlyWhenFocus', false,\n\t\t{ description: nls.localize('renderLineHighlightOnlyWhenFocus', \"Controls if the editor should render the current line highlight only when the editor is focused\") }\n\t)),\n\trenderValidationDecorations: register(new EditorStringEnumOption(\n\t\tEditorOption.renderValidationDecorations, 'renderValidationDecorations',\n\t\t'editable' as 'editable' | 'on' | 'off',\n\t\t['editable', 'on', 'off'] as const\n\t)),\n\trenderWhitespace: register(new EditorStringEnumOption(\n\t\tEditorOption.renderWhitespace, 'renderWhitespace',\n\t\t'selection' as 'selection' | 'none' | 'boundary' | 'trailing' | 'all',\n\t\t['none', 'boundary', 'selection', 'trailing', 'all'] as const,\n\t\t{\n\t\t\tenumDescriptions: [\n\t\t\t\t'',\n\t\t\t\tnls.localize('renderWhitespace.boundary', \"Render whitespace characters except for single spaces between words.\"),\n\t\t\t\tnls.localize('renderWhitespace.selection', \"Render whitespace characters only on selected text.\"),\n\t\t\t\tnls.localize('renderWhitespace.trailing', \"Render only trailing whitespace characters\"),\n\t\t\t\t''\n\t\t\t],\n\t\t\tdescription: nls.localize('renderWhitespace', \"Controls how the editor should render whitespace characters.\")\n\t\t}\n\t)),\n\trevealHorizontalRightPadding: register(new EditorIntOption(\n\t\tEditorOption.revealHorizontalRightPadding, 'revealHorizontalRightPadding',\n\t\t30, 0, 1000,\n\t)),\n\troundedSelection: register(new EditorBooleanOption(\n\t\tEditorOption.roundedSelection, 'roundedSelection', true,\n\t\t{ description: nls.localize('roundedSelection', \"Controls whether selections should have rounded corners.\") }\n\t)),\n\trulers: register(new EditorRulers()),\n\tscrollbar: register(new EditorScrollbar()),\n\tscrollBeyondLastColumn: register(new EditorIntOption(\n\t\tEditorOption.scrollBeyondLastColumn, 'scrollBeyondLastColumn',\n\t\t5, 0, Constants.MAX_SAFE_SMALL_INTEGER,\n\t\t{ description: nls.localize('scrollBeyondLastColumn', \"Controls the number of extra characters beyond which the editor will scroll horizontally.\") }\n\t)),\n\tscrollBeyondLastLine: register(new EditorBooleanOption(\n\t\tEditorOption.scrollBeyondLastLine, 'scrollBeyondLastLine', true,\n\t\t{ description: nls.localize('scrollBeyondLastLine', \"Controls whether the editor will scroll beyond the last line.\") }\n\t)),\n\tscrollPredominantAxis: register(new EditorBooleanOption(\n\t\tEditorOption.scrollPredominantAxis, 'scrollPredominantAxis', true,\n\t\t{ description: nls.localize('scrollPredominantAxis', \"Scroll only along the predominant axis when scrolling both vertically and horizontally at the same time. Prevents horizontal drift when scrolling vertically on a trackpad.\") }\n\t)),\n\tselectionClipboard: register(new EditorBooleanOption(\n\t\tEditorOption.selectionClipboard, 'selectionClipboard', true,\n\t\t{\n\t\t\tdescription: nls.localize('selectionClipboard', \"Controls whether the Linux primary clipboard should be supported.\"),\n\t\t\tincluded: platform.isLinux\n\t\t}\n\t)),\n\tselectionHighlight: register(new EditorBooleanOption(\n\t\tEditorOption.selectionHighlight, 'selectionHighlight', true,\n\t\t{ description: nls.localize('selectionHighlight', \"Controls whether the editor should highlight matches similar to the selection.\") }\n\t)),\n\tselectOnLineNumbers: register(new EditorBooleanOption(\n\t\tEditorOption.selectOnLineNumbers, 'selectOnLineNumbers', true,\n\t)),\n\tshowFoldingControls: register(new EditorStringEnumOption(\n\t\tEditorOption.showFoldingControls, 'showFoldingControls',\n\t\t'mouseover' as 'always' | 'mouseover',\n\t\t['always', 'mouseover'] as const,\n\t\t{\n\t\t\tenumDescriptions: [\n\t\t\t\tnls.localize('showFoldingControls.always', \"Always show the folding controls.\"),\n\t\t\t\tnls.localize('showFoldingControls.mouseover', \"Only show the folding controls when the mouse is over the gutter.\"),\n\t\t\t],\n\t\t\tdescription: nls.localize('showFoldingControls', \"Controls when the folding controls on the gutter are shown.\")\n\t\t}\n\t)),\n\tshowUnused: register(new EditorBooleanOption(\n\t\tEditorOption.showUnused, 'showUnused', true,\n\t\t{ description: nls.localize('showUnused', \"Controls fading out of unused code.\") }\n\t)),\n\tshowDeprecated: register(new EditorBooleanOption(\n\t\tEditorOption.showDeprecated, 'showDeprecated', true,\n\t\t{ description: nls.localize('showDeprecated', \"Controls strikethrough deprecated variables.\") }\n\t)),\n\tinlineHints: register(new EditorInlineHints()),\n\tsnippetSuggestions: register(new EditorStringEnumOption(\n\t\tEditorOption.snippetSuggestions, 'snippetSuggestions',\n\t\t'inline' as 'top' | 'bottom' | 'inline' | 'none',\n\t\t['top', 'bottom', 'inline', 'none'] as const,\n\t\t{\n\t\t\tenumDescriptions: [\n\t\t\t\tnls.localize('snippetSuggestions.top', \"Show snippet suggestions on top of other suggestions.\"),\n\t\t\t\tnls.localize('snippetSuggestions.bottom', \"Show snippet suggestions below other suggestions.\"),\n\t\t\t\tnls.localize('snippetSuggestions.inline', \"Show snippets suggestions with other suggestions.\"),\n\t\t\t\tnls.localize('snippetSuggestions.none', \"Do not show snippet suggestions.\"),\n\t\t\t],\n\t\t\tdescription: nls.localize('snippetSuggestions', \"Controls whether snippets are shown with other suggestions and how they are sorted.\")\n\t\t}\n\t)),\n\tsmartSelect: register(new SmartSelect()),\n\tsmoothScrolling: register(new EditorBooleanOption(\n\t\tEditorOption.smoothScrolling, 'smoothScrolling', false,\n\t\t{ description: nls.localize('smoothScrolling', \"Controls whether the editor will scroll using an animation.\") }\n\t)),\n\tstopRenderingLineAfter: register(new EditorIntOption(\n\t\tEditorOption.stopRenderingLineAfter, 'stopRenderingLineAfter',\n\t\t10000, -1, Constants.MAX_SAFE_SMALL_INTEGER,\n\t)),\n\tsuggest: register(new EditorSuggest()),\n\tsuggestFontSize: register(new EditorIntOption(\n\t\tEditorOption.suggestFontSize, 'suggestFontSize',\n\t\t0, 0, 1000,\n\t\t{ markdownDescription: nls.localize('suggestFontSize', \"Font size for the suggest widget. When set to `0`, the value of `#editor.fontSize#` is used.\") }\n\t)),\n\tsuggestLineHeight: register(new EditorIntOption(\n\t\tEditorOption.suggestLineHeight, 'suggestLineHeight',\n\t\t0, 0, 1000,\n\t\t{ markdownDescription: nls.localize('suggestLineHeight', \"Line height for the suggest widget. When set to `0`, the value of `#editor.lineHeight#` is used. The minimum value is 8.\") }\n\t)),\n\tsuggestOnTriggerCharacters: register(new EditorBooleanOption(\n\t\tEditorOption.suggestOnTriggerCharacters, 'suggestOnTriggerCharacters', true,\n\t\t{ description: nls.localize('suggestOnTriggerCharacters', \"Controls whether suggestions should automatically show up when typing trigger characters.\") }\n\t)),\n\tsuggestSelection: register(new EditorStringEnumOption(\n\t\tEditorOption.suggestSelection, 'suggestSelection',\n\t\t'recentlyUsed' as 'first' | 'recentlyUsed' | 'recentlyUsedByPrefix',\n\t\t['first', 'recentlyUsed', 'recentlyUsedByPrefix'] as const,\n\t\t{\n\t\t\tmarkdownEnumDescriptions: [\n\t\t\t\tnls.localize('suggestSelection.first', \"Always select the first suggestion.\"),\n\t\t\t\tnls.localize('suggestSelection.recentlyUsed', \"Select recent suggestions unless further typing selects one, e.g. `console.| -> console.log` because `log` has been completed recently.\"),\n\t\t\t\tnls.localize('suggestSelection.recentlyUsedByPrefix', \"Select suggestions based on previous prefixes that have completed those suggestions, e.g. `co -> console` and `con -> const`.\"),\n\t\t\t],\n\t\t\tdescription: nls.localize('suggestSelection', \"Controls how suggestions are pre-selected when showing the suggest list.\")\n\t\t}\n\t)),\n\ttabCompletion: register(new EditorStringEnumOption(\n\t\tEditorOption.tabCompletion, 'tabCompletion',\n\t\t'off' as 'on' | 'off' | 'onlySnippets',\n\t\t['on', 'off', 'onlySnippets'] as const,\n\t\t{\n\t\t\tenumDescriptions: [\n\t\t\t\tnls.localize('tabCompletion.on', \"Tab complete will insert the best matching suggestion when pressing tab.\"),\n\t\t\t\tnls.localize('tabCompletion.off', \"Disable tab completions.\"),\n\t\t\t\tnls.localize('tabCompletion.onlySnippets', \"Tab complete snippets when their prefix match. Works best when 'quickSuggestions' aren't enabled.\"),\n\t\t\t],\n\t\t\tdescription: nls.localize('tabCompletion', \"Enables tab completions.\")\n\t\t}\n\t)),\n\ttabIndex: register(new EditorIntOption(\n\t\tEditorOption.tabIndex, 'tabIndex',\n\t\t0, -1, Constants.MAX_SAFE_SMALL_INTEGER\n\t)),\n\tunusualLineTerminators: register(new EditorStringEnumOption(\n\t\tEditorOption.unusualLineTerminators, 'unusualLineTerminators',\n\t\t'prompt' as 'auto' | 'off' | 'prompt',\n\t\t['auto', 'off', 'prompt'] as const,\n\t\t{\n\t\t\tenumDescriptions: [\n\t\t\t\tnls.localize('unusualLineTerminators.auto', \"Unusual line terminators are automatically removed.\"),\n\t\t\t\tnls.localize('unusualLineTerminators.off', \"Unusual line terminators are ignored.\"),\n\t\t\t\tnls.localize('unusualLineTerminators.prompt', \"Unusual line terminators prompt to be removed.\"),\n\t\t\t],\n\t\t\tdescription: nls.localize('unusualLineTerminators', \"Remove unusual line terminators that might cause problems.\")\n\t\t}\n\t)),\n\tuseTabStops: register(new EditorBooleanOption(\n\t\tEditorOption.useTabStops, 'useTabStops', true,\n\t\t{ description: nls.localize('useTabStops', \"Inserting and deleting whitespace follows tab stops.\") }\n\t)),\n\twordSeparators: register(new EditorStringOption(\n\t\tEditorOption.wordSeparators, 'wordSeparators', USUAL_WORD_SEPARATORS,\n\t\t{ description: nls.localize('wordSeparators', \"Characters that will be used as word separators when doing word related navigations or operations.\") }\n\t)),\n\twordWrap: register(new EditorStringEnumOption(\n\t\tEditorOption.wordWrap, 'wordWrap',\n\t\t'off' as 'off' | 'on' | 'wordWrapColumn' | 'bounded',\n\t\t['off', 'on', 'wordWrapColumn', 'bounded'] as const,\n\t\t{\n\t\t\tmarkdownEnumDescriptions: [\n\t\t\t\tnls.localize('wordWrap.off', \"Lines will never wrap.\"),\n\t\t\t\tnls.localize('wordWrap.on', \"Lines will wrap at the viewport width.\"),\n\t\t\t\tnls.localize({\n\t\t\t\t\tkey: 'wordWrap.wordWrapColumn',\n\t\t\t\t\tcomment: [\n\t\t\t\t\t\t'- `editor.wordWrapColumn` refers to a different setting and should not be localized.'\n\t\t\t\t\t]\n\t\t\t\t}, \"Lines will wrap at `#editor.wordWrapColumn#`.\"),\n\t\t\t\tnls.localize({\n\t\t\t\t\tkey: 'wordWrap.bounded',\n\t\t\t\t\tcomment: [\n\t\t\t\t\t\t'- viewport means the edge of the visible window size.',\n\t\t\t\t\t\t'- `editor.wordWrapColumn` refers to a different setting and should not be localized.'\n\t\t\t\t\t]\n\t\t\t\t}, \"Lines will wrap at the minimum of viewport and `#editor.wordWrapColumn#`.\"),\n\t\t\t],\n\t\t\tdescription: nls.localize({\n\t\t\t\tkey: 'wordWrap',\n\t\t\t\tcomment: [\n\t\t\t\t\t'- \\'off\\', \\'on\\', \\'wordWrapColumn\\' and \\'bounded\\' refer to values the setting can take and should not be localized.',\n\t\t\t\t\t'- `editor.wordWrapColumn` refers to a different setting and should not be localized.'\n\t\t\t\t]\n\t\t\t}, \"Controls how lines should wrap.\")\n\t\t}\n\t)),\n\twordWrapBreakAfterCharacters: register(new EditorStringOption(\n\t\tEditorOption.wordWrapBreakAfterCharacters, 'wordWrapBreakAfterCharacters',\n\t\t' \\t})]?|/&.,;¢°′″‰℃、。｡､￠，．：；？！％・･ゝゞヽヾーァィゥェォッャュョヮヵヶぁぃぅぇぉっゃゅょゎゕゖㇰㇱㇲㇳㇴㇵㇶㇷㇸㇹㇺㇻㇼㇽㇾㇿ々〻ｧｨｩｪｫｬｭｮｯｰ”〉》」』】〕）］｝｣',\n\t)),\n\twordWrapBreakBeforeCharacters: register(new EditorStringOption(\n\t\tEditorOption.wordWrapBreakBeforeCharacters, 'wordWrapBreakBeforeCharacters',\n\t\t'([{‘“〈《「『【〔（［｛｢£¥＄￡￥+＋'\n\t)),\n\twordWrapColumn: register(new EditorIntOption(\n\t\tEditorOption.wordWrapColumn, 'wordWrapColumn',\n\t\t80, 1, Constants.MAX_SAFE_SMALL_INTEGER,\n\t\t{\n\t\t\tmarkdownDescription: nls.localize({\n\t\t\t\tkey: 'wordWrapColumn',\n\t\t\t\tcomment: [\n\t\t\t\t\t'- `editor.wordWrap` refers to a different setting and should not be localized.',\n\t\t\t\t\t'- \\'wordWrapColumn\\' and \\'bounded\\' refer to values the different setting can take and should not be localized.'\n\t\t\t\t]\n\t\t\t}, \"Controls the wrapping column of the editor when `#editor.wordWrap#` is `wordWrapColumn` or `bounded`.\")\n\t\t}\n\t)),\n\twordWrapOverride1: register(new EditorStringEnumOption(\n\t\tEditorOption.wordWrapOverride1, 'wordWrapOverride1',\n\t\t'inherit' as 'off' | 'on' | 'inherit',\n\t\t['off', 'on', 'inherit'] as const\n\t)),\n\twordWrapOverride2: register(new EditorStringEnumOption(\n\t\tEditorOption.wordWrapOverride2, 'wordWrapOverride2',\n\t\t'inherit' as 'off' | 'on' | 'inherit',\n\t\t['off', 'on', 'inherit'] as const\n\t)),\n\twrappingIndent: register(new EditorEnumOption(\n\t\tEditorOption.wrappingIndent, 'wrappingIndent',\n\t\tWrappingIndent.Same, 'same',\n\t\t['none', 'same', 'indent', 'deepIndent'],\n\t\t_wrappingIndentFromString,\n\t\t{\n\t\t\tenumDescriptions: [\n\t\t\t\tnls.localize('wrappingIndent.none', \"No indentation. Wrapped lines begin at column 1.\"),\n\t\t\t\tnls.localize('wrappingIndent.same', \"Wrapped lines get the same indentation as the parent.\"),\n\t\t\t\tnls.localize('wrappingIndent.indent', \"Wrapped lines get +1 indentation toward the parent.\"),\n\t\t\t\tnls.localize('wrappingIndent.deepIndent', \"Wrapped lines get +2 indentation toward the parent.\"),\n\t\t\t],\n\t\t\tdescription: nls.localize('wrappingIndent', \"Controls the indentation of wrapped lines.\"),\n\t\t}\n\t)),\n\twrappingStrategy: register(new EditorStringEnumOption(\n\t\tEditorOption.wrappingStrategy, 'wrappingStrategy',\n\t\t'simple' as 'simple' | 'advanced',\n\t\t['simple', 'advanced'] as const,\n\t\t{\n\t\t\tenumDescriptions: [\n\t\t\t\tnls.localize('wrappingStrategy.simple', \"Assumes that all characters are of the same width. This is a fast algorithm that works correctly for monospace fonts and certain scripts (like Latin characters) where glyphs are of equal width.\"),\n\t\t\t\tnls.localize('wrappingStrategy.advanced', \"Delegates wrapping points computation to the browser. This is a slow algorithm, that might cause freezes for large files, but it works correctly in all cases.\")\n\t\t\t],\n\t\t\tdescription: nls.localize('wrappingStrategy', \"Controls the algorithm that computes wrapping points.\")\n\t\t}\n\t)),\n\n\t// Leave these at the end (because they have dependencies!)\n\teditorClassName: register(new EditorClassName()),\n\tpixelRatio: register(new EditorPixelRatio()),\n\ttabFocusMode: register(new EditorTabFocusMode()),\n\tlayoutInfo: register(new EditorLayoutInfoComputer()),\n\twrappingInfo: register(new EditorWrappingInfoComputer())\n};\n\ntype EditorOptionsType = typeof EditorOptions;\ntype FindEditorOptionsKeyById<T extends EditorOption> = { [K in keyof EditorOptionsType]: EditorOptionsType[K]['id'] extends T ? K : never }[keyof EditorOptionsType];\ntype ComputedEditorOptionValue<T extends IEditorOption<any, any>> = T extends IEditorOption<any, infer R> ? R : never;\nexport type FindComputedEditorOptionValueById<T extends EditorOption> = NonNullable<ComputedEditorOptionValue<EditorOptionsType[FindEditorOptionsKeyById<T>]>>;\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as instantiation from './instantiation';\n\nexport class SyncDescriptor<T> {\n\n\treadonly ctor: any;\n\treadonly staticArguments: any[];\n\treadonly supportsDelayedInstantiation: boolean;\n\n\tconstructor(ctor: new (...args: any[]) => T, staticArguments: any[] = [], supportsDelayedInstantiation: boolean = false) {\n\t\tthis.ctor = ctor;\n\t\tthis.staticArguments = staticArguments;\n\t\tthis.supportsDelayedInstantiation = supportsDelayedInstantiation;\n\t}\n}\n\nexport interface CreateSyncFunc {\n\n\t<T>(ctor: instantiation.IConstructorSignature0<T>): SyncDescriptor0<T>;\n\n\t<A1, T>(ctor: instantiation.IConstructorSignature1<A1, T>): SyncDescriptor1<A1, T>;\n\t<A1, T>(ctor: instantiation.IConstructorSignature1<A1, T>, a1: A1): SyncDescriptor0<T>;\n\n\t<A1, A2, T>(ctor: instantiation.IConstructorSignature2<A1, A2, T>): SyncDescriptor2<A1, A2, T>;\n\t<A1, A2, T>(ctor: instantiation.IConstructorSignature2<A1, A2, T>, a1: A1): SyncDescriptor1<A2, T>;\n\t<A1, A2, T>(ctor: instantiation.IConstructorSignature2<A1, A2, T>, a1: A1, a2: A2): SyncDescriptor0<T>;\n\n\t<A1, A2, A3, T>(ctor: instantiation.IConstructorSignature3<A1, A2, A3, T>): SyncDescriptor3<A1, A2, A3, T>;\n\t<A1, A2, A3, T>(ctor: instantiation.IConstructorSignature3<A1, A2, A3, T>, a1: A1): SyncDescriptor2<A2, A3, T>;\n\t<A1, A2, A3, T>(ctor: instantiation.IConstructorSignature3<A1, A2, A3, T>, a1: A1, a2: A2): SyncDescriptor1<A3, T>;\n\t<A1, A2, A3, T>(ctor: instantiation.IConstructorSignature3<A1, A2, A3, T>, a1: A1, a2: A2, a3: A3): SyncDescriptor0<T>;\n\n\t<A1, A2, A3, A4, T>(ctor: instantiation.IConstructorSignature4<A1, A2, A3, A4, T>): SyncDescriptor4<A1, A2, A3, A4, T>;\n\t<A1, A2, A3, A4, T>(ctor: instantiation.IConstructorSignature4<A1, A2, A3, A4, T>, a1: A1): SyncDescriptor3<A2, A3, A4, T>;\n\t<A1, A2, A3, A4, T>(ctor: instantiation.IConstructorSignature4<A1, A2, A3, A4, T>, a1: A1, a2: A2): SyncDescriptor2<A3, A4, T>;\n\t<A1, A2, A3, A4, T>(ctor: instantiation.IConstructorSignature4<A1, A2, A3, A4, T>, a1: A1, a2: A2, a3: A3): SyncDescriptor1<A4, T>;\n\t<A1, A2, A3, A4, T>(ctor: instantiation.IConstructorSignature4<A1, A2, A3, A4, T>, a1: A1, a2: A2, a3: A3, a4: A4): SyncDescriptor0<T>;\n\n\t<A1, A2, A3, A4, A5, T>(ctor: instantiation.IConstructorSignature5<A1, A2, A3, A4, A5, T>): SyncDescriptor5<A1, A2, A3, A4, A5, T>;\n\t<A1, A2, A3, A4, A5, T>(ctor: instantiation.IConstructorSignature5<A1, A2, A3, A4, A5, T>, a1: A1): SyncDescriptor4<A2, A3, A4, A5, T>;\n\t<A1, A2, A3, A4, A5, T>(ctor: instantiation.IConstructorSignature5<A1, A2, A3, A4, A5, T>, a1: A1, a2: A2): SyncDescriptor3<A3, A4, A5, T>;\n\t<A1, A2, A3, A4, A5, T>(ctor: instantiation.IConstructorSignature5<A1, A2, A3, A4, A5, T>, a1: A1, a2: A2, a3: A3): SyncDescriptor2<A4, A5, T>;\n\t<A1, A2, A3, A4, A5, T>(ctor: instantiation.IConstructorSignature5<A1, A2, A3, A4, A5, T>, a1: A1, a2: A2, a3: A3, a4: A4): SyncDescriptor1<A5, T>;\n\t<A1, A2, A3, A4, A5, T>(ctor: instantiation.IConstructorSignature5<A1, A2, A3, A4, A5, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5): SyncDescriptor0<T>;\n\n\t<A1, A2, A3, A4, A5, A6, T>(ctor: instantiation.IConstructorSignature6<A1, A2, A3, A4, A5, A6, T>): SyncDescriptor6<A1, A2, A3, A4, A5, A6, T>;\n\t<A1, A2, A3, A4, A5, A6, T>(ctor: instantiation.IConstructorSignature6<A1, A2, A3, A4, A5, A6, T>, a1: A1): SyncDescriptor5<A2, A3, A4, A5, A6, T>;\n\t<A1, A2, A3, A4, A5, A6, T>(ctor: instantiation.IConstructorSignature6<A1, A2, A3, A4, A5, A6, T>, a1: A1, a2: A2): SyncDescriptor4<A3, A4, A5, A6, T>;\n\t<A1, A2, A3, A4, A5, A6, T>(ctor: instantiation.IConstructorSignature6<A1, A2, A3, A4, A5, A6, T>, a1: A1, a2: A2, a3: A3): SyncDescriptor3<A4, A5, A6, T>;\n\t<A1, A2, A3, A4, A5, A6, T>(ctor: instantiation.IConstructorSignature6<A1, A2, A3, A4, A5, A6, T>, a1: A1, a2: A2, a3: A3, a4: A4): SyncDescriptor2<A5, A6, T>;\n\t<A1, A2, A3, A4, A5, A6, T>(ctor: instantiation.IConstructorSignature6<A1, A2, A3, A4, A5, A6, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5): SyncDescriptor1<A6, T>;\n\t<A1, A2, A3, A4, A5, A6, T>(ctor: instantiation.IConstructorSignature6<A1, A2, A3, A4, A5, A6, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6): SyncDescriptor0<T>;\n\n\t<A1, A2, A3, A4, A5, A6, A7, T>(ctor: instantiation.IConstructorSignature7<A1, A2, A3, A4, A5, A6, A7, T>): SyncDescriptor7<A1, A2, A3, A4, A5, A6, A7, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, T>(ctor: instantiation.IConstructorSignature7<A1, A2, A3, A4, A5, A6, A7, T>, a1: A1): SyncDescriptor6<A2, A3, A4, A5, A6, A7, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, T>(ctor: instantiation.IConstructorSignature7<A1, A2, A3, A4, A5, A6, A7, T>, a1: A1, a2: A2): SyncDescriptor5<A3, A4, A5, A6, A7, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, T>(ctor: instantiation.IConstructorSignature7<A1, A2, A3, A4, A5, A6, A7, T>, a1: A1, a2: A2, a3: A3): SyncDescriptor4<A4, A5, A6, A7, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, T>(ctor: instantiation.IConstructorSignature7<A1, A2, A3, A4, A5, A6, A7, T>, a1: A1, a2: A2, a3: A3, a4: A4): SyncDescriptor3<A5, A6, A7, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, T>(ctor: instantiation.IConstructorSignature7<A1, A2, A3, A4, A5, A6, A7, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5): SyncDescriptor2<A6, A7, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, T>(ctor: instantiation.IConstructorSignature7<A1, A2, A3, A4, A5, A6, A7, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6): SyncDescriptor1<A7, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, T>(ctor: instantiation.IConstructorSignature7<A1, A2, A3, A4, A5, A6, A7, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6, a7: A7): SyncDescriptor0<T>;\n\n\t<A1, A2, A3, A4, A5, A6, A7, A8, T>(ctor: instantiation.IConstructorSignature8<A1, A2, A3, A4, A5, A6, A7, A8, T>): SyncDescriptor8<A1, A2, A3, A4, A5, A6, A7, A8, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, A8, T>(ctor: instantiation.IConstructorSignature8<A1, A2, A3, A4, A5, A6, A7, A8, T>, a1: A1): SyncDescriptor7<A2, A3, A4, A5, A6, A7, A8, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, A8, T>(ctor: instantiation.IConstructorSignature8<A1, A2, A3, A4, A5, A6, A7, A8, T>, a1: A1, a2: A2): SyncDescriptor6<A3, A4, A5, A6, A7, A8, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, A8, T>(ctor: instantiation.IConstructorSignature8<A1, A2, A3, A4, A5, A6, A7, A8, T>, a1: A1, a2: A2, a3: A3): SyncDescriptor5<A4, A5, A6, A7, A8, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, A8, T>(ctor: instantiation.IConstructorSignature8<A1, A2, A3, A4, A5, A6, A7, A8, T>, a1: A1, a2: A2, a3: A3, a4: A4): SyncDescriptor4<A5, A6, A7, A8, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, A8, T>(ctor: instantiation.IConstructorSignature8<A1, A2, A3, A4, A5, A6, A7, A8, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5): SyncDescriptor3<A6, A7, A8, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, A8, T>(ctor: instantiation.IConstructorSignature8<A1, A2, A3, A4, A5, A6, A7, A8, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6): SyncDescriptor2<A7, A8, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, A8, T>(ctor: instantiation.IConstructorSignature8<A1, A2, A3, A4, A5, A6, A7, A8, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6, a7: A7): SyncDescriptor1<A8, T>;\n\t<A1, A2, A3, A4, A5, A6, A7, A8, T>(ctor: instantiation.IConstructorSignature8<A1, A2, A3, A4, A5, A6, A7, A8, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6, a7: A7, a8: A8): SyncDescriptor0<T>;\n}\nexport const createSyncDescriptor: CreateSyncFunc = <T>(ctor: any, ...staticArguments: any[]): any => {\n\treturn new SyncDescriptor<T>(ctor, staticArguments);\n};\n\nexport interface SyncDescriptor0<T> {\n\tctor: any;\n\tbind(): SyncDescriptor0<T>;\n}\nexport interface SyncDescriptor1<A1, T> {\n\tctor: any;\n\tbind(a1: A1): SyncDescriptor0<T>;\n}\nexport interface SyncDescriptor2<A1, A2, T> {\n\tctor: any;\n\tbind(a1: A1): SyncDescriptor1<A2, T>;\n\tbind(a1: A1, a2: A2): SyncDescriptor0<T>;\n}\nexport interface SyncDescriptor3<A1, A2, A3, T> {\n\tctor: any;\n\tbind(a1: A1): SyncDescriptor2<A2, A3, T>;\n\tbind(a1: A1, a2: A2): SyncDescriptor1<A3, T>;\n\tbind(a1: A1, a2: A2, a3: A3): SyncDescriptor0<T>;\n}\nexport interface SyncDescriptor4<A1, A2, A3, A4, T> {\n\tctor: any;\n\tbind(a1: A1): SyncDescriptor3<A2, A3, A4, T>;\n\tbind(a1: A1, a2: A2): SyncDescriptor2<A3, A4, T>;\n\tbind(a1: A1, a2: A2, a3: A3): SyncDescriptor1<A4, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4): SyncDescriptor0<T>;\n}\nexport interface SyncDescriptor5<A1, A2, A3, A4, A5, T> {\n\tctor: any;\n\tbind(a1: A1): SyncDescriptor4<A2, A3, A4, A5, T>;\n\tbind(a1: A1, a2: A2): SyncDescriptor3<A3, A4, A5, T>;\n\tbind(a1: A1, a2: A2, a3: A3): SyncDescriptor2<A4, A5, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4): SyncDescriptor1<A5, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5): SyncDescriptor0<T>;\n}\nexport interface SyncDescriptor6<A1, A2, A3, A4, A5, A6, T> {\n\tctor: any;\n\tbind(a1: A1): SyncDescriptor5<A2, A3, A4, A5, A6, T>;\n\tbind(a1: A1, a2: A2): SyncDescriptor4<A3, A4, A5, A6, T>;\n\tbind(a1: A1, a2: A2, a3: A3): SyncDescriptor3<A4, A5, A6, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4): SyncDescriptor2<A5, A6, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5): SyncDescriptor1<A6, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6): SyncDescriptor0<T>;\n}\nexport interface SyncDescriptor7<A1, A2, A3, A4, A5, A6, A7, T> {\n\tctor: any;\n\tbind(a1: A1): SyncDescriptor6<A2, A3, A4, A5, A6, A7, T>;\n\tbind(a1: A1, a2: A2): SyncDescriptor5<A3, A4, A5, A6, A7, T>;\n\tbind(a1: A1, a2: A2, a3: A3): SyncDescriptor4<A4, A5, A6, A7, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4): SyncDescriptor3<A5, A6, A7, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5): SyncDescriptor2<A6, A7, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6): SyncDescriptor1<A7, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6, a7: A7): SyncDescriptor0<T>;\n}\nexport interface SyncDescriptor8<A1, A2, A3, A4, A5, A6, A7, A8, T> {\n\tctor: any;\n\tbind(a1: A1): SyncDescriptor7<A2, A3, A4, A5, A6, A7, A8, T>;\n\tbind(a1: A1, a2: A2): SyncDescriptor6<A3, A4, A5, A6, A7, A8, T>;\n\tbind(a1: A1, a2: A2, a3: A3): SyncDescriptor5<A4, A5, A6, A7, A8, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4): SyncDescriptor4<A5, A6, A7, A8, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5): SyncDescriptor3<A6, A7, A8, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6): SyncDescriptor2<A7, A8, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6, a7: A7): SyncDescriptor1<A8, T>;\n\tbind(a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6, a7: A7, a8: A8): SyncDescriptor0<T>;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { SyncDescriptor } from './descriptors';\nimport { ServiceIdentifier, BrandedService } from './instantiation';\n\nconst _registry: [ServiceIdentifier<any>, SyncDescriptor<any>][] = [];\n\nexport function registerSingleton<T, Services extends BrandedService[]>(id: ServiceIdentifier<T>, ctor: new (...services: Services) => T, supportsDelayedInstantiation?: boolean): void {\n\t_registry.push([id, new SyncDescriptor<T>(ctor as new (...args: any[]) => T, [], supportsDelayedInstantiation)]);\n}\n\nexport function getSingletonServiceDescriptors(): [ServiceIdentifier<any>, SyncDescriptor<any>][] {\n\treturn _registry;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nexport class Node<T> {\n\n\treadonly data: T;\n\treadonly incoming = new Map<string, Node<T>>();\n\treadonly outgoing = new Map<string, Node<T>>();\n\n\tconstructor(data: T) {\n\t\tthis.data = data;\n\t}\n}\n\nexport class Graph<T> {\n\n\tprivate readonly _nodes = new Map<string, Node<T>>();\n\n\tconstructor(private readonly _hashFn: (element: T) => string) {\n\t\t// empty\n\t}\n\n\troots(): Node<T>[] {\n\t\tconst ret: Node<T>[] = [];\n\t\tfor (let node of this._nodes.values()) {\n\t\t\tif (node.outgoing.size === 0) {\n\t\t\t\tret.push(node);\n\t\t\t}\n\t\t}\n\t\treturn ret;\n\t}\n\n\tinsertEdge(from: T, to: T): void {\n\t\tconst fromNode = this.lookupOrInsertNode(from);\n\t\tconst toNode = this.lookupOrInsertNode(to);\n\n\t\tfromNode.outgoing.set(this._hashFn(to), toNode);\n\t\ttoNode.incoming.set(this._hashFn(from), fromNode);\n\t}\n\n\tremoveNode(data: T): void {\n\t\tconst key = this._hashFn(data);\n\t\tthis._nodes.delete(key);\n\t\tfor (let node of this._nodes.values()) {\n\t\t\tnode.outgoing.delete(key);\n\t\t\tnode.incoming.delete(key);\n\t\t}\n\t}\n\n\tlookupOrInsertNode(data: T): Node<T> {\n\t\tconst key = this._hashFn(data);\n\t\tlet node = this._nodes.get(key);\n\n\t\tif (!node) {\n\t\t\tnode = new Node(data);\n\t\t\tthis._nodes.set(key, node);\n\t\t}\n\n\t\treturn node;\n\t}\n\n\tlookup(data: T): Node<T> | undefined {\n\t\treturn this._nodes.get(this._hashFn(data));\n\t}\n\n\tisEmpty(): boolean {\n\t\treturn this._nodes.size === 0;\n\t}\n\n\ttoString(): string {\n\t\tlet data: string[] = [];\n\t\tfor (let [key, value] of this._nodes) {\n\t\t\tdata.push(`${key}, (incoming)[${[...value.incoming.keys()].join(', ')}], (outgoing)[${[...value.outgoing.keys()].join(',')}]`);\n\n\t\t}\n\t\treturn data.join('\\n');\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ServiceCollection } from './serviceCollection';\nimport * as descriptors from './descriptors';\n\n// ------ internal util\n\nexport namespace _util {\n\n\texport const serviceIds = new Map<string, ServiceIdentifier<any>>();\n\n\texport const DI_TARGET = '$di$target';\n\texport const DI_DEPENDENCIES = '$di$dependencies';\n\n\texport function getServiceDependencies(ctor: any): { id: ServiceIdentifier<any>, index: number, optional: boolean }[] {\n\t\treturn ctor[DI_DEPENDENCIES] || [];\n\t}\n}\n\n// --- interfaces ------\n\nexport type BrandedService = { _serviceBrand: undefined };\n\nexport interface IConstructorSignature0<T> {\n\tnew(...services: BrandedService[]): T;\n}\n\nexport interface IConstructorSignature1<A1, T> {\n\tnew <Services extends BrandedService[]>(first: A1, ...services: Services): T;\n}\n\nexport interface IConstructorSignature2<A1, A2, T> {\n\tnew(first: A1, second: A2, ...services: BrandedService[]): T;\n}\n\nexport interface IConstructorSignature3<A1, A2, A3, T> {\n\tnew(first: A1, second: A2, third: A3, ...services: BrandedService[]): T;\n}\n\nexport interface IConstructorSignature4<A1, A2, A3, A4, T> {\n\tnew(first: A1, second: A2, third: A3, fourth: A4, ...services: BrandedService[]): T;\n}\n\nexport interface IConstructorSignature5<A1, A2, A3, A4, A5, T> {\n\tnew(first: A1, second: A2, third: A3, fourth: A4, fifth: A5, ...services: BrandedService[]): T;\n}\n\nexport interface IConstructorSignature6<A1, A2, A3, A4, A5, A6, T> {\n\tnew(first: A1, second: A2, third: A3, fourth: A4, fifth: A5, sixth: A6, ...services: BrandedService[]): T;\n}\n\nexport interface IConstructorSignature7<A1, A2, A3, A4, A5, A6, A7, T> {\n\tnew(first: A1, second: A2, third: A3, fourth: A4, fifth: A5, sixth: A6, seventh: A7, ...services: BrandedService[]): T;\n}\n\nexport interface IConstructorSignature8<A1, A2, A3, A4, A5, A6, A7, A8, T> {\n\tnew(first: A1, second: A2, third: A3, fourth: A4, fifth: A5, sixth: A6, seventh: A7, eigth: A8, ...services: BrandedService[]): T;\n}\n\nexport interface ServicesAccessor {\n\tget<T>(id: ServiceIdentifier<T>): T;\n\tget<T>(id: ServiceIdentifier<T>, isOptional: typeof optional): T | undefined;\n}\n\nexport const IInstantiationService = createDecorator<IInstantiationService>('instantiationService');\n\n/**\n * Given a list of arguments as a tuple, attempt to extract the leading, non-service arguments\n * to their own tuple.\n */\ntype GetLeadingNonServiceArgs<Args> =\n\tArgs extends [...BrandedService[]] ? []\n\t: Args extends [infer A1, ...BrandedService[]] ? [A1]\n\t: Args extends [infer A1, infer A2, ...BrandedService[]] ? [A1, A2]\n\t: Args extends [infer A1, infer A2, infer A3, ...BrandedService[]] ? [A1, A2, A3]\n\t: Args extends [infer A1, infer A2, infer A3, infer A4, ...BrandedService[]] ? [A1, A2, A3, A4]\n\t: Args extends [infer A1, infer A2, infer A3, infer A4, infer A5, ...BrandedService[]] ? [A1, A2, A3, A4, A5]\n\t: Args extends [infer A1, infer A2, infer A3, infer A4, infer A5, infer A6, ...BrandedService[]] ? [A1, A2, A3, A4, A5, A6]\n\t: Args extends [infer A1, infer A2, infer A3, infer A4, infer A5, infer A6, infer A7, ...BrandedService[]] ? [A1, A2, A3, A4, A5, A6, A7]\n\t: Args extends [infer A1, infer A2, infer A3, infer A4, infer A5, infer A6, infer A7, infer A8, ...BrandedService[]] ? [A1, A2, A3, A4, A5, A6, A7, A8]\n\t: never;\n\nexport interface IInstantiationService {\n\n\treadonly _serviceBrand: undefined;\n\n\t/**\n\t * Synchronously creates an instance that is denoted by\n\t * the descriptor\n\t */\n\tcreateInstance<T>(descriptor: descriptors.SyncDescriptor0<T>): T;\n\tcreateInstance<A1, T>(descriptor: descriptors.SyncDescriptor1<A1, T>, a1: A1): T;\n\tcreateInstance<A1, A2, T>(descriptor: descriptors.SyncDescriptor2<A1, A2, T>, a1: A1, a2: A2): T;\n\tcreateInstance<A1, A2, A3, T>(descriptor: descriptors.SyncDescriptor3<A1, A2, A3, T>, a1: A1, a2: A2, a3: A3): T;\n\tcreateInstance<A1, A2, A3, A4, T>(descriptor: descriptors.SyncDescriptor4<A1, A2, A3, A4, T>, a1: A1, a2: A2, a3: A3, a4: A4): T;\n\tcreateInstance<A1, A2, A3, A4, A5, T>(descriptor: descriptors.SyncDescriptor5<A1, A2, A3, A4, A5, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5): T;\n\tcreateInstance<A1, A2, A3, A4, A5, A6, T>(descriptor: descriptors.SyncDescriptor6<A1, A2, A3, A4, A5, A6, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6): T;\n\tcreateInstance<A1, A2, A3, A4, A5, A6, A7, T>(descriptor: descriptors.SyncDescriptor7<A1, A2, A3, A4, A5, A6, A7, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6, a7: A7): T;\n\tcreateInstance<A1, A2, A3, A4, A5, A6, A7, A8, T>(descriptor: descriptors.SyncDescriptor8<A1, A2, A3, A4, A5, A6, A7, A8, T>, a1: A1, a2: A2, a3: A3, a4: A4, a5: A5, a6: A6, a7: A7, a8: A8): T;\n\n\tcreateInstance<Ctor extends new (...args: any[]) => any, R extends InstanceType<Ctor>>(t: Ctor, ...args: GetLeadingNonServiceArgs<ConstructorParameters<Ctor>>): R;\n\n\t/**\n\t *\n\t */\n\tinvokeFunction<R, TS extends any[] = []>(fn: (accessor: ServicesAccessor, ...args: TS) => R, ...args: TS): R;\n\n\t/**\n\t * Creates a child of this service which inherts all current services\n\t * and adds/overwrites the given services\n\t */\n\tcreateChild(services: ServiceCollection): IInstantiationService;\n}\n\n\n/**\n * Identifies a service of type T\n */\nexport interface ServiceIdentifier<T> {\n\t(...args: any[]): void;\n\ttype: T;\n}\n\nfunction storeServiceDependency(id: Function, target: Function, index: number, optional: boolean): void {\n\tif ((target as any)[_util.DI_TARGET] === target) {\n\t\t(target as any)[_util.DI_DEPENDENCIES].push({ id, index, optional });\n\t} else {\n\t\t(target as any)[_util.DI_DEPENDENCIES] = [{ id, index, optional }];\n\t\t(target as any)[_util.DI_TARGET] = target;\n\t}\n}\n\n/**\n * The *only* valid way to create a {{ServiceIdentifier}}.\n */\nexport function createDecorator<T>(serviceId: string): ServiceIdentifier<T> {\n\n\tif (_util.serviceIds.has(serviceId)) {\n\t\treturn _util.serviceIds.get(serviceId)!;\n\t}\n\n\tconst id = <any>function (target: Function, key: string, index: number): any {\n\t\tif (arguments.length !== 3) {\n\t\t\tthrow new Error('@IServiceName-decorator can only be used to decorate a parameter');\n\t\t}\n\t\tstoreServiceDependency(id, target, index, false);\n\t};\n\n\tid.toString = () => serviceId;\n\n\t_util.serviceIds.set(serviceId, id);\n\treturn id;\n}\n\n/**\n * Mark a service dependency as optional.\n */\nexport function optional<T>(serviceIdentifier: ServiceIdentifier<T>) {\n\n\treturn function (target: Function, key: string, index: number) {\n\t\tif (arguments.length !== 3) {\n\t\t\tthrow new Error('@optional-decorator can only be used to decorate a parameter');\n\t\t}\n\t\tstoreServiceDependency(serviceIdentifier, target, index, true);\n\t};\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Event } from 'vs/base/common/event';\nimport { URI } from 'vs/base/common/uri';\nimport { ITextBufferFactory, ITextModel, ITextModelCreationOptions } from 'vs/editor/common/model';\nimport { ILanguageSelection } from 'vs/editor/common/services/modeService';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { DocumentSemanticTokensProvider, DocumentRangeSemanticTokensProvider } from 'vs/editor/common/modes';\nimport { SemanticTokensProviderStyling } from 'vs/editor/common/services/semanticTokensProviderStyling';\n\nexport const IModelService = createDecorator<IModelService>('modelService');\n\nexport type DocumentTokensProvider = DocumentSemanticTokensProvider | DocumentRangeSemanticTokensProvider;\n\nexport interface IModelService {\n\treadonly _serviceBrand: undefined;\n\n\tcreateModel(value: string | ITextBufferFactory, languageSelection: ILanguageSelection | null, resource?: URI, isForSimpleWidget?: boolean): ITextModel;\n\n\tupdateModel(model: ITextModel, value: string | ITextBufferFactory): void;\n\n\tsetMode(model: ITextModel, languageSelection: ILanguageSelection): void;\n\n\tdestroyModel(resource: URI): void;\n\n\tgetModels(): ITextModel[];\n\n\tgetCreationOptions(language: string, resource: URI, isForSimpleWidget: boolean): ITextModelCreationOptions;\n\n\tgetModel(resource: URI): ITextModel | null;\n\n\tgetSemanticTokensProviderStyling(provider: DocumentTokensProvider): SemanticTokensProviderStyling;\n\n\tonModelAdded: Event<ITextModel>;\n\n\tonModelRemoved: Event<ITextModel>;\n\n\tonModelModeChanged: Event<{ model: ITextModel; oldModeId: string; }>;\n}\n\nexport function shouldSynchronizeModel(model: ITextModel): boolean {\n\treturn (\n\t\t!model.isTooLargeForSyncing() && !model.isForSimpleWidget\n\t);\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { hash } from 'vs/base/common/hash';\nimport { IDisposable, toDisposable } from 'vs/base/common/lifecycle';\nimport { LRUCache } from 'vs/base/common/map';\nimport { MovingAverage } from 'vs/base/common/numbers';\nimport { ITextModel } from 'vs/editor/common/model';\nimport { LanguageSelector, score } from 'vs/editor/common/modes/languageSelector';\nimport { shouldSynchronizeModel } from 'vs/editor/common/services/modelService';\n\ninterface Entry<T> {\n\tselector: LanguageSelector;\n\tprovider: T;\n\t_score: number;\n\t_time: number;\n}\n\nfunction isExclusive(selector: LanguageSelector): boolean {\n\tif (typeof selector === 'string') {\n\t\treturn false;\n\t} else if (Array.isArray(selector)) {\n\t\treturn selector.every(isExclusive);\n\t} else {\n\t\treturn !!selector.exclusive;\n\t}\n}\n\nexport class LanguageFeatureRegistry<T> {\n\n\tprivate _clock: number = 0;\n\tprivate readonly _entries: Entry<T>[] = [];\n\tprivate readonly _onDidChange = new Emitter<number>();\n\n\tget onDidChange(): Event<number> {\n\t\treturn this._onDidChange.event;\n\t}\n\n\tregister(selector: LanguageSelector, provider: T): IDisposable {\n\n\t\tlet entry: Entry<T> | undefined = {\n\t\t\tselector,\n\t\t\tprovider,\n\t\t\t_score: -1,\n\t\t\t_time: this._clock++\n\t\t};\n\n\t\tthis._entries.push(entry);\n\t\tthis._lastCandidate = undefined;\n\t\tthis._onDidChange.fire(this._entries.length);\n\n\t\treturn toDisposable(() => {\n\t\t\tif (entry) {\n\t\t\t\tlet idx = this._entries.indexOf(entry);\n\t\t\t\tif (idx >= 0) {\n\t\t\t\t\tthis._entries.splice(idx, 1);\n\t\t\t\t\tthis._lastCandidate = undefined;\n\t\t\t\t\tthis._onDidChange.fire(this._entries.length);\n\t\t\t\t\tentry = undefined;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\thas(model: ITextModel): boolean {\n\t\treturn this.all(model).length > 0;\n\t}\n\n\tall(model: ITextModel): T[] {\n\t\tif (!model) {\n\t\t\treturn [];\n\t\t}\n\n\t\tthis._updateScores(model);\n\t\tconst result: T[] = [];\n\n\t\t// from registry\n\t\tfor (let entry of this._entries) {\n\t\t\tif (entry._score > 0) {\n\t\t\t\tresult.push(entry.provider);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tordered(model: ITextModel): T[] {\n\t\tconst result: T[] = [];\n\t\tthis._orderedForEach(model, entry => result.push(entry.provider));\n\t\treturn result;\n\t}\n\n\torderedGroups(model: ITextModel): T[][] {\n\t\tconst result: T[][] = [];\n\t\tlet lastBucket: T[];\n\t\tlet lastBucketScore: number;\n\n\t\tthis._orderedForEach(model, entry => {\n\t\t\tif (lastBucket && lastBucketScore === entry._score) {\n\t\t\t\tlastBucket.push(entry.provider);\n\t\t\t} else {\n\t\t\t\tlastBucketScore = entry._score;\n\t\t\t\tlastBucket = [entry.provider];\n\t\t\t\tresult.push(lastBucket);\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tprivate _orderedForEach(model: ITextModel, callback: (provider: Entry<T>) => any): void {\n\n\t\tif (!model) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._updateScores(model);\n\n\t\tfor (const entry of this._entries) {\n\t\t\tif (entry._score > 0) {\n\t\t\t\tcallback(entry);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _lastCandidate: { uri: string; language: string; } | undefined;\n\n\tprivate _updateScores(model: ITextModel): void {\n\n\t\tlet candidate = {\n\t\t\turi: model.uri.toString(),\n\t\t\tlanguage: model.getLanguageIdentifier().language\n\t\t};\n\n\t\tif (this._lastCandidate\n\t\t\t&& this._lastCandidate.language === candidate.language\n\t\t\t&& this._lastCandidate.uri === candidate.uri) {\n\n\t\t\t// nothing has changed\n\t\t\treturn;\n\t\t}\n\n\t\tthis._lastCandidate = candidate;\n\n\t\tfor (let entry of this._entries) {\n\t\t\tentry._score = score(entry.selector, model.uri, model.getLanguageIdentifier().language, shouldSynchronizeModel(model));\n\n\t\t\tif (isExclusive(entry.selector) && entry._score > 0) {\n\t\t\t\t// support for one exclusive selector that overwrites\n\t\t\t\t// any other selector\n\t\t\t\tfor (let entry of this._entries) {\n\t\t\t\t\tentry._score = 0;\n\t\t\t\t}\n\t\t\t\tentry._score = 1000;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t// needs sorting\n\t\tthis._entries.sort(LanguageFeatureRegistry._compareByScoreAndTime);\n\t}\n\n\tprivate static _compareByScoreAndTime(a: Entry<any>, b: Entry<any>): number {\n\t\tif (a._score < b._score) {\n\t\t\treturn 1;\n\t\t} else if (a._score > b._score) {\n\t\t\treturn -1;\n\t\t} else if (a._time < b._time) {\n\t\t\treturn 1;\n\t\t} else if (a._time > b._time) {\n\t\t\treturn -1;\n\t\t} else {\n\t\t\treturn 0;\n\t\t}\n\t}\n}\n\n\n/**\n * Keeps moving average per model and set of providers so that requests\n * can be debounce according to the provider performance\n */\nexport class LanguageFeatureRequestDelays {\n\n\tprivate readonly _cache = new LRUCache<string, MovingAverage>(50, 0.7);\n\n\tconstructor(\n\t\tprivate readonly _registry: LanguageFeatureRegistry<any>,\n\t\treadonly min: number,\n\t\treadonly max: number = Number.MAX_SAFE_INTEGER,\n\t) { }\n\n\tprivate _key(model: ITextModel): string {\n\t\treturn model.id + hash(this._registry.all(model));\n\t}\n\n\tprivate _clamp(value: number | undefined): number {\n\t\tif (value === undefined) {\n\t\t\treturn this.min;\n\t\t} else {\n\t\t\treturn Math.min(this.max, Math.max(this.min, Math.floor(value * 1.3)));\n\t\t}\n\t}\n\n\tget(model: ITextModel): number {\n\t\tconst key = this._key(model);\n\t\tconst avg = this._cache.get(key);\n\t\treturn this._clamp(avg?.value);\n\t}\n\n\tupdate(model: ITextModel, value: number): number {\n\t\tconst key = this._key(model);\n\t\tlet avg = this._cache.get(key);\n\t\tif (!avg) {\n\t\t\tavg = new MovingAverage();\n\t\t\tthis._cache.set(key, avg);\n\t\t}\n\t\tavg.update(value);\n\t\treturn this.get(model);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { Color } from 'vs/base/common/color';\nimport { Event } from 'vs/base/common/event';\nimport { IMarkdownString } from 'vs/base/common/htmlContent';\nimport { IDisposable } from 'vs/base/common/lifecycle';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { Position } from 'vs/editor/common/core/position';\nimport { IRange, Range } from 'vs/editor/common/core/range';\nimport { Selection } from 'vs/editor/common/core/selection';\nimport { TokenizationResult, TokenizationResult2 } from 'vs/editor/common/core/token';\nimport * as model from 'vs/editor/common/model';\nimport { LanguageFeatureRegistry } from 'vs/editor/common/modes/languageFeatureRegistry';\nimport { TokenizationRegistryImpl } from 'vs/editor/common/modes/tokenizationRegistry';\nimport { ExtensionIdentifier } from 'vs/platform/extensions/common/extensions';\nimport { IMarkerData } from 'vs/platform/markers/common/markers';\nimport { iconRegistry, Codicon } from 'vs/base/common/codicons';\nimport { ThemeIcon } from 'vs/platform/theme/common/themeService';\n/**\n * Open ended enum at runtime\n * @internal\n */\nexport const enum LanguageId {\n\tNull = 0,\n\tPlainText = 1\n}\n\n/**\n * @internal\n */\nexport class LanguageIdentifier {\n\n\t/**\n\t * A string identifier. Unique across languages. e.g. 'javascript'.\n\t */\n\tpublic readonly language: string;\n\n\t/**\n\t * A numeric identifier. Unique across languages. e.g. 5\n\t * Will vary at runtime based on registration order, etc.\n\t */\n\tpublic readonly id: LanguageId;\n\n\tconstructor(language: string, id: LanguageId) {\n\t\tthis.language = language;\n\t\tthis.id = id;\n\t}\n}\n\n/**\n * A mode. Will soon be obsolete.\n * @internal\n */\nexport interface IMode {\n\n\tgetId(): string;\n\n\tgetLanguageIdentifier(): LanguageIdentifier;\n\n}\n\n/**\n * A font style. Values are 2^x such that a bit mask can be used.\n * @internal\n */\nexport const enum FontStyle {\n\tNotSet = -1,\n\tNone = 0,\n\tItalic = 1,\n\tBold = 2,\n\tUnderline = 4\n}\n\n/**\n * Open ended enum at runtime\n * @internal\n */\nexport const enum ColorId {\n\tNone = 0,\n\tDefaultForeground = 1,\n\tDefaultBackground = 2\n}\n\n/**\n * A standard token type. Values are 2^x such that a bit mask can be used.\n * @internal\n */\nexport const enum StandardTokenType {\n\tOther = 0,\n\tComment = 1,\n\tString = 2,\n\tRegEx = 4\n}\n\n/**\n * Helpers to manage the \"collapsed\" metadata of an entire StackElement stack.\n * The following assumptions have been made:\n *  - languageId < 256 => needs 8 bits\n *  - unique color count < 512 => needs 9 bits\n *\n * The binary format is:\n * - -------------------------------------------\n *     3322 2222 2222 1111 1111 1100 0000 0000\n *     1098 7654 3210 9876 5432 1098 7654 3210\n * - -------------------------------------------\n *     xxxx xxxx xxxx xxxx xxxx xxxx xxxx xxxx\n *     bbbb bbbb bfff ffff ffFF FTTT LLLL LLLL\n * - -------------------------------------------\n *  - L = LanguageId (8 bits)\n *  - T = StandardTokenType (3 bits)\n *  - F = FontStyle (3 bits)\n *  - f = foreground color (9 bits)\n *  - b = background color (9 bits)\n *\n * @internal\n */\nexport const enum MetadataConsts {\n\tLANGUAGEID_MASK = 0b00000000000000000000000011111111,\n\tTOKEN_TYPE_MASK = 0b00000000000000000000011100000000,\n\tFONT_STYLE_MASK = 0b00000000000000000011100000000000,\n\tFOREGROUND_MASK = 0b00000000011111111100000000000000,\n\tBACKGROUND_MASK = 0b11111111100000000000000000000000,\n\n\tITALIC_MASK = 0b00000000000000000000100000000000,\n\tBOLD_MASK = 0b00000000000000000001000000000000,\n\tUNDERLINE_MASK = 0b00000000000000000010000000000000,\n\n\tSEMANTIC_USE_ITALIC = 0b00000000000000000000000000000001,\n\tSEMANTIC_USE_BOLD = 0b00000000000000000000000000000010,\n\tSEMANTIC_USE_UNDERLINE = 0b00000000000000000000000000000100,\n\tSEMANTIC_USE_FOREGROUND = 0b00000000000000000000000000001000,\n\tSEMANTIC_USE_BACKGROUND = 0b00000000000000000000000000010000,\n\n\tLANGUAGEID_OFFSET = 0,\n\tTOKEN_TYPE_OFFSET = 8,\n\tFONT_STYLE_OFFSET = 11,\n\tFOREGROUND_OFFSET = 14,\n\tBACKGROUND_OFFSET = 23\n}\n\n/**\n * @internal\n */\nexport class TokenMetadata {\n\n\tpublic static getLanguageId(metadata: number): LanguageId {\n\t\treturn (metadata & MetadataConsts.LANGUAGEID_MASK) >>> MetadataConsts.LANGUAGEID_OFFSET;\n\t}\n\n\tpublic static getTokenType(metadata: number): StandardTokenType {\n\t\treturn (metadata & MetadataConsts.TOKEN_TYPE_MASK) >>> MetadataConsts.TOKEN_TYPE_OFFSET;\n\t}\n\n\tpublic static getFontStyle(metadata: number): FontStyle {\n\t\treturn (metadata & MetadataConsts.FONT_STYLE_MASK) >>> MetadataConsts.FONT_STYLE_OFFSET;\n\t}\n\n\tpublic static getForeground(metadata: number): ColorId {\n\t\treturn (metadata & MetadataConsts.FOREGROUND_MASK) >>> MetadataConsts.FOREGROUND_OFFSET;\n\t}\n\n\tpublic static getBackground(metadata: number): ColorId {\n\t\treturn (metadata & MetadataConsts.BACKGROUND_MASK) >>> MetadataConsts.BACKGROUND_OFFSET;\n\t}\n\n\tpublic static getClassNameFromMetadata(metadata: number): string {\n\t\tlet foreground = this.getForeground(metadata);\n\t\tlet className = 'mtk' + foreground;\n\n\t\tlet fontStyle = this.getFontStyle(metadata);\n\t\tif (fontStyle & FontStyle.Italic) {\n\t\t\tclassName += ' mtki';\n\t\t}\n\t\tif (fontStyle & FontStyle.Bold) {\n\t\t\tclassName += ' mtkb';\n\t\t}\n\t\tif (fontStyle & FontStyle.Underline) {\n\t\t\tclassName += ' mtku';\n\t\t}\n\n\t\treturn className;\n\t}\n\n\tpublic static getInlineStyleFromMetadata(metadata: number, colorMap: string[]): string {\n\t\tconst foreground = this.getForeground(metadata);\n\t\tconst fontStyle = this.getFontStyle(metadata);\n\n\t\tlet result = `color: ${colorMap[foreground]};`;\n\t\tif (fontStyle & FontStyle.Italic) {\n\t\t\tresult += 'font-style: italic;';\n\t\t}\n\t\tif (fontStyle & FontStyle.Bold) {\n\t\t\tresult += 'font-weight: bold;';\n\t\t}\n\t\tif (fontStyle & FontStyle.Underline) {\n\t\t\tresult += 'text-decoration: underline;';\n\t\t}\n\t\treturn result;\n\t}\n}\n\n/**\n * @internal\n */\nexport interface ITokenizationSupport {\n\n\tgetInitialState(): IState;\n\n\t// add offsetDelta to each of the returned indices\n\ttokenize(line: string, hasEOL: boolean, state: IState, offsetDelta: number): TokenizationResult;\n\n\ttokenize2(line: string, hasEOL: boolean, state: IState, offsetDelta: number): TokenizationResult2;\n}\n\n/**\n * The state of the tokenizer between two lines.\n * It is useful to store flags such as in multiline comment, etc.\n * The model will clone the previous line's state and pass it in to tokenize the next line.\n */\nexport interface IState {\n\tclone(): IState;\n\tequals(other: IState): boolean;\n}\n\n/**\n * A provider result represents the values a provider, like the [`HoverProvider`](#HoverProvider),\n * may return. For once this is the actual result type `T`, like `Hover`, or a thenable that resolves\n * to that type `T`. In addition, `null` and `undefined` can be returned - either directly or from a\n * thenable.\n */\nexport type ProviderResult<T> = T | undefined | null | Thenable<T | undefined | null>;\n\n/**\n * A hover represents additional information for a symbol or word. Hovers are\n * rendered in a tooltip-like widget.\n */\nexport interface Hover {\n\t/**\n\t * The contents of this hover.\n\t */\n\tcontents: IMarkdownString[];\n\n\t/**\n\t * The range to which this hover applies. When missing, the\n\t * editor will use the range at the current position or the\n\t * current position itself.\n\t */\n\trange?: IRange;\n}\n\n/**\n * The hover provider interface defines the contract between extensions and\n * the [hover](https://code.visualstudio.com/docs/editor/intellisense)-feature.\n */\nexport interface HoverProvider {\n\t/**\n\t * Provide a hover for the given position and document. Multiple hovers at the same\n\t * position will be merged by the editor. A hover can have a range which defaults\n\t * to the word range at the position when omitted.\n\t */\n\tprovideHover(model: model.ITextModel, position: Position, token: CancellationToken): ProviderResult<Hover>;\n}\n\n/**\n * An evaluatable expression represents additional information for an expression in a document. Evaluatable expression are\n * evaluated by a debugger or runtime and their result is rendered in a tooltip-like widget.\n * @internal\n */\nexport interface EvaluatableExpression {\n\t/**\n\t * The range to which this expression applies.\n\t */\n\trange: IRange;\n\t/*\n\t * This expression overrides the expression extracted from the range.\n\t */\n\texpression?: string;\n}\n\n/**\n * The hover provider interface defines the contract between extensions and\n * the [hover](https://code.visualstudio.com/docs/editor/intellisense)-feature.\n * @internal\n */\nexport interface EvaluatableExpressionProvider {\n\t/**\n\t * Provide a hover for the given position and document. Multiple hovers at the same\n\t * position will be merged by the editor. A hover can have a range which defaults\n\t * to the word range at the position when omitted.\n\t */\n\tprovideEvaluatableExpression(model: model.ITextModel, position: Position, token: CancellationToken): ProviderResult<EvaluatableExpression>;\n}\n\nexport const enum CompletionItemKind {\n\tMethod,\n\tFunction,\n\tConstructor,\n\tField,\n\tVariable,\n\tClass,\n\tStruct,\n\tInterface,\n\tModule,\n\tProperty,\n\tEvent,\n\tOperator,\n\tUnit,\n\tValue,\n\tConstant,\n\tEnum,\n\tEnumMember,\n\tKeyword,\n\tText,\n\tColor,\n\tFile,\n\tReference,\n\tCustomcolor,\n\tFolder,\n\tTypeParameter,\n\tUser,\n\tIssue,\n\tSnippet, // <- highest value (used for compare!)\n}\n\n/**\n * @internal\n */\nexport const completionKindToCssClass = (function () {\n\tlet data = Object.create(null);\n\tdata[CompletionItemKind.Method] = 'symbol-method';\n\tdata[CompletionItemKind.Function] = 'symbol-function';\n\tdata[CompletionItemKind.Constructor] = 'symbol-constructor';\n\tdata[CompletionItemKind.Field] = 'symbol-field';\n\tdata[CompletionItemKind.Variable] = 'symbol-variable';\n\tdata[CompletionItemKind.Class] = 'symbol-class';\n\tdata[CompletionItemKind.Struct] = 'symbol-struct';\n\tdata[CompletionItemKind.Interface] = 'symbol-interface';\n\tdata[CompletionItemKind.Module] = 'symbol-module';\n\tdata[CompletionItemKind.Property] = 'symbol-property';\n\tdata[CompletionItemKind.Event] = 'symbol-event';\n\tdata[CompletionItemKind.Operator] = 'symbol-operator';\n\tdata[CompletionItemKind.Unit] = 'symbol-unit';\n\tdata[CompletionItemKind.Value] = 'symbol-value';\n\tdata[CompletionItemKind.Constant] = 'symbol-constant';\n\tdata[CompletionItemKind.Enum] = 'symbol-enum';\n\tdata[CompletionItemKind.EnumMember] = 'symbol-enum-member';\n\tdata[CompletionItemKind.Keyword] = 'symbol-keyword';\n\tdata[CompletionItemKind.Snippet] = 'symbol-snippet';\n\tdata[CompletionItemKind.Text] = 'symbol-text';\n\tdata[CompletionItemKind.Color] = 'symbol-color';\n\tdata[CompletionItemKind.File] = 'symbol-file';\n\tdata[CompletionItemKind.Reference] = 'symbol-reference';\n\tdata[CompletionItemKind.Customcolor] = 'symbol-customcolor';\n\tdata[CompletionItemKind.Folder] = 'symbol-folder';\n\tdata[CompletionItemKind.TypeParameter] = 'symbol-type-parameter';\n\tdata[CompletionItemKind.User] = 'account';\n\tdata[CompletionItemKind.Issue] = 'issues';\n\n\treturn function (kind: CompletionItemKind): string {\n\t\tconst name = data[kind];\n\t\tlet codicon = name && iconRegistry.get(name);\n\t\tif (!codicon) {\n\t\t\tconsole.info('No codicon found for CompletionItemKind ' + kind);\n\t\t\tcodicon = Codicon.symbolProperty;\n\t\t}\n\t\treturn codicon.classNames;\n\t};\n})();\n\n/**\n * @internal\n */\nexport let completionKindFromString: {\n\t(value: string): CompletionItemKind;\n\t(value: string, strict: true): CompletionItemKind | undefined;\n} = (function () {\n\tlet data: Record<string, CompletionItemKind> = Object.create(null);\n\tdata['method'] = CompletionItemKind.Method;\n\tdata['function'] = CompletionItemKind.Function;\n\tdata['constructor'] = <any>CompletionItemKind.Constructor;\n\tdata['field'] = CompletionItemKind.Field;\n\tdata['variable'] = CompletionItemKind.Variable;\n\tdata['class'] = CompletionItemKind.Class;\n\tdata['struct'] = CompletionItemKind.Struct;\n\tdata['interface'] = CompletionItemKind.Interface;\n\tdata['module'] = CompletionItemKind.Module;\n\tdata['property'] = CompletionItemKind.Property;\n\tdata['event'] = CompletionItemKind.Event;\n\tdata['operator'] = CompletionItemKind.Operator;\n\tdata['unit'] = CompletionItemKind.Unit;\n\tdata['value'] = CompletionItemKind.Value;\n\tdata['constant'] = CompletionItemKind.Constant;\n\tdata['enum'] = CompletionItemKind.Enum;\n\tdata['enum-member'] = CompletionItemKind.EnumMember;\n\tdata['enumMember'] = CompletionItemKind.EnumMember;\n\tdata['keyword'] = CompletionItemKind.Keyword;\n\tdata['snippet'] = CompletionItemKind.Snippet;\n\tdata['text'] = CompletionItemKind.Text;\n\tdata['color'] = CompletionItemKind.Color;\n\tdata['file'] = CompletionItemKind.File;\n\tdata['reference'] = CompletionItemKind.Reference;\n\tdata['customcolor'] = CompletionItemKind.Customcolor;\n\tdata['folder'] = CompletionItemKind.Folder;\n\tdata['type-parameter'] = CompletionItemKind.TypeParameter;\n\tdata['typeParameter'] = CompletionItemKind.TypeParameter;\n\tdata['account'] = CompletionItemKind.User;\n\tdata['issue'] = CompletionItemKind.Issue;\n\treturn function (value: string, strict?: true) {\n\t\tlet res = data[value];\n\t\tif (typeof res === 'undefined' && !strict) {\n\t\t\tres = CompletionItemKind.Property;\n\t\t}\n\t\treturn res;\n\t};\n})();\n\nexport interface CompletionItemLabel {\n\t/**\n\t * The function or variable. Rendered leftmost.\n\t */\n\tname: string;\n\n\t/**\n\t * The parameters without the return type. Render after `name`.\n\t */\n\tparameters?: string;\n\n\t/**\n\t * The fully qualified name, like package name or file path. Rendered after `signature`.\n\t */\n\tqualifier?: string;\n\n\t/**\n\t * The return-type of a function or type of a property/variable. Rendered rightmost.\n\t */\n\ttype?: string;\n}\n\nexport const enum CompletionItemTag {\n\tDeprecated = 1\n}\n\nexport const enum CompletionItemInsertTextRule {\n\t/**\n\t * Adjust whitespace/indentation of multiline insert texts to\n\t * match the current line indentation.\n\t */\n\tKeepWhitespace = 0b001,\n\n\t/**\n\t * `insertText` is a snippet.\n\t */\n\tInsertAsSnippet = 0b100,\n}\n\n/**\n * A completion item represents a text snippet that is\n * proposed to complete text that is being typed.\n */\nexport interface CompletionItem {\n\t/**\n\t * The label of this completion item. By default\n\t * this is also the text that is inserted when selecting\n\t * this completion.\n\t */\n\tlabel: string | CompletionItemLabel;\n\t/**\n\t * The kind of this completion item. Based on the kind\n\t * an icon is chosen by the editor.\n\t */\n\tkind: CompletionItemKind;\n\t/**\n\t * A modifier to the `kind` which affect how the item\n\t * is rendered, e.g. Deprecated is rendered with a strikeout\n\t */\n\ttags?: ReadonlyArray<CompletionItemTag>;\n\t/**\n\t * A human-readable string with additional information\n\t * about this item, like type or symbol information.\n\t */\n\tdetail?: string;\n\t/**\n\t * A human-readable string that represents a doc-comment.\n\t */\n\tdocumentation?: string | IMarkdownString;\n\t/**\n\t * A string that should be used when comparing this item\n\t * with other items. When `falsy` the [label](#CompletionItem.label)\n\t * is used.\n\t */\n\tsortText?: string;\n\t/**\n\t * A string that should be used when filtering a set of\n\t * completion items. When `falsy` the [label](#CompletionItem.label)\n\t * is used.\n\t */\n\tfilterText?: string;\n\t/**\n\t * Select this item when showing. *Note* that only one completion item can be selected and\n\t * that the editor decides which item that is. The rule is that the *first* item of those\n\t * that match best is selected.\n\t */\n\tpreselect?: boolean;\n\t/**\n\t * A string or snippet that should be inserted in a document when selecting\n\t * this completion.\n\t * is used.\n\t */\n\tinsertText: string;\n\t/**\n\t * Addition rules (as bitmask) that should be applied when inserting\n\t * this completion.\n\t */\n\tinsertTextRules?: CompletionItemInsertTextRule;\n\t/**\n\t * A range of text that should be replaced by this completion item.\n\t *\n\t * Defaults to a range from the start of the [current word](#TextDocument.getWordRangeAtPosition) to the\n\t * current position.\n\t *\n\t * *Note:* The range must be a [single line](#Range.isSingleLine) and it must\n\t * [contain](#Range.contains) the position at which completion has been [requested](#CompletionItemProvider.provideCompletionItems).\n\t */\n\trange: IRange | { insert: IRange, replace: IRange };\n\t/**\n\t * An optional set of characters that when pressed while this completion is active will accept it first and\n\t * then type that character. *Note* that all commit characters should have `length=1` and that superfluous\n\t * characters will be ignored.\n\t */\n\tcommitCharacters?: string[];\n\t/**\n\t * An optional array of additional text edits that are applied when\n\t * selecting this completion. Edits must not overlap with the main edit\n\t * nor with themselves.\n\t */\n\tadditionalTextEdits?: model.ISingleEditOperation[];\n\t/**\n\t * A command that should be run upon acceptance of this item.\n\t */\n\tcommand?: Command;\n\n\t/**\n\t * @internal\n\t */\n\t_id?: [number, number];\n}\n\nexport interface CompletionList {\n\tsuggestions: CompletionItem[];\n\tincomplete?: boolean;\n\tdispose?(): void;\n\n\t/**\n\t * @internal\n\t */\n\tduration?: number;\n}\n\n/**\n * How a suggest provider was triggered.\n */\nexport const enum CompletionTriggerKind {\n\tInvoke = 0,\n\tTriggerCharacter = 1,\n\tTriggerForIncompleteCompletions = 2\n}\n/**\n * Contains additional information about the context in which\n * [completion provider](#CompletionItemProvider.provideCompletionItems) is triggered.\n */\nexport interface CompletionContext {\n\t/**\n\t * How the completion was triggered.\n\t */\n\ttriggerKind: CompletionTriggerKind;\n\t/**\n\t * Character that triggered the completion item provider.\n\t *\n\t * `undefined` if provider was not triggered by a character.\n\t */\n\ttriggerCharacter?: string;\n}\n/**\n * The completion item provider interface defines the contract between extensions and\n * the [IntelliSense](https://code.visualstudio.com/docs/editor/intellisense).\n *\n * When computing *complete* completion items is expensive, providers can optionally implement\n * the `resolveCompletionItem`-function. In that case it is enough to return completion\n * items with a [label](#CompletionItem.label) from the\n * [provideCompletionItems](#CompletionItemProvider.provideCompletionItems)-function. Subsequently,\n * when a completion item is shown in the UI and gains focus this provider is asked to resolve\n * the item, like adding [doc-comment](#CompletionItem.documentation) or [details](#CompletionItem.detail).\n */\nexport interface CompletionItemProvider {\n\n\t/**\n\t * @internal\n\t */\n\t_debugDisplayName?: string;\n\n\ttriggerCharacters?: string[];\n\t/**\n\t * Provide completion items for the given position and document.\n\t */\n\tprovideCompletionItems(model: model.ITextModel, position: Position, context: CompletionContext, token: CancellationToken): ProviderResult<CompletionList>;\n\n\t/**\n\t * Given a completion item fill in more data, like [doc-comment](#CompletionItem.documentation)\n\t * or [details](#CompletionItem.detail).\n\t *\n\t * The editor will only resolve a completion item once.\n\t */\n\tresolveCompletionItem?(item: CompletionItem, token: CancellationToken): ProviderResult<CompletionItem>;\n}\n\nexport interface CodeAction {\n\ttitle: string;\n\tcommand?: Command;\n\tedit?: WorkspaceEdit;\n\tdiagnostics?: IMarkerData[];\n\tkind?: string;\n\tisPreferred?: boolean;\n\tdisabled?: string;\n}\n\n/**\n * @internal\n */\nexport const enum CodeActionTriggerType {\n\tAuto = 1,\n\tManual = 2,\n}\n\n/**\n * @internal\n */\nexport interface CodeActionContext {\n\tonly?: string;\n\ttrigger: CodeActionTriggerType;\n}\n\nexport interface CodeActionList extends IDisposable {\n\treadonly actions: ReadonlyArray<CodeAction>;\n}\n\n/**\n * The code action interface defines the contract between extensions and\n * the [light bulb](https://code.visualstudio.com/docs/editor/editingevolved#_code-action) feature.\n * @internal\n */\nexport interface CodeActionProvider {\n\n\tdisplayName?: string\n\n\t/**\n\t * Provide commands for the given document and range.\n\t */\n\tprovideCodeActions(model: model.ITextModel, range: Range | Selection, context: CodeActionContext, token: CancellationToken): ProviderResult<CodeActionList>;\n\n\t/**\n\t * Given a code action fill in the edit. Will only invoked when missing.\n\t */\n\tresolveCodeAction?(codeAction: CodeAction, token: CancellationToken): ProviderResult<CodeAction>;\n\n\t/**\n\t * Optional list of CodeActionKinds that this provider returns.\n\t */\n\treadonly providedCodeActionKinds?: ReadonlyArray<string>;\n\n\treadonly documentation?: ReadonlyArray<{ readonly kind: string, readonly command: Command }>;\n\n\t/**\n\t * @internal\n\t */\n\t_getAdditionalMenuItems?(context: CodeActionContext, actions: readonly CodeAction[]): Command[];\n}\n\n/**\n * Represents a parameter of a callable-signature. A parameter can\n * have a label and a doc-comment.\n */\nexport interface ParameterInformation {\n\t/**\n\t * The label of this signature. Will be shown in\n\t * the UI.\n\t */\n\tlabel: string | [number, number];\n\t/**\n\t * The human-readable doc-comment of this signature. Will be shown\n\t * in the UI but can be omitted.\n\t */\n\tdocumentation?: string | IMarkdownString;\n}\n/**\n * Represents the signature of something callable. A signature\n * can have a label, like a function-name, a doc-comment, and\n * a set of parameters.\n */\nexport interface SignatureInformation {\n\t/**\n\t * The label of this signature. Will be shown in\n\t * the UI.\n\t */\n\tlabel: string;\n\t/**\n\t * The human-readable doc-comment of this signature. Will be shown\n\t * in the UI but can be omitted.\n\t */\n\tdocumentation?: string | IMarkdownString;\n\t/**\n\t * The parameters of this signature.\n\t */\n\tparameters: ParameterInformation[];\n\t/**\n\t * Index of the active parameter.\n\t *\n\t * If provided, this is used in place of `SignatureHelp.activeSignature`.\n\t */\n\tactiveParameter?: number;\n}\n/**\n * Signature help represents the signature of something\n * callable. There can be multiple signatures but only one\n * active and only one active parameter.\n */\nexport interface SignatureHelp {\n\t/**\n\t * One or more signatures.\n\t */\n\tsignatures: SignatureInformation[];\n\t/**\n\t * The active signature.\n\t */\n\tactiveSignature: number;\n\t/**\n\t * The active parameter of the active signature.\n\t */\n\tactiveParameter: number;\n}\n\nexport interface SignatureHelpResult extends IDisposable {\n\tvalue: SignatureHelp;\n}\n\nexport enum SignatureHelpTriggerKind {\n\tInvoke = 1,\n\tTriggerCharacter = 2,\n\tContentChange = 3,\n}\n\nexport interface SignatureHelpContext {\n\treadonly triggerKind: SignatureHelpTriggerKind;\n\treadonly triggerCharacter?: string;\n\treadonly isRetrigger: boolean;\n\treadonly activeSignatureHelp?: SignatureHelp;\n}\n\n/**\n * The signature help provider interface defines the contract between extensions and\n * the [parameter hints](https://code.visualstudio.com/docs/editor/intellisense)-feature.\n */\nexport interface SignatureHelpProvider {\n\n\treadonly signatureHelpTriggerCharacters?: ReadonlyArray<string>;\n\treadonly signatureHelpRetriggerCharacters?: ReadonlyArray<string>;\n\n\t/**\n\t * Provide help for the signature at the given position and document.\n\t */\n\tprovideSignatureHelp(model: model.ITextModel, position: Position, token: CancellationToken, context: SignatureHelpContext): ProviderResult<SignatureHelpResult>;\n}\n\n/**\n * A document highlight kind.\n */\nexport enum DocumentHighlightKind {\n\t/**\n\t * A textual occurrence.\n\t */\n\tText,\n\t/**\n\t * Read-access of a symbol, like reading a variable.\n\t */\n\tRead,\n\t/**\n\t * Write-access of a symbol, like writing to a variable.\n\t */\n\tWrite\n}\n/**\n * A document highlight is a range inside a text document which deserves\n * special attention. Usually a document highlight is visualized by changing\n * the background color of its range.\n */\nexport interface DocumentHighlight {\n\t/**\n\t * The range this highlight applies to.\n\t */\n\trange: IRange;\n\t/**\n\t * The highlight kind, default is [text](#DocumentHighlightKind.Text).\n\t */\n\tkind?: DocumentHighlightKind;\n}\n/**\n * The document highlight provider interface defines the contract between extensions and\n * the word-highlight-feature.\n */\nexport interface DocumentHighlightProvider {\n\t/**\n\t * Provide a set of document highlights, like all occurrences of a variable or\n\t * all exit-points of a function.\n\t */\n\tprovideDocumentHighlights(model: model.ITextModel, position: Position, token: CancellationToken): ProviderResult<DocumentHighlight[]>;\n}\n\n/**\n * The linked editing range provider interface defines the contract between extensions and\n * the linked editing feature.\n */\nexport interface LinkedEditingRangeProvider {\n\n\t/**\n\t * Provide a list of ranges that can be edited together.\n\t */\n\tprovideLinkedEditingRanges(model: model.ITextModel, position: Position, token: CancellationToken): ProviderResult<LinkedEditingRanges>;\n}\n\n/**\n * Represents a list of ranges that can be edited together along with a word pattern to describe valid contents.\n */\nexport interface LinkedEditingRanges {\n\t/**\n\t * A list of ranges that can be edited together. The ranges must have\n\t * identical length and text content. The ranges cannot overlap\n\t */\n\tranges: IRange[];\n\n\t/**\n\t * An optional word pattern that describes valid contents for the given ranges.\n\t * If no pattern is provided, the language configuration's word pattern will be used.\n\t */\n\twordPattern?: RegExp;\n}\n\n/**\n * Value-object that contains additional information when\n * requesting references.\n */\nexport interface ReferenceContext {\n\t/**\n\t * Include the declaration of the current symbol.\n\t */\n\tincludeDeclaration: boolean;\n}\n/**\n * The reference provider interface defines the contract between extensions and\n * the [find references](https://code.visualstudio.com/docs/editor/editingevolved#_peek)-feature.\n */\nexport interface ReferenceProvider {\n\t/**\n\t * Provide a set of project-wide references for the given position and document.\n\t */\n\tprovideReferences(model: model.ITextModel, position: Position, context: ReferenceContext, token: CancellationToken): ProviderResult<Location[]>;\n}\n\n/**\n * Represents a location inside a resource, such as a line\n * inside a text file.\n */\nexport interface Location {\n\t/**\n\t * The resource identifier of this location.\n\t */\n\turi: URI;\n\t/**\n\t * The document range of this locations.\n\t */\n\trange: IRange;\n}\n\nexport interface LocationLink {\n\t/**\n\t * A range to select where this link originates from.\n\t */\n\toriginSelectionRange?: IRange;\n\n\t/**\n\t * The target uri this link points to.\n\t */\n\turi: URI;\n\n\t/**\n\t * The full range this link points to.\n\t */\n\trange: IRange;\n\n\t/**\n\t * A range to select this link points to. Must be contained\n\t * in `LocationLink.range`.\n\t */\n\ttargetSelectionRange?: IRange;\n}\n\n/**\n * @internal\n */\nexport function isLocationLink(thing: any): thing is LocationLink {\n\treturn thing\n\t\t&& URI.isUri((thing as LocationLink).uri)\n\t\t&& Range.isIRange((thing as LocationLink).range)\n\t\t&& (Range.isIRange((thing as LocationLink).originSelectionRange) || Range.isIRange((thing as LocationLink).targetSelectionRange));\n}\n\nexport type Definition = Location | Location[] | LocationLink[];\n\n/**\n * The definition provider interface defines the contract between extensions and\n * the [go to definition](https://code.visualstudio.com/docs/editor/editingevolved#_go-to-definition)\n * and peek definition features.\n */\nexport interface DefinitionProvider {\n\t/**\n\t * Provide the definition of the symbol at the given position and document.\n\t */\n\tprovideDefinition(model: model.ITextModel, position: Position, token: CancellationToken): ProviderResult<Definition | LocationLink[]>;\n}\n\n/**\n * The definition provider interface defines the contract between extensions and\n * the [go to definition](https://code.visualstudio.com/docs/editor/editingevolved#_go-to-definition)\n * and peek definition features.\n */\nexport interface DeclarationProvider {\n\t/**\n\t * Provide the declaration of the symbol at the given position and document.\n\t */\n\tprovideDeclaration(model: model.ITextModel, position: Position, token: CancellationToken): ProviderResult<Definition | LocationLink[]>;\n}\n\n/**\n * The implementation provider interface defines the contract between extensions and\n * the go to implementation feature.\n */\nexport interface ImplementationProvider {\n\t/**\n\t * Provide the implementation of the symbol at the given position and document.\n\t */\n\tprovideImplementation(model: model.ITextModel, position: Position, token: CancellationToken): ProviderResult<Definition | LocationLink[]>;\n}\n\n/**\n * The type definition provider interface defines the contract between extensions and\n * the go to type definition feature.\n */\nexport interface TypeDefinitionProvider {\n\t/**\n\t * Provide the type definition of the symbol at the given position and document.\n\t */\n\tprovideTypeDefinition(model: model.ITextModel, position: Position, token: CancellationToken): ProviderResult<Definition | LocationLink[]>;\n}\n\n/**\n * A symbol kind.\n */\nexport const enum SymbolKind {\n\tFile = 0,\n\tModule = 1,\n\tNamespace = 2,\n\tPackage = 3,\n\tClass = 4,\n\tMethod = 5,\n\tProperty = 6,\n\tField = 7,\n\tConstructor = 8,\n\tEnum = 9,\n\tInterface = 10,\n\tFunction = 11,\n\tVariable = 12,\n\tConstant = 13,\n\tString = 14,\n\tNumber = 15,\n\tBoolean = 16,\n\tArray = 17,\n\tObject = 18,\n\tKey = 19,\n\tNull = 20,\n\tEnumMember = 21,\n\tStruct = 22,\n\tEvent = 23,\n\tOperator = 24,\n\tTypeParameter = 25\n}\n\nexport const enum SymbolTag {\n\tDeprecated = 1,\n}\n\n/**\n * @internal\n */\nexport namespace SymbolKinds {\n\n\tconst byName = new Map<string, SymbolKind>();\n\tbyName.set('file', SymbolKind.File);\n\tbyName.set('module', SymbolKind.Module);\n\tbyName.set('namespace', SymbolKind.Namespace);\n\tbyName.set('package', SymbolKind.Package);\n\tbyName.set('class', SymbolKind.Class);\n\tbyName.set('method', SymbolKind.Method);\n\tbyName.set('property', SymbolKind.Property);\n\tbyName.set('field', SymbolKind.Field);\n\tbyName.set('constructor', SymbolKind.Constructor);\n\tbyName.set('enum', SymbolKind.Enum);\n\tbyName.set('interface', SymbolKind.Interface);\n\tbyName.set('function', SymbolKind.Function);\n\tbyName.set('variable', SymbolKind.Variable);\n\tbyName.set('constant', SymbolKind.Constant);\n\tbyName.set('string', SymbolKind.String);\n\tbyName.set('number', SymbolKind.Number);\n\tbyName.set('boolean', SymbolKind.Boolean);\n\tbyName.set('array', SymbolKind.Array);\n\tbyName.set('object', SymbolKind.Object);\n\tbyName.set('key', SymbolKind.Key);\n\tbyName.set('null', SymbolKind.Null);\n\tbyName.set('enum-member', SymbolKind.EnumMember);\n\tbyName.set('struct', SymbolKind.Struct);\n\tbyName.set('event', SymbolKind.Event);\n\tbyName.set('operator', SymbolKind.Operator);\n\tbyName.set('type-parameter', SymbolKind.TypeParameter);\n\n\tconst byKind = new Map<SymbolKind, string>();\n\tbyKind.set(SymbolKind.File, 'file');\n\tbyKind.set(SymbolKind.Module, 'module');\n\tbyKind.set(SymbolKind.Namespace, 'namespace');\n\tbyKind.set(SymbolKind.Package, 'package');\n\tbyKind.set(SymbolKind.Class, 'class');\n\tbyKind.set(SymbolKind.Method, 'method');\n\tbyKind.set(SymbolKind.Property, 'property');\n\tbyKind.set(SymbolKind.Field, 'field');\n\tbyKind.set(SymbolKind.Constructor, 'constructor');\n\tbyKind.set(SymbolKind.Enum, 'enum');\n\tbyKind.set(SymbolKind.Interface, 'interface');\n\tbyKind.set(SymbolKind.Function, 'function');\n\tbyKind.set(SymbolKind.Variable, 'variable');\n\tbyKind.set(SymbolKind.Constant, 'constant');\n\tbyKind.set(SymbolKind.String, 'string');\n\tbyKind.set(SymbolKind.Number, 'number');\n\tbyKind.set(SymbolKind.Boolean, 'boolean');\n\tbyKind.set(SymbolKind.Array, 'array');\n\tbyKind.set(SymbolKind.Object, 'object');\n\tbyKind.set(SymbolKind.Key, 'key');\n\tbyKind.set(SymbolKind.Null, 'null');\n\tbyKind.set(SymbolKind.EnumMember, 'enum-member');\n\tbyKind.set(SymbolKind.Struct, 'struct');\n\tbyKind.set(SymbolKind.Event, 'event');\n\tbyKind.set(SymbolKind.Operator, 'operator');\n\tbyKind.set(SymbolKind.TypeParameter, 'type-parameter');\n\t/**\n\t * @internal\n\t */\n\texport function fromString(value: string): SymbolKind | undefined {\n\t\treturn byName.get(value);\n\t}\n\t/**\n\t * @internal\n\t */\n\texport function toString(kind: SymbolKind): string | undefined {\n\t\treturn byKind.get(kind);\n\t}\n\t/**\n\t * @internal\n\t */\n\texport function toCssClassName(kind: SymbolKind, inline?: boolean): string {\n\t\tconst symbolName = byKind.get(kind);\n\t\tlet codicon = symbolName && iconRegistry.get('symbol-' + symbolName);\n\t\tif (!codicon) {\n\t\t\tconsole.info('No codicon found for SymbolKind ' + kind);\n\t\t\tcodicon = Codicon.symbolProperty;\n\t\t}\n\t\treturn `${inline ? 'inline' : 'block'} ${codicon.classNames}`;\n\t}\n}\n\nexport interface DocumentSymbol {\n\tname: string;\n\tdetail: string;\n\tkind: SymbolKind;\n\ttags: ReadonlyArray<SymbolTag>;\n\tcontainerName?: string;\n\trange: IRange;\n\tselectionRange: IRange;\n\tchildren?: DocumentSymbol[];\n}\n\n/**\n * The document symbol provider interface defines the contract between extensions and\n * the [go to symbol](https://code.visualstudio.com/docs/editor/editingevolved#_go-to-symbol)-feature.\n */\nexport interface DocumentSymbolProvider {\n\n\tdisplayName?: string;\n\n\t/**\n\t * Provide symbol information for the given document.\n\t */\n\tprovideDocumentSymbols(model: model.ITextModel, token: CancellationToken): ProviderResult<DocumentSymbol[]>;\n}\n\nexport type TextEdit = { range: IRange; text: string; eol?: model.EndOfLineSequence; };\n\n/**\n * Interface used to format a model\n */\nexport interface FormattingOptions {\n\t/**\n\t * Size of a tab in spaces.\n\t */\n\ttabSize: number;\n\t/**\n\t * Prefer spaces over tabs.\n\t */\n\tinsertSpaces: boolean;\n}\n/**\n * The document formatting provider interface defines the contract between extensions and\n * the formatting-feature.\n */\nexport interface DocumentFormattingEditProvider {\n\n\t/**\n\t * @internal\n\t */\n\treadonly extensionId?: ExtensionIdentifier;\n\n\treadonly displayName?: string;\n\n\t/**\n\t * Provide formatting edits for a whole document.\n\t */\n\tprovideDocumentFormattingEdits(model: model.ITextModel, options: FormattingOptions, token: CancellationToken): ProviderResult<TextEdit[]>;\n}\n/**\n * The document formatting provider interface defines the contract between extensions and\n * the formatting-feature.\n */\nexport interface DocumentRangeFormattingEditProvider {\n\t/**\n\t * @internal\n\t */\n\treadonly extensionId?: ExtensionIdentifier;\n\n\treadonly displayName?: string;\n\n\t/**\n\t * Provide formatting edits for a range in a document.\n\t *\n\t * The given range is a hint and providers can decide to format a smaller\n\t * or larger range. Often this is done by adjusting the start and end\n\t * of the range to full syntax nodes.\n\t */\n\tprovideDocumentRangeFormattingEdits(model: model.ITextModel, range: Range, options: FormattingOptions, token: CancellationToken): ProviderResult<TextEdit[]>;\n}\n/**\n * The document formatting provider interface defines the contract between extensions and\n * the formatting-feature.\n */\nexport interface OnTypeFormattingEditProvider {\n\n\n\t/**\n\t * @internal\n\t */\n\treadonly extensionId?: ExtensionIdentifier;\n\n\tautoFormatTriggerCharacters: string[];\n\n\t/**\n\t * Provide formatting edits after a character has been typed.\n\t *\n\t * The given position and character should hint to the provider\n\t * what range the position to expand to, like find the matching `{`\n\t * when `}` has been entered.\n\t */\n\tprovideOnTypeFormattingEdits(model: model.ITextModel, position: Position, ch: string, options: FormattingOptions, token: CancellationToken): ProviderResult<TextEdit[]>;\n}\n\n/**\n * @internal\n */\nexport interface IInplaceReplaceSupportResult {\n\tvalue: string;\n\trange: IRange;\n}\n\n/**\n * A link inside the editor.\n */\nexport interface ILink {\n\trange: IRange;\n\turl?: URI | string;\n\ttooltip?: string;\n}\n\nexport interface ILinksList {\n\tlinks: ILink[];\n\tdispose?(): void;\n}\n/**\n * A provider of links.\n */\nexport interface LinkProvider {\n\tprovideLinks(model: model.ITextModel, token: CancellationToken): ProviderResult<ILinksList>;\n\tresolveLink?: (link: ILink, token: CancellationToken) => ProviderResult<ILink>;\n}\n\n/**\n * A color in RGBA format.\n */\nexport interface IColor {\n\n\t/**\n\t * The red component in the range [0-1].\n\t */\n\treadonly red: number;\n\n\t/**\n\t * The green component in the range [0-1].\n\t */\n\treadonly green: number;\n\n\t/**\n\t * The blue component in the range [0-1].\n\t */\n\treadonly blue: number;\n\n\t/**\n\t * The alpha component in the range [0-1].\n\t */\n\treadonly alpha: number;\n}\n\n/**\n * String representations for a color\n */\nexport interface IColorPresentation {\n\t/**\n\t * The label of this color presentation. It will be shown on the color\n\t * picker header. By default this is also the text that is inserted when selecting\n\t * this color presentation.\n\t */\n\tlabel: string;\n\t/**\n\t * An [edit](#TextEdit) which is applied to a document when selecting\n\t * this presentation for the color.\n\t */\n\ttextEdit?: TextEdit;\n\t/**\n\t * An optional array of additional [text edits](#TextEdit) that are applied when\n\t * selecting this color presentation.\n\t */\n\tadditionalTextEdits?: TextEdit[];\n}\n\n/**\n * A color range is a range in a text model which represents a color.\n */\nexport interface IColorInformation {\n\n\t/**\n\t * The range within the model.\n\t */\n\trange: IRange;\n\n\t/**\n\t * The color represented in this range.\n\t */\n\tcolor: IColor;\n}\n\n/**\n * A provider of colors for editor models.\n */\nexport interface DocumentColorProvider {\n\t/**\n\t * Provides the color ranges for a specific model.\n\t */\n\tprovideDocumentColors(model: model.ITextModel, token: CancellationToken): ProviderResult<IColorInformation[]>;\n\t/**\n\t * Provide the string representations for a color.\n\t */\n\tprovideColorPresentations(model: model.ITextModel, colorInfo: IColorInformation, token: CancellationToken): ProviderResult<IColorPresentation[]>;\n}\n\nexport interface SelectionRange {\n\trange: IRange;\n}\n\nexport interface SelectionRangeProvider {\n\t/**\n\t * Provide ranges that should be selected from the given position.\n\t */\n\tprovideSelectionRanges(model: model.ITextModel, positions: Position[], token: CancellationToken): ProviderResult<SelectionRange[][]>;\n}\n\nexport interface FoldingContext {\n}\n/**\n * A provider of folding ranges for editor models.\n */\nexport interface FoldingRangeProvider {\n\n\t/**\n\t * An optional event to signal that the folding ranges from this provider have changed.\n\t */\n\tonDidChange?: Event<this>;\n\n\t/**\n\t * Provides the folding ranges for a specific model.\n\t */\n\tprovideFoldingRanges(model: model.ITextModel, context: FoldingContext, token: CancellationToken): ProviderResult<FoldingRange[]>;\n}\n\nexport interface FoldingRange {\n\n\t/**\n\t * The one-based start line of the range to fold. The folded area starts after the line's last character.\n\t */\n\tstart: number;\n\n\t/**\n\t * The one-based end line of the range to fold. The folded area ends with the line's last character.\n\t */\n\tend: number;\n\n\t/**\n\t * Describes the [Kind](#FoldingRangeKind) of the folding range such as [Comment](#FoldingRangeKind.Comment) or\n\t * [Region](#FoldingRangeKind.Region). The kind is used to categorize folding ranges and used by commands\n\t * like 'Fold all comments'. See\n\t * [FoldingRangeKind](#FoldingRangeKind) for an enumeration of standardized kinds.\n\t */\n\tkind?: FoldingRangeKind;\n}\nexport class FoldingRangeKind {\n\t/**\n\t * Kind for folding range representing a comment. The value of the kind is 'comment'.\n\t */\n\tstatic readonly Comment = new FoldingRangeKind('comment');\n\t/**\n\t * Kind for folding range representing a import. The value of the kind is 'imports'.\n\t */\n\tstatic readonly Imports = new FoldingRangeKind('imports');\n\t/**\n\t * Kind for folding range representing regions (for example marked by `#region`, `#endregion`).\n\t * The value of the kind is 'region'.\n\t */\n\tstatic readonly Region = new FoldingRangeKind('region');\n\n\t/**\n\t * Creates a new [FoldingRangeKind](#FoldingRangeKind).\n\t *\n\t * @param value of the kind.\n\t */\n\tpublic constructor(public value: string) {\n\t}\n}\n\n\nexport interface WorkspaceEditMetadata {\n\tneedsConfirmation: boolean;\n\tlabel: string;\n\tdescription?: string;\n\t/**\n\t * @internal\n\t */\n\ticonPath?: ThemeIcon | URI | { light: URI, dark: URI };\n}\n\nexport interface WorkspaceFileEditOptions {\n\toverwrite?: boolean;\n\tignoreIfNotExists?: boolean;\n\tignoreIfExists?: boolean;\n\trecursive?: boolean;\n\tcopy?: boolean;\n\tfolder?: boolean;\n\tskipTrashBin?: boolean;\n\tmaxSize?: number;\n}\n\nexport interface WorkspaceFileEdit {\n\toldUri?: URI;\n\tnewUri?: URI;\n\toptions?: WorkspaceFileEditOptions;\n\tmetadata?: WorkspaceEditMetadata;\n}\n\nexport interface WorkspaceTextEdit {\n\tresource: URI;\n\tedit: TextEdit;\n\tmodelVersionId?: number;\n\tmetadata?: WorkspaceEditMetadata;\n}\n\nexport interface WorkspaceEdit {\n\tedits: Array<WorkspaceTextEdit | WorkspaceFileEdit>;\n}\n\nexport interface Rejection {\n\trejectReason?: string;\n}\nexport interface RenameLocation {\n\trange: IRange;\n\ttext: string;\n}\n\nexport interface RenameProvider {\n\tprovideRenameEdits(model: model.ITextModel, position: Position, newName: string, token: CancellationToken): ProviderResult<WorkspaceEdit & Rejection>;\n\tresolveRenameLocation?(model: model.ITextModel, position: Position, token: CancellationToken): ProviderResult<RenameLocation & Rejection>;\n}\n\n/**\n * @internal\n */\nexport interface AuthenticationSession {\n\tid: string;\n\taccessToken: string;\n\taccount: {\n\t\tlabel: string;\n\t\tid: string;\n\t}\n\tscopes: ReadonlyArray<string>;\n}\n\n/**\n * @internal\n */\nexport interface AuthenticationSessionsChangeEvent {\n\tadded: ReadonlyArray<string>;\n\tremoved: ReadonlyArray<string>;\n\tchanged: ReadonlyArray<string>;\n}\n\n/**\n * @internal\n */\nexport interface AuthenticationProviderInformation {\n\tid: string;\n\tlabel: string;\n}\n\nexport interface Command {\n\tid: string;\n\ttitle: string;\n\ttooltip?: string;\n\targuments?: any[];\n}\n\n/**\n * @internal\n */\nexport interface CommentThreadTemplate {\n\tcontrollerHandle: number;\n\tlabel: string;\n\tacceptInputCommand?: Command;\n\tadditionalCommands?: Command[];\n\tdeleteCommand?: Command;\n}\n\n/**\n * @internal\n */\nexport interface CommentInfo {\n\textensionId?: string;\n\tthreads: CommentThread[];\n\tcommentingRanges: CommentingRanges;\n}\n\n/**\n * @internal\n */\nexport enum CommentThreadCollapsibleState {\n\t/**\n\t * Determines an item is collapsed\n\t */\n\tCollapsed = 0,\n\t/**\n\t * Determines an item is expanded\n\t */\n\tExpanded = 1\n}\n\n\n\n/**\n * @internal\n */\nexport interface CommentWidget {\n\tcommentThread: CommentThread;\n\tcomment?: Comment;\n\tinput: string;\n\tonDidChangeInput: Event<string>;\n}\n\n/**\n * @internal\n */\nexport interface CommentInput {\n\tvalue: string;\n\turi: URI;\n}\n\n/**\n * @internal\n */\nexport interface CommentThread {\n\tcommentThreadHandle: number;\n\tcontrollerHandle: number;\n\textensionId?: string;\n\tthreadId: string;\n\tresource: string | null;\n\trange: IRange;\n\tlabel: string | undefined;\n\tcontextValue: string | undefined;\n\tcomments: Comment[] | undefined;\n\tonDidChangeComments: Event<Comment[] | undefined>;\n\tcollapsibleState?: CommentThreadCollapsibleState;\n\tcanReply: boolean;\n\tinput?: CommentInput;\n\tonDidChangeInput: Event<CommentInput | undefined>;\n\tonDidChangeRange: Event<IRange>;\n\tonDidChangeLabel: Event<string | undefined>;\n\tonDidChangeCollasibleState: Event<CommentThreadCollapsibleState | undefined>;\n\tonDidChangeCanReply: Event<boolean>;\n\tisDisposed: boolean;\n}\n\n/**\n * @internal\n */\n\nexport interface CommentingRanges {\n\treadonly resource: URI;\n\tranges: IRange[];\n}\n\n/**\n * @internal\n */\nexport interface CommentReaction {\n\treadonly label?: string;\n\treadonly iconPath?: UriComponents;\n\treadonly count?: number;\n\treadonly hasReacted?: boolean;\n\treadonly canEdit?: boolean;\n}\n\n/**\n * @internal\n */\nexport interface CommentOptions {\n\t/**\n\t * An optional string to show on the comment input box when it's collapsed.\n\t */\n\tprompt?: string;\n\n\t/**\n\t * An optional string to show as placeholder in the comment input box when it's focused.\n\t */\n\tplaceHolder?: string;\n}\n\n/**\n * @internal\n */\nexport enum CommentMode {\n\tEditing = 0,\n\tPreview = 1\n}\n\n/**\n * @internal\n */\nexport interface Comment {\n\treadonly uniqueIdInThread: number;\n\treadonly body: IMarkdownString;\n\treadonly userName: string;\n\treadonly userIconPath?: string;\n\treadonly contextValue?: string;\n\treadonly commentReactions?: CommentReaction[];\n\treadonly label?: string;\n\treadonly mode?: CommentMode;\n}\n\n/**\n * @internal\n */\nexport interface CommentThreadChangedEvent {\n\t/**\n\t * Added comment threads.\n\t */\n\treadonly added: CommentThread[];\n\n\t/**\n\t * Removed comment threads.\n\t */\n\treadonly removed: CommentThread[];\n\n\t/**\n\t * Changed comment threads.\n\t */\n\treadonly changed: CommentThread[];\n}\n\n/**\n * @internal\n */\nexport interface IWebviewPortMapping {\n\twebviewPort: number;\n\textensionHostPort: number;\n}\n\n/**\n * @internal\n */\nexport interface IWebviewOptions {\n\treadonly enableScripts?: boolean;\n\treadonly enableCommandUris?: boolean;\n\treadonly localResourceRoots?: ReadonlyArray<UriComponents>;\n\treadonly portMapping?: ReadonlyArray<IWebviewPortMapping>;\n}\n\n/**\n * @internal\n */\nexport interface IWebviewPanelOptions {\n\treadonly enableFindWidget?: boolean;\n\treadonly retainContextWhenHidden?: boolean;\n}\n\n\nexport interface CodeLens {\n\trange: IRange;\n\tid?: string;\n\tcommand?: Command;\n}\n\nexport interface CodeLensList {\n\tlenses: CodeLens[];\n\tdispose(): void;\n}\n\nexport interface CodeLensProvider {\n\tonDidChange?: Event<this>;\n\tprovideCodeLenses(model: model.ITextModel, token: CancellationToken): ProviderResult<CodeLensList>;\n\tresolveCodeLens?(model: model.ITextModel, codeLens: CodeLens, token: CancellationToken): ProviderResult<CodeLens>;\n}\n\nexport interface InlineHint {\n\ttext: string;\n\trange: IRange;\n\tdescription?: string | IMarkdownString;\n\twhitespaceBefore?: boolean;\n\twhitespaceAfter?: boolean;\n}\n\nexport interface InlineHintsProvider {\n\tonDidChangeInlineHints?: Event<void> | undefined;\n\tprovideInlineHints(model: model.ITextModel, range: Range, token: CancellationToken): ProviderResult<InlineHint[]>;\n}\n\nexport interface SemanticTokensLegend {\n\treadonly tokenTypes: string[];\n\treadonly tokenModifiers: string[];\n}\n\nexport interface SemanticTokens {\n\treadonly resultId?: string;\n\treadonly data: Uint32Array;\n}\n\nexport interface SemanticTokensEdit {\n\treadonly start: number;\n\treadonly deleteCount: number;\n\treadonly data?: Uint32Array;\n}\n\nexport interface SemanticTokensEdits {\n\treadonly resultId?: string;\n\treadonly edits: SemanticTokensEdit[];\n}\n\nexport interface DocumentSemanticTokensProvider {\n\tonDidChange?: Event<void>;\n\tgetLegend(): SemanticTokensLegend;\n\tprovideDocumentSemanticTokens(model: model.ITextModel, lastResultId: string | null, token: CancellationToken): ProviderResult<SemanticTokens | SemanticTokensEdits>;\n\treleaseDocumentSemanticTokens(resultId: string | undefined): void;\n}\n\nexport interface DocumentRangeSemanticTokensProvider {\n\tgetLegend(): SemanticTokensLegend;\n\tprovideDocumentRangeSemanticTokens(model: model.ITextModel, range: Range, token: CancellationToken): ProviderResult<SemanticTokens>;\n}\n\n// --- feature registries ------\n\n/**\n * @internal\n */\nexport const ReferenceProviderRegistry = new LanguageFeatureRegistry<ReferenceProvider>();\n\n/**\n * @internal\n */\nexport const RenameProviderRegistry = new LanguageFeatureRegistry<RenameProvider>();\n\n/**\n * @internal\n */\nexport const CompletionProviderRegistry = new LanguageFeatureRegistry<CompletionItemProvider>();\n\n/**\n * @internal\n */\nexport const SignatureHelpProviderRegistry = new LanguageFeatureRegistry<SignatureHelpProvider>();\n\n/**\n * @internal\n */\nexport const HoverProviderRegistry = new LanguageFeatureRegistry<HoverProvider>();\n\n/**\n * @internal\n */\nexport const EvaluatableExpressionProviderRegistry = new LanguageFeatureRegistry<EvaluatableExpressionProvider>();\n\n/**\n * @internal\n */\nexport const DocumentSymbolProviderRegistry = new LanguageFeatureRegistry<DocumentSymbolProvider>();\n\n/**\n * @internal\n */\nexport const DocumentHighlightProviderRegistry = new LanguageFeatureRegistry<DocumentHighlightProvider>();\n\n/**\n * @internal\n */\nexport const LinkedEditingRangeProviderRegistry = new LanguageFeatureRegistry<LinkedEditingRangeProvider>();\n\n/**\n * @internal\n */\nexport const DefinitionProviderRegistry = new LanguageFeatureRegistry<DefinitionProvider>();\n\n/**\n * @internal\n */\nexport const DeclarationProviderRegistry = new LanguageFeatureRegistry<DeclarationProvider>();\n\n/**\n * @internal\n */\nexport const ImplementationProviderRegistry = new LanguageFeatureRegistry<ImplementationProvider>();\n\n/**\n * @internal\n */\nexport const TypeDefinitionProviderRegistry = new LanguageFeatureRegistry<TypeDefinitionProvider>();\n\n/**\n * @internal\n */\nexport const CodeLensProviderRegistry = new LanguageFeatureRegistry<CodeLensProvider>();\n\n/**\n * @internal\n */\nexport const InlineHintsProviderRegistry = new LanguageFeatureRegistry<InlineHintsProvider>();\n\n/**\n * @internal\n */\nexport const CodeActionProviderRegistry = new LanguageFeatureRegistry<CodeActionProvider>();\n\n/**\n * @internal\n */\nexport const DocumentFormattingEditProviderRegistry = new LanguageFeatureRegistry<DocumentFormattingEditProvider>();\n\n/**\n * @internal\n */\nexport const DocumentRangeFormattingEditProviderRegistry = new LanguageFeatureRegistry<DocumentRangeFormattingEditProvider>();\n\n/**\n * @internal\n */\nexport const OnTypeFormattingEditProviderRegistry = new LanguageFeatureRegistry<OnTypeFormattingEditProvider>();\n\n/**\n * @internal\n */\nexport const LinkProviderRegistry = new LanguageFeatureRegistry<LinkProvider>();\n\n/**\n * @internal\n */\nexport const ColorProviderRegistry = new LanguageFeatureRegistry<DocumentColorProvider>();\n\n/**\n * @internal\n */\nexport const SelectionRangeRegistry = new LanguageFeatureRegistry<SelectionRangeProvider>();\n\n/**\n * @internal\n */\nexport const FoldingRangeProviderRegistry = new LanguageFeatureRegistry<FoldingRangeProvider>();\n\n/**\n * @internal\n */\nexport const DocumentSemanticTokensProviderRegistry = new LanguageFeatureRegistry<DocumentSemanticTokensProvider>();\n\n/**\n * @internal\n */\nexport const DocumentRangeSemanticTokensProviderRegistry = new LanguageFeatureRegistry<DocumentRangeSemanticTokensProvider>();\n\n/**\n * @internal\n */\nexport interface ITokenizationSupportChangedEvent {\n\tchangedLanguages: string[];\n\tchangedColorMap: boolean;\n}\n\n/**\n * @internal\n */\nexport interface ITokenizationRegistry {\n\n\t/**\n\t * An event triggered when:\n\t *  - a tokenization support is registered, unregistered or changed.\n\t *  - the color map is changed.\n\t */\n\tonDidChange: Event<ITokenizationSupportChangedEvent>;\n\n\t/**\n\t * Fire a change event for a language.\n\t * This is useful for languages that embed other languages.\n\t */\n\tfire(languages: string[]): void;\n\n\t/**\n\t * Register a tokenization support.\n\t */\n\tregister(language: string, support: ITokenizationSupport): IDisposable;\n\n\t/**\n\t * Register a promise for a tokenization support.\n\t */\n\tregisterPromise(language: string, promise: Thenable<ITokenizationSupport>): IDisposable;\n\n\t/**\n\t * Get the tokenization support for a language.\n\t * Returns `null` if not found.\n\t */\n\tget(language: string): ITokenizationSupport | null;\n\n\t/**\n\t * Get the promise of a tokenization support for a language.\n\t * `null` is returned if no support is available and no promise for the support has been registered yet.\n\t */\n\tgetPromise(language: string): Thenable<ITokenizationSupport> | null;\n\n\t/**\n\t * Set the new color map that all tokens will use in their ColorId binary encoded bits for foreground and background.\n\t */\n\tsetColorMap(colorMap: Color[]): void;\n\n\tgetColorMap(): Color[] | null;\n\n\tgetDefaultBackground(): Color | null;\n}\n\n/**\n * @internal\n */\nexport const TokenizationRegistry = new TokenizationRegistryImpl();\n\n\n/**\n * @internal\n */\nexport enum ExternalUriOpenerPriority {\n\tNone = 0,\n\tOption = 1,\n\tDefault = 2,\n\tPreferred = 3,\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IDisposable, toDisposable, Disposable } from 'vs/base/common/lifecycle';\nimport { TypeConstraint, validateConstraints } from 'vs/base/common/types';\nimport { ServicesAccessor, createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { Event, Emitter } from 'vs/base/common/event';\nimport { LinkedList } from 'vs/base/common/linkedList';\nimport { IJSONSchema } from 'vs/base/common/jsonSchema';\nimport { Iterable } from 'vs/base/common/iterator';\n\nexport const ICommandService = createDecorator<ICommandService>('commandService');\n\nexport interface ICommandEvent {\n\tcommandId: string;\n\targs: any[];\n}\n\nexport interface ICommandService {\n\treadonly _serviceBrand: undefined;\n\tonWillExecuteCommand: Event<ICommandEvent>;\n\tonDidExecuteCommand: Event<ICommandEvent>;\n\texecuteCommand<T = any>(commandId: string, ...args: any[]): Promise<T | undefined>;\n}\n\nexport type ICommandsMap = Map<string, ICommand>;\n\nexport interface ICommandHandler {\n\t(accessor: ServicesAccessor, ...args: any[]): void;\n}\n\nexport interface ICommand {\n\tid: string;\n\thandler: ICommandHandler;\n\tdescription?: ICommandHandlerDescription | null;\n}\n\nexport interface ICommandHandlerDescription {\n\treadonly description: string;\n\treadonly args: ReadonlyArray<{\n\t\treadonly name: string;\n\t\treadonly description?: string;\n\t\treadonly constraint?: TypeConstraint;\n\t\treadonly schema?: IJSONSchema;\n\t}>;\n\treadonly returns?: string;\n}\n\nexport interface ICommandRegistry {\n\tonDidRegisterCommand: Event<string>;\n\tregisterCommand(id: string, command: ICommandHandler): IDisposable;\n\tregisterCommand(command: ICommand): IDisposable;\n\tregisterCommandAlias(oldId: string, newId: string): IDisposable;\n\tgetCommand(id: string): ICommand | undefined;\n\tgetCommands(): ICommandsMap;\n}\n\nexport const CommandsRegistry: ICommandRegistry = new class implements ICommandRegistry {\n\n\tprivate readonly _commands = new Map<string, LinkedList<ICommand>>();\n\n\tprivate readonly _onDidRegisterCommand = new Emitter<string>();\n\treadonly onDidRegisterCommand: Event<string> = this._onDidRegisterCommand.event;\n\n\tregisterCommand(idOrCommand: string | ICommand, handler?: ICommandHandler): IDisposable {\n\n\t\tif (!idOrCommand) {\n\t\t\tthrow new Error(`invalid command`);\n\t\t}\n\n\t\tif (typeof idOrCommand === 'string') {\n\t\t\tif (!handler) {\n\t\t\t\tthrow new Error(`invalid command`);\n\t\t\t}\n\t\t\treturn this.registerCommand({ id: idOrCommand, handler });\n\t\t}\n\n\t\t// add argument validation if rich command metadata is provided\n\t\tif (idOrCommand.description) {\n\t\t\tconst constraints: Array<TypeConstraint | undefined> = [];\n\t\t\tfor (let arg of idOrCommand.description.args) {\n\t\t\t\tconstraints.push(arg.constraint);\n\t\t\t}\n\t\t\tconst actualHandler = idOrCommand.handler;\n\t\t\tidOrCommand.handler = function (accessor, ...args: any[]) {\n\t\t\t\tvalidateConstraints(args, constraints);\n\t\t\t\treturn actualHandler(accessor, ...args);\n\t\t\t};\n\t\t}\n\n\t\t// find a place to store the command\n\t\tconst { id } = idOrCommand;\n\n\t\tlet commands = this._commands.get(id);\n\t\tif (!commands) {\n\t\t\tcommands = new LinkedList<ICommand>();\n\t\t\tthis._commands.set(id, commands);\n\t\t}\n\n\t\tlet removeFn = commands.unshift(idOrCommand);\n\n\t\tlet ret = toDisposable(() => {\n\t\t\tremoveFn();\n\t\t\tconst command = this._commands.get(id);\n\t\t\tif (command?.isEmpty()) {\n\t\t\t\tthis._commands.delete(id);\n\t\t\t}\n\t\t});\n\n\t\t// tell the world about this command\n\t\tthis._onDidRegisterCommand.fire(id);\n\n\t\treturn ret;\n\t}\n\n\tregisterCommandAlias(oldId: string, newId: string): IDisposable {\n\t\treturn CommandsRegistry.registerCommand(oldId, (accessor, ...args) => accessor.get(ICommandService).executeCommand(newId, ...args));\n\t}\n\n\tgetCommand(id: string): ICommand | undefined {\n\t\tconst list = this._commands.get(id);\n\t\tif (!list || list.isEmpty()) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn Iterable.first(list);\n\t}\n\n\tgetCommands(): ICommandsMap {\n\t\tconst result = new Map<string, ICommand>();\n\t\tfor (const key of this._commands.keys()) {\n\t\t\tconst command = this.getCommand(key);\n\t\t\tif (command) {\n\t\t\t\tresult.set(key, command);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n};\n\nexport const NullCommandService: ICommandService = {\n\t_serviceBrand: undefined,\n\tonWillExecuteCommand: () => Disposable.None,\n\tonDidExecuteCommand: () => Disposable.None,\n\texecuteCommand() {\n\t\treturn Promise.resolve(undefined);\n\t}\n};\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Event } from 'vs/base/common/event';\nimport { isFalsyOrWhitespace } from 'vs/base/common/strings';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { userAgent, isMacintosh, isLinux, isWindows, isWeb } from 'vs/base/common/platform';\n\nlet _userAgent = userAgent || '';\nconst STATIC_VALUES = new Map<string, boolean>();\nSTATIC_VALUES.set('false', false);\nSTATIC_VALUES.set('true', true);\nSTATIC_VALUES.set('isMac', isMacintosh);\nSTATIC_VALUES.set('isLinux', isLinux);\nSTATIC_VALUES.set('isWindows', isWindows);\nSTATIC_VALUES.set('isWeb', isWeb);\nSTATIC_VALUES.set('isMacNative', isMacintosh && !isWeb);\nSTATIC_VALUES.set('isEdge', _userAgent.indexOf('Edg/') >= 0);\nSTATIC_VALUES.set('isFirefox', _userAgent.indexOf('Firefox') >= 0);\nSTATIC_VALUES.set('isChrome', _userAgent.indexOf('Chrome') >= 0);\nSTATIC_VALUES.set('isSafari', _userAgent.indexOf('Safari') >= 0);\nSTATIC_VALUES.set('isIPad', _userAgent.indexOf('iPad') >= 0);\n\nconst hasOwnProperty = Object.prototype.hasOwnProperty;\n\nexport const enum ContextKeyExprType {\n\tFalse = 0,\n\tTrue = 1,\n\tDefined = 2,\n\tNot = 3,\n\tEquals = 4,\n\tNotEquals = 5,\n\tAnd = 6,\n\tRegex = 7,\n\tNotRegex = 8,\n\tOr = 9,\n\tIn = 10,\n\tNotIn = 11,\n\tGreater = 12,\n\tGreaterEquals = 13,\n\tSmaller = 14,\n\tSmallerEquals = 15,\n}\n\nexport interface IContextKeyExprMapper {\n\tmapDefined(key: string): ContextKeyExpression;\n\tmapNot(key: string): ContextKeyExpression;\n\tmapEquals(key: string, value: any): ContextKeyExpression;\n\tmapNotEquals(key: string, value: any): ContextKeyExpression;\n\tmapGreater(key: string, value: any): ContextKeyExpression;\n\tmapGreaterEquals(key: string, value: any): ContextKeyExpression;\n\tmapSmaller(key: string, value: any): ContextKeyExpression;\n\tmapSmallerEquals(key: string, value: any): ContextKeyExpression;\n\tmapRegex(key: string, regexp: RegExp | null): ContextKeyRegexExpr;\n\tmapIn(key: string, valueKey: string): ContextKeyInExpr;\n}\n\nexport interface IContextKeyExpression {\n\tcmp(other: ContextKeyExpression): number;\n\tequals(other: ContextKeyExpression): boolean;\n\tevaluate(context: IContext): boolean;\n\tserialize(): string;\n\tkeys(): string[];\n\tmap(mapFnc: IContextKeyExprMapper): ContextKeyExpression;\n\tnegate(): ContextKeyExpression;\n\n}\n\nexport type ContextKeyExpression = (\n\tContextKeyFalseExpr | ContextKeyTrueExpr | ContextKeyDefinedExpr | ContextKeyNotExpr\n\t| ContextKeyEqualsExpr | ContextKeyNotEqualsExpr | ContextKeyRegexExpr\n\t| ContextKeyNotRegexExpr | ContextKeyAndExpr | ContextKeyOrExpr | ContextKeyInExpr\n\t| ContextKeyNotInExpr | ContextKeyGreaterExpr | ContextKeyGreaterEqualsExpr\n\t| ContextKeySmallerExpr | ContextKeySmallerEqualsExpr\n);\n\nexport abstract class ContextKeyExpr {\n\n\tpublic static false(): ContextKeyExpression {\n\t\treturn ContextKeyFalseExpr.INSTANCE;\n\t}\n\n\tpublic static true(): ContextKeyExpression {\n\t\treturn ContextKeyTrueExpr.INSTANCE;\n\t}\n\n\tpublic static has(key: string): ContextKeyExpression {\n\t\treturn ContextKeyDefinedExpr.create(key);\n\t}\n\n\tpublic static equals(key: string, value: any): ContextKeyExpression {\n\t\treturn ContextKeyEqualsExpr.create(key, value);\n\t}\n\n\tpublic static notEquals(key: string, value: any): ContextKeyExpression {\n\t\treturn ContextKeyNotEqualsExpr.create(key, value);\n\t}\n\n\tpublic static regex(key: string, value: RegExp): ContextKeyExpression {\n\t\treturn ContextKeyRegexExpr.create(key, value);\n\t}\n\n\tpublic static in(key: string, value: string): ContextKeyExpression {\n\t\treturn ContextKeyInExpr.create(key, value);\n\t}\n\n\tpublic static not(key: string): ContextKeyExpression {\n\t\treturn ContextKeyNotExpr.create(key);\n\t}\n\n\tpublic static and(...expr: Array<ContextKeyExpression | undefined | null>): ContextKeyExpression | undefined {\n\t\treturn ContextKeyAndExpr.create(expr);\n\t}\n\n\tpublic static or(...expr: Array<ContextKeyExpression | undefined | null>): ContextKeyExpression | undefined {\n\t\treturn ContextKeyOrExpr.create(expr);\n\t}\n\n\tpublic static greater(key: string, value: any): ContextKeyExpression {\n\t\treturn ContextKeyGreaterExpr.create(key, value);\n\t}\n\n\tpublic static less(key: string, value: any): ContextKeyExpression {\n\t\treturn ContextKeySmallerExpr.create(key, value);\n\t}\n\n\tpublic static deserialize(serialized: string | null | undefined, strict: boolean = false): ContextKeyExpression | undefined {\n\t\tif (!serialized) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn this._deserializeOrExpression(serialized, strict);\n\t}\n\n\tprivate static _deserializeOrExpression(serialized: string, strict: boolean): ContextKeyExpression | undefined {\n\t\tlet pieces = serialized.split('||');\n\t\treturn ContextKeyOrExpr.create(pieces.map(p => this._deserializeAndExpression(p, strict)));\n\t}\n\n\tprivate static _deserializeAndExpression(serialized: string, strict: boolean): ContextKeyExpression | undefined {\n\t\tlet pieces = serialized.split('&&');\n\t\treturn ContextKeyAndExpr.create(pieces.map(p => this._deserializeOne(p, strict)));\n\t}\n\n\tprivate static _deserializeOne(serializedOne: string, strict: boolean): ContextKeyExpression {\n\t\tserializedOne = serializedOne.trim();\n\n\t\tif (serializedOne.indexOf('!=') >= 0) {\n\t\t\tlet pieces = serializedOne.split('!=');\n\t\t\treturn ContextKeyNotEqualsExpr.create(pieces[0].trim(), this._deserializeValue(pieces[1], strict));\n\t\t}\n\n\t\tif (serializedOne.indexOf('==') >= 0) {\n\t\t\tlet pieces = serializedOne.split('==');\n\t\t\treturn ContextKeyEqualsExpr.create(pieces[0].trim(), this._deserializeValue(pieces[1], strict));\n\t\t}\n\n\t\tif (serializedOne.indexOf('=~') >= 0) {\n\t\t\tlet pieces = serializedOne.split('=~');\n\t\t\treturn ContextKeyRegexExpr.create(pieces[0].trim(), this._deserializeRegexValue(pieces[1], strict));\n\t\t}\n\n\t\tif (serializedOne.indexOf(' in ') >= 0) {\n\t\t\tlet pieces = serializedOne.split(' in ');\n\t\t\treturn ContextKeyInExpr.create(pieces[0].trim(), pieces[1].trim());\n\t\t}\n\n\t\tif (/^[^<=>]+>=[^<=>]+$/.test(serializedOne)) {\n\t\t\tconst pieces = serializedOne.split('>=');\n\t\t\treturn ContextKeyGreaterEqualsExpr.create(pieces[0].trim(), pieces[1].trim());\n\t\t}\n\n\t\tif (/^[^<=>]+>[^<=>]+$/.test(serializedOne)) {\n\t\t\tconst pieces = serializedOne.split('>');\n\t\t\treturn ContextKeyGreaterExpr.create(pieces[0].trim(), pieces[1].trim());\n\t\t}\n\n\t\tif (/^[^<=>]+<=[^<=>]+$/.test(serializedOne)) {\n\t\t\tconst pieces = serializedOne.split('<=');\n\t\t\treturn ContextKeySmallerEqualsExpr.create(pieces[0].trim(), pieces[1].trim());\n\t\t}\n\n\t\tif (/^[^<=>]+<[^<=>]+$/.test(serializedOne)) {\n\t\t\tconst pieces = serializedOne.split('<');\n\t\t\treturn ContextKeySmallerExpr.create(pieces[0].trim(), pieces[1].trim());\n\t\t}\n\n\t\tif (/^\\!\\s*/.test(serializedOne)) {\n\t\t\treturn ContextKeyNotExpr.create(serializedOne.substr(1).trim());\n\t\t}\n\n\t\treturn ContextKeyDefinedExpr.create(serializedOne);\n\t}\n\n\tprivate static _deserializeValue(serializedValue: string, strict: boolean): any {\n\t\tserializedValue = serializedValue.trim();\n\n\t\tif (serializedValue === 'true') {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (serializedValue === 'false') {\n\t\t\treturn false;\n\t\t}\n\n\t\tlet m = /^'([^']*)'$/.exec(serializedValue);\n\t\tif (m) {\n\t\t\treturn m[1].trim();\n\t\t}\n\n\t\treturn serializedValue;\n\t}\n\n\tprivate static _deserializeRegexValue(serializedValue: string, strict: boolean): RegExp | null {\n\n\t\tif (isFalsyOrWhitespace(serializedValue)) {\n\t\t\tif (strict) {\n\t\t\t\tthrow new Error('missing regexp-value for =~-expression');\n\t\t\t} else {\n\t\t\t\tconsole.warn('missing regexp-value for =~-expression');\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\n\t\tlet start = serializedValue.indexOf('/');\n\t\tlet end = serializedValue.lastIndexOf('/');\n\t\tif (start === end || start < 0 /* || to < 0 */) {\n\t\t\tif (strict) {\n\t\t\t\tthrow new Error(`bad regexp-value '${serializedValue}', missing /-enclosure`);\n\t\t\t} else {\n\t\t\t\tconsole.warn(`bad regexp-value '${serializedValue}', missing /-enclosure`);\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\n\t\tlet value = serializedValue.slice(start + 1, end);\n\t\tlet caseIgnoreFlag = serializedValue[end + 1] === 'i' ? 'i' : '';\n\t\ttry {\n\t\t\treturn new RegExp(value, caseIgnoreFlag);\n\t\t} catch (e) {\n\t\t\tif (strict) {\n\t\t\t\tthrow new Error(`bad regexp-value '${serializedValue}', parse error: ${e}`);\n\t\t\t} else {\n\t\t\t\tconsole.warn(`bad regexp-value '${serializedValue}', parse error: ${e}`);\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t}\n}\n\nfunction cmp(a: ContextKeyExpression, b: ContextKeyExpression): number {\n\treturn a.cmp(b);\n}\n\nexport class ContextKeyFalseExpr implements IContextKeyExpression {\n\tpublic static INSTANCE = new ContextKeyFalseExpr();\n\n\tpublic readonly type = ContextKeyExprType.False;\n\n\tprotected constructor() {\n\t}\n\n\tpublic cmp(other: ContextKeyExpression): number {\n\t\treturn this.type - other.type;\n\t}\n\n\tpublic equals(other: ContextKeyExpression): boolean {\n\t\treturn (other.type === this.type);\n\t}\n\n\tpublic evaluate(context: IContext): boolean {\n\t\treturn false;\n\t}\n\n\tpublic serialize(): string {\n\t\treturn 'false';\n\t}\n\n\tpublic keys(): string[] {\n\t\treturn [];\n\t}\n\n\tpublic map(mapFnc: IContextKeyExprMapper): ContextKeyExpression {\n\t\treturn this;\n\t}\n\n\tpublic negate(): ContextKeyExpression {\n\t\treturn ContextKeyTrueExpr.INSTANCE;\n\t}\n}\n\nexport class ContextKeyTrueExpr implements IContextKeyExpression {\n\tpublic static INSTANCE = new ContextKeyTrueExpr();\n\n\tpublic readonly type = ContextKeyExprType.True;\n\n\tprotected constructor() {\n\t}\n\n\tpublic cmp(other: ContextKeyExpression): number {\n\t\treturn this.type - other.type;\n\t}\n\n\tpublic equals(other: ContextKeyExpression): boolean {\n\t\treturn (other.type === this.type);\n\t}\n\n\tpublic evaluate(context: IContext): boolean {\n\t\treturn true;\n\t}\n\n\tpublic serialize(): string {\n\t\treturn 'true';\n\t}\n\n\tpublic keys(): string[] {\n\t\treturn [];\n\t}\n\n\tpublic map(mapFnc: IContextKeyExprMapper): ContextKeyExpression {\n\t\treturn this;\n\t}\n\n\tpublic negate(): ContextKeyExpression {\n\t\treturn ContextKeyFalseExpr.INSTANCE;\n\t}\n}\n\nexport class ContextKeyDefinedExpr implements IContextKeyExpression {\n\tpublic static create(key: string): ContextKeyExpression {\n\t\tconst staticValue = STATIC_VALUES.get(key);\n\t\tif (typeof staticValue === 'boolean') {\n\t\t\treturn staticValue ? ContextKeyTrueExpr.INSTANCE : ContextKeyFalseExpr.INSTANCE;\n\t\t}\n\t\treturn new ContextKeyDefinedExpr(key);\n\t}\n\n\tpublic readonly type = ContextKeyExprType.Defined;\n\n\tprotected constructor(protected readonly key: string) {\n\t}\n\n\tpublic cmp(other: ContextKeyExpression): number {\n\t\tif (other.type !== this.type) {\n\t\t\treturn this.type - other.type;\n\t\t}\n\t\treturn cmp1(this.key, other.key);\n\t}\n\n\tpublic equals(other: ContextKeyExpression): boolean {\n\t\tif (other.type === this.type) {\n\t\t\treturn (this.key === other.key);\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic evaluate(context: IContext): boolean {\n\t\treturn (!!context.getValue(this.key));\n\t}\n\n\tpublic serialize(): string {\n\t\treturn this.key;\n\t}\n\n\tpublic keys(): string[] {\n\t\treturn [this.key];\n\t}\n\n\tpublic map(mapFnc: IContextKeyExprMapper): ContextKeyExpression {\n\t\treturn mapFnc.mapDefined(this.key);\n\t}\n\n\tpublic negate(): ContextKeyExpression {\n\t\treturn ContextKeyNotExpr.create(this.key);\n\t}\n}\n\nexport class ContextKeyEqualsExpr implements IContextKeyExpression {\n\n\tpublic static create(key: string, value: any): ContextKeyExpression {\n\t\tif (typeof value === 'boolean') {\n\t\t\treturn (value ? ContextKeyDefinedExpr.create(key) : ContextKeyNotExpr.create(key));\n\t\t}\n\t\tconst staticValue = STATIC_VALUES.get(key);\n\t\tif (typeof staticValue === 'boolean') {\n\t\t\tconst trueValue = staticValue ? 'true' : 'false';\n\t\t\treturn (value === trueValue ? ContextKeyTrueExpr.INSTANCE : ContextKeyFalseExpr.INSTANCE);\n\t\t}\n\t\treturn new ContextKeyEqualsExpr(key, value);\n\t}\n\n\tpublic readonly type = ContextKeyExprType.Equals;\n\n\tprivate constructor(private readonly key: string, private readonly value: any) {\n\t}\n\n\tpublic cmp(other: ContextKeyExpression): number {\n\t\tif (other.type !== this.type) {\n\t\t\treturn this.type - other.type;\n\t\t}\n\t\treturn cmp2(this.key, this.value, other.key, other.value);\n\t}\n\n\tpublic equals(other: ContextKeyExpression): boolean {\n\t\tif (other.type === this.type) {\n\t\t\treturn (this.key === other.key && this.value === other.value);\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic evaluate(context: IContext): boolean {\n\t\t// Intentional ==\n\t\t// eslint-disable-next-line eqeqeq\n\t\treturn (context.getValue(this.key) == this.value);\n\t}\n\n\tpublic serialize(): string {\n\t\treturn `${this.key} == '${this.value}'`;\n\t}\n\n\tpublic keys(): string[] {\n\t\treturn [this.key];\n\t}\n\n\tpublic map(mapFnc: IContextKeyExprMapper): ContextKeyExpression {\n\t\treturn mapFnc.mapEquals(this.key, this.value);\n\t}\n\n\tpublic negate(): ContextKeyExpression {\n\t\treturn ContextKeyNotEqualsExpr.create(this.key, this.value);\n\t}\n}\n\nexport class ContextKeyInExpr implements IContextKeyExpression {\n\n\tpublic static create(key: string, valueKey: string): ContextKeyInExpr {\n\t\treturn new ContextKeyInExpr(key, valueKey);\n\t}\n\n\tpublic readonly type = ContextKeyExprType.In;\n\n\tprivate constructor(private readonly key: string, private readonly valueKey: string) {\n\t}\n\n\tpublic cmp(other: ContextKeyExpression): number {\n\t\tif (other.type !== this.type) {\n\t\t\treturn this.type - other.type;\n\t\t}\n\t\treturn cmp2(this.key, this.valueKey, other.key, other.valueKey);\n\t}\n\n\tpublic equals(other: ContextKeyExpression): boolean {\n\t\tif (other.type === this.type) {\n\t\t\treturn (this.key === other.key && this.valueKey === other.valueKey);\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic evaluate(context: IContext): boolean {\n\t\tconst source = context.getValue(this.valueKey);\n\n\t\tconst item = context.getValue(this.key);\n\n\t\tif (Array.isArray(source)) {\n\t\t\treturn (source.indexOf(item) >= 0);\n\t\t}\n\n\t\tif (typeof item === 'string' && typeof source === 'object' && source !== null) {\n\t\t\treturn hasOwnProperty.call(source, item);\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic serialize(): string {\n\t\treturn `${this.key} in '${this.valueKey}'`;\n\t}\n\n\tpublic keys(): string[] {\n\t\treturn [this.key, this.valueKey];\n\t}\n\n\tpublic map(mapFnc: IContextKeyExprMapper): ContextKeyInExpr {\n\t\treturn mapFnc.mapIn(this.key, this.valueKey);\n\t}\n\n\tpublic negate(): ContextKeyExpression {\n\t\treturn ContextKeyNotInExpr.create(this);\n\t}\n}\n\nexport class ContextKeyNotInExpr implements IContextKeyExpression {\n\n\tpublic static create(actual: ContextKeyInExpr): ContextKeyNotInExpr {\n\t\treturn new ContextKeyNotInExpr(actual);\n\t}\n\n\tpublic readonly type = ContextKeyExprType.NotIn;\n\n\tprivate constructor(private readonly _actual: ContextKeyInExpr) {\n\t\t//\n\t}\n\n\tpublic cmp(other: ContextKeyExpression): number {\n\t\tif (other.type !== this.type) {\n\t\t\treturn this.type - other.type;\n\t\t}\n\t\treturn this._actual.cmp(other._actual);\n\t}\n\n\tpublic equals(other: ContextKeyExpression): boolean {\n\t\tif (other.type === this.type) {\n\t\t\treturn this._actual.equals(other._actual);\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic evaluate(context: IContext): boolean {\n\t\treturn !this._actual.evaluate(context);\n\t}\n\n\tpublic serialize(): string {\n\t\tthrow new Error('Method not implemented.');\n\t}\n\n\tpublic keys(): string[] {\n\t\treturn this._actual.keys();\n\t}\n\n\tpublic map(mapFnc: IContextKeyExprMapper): ContextKeyExpression {\n\t\treturn new ContextKeyNotInExpr(this._actual.map(mapFnc));\n\t}\n\n\tpublic negate(): ContextKeyExpression {\n\t\treturn this._actual;\n\t}\n}\n\nexport class ContextKeyNotEqualsExpr implements IContextKeyExpression {\n\n\tpublic static create(key: string, value: any): ContextKeyExpression {\n\t\tif (typeof value === 'boolean') {\n\t\t\tif (value) {\n\t\t\t\treturn ContextKeyNotExpr.create(key);\n\t\t\t}\n\t\t\treturn ContextKeyDefinedExpr.create(key);\n\t\t}\n\t\tconst staticValue = STATIC_VALUES.get(key);\n\t\tif (typeof staticValue === 'boolean') {\n\t\t\tconst falseValue = staticValue ? 'true' : 'false';\n\t\t\treturn (value === falseValue ? ContextKeyFalseExpr.INSTANCE : ContextKeyTrueExpr.INSTANCE);\n\t\t}\n\t\treturn new ContextKeyNotEqualsExpr(key, value);\n\t}\n\n\tpublic readonly type = ContextKeyExprType.NotEquals;\n\n\tprivate constructor(private readonly key: string, private readonly value: any) {\n\t}\n\n\tpublic cmp(other: ContextKeyExpression): number {\n\t\tif (other.type !== this.type) {\n\t\t\treturn this.type - other.type;\n\t\t}\n\t\treturn cmp2(this.key, this.value, other.key, other.value);\n\t}\n\n\tpublic equals(other: ContextKeyExpression): boolean {\n\t\tif (other.type === this.type) {\n\t\t\treturn (this.key === other.key && this.value === other.value);\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic evaluate(context: IContext): boolean {\n\t\t// Intentional !=\n\t\t// eslint-disable-next-line eqeqeq\n\t\treturn (context.getValue(this.key) != this.value);\n\t}\n\n\tpublic serialize(): string {\n\t\treturn `${this.key} != '${this.value}'`;\n\t}\n\n\tpublic keys(): string[] {\n\t\treturn [this.key];\n\t}\n\n\tpublic map(mapFnc: IContextKeyExprMapper): ContextKeyExpression {\n\t\treturn mapFnc.mapNotEquals(this.key, this.value);\n\t}\n\n\tpublic negate(): ContextKeyExpression {\n\t\treturn ContextKeyEqualsExpr.create(this.key, this.value);\n\t}\n}\n\nexport class ContextKeyNotExpr implements IContextKeyExpression {\n\n\tpublic static create(key: string): ContextKeyExpression {\n\t\tconst staticValue = STATIC_VALUES.get(key);\n\t\tif (typeof staticValue === 'boolean') {\n\t\t\treturn (staticValue ? ContextKeyFalseExpr.INSTANCE : ContextKeyTrueExpr.INSTANCE);\n\t\t}\n\t\treturn new ContextKeyNotExpr(key);\n\t}\n\n\tpublic readonly type = ContextKeyExprType.Not;\n\n\tprivate constructor(private readonly key: string) {\n\t}\n\n\tpublic cmp(other: ContextKeyExpression): number {\n\t\tif (other.type !== this.type) {\n\t\t\treturn this.type - other.type;\n\t\t}\n\t\treturn cmp1(this.key, other.key);\n\t}\n\n\tpublic equals(other: ContextKeyExpression): boolean {\n\t\tif (other.type === this.type) {\n\t\t\treturn (this.key === other.key);\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic evaluate(context: IContext): boolean {\n\t\treturn (!context.getValue(this.key));\n\t}\n\n\tpublic serialize(): string {\n\t\treturn `!${this.key}`;\n\t}\n\n\tpublic keys(): string[] {\n\t\treturn [this.key];\n\t}\n\n\tpublic map(mapFnc: IContextKeyExprMapper): ContextKeyExpression {\n\t\treturn mapFnc.mapNot(this.key);\n\t}\n\n\tpublic negate(): ContextKeyExpression {\n\t\treturn ContextKeyDefinedExpr.create(this.key);\n\t}\n}\n\nexport class ContextKeyGreaterExpr implements IContextKeyExpression {\n\n\tpublic static create(key: string, value: any): ContextKeyExpression {\n\t\treturn new ContextKeyGreaterExpr(key, value);\n\t}\n\n\tpublic readonly type = ContextKeyExprType.Greater;\n\n\tprivate constructor(\n\t\tprivate readonly key: string,\n\t\tprivate readonly value: any\n\t) { }\n\n\tpublic cmp(other: ContextKeyExpression): number {\n\t\tif (other.type !== this.type) {\n\t\t\treturn this.type - other.type;\n\t\t}\n\t\treturn cmp2(this.key, this.value, other.key, other.value);\n\t}\n\n\tpublic equals(other: ContextKeyExpression): boolean {\n\t\tif (other.type === this.type) {\n\t\t\treturn (this.key === other.key && this.value === other.value);\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic evaluate(context: IContext): boolean {\n\t\treturn (parseFloat(<any>context.getValue(this.key)) > parseFloat(this.value));\n\t}\n\n\tpublic serialize(): string {\n\t\treturn `${this.key} > ${this.value}`;\n\t}\n\n\tpublic keys(): string[] {\n\t\treturn [this.key];\n\t}\n\n\tpublic map(mapFnc: IContextKeyExprMapper): ContextKeyExpression {\n\t\treturn mapFnc.mapGreater(this.key, this.value);\n\t}\n\n\tpublic negate(): ContextKeyExpression {\n\t\treturn ContextKeySmallerEqualsExpr.create(this.key, this.value);\n\t}\n}\n\nexport class ContextKeyGreaterEqualsExpr implements IContextKeyExpression {\n\n\tpublic static create(key: string, value: any): ContextKeyExpression {\n\t\treturn new ContextKeyGreaterEqualsExpr(key, value);\n\t}\n\n\tpublic readonly type = ContextKeyExprType.GreaterEquals;\n\n\tprivate constructor(\n\t\tprivate readonly key: string,\n\t\tprivate readonly value: any\n\t) { }\n\n\tpublic cmp(other: ContextKeyExpression): number {\n\t\tif (other.type !== this.type) {\n\t\t\treturn this.type - other.type;\n\t\t}\n\t\treturn cmp2(this.key, this.value, other.key, other.value);\n\t}\n\n\tpublic equals(other: ContextKeyExpression): boolean {\n\t\tif (other.type === this.type) {\n\t\t\treturn (this.key === other.key && this.value === other.value);\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic evaluate(context: IContext): boolean {\n\t\treturn (parseFloat(<any>context.getValue(this.key)) >= parseFloat(this.value));\n\t}\n\n\tpublic serialize(): string {\n\t\treturn `${this.key} >= ${this.value}`;\n\t}\n\n\tpublic keys(): string[] {\n\t\treturn [this.key];\n\t}\n\n\tpublic map(mapFnc: IContextKeyExprMapper): ContextKeyExpression {\n\t\treturn mapFnc.mapGreaterEquals(this.key, this.value);\n\t}\n\n\tpublic negate(): ContextKeyExpression {\n\t\treturn ContextKeySmallerExpr.create(this.key, this.value);\n\t}\n}\n\nexport class ContextKeySmallerExpr implements IContextKeyExpression {\n\n\tpublic static create(key: string, value: any): ContextKeyExpression {\n\t\treturn new ContextKeySmallerExpr(key, value);\n\t}\n\n\tpublic readonly type = ContextKeyExprType.Smaller;\n\n\tprivate constructor(\n\t\tprivate readonly key: string,\n\t\tprivate readonly value: any\n\t) {\n\t}\n\n\tpublic cmp(other: ContextKeyExpression): number {\n\t\tif (other.type !== this.type) {\n\t\t\treturn this.type - other.type;\n\t\t}\n\t\treturn cmp2(this.key, this.value, other.key, other.value);\n\t}\n\n\tpublic equals(other: ContextKeyExpression): boolean {\n\t\tif (other.type === this.type) {\n\t\t\treturn (this.key === other.key && this.value === other.value);\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic evaluate(context: IContext): boolean {\n\t\treturn (parseFloat(<any>context.getValue(this.key)) < parseFloat(this.value));\n\t}\n\n\tpublic serialize(): string {\n\t\treturn `${this.key} < ${this.value}`;\n\t}\n\n\tpublic keys(): string[] {\n\t\treturn [this.key];\n\t}\n\n\tpublic map(mapFnc: IContextKeyExprMapper): ContextKeyExpression {\n\t\treturn mapFnc.mapSmaller(this.key, this.value);\n\t}\n\n\tpublic negate(): ContextKeyExpression {\n\t\treturn ContextKeyGreaterEqualsExpr.create(this.key, this.value);\n\t}\n}\n\nexport class ContextKeySmallerEqualsExpr implements IContextKeyExpression {\n\n\tpublic static create(key: string, value: any): ContextKeyExpression {\n\t\treturn new ContextKeySmallerEqualsExpr(key, value);\n\t}\n\n\tpublic readonly type = ContextKeyExprType.SmallerEquals;\n\n\tprivate constructor(\n\t\tprivate readonly key: string,\n\t\tprivate readonly value: any\n\t) {\n\t}\n\n\tpublic cmp(other: ContextKeyExpression): number {\n\t\tif (other.type !== this.type) {\n\t\t\treturn this.type - other.type;\n\t\t}\n\t\treturn cmp2(this.key, this.value, other.key, other.value);\n\t}\n\n\tpublic equals(other: ContextKeyExpression): boolean {\n\t\tif (other.type === this.type) {\n\t\t\treturn (this.key === other.key && this.value === other.value);\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic evaluate(context: IContext): boolean {\n\t\treturn (parseFloat(<any>context.getValue(this.key)) <= parseFloat(this.value));\n\t}\n\n\tpublic serialize(): string {\n\t\treturn `${this.key} <= ${this.value}`;\n\t}\n\n\tpublic keys(): string[] {\n\t\treturn [this.key];\n\t}\n\n\tpublic map(mapFnc: IContextKeyExprMapper): ContextKeyExpression {\n\t\treturn mapFnc.mapSmallerEquals(this.key, this.value);\n\t}\n\n\tpublic negate(): ContextKeyExpression {\n\t\treturn ContextKeyGreaterExpr.create(this.key, this.value);\n\t}\n}\n\nexport class ContextKeyRegexExpr implements IContextKeyExpression {\n\n\tpublic static create(key: string, regexp: RegExp | null): ContextKeyRegexExpr {\n\t\treturn new ContextKeyRegexExpr(key, regexp);\n\t}\n\n\tpublic readonly type = ContextKeyExprType.Regex;\n\n\tprivate constructor(private readonly key: string, private readonly regexp: RegExp | null) {\n\t\t//\n\t}\n\n\tpublic cmp(other: ContextKeyExpression): number {\n\t\tif (other.type !== this.type) {\n\t\t\treturn this.type - other.type;\n\t\t}\n\t\tif (this.key < other.key) {\n\t\t\treturn -1;\n\t\t}\n\t\tif (this.key > other.key) {\n\t\t\treturn 1;\n\t\t}\n\t\tconst thisSource = this.regexp ? this.regexp.source : '';\n\t\tconst otherSource = other.regexp ? other.regexp.source : '';\n\t\tif (thisSource < otherSource) {\n\t\t\treturn -1;\n\t\t}\n\t\tif (thisSource > otherSource) {\n\t\t\treturn 1;\n\t\t}\n\t\treturn 0;\n\t}\n\n\tpublic equals(other: ContextKeyExpression): boolean {\n\t\tif (other.type === this.type) {\n\t\t\tconst thisSource = this.regexp ? this.regexp.source : '';\n\t\t\tconst otherSource = other.regexp ? other.regexp.source : '';\n\t\t\treturn (this.key === other.key && thisSource === otherSource);\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic evaluate(context: IContext): boolean {\n\t\tlet value = context.getValue<any>(this.key);\n\t\treturn this.regexp ? this.regexp.test(value) : false;\n\t}\n\n\tpublic serialize(): string {\n\t\tconst value = this.regexp\n\t\t\t? `/${this.regexp.source}/${this.regexp.ignoreCase ? 'i' : ''}`\n\t\t\t: '/invalid/';\n\t\treturn `${this.key} =~ ${value}`;\n\t}\n\n\tpublic keys(): string[] {\n\t\treturn [this.key];\n\t}\n\n\tpublic map(mapFnc: IContextKeyExprMapper): ContextKeyRegexExpr {\n\t\treturn mapFnc.mapRegex(this.key, this.regexp);\n\t}\n\n\tpublic negate(): ContextKeyExpression {\n\t\treturn ContextKeyNotRegexExpr.create(this);\n\t}\n}\n\nexport class ContextKeyNotRegexExpr implements IContextKeyExpression {\n\n\tpublic static create(actual: ContextKeyRegexExpr): ContextKeyExpression {\n\t\treturn new ContextKeyNotRegexExpr(actual);\n\t}\n\n\tpublic readonly type = ContextKeyExprType.NotRegex;\n\n\tprivate constructor(private readonly _actual: ContextKeyRegexExpr) {\n\t\t//\n\t}\n\n\tpublic cmp(other: ContextKeyExpression): number {\n\t\tif (other.type !== this.type) {\n\t\t\treturn this.type - other.type;\n\t\t}\n\t\treturn this._actual.cmp(other._actual);\n\t}\n\n\tpublic equals(other: ContextKeyExpression): boolean {\n\t\tif (other.type === this.type) {\n\t\t\treturn this._actual.equals(other._actual);\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic evaluate(context: IContext): boolean {\n\t\treturn !this._actual.evaluate(context);\n\t}\n\n\tpublic serialize(): string {\n\t\tthrow new Error('Method not implemented.');\n\t}\n\n\tpublic keys(): string[] {\n\t\treturn this._actual.keys();\n\t}\n\n\tpublic map(mapFnc: IContextKeyExprMapper): ContextKeyExpression {\n\t\treturn new ContextKeyNotRegexExpr(this._actual.map(mapFnc));\n\t}\n\n\tpublic negate(): ContextKeyExpression {\n\t\treturn this._actual;\n\t}\n}\n\nexport class ContextKeyAndExpr implements IContextKeyExpression {\n\n\tpublic static create(_expr: ReadonlyArray<ContextKeyExpression | null | undefined>): ContextKeyExpression | undefined {\n\t\treturn ContextKeyAndExpr._normalizeArr(_expr);\n\t}\n\n\tpublic readonly type = ContextKeyExprType.And;\n\n\tprivate constructor(public readonly expr: ContextKeyExpression[]) {\n\t}\n\n\tpublic cmp(other: ContextKeyExpression): number {\n\t\tif (other.type !== this.type) {\n\t\t\treturn this.type - other.type;\n\t\t}\n\t\tif (this.expr.length < other.expr.length) {\n\t\t\treturn -1;\n\t\t}\n\t\tif (this.expr.length > other.expr.length) {\n\t\t\treturn 1;\n\t\t}\n\t\tfor (let i = 0, len = this.expr.length; i < len; i++) {\n\t\t\tconst r = cmp(this.expr[i], other.expr[i]);\n\t\t\tif (r !== 0) {\n\t\t\t\treturn r;\n\t\t\t}\n\t\t}\n\t\treturn 0;\n\t}\n\n\tpublic equals(other: ContextKeyExpression): boolean {\n\t\tif (other.type === this.type) {\n\t\t\tif (this.expr.length !== other.expr.length) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tfor (let i = 0, len = this.expr.length; i < len; i++) {\n\t\t\t\tif (!this.expr[i].equals(other.expr[i])) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic evaluate(context: IContext): boolean {\n\t\tfor (let i = 0, len = this.expr.length; i < len; i++) {\n\t\t\tif (!this.expr[i].evaluate(context)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\tprivate static _normalizeArr(arr: ReadonlyArray<ContextKeyExpression | null | undefined>): ContextKeyExpression | undefined {\n\t\tconst expr: ContextKeyExpression[] = [];\n\t\tlet hasTrue = false;\n\n\t\tfor (const e of arr) {\n\t\t\tif (!e) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (e.type === ContextKeyExprType.True) {\n\t\t\t\t// anything && true ==> anything\n\t\t\t\thasTrue = true;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (e.type === ContextKeyExprType.False) {\n\t\t\t\t// anything && false ==> false\n\t\t\t\treturn ContextKeyFalseExpr.INSTANCE;\n\t\t\t}\n\n\t\t\tif (e.type === ContextKeyExprType.And) {\n\t\t\t\texpr.push(...e.expr);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\texpr.push(e);\n\t\t}\n\n\t\tif (expr.length === 0 && hasTrue) {\n\t\t\treturn ContextKeyTrueExpr.INSTANCE;\n\t\t}\n\n\t\tif (expr.length === 0) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (expr.length === 1) {\n\t\t\treturn expr[0];\n\t\t}\n\n\t\texpr.sort(cmp);\n\n\t\t// We must distribute any OR expression because we don't support parens\n\t\t// OR extensions will be at the end (due to sorting rules)\n\t\twhile (expr.length > 1) {\n\t\t\tconst lastElement = expr[expr.length - 1];\n\t\t\tif (lastElement.type !== ContextKeyExprType.Or) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\t// pop the last element\n\t\t\texpr.pop();\n\n\t\t\t// pop the second to last element\n\t\t\tconst secondToLastElement = expr.pop()!;\n\n\t\t\t// distribute `lastElement` over `secondToLastElement`\n\t\t\tconst resultElement = ContextKeyOrExpr.create(\n\t\t\t\tlastElement.expr.map(el => ContextKeyAndExpr.create([el, secondToLastElement]))\n\t\t\t);\n\n\t\t\tif (resultElement) {\n\t\t\t\texpr.push(resultElement);\n\t\t\t\texpr.sort(cmp);\n\t\t\t}\n\t\t}\n\n\t\tif (expr.length === 1) {\n\t\t\treturn expr[0];\n\t\t}\n\n\t\treturn new ContextKeyAndExpr(expr);\n\t}\n\n\tpublic serialize(): string {\n\t\treturn this.expr.map(e => e.serialize()).join(' && ');\n\t}\n\n\tpublic keys(): string[] {\n\t\tconst result: string[] = [];\n\t\tfor (let expr of this.expr) {\n\t\t\tresult.push(...expr.keys());\n\t\t}\n\t\treturn result;\n\t}\n\n\tpublic map(mapFnc: IContextKeyExprMapper): ContextKeyExpression {\n\t\treturn new ContextKeyAndExpr(this.expr.map(expr => expr.map(mapFnc)));\n\t}\n\n\tpublic negate(): ContextKeyExpression {\n\t\tlet result: ContextKeyExpression[] = [];\n\t\tfor (let expr of this.expr) {\n\t\t\tresult.push(expr.negate());\n\t\t}\n\t\treturn ContextKeyOrExpr.create(result)!;\n\t}\n}\n\nexport class ContextKeyOrExpr implements IContextKeyExpression {\n\n\tpublic static create(_expr: ReadonlyArray<ContextKeyExpression | null | undefined>): ContextKeyExpression | undefined {\n\t\tconst expr = ContextKeyOrExpr._normalizeArr(_expr);\n\t\tif (expr.length === 0) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (expr.length === 1) {\n\t\t\treturn expr[0];\n\t\t}\n\n\t\treturn new ContextKeyOrExpr(expr);\n\t}\n\n\tpublic readonly type = ContextKeyExprType.Or;\n\n\tprivate constructor(public readonly expr: ContextKeyExpression[]) {\n\t}\n\n\tpublic cmp(other: ContextKeyExpression): number {\n\t\tif (other.type !== this.type) {\n\t\t\treturn this.type - other.type;\n\t\t}\n\t\tif (this.expr.length < other.expr.length) {\n\t\t\treturn -1;\n\t\t}\n\t\tif (this.expr.length > other.expr.length) {\n\t\t\treturn 1;\n\t\t}\n\t\tfor (let i = 0, len = this.expr.length; i < len; i++) {\n\t\t\tconst r = cmp(this.expr[i], other.expr[i]);\n\t\t\tif (r !== 0) {\n\t\t\t\treturn r;\n\t\t\t}\n\t\t}\n\t\treturn 0;\n\t}\n\n\tpublic equals(other: ContextKeyExpression): boolean {\n\t\tif (other.type === this.type) {\n\t\t\tif (this.expr.length !== other.expr.length) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tfor (let i = 0, len = this.expr.length; i < len; i++) {\n\t\t\t\tif (!this.expr[i].equals(other.expr[i])) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic evaluate(context: IContext): boolean {\n\t\tfor (let i = 0, len = this.expr.length; i < len; i++) {\n\t\t\tif (this.expr[i].evaluate(context)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tprivate static _normalizeArr(arr: ReadonlyArray<ContextKeyExpression | null | undefined>): ContextKeyExpression[] {\n\t\tlet expr: ContextKeyExpression[] = [];\n\t\tlet hasFalse = false;\n\n\t\tif (arr) {\n\t\t\tfor (let i = 0, len = arr.length; i < len; i++) {\n\t\t\t\tconst e = arr[i];\n\t\t\t\tif (!e) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (e.type === ContextKeyExprType.False) {\n\t\t\t\t\t// anything || false ==> anything\n\t\t\t\t\thasFalse = true;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (e.type === ContextKeyExprType.True) {\n\t\t\t\t\t// anything || true ==> true\n\t\t\t\t\treturn [ContextKeyTrueExpr.INSTANCE];\n\t\t\t\t}\n\n\t\t\t\tif (e.type === ContextKeyExprType.Or) {\n\t\t\t\t\texpr = expr.concat(e.expr);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\texpr.push(e);\n\t\t\t}\n\n\t\t\tif (expr.length === 0 && hasFalse) {\n\t\t\t\treturn [ContextKeyFalseExpr.INSTANCE];\n\t\t\t}\n\n\t\t\texpr.sort(cmp);\n\t\t}\n\n\t\treturn expr;\n\t}\n\n\tpublic serialize(): string {\n\t\treturn this.expr.map(e => e.serialize()).join(' || ');\n\t}\n\n\tpublic keys(): string[] {\n\t\tconst result: string[] = [];\n\t\tfor (let expr of this.expr) {\n\t\t\tresult.push(...expr.keys());\n\t\t}\n\t\treturn result;\n\t}\n\n\tpublic map(mapFnc: IContextKeyExprMapper): ContextKeyExpression {\n\t\treturn new ContextKeyOrExpr(this.expr.map(expr => expr.map(mapFnc)));\n\t}\n\n\tpublic negate(): ContextKeyExpression {\n\t\tlet result: ContextKeyExpression[] = [];\n\t\tfor (let expr of this.expr) {\n\t\t\tresult.push(expr.negate());\n\t\t}\n\n\t\tconst terminals = (node: ContextKeyExpression) => {\n\t\t\tif (node.type === ContextKeyExprType.Or) {\n\t\t\t\treturn node.expr;\n\t\t\t}\n\t\t\treturn [node];\n\t\t};\n\n\t\t// We don't support parens, so here we distribute the AND over the OR terminals\n\t\t// We always take the first 2 AND pairs and distribute them\n\t\twhile (result.length > 1) {\n\t\t\tconst LEFT = result.shift()!;\n\t\t\tconst RIGHT = result.shift()!;\n\n\t\t\tconst all: ContextKeyExpression[] = [];\n\t\t\tfor (const left of terminals(LEFT)) {\n\t\t\t\tfor (const right of terminals(RIGHT)) {\n\t\t\t\t\tall.push(ContextKeyExpr.and(left, right)!);\n\t\t\t\t}\n\t\t\t}\n\t\t\tresult.unshift(ContextKeyExpr.or(...all)!);\n\t\t}\n\n\t\treturn result[0];\n\t}\n}\n\nexport class RawContextKey<T> extends ContextKeyDefinedExpr {\n\n\tprivate readonly _defaultValue: T | undefined;\n\n\tconstructor(key: string, defaultValue: T | undefined) {\n\t\tsuper(key);\n\t\tthis._defaultValue = defaultValue;\n\t}\n\n\tpublic bindTo(target: IContextKeyService): IContextKey<T> {\n\t\treturn target.createKey(this.key, this._defaultValue);\n\t}\n\n\tpublic getValue(target: IContextKeyService): T | undefined {\n\t\treturn target.getContextKeyValue<T>(this.key);\n\t}\n\n\tpublic toNegated(): ContextKeyExpression {\n\t\treturn ContextKeyExpr.not(this.key);\n\t}\n\n\tpublic isEqualTo(value: any): ContextKeyExpression {\n\t\treturn ContextKeyExpr.equals(this.key, value);\n\t}\n\n\tpublic notEqualsTo(value: any): ContextKeyExpression {\n\t\treturn ContextKeyExpr.notEquals(this.key, value);\n\t}\n}\n\nexport interface IContext {\n\tgetValue<T>(key: string): T | undefined;\n}\n\nexport interface IContextKey<T> {\n\tset(value: T): void;\n\treset(): void;\n\tget(): T | undefined;\n}\n\nexport interface IContextKeyServiceTarget {\n\tparentElement: IContextKeyServiceTarget | null;\n\tsetAttribute(attr: string, value: string): void;\n\tremoveAttribute(attr: string): void;\n\thasAttribute(attr: string): boolean;\n\tgetAttribute(attr: string): string | null;\n}\n\nexport const IContextKeyService = createDecorator<IContextKeyService>('contextKeyService');\n\nexport interface IReadableSet<T> {\n\thas(value: T): boolean;\n}\n\nexport interface IContextKeyChangeEvent {\n\taffectsSome(keys: IReadableSet<string>): boolean;\n}\n\nexport interface IContextKeyService {\n\treadonly _serviceBrand: undefined;\n\tdispose(): void;\n\n\tonDidChangeContext: Event<IContextKeyChangeEvent>;\n\tbufferChangeEvents(callback: Function): void;\n\n\tcreateKey<T>(key: string, defaultValue: T | undefined): IContextKey<T>;\n\tcontextMatchesRules(rules: ContextKeyExpression | undefined): boolean;\n\tgetContextKeyValue<T>(key: string): T | undefined;\n\n\tcreateScoped(target?: IContextKeyServiceTarget): IContextKeyService;\n\tgetContext(target: IContextKeyServiceTarget | null): IContext;\n\n\tupdateParent(parentContextKeyService: IContextKeyService): void;\n}\n\nexport const SET_CONTEXT_COMMAND_ID = 'setContext';\n\nfunction cmp1(key1: string, key2: string): number {\n\tif (key1 < key2) {\n\t\treturn -1;\n\t}\n\tif (key1 > key2) {\n\t\treturn 1;\n\t}\n\treturn 0;\n}\n\nfunction cmp2(key1: string, value1: any, key2: string, value2: any): number {\n\tif (key1 < key2) {\n\t\treturn -1;\n\t}\n\tif (key1 > key2) {\n\t\treturn 1;\n\t}\n\tif (value1 < value2) {\n\t\treturn -1;\n\t}\n\tif (value1 > value2) {\n\t\treturn 1;\n\t}\n\treturn 0;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { URI } from 'vs/base/common/uri';\nimport { NativeParsedArgs } from 'vs/platform/environment/common/argv';\n\nexport const IEnvironmentService = createDecorator<IEnvironmentService>('environmentService');\nexport const INativeEnvironmentService = createDecorator<INativeEnvironmentService>('nativeEnvironmentService');\n\nexport interface IDebugParams {\n\tport: number | null;\n\tbreak: boolean;\n}\n\nexport interface IExtensionHostDebugParams extends IDebugParams {\n\tdebugId?: string;\n}\n\n/**\n * A basic environment service that can be used in various processes,\n * such as main, renderer and shared process. Use subclasses of this\n * service for specific environment.\n */\nexport interface IEnvironmentService {\n\n\treadonly _serviceBrand: undefined;\n\n\t// !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n\t//\n\t// NOTE: KEEP THIS INTERFACE AS SMALL AS POSSIBLE.\n\t//\n\t// AS SUCH:\n\t//   - PUT NON-WEB PROPERTIES INTO NATIVE ENVIRONMENT SERVICE\n\t//   - PUT WORKBENCH ONLY PROPERTIES INTO WORKBENCH ENVIRONMENT SERVICE\n\t//   - PUT ELECTRON-MAIN ONLY PROPERTIES INTO MAIN ENVIRONMENT SERVICE\n\t//\n\t// !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n\n\t// --- user roaming data\n\tuserRoamingDataHome: URI;\n\tsettingsResource: URI;\n\tkeybindingsResource: URI;\n\tkeyboardLayoutResource: URI;\n\targvResource: URI;\n\tsnippetsHome: URI;\n\n\t// --- data paths\n\tuntitledWorkspacesHome: URI;\n\tglobalStorageHome: URI;\n\tworkspaceStorageHome: URI;\n\n\t// --- settings sync\n\tuserDataSyncHome: URI;\n\tuserDataSyncLogResource: URI;\n\tsync: 'on' | 'off' | undefined;\n\n\t// --- extension development\n\tdebugExtensionHost: IExtensionHostDebugParams;\n\tisExtensionDevelopment: boolean;\n\tdisableExtensions: boolean | string[];\n\textensionDevelopmentLocationURI?: URI[];\n\textensionTestsLocationURI?: URI;\n\n\t// --- logging\n\tlogsPath: string;\n\tlogLevel?: string;\n\tverbose: boolean;\n\tisBuilt: boolean;\n\n\t// --- telemetry\n\tdisableTelemetry: boolean;\n\ttelemetryLogResource: URI;\n\tserviceMachineIdResource: URI;\n\n\t// !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n\t//\n\t// NOTE: KEEP THIS INTERFACE AS SMALL AS POSSIBLE.\n\t//\n\t// AS SUCH:\n\t//   - PUT NON-WEB PROPERTIES INTO NATIVE ENVIRONMENT SERVICE\n\t//   - PUT WORKBENCH ONLY PROPERTIES INTO WORKBENCH ENVIRONMENT SERVICE\n\t//   - PUT ELECTRON-MAIN ONLY PROPERTIES INTO MAIN ENVIRONMENT SERVICE\n\t//\n\t// !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n}\n\n/**\n * A subclass of the `IEnvironmentService` to be used only in native\n * environments (Windows, Linux, macOS) but not e.g. web.\n */\nexport interface INativeEnvironmentService extends IEnvironmentService {\n\n\t// !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n\t//\n\t// NOTE: KEEP THIS INTERFACE AS SMALL AS POSSIBLE.\n\t//\n\t// AS SUCH:\n\t//   - PUT WORKBENCH ONLY PROPERTIES INTO WORKBENCH ENVIRONMENT SERVICE\n\t//   - PUT ELECTRON-MAIN ONLY PROPERTIES INTO MAIN ENVIRONMENT SERVICE\n\t//\n\t// !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n\n\t// --- CLI Arguments\n\targs: NativeParsedArgs;\n\n\t// --- paths\n\tappRoot: string;\n\tuserHome: URI;\n\tappSettingsHome: URI;\n\ttmpDir: URI;\n\tuserDataPath: string;\n\tmachineSettingsResource: URI;\n\tinstallSourcePath: string;\n\n\t// --- IPC Handles\n\tsharedIPCHandle: string;\n\n\t// --- Extensions\n\textensionsPath: string;\n\textensionsDownloadPath: string;\n\tbuiltinExtensionsPath: string;\n\textraExtensionPaths: string[]\n\textraBuiltinExtensionPaths: string[]\n\n\t// --- Smoke test support\n\tdriverHandle?: string;\n\n\t// !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n\t//\n\t// NOTE: KEEP THIS INTERFACE AS SMALL AS POSSIBLE.\n\t//\n\t// AS SUCH:\n\t//   - PUT NON-WEB PROPERTIES INTO NATIVE ENVIRONMENT SERVICE\n\t//   - PUT WORKBENCH ONLY PROPERTIES INTO WORKBENCH ENVIRONMENT SERVICE\n\t//   - PUT ELECTRON-MAIN ONLY PROPERTIES INTO MAIN ENVIRONMENT SERVICE\n\t//\n\t// !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from 'vs/nls';\nimport { Event } from 'vs/base/common/event';\nimport { IPager } from 'vs/base/common/paging';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { URI } from 'vs/base/common/uri';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { IExtensionManifest, IExtension, ExtensionType } from 'vs/platform/extensions/common/extensions';\nimport { FileAccess } from 'vs/base/common/network';\n\nexport const EXTENSION_IDENTIFIER_PATTERN = '^([a-z0-9A-Z][a-z0-9-A-Z]*)\\\\.([a-z0-9A-Z][a-z0-9-A-Z]*)$';\nexport const EXTENSION_IDENTIFIER_REGEX = new RegExp(EXTENSION_IDENTIFIER_PATTERN);\n\nexport interface IGalleryExtensionProperties {\n\tdependencies?: string[];\n\textensionPack?: string[];\n\tengine?: string;\n\tlocalizedLanguages?: string[];\n\twebExtension?: boolean;\n}\n\nexport interface IGalleryExtensionAsset {\n\turi: string;\n\tfallbackUri: string;\n}\n\nexport interface IGalleryExtensionAssets {\n\tmanifest: IGalleryExtensionAsset | null;\n\treadme: IGalleryExtensionAsset | null;\n\tchangelog: IGalleryExtensionAsset | null;\n\tlicense: IGalleryExtensionAsset | null;\n\trepository: IGalleryExtensionAsset | null;\n\tdownload: IGalleryExtensionAsset;\n\ticon: IGalleryExtensionAsset;\n\tcoreTranslations: [string, IGalleryExtensionAsset][];\n}\n\nexport function isIExtensionIdentifier(thing: any): thing is IExtensionIdentifier {\n\treturn thing\n\t\t&& typeof thing === 'object'\n\t\t&& typeof thing.id === 'string'\n\t\t&& (!thing.uuid || typeof thing.uuid === 'string');\n}\n\n/* __GDPR__FRAGMENT__\n\t\"ExtensionIdentifier\" : {\n\t\t\"id\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" },\n\t\t\"uuid\": { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" }\n\t}\n */\nexport interface IExtensionIdentifier {\n\tid: string;\n\tuuid?: string;\n}\n\nexport interface IExtensionIdentifierWithVersion extends IExtensionIdentifier {\n\tid: string;\n\tuuid?: string;\n\tversion: string;\n}\n\nexport interface IGalleryExtensionIdentifier extends IExtensionIdentifier {\n\tuuid: string;\n}\n\nexport interface IGalleryExtensionVersion {\n\tversion: string;\n\tdate: string;\n}\n\nexport interface IGalleryExtension {\n\tname: string;\n\tidentifier: IGalleryExtensionIdentifier;\n\tversion: string;\n\tdate: string;\n\tdisplayName: string;\n\tpublisherId: string;\n\tpublisher: string;\n\tpublisherDisplayName: string;\n\tdescription: string;\n\tinstallCount: number;\n\trating: number;\n\tratingCount: number;\n\tassetUri: URI;\n\tassetTypes: string[];\n\tassets: IGalleryExtensionAssets;\n\tproperties: IGalleryExtensionProperties;\n\ttelemetryData: any;\n\tpreview: boolean;\n\twebResource?: URI;\n}\n\nexport interface IGalleryMetadata {\n\tid: string;\n\tpublisherId: string;\n\tpublisherDisplayName: string;\n}\n\nexport interface ILocalExtension extends IExtension {\n\tisMachineScoped: boolean;\n\tpublisherId: string | null;\n\tpublisherDisplayName: string | null;\n}\n\nexport const enum SortBy {\n\tNoneOrRelevance = 0,\n\tLastUpdatedDate = 1,\n\tTitle = 2,\n\tPublisherName = 3,\n\tInstallCount = 4,\n\tPublishedDate = 5,\n\tAverageRating = 6,\n\tWeightedRating = 12\n}\n\nexport const enum SortOrder {\n\tDefault = 0,\n\tAscending = 1,\n\tDescending = 2\n}\n\nexport interface IQueryOptions {\n\ttext?: string;\n\tids?: string[];\n\tnames?: string[];\n\tpageSize?: number;\n\tsortBy?: SortBy;\n\tsortOrder?: SortOrder;\n\tsource?: string;\n}\n\nexport const enum StatisticType {\n\tUninstall = 'uninstall'\n}\n\nexport interface IReportedExtension {\n\tid: IExtensionIdentifier;\n\tmalicious: boolean;\n}\n\nexport const enum InstallOperation {\n\tNone = 0,\n\tInstall,\n\tUpdate\n}\n\nexport interface ITranslation {\n\tcontents: { [key: string]: {} };\n}\n\nexport const IExtensionGalleryService = createDecorator<IExtensionGalleryService>('extensionGalleryService');\nexport interface IExtensionGalleryService {\n\treadonly _serviceBrand: undefined;\n\tisEnabled(): boolean;\n\tquery(token: CancellationToken): Promise<IPager<IGalleryExtension>>;\n\tquery(options: IQueryOptions, token: CancellationToken): Promise<IPager<IGalleryExtension>>;\n\tgetExtensions(ids: string[], token: CancellationToken): Promise<IGalleryExtension[]>;\n\tdownload(extension: IGalleryExtension, location: URI, operation: InstallOperation): Promise<void>;\n\treportStatistic(publisher: string, name: string, version: string, type: StatisticType): Promise<void>;\n\tgetReadme(extension: IGalleryExtension, token: CancellationToken): Promise<string>;\n\tgetManifest(extension: IGalleryExtension, token: CancellationToken): Promise<IExtensionManifest | null>;\n\tgetChangelog(extension: IGalleryExtension, token: CancellationToken): Promise<string>;\n\tgetCoreTranslation(extension: IGalleryExtension, languageId: string): Promise<ITranslation | null>;\n\tgetAllVersions(extension: IGalleryExtension, compatible: boolean): Promise<IGalleryExtensionVersion[]>;\n\tgetExtensionsReport(): Promise<IReportedExtension[]>;\n\tgetCompatibleExtension(extension: IGalleryExtension): Promise<IGalleryExtension | null>;\n\tgetCompatibleExtension(id: IExtensionIdentifier, version?: string): Promise<IGalleryExtension | null>;\n}\n\nexport interface InstallExtensionEvent {\n\tidentifier: IExtensionIdentifier;\n\tzipPath?: string;\n\tgallery?: IGalleryExtension;\n}\n\nexport interface DidInstallExtensionEvent {\n\tidentifier: IExtensionIdentifier;\n\toperation: InstallOperation;\n\tzipPath?: string;\n\tgallery?: IGalleryExtension;\n\tlocal?: ILocalExtension;\n\terror?: string;\n}\n\nexport interface DidUninstallExtensionEvent {\n\tidentifier: IExtensionIdentifier;\n\terror?: string;\n}\n\nexport const INSTALL_ERROR_NOT_SUPPORTED = 'notsupported';\nexport const INSTALL_ERROR_MALICIOUS = 'malicious';\nexport const INSTALL_ERROR_INCOMPATIBLE = 'incompatible';\n\nexport class ExtensionManagementError extends Error {\n\tconstructor(message: string, readonly code: string) {\n\t\tsuper(message);\n\t}\n}\n\nexport type InstallOptions = { isBuiltin?: boolean, isMachineScoped?: boolean, donotIncludePackAndDependencies?: boolean };\nexport type UninstallOptions = { donotIncludePack?: boolean, donotCheckDependents?: boolean };\n\nexport const IExtensionManagementService = createDecorator<IExtensionManagementService>('extensionManagementService');\nexport interface IExtensionManagementService {\n\treadonly _serviceBrand: undefined;\n\n\tonInstallExtension: Event<InstallExtensionEvent>;\n\tonDidInstallExtension: Event<DidInstallExtensionEvent>;\n\tonUninstallExtension: Event<IExtensionIdentifier>;\n\tonDidUninstallExtension: Event<DidUninstallExtensionEvent>;\n\n\tzip(extension: ILocalExtension): Promise<URI>;\n\tunzip(zipLocation: URI): Promise<IExtensionIdentifier>;\n\tgetManifest(vsix: URI): Promise<IExtensionManifest>;\n\tinstall(vsix: URI, options?: InstallOptions): Promise<ILocalExtension>;\n\tcanInstall(extension: IGalleryExtension): Promise<boolean>;\n\tinstallFromGallery(extension: IGalleryExtension, options?: InstallOptions): Promise<ILocalExtension>;\n\tuninstall(extension: ILocalExtension, options?: UninstallOptions): Promise<void>;\n\treinstallFromGallery(extension: ILocalExtension): Promise<void>;\n\tgetInstalled(type?: ExtensionType): Promise<ILocalExtension[]>;\n\tgetExtensionsReport(): Promise<IReportedExtension[]>;\n\n\tupdateMetadata(local: ILocalExtension, metadata: IGalleryMetadata): Promise<ILocalExtension>;\n\tupdateExtensionScope(local: ILocalExtension, isMachineScoped: boolean): Promise<ILocalExtension>;\n}\n\nexport const DISABLED_EXTENSIONS_STORAGE_PATH = 'extensionsIdentifiers/disabled';\nexport const ENABLED_EXTENSIONS_STORAGE_PATH = 'extensionsIdentifiers/enabled';\nexport const IGlobalExtensionEnablementService = createDecorator<IGlobalExtensionEnablementService>('IGlobalExtensionEnablementService');\n\nexport interface IGlobalExtensionEnablementService {\n\treadonly _serviceBrand: undefined;\n\treadonly onDidChangeEnablement: Event<{ readonly extensions: IExtensionIdentifier[], readonly source?: string }>;\n\n\tgetDisabledExtensions(): IExtensionIdentifier[];\n\tenableExtension(extension: IExtensionIdentifier, source?: string): Promise<boolean>;\n\tdisableExtension(extension: IExtensionIdentifier, source?: string): Promise<boolean>;\n\n}\n\nexport type IConfigBasedExtensionTip = {\n\treadonly extensionId: string,\n\treadonly extensionName: string,\n\treadonly isExtensionPack: boolean,\n\treadonly configName: string,\n\treadonly important: boolean,\n};\n\nexport type IExecutableBasedExtensionTip = {\n\treadonly extensionId: string,\n\treadonly extensionName: string,\n\treadonly isExtensionPack: boolean,\n\treadonly exeName: string,\n\treadonly exeFriendlyName: string,\n\treadonly windowsPath?: string,\n};\n\nexport type IWorkspaceTips = { readonly remoteSet: string[]; readonly recommendations: string[]; };\n\nexport const IExtensionTipsService = createDecorator<IExtensionTipsService>('IExtensionTipsService');\nexport interface IExtensionTipsService {\n\treadonly _serviceBrand: undefined;\n\n\tgetConfigBasedTips(folder: URI): Promise<IConfigBasedExtensionTip[]>;\n\tgetImportantExecutableBasedTips(): Promise<IExecutableBasedExtensionTip[]>;\n\tgetOtherExecutableBasedTips(): Promise<IExecutableBasedExtensionTip[]>;\n\tgetAllWorkspacesTips(): Promise<IWorkspaceTips[]>;\n}\n\n\nexport const DefaultIconPath = FileAccess.asBrowserUri('./media/defaultIcon.png', require).toString(true);\nexport const ExtensionsLabel = localize('extensions', \"Extensions\");\nexport const ExtensionsLocalizedLabel = { value: ExtensionsLabel, original: 'Extensions' };\nexport const ExtensionsChannelId = 'extensions';\nexport const PreferencesLabel = localize('preferences', \"Preferences\");\nexport const PreferencesLocalizedLabel = { value: PreferencesLabel, original: 'Preferences' };\n\n\nexport interface CLIOutput {\n\tlog(s: string): void;\n\terror(s: string): void;\n}\n\nexport const IExtensionManagementCLIService = createDecorator<IExtensionManagementCLIService>('IExtensionManagementCLIService');\nexport interface IExtensionManagementCLIService {\n\treadonly _serviceBrand: undefined;\n\n\tlistExtensions(showVersions: boolean, category?: string, output?: CLIOutput): Promise<void>;\n\tinstallExtensions(extensions: (string | URI)[], builtinExtensionIds: string[], isMachineScoped: boolean, force: boolean, output?: CLIOutput): Promise<void>;\n\tuninstallExtensions(extensions: (string | URI)[], force: boolean, output?: CLIOutput): Promise<void>;\n\tlocateExtension(extensions: string[], output?: CLIOutput): Promise<void>;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as strings from 'vs/base/common/strings';\nimport { ILocalization } from 'vs/platform/localizations/common/localizations';\nimport { URI } from 'vs/base/common/uri';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\n\nexport const MANIFEST_CACHE_FOLDER = 'CachedExtensions';\nexport const USER_MANIFEST_CACHE_FILE = 'user';\nexport const BUILTIN_MANIFEST_CACHE_FILE = 'builtin';\n\nexport interface ICommand {\n\tcommand: string;\n\ttitle: string;\n\tcategory?: string;\n}\n\nexport interface IConfigurationProperty {\n\tdescription: string;\n\ttype: string | string[];\n\tdefault?: any;\n}\n\nexport interface IConfiguration {\n\tproperties: { [key: string]: IConfigurationProperty; };\n}\n\nexport interface IDebugger {\n\tlabel?: string;\n\ttype: string;\n\truntime?: string;\n}\n\nexport interface IGrammar {\n\tlanguage: string;\n}\n\nexport interface IJSONValidation {\n\tfileMatch: string | string[];\n\turl: string;\n}\n\nexport interface IKeyBinding {\n\tcommand: string;\n\tkey: string;\n\twhen?: string;\n\tmac?: string;\n\tlinux?: string;\n\twin?: string;\n}\n\nexport interface ILanguage {\n\tid: string;\n\textensions: string[];\n\taliases: string[];\n}\n\nexport interface IMenu {\n\tcommand: string;\n\talt?: string;\n\twhen?: string;\n\tgroup?: string;\n}\n\nexport interface ISnippet {\n\tlanguage: string;\n}\n\nexport interface ITheme {\n\tlabel: string;\n}\n\nexport interface IViewContainer {\n\tid: string;\n\ttitle: string;\n}\n\nexport interface IView {\n\tid: string;\n\tname: string;\n}\n\nexport interface IColor {\n\tid: string;\n\tdescription: string;\n\tdefaults: { light: string, dark: string, highContrast: string };\n}\n\nexport interface IWebviewEditor {\n\treadonly viewType: string;\n\treadonly priority: string;\n\treadonly selector: readonly {\n\t\treadonly filenamePattern?: string;\n\t}[];\n}\n\nexport interface ICodeActionContributionAction {\n\treadonly kind: string;\n\treadonly title: string;\n\treadonly description?: string;\n}\n\nexport interface ICodeActionContribution {\n\treadonly languages: readonly string[];\n\treadonly actions: readonly ICodeActionContributionAction[];\n}\n\nexport interface IAuthenticationContribution {\n\treadonly id: string;\n\treadonly label: string;\n}\n\nexport interface IExtensionContributions {\n\tcommands?: ICommand[];\n\tconfiguration?: IConfiguration | IConfiguration[];\n\tdebuggers?: IDebugger[];\n\tgrammars?: IGrammar[];\n\tjsonValidation?: IJSONValidation[];\n\tkeybindings?: IKeyBinding[];\n\tlanguages?: ILanguage[];\n\tmenus?: { [context: string]: IMenu[] };\n\tsnippets?: ISnippet[];\n\tthemes?: ITheme[];\n\ticonThemes?: ITheme[];\n\tviewsContainers?: { [location: string]: IViewContainer[] };\n\tviews?: { [location: string]: IView[] };\n\tcolors?: IColor[];\n\tlocalizations?: ILocalization[];\n\treadonly customEditors?: readonly IWebviewEditor[];\n\treadonly codeActions?: readonly ICodeActionContribution[];\n\tauthentication?: IAuthenticationContribution[];\n}\n\nexport type ExtensionKind = 'ui' | 'workspace' | 'web';\n\nexport function isIExtensionIdentifier(thing: any): thing is IExtensionIdentifier {\n\treturn thing\n\t\t&& typeof thing === 'object'\n\t\t&& typeof thing.id === 'string'\n\t\t&& (!thing.uuid || typeof thing.uuid === 'string');\n}\n\nexport interface IExtensionIdentifier {\n\tid: string;\n\tuuid?: string;\n}\n\nexport const EXTENSION_CATEGORIES = [\n\t'Azure',\n\t'Data Science',\n\t'Debuggers',\n\t'Extension Packs',\n\t'Formatters',\n\t'Keymaps',\n\t'Language Packs',\n\t'Linters',\n\t'Machine Learning',\n\t'Notebooks',\n\t'Programming Languages',\n\t'SCM Providers',\n\t'Snippets',\n\t'Themes',\n\t'Testing',\n\t'Visualization',\n\t'Other',\n];\n\nexport interface IExtensionManifest {\n\treadonly name: string;\n\treadonly displayName?: string;\n\treadonly publisher: string;\n\treadonly version: string;\n\treadonly engines: { vscode: string };\n\treadonly description?: string;\n\treadonly main?: string;\n\treadonly browser?: string;\n\treadonly icon?: string;\n\treadonly categories?: string[];\n\treadonly keywords?: string[];\n\treadonly activationEvents?: string[];\n\treadonly extensionDependencies?: string[];\n\treadonly extensionPack?: string[];\n\treadonly extensionKind?: ExtensionKind | ExtensionKind[];\n\treadonly contributes?: IExtensionContributions;\n\treadonly repository?: { url: string; };\n\treadonly bugs?: { url: string; };\n\treadonly enableProposedApi?: boolean;\n\treadonly api?: string;\n\treadonly scripts?: { [key: string]: string; };\n}\n\nexport const enum ExtensionType {\n\tSystem,\n\tUser\n}\n\nexport interface IExtension {\n\treadonly type: ExtensionType;\n\treadonly isBuiltin: boolean;\n\treadonly identifier: IExtensionIdentifier;\n\treadonly manifest: IExtensionManifest;\n\treadonly location: URI;\n\treadonly readmeUrl?: URI;\n\treadonly changelogUrl?: URI;\n}\n\n/**\n * **!Do not construct directly!**\n *\n * **!Only static methods because it gets serialized!**\n *\n * This represents the \"canonical\" version for an extension identifier. Extension ids\n * have to be case-insensitive (due to the marketplace), but we must ensure case\n * preservation because the extension API is already public at this time.\n *\n * For example, given an extension with the publisher `\"Hello\"` and the name `\"World\"`,\n * its canonical extension identifier is `\"Hello.World\"`. This extension could be\n * referenced in some other extension's dependencies using the string `\"hello.world\"`.\n *\n * To make matters more complicated, an extension can optionally have an UUID. When two\n * extensions have the same UUID, they are considered equal even if their identifier is different.\n */\nexport class ExtensionIdentifier {\n\tpublic readonly value: string;\n\tprivate readonly _lower: string;\n\n\tconstructor(value: string) {\n\t\tthis.value = value;\n\t\tthis._lower = value.toLowerCase();\n\t}\n\n\tpublic static equals(a: ExtensionIdentifier | string | null | undefined, b: ExtensionIdentifier | string | null | undefined) {\n\t\tif (typeof a === 'undefined' || a === null) {\n\t\t\treturn (typeof b === 'undefined' || b === null);\n\t\t}\n\t\tif (typeof b === 'undefined' || b === null) {\n\t\t\treturn false;\n\t\t}\n\t\tif (typeof a === 'string' || typeof b === 'string') {\n\t\t\t// At least one of the arguments is an extension id in string form,\n\t\t\t// so we have to use the string comparison which ignores case.\n\t\t\tlet aValue = (typeof a === 'string' ? a : a.value);\n\t\t\tlet bValue = (typeof b === 'string' ? b : b.value);\n\t\t\treturn strings.equalsIgnoreCase(aValue, bValue);\n\t\t}\n\n\t\t// Now we know both arguments are ExtensionIdentifier\n\t\treturn (a._lower === b._lower);\n\t}\n\n\t/**\n\t * Gives the value by which to index (for equality).\n\t */\n\tpublic static toKey(id: ExtensionIdentifier | string): string {\n\t\tif (typeof id === 'string') {\n\t\t\treturn id.toLowerCase();\n\t\t}\n\t\treturn id._lower;\n\t}\n}\n\nexport interface IExtensionDescription extends IExtensionManifest {\n\treadonly identifier: ExtensionIdentifier;\n\treadonly uuid?: string;\n\treadonly isBuiltin: boolean;\n\treadonly isUserBuiltin: boolean;\n\treadonly isUnderDevelopment: boolean;\n\treadonly extensionLocation: URI;\n\tenableProposedApi?: boolean;\n}\n\nexport function isLanguagePackExtension(manifest: IExtensionManifest): boolean {\n\treturn manifest.contributes && manifest.contributes.localizations ? manifest.contributes.localizations.length > 0 : false;\n}\n\nexport function isAuthenticaionProviderExtension(manifest: IExtensionManifest): boolean {\n\treturn manifest.contributes && manifest.contributes.authentication ? manifest.contributes.authentication.length > 0 : false;\n}\n\nexport interface IScannedExtension {\n\treadonly identifier: IExtensionIdentifier;\n\treadonly location: URI;\n\treadonly type: ExtensionType;\n\treadonly packageJSON: IExtensionManifest;\n\treadonly packageNLS?: any;\n\treadonly packageNLSUrl?: URI;\n\treadonly readmeUrl?: URI;\n\treadonly changelogUrl?: URI;\n}\n\nexport interface ITranslatedScannedExtension {\n\treadonly identifier: IExtensionIdentifier;\n\treadonly location: URI;\n\treadonly type: ExtensionType;\n\treadonly packageJSON: IExtensionManifest;\n\treadonly readmeUrl?: URI;\n\treadonly changelogUrl?: URI;\n}\n\nexport const IBuiltinExtensionsScannerService = createDecorator<IBuiltinExtensionsScannerService>('IBuiltinExtensionsScannerService');\nexport interface IBuiltinExtensionsScannerService {\n\treadonly _serviceBrand: undefined;\n\tscanBuiltinExtensions(): Promise<IScannedExtension[]>;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ILocalExtension, IGalleryExtension, IExtensionIdentifier, IReportedExtension, IExtensionIdentifierWithVersion } from 'vs/platform/extensionManagement/common/extensionManagement';\nimport { compareIgnoreCase } from 'vs/base/common/strings';\nimport { ExtensionIdentifier } from 'vs/platform/extensions/common/extensions';\n\nexport function areSameExtensions(a: IExtensionIdentifier, b: IExtensionIdentifier): boolean {\n\tif (a.uuid && b.uuid) {\n\t\treturn a.uuid === b.uuid;\n\t}\n\tif (a.id === b.id) {\n\t\treturn true;\n\t}\n\treturn compareIgnoreCase(a.id, b.id) === 0;\n}\n\nexport class ExtensionIdentifierWithVersion implements IExtensionIdentifierWithVersion {\n\n\treadonly id: string;\n\treadonly uuid?: string;\n\n\tconstructor(\n\t\tidentifier: IExtensionIdentifier,\n\t\treadonly version: string\n\t) {\n\t\tthis.id = identifier.id;\n\t\tthis.uuid = identifier.uuid;\n\t}\n\n\tkey(): string {\n\t\treturn `${this.id}-${this.version}`;\n\t}\n\n\tequals(o: any): boolean {\n\t\tif (!(o instanceof ExtensionIdentifierWithVersion)) {\n\t\t\treturn false;\n\t\t}\n\t\treturn areSameExtensions(this, o) && this.version === o.version;\n\t}\n}\n\nexport function getExtensionId(publisher: string, name: string): string {\n\treturn `${publisher}.${name}`;\n}\n\nexport function adoptToGalleryExtensionId(id: string): string {\n\treturn id.toLocaleLowerCase();\n}\n\nexport function getGalleryExtensionId(publisher: string, name: string): string {\n\treturn adoptToGalleryExtensionId(getExtensionId(publisher, name));\n}\n\nexport function groupByExtension<T>(extensions: T[], getExtensionIdentifier: (t: T) => IExtensionIdentifier): T[][] {\n\tconst byExtension: T[][] = [];\n\tconst findGroup = (extension: T) => {\n\t\tfor (const group of byExtension) {\n\t\t\tif (group.some(e => areSameExtensions(getExtensionIdentifier(e), getExtensionIdentifier(extension)))) {\n\t\t\t\treturn group;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t};\n\tfor (const extension of extensions) {\n\t\tconst group = findGroup(extension);\n\t\tif (group) {\n\t\t\tgroup.push(extension);\n\t\t} else {\n\t\t\tbyExtension.push([extension]);\n\t\t}\n\t}\n\treturn byExtension;\n}\n\nexport function getLocalExtensionTelemetryData(extension: ILocalExtension): any {\n\treturn {\n\t\tid: extension.identifier.id,\n\t\tname: extension.manifest.name,\n\t\tgalleryId: null,\n\t\tpublisherId: extension.publisherId,\n\t\tpublisherName: extension.manifest.publisher,\n\t\tpublisherDisplayName: extension.publisherDisplayName,\n\t\tdependencies: extension.manifest.extensionDependencies && extension.manifest.extensionDependencies.length > 0\n\t};\n}\n\n\n/* __GDPR__FRAGMENT__\n\t\"GalleryExtensionTelemetryData\" : {\n\t\t\"id\" : { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" },\n\t\t\"name\": { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" },\n\t\t\"galleryId\": { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" },\n\t\t\"publisherId\": { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" },\n\t\t\"publisherName\": { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" },\n\t\t\"publisherDisplayName\": { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" },\n\t\t\"dependencies\": { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\", \"isMeasurement\": true },\n\t\t\"${include}\": [\n\t\t\t\"${GalleryExtensionTelemetryData2}\"\n\t\t]\n\t}\n*/\nexport function getGalleryExtensionTelemetryData(extension: IGalleryExtension): any {\n\treturn {\n\t\tid: extension.identifier.id,\n\t\tname: extension.name,\n\t\tgalleryId: extension.identifier.uuid,\n\t\tpublisherId: extension.publisherId,\n\t\tpublisherName: extension.publisher,\n\t\tpublisherDisplayName: extension.publisherDisplayName,\n\t\tdependencies: !!(extension.properties.dependencies && extension.properties.dependencies.length > 0),\n\t\t...extension.telemetryData\n\t};\n}\n\nexport const BetterMergeId = new ExtensionIdentifier('pprice.better-merge');\n\nexport function getMaliciousExtensionsSet(report: IReportedExtension[]): Set<string> {\n\tconst result = new Set<string>();\n\n\tfor (const extension of report) {\n\t\tif (extension.malicious) {\n\t\t\tresult.add(extension.id.id);\n\t\t}\n\t}\n\n\treturn result;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from 'vs/nls';\nimport { sep } from 'vs/base/common/path';\nimport { URI } from 'vs/base/common/uri';\nimport * as glob from 'vs/base/common/glob';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { Event } from 'vs/base/common/event';\nimport { startsWithIgnoreCase } from 'vs/base/common/strings';\nimport { IDisposable } from 'vs/base/common/lifecycle';\nimport { isNumber, isUndefinedOrNull } from 'vs/base/common/types';\nimport { VSBuffer, VSBufferReadable, VSBufferReadableStream } from 'vs/base/common/buffer';\nimport { ReadableStreamEvents } from 'vs/base/common/stream';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { TernarySearchTree } from 'vs/base/common/map';\n\nexport const IFileService = createDecorator<IFileService>('fileService');\n\nexport interface IFileService {\n\n\treadonly _serviceBrand: undefined;\n\n\t/**\n\t * An event that is fired when a file system provider is added or removed\n\t */\n\treadonly onDidChangeFileSystemProviderRegistrations: Event<IFileSystemProviderRegistrationEvent>;\n\n\t/**\n\t * An event that is fired when a registered file system provider changes it's capabilities.\n\t */\n\treadonly onDidChangeFileSystemProviderCapabilities: Event<IFileSystemProviderCapabilitiesChangeEvent>;\n\n\t/**\n\t * An event that is fired when a file system provider is about to be activated. Listeners\n\t * can join this event with a long running promise to help in the activation process.\n\t */\n\treadonly onWillActivateFileSystemProvider: Event<IFileSystemProviderActivationEvent>;\n\n\t/**\n\t * Registers a file system provider for a certain scheme.\n\t */\n\tregisterProvider(scheme: string, provider: IFileSystemProvider): IDisposable;\n\n\t/**\n\t * Tries to activate a provider with the given scheme.\n\t */\n\tactivateProvider(scheme: string): Promise<void>;\n\n\t/**\n\t * Checks if this file service can handle the given resource.\n\t */\n\tcanHandleResource(resource: URI): boolean;\n\n\t/**\n\t * Checks if the provider for the provided resource has the provided file system capability.\n\t */\n\thasCapability(resource: URI, capability: FileSystemProviderCapabilities): boolean;\n\n\t/**\n\t * List the schemes and capabilies for registered file system providers\n\t */\n\tlistCapabilities(): Iterable<{ scheme: string, capabilities: FileSystemProviderCapabilities }>\n\n\t/**\n\t * Allows to listen for file changes. The event will fire for every file within the opened workspace\n\t * (if any) as well as all files that have been watched explicitly using the #watch() API.\n\t */\n\treadonly onDidFilesChange: Event<FileChangesEvent>;\n\n\t/**\n\t * An event that is fired upon successful completion of a certain file operation.\n\t */\n\treadonly onDidRunOperation: Event<FileOperationEvent>;\n\n\t/**\n\t * Resolve the properties of a file/folder identified by the resource.\n\t *\n\t * If the optional parameter \"resolveTo\" is specified in options, the stat service is asked\n\t * to provide a stat object that should contain the full graph of folders up to all of the\n\t * target resources.\n\t *\n\t * If the optional parameter \"resolveSingleChildDescendants\" is specified in options,\n\t * the stat service is asked to automatically resolve child folders that only\n\t * contain a single element.\n\t *\n\t * If the optional parameter \"resolveMetadata\" is specified in options,\n\t * the stat will contain metadata information such as size, mtime and etag.\n\t */\n\tresolve(resource: URI, options: IResolveMetadataFileOptions): Promise<IFileStatWithMetadata>;\n\tresolve(resource: URI, options?: IResolveFileOptions): Promise<IFileStat>;\n\n\t/**\n\t * Same as resolve() but supports resolving multiple resources in parallel.\n\t * If one of the resolve targets fails to resolve returns a fake IFileStat instead of making the whole call fail.\n\t */\n\tresolveAll(toResolve: { resource: URI, options: IResolveMetadataFileOptions }[]): Promise<IResolveFileResult[]>;\n\tresolveAll(toResolve: { resource: URI, options?: IResolveFileOptions }[]): Promise<IResolveFileResult[]>;\n\n\t/**\n\t * Finds out if a file/folder identified by the resource exists.\n\t */\n\texists(resource: URI): Promise<boolean>;\n\n\t/**\n\t * Read the contents of the provided resource unbuffered.\n\t */\n\treadFile(resource: URI, options?: IReadFileOptions): Promise<IFileContent>;\n\n\t/**\n\t * Read the contents of the provided resource buffered as stream.\n\t */\n\treadFileStream(resource: URI, options?: IReadFileOptions): Promise<IFileStreamContent>;\n\n\t/**\n\t * Updates the content replacing its previous value.\n\t */\n\twriteFile(resource: URI, bufferOrReadableOrStream: VSBuffer | VSBufferReadable | VSBufferReadableStream, options?: IWriteFileOptions): Promise<IFileStatWithMetadata>;\n\n\t/**\n\t * Moves the file/folder to a new path identified by the resource.\n\t *\n\t * The optional parameter overwrite can be set to replace an existing file at the location.\n\t */\n\tmove(source: URI, target: URI, overwrite?: boolean): Promise<IFileStatWithMetadata>;\n\n\t/**\n\t * Find out if a move operation is possible given the arguments. No changes on disk will\n\t * be performed. Returns an Error if the operation cannot be done.\n\t */\n\tcanMove(source: URI, target: URI, overwrite?: boolean): Promise<Error | true>;\n\n\t/**\n\t * Copies the file/folder to a path identified by the resource.\n\t *\n\t * The optional parameter overwrite can be set to replace an existing file at the location.\n\t */\n\tcopy(source: URI, target: URI, overwrite?: boolean): Promise<IFileStatWithMetadata>;\n\n\t/**\n\t * Find out if a copy operation is possible given the arguments. No changes on disk will\n\t * be performed. Returns an Error if the operation cannot be done.\n\t */\n\tcanCopy(source: URI, target: URI, overwrite?: boolean): Promise<Error | true>;\n\n\t/**\n\t * Find out if a file create operation is possible given the arguments. No changes on disk will\n\t * be performed. Returns an Error if the operation cannot be done.\n\t */\n\tcanCreateFile(resource: URI, options?: ICreateFileOptions): Promise<Error | true>;\n\n\t/**\n\t * Creates a new file with the given path and optional contents. The returned promise\n\t * will have the stat model object as a result.\n\t *\n\t * The optional parameter content can be used as value to fill into the new file.\n\t */\n\tcreateFile(resource: URI, bufferOrReadableOrStream?: VSBuffer | VSBufferReadable | VSBufferReadableStream, options?: ICreateFileOptions): Promise<IFileStatWithMetadata>;\n\n\t/**\n\t * Creates a new folder with the given path. The returned promise\n\t * will have the stat model object as a result.\n\t */\n\tcreateFolder(resource: URI): Promise<IFileStatWithMetadata>;\n\n\t/**\n\t * Deletes the provided file. The optional useTrash parameter allows to\n\t * move the file to trash. The optional recursive parameter allows to delete\n\t * non-empty folders recursively.\n\t */\n\tdel(resource: URI, options?: { useTrash?: boolean, recursive?: boolean }): Promise<void>;\n\n\t/**\n\t * Find out if a delete operation is possible given the arguments. No changes on disk will\n\t * be performed. Returns an Error if the operation cannot be done.\n\t */\n\tcanDelete(resource: URI, options?: { useTrash?: boolean, recursive?: boolean }): Promise<Error | true>;\n\n\t/**\n\t * Allows to start a watcher that reports file/folder change events on the provided resource.\n\t *\n\t * Note: watching a folder does not report events recursively for child folders yet.\n\t */\n\twatch(resource: URI): IDisposable;\n\n\t/**\n\t * Frees up any resources occupied by this service.\n\t */\n\tdispose(): void;\n}\n\nexport interface FileOverwriteOptions {\n\toverwrite: boolean;\n}\n\nexport interface FileReadStreamOptions {\n\n\t/**\n\t * Is an integer specifying where to begin reading from in the file. If position is undefined,\n\t * data will be read from the current file position.\n\t */\n\treadonly position?: number;\n\n\t/**\n\t * Is an integer specifying how many bytes to read from the file. By default, all bytes\n\t * will be read.\n\t */\n\treadonly length?: number;\n\n\t/**\n\t * If provided, the size of the file will be checked against the limits.\n\t */\n\tlimits?: {\n\t\treadonly size?: number;\n\t\treadonly memory?: number;\n\t};\n}\n\nexport interface FileWriteOptions {\n\toverwrite: boolean;\n\tcreate: boolean;\n}\n\nexport interface FileOpenOptions {\n\tcreate: boolean;\n}\n\nexport interface FileDeleteOptions {\n\trecursive: boolean;\n\tuseTrash: boolean;\n}\n\nexport enum FileType {\n\tUnknown = 0,\n\tFile = 1,\n\tDirectory = 2,\n\tSymbolicLink = 64\n}\n\nexport interface IStat {\n\ttype: FileType;\n\n\t/**\n\t * The last modification date represented as millis from unix epoch.\n\t */\n\tmtime: number;\n\n\t/**\n\t * The creation date represented as millis from unix epoch.\n\t */\n\tctime: number;\n\n\tsize: number;\n}\n\nexport interface IWatchOptions {\n\trecursive: boolean;\n\texcludes: string[];\n}\n\nexport const enum FileSystemProviderCapabilities {\n\tFileReadWrite = 1 << 1,\n\tFileOpenReadWriteClose = 1 << 2,\n\tFileReadStream = 1 << 4,\n\n\tFileFolderCopy = 1 << 3,\n\n\tPathCaseSensitive = 1 << 10,\n\tReadonly = 1 << 11,\n\n\tTrash = 1 << 12\n}\n\nexport interface IFileSystemProvider {\n\n\treadonly capabilities: FileSystemProviderCapabilities;\n\treadonly onDidChangeCapabilities: Event<void>;\n\n\treadonly onDidErrorOccur?: Event<string>; // TODO@bpasero remove once file watchers are solid\n\n\treadonly onDidChangeFile: Event<readonly IFileChange[]>;\n\twatch(resource: URI, opts: IWatchOptions): IDisposable;\n\n\tstat(resource: URI): Promise<IStat>;\n\tmkdir(resource: URI): Promise<void>;\n\treaddir(resource: URI): Promise<[string, FileType][]>;\n\tdelete(resource: URI, opts: FileDeleteOptions): Promise<void>;\n\n\trename(from: URI, to: URI, opts: FileOverwriteOptions): Promise<void>;\n\tcopy?(from: URI, to: URI, opts: FileOverwriteOptions): Promise<void>;\n\n\treadFile?(resource: URI): Promise<Uint8Array>;\n\twriteFile?(resource: URI, content: Uint8Array, opts: FileWriteOptions): Promise<void>;\n\n\treadFileStream?(resource: URI, opts: FileReadStreamOptions, token: CancellationToken): ReadableStreamEvents<Uint8Array>;\n\n\topen?(resource: URI, opts: FileOpenOptions): Promise<number>;\n\tclose?(fd: number): Promise<void>;\n\tread?(fd: number, pos: number, data: Uint8Array, offset: number, length: number): Promise<number>;\n\twrite?(fd: number, pos: number, data: Uint8Array, offset: number, length: number): Promise<number>;\n}\n\nexport interface IFileSystemProviderWithFileReadWriteCapability extends IFileSystemProvider {\n\treadFile(resource: URI): Promise<Uint8Array>;\n\twriteFile(resource: URI, content: Uint8Array, opts: FileWriteOptions): Promise<void>;\n}\n\nexport function hasReadWriteCapability(provider: IFileSystemProvider): provider is IFileSystemProviderWithFileReadWriteCapability {\n\treturn !!(provider.capabilities & FileSystemProviderCapabilities.FileReadWrite);\n}\n\nexport interface IFileSystemProviderWithFileFolderCopyCapability extends IFileSystemProvider {\n\tcopy(from: URI, to: URI, opts: FileOverwriteOptions): Promise<void>;\n}\n\nexport function hasFileFolderCopyCapability(provider: IFileSystemProvider): provider is IFileSystemProviderWithFileFolderCopyCapability {\n\treturn !!(provider.capabilities & FileSystemProviderCapabilities.FileFolderCopy);\n}\n\nexport interface IFileSystemProviderWithOpenReadWriteCloseCapability extends IFileSystemProvider {\n\topen(resource: URI, opts: FileOpenOptions): Promise<number>;\n\tclose(fd: number): Promise<void>;\n\tread(fd: number, pos: number, data: Uint8Array, offset: number, length: number): Promise<number>;\n\twrite(fd: number, pos: number, data: Uint8Array, offset: number, length: number): Promise<number>;\n}\n\nexport function hasOpenReadWriteCloseCapability(provider: IFileSystemProvider): provider is IFileSystemProviderWithOpenReadWriteCloseCapability {\n\treturn !!(provider.capabilities & FileSystemProviderCapabilities.FileOpenReadWriteClose);\n}\n\nexport interface IFileSystemProviderWithFileReadStreamCapability extends IFileSystemProvider {\n\treadFileStream(resource: URI, opts: FileReadStreamOptions, token: CancellationToken): ReadableStreamEvents<Uint8Array>;\n}\n\nexport function hasFileReadStreamCapability(provider: IFileSystemProvider): provider is IFileSystemProviderWithFileReadStreamCapability {\n\treturn !!(provider.capabilities & FileSystemProviderCapabilities.FileReadStream);\n}\n\nexport enum FileSystemProviderErrorCode {\n\tFileExists = 'EntryExists',\n\tFileNotFound = 'EntryNotFound',\n\tFileNotADirectory = 'EntryNotADirectory',\n\tFileIsADirectory = 'EntryIsADirectory',\n\tFileExceedsMemoryLimit = 'EntryExceedsMemoryLimit',\n\tFileTooLarge = 'EntryTooLarge',\n\tNoPermissions = 'NoPermissions',\n\tUnavailable = 'Unavailable',\n\tUnknown = 'Unknown'\n}\n\nexport class FileSystemProviderError extends Error {\n\n\tconstructor(message: string, public readonly code: FileSystemProviderErrorCode) {\n\t\tsuper(message);\n\t}\n}\n\nexport function createFileSystemProviderError(error: Error | string, code: FileSystemProviderErrorCode): FileSystemProviderError {\n\tconst providerError = new FileSystemProviderError(error.toString(), code);\n\tmarkAsFileSystemProviderError(providerError, code);\n\n\treturn providerError;\n}\n\nexport function ensureFileSystemProviderError(error?: Error): Error {\n\tif (!error) {\n\t\treturn createFileSystemProviderError(localize('unknownError', \"Unknown Error\"), FileSystemProviderErrorCode.Unknown); // https://github.com/microsoft/vscode/issues/72798\n\t}\n\n\treturn error;\n}\n\nexport function markAsFileSystemProviderError(error: Error, code: FileSystemProviderErrorCode): Error {\n\terror.name = code ? `${code} (FileSystemError)` : `FileSystemError`;\n\n\treturn error;\n}\n\nexport function toFileSystemProviderErrorCode(error: Error | undefined | null): FileSystemProviderErrorCode {\n\n\t// Guard against abuse\n\tif (!error) {\n\t\treturn FileSystemProviderErrorCode.Unknown;\n\t}\n\n\t// FileSystemProviderError comes with the code\n\tif (error instanceof FileSystemProviderError) {\n\t\treturn error.code;\n\t}\n\n\t// Any other error, check for name match by assuming that the error\n\t// went through the markAsFileSystemProviderError() method\n\tconst match = /^(.+) \\(FileSystemError\\)$/.exec(error.name);\n\tif (!match) {\n\t\treturn FileSystemProviderErrorCode.Unknown;\n\t}\n\n\tswitch (match[1]) {\n\t\tcase FileSystemProviderErrorCode.FileExists: return FileSystemProviderErrorCode.FileExists;\n\t\tcase FileSystemProviderErrorCode.FileIsADirectory: return FileSystemProviderErrorCode.FileIsADirectory;\n\t\tcase FileSystemProviderErrorCode.FileNotADirectory: return FileSystemProviderErrorCode.FileNotADirectory;\n\t\tcase FileSystemProviderErrorCode.FileNotFound: return FileSystemProviderErrorCode.FileNotFound;\n\t\tcase FileSystemProviderErrorCode.FileExceedsMemoryLimit: return FileSystemProviderErrorCode.FileExceedsMemoryLimit;\n\t\tcase FileSystemProviderErrorCode.FileTooLarge: return FileSystemProviderErrorCode.FileTooLarge;\n\t\tcase FileSystemProviderErrorCode.NoPermissions: return FileSystemProviderErrorCode.NoPermissions;\n\t\tcase FileSystemProviderErrorCode.Unavailable: return FileSystemProviderErrorCode.Unavailable;\n\t}\n\n\treturn FileSystemProviderErrorCode.Unknown;\n}\n\nexport function toFileOperationResult(error: Error): FileOperationResult {\n\n\t// FileSystemProviderError comes with the result already\n\tif (error instanceof FileOperationError) {\n\t\treturn error.fileOperationResult;\n\t}\n\n\t// Otherwise try to find from code\n\tswitch (toFileSystemProviderErrorCode(error)) {\n\t\tcase FileSystemProviderErrorCode.FileNotFound:\n\t\t\treturn FileOperationResult.FILE_NOT_FOUND;\n\t\tcase FileSystemProviderErrorCode.FileIsADirectory:\n\t\t\treturn FileOperationResult.FILE_IS_DIRECTORY;\n\t\tcase FileSystemProviderErrorCode.FileNotADirectory:\n\t\t\treturn FileOperationResult.FILE_NOT_DIRECTORY;\n\t\tcase FileSystemProviderErrorCode.NoPermissions:\n\t\t\treturn FileOperationResult.FILE_PERMISSION_DENIED;\n\t\tcase FileSystemProviderErrorCode.FileExists:\n\t\t\treturn FileOperationResult.FILE_MOVE_CONFLICT;\n\t\tcase FileSystemProviderErrorCode.FileExceedsMemoryLimit:\n\t\t\treturn FileOperationResult.FILE_EXCEEDS_MEMORY_LIMIT;\n\t\tcase FileSystemProviderErrorCode.FileTooLarge:\n\t\t\treturn FileOperationResult.FILE_TOO_LARGE;\n\t\tdefault:\n\t\t\treturn FileOperationResult.FILE_OTHER_ERROR;\n\t}\n}\n\nexport interface IFileSystemProviderRegistrationEvent {\n\tadded: boolean;\n\tscheme: string;\n\tprovider?: IFileSystemProvider;\n}\n\nexport interface IFileSystemProviderCapabilitiesChangeEvent {\n\tprovider: IFileSystemProvider;\n\tscheme: string;\n}\n\nexport interface IFileSystemProviderActivationEvent {\n\tscheme: string;\n\tjoin(promise: Promise<void>): void;\n}\n\nexport const enum FileOperation {\n\tCREATE,\n\tDELETE,\n\tMOVE,\n\tCOPY\n}\n\nexport class FileOperationEvent {\n\n\tconstructor(resource: URI, operation: FileOperation.DELETE);\n\tconstructor(resource: URI, operation: FileOperation.CREATE | FileOperation.MOVE | FileOperation.COPY, target: IFileStatWithMetadata);\n\tconstructor(public readonly resource: URI, public readonly operation: FileOperation, public readonly target?: IFileStatWithMetadata) { }\n\n\tisOperation(operation: FileOperation.DELETE): boolean;\n\tisOperation(operation: FileOperation.MOVE | FileOperation.COPY | FileOperation.CREATE): this is { readonly target: IFileStatWithMetadata };\n\tisOperation(operation: FileOperation): boolean {\n\t\treturn this.operation === operation;\n\t}\n}\n\n/**\n * Possible changes that can occur to a file.\n */\nexport const enum FileChangeType {\n\tUPDATED = 0,\n\tADDED = 1,\n\tDELETED = 2\n}\n\n/**\n * Identifies a single change in a file.\n */\nexport interface IFileChange {\n\n\t/**\n\t * The type of change that occurred to the file.\n\t */\n\treadonly type: FileChangeType;\n\n\t/**\n\t * The unified resource identifier of the file that changed.\n\t */\n\treadonly resource: URI;\n}\n\nexport class FileChangesEvent {\n\n\t/**\n\t * @deprecated use the `contains()` or `affects` method to efficiently find\n\t * out if the event relates to a given resource. these methods ensure:\n\t * - that there is no expensive lookup needed (by using a `TernarySearchTree`)\n\t * - correctly handles `FileChangeType.DELETED` events\n\t */\n\treadonly changes: readonly IFileChange[];\n\n\tprivate readonly added: TernarySearchTree<URI, IFileChange> | undefined = undefined;\n\tprivate readonly updated: TernarySearchTree<URI, IFileChange> | undefined = undefined;\n\tprivate readonly deleted: TernarySearchTree<URI, IFileChange> | undefined = undefined;\n\n\tconstructor(changes: readonly IFileChange[], private readonly ignorePathCasing: boolean) {\n\t\tthis.changes = changes;\n\n\t\tfor (const change of changes) {\n\t\t\tswitch (change.type) {\n\t\t\t\tcase FileChangeType.ADDED:\n\t\t\t\t\tif (!this.added) {\n\t\t\t\t\t\tthis.added = TernarySearchTree.forUris<IFileChange>(() => this.ignorePathCasing);\n\t\t\t\t\t}\n\t\t\t\t\tthis.added.set(change.resource, change);\n\t\t\t\t\tbreak;\n\t\t\t\tcase FileChangeType.UPDATED:\n\t\t\t\t\tif (!this.updated) {\n\t\t\t\t\t\tthis.updated = TernarySearchTree.forUris<IFileChange>(() => this.ignorePathCasing);\n\t\t\t\t\t}\n\t\t\t\t\tthis.updated.set(change.resource, change);\n\t\t\t\t\tbreak;\n\t\t\t\tcase FileChangeType.DELETED:\n\t\t\t\t\tif (!this.deleted) {\n\t\t\t\t\t\tthis.deleted = TernarySearchTree.forUris<IFileChange>(() => this.ignorePathCasing);\n\t\t\t\t\t}\n\t\t\t\t\tthis.deleted.set(change.resource, change);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Find out if the file change events match the provided resource.\n\t *\n\t * Note: when passing `FileChangeType.DELETED`, we consider a match\n\t * also when the parent of the resource got deleted.\n\t */\n\tcontains(resource: URI, ...types: FileChangeType[]): boolean {\n\t\treturn this.doContains(resource, { includeChildren: false }, ...types);\n\t}\n\n\t/**\n\t * Find out if the file change events either match the provided\n\t * resource, or contain a child of this resource.\n\t */\n\taffects(resource: URI, ...types: FileChangeType[]): boolean {\n\t\treturn this.doContains(resource, { includeChildren: true }, ...types);\n\t}\n\n\tprivate doContains(resource: URI, options: { includeChildren: boolean }, ...types: FileChangeType[]): boolean {\n\t\tif (!resource) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst hasTypesFilter = types.length > 0;\n\n\t\t// Added\n\t\tif (!hasTypesFilter || types.includes(FileChangeType.ADDED)) {\n\t\t\tif (this.added?.get(resource)) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (options.includeChildren && this.added?.findSuperstr(resource)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\t// Updated\n\t\tif (!hasTypesFilter || types.includes(FileChangeType.UPDATED)) {\n\t\t\tif (this.updated?.get(resource)) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (options.includeChildren && this.updated?.findSuperstr(resource)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\t// Deleted\n\t\tif (!hasTypesFilter || types.includes(FileChangeType.DELETED)) {\n\t\t\tif (this.deleted?.findSubstr(resource) /* deleted also considers parent folders */) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (options.includeChildren && this.deleted?.findSuperstr(resource)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * @deprecated use the `contains()` method to efficiently find out if the event\n\t * relates to a given resource. this method ensures:\n\t * - that there is no expensive lookup needed by using a `TernarySearchTree`\n\t * - correctly handles `FileChangeType.DELETED` events\n\t */\n\tgetAdded(): IFileChange[] {\n\t\treturn this.getOfType(FileChangeType.ADDED);\n\t}\n\n\t/**\n\t * Returns if this event contains added files.\n\t */\n\tgotAdded(): boolean {\n\t\treturn !!this.added;\n\t}\n\n\t/**\n\t * @deprecated use the `contains()` method to efficiently find out if the event\n\t * relates to a given resource. this method ensures:\n\t * - that there is no expensive lookup needed by using a `TernarySearchTree`\n\t * - correctly handles `FileChangeType.DELETED` events\n\t */\n\tgetDeleted(): IFileChange[] {\n\t\treturn this.getOfType(FileChangeType.DELETED);\n\t}\n\n\t/**\n\t * Returns if this event contains deleted files.\n\t */\n\tgotDeleted(): boolean {\n\t\treturn !!this.deleted;\n\t}\n\n\t/**\n\t * @deprecated use the `contains()` method to efficiently find out if the event\n\t * relates to a given resource. this method ensures:\n\t * - that there is no expensive lookup needed by using a `TernarySearchTree`\n\t * - correctly handles `FileChangeType.DELETED` events\n\t */\n\tgetUpdated(): IFileChange[] {\n\t\treturn this.getOfType(FileChangeType.UPDATED);\n\t}\n\n\t/**\n\t * Returns if this event contains updated files.\n\t */\n\tgotUpdated(): boolean {\n\t\treturn !!this.updated;\n\t}\n\n\tprivate getOfType(type: FileChangeType): IFileChange[] {\n\t\tconst changes: IFileChange[] = [];\n\n\t\tconst eventsForType = type === FileChangeType.ADDED ? this.added : type === FileChangeType.UPDATED ? this.updated : this.deleted;\n\t\tif (eventsForType) {\n\t\t\tfor (const [, change] of eventsForType) {\n\t\t\t\tchanges.push(change);\n\t\t\t}\n\t\t}\n\n\t\treturn changes;\n\t}\n\n\t/**\n\t * @deprecated use the `contains()` method to efficiently find out if the event\n\t * relates to a given resource. this method ensures:\n\t * - that there is no expensive lookup needed by using a `TernarySearchTree`\n\t * - correctly handles `FileChangeType.DELETED` events\n\t */\n\tfilter(filterFn: (change: IFileChange) => boolean): FileChangesEvent {\n\t\treturn new FileChangesEvent(this.changes.filter(change => filterFn(change)), this.ignorePathCasing);\n\t}\n}\n\nexport function isParent(path: string, candidate: string, ignoreCase?: boolean): boolean {\n\tif (!path || !candidate || path === candidate) {\n\t\treturn false;\n\t}\n\n\tif (candidate.length > path.length) {\n\t\treturn false;\n\t}\n\n\tif (candidate.charAt(candidate.length - 1) !== sep) {\n\t\tcandidate += sep;\n\t}\n\n\tif (ignoreCase) {\n\t\treturn startsWithIgnoreCase(path, candidate);\n\t}\n\n\treturn path.indexOf(candidate) === 0;\n}\n\ninterface IBaseStat {\n\n\t/**\n\t * The unified resource identifier of this file or folder.\n\t */\n\tresource: URI;\n\n\t/**\n\t * The name which is the last segment\n\t * of the {{path}}.\n\t */\n\tname: string;\n\n\t/**\n\t * The size of the file.\n\t *\n\t * The value may or may not be resolved as\n\t * it is optional.\n\t */\n\tsize?: number;\n\n\t/**\n\t * The last modification date represented as millis from unix epoch.\n\t *\n\t * The value may or may not be resolved as\n\t * it is optional.\n\t */\n\tmtime?: number;\n\n\t/**\n\t * The creation date represented as millis from unix epoch.\n\t *\n\t * The value may or may not be resolved as\n\t * it is optional.\n\t */\n\tctime?: number;\n\n\t/**\n\t * A unique identifier thet represents the\n\t * current state of the file or directory.\n\t *\n\t * The value may or may not be resolved as\n\t * it is optional.\n\t */\n\tetag?: string;\n}\n\nexport interface IBaseStatWithMetadata extends IBaseStat {\n\tmtime: number;\n\tctime: number;\n\tetag: string;\n\tsize: number;\n}\n\n/**\n * A file resource with meta information.\n */\nexport interface IFileStat extends IBaseStat {\n\n\t/**\n\t * The resource is a file.\n\t */\n\tisFile: boolean;\n\n\t/**\n\t * The resource is a directory.\n\t */\n\tisDirectory: boolean;\n\n\t/**\n\t * The resource is a symbolic link.\n\t */\n\tisSymbolicLink: boolean;\n\n\t/**\n\t * The children of the file stat or undefined if none.\n\t */\n\tchildren?: IFileStat[];\n}\n\nexport interface IFileStatWithMetadata extends IFileStat, IBaseStatWithMetadata {\n\tmtime: number;\n\tctime: number;\n\tetag: string;\n\tsize: number;\n\tchildren?: IFileStatWithMetadata[];\n}\n\nexport interface IResolveFileResult {\n\tstat?: IFileStat;\n\tsuccess: boolean;\n}\n\nexport interface IResolveFileResultWithMetadata extends IResolveFileResult {\n\tstat?: IFileStatWithMetadata;\n}\n\nexport interface IFileContent extends IBaseStatWithMetadata {\n\n\t/**\n\t * The content of a file as buffer.\n\t */\n\tvalue: VSBuffer;\n}\n\nexport interface IFileStreamContent extends IBaseStatWithMetadata {\n\n\t/**\n\t * The content of a file as stream.\n\t */\n\tvalue: VSBufferReadableStream;\n}\n\nexport interface IReadFileOptions extends FileReadStreamOptions {\n\n\t/**\n\t * The optional etag parameter allows to return early from resolving the resource if\n\t * the contents on disk match the etag. This prevents accumulated reading of resources\n\t * that have been read already with the same etag.\n\t * It is the task of the caller to makes sure to handle this error case from the promise.\n\t */\n\treadonly etag?: string;\n}\n\nexport interface IWriteFileOptions {\n\n\t/**\n\t * The last known modification time of the file. This can be used to prevent dirty writes.\n\t */\n\treadonly mtime?: number;\n\n\t/**\n\t * The etag of the file. This can be used to prevent dirty writes.\n\t */\n\treadonly etag?: string;\n}\n\nexport interface IResolveFileOptions {\n\n\t/**\n\t * Automatically continue resolving children of a directory until the provided resources\n\t * are found.\n\t */\n\treadonly resolveTo?: readonly URI[];\n\n\t/**\n\t * Automatically continue resolving children of a directory if the number of children is 1.\n\t */\n\treadonly resolveSingleChildDescendants?: boolean;\n\n\t/**\n\t * Will resolve mtime, ctime, size and etag of files if enabled. This can have a negative impact\n\t * on performance and thus should only be used when these values are required.\n\t */\n\treadonly resolveMetadata?: boolean;\n}\n\nexport interface IResolveMetadataFileOptions extends IResolveFileOptions {\n\treadonly resolveMetadata: true;\n}\n\nexport interface ICreateFileOptions {\n\n\t/**\n\t * Overwrite the file to create if it already exists on disk. Otherwise\n\t * an error will be thrown (FILE_MODIFIED_SINCE).\n\t */\n\treadonly overwrite?: boolean;\n}\n\nexport class FileOperationError extends Error {\n\tconstructor(message: string, public fileOperationResult: FileOperationResult, public options?: IReadFileOptions & IWriteFileOptions & ICreateFileOptions) {\n\t\tsuper(message);\n\t}\n\n\tstatic isFileOperationError(obj: unknown): obj is FileOperationError {\n\t\treturn obj instanceof Error && !isUndefinedOrNull((obj as FileOperationError).fileOperationResult);\n\t}\n}\n\nexport const enum FileOperationResult {\n\tFILE_IS_DIRECTORY,\n\tFILE_NOT_FOUND,\n\tFILE_NOT_MODIFIED_SINCE,\n\tFILE_MODIFIED_SINCE,\n\tFILE_MOVE_CONFLICT,\n\tFILE_READ_ONLY,\n\tFILE_PERMISSION_DENIED,\n\tFILE_TOO_LARGE,\n\tFILE_INVALID_PATH,\n\tFILE_EXCEEDS_MEMORY_LIMIT,\n\tFILE_NOT_DIRECTORY,\n\tFILE_OTHER_ERROR\n}\n\nexport const AutoSaveConfiguration = {\n\tOFF: 'off',\n\tAFTER_DELAY: 'afterDelay',\n\tON_FOCUS_CHANGE: 'onFocusChange',\n\tON_WINDOW_CHANGE: 'onWindowChange'\n};\n\nexport const HotExitConfiguration = {\n\tOFF: 'off',\n\tON_EXIT: 'onExit',\n\tON_EXIT_AND_WINDOW_CLOSE: 'onExitAndWindowClose'\n};\n\nexport const FILES_ASSOCIATIONS_CONFIG = 'files.associations';\nexport const FILES_EXCLUDE_CONFIG = 'files.exclude';\n\nexport interface IFilesConfiguration {\n\tfiles: {\n\t\tassociations: { [filepattern: string]: string };\n\t\texclude: glob.IExpression;\n\t\twatcherExclude: { [filepattern: string]: boolean };\n\t\tencoding: string;\n\t\tautoGuessEncoding: boolean;\n\t\tdefaultLanguage: string;\n\t\ttrimTrailingWhitespace: boolean;\n\t\tautoSave: string;\n\t\tautoSaveDelay: number;\n\t\teol: string;\n\t\tenableTrash: boolean;\n\t\thotExit: string;\n\t\tsaveConflictResolution: 'askUser' | 'overwriteFileOnDisk';\n\t};\n}\n\nexport enum FileKind {\n\tFILE,\n\tFOLDER,\n\tROOT_FOLDER\n}\n\n/**\n * A hint to disable etag checking for reading/writing.\n */\nexport const ETAG_DISABLED = '';\n\nexport function etag(stat: { mtime: number, size: number }): string;\nexport function etag(stat: { mtime: number | undefined, size: number | undefined }): string | undefined;\nexport function etag(stat: { mtime: number | undefined, size: number | undefined }): string | undefined {\n\tif (typeof stat.size !== 'number' || typeof stat.mtime !== 'number') {\n\t\treturn undefined;\n\t}\n\n\treturn stat.mtime.toString(29) + stat.size.toString(31);\n}\n\nexport async function whenProviderRegistered(file: URI, fileService: IFileService): Promise<void> {\n\tif (fileService.canHandleResource(URI.from({ scheme: file.scheme }))) {\n\t\treturn;\n\t}\n\n\treturn new Promise(resolve => {\n\t\tconst disposable = fileService.onDidChangeFileSystemProviderRegistrations(e => {\n\t\t\tif (e.scheme === file.scheme && e.added) {\n\t\t\t\tdisposable.dispose();\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t});\n}\n\n/**\n * Native only: limits for memory sizes\n */\nexport const MIN_MAX_MEMORY_SIZE_MB = 2048;\nexport const FALLBACK_MAX_MEMORY_SIZE_MB = 4096;\n\n/**\n * Helper to format a raw byte size into a human readable label.\n */\nexport class ByteSize {\n\tstatic readonly KB = 1024;\n\tstatic readonly MB = ByteSize.KB * ByteSize.KB;\n\tstatic readonly GB = ByteSize.MB * ByteSize.KB;\n\tstatic readonly TB = ByteSize.GB * ByteSize.KB;\n\n\tstatic formatSize(size: number): string {\n\t\tif (!isNumber(size)) {\n\t\t\tsize = 0;\n\t\t}\n\n\t\tif (size < ByteSize.KB) {\n\t\t\treturn localize('sizeB', \"{0}B\", size.toFixed(0));\n\t\t}\n\n\t\tif (size < ByteSize.MB) {\n\t\t\treturn localize('sizeKB', \"{0}KB\", (size / ByteSize.KB).toFixed(2));\n\t\t}\n\n\t\tif (size < ByteSize.GB) {\n\t\t\treturn localize('sizeMB', \"{0}MB\", (size / ByteSize.MB).toFixed(2));\n\t\t}\n\n\t\tif (size < ByteSize.TB) {\n\t\t\treturn localize('sizeGB', \"{0}GB\", (size / ByteSize.GB).toFixed(2));\n\t\t}\n\n\t\treturn localize('sizeTB', \"{0}TB\", (size / ByteSize.TB).toFixed(2));\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ServiceIdentifier } from 'vs/platform/instantiation/common/instantiation';\nimport { SyncDescriptor } from './descriptors';\n\nexport class ServiceCollection {\n\n\tprivate _entries = new Map<ServiceIdentifier<any>, any>();\n\n\tconstructor(...entries: [ServiceIdentifier<any>, any][]) {\n\t\tfor (let [id, service] of entries) {\n\t\t\tthis.set(id, service);\n\t\t}\n\t}\n\n\tset<T>(id: ServiceIdentifier<T>, instanceOrDescriptor: T | SyncDescriptor<T>): T | SyncDescriptor<T> {\n\t\tconst result = this._entries.get(id);\n\t\tthis._entries.set(id, instanceOrDescriptor);\n\t\treturn result;\n\t}\n\n\thas(id: ServiceIdentifier<any>): boolean {\n\t\treturn this._entries.has(id);\n\t}\n\n\tget<T>(id: ServiceIdentifier<T>): T | SyncDescriptor<T> {\n\t\treturn this._entries.get(id);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { illegalState } from 'vs/base/common/errors';\nimport { Graph } from 'vs/platform/instantiation/common/graph';\nimport { SyncDescriptor } from 'vs/platform/instantiation/common/descriptors';\nimport { ServiceIdentifier, IInstantiationService, ServicesAccessor, _util, optional } from 'vs/platform/instantiation/common/instantiation';\nimport { ServiceCollection } from 'vs/platform/instantiation/common/serviceCollection';\nimport { IdleValue } from 'vs/base/common/async';\n\n// TRACING\nconst _enableTracing = false;\n\nclass CyclicDependencyError extends Error {\n\tconstructor(graph: Graph<any>) {\n\t\tsuper('cyclic dependency between services');\n\t\tthis.message = graph.toString();\n\t}\n}\n\nexport class InstantiationService implements IInstantiationService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _services: ServiceCollection;\n\tprivate readonly _strict: boolean;\n\tprivate readonly _parent?: InstantiationService;\n\n\tconstructor(services: ServiceCollection = new ServiceCollection(), strict: boolean = false, parent?: InstantiationService) {\n\t\tthis._services = services;\n\t\tthis._strict = strict;\n\t\tthis._parent = parent;\n\n\t\tthis._services.set(IInstantiationService, this);\n\t}\n\n\tcreateChild(services: ServiceCollection): IInstantiationService {\n\t\treturn new InstantiationService(services, this._strict, this);\n\t}\n\n\tinvokeFunction<R, TS extends any[] = []>(fn: (accessor: ServicesAccessor, ...args: TS) => R, ...args: TS): R {\n\t\tlet _trace = Trace.traceInvocation(fn);\n\t\tlet _done = false;\n\t\ttry {\n\t\t\tconst accessor: ServicesAccessor = {\n\t\t\t\tget: <T>(id: ServiceIdentifier<T>, isOptional?: typeof optional) => {\n\n\t\t\t\t\tif (_done) {\n\t\t\t\t\t\tthrow illegalState('service accessor is only valid during the invocation of its target method');\n\t\t\t\t\t}\n\n\t\t\t\t\tconst result = this._getOrCreateServiceInstance(id, _trace);\n\t\t\t\t\tif (!result && isOptional !== optional) {\n\t\t\t\t\t\tthrow new Error(`[invokeFunction] unknown service '${id}'`);\n\t\t\t\t\t}\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn fn(accessor, ...args);\n\t\t} finally {\n\t\t\t_done = true;\n\t\t\t_trace.stop();\n\t\t}\n\t}\n\n\tcreateInstance(ctorOrDescriptor: any | SyncDescriptor<any>, ...rest: any[]): any {\n\t\tlet _trace: Trace;\n\t\tlet result: any;\n\t\tif (ctorOrDescriptor instanceof SyncDescriptor) {\n\t\t\t_trace = Trace.traceCreation(ctorOrDescriptor.ctor);\n\t\t\tresult = this._createInstance(ctorOrDescriptor.ctor, ctorOrDescriptor.staticArguments.concat(rest), _trace);\n\t\t} else {\n\t\t\t_trace = Trace.traceCreation(ctorOrDescriptor);\n\t\t\tresult = this._createInstance(ctorOrDescriptor, rest, _trace);\n\t\t}\n\t\t_trace.stop();\n\t\treturn result;\n\t}\n\n\tprivate _createInstance<T>(ctor: any, args: any[] = [], _trace: Trace): T {\n\n\t\t// arguments defined by service decorators\n\t\tlet serviceDependencies = _util.getServiceDependencies(ctor).sort((a, b) => a.index - b.index);\n\t\tlet serviceArgs: any[] = [];\n\t\tfor (const dependency of serviceDependencies) {\n\t\t\tlet service = this._getOrCreateServiceInstance(dependency.id, _trace);\n\t\t\tif (!service && this._strict && !dependency.optional) {\n\t\t\t\tthrow new Error(`[createInstance] ${ctor.name} depends on UNKNOWN service ${dependency.id}.`);\n\t\t\t}\n\t\t\tserviceArgs.push(service);\n\t\t}\n\n\t\tlet firstServiceArgPos = serviceDependencies.length > 0 ? serviceDependencies[0].index : args.length;\n\n\t\t// check for argument mismatches, adjust static args if needed\n\t\tif (args.length !== firstServiceArgPos) {\n\t\t\tconsole.warn(`[createInstance] First service dependency of ${ctor.name} at position ${firstServiceArgPos + 1} conflicts with ${args.length} static arguments`);\n\n\t\t\tlet delta = firstServiceArgPos - args.length;\n\t\t\tif (delta > 0) {\n\t\t\t\targs = args.concat(new Array(delta));\n\t\t\t} else {\n\t\t\t\targs = args.slice(0, firstServiceArgPos);\n\t\t\t}\n\t\t}\n\n\t\t// now create the instance\n\t\treturn <T>new ctor(...[...args, ...serviceArgs]);\n\t}\n\n\tprivate _setServiceInstance<T>(id: ServiceIdentifier<T>, instance: T): void {\n\t\tif (this._services.get(id) instanceof SyncDescriptor) {\n\t\t\tthis._services.set(id, instance);\n\t\t} else if (this._parent) {\n\t\t\tthis._parent._setServiceInstance(id, instance);\n\t\t} else {\n\t\t\tthrow new Error('illegalState - setting UNKNOWN service instance');\n\t\t}\n\t}\n\n\tprivate _getServiceInstanceOrDescriptor<T>(id: ServiceIdentifier<T>): T | SyncDescriptor<T> {\n\t\tlet instanceOrDesc = this._services.get(id);\n\t\tif (!instanceOrDesc && this._parent) {\n\t\t\treturn this._parent._getServiceInstanceOrDescriptor(id);\n\t\t} else {\n\t\t\treturn instanceOrDesc;\n\t\t}\n\t}\n\n\tprivate _getOrCreateServiceInstance<T>(id: ServiceIdentifier<T>, _trace: Trace): T {\n\t\tlet thing = this._getServiceInstanceOrDescriptor(id);\n\t\tif (thing instanceof SyncDescriptor) {\n\t\t\treturn this._safeCreateAndCacheServiceInstance(id, thing, _trace.branch(id, true));\n\t\t} else {\n\t\t\t_trace.branch(id, false);\n\t\t\treturn thing;\n\t\t}\n\t}\n\n\tprivate readonly _activeInstantiations = new Set<ServiceIdentifier<any>>();\n\n\n\tprivate _safeCreateAndCacheServiceInstance<T>(id: ServiceIdentifier<T>, desc: SyncDescriptor<T>, _trace: Trace): T {\n\t\tif (this._activeInstantiations.has(id)) {\n\t\t\tthrow new Error(`illegal state - RECURSIVELY instantiating service '${id}'`);\n\t\t}\n\t\tthis._activeInstantiations.add(id);\n\t\ttry {\n\t\t\treturn this._createAndCacheServiceInstance(id, desc, _trace);\n\t\t} finally {\n\t\t\tthis._activeInstantiations.delete(id);\n\t\t}\n\t}\n\n\tprivate _createAndCacheServiceInstance<T>(id: ServiceIdentifier<T>, desc: SyncDescriptor<T>, _trace: Trace): T {\n\n\t\ttype Triple = { id: ServiceIdentifier<any>, desc: SyncDescriptor<any>, _trace: Trace; };\n\t\tconst graph = new Graph<Triple>(data => data.id.toString());\n\n\t\tlet cycleCount = 0;\n\t\tconst stack = [{ id, desc, _trace }];\n\t\twhile (stack.length) {\n\t\t\tconst item = stack.pop()!;\n\t\t\tgraph.lookupOrInsertNode(item);\n\n\t\t\t// a weak but working heuristic for cycle checks\n\t\t\tif (cycleCount++ > 1000) {\n\t\t\t\tthrow new CyclicDependencyError(graph);\n\t\t\t}\n\n\t\t\t// check all dependencies for existence and if they need to be created first\n\t\t\tfor (let dependency of _util.getServiceDependencies(item.desc.ctor)) {\n\n\t\t\t\tlet instanceOrDesc = this._getServiceInstanceOrDescriptor(dependency.id);\n\t\t\t\tif (!instanceOrDesc && !dependency.optional) {\n\t\t\t\t\tconsole.warn(`[createInstance] ${id} depends on ${dependency.id} which is NOT registered.`);\n\t\t\t\t}\n\n\t\t\t\tif (instanceOrDesc instanceof SyncDescriptor) {\n\t\t\t\t\tconst d = { id: dependency.id, desc: instanceOrDesc, _trace: item._trace.branch(dependency.id, true) };\n\t\t\t\t\tgraph.insertEdge(item, d);\n\t\t\t\t\tstack.push(d);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\twhile (true) {\n\t\t\tconst roots = graph.roots();\n\n\t\t\t// if there is no more roots but still\n\t\t\t// nodes in the graph we have a cycle\n\t\t\tif (roots.length === 0) {\n\t\t\t\tif (!graph.isEmpty()) {\n\t\t\t\t\tthrow new CyclicDependencyError(graph);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tfor (const { data } of roots) {\n\t\t\t\t// Repeat the check for this still being a service sync descriptor. That's because\n\t\t\t\t// instantiating a dependency might have side-effect and recursively trigger instantiation\n\t\t\t\t// so that some dependencies are now fullfilled already.\n\t\t\t\tconst instanceOrDesc = this._getServiceInstanceOrDescriptor(data.id);\n\t\t\t\tif (instanceOrDesc instanceof SyncDescriptor) {\n\t\t\t\t\t// create instance and overwrite the service collections\n\t\t\t\t\tconst instance = this._createServiceInstanceWithOwner(data.id, data.desc.ctor, data.desc.staticArguments, data.desc.supportsDelayedInstantiation, data._trace);\n\t\t\t\t\tthis._setServiceInstance(data.id, instance);\n\t\t\t\t}\n\t\t\t\tgraph.removeNode(data);\n\t\t\t}\n\t\t}\n\t\treturn <T>this._getServiceInstanceOrDescriptor(id);\n\t}\n\n\tprivate _createServiceInstanceWithOwner<T>(id: ServiceIdentifier<T>, ctor: any, args: any[] = [], supportsDelayedInstantiation: boolean, _trace: Trace): T {\n\t\tif (this._services.get(id) instanceof SyncDescriptor) {\n\t\t\treturn this._createServiceInstance(ctor, args, supportsDelayedInstantiation, _trace);\n\t\t} else if (this._parent) {\n\t\t\treturn this._parent._createServiceInstanceWithOwner(id, ctor, args, supportsDelayedInstantiation, _trace);\n\t\t} else {\n\t\t\tthrow new Error(`illegalState - creating UNKNOWN service instance ${ctor.name}`);\n\t\t}\n\t}\n\n\tprivate _createServiceInstance<T>(ctor: any, args: any[] = [], _supportsDelayedInstantiation: boolean, _trace: Trace): T {\n\t\tif (!_supportsDelayedInstantiation) {\n\t\t\t// eager instantiation\n\t\t\treturn this._createInstance(ctor, args, _trace);\n\n\t\t} else {\n\t\t\t// Return a proxy object that's backed by an idle value. That\n\t\t\t// strategy is to instantiate services in our idle time or when actually\n\t\t\t// needed but not when injected into a consumer\n\t\t\tconst idle = new IdleValue<any>(() => this._createInstance<T>(ctor, args, _trace));\n\t\t\treturn <T>new Proxy(Object.create(null), {\n\t\t\t\tget(target: any, key: PropertyKey): any {\n\t\t\t\t\tif (key in target) {\n\t\t\t\t\t\treturn target[key];\n\t\t\t\t\t}\n\t\t\t\t\tlet obj = idle.value;\n\t\t\t\t\tlet prop = obj[key];\n\t\t\t\t\tif (typeof prop !== 'function') {\n\t\t\t\t\t\treturn prop;\n\t\t\t\t\t}\n\t\t\t\t\tprop = prop.bind(obj);\n\t\t\t\t\ttarget[key] = prop;\n\t\t\t\t\treturn prop;\n\t\t\t\t},\n\t\t\t\tset(_target: T, p: PropertyKey, value: any): boolean {\n\t\t\t\t\tidle.value[p] = value;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n}\n\n//#region -- tracing ---\n\nconst enum TraceType {\n\tCreation, Invocation, Branch\n}\n\nclass Trace {\n\n\tprivate static readonly _None = new class extends Trace {\n\t\tconstructor() { super(-1, null); }\n\t\tstop() { }\n\t\tbranch() { return this; }\n\t};\n\n\tstatic traceInvocation(ctor: any): Trace {\n\t\treturn !_enableTracing ? Trace._None : new Trace(TraceType.Invocation, ctor.name || (ctor.toString() as string).substring(0, 42).replace(/\\n/g, ''));\n\t}\n\n\tstatic traceCreation(ctor: any): Trace {\n\t\treturn !_enableTracing ? Trace._None : new Trace(TraceType.Creation, ctor.name);\n\t}\n\n\tprivate static _totals: number = 0;\n\tprivate readonly _start: number = Date.now();\n\tprivate readonly _dep: [ServiceIdentifier<any>, boolean, Trace?][] = [];\n\n\tprivate constructor(\n\t\treadonly type: TraceType,\n\t\treadonly name: string | null\n\t) { }\n\n\tbranch(id: ServiceIdentifier<any>, first: boolean): Trace {\n\t\tlet child = new Trace(TraceType.Branch, id.toString());\n\t\tthis._dep.push([id, first, child]);\n\t\treturn child;\n\t}\n\n\tstop() {\n\t\tlet dur = Date.now() - this._start;\n\t\tTrace._totals += dur;\n\n\t\tlet causedCreation = false;\n\n\t\tfunction printChild(n: number, trace: Trace) {\n\t\t\tlet res: string[] = [];\n\t\t\tlet prefix = new Array(n + 1).join('\\t');\n\t\t\tfor (const [id, first, child] of trace._dep) {\n\t\t\t\tif (first && child) {\n\t\t\t\t\tcausedCreation = true;\n\t\t\t\t\tres.push(`${prefix}CREATES -> ${id}`);\n\t\t\t\t\tlet nested = printChild(n + 1, child);\n\t\t\t\t\tif (nested) {\n\t\t\t\t\t\tres.push(nested);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tres.push(`${prefix}uses -> ${id}`);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn res.join('\\n');\n\t\t}\n\n\t\tlet lines = [\n\t\t\t`${this.type === TraceType.Creation ? 'CREATE' : 'CALL'} ${this.name}`,\n\t\t\t`${printChild(1, this)}`,\n\t\t\t`DONE, took ${dur.toFixed(2)}ms (grand total ${Trace._totals.toFixed(2)}ms)`\n\t\t];\n\n\t\tif (dur > 2 || causedCreation) {\n\t\t\tconsole.log(lines.join('\\n'));\n\t\t}\n\t}\n}\n\n//#endregion\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { createDecorator as createServiceDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { IDisposable, Disposable } from 'vs/base/common/lifecycle';\nimport { isWindows } from 'vs/base/common/platform';\nimport { Event, Emitter } from 'vs/base/common/event';\nimport { IEnvironmentService } from 'vs/platform/environment/common/environment';\nimport { LoggerChannelClient } from 'vs/platform/log/common/logIpc';\nimport { URI } from 'vs/base/common/uri';\nimport { toErrorMessage } from 'vs/base/common/errorMessage';\n\nexport const ILogService = createServiceDecorator<ILogService>('logService');\nexport const ILoggerService = createServiceDecorator<ILoggerService>('loggerService');\n\nfunction now(): string {\n\treturn new Date().toISOString();\n}\n\nexport enum LogLevel {\n\tTrace,\n\tDebug,\n\tInfo,\n\tWarning,\n\tError,\n\tCritical,\n\tOff\n}\n\nexport const DEFAULT_LOG_LEVEL: LogLevel = LogLevel.Info;\n\nexport interface ILogger extends IDisposable {\n\tonDidChangeLogLevel: Event<LogLevel>;\n\tgetLevel(): LogLevel;\n\tsetLevel(level: LogLevel): void;\n\n\ttrace(message: string, ...args: any[]): void;\n\tdebug(message: string, ...args: any[]): void;\n\tinfo(message: string, ...args: any[]): void;\n\twarn(message: string, ...args: any[]): void;\n\terror(message: string | Error, ...args: any[]): void;\n\tcritical(message: string | Error, ...args: any[]): void;\n\n\t/**\n\t * An operation to flush the contents. Can be synchronous.\n\t */\n\tflush(): void;\n}\n\nexport interface ILogService extends ILogger {\n\treadonly _serviceBrand: undefined;\n}\n\nexport interface ILoggerService {\n\treadonly _serviceBrand: undefined;\n\n\tgetLogger(file: URI): ILogger;\n}\n\nexport abstract class AbstractLogService extends Disposable {\n\n\tprivate level: LogLevel = DEFAULT_LOG_LEVEL;\n\tprivate readonly _onDidChangeLogLevel: Emitter<LogLevel> = this._register(new Emitter<LogLevel>());\n\treadonly onDidChangeLogLevel: Event<LogLevel> = this._onDidChangeLogLevel.event;\n\n\tsetLevel(level: LogLevel): void {\n\t\tif (this.level !== level) {\n\t\t\tthis.level = level;\n\t\t\tthis._onDidChangeLogLevel.fire(this.level);\n\t\t}\n\t}\n\n\tgetLevel(): LogLevel {\n\t\treturn this.level;\n\t}\n\n}\n\nexport class ConsoleLogMainService extends AbstractLogService implements ILogService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\tprivate useColors: boolean;\n\n\tconstructor(logLevel: LogLevel = DEFAULT_LOG_LEVEL) {\n\t\tsuper();\n\t\tthis.setLevel(logLevel);\n\t\tthis.useColors = !isWindows;\n\t}\n\n\ttrace(message: string, ...args: any[]): void {\n\t\tif (this.getLevel() <= LogLevel.Trace) {\n\t\t\tif (this.useColors) {\n\t\t\t\tconsole.log(`\\x1b[90m[main ${now()}]\\x1b[0m`, message, ...args);\n\t\t\t} else {\n\t\t\t\tconsole.log(`[main ${now()}]`, message, ...args);\n\t\t\t}\n\t\t}\n\t}\n\n\tdebug(message: string, ...args: any[]): void {\n\t\tif (this.getLevel() <= LogLevel.Debug) {\n\t\t\tif (this.useColors) {\n\t\t\t\tconsole.log(`\\x1b[90m[main ${now()}]\\x1b[0m`, message, ...args);\n\t\t\t} else {\n\t\t\t\tconsole.log(`[main ${now()}]`, message, ...args);\n\t\t\t}\n\t\t}\n\t}\n\n\tinfo(message: string, ...args: any[]): void {\n\t\tif (this.getLevel() <= LogLevel.Info) {\n\t\t\tif (this.useColors) {\n\t\t\t\tconsole.log(`\\x1b[90m[main ${now()}]\\x1b[0m`, message, ...args);\n\t\t\t} else {\n\t\t\t\tconsole.log(`[main ${now()}]`, message, ...args);\n\t\t\t}\n\t\t}\n\t}\n\n\twarn(message: string | Error, ...args: any[]): void {\n\t\tif (this.getLevel() <= LogLevel.Warning) {\n\t\t\tif (this.useColors) {\n\t\t\t\tconsole.warn(`\\x1b[93m[main ${now()}]\\x1b[0m`, message, ...args);\n\t\t\t} else {\n\t\t\t\tconsole.warn(`[main ${now()}]`, message, ...args);\n\t\t\t}\n\t\t}\n\t}\n\n\terror(message: string, ...args: any[]): void {\n\t\tif (this.getLevel() <= LogLevel.Error) {\n\t\t\tif (this.useColors) {\n\t\t\t\tconsole.error(`\\x1b[91m[main ${now()}]\\x1b[0m`, message, ...args);\n\t\t\t} else {\n\t\t\t\tconsole.error(`[main ${now()}]`, message, ...args);\n\t\t\t}\n\t\t}\n\t}\n\n\tcritical(message: string, ...args: any[]): void {\n\t\tif (this.getLevel() <= LogLevel.Critical) {\n\t\t\tif (this.useColors) {\n\t\t\t\tconsole.error(`\\x1b[90m[main ${now()}]\\x1b[0m`, message, ...args);\n\t\t\t} else {\n\t\t\t\tconsole.error(`[main ${now()}]`, message, ...args);\n\t\t\t}\n\t\t}\n\t}\n\n\tdispose(): void {\n\t\t// noop\n\t}\n\n\tflush(): void {\n\t\t// noop\n\t}\n\n}\n\nexport class ConsoleLogService extends AbstractLogService implements ILogService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tconstructor(logLevel: LogLevel = DEFAULT_LOG_LEVEL) {\n\t\tsuper();\n\t\tthis.setLevel(logLevel);\n\t}\n\n\ttrace(message: string, ...args: any[]): void {\n\t\tif (this.getLevel() <= LogLevel.Trace) {\n\t\t\tconsole.log('%cTRACE', 'color: #888', message, ...args);\n\t\t}\n\t}\n\n\tdebug(message: string, ...args: any[]): void {\n\t\tif (this.getLevel() <= LogLevel.Debug) {\n\t\t\tconsole.log('%cDEBUG', 'background: #eee; color: #888', message, ...args);\n\t\t}\n\t}\n\n\tinfo(message: string, ...args: any[]): void {\n\t\tif (this.getLevel() <= LogLevel.Info) {\n\t\t\tconsole.log('%c INFO', 'color: #33f', message, ...args);\n\t\t}\n\t}\n\n\twarn(message: string | Error, ...args: any[]): void {\n\t\tif (this.getLevel() <= LogLevel.Warning) {\n\t\t\tconsole.log('%c WARN', 'color: #993', message, ...args);\n\t\t}\n\t}\n\n\terror(message: string, ...args: any[]): void {\n\t\tif (this.getLevel() <= LogLevel.Error) {\n\t\t\tconsole.log('%c  ERR', 'color: #f33', message, ...args);\n\t\t}\n\t}\n\n\tcritical(message: string, ...args: any[]): void {\n\t\tif (this.getLevel() <= LogLevel.Critical) {\n\t\t\tconsole.log('%cCRITI', 'background: #f33; color: white', message, ...args);\n\t\t}\n\t}\n\n\tdispose(): void {\n\t\t// noop\n\t}\n\n\tflush(): void {\n\t\t// noop\n\t}\n}\n\nexport class LogServiceAdapter extends AbstractLogService implements ILogService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tconstructor(private readonly adapter: { consoleLog: (type: string, args: any[]) => void }, logLevel: LogLevel = DEFAULT_LOG_LEVEL) {\n\t\tsuper();\n\t\tthis.setLevel(logLevel);\n\t}\n\n\ttrace(message: string, ...args: any[]): void {\n\t\tif (this.getLevel() <= LogLevel.Trace) {\n\t\t\tthis.adapter.consoleLog('trace', [this.extractMessage(message), ...args]);\n\t\t}\n\t}\n\n\tdebug(message: string, ...args: any[]): void {\n\t\tif (this.getLevel() <= LogLevel.Debug) {\n\t\t\tthis.adapter.consoleLog('debug', [this.extractMessage(message), ...args]);\n\t\t}\n\t}\n\n\tinfo(message: string, ...args: any[]): void {\n\t\tif (this.getLevel() <= LogLevel.Info) {\n\t\t\tthis.adapter.consoleLog('info', [this.extractMessage(message), ...args]);\n\t\t}\n\t}\n\n\twarn(message: string | Error, ...args: any[]): void {\n\t\tif (this.getLevel() <= LogLevel.Warning) {\n\t\t\tthis.adapter.consoleLog('warn', [this.extractMessage(message), ...args]);\n\t\t}\n\t}\n\n\terror(message: string | Error, ...args: any[]): void {\n\t\tif (this.getLevel() <= LogLevel.Error) {\n\t\t\tthis.adapter.consoleLog('error', [this.extractMessage(message), ...args]);\n\t\t}\n\t}\n\n\tcritical(message: string | Error, ...args: any[]): void {\n\t\tif (this.getLevel() <= LogLevel.Critical) {\n\t\t\tthis.adapter.consoleLog('critical', [this.extractMessage(message), ...args]);\n\t\t}\n\t}\n\n\tprivate extractMessage(msg: string | Error): string {\n\t\tif (typeof msg === 'string') {\n\t\t\treturn msg;\n\t\t}\n\n\t\treturn toErrorMessage(msg, this.getLevel() <= LogLevel.Trace);\n\t}\n\n\tdispose(): void {\n\t\t// noop\n\t}\n\n\tflush(): void {\n\t\t// noop\n\t}\n}\n\nexport class ConsoleLogInMainService extends LogServiceAdapter implements ILogService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tconstructor(client: LoggerChannelClient, logLevel: LogLevel = DEFAULT_LOG_LEVEL) {\n\t\tsuper({ consoleLog: (type, args) => client.consoleLog(type, args) }, logLevel);\n\t}\n}\n\nexport class MultiplexLogService extends AbstractLogService implements ILogService {\n\tdeclare readonly _serviceBrand: undefined;\n\n\tconstructor(private readonly logServices: ReadonlyArray<ILogService>) {\n\t\tsuper();\n\t\tif (logServices.length) {\n\t\t\tthis.setLevel(logServices[0].getLevel());\n\t\t}\n\t}\n\n\tsetLevel(level: LogLevel): void {\n\t\tfor (const logService of this.logServices) {\n\t\t\tlogService.setLevel(level);\n\t\t}\n\t\tsuper.setLevel(level);\n\t}\n\n\ttrace(message: string, ...args: any[]): void {\n\t\tfor (const logService of this.logServices) {\n\t\t\tlogService.trace(message, ...args);\n\t\t}\n\t}\n\n\tdebug(message: string, ...args: any[]): void {\n\t\tfor (const logService of this.logServices) {\n\t\t\tlogService.debug(message, ...args);\n\t\t}\n\t}\n\n\tinfo(message: string, ...args: any[]): void {\n\t\tfor (const logService of this.logServices) {\n\t\t\tlogService.info(message, ...args);\n\t\t}\n\t}\n\n\twarn(message: string, ...args: any[]): void {\n\t\tfor (const logService of this.logServices) {\n\t\t\tlogService.warn(message, ...args);\n\t\t}\n\t}\n\n\terror(message: string | Error, ...args: any[]): void {\n\t\tfor (const logService of this.logServices) {\n\t\t\tlogService.error(message, ...args);\n\t\t}\n\t}\n\n\tcritical(message: string | Error, ...args: any[]): void {\n\t\tfor (const logService of this.logServices) {\n\t\t\tlogService.critical(message, ...args);\n\t\t}\n\t}\n\n\tflush(): void {\n\t\tfor (const logService of this.logServices) {\n\t\t\tlogService.flush();\n\t\t}\n\t}\n\n\tdispose(): void {\n\t\tfor (const logService of this.logServices) {\n\t\t\tlogService.dispose();\n\t\t}\n\t}\n}\n\nexport class DelegatedLogService extends Disposable implements ILogService {\n\tdeclare readonly _serviceBrand: undefined;\n\n\tconstructor(private logService: ILogService) {\n\t\tsuper();\n\t\tthis._register(logService);\n\t}\n\n\tget onDidChangeLogLevel(): Event<LogLevel> {\n\t\treturn this.logService.onDidChangeLogLevel;\n\t}\n\n\tsetLevel(level: LogLevel): void {\n\t\tthis.logService.setLevel(level);\n\t}\n\n\tgetLevel(): LogLevel {\n\t\treturn this.logService.getLevel();\n\t}\n\n\ttrace(message: string, ...args: any[]): void {\n\t\tthis.logService.trace(message, ...args);\n\t}\n\n\tdebug(message: string, ...args: any[]): void {\n\t\tthis.logService.debug(message, ...args);\n\t}\n\n\tinfo(message: string, ...args: any[]): void {\n\t\tthis.logService.info(message, ...args);\n\t}\n\n\twarn(message: string, ...args: any[]): void {\n\t\tthis.logService.warn(message, ...args);\n\t}\n\n\terror(message: string | Error, ...args: any[]): void {\n\t\tthis.logService.error(message, ...args);\n\t}\n\n\tcritical(message: string | Error, ...args: any[]): void {\n\t\tthis.logService.critical(message, ...args);\n\t}\n\n\tflush(): void {\n\t\tthis.logService.flush();\n\t}\n}\n\nexport class NullLogService implements ILogService {\n\tdeclare readonly _serviceBrand: undefined;\n\treadonly onDidChangeLogLevel: Event<LogLevel> = new Emitter<LogLevel>().event;\n\tsetLevel(level: LogLevel): void { }\n\tgetLevel(): LogLevel { return LogLevel.Info; }\n\ttrace(message: string, ...args: any[]): void { }\n\tdebug(message: string, ...args: any[]): void { }\n\tinfo(message: string, ...args: any[]): void { }\n\twarn(message: string, ...args: any[]): void { }\n\terror(message: string | Error, ...args: any[]): void { }\n\tcritical(message: string | Error, ...args: any[]): void { }\n\tdispose(): void { }\n\tflush(): void { }\n}\n\nexport function getLogLevel(environmentService: IEnvironmentService): LogLevel {\n\tif (environmentService.verbose) {\n\t\treturn LogLevel.Trace;\n\t}\n\tif (typeof environmentService.logLevel === 'string') {\n\t\tconst logLevel = parseLogLevel(environmentService.logLevel.toLowerCase());\n\t\tif (logLevel !== undefined) {\n\t\t\treturn logLevel;\n\t\t}\n\t}\n\treturn DEFAULT_LOG_LEVEL;\n}\n\nexport function parseLogLevel(logLevel: string): LogLevel | undefined {\n\tswitch (logLevel) {\n\t\tcase 'trace':\n\t\t\treturn LogLevel.Trace;\n\t\tcase 'debug':\n\t\t\treturn LogLevel.Debug;\n\t\tcase 'info':\n\t\t\treturn LogLevel.Info;\n\t\tcase 'warn':\n\t\t\treturn LogLevel.Warning;\n\t\tcase 'error':\n\t\t\treturn LogLevel.Error;\n\t\tcase 'critical':\n\t\t\treturn LogLevel.Critical;\n\t\tcase 'off':\n\t\t\treturn LogLevel.Off;\n\t}\n\treturn undefined;\n}\n\nexport function LogLevelToString(logLevel: LogLevel): string {\n\tswitch (logLevel) {\n\t\tcase LogLevel.Trace: return 'trace';\n\t\tcase LogLevel.Debug: return 'debug';\n\t\tcase LogLevel.Info: return 'info';\n\t\tcase LogLevel.Warning: return 'warn';\n\t\tcase LogLevel.Error: return 'error';\n\t\tcase LogLevel.Critical: return 'critical';\n\t\tcase LogLevel.Off: return 'off';\n\t}\n}\n\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as path from 'vs/base/common/path';\nimport { ILogService, LogLevel, AbstractLogService } from 'vs/platform/log/common/log';\nimport * as spdlog from 'spdlog';\nimport { ByteSize } from 'vs/platform/files/common/files';\n\nasync function createSpdLogLogger(processName: string, logsFolder: string): Promise<spdlog.RotatingLogger | null> {\n\t// Do not crash if spdlog cannot be loaded\n\ttry {\n\t\tconst _spdlog = await import('spdlog');\n\t\t_spdlog.setAsyncMode(8192, 500);\n\t\tconst logfilePath = path.join(logsFolder, `${processName}.log`);\n\t\treturn _spdlog.createRotatingLoggerAsync(processName, logfilePath, 5 * ByteSize.MB, 6);\n\t} catch (e) {\n\t\tconsole.error(e);\n\t}\n\treturn null;\n}\n\nexport function createRotatingLogger(name: string, filename: string, filesize: number, filecount: number): spdlog.RotatingLogger {\n\tconst _spdlog: typeof spdlog = require.__$__nodeRequire('spdlog');\n\treturn _spdlog.createRotatingLogger(name, filename, filesize, filecount);\n}\n\ninterface ILog {\n\tlevel: LogLevel;\n\tmessage: string;\n}\n\nfunction log(logger: spdlog.RotatingLogger, level: LogLevel, message: string): void {\n\tswitch (level) {\n\t\tcase LogLevel.Trace: logger.trace(message); break;\n\t\tcase LogLevel.Debug: logger.debug(message); break;\n\t\tcase LogLevel.Info: logger.info(message); break;\n\t\tcase LogLevel.Warning: logger.warn(message); break;\n\t\tcase LogLevel.Error: logger.error(message); break;\n\t\tcase LogLevel.Critical: logger.critical(message); break;\n\t\tdefault: throw new Error('Invalid log level');\n\t}\n}\n\nexport class SpdLogService extends AbstractLogService implements ILogService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate buffer: ILog[] = [];\n\tprivate _loggerCreationPromise: Promise<void> | undefined = undefined;\n\tprivate _logger: spdlog.RotatingLogger | undefined;\n\n\tconstructor(private readonly name: string, private readonly logsFolder: string, level: LogLevel) {\n\t\tsuper();\n\t\tthis.setLevel(level);\n\t\tthis._createSpdLogLogger();\n\t\tthis._register(this.onDidChangeLogLevel(level => {\n\t\t\tif (this._logger) {\n\t\t\t\tthis._logger.setLevel(level);\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate _createSpdLogLogger(): Promise<void> {\n\t\tif (!this._loggerCreationPromise) {\n\t\t\tthis._loggerCreationPromise = createSpdLogLogger(this.name, this.logsFolder)\n\t\t\t\t.then(logger => {\n\t\t\t\t\tif (logger) {\n\t\t\t\t\t\tthis._logger = logger;\n\t\t\t\t\t\tthis._logger.setLevel(this.getLevel());\n\t\t\t\t\t\tfor (const { level, message } of this.buffer) {\n\t\t\t\t\t\t\tlog(this._logger, level, message);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.buffer = [];\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t}\n\t\treturn this._loggerCreationPromise;\n\t}\n\n\tprivate _log(level: LogLevel, message: string): void {\n\t\tif (this._logger) {\n\t\t\tlog(this._logger, level, message);\n\t\t} else if (this.getLevel() <= level) {\n\t\t\tthis.buffer.push({ level, message });\n\t\t}\n\t}\n\n\ttrace(message: string, ...args: any[]): void {\n\t\tif (this.getLevel() <= LogLevel.Trace) {\n\t\t\tthis._log(LogLevel.Trace, this.format([message, ...args]));\n\t\t}\n\t}\n\n\tdebug(message: string, ...args: any[]): void {\n\t\tif (this.getLevel() <= LogLevel.Debug) {\n\t\t\tthis._log(LogLevel.Debug, this.format([message, ...args]));\n\t\t}\n\t}\n\n\tinfo(message: string, ...args: any[]): void {\n\t\tif (this.getLevel() <= LogLevel.Info) {\n\t\t\tthis._log(LogLevel.Info, this.format([message, ...args]));\n\t\t}\n\t}\n\n\twarn(message: string, ...args: any[]): void {\n\t\tif (this.getLevel() <= LogLevel.Warning) {\n\t\t\tthis._log(LogLevel.Warning, this.format([message, ...args]));\n\t\t}\n\t}\n\n\terror(message: string | Error, ...args: any[]): void {\n\t\tif (this.getLevel() <= LogLevel.Error) {\n\n\t\t\tif (message instanceof Error) {\n\t\t\t\tconst array = Array.prototype.slice.call(arguments) as any[];\n\t\t\t\tarray[0] = message.stack;\n\t\t\t\tthis._log(LogLevel.Error, this.format(array));\n\t\t\t} else {\n\t\t\t\tthis._log(LogLevel.Error, this.format([message, ...args]));\n\t\t\t}\n\t\t}\n\t}\n\n\tcritical(message: string | Error, ...args: any[]): void {\n\t\tif (this.getLevel() <= LogLevel.Critical) {\n\t\t\tthis._log(LogLevel.Critical, this.format([message, ...args]));\n\t\t}\n\t}\n\n\tflush(): void {\n\t\tif (this._logger) {\n\t\t\tthis._logger.flush();\n\t\t} else if (this._loggerCreationPromise) {\n\t\t\tthis._loggerCreationPromise.then(() => this.flush());\n\t\t}\n\t}\n\n\tdispose(): void {\n\t\tif (this._logger) {\n\t\t\tthis.disposeLogger();\n\t\t} else if (this._loggerCreationPromise) {\n\t\t\tthis._loggerCreationPromise.then(() => this.disposeLogger());\n\t\t}\n\t\tthis._loggerCreationPromise = undefined;\n\t}\n\n\tprivate disposeLogger(): void {\n\t\tif (this._logger) {\n\t\t\tthis._logger.drop();\n\t\t\tthis._logger = undefined;\n\t\t}\n\t}\n\n\tprivate format(args: any): string {\n\t\tlet result = '';\n\n\t\tfor (let i = 0; i < args.length; i++) {\n\t\t\tlet a = args[i];\n\n\t\t\tif (typeof a === 'object') {\n\t\t\t\ttry {\n\t\t\t\t\ta = JSON.stringify(a);\n\t\t\t\t} catch (e) { }\n\t\t\t}\n\n\t\t\tresult += (i > 0 ? ' ' : '') + a;\n\t\t}\n\n\t\treturn result;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from 'vs/base/common/uri';\nimport { Event } from 'vs/base/common/event';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { localize } from 'vs/nls';\nimport Severity from 'vs/base/common/severity';\n\nexport interface IMarkerService {\n\treadonly _serviceBrand: undefined;\n\n\tgetStatistics(): MarkerStatistics;\n\n\tchangeOne(owner: string, resource: URI, markers: IMarkerData[]): void;\n\n\tchangeAll(owner: string, data: IResourceMarker[]): void;\n\n\tremove(owner: string, resources: URI[]): void;\n\n\tread(filter?: { owner?: string; resource?: URI; severities?: number, take?: number; }): IMarker[];\n\n\treadonly onMarkerChanged: Event<readonly URI[]>;\n}\n\n/**\n *\n */\nexport interface IRelatedInformation {\n\tresource: URI;\n\tmessage: string;\n\tstartLineNumber: number;\n\tstartColumn: number;\n\tendLineNumber: number;\n\tendColumn: number;\n}\n\nexport const enum MarkerTag {\n\tUnnecessary = 1,\n\tDeprecated = 2\n}\n\nexport enum MarkerSeverity {\n\tHint = 1,\n\tInfo = 2,\n\tWarning = 4,\n\tError = 8,\n}\n\nexport namespace MarkerSeverity {\n\n\texport function compare(a: MarkerSeverity, b: MarkerSeverity): number {\n\t\treturn b - a;\n\t}\n\n\tconst _displayStrings: { [value: number]: string; } = Object.create(null);\n\t_displayStrings[MarkerSeverity.Error] = localize('sev.error', \"Error\");\n\t_displayStrings[MarkerSeverity.Warning] = localize('sev.warning', \"Warning\");\n\t_displayStrings[MarkerSeverity.Info] = localize('sev.info', \"Info\");\n\n\texport function toString(a: MarkerSeverity): string {\n\t\treturn _displayStrings[a] || '';\n\t}\n\n\texport function fromSeverity(severity: Severity): MarkerSeverity {\n\t\tswitch (severity) {\n\t\t\tcase Severity.Error: return MarkerSeverity.Error;\n\t\t\tcase Severity.Warning: return MarkerSeverity.Warning;\n\t\t\tcase Severity.Info: return MarkerSeverity.Info;\n\t\t\tcase Severity.Ignore: return MarkerSeverity.Hint;\n\t\t}\n\t}\n\n\texport function toSeverity(severity: MarkerSeverity): Severity {\n\t\tswitch (severity) {\n\t\t\tcase MarkerSeverity.Error: return Severity.Error;\n\t\t\tcase MarkerSeverity.Warning: return Severity.Warning;\n\t\t\tcase MarkerSeverity.Info: return Severity.Info;\n\t\t\tcase MarkerSeverity.Hint: return Severity.Ignore;\n\t\t}\n\t}\n}\n\n/**\n * A structure defining a problem/warning/etc.\n */\nexport interface IMarkerData {\n\tcode?: string | { value: string; target: URI };\n\tseverity: MarkerSeverity;\n\tmessage: string;\n\tsource?: string;\n\tstartLineNumber: number;\n\tstartColumn: number;\n\tendLineNumber: number;\n\tendColumn: number;\n\trelatedInformation?: IRelatedInformation[];\n\ttags?: MarkerTag[];\n}\n\nexport interface IResourceMarker {\n\tresource: URI;\n\tmarker: IMarkerData;\n}\n\nexport interface IMarker {\n\towner: string;\n\tresource: URI;\n\tseverity: MarkerSeverity;\n\tcode?: string | { value: string; target: URI };\n\tmessage: string;\n\tsource?: string;\n\tstartLineNumber: number;\n\tstartColumn: number;\n\tendLineNumber: number;\n\tendColumn: number;\n\trelatedInformation?: IRelatedInformation[];\n\ttags?: MarkerTag[];\n}\n\nexport interface MarkerStatistics {\n\terrors: number;\n\twarnings: number;\n\tinfos: number;\n\tunknowns: number;\n}\n\nexport namespace IMarkerData {\n\tconst emptyString = '';\n\texport function makeKey(markerData: IMarkerData): string {\n\t\treturn makeKeyOptionalMessage(markerData, true);\n\t}\n\n\texport function makeKeyOptionalMessage(markerData: IMarkerData, useMessage: boolean): string {\n\t\tlet result: string[] = [emptyString];\n\t\tif (markerData.source) {\n\t\t\tresult.push(markerData.source.replace('¦', '\\\\¦'));\n\t\t} else {\n\t\t\tresult.push(emptyString);\n\t\t}\n\t\tif (markerData.code) {\n\t\t\tif (typeof markerData.code === 'string') {\n\t\t\t\tresult.push(markerData.code.replace('¦', '\\\\¦'));\n\t\t\t} else {\n\t\t\t\tresult.push(markerData.code.value.replace('¦', '\\\\¦'));\n\t\t\t}\n\t\t} else {\n\t\t\tresult.push(emptyString);\n\t\t}\n\t\tif (markerData.severity !== undefined && markerData.severity !== null) {\n\t\t\tresult.push(MarkerSeverity.toString(markerData.severity));\n\t\t} else {\n\t\t\tresult.push(emptyString);\n\t\t}\n\n\t\t// Modifed to not include the message as part of the marker key to work around\n\t\t// https://github.com/microsoft/vscode/issues/77475\n\t\tif (markerData.message && useMessage) {\n\t\t\tresult.push(markerData.message.replace('¦', '\\\\¦'));\n\t\t} else {\n\t\t\tresult.push(emptyString);\n\t\t}\n\t\tif (markerData.startLineNumber !== undefined && markerData.startLineNumber !== null) {\n\t\t\tresult.push(markerData.startLineNumber.toString());\n\t\t} else {\n\t\t\tresult.push(emptyString);\n\t\t}\n\t\tif (markerData.startColumn !== undefined && markerData.startColumn !== null) {\n\t\t\tresult.push(markerData.startColumn.toString());\n\t\t} else {\n\t\t\tresult.push(emptyString);\n\t\t}\n\t\tif (markerData.endLineNumber !== undefined && markerData.endLineNumber !== null) {\n\t\t\tresult.push(markerData.endLineNumber.toString());\n\t\t} else {\n\t\t\tresult.push(emptyString);\n\t\t}\n\t\tif (markerData.endColumn !== undefined && markerData.endColumn !== null) {\n\t\t\tresult.push(markerData.endColumn.toString());\n\t\t} else {\n\t\t\tresult.push(emptyString);\n\t\t}\n\t\tresult.push(emptyString);\n\t\treturn result.join('¦');\n\t}\n}\n\nexport const IMarkerService = createDecorator<IMarkerService>('markerService');\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport BaseSeverity from 'vs/base/common/severity';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { IAction } from 'vs/base/common/actions';\nimport { Event } from 'vs/base/common/event';\nimport { IDisposable } from 'vs/base/common/lifecycle';\n\nexport import Severity = BaseSeverity;\n\nexport const INotificationService = createDecorator<INotificationService>('notificationService');\n\nexport type NotificationMessage = string | Error;\n\nexport interface INotificationProperties {\n\n\t/**\n\t * Sticky notifications are not automatically removed after a certain timeout. By\n\t * default, notifications with primary actions and severity error are always sticky.\n\t */\n\treadonly sticky?: boolean;\n\n\t/**\n\t * Silent notifications are not shown to the user unless the notification center\n\t * is opened. The status bar will still indicate all number of notifications to\n\t * catch some attention.\n\t */\n\treadonly silent?: boolean;\n\n\t/**\n\t * Adds an action to never show the notification again. The choice will be persisted\n\t * such as future requests will not cause the notification to show again.\n\t */\n\treadonly neverShowAgain?: INeverShowAgainOptions;\n}\n\nexport enum NeverShowAgainScope {\n\n\t/**\n\t * Will never show this notification on the current workspace again.\n\t */\n\tWORKSPACE,\n\n\t/**\n\t * Will never show this notification on any workspace again.\n\t */\n\tGLOBAL\n}\n\nexport interface INeverShowAgainOptions {\n\n\t/**\n\t * The id is used to persist the selection of not showing the notification again.\n\t */\n\treadonly id: string;\n\n\t/**\n\t * By default the action will show up as primary action. Setting this to true will\n\t * make it a secondary action instead.\n\t */\n\treadonly isSecondary?: boolean;\n\n\t/**\n\t * Whether to persist the choice in the current workspace or for all workspaces. By\n\t * default it will be persisted for all workspaces (= `NeverShowAgainScope.GLOBAL`).\n\t */\n\treadonly scope?: NeverShowAgainScope;\n}\n\nexport interface INotification extends INotificationProperties {\n\n\t/**\n\t * The severity of the notification. Either `Info`, `Warning` or `Error`.\n\t */\n\treadonly severity: Severity;\n\n\t/**\n\t * The message of the notification. This can either be a `string` or `Error`. Messages\n\t * can optionally include links in the format: `[text](link)`\n\t */\n\treadonly message: NotificationMessage;\n\n\t/**\n\t * The source of the notification appears as additional information.\n\t */\n\treadonly source?: string;\n\n\t/**\n\t * Actions to show as part of the notification. Primary actions show up as\n\t * buttons as part of the message and will close the notification once clicked.\n\t *\n\t * Secondary actions are meant to provide additional configuration or context\n\t * for the notification and will show up less prominent. A notification does not\n\t * close automatically when invoking a secondary action.\n\t *\n\t * **Note:** If your intent is to show a message with actions to the user, consider\n\t * the `INotificationService.prompt()` method instead which are optimized for\n\t * this usecase and much easier to use!\n\t */\n\tactions?: INotificationActions;\n\n\t/**\n\t * The initial set of progress properties for the notification. To update progress\n\t * later on, access the `INotificationHandle.progress` property.\n\t */\n\treadonly progress?: INotificationProgressProperties;\n}\n\nexport interface INotificationActions {\n\n\t/**\n\t * Primary actions show up as buttons as part of the message and will close\n\t * the notification once clicked.\n\t *\n\t * Pass `ActionWithMenuAction` for an action that has additional menu actions.\n\t */\n\treadonly primary?: ReadonlyArray<IAction>;\n\n\t/**\n\t * Secondary actions are meant to provide additional configuration or context\n\t * for the notification and will show up less prominent. A notification does not\n\t * close automatically when invoking a secondary action.\n\t */\n\treadonly secondary?: ReadonlyArray<IAction>;\n}\n\nexport interface INotificationProgressProperties {\n\n\t/**\n\t * Causes the progress bar to spin infinitley.\n\t */\n\treadonly infinite?: boolean;\n\n\t/**\n\t * Indicate the total amount of work.\n\t */\n\treadonly total?: number;\n\n\t/**\n\t * Indicate that a specific chunk of work is done.\n\t */\n\treadonly worked?: number;\n}\n\nexport interface INotificationProgress {\n\n\t/**\n\t * Causes the progress bar to spin infinitley.\n\t */\n\tinfinite(): void;\n\n\t/**\n\t * Indicate the total amount of work.\n\t */\n\ttotal(value: number): void;\n\n\t/**\n\t * Indicate that a specific chunk of work is done.\n\t */\n\tworked(value: number): void;\n\n\t/**\n\t * Indicate that the long running operation is done.\n\t */\n\tdone(): void;\n}\n\nexport interface INotificationHandle {\n\n\t/**\n\t * Will be fired once the notification is closed.\n\t */\n\treadonly onDidClose: Event<void>;\n\n\t/**\n\t * Will be fired whenever the visibility of the notification changes.\n\t * A notification can either be visible as toast or inside the notification\n\t * center if it is visible.\n\t */\n\treadonly onDidChangeVisibility: Event<boolean>;\n\n\t/**\n\t * Allows to indicate progress on the notification even after the\n\t * notification is already visible.\n\t */\n\treadonly progress: INotificationProgress;\n\n\t/**\n\t * Allows to update the severity of the notification.\n\t */\n\tupdateSeverity(severity: Severity): void;\n\n\t/**\n\t * Allows to update the message of the notification even after the\n\t * notification is already visible.\n\t */\n\tupdateMessage(message: NotificationMessage): void;\n\n\t/**\n\t * Allows to update the actions of the notification even after the\n\t * notification is already visible.\n\t */\n\tupdateActions(actions?: INotificationActions): void;\n\n\t/**\n\t * Hide the notification and remove it from the notification center.\n\t */\n\tclose(): void;\n}\n\ninterface IBasePromptChoice {\n\n\t/**\n\t * Label to show for the choice to the user.\n\t */\n\treadonly label: string;\n\n\t/**\n\t * Whether to keep the notification open after the choice was selected\n\t * by the user. By default, will close the notification upon click.\n\t */\n\treadonly keepOpen?: boolean;\n\n\t/**\n\t * Triggered when the user selects the choice.\n\t */\n\trun: () => void;\n}\n\nexport interface IPromptChoice extends IBasePromptChoice {\n\n\t/**\n\t * Primary choices show up as buttons in the notification below the message.\n\t * Secondary choices show up under the gear icon in the header of the notification.\n\t */\n\treadonly isSecondary?: boolean;\n}\n\nexport interface IPromptChoiceWithMenu extends IPromptChoice {\n\n\t/**\n\t * Additional choices those will be shown in the dropdown menu for this choice.\n\t */\n\treadonly menu: IBasePromptChoice[];\n\n\t/**\n\t * Menu is not supported on secondary choices\n\t */\n\treadonly isSecondary: false | undefined;\n}\n\nexport interface IPromptOptions extends INotificationProperties {\n\n\t/**\n\t * Will be called if the user closed the notification without picking\n\t * any of the provided choices.\n\t */\n\tonCancel?: () => void;\n}\n\nexport interface IStatusMessageOptions {\n\n\t/**\n\t * An optional timeout after which the status message should show. By default\n\t * the status message will show immediately.\n\t */\n\treadonly showAfter?: number;\n\n\t/**\n\t * An optional timeout after which the status message is to be hidden. By default\n\t * the status message will not hide until another status message is displayed.\n\t */\n\treadonly hideAfter?: number;\n}\n\nexport enum NotificationsFilter {\n\n\t/**\n\t * No filter is enabled.\n\t */\n\tOFF,\n\n\t/**\n\t * All notifications are configured as silent. See\n\t * `INotificationProperties.silent` for more info.\n\t */\n\tSILENT,\n\n\t/**\n\t * All notifications are silent except error notifications.\n\t*/\n\tERROR\n}\n\n/**\n * A service to bring up notifications and non-modal prompts.\n *\n * Note: use the `IDialogService` for a modal way to ask the user for input.\n */\nexport interface INotificationService {\n\n\treadonly _serviceBrand: undefined;\n\n\t/**\n\t * Show the provided notification to the user. The returned `INotificationHandle`\n\t * can be used to control the notification afterwards.\n\t *\n\t * **Note:** If your intent is to show a message with actions to the user, consider\n\t * the `INotificationService.prompt()` method instead which are optimized for\n\t * this usecase and much easier to use!\n\t *\n\t * @returns a handle on the notification to e.g. hide it or update message, buttons, etc.\n\t */\n\tnotify(notification: INotification): INotificationHandle;\n\n\t/**\n\t * A convenient way of reporting infos. Use the `INotificationService.notify`\n\t * method if you need more control over the notification.\n\t */\n\tinfo(message: NotificationMessage | NotificationMessage[]): void;\n\n\t/**\n\t * A convenient way of reporting warnings. Use the `INotificationService.notify`\n\t * method if you need more control over the notification.\n\t */\n\twarn(message: NotificationMessage | NotificationMessage[]): void;\n\n\t/**\n\t * A convenient way of reporting errors. Use the `INotificationService.notify`\n\t * method if you need more control over the notification.\n\t */\n\terror(message: NotificationMessage | NotificationMessage[]): void;\n\n\t/**\n\t * Shows a prompt in the notification area with the provided choices. The prompt\n\t * is non-modal. If you want to show a modal dialog instead, use `IDialogService`.\n\t *\n\t * @param severity the severity of the notification. Either `Info`, `Warning` or `Error`.\n\t * @param message the message to show as status.\n\t * @param choices options to be choosen from.\n\t * @param options provides some optional configuration options.\n\t *\n\t * @returns a handle on the notification to e.g. hide it or update message, buttons, etc.\n\t */\n\tprompt(severity: Severity, message: string, choices: (IPromptChoice | IPromptChoiceWithMenu)[], options?: IPromptOptions): INotificationHandle;\n\n\t/**\n\t * Shows a status message in the status area with the provided text.\n\t *\n\t * @param message the message to show as status\n\t * @param options provides some optional configuration options\n\t *\n\t * @returns a disposable to hide the status message\n\t */\n\tstatus(message: NotificationMessage, options?: IStatusMessageOptions): IDisposable;\n\n\t/**\n\t * Allows to configure a filter for notifications.\n\t *\n\t * @param filter the filter to use\n\t */\n\tsetFilter(filter: NotificationsFilter): void;\n}\n\nexport class NoOpNotification implements INotificationHandle {\n\n\treadonly progress = new NoOpProgress();\n\n\treadonly onDidClose = Event.None;\n\treadonly onDidChangeVisibility = Event.None;\n\n\tupdateSeverity(severity: Severity): void { }\n\tupdateMessage(message: NotificationMessage): void { }\n\tupdateActions(actions?: INotificationActions): void { }\n\n\tclose(): void { }\n}\n\nexport class NoOpProgress implements INotificationProgress {\n\tinfinite(): void { }\n\tdone(): void { }\n\ttotal(value: number): void { }\n\tworked(value: number): void { }\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IProductConfiguration } from 'vs/platform/product/common/productService';\nimport { isWeb } from 'vs/base/common/platform';\nimport { env } from 'vs/base/common/process';\nimport { FileAccess } from 'vs/base/common/network';\nimport { dirname, joinPath } from 'vs/base/common/resources';\n\nlet product: IProductConfiguration;\n\n// Web or Native (sandbox TODO@sandbox need to add all properties of product.json)\nif (isWeb || typeof require === 'undefined' || typeof require.__$__nodeRequire !== 'function') {\n\n\t// Built time configuration (do NOT modify)\n\tproduct = { /*BUILD->INSERT_PRODUCT_CONFIGURATION*/ } as IProductConfiguration;\n\n\t// Running out of sources\n\tif (Object.keys(product).length === 0) {\n\t\tObject.assign(product, {\n\t\t\tversion: '1.53.0-dev',\n\t\t\tnameShort: isWeb ? 'Code Web - OSS Dev' : 'Code - OSS Dev',\n\t\t\tnameLong: isWeb ? 'Code Web - OSS Dev' : 'Code - OSS Dev',\n\t\t\tapplicationName: 'code-oss',\n\t\t\tdataFolderName: '.vscode-oss',\n\t\t\turlProtocol: 'code-oss',\n\t\t\treportIssueUrl: 'https://github.com/microsoft/vscode/issues/new',\n\t\t\tlicenseName: 'MIT',\n\t\t\tlicenseUrl: 'https://github.com/microsoft/vscode/blob/master/LICENSE.txt',\n\t\t\textensionAllowedProposedApi: [\n\t\t\t\t'ms-vscode.vscode-js-profile-flame',\n\t\t\t\t'ms-vscode.vscode-js-profile-table',\n\t\t\t\t'ms-vscode.github-browser'\n\t\t\t],\n\t\t});\n\t}\n\t// NOTE@coder: Add the ability to inject settings from the server.\n\tconst el = document.getElementById('vscode-remote-product-configuration');\n\tconst rawProductConfiguration = el && el.getAttribute('data-settings');\n\tif (rawProductConfiguration) {\n\t\tObject.assign(product, JSON.parse(rawProductConfiguration));\n\t}\n}\n\n// Native (non-sandboxed)\nelse {\n\n\t// Obtain values from product.json and package.json\n\tconst rootPath = dirname(FileAccess.asFileUri('', require));\n\n\tproduct = require.__$__nodeRequire(joinPath(rootPath, 'product.json').fsPath);\n\tconst pkg = require.__$__nodeRequire(joinPath(rootPath, 'package.json').fsPath) as { version: string; };\n\n\t// Running out of sources\n\tif (env['VSCODE_DEV']) {\n\t\tObject.assign(product, {\n\t\t\tnameShort: `${product.nameShort} Dev`,\n\t\t\tnameLong: `${product.nameLong} Dev`,\n\t\t\tdataFolderName: `${product.dataFolderName}-dev`\n\t\t});\n\t}\n\n\tObject.assign(product, {\n\t\tversion: pkg.version\n\t});\n}\n\nexport default product;\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { CancellationToken, CancellationTokenSource } from 'vs/base/common/cancellation';\nimport { toDisposable, DisposableStore, Disposable } from 'vs/base/common/lifecycle';\nimport { IAction } from 'vs/base/common/actions';\n\nexport const IProgressService = createDecorator<IProgressService>('progressService');\n\n/**\n * A progress service that can be used to report progress to various locations of the UI.\n */\nexport interface IProgressService {\n\n\treadonly _serviceBrand: undefined;\n\n\twithProgress<R>(\n\t\toptions: IProgressOptions | IProgressNotificationOptions | IProgressWindowOptions | IProgressCompositeOptions,\n\t\ttask: (progress: IProgress<IProgressStep>) => Promise<R>,\n\t\tonDidCancel?: (choice?: number) => void\n\t): Promise<R>;\n}\n\nexport interface IProgressIndicator {\n\n\t/**\n\t * Show progress customized with the provided flags.\n\t */\n\tshow(infinite: true, delay?: number): IProgressRunner;\n\tshow(total: number, delay?: number): IProgressRunner;\n\n\t/**\n\t * Indicate progress for the duration of the provided promise. Progress will stop in\n\t * any case of promise completion, error or cancellation.\n\t */\n\tshowWhile(promise: Promise<unknown>, delay?: number): Promise<void>;\n}\n\nexport const enum ProgressLocation {\n\tExplorer = 1,\n\tScm = 3,\n\tExtensions = 5,\n\tWindow = 10,\n\tNotification = 15,\n\tDialog = 20\n}\n\nexport interface IProgressOptions {\n\treadonly location: ProgressLocation | string;\n\treadonly title?: string;\n\treadonly source?: string;\n\treadonly total?: number;\n\treadonly cancellable?: boolean;\n\treadonly buttons?: string[];\n}\n\nexport interface IProgressNotificationOptions extends IProgressOptions {\n\treadonly location: ProgressLocation.Notification;\n\treadonly primaryActions?: ReadonlyArray<IAction>;\n\treadonly secondaryActions?: ReadonlyArray<IAction>;\n\treadonly delay?: number;\n\treadonly silent?: boolean;\n}\n\nexport interface IProgressWindowOptions extends IProgressOptions {\n\treadonly location: ProgressLocation.Window;\n\treadonly command?: string;\n}\n\nexport interface IProgressCompositeOptions extends IProgressOptions {\n\treadonly location: ProgressLocation.Explorer | ProgressLocation.Extensions | ProgressLocation.Scm | string;\n\treadonly delay?: number;\n}\n\nexport interface IProgressStep {\n\tmessage?: string;\n\tincrement?: number;\n\ttotal?: number;\n}\n\nexport interface IProgressRunner {\n\ttotal(value: number): void;\n\tworked(value: number): void;\n\tdone(): void;\n}\n\nexport const emptyProgressRunner: IProgressRunner = Object.freeze({\n\ttotal() { },\n\tworked() { },\n\tdone() { }\n});\n\nexport interface IProgress<T> {\n\treport(item: T): void;\n}\n\nexport class Progress<T> implements IProgress<T> {\n\n\tstatic readonly None: IProgress<unknown> = Object.freeze({ report() { } });\n\n\tprivate _value?: T;\n\tget value(): T | undefined { return this._value; }\n\n\tconstructor(private callback: (data: T) => void) { }\n\n\treport(item: T) {\n\t\tthis._value = item;\n\t\tthis.callback(this._value);\n\t}\n}\n\n/**\n * A helper to show progress during a long running operation. If the operation\n * is started multiple times, only the last invocation will drive the progress.\n */\nexport interface IOperation {\n\tid: number;\n\tisCurrent: () => boolean;\n\ttoken: CancellationToken;\n\tstop(): void;\n}\n\nexport class LongRunningOperation extends Disposable {\n\tprivate currentOperationId = 0;\n\tprivate readonly currentOperationDisposables = this._register(new DisposableStore());\n\tprivate currentProgressRunner: IProgressRunner | undefined;\n\tprivate currentProgressTimeout: any;\n\n\tconstructor(\n\t\tprivate progressIndicator: IProgressIndicator\n\t) {\n\t\tsuper();\n\t}\n\n\tstart(progressDelay: number): IOperation {\n\n\t\t// Stop any previous operation\n\t\tthis.stop();\n\n\t\t// Start new\n\t\tconst newOperationId = ++this.currentOperationId;\n\t\tconst newOperationToken = new CancellationTokenSource();\n\t\tthis.currentProgressTimeout = setTimeout(() => {\n\t\t\tif (newOperationId === this.currentOperationId) {\n\t\t\t\tthis.currentProgressRunner = this.progressIndicator.show(true);\n\t\t\t}\n\t\t}, progressDelay);\n\n\t\tthis.currentOperationDisposables.add(toDisposable(() => clearTimeout(this.currentProgressTimeout)));\n\t\tthis.currentOperationDisposables.add(toDisposable(() => newOperationToken.cancel()));\n\t\tthis.currentOperationDisposables.add(toDisposable(() => this.currentProgressRunner ? this.currentProgressRunner.done() : undefined));\n\n\t\treturn {\n\t\t\tid: newOperationId,\n\t\t\ttoken: newOperationToken.token,\n\t\t\tstop: () => this.doStop(newOperationId),\n\t\t\tisCurrent: () => this.currentOperationId === newOperationId\n\t\t};\n\t}\n\n\tstop(): void {\n\t\tthis.doStop(this.currentOperationId);\n\t}\n\n\tprivate doStop(operationId: number): void {\n\t\tif (this.currentOperationId === operationId) {\n\t\t\tthis.currentOperationDisposables.clear();\n\t\t}\n\t}\n}\n\nexport const IEditorProgressService = createDecorator<IEditorProgressService>('editorProgressService');\n\n/**\n * A progress service that will report progress local to the editor triggered from.\n */\nexport interface IEditorProgressService extends IProgressIndicator {\n\n\treadonly _serviceBrand: undefined;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as Types from 'vs/base/common/types';\nimport * as Assert from 'vs/base/common/assert';\n\nexport interface IRegistry {\n\n\t/**\n\t * Adds the extension functions and properties defined by data to the\n\t * platform. The provided id must be unique.\n\t * @param id a unique identifier\n\t * @param data a contribution\n\t */\n\tadd(id: string, data: any): void;\n\n\t/**\n\t * Returns true iff there is an extension with the provided id.\n\t * @param id an extension identifier\n\t */\n\tknows(id: string): boolean;\n\n\t/**\n\t * Returns the extension functions and properties defined by the specified key or null.\n\t * @param id an extension identifier\n\t */\n\tas<T>(id: string): T;\n}\n\nclass RegistryImpl implements IRegistry {\n\n\tprivate readonly data = new Map<string, any>();\n\n\tpublic add(id: string, data: any): void {\n\t\tAssert.ok(Types.isString(id));\n\t\tAssert.ok(Types.isObject(data));\n\t\tAssert.ok(!this.data.has(id), 'There is already an extension with this id');\n\n\t\tthis.data.set(id, data);\n\t}\n\n\tpublic knows(id: string): boolean {\n\t\treturn this.data.has(id);\n\t}\n\n\tpublic as(id: string): any {\n\t\treturn this.data.get(id) || null;\n\t}\n}\n\nexport const Registry: IRegistry = new RegistryImpl();\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IJSONSchema } from 'vs/base/common/jsonSchema';\nimport * as platform from 'vs/platform/registry/common/platform';\nimport { Event, Emitter } from 'vs/base/common/event';\n\nexport const Extensions = {\n\tJSONContribution: 'base.contributions.json'\n};\n\nexport interface ISchemaContributions {\n\tschemas: { [id: string]: IJSONSchema };\n}\n\nexport interface IJSONContributionRegistry {\n\n\treadonly onDidChangeSchema: Event<string>;\n\n\t/**\n\t * Register a schema to the registry.\n\t */\n\tregisterSchema(uri: string, unresolvedSchemaContent: IJSONSchema): void;\n\n\n\t/**\n\t * Notifies all listeners that the content of the given schema has changed.\n\t * @param uri The id of the schema\n\t */\n\tnotifySchemaChanged(uri: string): void;\n\n\t/**\n\t * Get all schemas\n\t */\n\tgetSchemaContributions(): ISchemaContributions;\n}\n\n\n\nfunction normalizeId(id: string) {\n\tif (id.length > 0 && id.charAt(id.length - 1) === '#') {\n\t\treturn id.substring(0, id.length - 1);\n\t}\n\treturn id;\n}\n\n\n\nclass JSONContributionRegistry implements IJSONContributionRegistry {\n\n\tprivate schemasById: { [id: string]: IJSONSchema };\n\n\tprivate readonly _onDidChangeSchema = new Emitter<string>();\n\treadonly onDidChangeSchema: Event<string> = this._onDidChangeSchema.event;\n\n\tconstructor() {\n\t\tthis.schemasById = {};\n\t}\n\n\tpublic registerSchema(uri: string, unresolvedSchemaContent: IJSONSchema): void {\n\t\tthis.schemasById[normalizeId(uri)] = unresolvedSchemaContent;\n\t\tthis._onDidChangeSchema.fire(uri);\n\t}\n\n\tpublic notifySchemaChanged(uri: string): void {\n\t\tthis._onDidChangeSchema.fire(uri);\n\t}\n\n\tpublic getSchemaContributions(): ISchemaContributions {\n\t\treturn {\n\t\t\tschemas: this.schemasById,\n\t\t};\n\t}\n\n}\n\nconst jsonContributionRegistry = new JSONContributionRegistry();\nplatform.Registry.add(Extensions.JSONContribution, jsonContributionRegistry);","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as nls from 'vs/nls';\nimport { Event, Emitter } from 'vs/base/common/event';\nimport { IJSONSchema } from 'vs/base/common/jsonSchema';\nimport { Registry } from 'vs/platform/registry/common/platform';\nimport * as types from 'vs/base/common/types';\nimport { IJSONContributionRegistry, Extensions as JSONExtensions } from 'vs/platform/jsonschemas/common/jsonContributionRegistry';\nimport { IStringDictionary } from 'vs/base/common/collections';\n\nexport const Extensions = {\n\tConfiguration: 'base.contributions.configuration'\n};\n\nexport interface IConfigurationRegistry {\n\n\t/**\n\t * Register a configuration to the registry.\n\t */\n\tregisterConfiguration(configuration: IConfigurationNode): void;\n\n\t/**\n\t * Register multiple configurations to the registry.\n\t */\n\tregisterConfigurations(configurations: IConfigurationNode[], validate?: boolean): void;\n\n\t/**\n\t * Deregister multiple configurations from the registry.\n\t */\n\tderegisterConfigurations(configurations: IConfigurationNode[]): void;\n\n\t/**\n\t * Register multiple default configurations to the registry.\n\t */\n\tregisterDefaultConfigurations(defaultConfigurations: IStringDictionary<any>[]): void;\n\n\t/**\n\t * Deregister multiple default configurations from the registry.\n\t */\n\tderegisterDefaultConfigurations(defaultConfigurations: IStringDictionary<any>[]): void;\n\n\t/**\n\t * Signal that the schema of a configuration setting has changes. It is currently only supported to change enumeration values.\n\t * Property or default value changes are not allowed.\n\t */\n\tnotifyConfigurationSchemaUpdated(...configurations: IConfigurationNode[]): void;\n\n\t/**\n\t * Event that fires whenver a configuration has been\n\t * registered.\n\t */\n\tonDidSchemaChange: Event<void>;\n\n\t/**\n\t * Event that fires whenver a configuration has been\n\t * registered.\n\t */\n\tonDidUpdateConfiguration: Event<string[]>;\n\n\t/**\n\t * Returns all configuration nodes contributed to this registry.\n\t */\n\tgetConfigurations(): IConfigurationNode[];\n\n\t/**\n\t * Returns all configurations settings of all configuration nodes contributed to this registry.\n\t */\n\tgetConfigurationProperties(): { [qualifiedKey: string]: IConfigurationPropertySchema };\n\n\t/**\n\t * Returns all excluded configurations settings of all configuration nodes contributed to this registry.\n\t */\n\tgetExcludedConfigurationProperties(): { [qualifiedKey: string]: IConfigurationPropertySchema };\n\n\t/**\n\t * Register the identifiers for editor configurations\n\t */\n\tregisterOverrideIdentifiers(identifiers: string[]): void;\n}\n\nexport const enum ConfigurationScope {\n\t/**\n\t * Application specific configuration, which can be configured only in local user settings.\n\t */\n\tAPPLICATION = 1,\n\t/**\n\t * Machine specific configuration, which can be configured only in local and remote user settings.\n\t */\n\tMACHINE,\n\t/**\n\t * Window specific configuration, which can be configured in the user or workspace settings.\n\t */\n\tWINDOW,\n\t/**\n\t * Resource specific configuration, which can be configured in the user, workspace or folder settings.\n\t */\n\tRESOURCE,\n\t/**\n\t * Resource specific configuration that can be configured in language specific settings\n\t */\n\tLANGUAGE_OVERRIDABLE,\n\t/**\n\t * Machine specific configuration that can also be configured in workspace or folder settings.\n\t */\n\tMACHINE_OVERRIDABLE,\n}\n\nexport interface IConfigurationPropertySchema extends IJSONSchema {\n\tscope?: ConfigurationScope;\n\tincluded?: boolean;\n\ttags?: string[];\n\t/**\n\t * When enabled this setting is ignored during sync and user can override this.\n\t */\n\tignoreSync?: boolean;\n\t/**\n\t * When enabled this setting is ignored during sync and user cannot override this.\n\t */\n\tdisallowSyncIgnore?: boolean;\n\tenumItemLabels?: string[];\n}\n\nexport interface IConfigurationExtensionInfo {\n\tid: string;\n}\n\nexport interface IConfigurationNode {\n\tid?: string;\n\torder?: number;\n\ttype?: string | string[];\n\ttitle?: string;\n\tdescription?: string;\n\tproperties?: { [path: string]: IConfigurationPropertySchema; };\n\tallOf?: IConfigurationNode[];\n\tscope?: ConfigurationScope;\n\textensionInfo?: IConfigurationExtensionInfo;\n}\n\ntype SettingProperties = { [key: string]: any };\n\nexport const allSettings: { properties: SettingProperties, patternProperties: SettingProperties } = { properties: {}, patternProperties: {} };\nexport const applicationSettings: { properties: SettingProperties, patternProperties: SettingProperties } = { properties: {}, patternProperties: {} };\nexport const machineSettings: { properties: SettingProperties, patternProperties: SettingProperties } = { properties: {}, patternProperties: {} };\nexport const machineOverridableSettings: { properties: SettingProperties, patternProperties: SettingProperties } = { properties: {}, patternProperties: {} };\nexport const windowSettings: { properties: SettingProperties, patternProperties: SettingProperties } = { properties: {}, patternProperties: {} };\nexport const resourceSettings: { properties: SettingProperties, patternProperties: SettingProperties } = { properties: {}, patternProperties: {} };\n\nexport const resourceLanguageSettingsSchemaId = 'vscode://schemas/settings/resourceLanguage';\n\nconst contributionRegistry = Registry.as<IJSONContributionRegistry>(JSONExtensions.JSONContribution);\n\nclass ConfigurationRegistry implements IConfigurationRegistry {\n\n\tprivate readonly defaultValues: IStringDictionary<any>;\n\tprivate readonly defaultLanguageConfigurationOverridesNode: IConfigurationNode;\n\tprivate readonly configurationContributors: IConfigurationNode[];\n\tprivate readonly configurationProperties: { [qualifiedKey: string]: IJSONSchema };\n\tprivate readonly excludedConfigurationProperties: { [qualifiedKey: string]: IJSONSchema };\n\tprivate readonly resourceLanguageSettingsSchema: IJSONSchema;\n\tprivate readonly overrideIdentifiers = new Set<string>();\n\n\tprivate readonly _onDidSchemaChange = new Emitter<void>();\n\treadonly onDidSchemaChange: Event<void> = this._onDidSchemaChange.event;\n\n\tprivate readonly _onDidUpdateConfiguration: Emitter<string[]> = new Emitter<string[]>();\n\treadonly onDidUpdateConfiguration: Event<string[]> = this._onDidUpdateConfiguration.event;\n\n\tconstructor() {\n\t\tthis.defaultValues = {};\n\t\tthis.defaultLanguageConfigurationOverridesNode = {\n\t\t\tid: 'defaultOverrides',\n\t\t\ttitle: nls.localize('defaultLanguageConfigurationOverrides.title', \"Default Language Configuration Overrides\"),\n\t\t\tproperties: {}\n\t\t};\n\t\tthis.configurationContributors = [this.defaultLanguageConfigurationOverridesNode];\n\t\tthis.resourceLanguageSettingsSchema = { properties: {}, patternProperties: {}, additionalProperties: false, errorMessage: 'Unknown editor configuration setting', allowTrailingCommas: true, allowComments: true };\n\t\tthis.configurationProperties = {};\n\t\tthis.excludedConfigurationProperties = {};\n\n\t\tcontributionRegistry.registerSchema(resourceLanguageSettingsSchemaId, this.resourceLanguageSettingsSchema);\n\t}\n\n\tpublic registerConfiguration(configuration: IConfigurationNode, validate: boolean = true): void {\n\t\tthis.registerConfigurations([configuration], validate);\n\t}\n\n\tpublic registerConfigurations(configurations: IConfigurationNode[], validate: boolean = true): void {\n\t\tconst properties: string[] = [];\n\t\tconfigurations.forEach(configuration => {\n\t\t\tproperties.push(...this.validateAndRegisterProperties(configuration, validate)); // fills in defaults\n\t\t\tthis.configurationContributors.push(configuration);\n\t\t\tthis.registerJSONConfiguration(configuration);\n\t\t});\n\n\t\tcontributionRegistry.registerSchema(resourceLanguageSettingsSchemaId, this.resourceLanguageSettingsSchema);\n\t\tthis._onDidSchemaChange.fire();\n\t\tthis._onDidUpdateConfiguration.fire(properties);\n\t}\n\n\tpublic deregisterConfigurations(configurations: IConfigurationNode[]): void {\n\t\tconst properties: string[] = [];\n\t\tconst deregisterConfiguration = (configuration: IConfigurationNode) => {\n\t\t\tif (configuration.properties) {\n\t\t\t\tfor (const key in configuration.properties) {\n\t\t\t\t\tproperties.push(key);\n\t\t\t\t\tdelete this.configurationProperties[key];\n\t\t\t\t\tthis.removeFromSchema(key, configuration.properties[key]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (configuration.allOf) {\n\t\t\t\tconfiguration.allOf.forEach(node => deregisterConfiguration(node));\n\t\t\t}\n\t\t};\n\t\tfor (const configuration of configurations) {\n\t\t\tderegisterConfiguration(configuration);\n\t\t\tconst index = this.configurationContributors.indexOf(configuration);\n\t\t\tif (index !== -1) {\n\t\t\t\tthis.configurationContributors.splice(index, 1);\n\t\t\t}\n\t\t}\n\n\t\tcontributionRegistry.registerSchema(resourceLanguageSettingsSchemaId, this.resourceLanguageSettingsSchema);\n\t\tthis._onDidSchemaChange.fire();\n\t\tthis._onDidUpdateConfiguration.fire(properties);\n\t}\n\n\tpublic registerDefaultConfigurations(defaultConfigurations: IStringDictionary<any>[]): void {\n\t\tconst properties: string[] = [];\n\t\tconst overrideIdentifiers: string[] = [];\n\n\t\tfor (const defaultConfiguration of defaultConfigurations) {\n\t\t\tfor (const key in defaultConfiguration) {\n\t\t\t\tproperties.push(key);\n\n\t\t\t\tif (OVERRIDE_PROPERTY_PATTERN.test(key)) {\n\t\t\t\t\tthis.defaultValues[key] = { ...(this.defaultValues[key] || {}), ...defaultConfiguration[key] };\n\t\t\t\t\tconst property: IConfigurationPropertySchema = {\n\t\t\t\t\t\ttype: 'object',\n\t\t\t\t\t\tdefault: this.defaultValues[key],\n\t\t\t\t\t\tdescription: nls.localize('defaultLanguageConfiguration.description', \"Configure settings to be overridden for {0} language.\", key),\n\t\t\t\t\t\t$ref: resourceLanguageSettingsSchemaId\n\t\t\t\t\t};\n\t\t\t\t\toverrideIdentifiers.push(overrideIdentifierFromKey(key));\n\t\t\t\t\tthis.configurationProperties[key] = property;\n\t\t\t\t\tthis.defaultLanguageConfigurationOverridesNode.properties![key] = property;\n\t\t\t\t} else {\n\t\t\t\t\tthis.defaultValues[key] = defaultConfiguration[key];\n\t\t\t\t\tconst property = this.configurationProperties[key];\n\t\t\t\t\tif (property) {\n\t\t\t\t\t\tthis.updatePropertyDefaultValue(key, property);\n\t\t\t\t\t\tthis.updateSchema(key, property);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.registerOverrideIdentifiers(overrideIdentifiers);\n\t\tthis._onDidSchemaChange.fire();\n\t\tthis._onDidUpdateConfiguration.fire(properties);\n\t}\n\n\tpublic deregisterDefaultConfigurations(defaultConfigurations: IStringDictionary<any>[]): void {\n\t\tconst properties: string[] = [];\n\t\tfor (const defaultConfiguration of defaultConfigurations) {\n\t\t\tfor (const key in defaultConfiguration) {\n\t\t\t\tproperties.push(key);\n\t\t\t\tdelete this.defaultValues[key];\n\t\t\t\tif (OVERRIDE_PROPERTY_PATTERN.test(key)) {\n\t\t\t\t\tdelete this.configurationProperties[key];\n\t\t\t\t\tdelete this.defaultLanguageConfigurationOverridesNode.properties![key];\n\t\t\t\t} else {\n\t\t\t\t\tconst property = this.configurationProperties[key];\n\t\t\t\t\tif (property) {\n\t\t\t\t\t\tthis.updatePropertyDefaultValue(key, property);\n\t\t\t\t\t\tthis.updateSchema(key, property);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.updateOverridePropertyPatternKey();\n\t\tthis._onDidSchemaChange.fire();\n\t\tthis._onDidUpdateConfiguration.fire(properties);\n\t}\n\n\tpublic notifyConfigurationSchemaUpdated(...configurations: IConfigurationNode[]) {\n\t\tthis._onDidSchemaChange.fire();\n\t}\n\n\tpublic registerOverrideIdentifiers(overrideIdentifiers: string[]): void {\n\t\tfor (const overrideIdentifier of overrideIdentifiers) {\n\t\t\tthis.overrideIdentifiers.add(overrideIdentifier);\n\t\t}\n\t\tthis.updateOverridePropertyPatternKey();\n\t}\n\n\tprivate validateAndRegisterProperties(configuration: IConfigurationNode, validate: boolean = true, scope: ConfigurationScope = ConfigurationScope.WINDOW): string[] {\n\t\tscope = types.isUndefinedOrNull(configuration.scope) ? scope : configuration.scope;\n\t\tlet propertyKeys: string[] = [];\n\t\tlet properties = configuration.properties;\n\t\tif (properties) {\n\t\t\tfor (let key in properties) {\n\t\t\t\tif (validate && validateProperty(key)) {\n\t\t\t\t\tdelete properties[key];\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst property = properties[key];\n\n\t\t\t\t// update default value\n\t\t\t\tthis.updatePropertyDefaultValue(key, property);\n\n\t\t\t\t// update scope\n\t\t\t\tif (OVERRIDE_PROPERTY_PATTERN.test(key)) {\n\t\t\t\t\tproperty.scope = undefined; // No scope for overridable properties `[${identifier}]`\n\t\t\t\t} else {\n\t\t\t\t\tproperty.scope = types.isUndefinedOrNull(property.scope) ? scope : property.scope;\n\t\t\t\t}\n\n\t\t\t\t// Add to properties maps\n\t\t\t\t// Property is included by default if 'included' is unspecified\n\t\t\t\tif (properties[key].hasOwnProperty('included') && !properties[key].included) {\n\t\t\t\t\tthis.excludedConfigurationProperties[key] = properties[key];\n\t\t\t\t\tdelete properties[key];\n\t\t\t\t\tcontinue;\n\t\t\t\t} else {\n\t\t\t\t\tthis.configurationProperties[key] = properties[key];\n\t\t\t\t}\n\n\t\t\t\tif (!properties[key].deprecationMessage && properties[key].markdownDeprecationMessage) {\n\t\t\t\t\t// If not set, default deprecationMessage to the markdown source\n\t\t\t\t\tproperties[key].deprecationMessage = properties[key].markdownDeprecationMessage;\n\t\t\t\t}\n\n\t\t\t\tpropertyKeys.push(key);\n\t\t\t}\n\t\t}\n\t\tlet subNodes = configuration.allOf;\n\t\tif (subNodes) {\n\t\t\tfor (let node of subNodes) {\n\t\t\t\tpropertyKeys.push(...this.validateAndRegisterProperties(node, validate, scope));\n\t\t\t}\n\t\t}\n\t\treturn propertyKeys;\n\t}\n\n\tgetConfigurations(): IConfigurationNode[] {\n\t\treturn this.configurationContributors;\n\t}\n\n\tgetConfigurationProperties(): { [qualifiedKey: string]: IConfigurationPropertySchema } {\n\t\treturn this.configurationProperties;\n\t}\n\n\tgetExcludedConfigurationProperties(): { [qualifiedKey: string]: IConfigurationPropertySchema } {\n\t\treturn this.excludedConfigurationProperties;\n\t}\n\n\tprivate registerJSONConfiguration(configuration: IConfigurationNode) {\n\t\tconst register = (configuration: IConfigurationNode) => {\n\t\t\tlet properties = configuration.properties;\n\t\t\tif (properties) {\n\t\t\t\tfor (const key in properties) {\n\t\t\t\t\tthis.updateSchema(key, properties[key]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet subNodes = configuration.allOf;\n\t\t\tif (subNodes) {\n\t\t\t\tsubNodes.forEach(register);\n\t\t\t}\n\t\t};\n\t\tregister(configuration);\n\t}\n\n\tprivate updateSchema(key: string, property: IConfigurationPropertySchema): void {\n\t\tallSettings.properties[key] = property;\n\t\tswitch (property.scope) {\n\t\t\tcase ConfigurationScope.APPLICATION:\n\t\t\t\tapplicationSettings.properties[key] = property;\n\t\t\t\tbreak;\n\t\t\tcase ConfigurationScope.MACHINE:\n\t\t\t\tmachineSettings.properties[key] = property;\n\t\t\t\tbreak;\n\t\t\tcase ConfigurationScope.MACHINE_OVERRIDABLE:\n\t\t\t\tmachineOverridableSettings.properties[key] = property;\n\t\t\t\tbreak;\n\t\t\tcase ConfigurationScope.WINDOW:\n\t\t\t\twindowSettings.properties[key] = property;\n\t\t\t\tbreak;\n\t\t\tcase ConfigurationScope.RESOURCE:\n\t\t\t\tresourceSettings.properties[key] = property;\n\t\t\t\tbreak;\n\t\t\tcase ConfigurationScope.LANGUAGE_OVERRIDABLE:\n\t\t\t\tresourceSettings.properties[key] = property;\n\t\t\t\tthis.resourceLanguageSettingsSchema.properties![key] = property;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprivate removeFromSchema(key: string, property: IConfigurationPropertySchema): void {\n\t\tdelete allSettings.properties[key];\n\t\tswitch (property.scope) {\n\t\t\tcase ConfigurationScope.APPLICATION:\n\t\t\t\tdelete applicationSettings.properties[key];\n\t\t\t\tbreak;\n\t\t\tcase ConfigurationScope.MACHINE:\n\t\t\t\tdelete machineSettings.properties[key];\n\t\t\t\tbreak;\n\t\t\tcase ConfigurationScope.MACHINE_OVERRIDABLE:\n\t\t\t\tdelete machineOverridableSettings.properties[key];\n\t\t\t\tbreak;\n\t\t\tcase ConfigurationScope.WINDOW:\n\t\t\t\tdelete windowSettings.properties[key];\n\t\t\t\tbreak;\n\t\t\tcase ConfigurationScope.RESOURCE:\n\t\t\tcase ConfigurationScope.LANGUAGE_OVERRIDABLE:\n\t\t\t\tdelete resourceSettings.properties[key];\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprivate updateOverridePropertyPatternKey(): void {\n\t\tfor (const overrideIdentifier of this.overrideIdentifiers.values()) {\n\t\t\tconst overrideIdentifierProperty = `[${overrideIdentifier}]`;\n\t\t\tconst resourceLanguagePropertiesSchema: IJSONSchema = {\n\t\t\t\ttype: 'object',\n\t\t\t\tdescription: nls.localize('overrideSettings.defaultDescription', \"Configure editor settings to be overridden for a language.\"),\n\t\t\t\terrorMessage: nls.localize('overrideSettings.errorMessage', \"This setting does not support per-language configuration.\"),\n\t\t\t\t$ref: resourceLanguageSettingsSchemaId,\n\t\t\t};\n\t\t\tthis.updatePropertyDefaultValue(overrideIdentifierProperty, resourceLanguagePropertiesSchema);\n\t\t\tallSettings.properties[overrideIdentifierProperty] = resourceLanguagePropertiesSchema;\n\t\t\tapplicationSettings.properties[overrideIdentifierProperty] = resourceLanguagePropertiesSchema;\n\t\t\tmachineSettings.properties[overrideIdentifierProperty] = resourceLanguagePropertiesSchema;\n\t\t\tmachineOverridableSettings.properties[overrideIdentifierProperty] = resourceLanguagePropertiesSchema;\n\t\t\twindowSettings.properties[overrideIdentifierProperty] = resourceLanguagePropertiesSchema;\n\t\t\tresourceSettings.properties[overrideIdentifierProperty] = resourceLanguagePropertiesSchema;\n\t\t}\n\t\tthis._onDidSchemaChange.fire();\n\t}\n\n\tprivate updatePropertyDefaultValue(key: string, property: IConfigurationPropertySchema): void {\n\t\tlet defaultValue = this.defaultValues[key];\n\t\tif (types.isUndefined(defaultValue)) {\n\t\t\tdefaultValue = property.default;\n\t\t}\n\t\tif (types.isUndefined(defaultValue)) {\n\t\t\tdefaultValue = getDefaultValue(property.type);\n\t\t}\n\t\tproperty.default = defaultValue;\n\t}\n}\n\nconst OVERRIDE_PROPERTY = '\\\\[.*\\\\]$';\nexport const OVERRIDE_PROPERTY_PATTERN = new RegExp(OVERRIDE_PROPERTY);\n\nexport function overrideIdentifierFromKey(key: string): string {\n\treturn key.substring(1, key.length - 1);\n}\n\nexport function getDefaultValue(type: string | string[] | undefined): any {\n\tconst t = Array.isArray(type) ? (<string[]>type)[0] : <string>type;\n\tswitch (t) {\n\t\tcase 'boolean':\n\t\t\treturn false;\n\t\tcase 'integer':\n\t\tcase 'number':\n\t\t\treturn 0;\n\t\tcase 'string':\n\t\t\treturn '';\n\t\tcase 'array':\n\t\t\treturn [];\n\t\tcase 'object':\n\t\t\treturn {};\n\t\tdefault:\n\t\t\treturn null;\n\t}\n}\n\n\nconst configurationRegistry = new ConfigurationRegistry();\nRegistry.add(Extensions.Configuration, configurationRegistry);\n\nexport function validateProperty(property: string): string | null {\n\tif (!property.trim()) {\n\t\treturn nls.localize('config.property.empty', \"Cannot register an empty property\");\n\t}\n\tif (OVERRIDE_PROPERTY_PATTERN.test(property)) {\n\t\treturn nls.localize('config.property.languageDefault', \"Cannot register '{0}'. This matches property pattern '\\\\\\\\[.*\\\\\\\\]$' for describing language specific editor settings. Use 'configurationDefaults' contribution.\", property);\n\t}\n\tif (configurationRegistry.getConfigurationProperties()[property] !== undefined) {\n\t\treturn nls.localize('config.property.duplicate', \"Cannot register '{0}'. This property is already registered.\", property);\n\t}\n\treturn null;\n}\n\nexport function getScopes(): [string, ConfigurationScope | undefined][] {\n\tconst scopes: [string, ConfigurationScope | undefined][] = [];\n\tconst configurationProperties = configurationRegistry.getConfigurationProperties();\n\tfor (const key of Object.keys(configurationProperties)) {\n\t\tscopes.push([key, configurationProperties[key].scope]);\n\t}\n\tscopes.push(['launch', ConfigurationScope.RESOURCE]);\n\tscopes.push(['task', ConfigurationScope.RESOURCE]);\n\treturn scopes;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as objects from 'vs/base/common/objects';\nimport * as types from 'vs/base/common/types';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { Event } from 'vs/base/common/event';\nimport { Registry } from 'vs/platform/registry/common/platform';\nimport { IWorkspaceFolder } from 'vs/platform/workspace/common/workspace';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { IConfigurationRegistry, Extensions, OVERRIDE_PROPERTY_PATTERN, overrideIdentifierFromKey } from 'vs/platform/configuration/common/configurationRegistry';\nimport { IStringDictionary } from 'vs/base/common/collections';\n\nexport const IConfigurationService = createDecorator<IConfigurationService>('configurationService');\n\nexport function isConfigurationOverrides(thing: any): thing is IConfigurationOverrides {\n\treturn thing\n\t\t&& typeof thing === 'object'\n\t\t&& (!thing.overrideIdentifier || typeof thing.overrideIdentifier === 'string')\n\t\t&& (!thing.resource || thing.resource instanceof URI);\n}\n\nexport interface IConfigurationOverrides {\n\toverrideIdentifier?: string | null;\n\tresource?: URI | null;\n}\n\nexport const enum ConfigurationTarget {\n\tUSER = 1,\n\tUSER_LOCAL,\n\tUSER_REMOTE,\n\tWORKSPACE,\n\tWORKSPACE_FOLDER,\n\tDEFAULT,\n\tMEMORY\n}\nexport function ConfigurationTargetToString(configurationTarget: ConfigurationTarget) {\n\tswitch (configurationTarget) {\n\t\tcase ConfigurationTarget.USER: return 'USER';\n\t\tcase ConfigurationTarget.USER_LOCAL: return 'USER_LOCAL';\n\t\tcase ConfigurationTarget.USER_REMOTE: return 'USER_REMOTE';\n\t\tcase ConfigurationTarget.WORKSPACE: return 'WORKSPACE';\n\t\tcase ConfigurationTarget.WORKSPACE_FOLDER: return 'WORKSPACE_FOLDER';\n\t\tcase ConfigurationTarget.DEFAULT: return 'DEFAULT';\n\t\tcase ConfigurationTarget.MEMORY: return 'MEMORY';\n\t}\n}\n\nexport interface IConfigurationChange {\n\tkeys: string[];\n\toverrides: [string, string[]][];\n}\n\nexport interface IConfigurationChangeEvent {\n\n\treadonly source: ConfigurationTarget;\n\treadonly affectedKeys: string[];\n\treadonly change: IConfigurationChange;\n\n\taffectsConfiguration(configuration: string, overrides?: IConfigurationOverrides): boolean;\n\n\t// Following data is used for telemetry\n\treadonly sourceConfig: any;\n}\n\nexport interface IConfigurationValue<T> {\n\n\treadonly defaultValue?: T;\n\treadonly userValue?: T;\n\treadonly userLocalValue?: T;\n\treadonly userRemoteValue?: T;\n\treadonly workspaceValue?: T;\n\treadonly workspaceFolderValue?: T;\n\treadonly memoryValue?: T;\n\treadonly value?: T;\n\n\treadonly default?: { value?: T, override?: T };\n\treadonly user?: { value?: T, override?: T };\n\treadonly userLocal?: { value?: T, override?: T };\n\treadonly userRemote?: { value?: T, override?: T };\n\treadonly workspace?: { value?: T, override?: T };\n\treadonly workspaceFolder?: { value?: T, override?: T };\n\treadonly memory?: { value?: T, override?: T };\n\n\treadonly overrideIdentifiers?: string[];\n}\n\nexport interface IConfigurationService {\n\treadonly _serviceBrand: undefined;\n\n\tonDidChangeConfiguration: Event<IConfigurationChangeEvent>;\n\n\tgetConfigurationData(): IConfigurationData | null;\n\n\t/**\n\t * Fetches the value of the section for the given overrides.\n\t * Value can be of native type or an object keyed off the section name.\n\t *\n\t * @param section - Section of the configuraion. Can be `null` or `undefined`.\n\t * @param overrides - Overrides that has to be applied while fetching\n\t *\n\t */\n\tgetValue<T>(): T;\n\tgetValue<T>(section: string): T;\n\tgetValue<T>(overrides: IConfigurationOverrides): T;\n\tgetValue<T>(section: string, overrides: IConfigurationOverrides): T;\n\n\tupdateValue(key: string, value: any): Promise<void>;\n\tupdateValue(key: string, value: any, overrides: IConfigurationOverrides): Promise<void>;\n\tupdateValue(key: string, value: any, target: ConfigurationTarget): Promise<void>;\n\tupdateValue(key: string, value: any, overrides: IConfigurationOverrides, target: ConfigurationTarget, donotNotifyError?: boolean): Promise<void>;\n\n\tinspect<T>(key: string, overrides?: IConfigurationOverrides): IConfigurationValue<T>;\n\n\treloadConfiguration(target?: ConfigurationTarget | IWorkspaceFolder): Promise<void>;\n\n\tkeys(): {\n\t\tdefault: string[];\n\t\tuser: string[];\n\t\tworkspace: string[];\n\t\tworkspaceFolder: string[];\n\t\tmemory?: string[];\n\t};\n}\n\nexport interface IConfigurationModel {\n\tcontents: any;\n\tkeys: string[];\n\toverrides: IOverrides[];\n}\n\nexport interface IOverrides {\n\tkeys: string[];\n\tcontents: any;\n\tidentifiers: string[];\n}\n\nexport interface IConfigurationData {\n\tdefaults: IConfigurationModel;\n\tuser: IConfigurationModel;\n\tworkspace: IConfigurationModel;\n\tfolders: [UriComponents, IConfigurationModel][];\n}\n\nexport interface IConfigurationCompareResult {\n\tadded: string[];\n\tremoved: string[];\n\tupdated: string[];\n\toverrides: [string, string[]][];\n}\n\nexport function compare(from: IConfigurationModel | undefined, to: IConfigurationModel | undefined): IConfigurationCompareResult {\n\tconst added = to\n\t\t? from ? to.keys.filter(key => from.keys.indexOf(key) === -1) : [...to.keys]\n\t\t: [];\n\tconst removed = from\n\t\t? to ? from.keys.filter(key => to.keys.indexOf(key) === -1) : [...from.keys]\n\t\t: [];\n\tconst updated: string[] = [];\n\n\tif (to && from) {\n\t\tfor (const key of from.keys) {\n\t\t\tif (to.keys.indexOf(key) !== -1) {\n\t\t\t\tconst value1 = getConfigurationValue(from.contents, key);\n\t\t\t\tconst value2 = getConfigurationValue(to.contents, key);\n\t\t\t\tif (!objects.equals(value1, value2)) {\n\t\t\t\t\tupdated.push(key);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tconst overrides: [string, string[]][] = [];\n\tconst byOverrideIdentifier = (overrides: IOverrides[]): IStringDictionary<IOverrides> => {\n\t\tconst result: IStringDictionary<IOverrides> = {};\n\t\tfor (const override of overrides) {\n\t\t\tfor (const identifier of override.identifiers) {\n\t\t\t\tresult[keyFromOverrideIdentifier(identifier)] = override;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\tconst toOverridesByIdentifier: IStringDictionary<IOverrides> = to ? byOverrideIdentifier(to.overrides) : {};\n\tconst fromOverridesByIdentifier: IStringDictionary<IOverrides> = from ? byOverrideIdentifier(from.overrides) : {};\n\n\tif (Object.keys(toOverridesByIdentifier).length) {\n\t\tfor (const key of added) {\n\t\t\tconst override = toOverridesByIdentifier[key];\n\t\t\tif (override) {\n\t\t\t\toverrides.push([overrideIdentifierFromKey(key), override.keys]);\n\t\t\t}\n\t\t}\n\t}\n\tif (Object.keys(fromOverridesByIdentifier).length) {\n\t\tfor (const key of removed) {\n\t\t\tconst override = fromOverridesByIdentifier[key];\n\t\t\tif (override) {\n\t\t\t\toverrides.push([overrideIdentifierFromKey(key), override.keys]);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (Object.keys(toOverridesByIdentifier).length && Object.keys(fromOverridesByIdentifier).length) {\n\t\tfor (const key of updated) {\n\t\t\tconst fromOverride = fromOverridesByIdentifier[key];\n\t\t\tconst toOverride = toOverridesByIdentifier[key];\n\t\t\tif (fromOverride && toOverride) {\n\t\t\t\tconst result = compare({ contents: fromOverride.contents, keys: fromOverride.keys, overrides: [] }, { contents: toOverride.contents, keys: toOverride.keys, overrides: [] });\n\t\t\t\toverrides.push([overrideIdentifierFromKey(key), [...result.added, ...result.removed, ...result.updated]]);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn { added, removed, updated, overrides };\n}\n\nexport function toOverrides(raw: any, conflictReporter: (message: string) => void): IOverrides[] {\n\tconst overrides: IOverrides[] = [];\n\tfor (const key of Object.keys(raw)) {\n\t\tif (OVERRIDE_PROPERTY_PATTERN.test(key)) {\n\t\t\tconst overrideRaw: any = {};\n\t\t\tfor (const keyInOverrideRaw in raw[key]) {\n\t\t\t\toverrideRaw[keyInOverrideRaw] = raw[key][keyInOverrideRaw];\n\t\t\t}\n\t\t\toverrides.push({\n\t\t\t\tidentifiers: [overrideIdentifierFromKey(key).trim()],\n\t\t\t\tkeys: Object.keys(overrideRaw),\n\t\t\t\tcontents: toValuesTree(overrideRaw, conflictReporter)\n\t\t\t});\n\t\t}\n\t}\n\treturn overrides;\n}\n\nexport function toValuesTree(properties: { [qualifiedKey: string]: any }, conflictReporter: (message: string) => void): any {\n\tconst root = Object.create(null);\n\n\tfor (let key in properties) {\n\t\taddToValueTree(root, key, properties[key], conflictReporter);\n\t}\n\n\treturn root;\n}\n\nexport function addToValueTree(settingsTreeRoot: any, key: string, value: any, conflictReporter: (message: string) => void): void {\n\tconst segments = key.split('.');\n\tconst last = segments.pop()!;\n\n\tlet curr = settingsTreeRoot;\n\tfor (let i = 0; i < segments.length; i++) {\n\t\tlet s = segments[i];\n\t\tlet obj = curr[s];\n\t\tswitch (typeof obj) {\n\t\t\tcase 'undefined':\n\t\t\t\tobj = curr[s] = Object.create(null);\n\t\t\t\tbreak;\n\t\t\tcase 'object':\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tconflictReporter(`Ignoring ${key} as ${segments.slice(0, i + 1).join('.')} is ${JSON.stringify(obj)}`);\n\t\t\t\treturn;\n\t\t}\n\t\tcurr = obj;\n\t}\n\n\tif (typeof curr === 'object' && curr !== null) {\n\t\ttry {\n\t\t\tcurr[last] = value; // workaround https://github.com/microsoft/vscode/issues/13606\n\t\t} catch (e) {\n\t\t\tconflictReporter(`Ignoring ${key} as ${segments.join('.')} is ${JSON.stringify(curr)}`);\n\t\t}\n\t} else {\n\t\tconflictReporter(`Ignoring ${key} as ${segments.join('.')} is ${JSON.stringify(curr)}`);\n\t}\n}\n\nexport function removeFromValueTree(valueTree: any, key: string): void {\n\tconst segments = key.split('.');\n\tdoRemoveFromValueTree(valueTree, segments);\n}\n\nfunction doRemoveFromValueTree(valueTree: any, segments: string[]): void {\n\tconst first = segments.shift()!;\n\tif (segments.length === 0) {\n\t\t// Reached last segment\n\t\tdelete valueTree[first];\n\t\treturn;\n\t}\n\n\tif (Object.keys(valueTree).indexOf(first) !== -1) {\n\t\tconst value = valueTree[first];\n\t\tif (typeof value === 'object' && !Array.isArray(value)) {\n\t\t\tdoRemoveFromValueTree(value, segments);\n\t\t\tif (Object.keys(value).length === 0) {\n\t\t\t\tdelete valueTree[first];\n\t\t\t}\n\t\t}\n\t}\n}\n\n/**\n * A helper function to get the configuration value with a specific settings path (e.g. config.some.setting)\n */\nexport function getConfigurationValue<T>(config: any, settingPath: string, defaultValue?: T): T {\n\tfunction accessSetting(config: any, path: string[]): any {\n\t\tlet current = config;\n\t\tfor (const component of path) {\n\t\t\tif (typeof current !== 'object' || current === null) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tcurrent = current[component];\n\t\t}\n\t\treturn <T>current;\n\t}\n\n\tconst path = settingPath.split('.');\n\tconst result = accessSetting(config, path);\n\n\treturn typeof result === 'undefined' ? defaultValue : result;\n}\n\nexport function merge(base: any, add: any, overwrite: boolean): void {\n\tObject.keys(add).forEach(key => {\n\t\tif (key !== '__proto__') {\n\t\t\tif (key in base) {\n\t\t\t\tif (types.isObject(base[key]) && types.isObject(add[key])) {\n\t\t\t\t\tmerge(base[key], add[key], overwrite);\n\t\t\t\t} else if (overwrite) {\n\t\t\t\t\tbase[key] = add[key];\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tbase[key] = add[key];\n\t\t\t}\n\t\t}\n\t});\n}\n\nexport function getConfigurationKeys(): string[] {\n\tconst properties = Registry.as<IConfigurationRegistry>(Extensions.Configuration).getConfigurationProperties();\n\treturn Object.keys(properties);\n}\n\nexport function getDefaultValues(): any {\n\tconst valueTreeRoot: any = Object.create(null);\n\tconst properties = Registry.as<IConfigurationRegistry>(Extensions.Configuration).getConfigurationProperties();\n\n\tfor (let key in properties) {\n\t\tlet value = properties[key].default;\n\t\taddToValueTree(valueTreeRoot, key, value, message => console.error(`Conflict in default settings: ${message}`));\n\t}\n\n\treturn valueTreeRoot;\n}\n\nexport function keyFromOverrideIdentifier(overrideIdentifier: string): string {\n\treturn `[${overrideIdentifier}]`;\n}\n\nexport function getMigratedSettingValue<T>(configurationService: IConfigurationService, currentSettingName: string, legacySettingName: string): T {\n\tconst setting = configurationService.inspect<T>(currentSettingName);\n\tconst legacySetting = configurationService.inspect<T>(legacySettingName);\n\n\tif (typeof setting.userValue !== 'undefined' || typeof setting.workspaceValue !== 'undefined' || typeof setting.workspaceFolderValue !== 'undefined') {\n\t\treturn setting.value!;\n\t} else if (typeof legacySetting.userValue !== 'undefined' || typeof legacySetting.workspaceValue !== 'undefined' || typeof legacySetting.workspaceFolderValue !== 'undefined') {\n\t\treturn legacySetting.value!;\n\t} else {\n\t\treturn setting.defaultValue!;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as json from 'vs/base/common/json';\nimport { ResourceMap, getOrSet } from 'vs/base/common/map';\nimport * as arrays from 'vs/base/common/arrays';\nimport * as types from 'vs/base/common/types';\nimport * as objects from 'vs/base/common/objects';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { OVERRIDE_PROPERTY_PATTERN, ConfigurationScope, IConfigurationRegistry, Extensions, IConfigurationPropertySchema, overrideIdentifierFromKey } from 'vs/platform/configuration/common/configurationRegistry';\nimport { IOverrides, addToValueTree, toValuesTree, IConfigurationModel, getConfigurationValue, IConfigurationOverrides, IConfigurationData, getDefaultValues, getConfigurationKeys, removeFromValueTree, toOverrides, IConfigurationValue, ConfigurationTarget, compare, IConfigurationChangeEvent, IConfigurationChange } from 'vs/platform/configuration/common/configuration';\nimport { Workspace } from 'vs/platform/workspace/common/workspace';\nimport { Registry } from 'vs/platform/registry/common/platform';\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { IFileService } from 'vs/platform/files/common/files';\nimport { IExtUri } from 'vs/base/common/resources';\n\nexport class ConfigurationModel implements IConfigurationModel {\n\n\tprivate isFrozen: boolean = false;\n\n\tconstructor(\n\t\tprivate _contents: any = {},\n\t\tprivate _keys: string[] = [],\n\t\tprivate _overrides: IOverrides[] = []\n\t) {\n\t}\n\n\tget contents(): any {\n\t\treturn this.checkAndFreeze(this._contents);\n\t}\n\n\tget overrides(): IOverrides[] {\n\t\treturn this.checkAndFreeze(this._overrides);\n\t}\n\n\tget keys(): string[] {\n\t\treturn this.checkAndFreeze(this._keys);\n\t}\n\n\tisEmpty(): boolean {\n\t\treturn this._keys.length === 0 && Object.keys(this._contents).length === 0 && this._overrides.length === 0;\n\t}\n\n\tgetValue<V>(section: string | undefined): V {\n\t\treturn section ? getConfigurationValue<any>(this.contents, section) : this.contents;\n\t}\n\n\tgetOverrideValue<V>(section: string | undefined, overrideIdentifier: string): V | undefined {\n\t\tconst overrideContents = this.getContentsForOverrideIdentifer(overrideIdentifier);\n\t\treturn overrideContents\n\t\t\t? section ? getConfigurationValue<any>(overrideContents, section) : overrideContents\n\t\t\t: undefined;\n\t}\n\n\tgetKeysForOverrideIdentifier(identifier: string): string[] {\n\t\tfor (const override of this.overrides) {\n\t\t\tif (override.identifiers.indexOf(identifier) !== -1) {\n\t\t\t\treturn override.keys;\n\t\t\t}\n\t\t}\n\t\treturn [];\n\t}\n\n\toverride(identifier: string): ConfigurationModel {\n\t\tconst overrideContents = this.getContentsForOverrideIdentifer(identifier);\n\n\t\tif (!overrideContents || typeof overrideContents !== 'object' || !Object.keys(overrideContents).length) {\n\t\t\t// If there are no valid overrides, return self\n\t\t\treturn this;\n\t\t}\n\n\t\tlet contents: any = {};\n\t\tfor (const key of arrays.distinct([...Object.keys(this.contents), ...Object.keys(overrideContents)])) {\n\n\t\t\tlet contentsForKey = this.contents[key];\n\t\t\tlet overrideContentsForKey = overrideContents[key];\n\n\t\t\t// If there are override contents for the key, clone and merge otherwise use base contents\n\t\t\tif (overrideContentsForKey) {\n\t\t\t\t// Clone and merge only if base contents and override contents are of type object otherwise just override\n\t\t\t\tif (typeof contentsForKey === 'object' && typeof overrideContentsForKey === 'object') {\n\t\t\t\t\tcontentsForKey = objects.deepClone(contentsForKey);\n\t\t\t\t\tthis.mergeContents(contentsForKey, overrideContentsForKey);\n\t\t\t\t} else {\n\t\t\t\t\tcontentsForKey = overrideContentsForKey;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcontents[key] = contentsForKey;\n\t\t}\n\n\t\treturn new ConfigurationModel(contents, this.keys, this.overrides);\n\t}\n\n\tmerge(...others: ConfigurationModel[]): ConfigurationModel {\n\t\tconst contents = objects.deepClone(this.contents);\n\t\tconst overrides = objects.deepClone(this.overrides);\n\t\tconst keys = [...this.keys];\n\n\t\tfor (const other of others) {\n\t\t\tthis.mergeContents(contents, other.contents);\n\n\t\t\tfor (const otherOverride of other.overrides) {\n\t\t\t\tconst [override] = overrides.filter(o => arrays.equals(o.identifiers, otherOverride.identifiers));\n\t\t\t\tif (override) {\n\t\t\t\t\tthis.mergeContents(override.contents, otherOverride.contents);\n\t\t\t\t} else {\n\t\t\t\t\toverrides.push(objects.deepClone(otherOverride));\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (const key of other.keys) {\n\t\t\t\tif (keys.indexOf(key) === -1) {\n\t\t\t\t\tkeys.push(key);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn new ConfigurationModel(contents, keys, overrides);\n\t}\n\n\tfreeze(): ConfigurationModel {\n\t\tthis.isFrozen = true;\n\t\treturn this;\n\t}\n\n\tprivate mergeContents(source: any, target: any): void {\n\t\tfor (const key of Object.keys(target)) {\n\t\t\tif (key in source) {\n\t\t\t\tif (types.isObject(source[key]) && types.isObject(target[key])) {\n\t\t\t\t\tthis.mergeContents(source[key], target[key]);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t\tsource[key] = objects.deepClone(target[key]);\n\t\t}\n\t}\n\n\tprivate checkAndFreeze<T>(data: T): T {\n\t\tif (this.isFrozen && !Object.isFrozen(data)) {\n\t\t\treturn objects.deepFreeze(data);\n\t\t}\n\t\treturn data;\n\t}\n\n\tprivate getContentsForOverrideIdentifer(identifier: string): any {\n\t\tfor (const override of this.overrides) {\n\t\t\tif (override.identifiers.indexOf(identifier) !== -1) {\n\t\t\t\treturn override.contents;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\ttoJSON(): IConfigurationModel {\n\t\treturn {\n\t\t\tcontents: this.contents,\n\t\t\toverrides: this.overrides,\n\t\t\tkeys: this.keys\n\t\t};\n\t}\n\n\t// Update methods\n\n\tpublic setValue(key: string, value: any) {\n\t\tthis.addKey(key);\n\t\taddToValueTree(this.contents, key, value, e => { throw new Error(e); });\n\t}\n\n\tpublic removeValue(key: string): void {\n\t\tif (this.removeKey(key)) {\n\t\t\tremoveFromValueTree(this.contents, key);\n\t\t}\n\t}\n\n\tprivate addKey(key: string): void {\n\t\tlet index = this.keys.length;\n\t\tfor (let i = 0; i < index; i++) {\n\t\t\tif (key.indexOf(this.keys[i]) === 0) {\n\t\t\t\tindex = i;\n\t\t\t}\n\t\t}\n\t\tthis.keys.splice(index, 1, key);\n\t}\n\n\tprivate removeKey(key: string): boolean {\n\t\tlet index = this.keys.indexOf(key);\n\t\tif (index !== -1) {\n\t\t\tthis.keys.splice(index, 1);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n}\n\nexport class DefaultConfigurationModel extends ConfigurationModel {\n\n\tconstructor() {\n\t\tconst contents = getDefaultValues();\n\t\tconst keys = getConfigurationKeys();\n\t\tconst overrides: IOverrides[] = [];\n\t\tfor (const key of Object.keys(contents)) {\n\t\t\tif (OVERRIDE_PROPERTY_PATTERN.test(key)) {\n\t\t\t\toverrides.push({\n\t\t\t\t\tidentifiers: [overrideIdentifierFromKey(key).trim()],\n\t\t\t\t\tkeys: Object.keys(contents[key]),\n\t\t\t\t\tcontents: toValuesTree(contents[key], message => console.error(`Conflict in default settings file: ${message}`)),\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tsuper(contents, keys, overrides);\n\t}\n}\n\nexport class ConfigurationModelParser {\n\n\tprivate _raw: any = null;\n\tprivate _configurationModel: ConfigurationModel | null = null;\n\tprivate _parseErrors: any[] = [];\n\n\tconstructor(protected readonly _name: string, private _scopes?: ConfigurationScope[]) { }\n\n\tget configurationModel(): ConfigurationModel {\n\t\treturn this._configurationModel || new ConfigurationModel();\n\t}\n\n\tget errors(): any[] {\n\t\treturn this._parseErrors;\n\t}\n\n\tpublic parseContent(content: string | null | undefined): void {\n\t\tif (!types.isUndefinedOrNull(content)) {\n\t\t\tconst raw = this.doParseContent(content);\n\t\t\tthis.parseRaw(raw);\n\t\t}\n\t}\n\n\tpublic parseRaw(raw: any): void {\n\t\tthis._raw = raw;\n\t\tconst configurationModel = this.doParseRaw(raw);\n\t\tthis._configurationModel = new ConfigurationModel(configurationModel.contents, configurationModel.keys, configurationModel.overrides);\n\t}\n\n\tpublic parse(): void {\n\t\tif (this._raw) {\n\t\t\tthis.parseRaw(this._raw);\n\t\t}\n\t}\n\n\tprotected doParseContent(content: string): any {\n\t\tlet raw: any = {};\n\t\tlet currentProperty: string | null = null;\n\t\tlet currentParent: any = [];\n\t\tlet previousParents: any[] = [];\n\t\tlet parseErrors: json.ParseError[] = [];\n\n\t\tfunction onValue(value: any) {\n\t\t\tif (Array.isArray(currentParent)) {\n\t\t\t\t(<any[]>currentParent).push(value);\n\t\t\t} else if (currentProperty) {\n\t\t\t\tcurrentParent[currentProperty] = value;\n\t\t\t}\n\t\t}\n\n\t\tlet visitor: json.JSONVisitor = {\n\t\t\tonObjectBegin: () => {\n\t\t\t\tlet object = {};\n\t\t\t\tonValue(object);\n\t\t\t\tpreviousParents.push(currentParent);\n\t\t\t\tcurrentParent = object;\n\t\t\t\tcurrentProperty = null;\n\t\t\t},\n\t\t\tonObjectProperty: (name: string) => {\n\t\t\t\tcurrentProperty = name;\n\t\t\t},\n\t\t\tonObjectEnd: () => {\n\t\t\t\tcurrentParent = previousParents.pop();\n\t\t\t},\n\t\t\tonArrayBegin: () => {\n\t\t\t\tlet array: any[] = [];\n\t\t\t\tonValue(array);\n\t\t\t\tpreviousParents.push(currentParent);\n\t\t\t\tcurrentParent = array;\n\t\t\t\tcurrentProperty = null;\n\t\t\t},\n\t\t\tonArrayEnd: () => {\n\t\t\t\tcurrentParent = previousParents.pop();\n\t\t\t},\n\t\t\tonLiteralValue: onValue,\n\t\t\tonError: (error: json.ParseErrorCode, offset: number, length: number) => {\n\t\t\t\tparseErrors.push({ error, offset, length });\n\t\t\t}\n\t\t};\n\t\tif (content) {\n\t\t\ttry {\n\t\t\t\tjson.visit(content, visitor);\n\t\t\t\traw = currentParent[0] || {};\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(`Error while parsing settings file ${this._name}: ${e}`);\n\t\t\t\tthis._parseErrors = [e];\n\t\t\t}\n\t\t}\n\n\t\treturn raw;\n\t}\n\n\tprotected doParseRaw(raw: any): IConfigurationModel {\n\t\tif (this._scopes) {\n\t\t\tconst configurationProperties = Registry.as<IConfigurationRegistry>(Extensions.Configuration).getConfigurationProperties();\n\t\t\traw = this.filterByScope(raw, configurationProperties, true, this._scopes);\n\t\t}\n\t\tconst contents = toValuesTree(raw, message => console.error(`Conflict in settings file ${this._name}: ${message}`));\n\t\tconst keys = Object.keys(raw);\n\t\tconst overrides: IOverrides[] = toOverrides(raw, message => console.error(`Conflict in settings file ${this._name}: ${message}`));\n\t\treturn { contents, keys, overrides };\n\t}\n\n\tprivate filterByScope(properties: any, configurationProperties: { [qualifiedKey: string]: IConfigurationPropertySchema }, filterOverriddenProperties: boolean, scopes: ConfigurationScope[]): {} {\n\t\tconst result: any = {};\n\t\tfor (let key in properties) {\n\t\t\tif (OVERRIDE_PROPERTY_PATTERN.test(key) && filterOverriddenProperties) {\n\t\t\t\tresult[key] = this.filterByScope(properties[key], configurationProperties, false, scopes);\n\t\t\t} else {\n\t\t\t\tconst scope = this.getScope(key, configurationProperties);\n\t\t\t\t// Load unregistered configurations always.\n\t\t\t\tif (scope === undefined || scopes.indexOf(scope) !== -1) {\n\t\t\t\t\tresult[key] = properties[key];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate getScope(key: string, configurationProperties: { [qualifiedKey: string]: IConfigurationPropertySchema }): ConfigurationScope | undefined {\n\t\tconst propertySchema = configurationProperties[key];\n\t\treturn propertySchema ? typeof propertySchema.scope !== 'undefined' ? propertySchema.scope : ConfigurationScope.WINDOW : undefined;\n\t}\n}\n\nexport class UserSettings extends Disposable {\n\n\tprivate readonly parser: ConfigurationModelParser;\n\tprotected readonly _onDidChange: Emitter<void> = this._register(new Emitter<void>());\n\treadonly onDidChange: Event<void> = this._onDidChange.event;\n\n\tconstructor(\n\t\tprivate readonly userSettingsResource: URI,\n\t\tprivate readonly scopes: ConfigurationScope[] | undefined,\n\t\textUri: IExtUri,\n\t\tprivate readonly fileService: IFileService\n\t) {\n\t\tsuper();\n\t\tthis.parser = new ConfigurationModelParser(this.userSettingsResource.toString(), this.scopes);\n\t\tthis._register(this.fileService.watch(extUri.dirname(this.userSettingsResource)));\n\t\tthis._register(Event.filter(this.fileService.onDidFilesChange, e => e.contains(this.userSettingsResource))(() => this._onDidChange.fire()));\n\t}\n\n\tasync loadConfiguration(): Promise<ConfigurationModel> {\n\t\ttry {\n\t\t\tconst content = await this.fileService.readFile(this.userSettingsResource);\n\t\t\tthis.parser.parseContent(content.value.toString() || '{}');\n\t\t\treturn this.parser.configurationModel;\n\t\t} catch (e) {\n\t\t\treturn new ConfigurationModel();\n\t\t}\n\t}\n\n\treprocess(): ConfigurationModel {\n\t\tthis.parser.parse();\n\t\treturn this.parser.configurationModel;\n\t}\n}\n\n\nexport class Configuration {\n\n\tprivate _workspaceConsolidatedConfiguration: ConfigurationModel | null = null;\n\tprivate _foldersConsolidatedConfigurations: ResourceMap<ConfigurationModel> = new ResourceMap<ConfigurationModel>();\n\n\tconstructor(\n\t\tprivate _defaultConfiguration: ConfigurationModel,\n\t\tprivate _localUserConfiguration: ConfigurationModel,\n\t\tprivate _remoteUserConfiguration: ConfigurationModel = new ConfigurationModel(),\n\t\tprivate _workspaceConfiguration: ConfigurationModel = new ConfigurationModel(),\n\t\tprivate _folderConfigurations: ResourceMap<ConfigurationModel> = new ResourceMap<ConfigurationModel>(),\n\t\tprivate _memoryConfiguration: ConfigurationModel = new ConfigurationModel(),\n\t\tprivate _memoryConfigurationByResource: ResourceMap<ConfigurationModel> = new ResourceMap<ConfigurationModel>(),\n\t\tprivate _freeze: boolean = true) {\n\t}\n\n\tgetValue(section: string | undefined, overrides: IConfigurationOverrides, workspace: Workspace | undefined): any {\n\t\tconst consolidateConfigurationModel = this.getConsolidateConfigurationModel(overrides, workspace);\n\t\treturn consolidateConfigurationModel.getValue(section);\n\t}\n\n\tupdateValue(key: string, value: any, overrides: IConfigurationOverrides = {}): void {\n\t\tlet memoryConfiguration: ConfigurationModel | undefined;\n\t\tif (overrides.resource) {\n\t\t\tmemoryConfiguration = this._memoryConfigurationByResource.get(overrides.resource);\n\t\t\tif (!memoryConfiguration) {\n\t\t\t\tmemoryConfiguration = new ConfigurationModel();\n\t\t\t\tthis._memoryConfigurationByResource.set(overrides.resource, memoryConfiguration);\n\t\t\t}\n\t\t} else {\n\t\t\tmemoryConfiguration = this._memoryConfiguration;\n\t\t}\n\n\t\tif (value === undefined) {\n\t\t\tmemoryConfiguration.removeValue(key);\n\t\t} else {\n\t\t\tmemoryConfiguration.setValue(key, value);\n\t\t}\n\n\t\tif (!overrides.resource) {\n\t\t\tthis._workspaceConsolidatedConfiguration = null;\n\t\t}\n\t}\n\n\tinspect<C>(key: string, overrides: IConfigurationOverrides, workspace: Workspace | undefined): IConfigurationValue<C> {\n\t\tconst consolidateConfigurationModel = this.getConsolidateConfigurationModel(overrides, workspace);\n\t\tconst folderConfigurationModel = this.getFolderConfigurationModelForResource(overrides.resource, workspace);\n\t\tconst memoryConfigurationModel = overrides.resource ? this._memoryConfigurationByResource.get(overrides.resource) || this._memoryConfiguration : this._memoryConfiguration;\n\n\t\tconst defaultValue = overrides.overrideIdentifier ? this._defaultConfiguration.freeze().override(overrides.overrideIdentifier).getValue<C>(key) : this._defaultConfiguration.freeze().getValue<C>(key);\n\t\tconst userValue = overrides.overrideIdentifier ? this.userConfiguration.freeze().override(overrides.overrideIdentifier).getValue<C>(key) : this.userConfiguration.freeze().getValue<C>(key);\n\t\tconst userLocalValue = overrides.overrideIdentifier ? this.localUserConfiguration.freeze().override(overrides.overrideIdentifier).getValue<C>(key) : this.localUserConfiguration.freeze().getValue<C>(key);\n\t\tconst userRemoteValue = overrides.overrideIdentifier ? this.remoteUserConfiguration.freeze().override(overrides.overrideIdentifier).getValue<C>(key) : this.remoteUserConfiguration.freeze().getValue<C>(key);\n\t\tconst workspaceValue = workspace ? overrides.overrideIdentifier ? this._workspaceConfiguration.freeze().override(overrides.overrideIdentifier).getValue<C>(key) : this._workspaceConfiguration.freeze().getValue<C>(key) : undefined; //Check on workspace exists or not because _workspaceConfiguration is never null\n\t\tconst workspaceFolderValue = folderConfigurationModel ? overrides.overrideIdentifier ? folderConfigurationModel.freeze().override(overrides.overrideIdentifier).getValue<C>(key) : folderConfigurationModel.freeze().getValue<C>(key) : undefined;\n\t\tconst memoryValue = overrides.overrideIdentifier ? memoryConfigurationModel.override(overrides.overrideIdentifier).getValue<C>(key) : memoryConfigurationModel.getValue<C>(key);\n\t\tconst value = consolidateConfigurationModel.getValue<C>(key);\n\t\tconst overrideIdentifiers: string[] = arrays.distinct(arrays.flatten(consolidateConfigurationModel.overrides.map(override => override.identifiers))).filter(overrideIdentifier => consolidateConfigurationModel.getOverrideValue(key, overrideIdentifier) !== undefined);\n\n\t\treturn {\n\t\t\tdefaultValue: defaultValue,\n\t\t\tuserValue: userValue,\n\t\t\tuserLocalValue: userLocalValue,\n\t\t\tuserRemoteValue: userRemoteValue,\n\t\t\tworkspaceValue: workspaceValue,\n\t\t\tworkspaceFolderValue: workspaceFolderValue,\n\t\t\tmemoryValue: memoryValue,\n\t\t\tvalue,\n\n\t\t\tdefault: defaultValue !== undefined ? { value: this._defaultConfiguration.freeze().getValue(key), override: overrides.overrideIdentifier ? this._defaultConfiguration.freeze().getOverrideValue(key, overrides.overrideIdentifier) : undefined } : undefined,\n\t\t\tuser: userValue !== undefined ? { value: this.userConfiguration.freeze().getValue(key), override: overrides.overrideIdentifier ? this.userConfiguration.freeze().getOverrideValue(key, overrides.overrideIdentifier) : undefined } : undefined,\n\t\t\tuserLocal: userLocalValue !== undefined ? { value: this.localUserConfiguration.freeze().getValue(key), override: overrides.overrideIdentifier ? this.localUserConfiguration.freeze().getOverrideValue(key, overrides.overrideIdentifier) : undefined } : undefined,\n\t\t\tuserRemote: userRemoteValue !== undefined ? { value: this.remoteUserConfiguration.freeze().getValue(key), override: overrides.overrideIdentifier ? this.remoteUserConfiguration.freeze().getOverrideValue(key, overrides.overrideIdentifier) : undefined } : undefined,\n\t\t\tworkspace: workspaceValue !== undefined ? { value: this._workspaceConfiguration.freeze().getValue(key), override: overrides.overrideIdentifier ? this._workspaceConfiguration.freeze().getOverrideValue(key, overrides.overrideIdentifier) : undefined } : undefined,\n\t\t\tworkspaceFolder: workspaceFolderValue !== undefined ? { value: folderConfigurationModel?.freeze().getValue(key), override: overrides.overrideIdentifier ? folderConfigurationModel?.freeze().getOverrideValue(key, overrides.overrideIdentifier) : undefined } : undefined,\n\t\t\tmemory: memoryValue !== undefined ? { value: memoryConfigurationModel.getValue(key), override: overrides.overrideIdentifier ? memoryConfigurationModel.getOverrideValue(key, overrides.overrideIdentifier) : undefined } : undefined,\n\n\t\t\toverrideIdentifiers: overrideIdentifiers.length ? overrideIdentifiers : undefined\n\t\t};\n\t}\n\n\tkeys(workspace: Workspace | undefined): {\n\t\tdefault: string[];\n\t\tuser: string[];\n\t\tworkspace: string[];\n\t\tworkspaceFolder: string[];\n\t} {\n\t\tconst folderConfigurationModel = this.getFolderConfigurationModelForResource(undefined, workspace);\n\t\treturn {\n\t\t\tdefault: this._defaultConfiguration.freeze().keys,\n\t\t\tuser: this.userConfiguration.freeze().keys,\n\t\t\tworkspace: this._workspaceConfiguration.freeze().keys,\n\t\t\tworkspaceFolder: folderConfigurationModel ? folderConfigurationModel.freeze().keys : []\n\t\t};\n\t}\n\n\tupdateDefaultConfiguration(defaultConfiguration: ConfigurationModel): void {\n\t\tthis._defaultConfiguration = defaultConfiguration;\n\t\tthis._workspaceConsolidatedConfiguration = null;\n\t\tthis._foldersConsolidatedConfigurations.clear();\n\t}\n\n\tupdateLocalUserConfiguration(localUserConfiguration: ConfigurationModel): void {\n\t\tthis._localUserConfiguration = localUserConfiguration;\n\t\tthis._userConfiguration = null;\n\t\tthis._workspaceConsolidatedConfiguration = null;\n\t\tthis._foldersConsolidatedConfigurations.clear();\n\t}\n\n\tupdateRemoteUserConfiguration(remoteUserConfiguration: ConfigurationModel): void {\n\t\tthis._remoteUserConfiguration = remoteUserConfiguration;\n\t\tthis._userConfiguration = null;\n\t\tthis._workspaceConsolidatedConfiguration = null;\n\t\tthis._foldersConsolidatedConfigurations.clear();\n\t}\n\n\tupdateWorkspaceConfiguration(workspaceConfiguration: ConfigurationModel): void {\n\t\tthis._workspaceConfiguration = workspaceConfiguration;\n\t\tthis._workspaceConsolidatedConfiguration = null;\n\t\tthis._foldersConsolidatedConfigurations.clear();\n\t}\n\n\tupdateFolderConfiguration(resource: URI, configuration: ConfigurationModel): void {\n\t\tthis._folderConfigurations.set(resource, configuration);\n\t\tthis._foldersConsolidatedConfigurations.delete(resource);\n\t}\n\n\tdeleteFolderConfiguration(resource: URI): void {\n\t\tthis.folderConfigurations.delete(resource);\n\t\tthis._foldersConsolidatedConfigurations.delete(resource);\n\t}\n\n\tcompareAndUpdateDefaultConfiguration(defaults: ConfigurationModel, keys: string[]): IConfigurationChange {\n\t\tconst overrides: [string, string[]][] = keys\n\t\t\t.filter(key => OVERRIDE_PROPERTY_PATTERN.test(key))\n\t\t\t.map(key => {\n\t\t\t\tconst overrideIdentifier = overrideIdentifierFromKey(key);\n\t\t\t\tconst fromKeys = this._defaultConfiguration.getKeysForOverrideIdentifier(overrideIdentifier);\n\t\t\t\tconst toKeys = defaults.getKeysForOverrideIdentifier(overrideIdentifier);\n\t\t\t\tconst keys = [\n\t\t\t\t\t...toKeys.filter(key => fromKeys.indexOf(key) === -1),\n\t\t\t\t\t...fromKeys.filter(key => toKeys.indexOf(key) === -1),\n\t\t\t\t\t...fromKeys.filter(key => !objects.equals(this._defaultConfiguration.override(overrideIdentifier).getValue(key), defaults.override(overrideIdentifier).getValue(key)))\n\t\t\t\t];\n\t\t\t\treturn [overrideIdentifier, keys];\n\t\t\t});\n\t\tthis.updateDefaultConfiguration(defaults);\n\t\treturn { keys, overrides };\n\t}\n\n\tcompareAndUpdateLocalUserConfiguration(user: ConfigurationModel): IConfigurationChange {\n\t\tconst { added, updated, removed, overrides } = compare(this.localUserConfiguration, user);\n\t\tconst keys = [...added, ...updated, ...removed];\n\t\tif (keys.length) {\n\t\t\tthis.updateLocalUserConfiguration(user);\n\t\t}\n\t\treturn { keys, overrides };\n\t}\n\n\tcompareAndUpdateRemoteUserConfiguration(user: ConfigurationModel): IConfigurationChange {\n\t\tconst { added, updated, removed, overrides } = compare(this.remoteUserConfiguration, user);\n\t\tlet keys = [...added, ...updated, ...removed];\n\t\tif (keys.length) {\n\t\t\tthis.updateRemoteUserConfiguration(user);\n\t\t}\n\t\treturn { keys, overrides };\n\t}\n\n\tcompareAndUpdateWorkspaceConfiguration(workspaceConfiguration: ConfigurationModel): IConfigurationChange {\n\t\tconst { added, updated, removed, overrides } = compare(this.workspaceConfiguration, workspaceConfiguration);\n\t\tlet keys = [...added, ...updated, ...removed];\n\t\tif (keys.length) {\n\t\t\tthis.updateWorkspaceConfiguration(workspaceConfiguration);\n\t\t}\n\t\treturn { keys, overrides };\n\t}\n\n\tcompareAndUpdateFolderConfiguration(resource: URI, folderConfiguration: ConfigurationModel): IConfigurationChange {\n\t\tconst currentFolderConfiguration = this.folderConfigurations.get(resource);\n\t\tconst { added, updated, removed, overrides } = compare(currentFolderConfiguration, folderConfiguration);\n\t\tlet keys = [...added, ...updated, ...removed];\n\t\tif (keys.length || !currentFolderConfiguration) {\n\t\t\tthis.updateFolderConfiguration(resource, folderConfiguration);\n\t\t}\n\t\treturn { keys, overrides };\n\t}\n\n\tcompareAndDeleteFolderConfiguration(folder: URI): IConfigurationChange {\n\t\tconst folderConfig = this.folderConfigurations.get(folder);\n\t\tif (!folderConfig) {\n\t\t\tthrow new Error('Unknown folder');\n\t\t}\n\t\tthis.deleteFolderConfiguration(folder);\n\t\tconst { added, updated, removed, overrides } = compare(folderConfig, undefined);\n\t\treturn { keys: [...added, ...updated, ...removed], overrides };\n\t}\n\n\tget defaults(): ConfigurationModel {\n\t\treturn this._defaultConfiguration;\n\t}\n\n\tprivate _userConfiguration: ConfigurationModel | null = null;\n\tget userConfiguration(): ConfigurationModel {\n\t\tif (!this._userConfiguration) {\n\t\t\tthis._userConfiguration = this._remoteUserConfiguration.isEmpty() ? this._localUserConfiguration : this._localUserConfiguration.merge(this._remoteUserConfiguration);\n\t\t\tif (this._freeze) {\n\t\t\t\tthis._userConfiguration.freeze();\n\t\t\t}\n\t\t}\n\t\treturn this._userConfiguration;\n\t}\n\n\tget localUserConfiguration(): ConfigurationModel {\n\t\treturn this._localUserConfiguration;\n\t}\n\n\tget remoteUserConfiguration(): ConfigurationModel {\n\t\treturn this._remoteUserConfiguration;\n\t}\n\n\tget workspaceConfiguration(): ConfigurationModel {\n\t\treturn this._workspaceConfiguration;\n\t}\n\n\tprotected get folderConfigurations(): ResourceMap<ConfigurationModel> {\n\t\treturn this._folderConfigurations;\n\t}\n\n\tprivate getConsolidateConfigurationModel(overrides: IConfigurationOverrides, workspace: Workspace | undefined): ConfigurationModel {\n\t\tlet configurationModel = this.getConsolidatedConfigurationModelForResource(overrides, workspace);\n\t\treturn overrides.overrideIdentifier ? configurationModel.override(overrides.overrideIdentifier) : configurationModel;\n\t}\n\n\tprivate getConsolidatedConfigurationModelForResource({ resource }: IConfigurationOverrides, workspace: Workspace | undefined): ConfigurationModel {\n\t\tlet consolidateConfiguration = this.getWorkspaceConsolidatedConfiguration();\n\n\t\tif (workspace && resource) {\n\t\t\tconst root = workspace.getFolder(resource);\n\t\t\tif (root) {\n\t\t\t\tconsolidateConfiguration = this.getFolderConsolidatedConfiguration(root.uri) || consolidateConfiguration;\n\t\t\t}\n\t\t\tconst memoryConfigurationForResource = this._memoryConfigurationByResource.get(resource);\n\t\t\tif (memoryConfigurationForResource) {\n\t\t\t\tconsolidateConfiguration = consolidateConfiguration.merge(memoryConfigurationForResource);\n\t\t\t}\n\t\t}\n\n\t\treturn consolidateConfiguration;\n\t}\n\n\tprivate getWorkspaceConsolidatedConfiguration(): ConfigurationModel {\n\t\tif (!this._workspaceConsolidatedConfiguration) {\n\t\t\tthis._workspaceConsolidatedConfiguration = this._defaultConfiguration.merge(this.userConfiguration, this._workspaceConfiguration, this._memoryConfiguration);\n\t\t\tif (this._freeze) {\n\t\t\t\tthis._workspaceConfiguration = this._workspaceConfiguration.freeze();\n\t\t\t}\n\t\t}\n\t\treturn this._workspaceConsolidatedConfiguration;\n\t}\n\n\tprivate getFolderConsolidatedConfiguration(folder: URI): ConfigurationModel {\n\t\tlet folderConsolidatedConfiguration = this._foldersConsolidatedConfigurations.get(folder);\n\t\tif (!folderConsolidatedConfiguration) {\n\t\t\tconst workspaceConsolidateConfiguration = this.getWorkspaceConsolidatedConfiguration();\n\t\t\tconst folderConfiguration = this._folderConfigurations.get(folder);\n\t\t\tif (folderConfiguration) {\n\t\t\t\tfolderConsolidatedConfiguration = workspaceConsolidateConfiguration.merge(folderConfiguration);\n\t\t\t\tif (this._freeze) {\n\t\t\t\t\tfolderConsolidatedConfiguration = folderConsolidatedConfiguration.freeze();\n\t\t\t\t}\n\t\t\t\tthis._foldersConsolidatedConfigurations.set(folder, folderConsolidatedConfiguration);\n\t\t\t} else {\n\t\t\t\tfolderConsolidatedConfiguration = workspaceConsolidateConfiguration;\n\t\t\t}\n\t\t}\n\t\treturn folderConsolidatedConfiguration;\n\t}\n\n\tprivate getFolderConfigurationModelForResource(resource: URI | null | undefined, workspace: Workspace | undefined): ConfigurationModel | undefined {\n\t\tif (workspace && resource) {\n\t\t\tconst root = workspace.getFolder(resource);\n\t\t\tif (root) {\n\t\t\t\treturn this._folderConfigurations.get(root.uri);\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\ttoData(): IConfigurationData {\n\t\treturn {\n\t\t\tdefaults: {\n\t\t\t\tcontents: this._defaultConfiguration.contents,\n\t\t\t\toverrides: this._defaultConfiguration.overrides,\n\t\t\t\tkeys: this._defaultConfiguration.keys\n\t\t\t},\n\t\t\tuser: {\n\t\t\t\tcontents: this.userConfiguration.contents,\n\t\t\t\toverrides: this.userConfiguration.overrides,\n\t\t\t\tkeys: this.userConfiguration.keys\n\t\t\t},\n\t\t\tworkspace: {\n\t\t\t\tcontents: this._workspaceConfiguration.contents,\n\t\t\t\toverrides: this._workspaceConfiguration.overrides,\n\t\t\t\tkeys: this._workspaceConfiguration.keys\n\t\t\t},\n\t\t\tfolders: [...this._folderConfigurations.keys()].reduce<[UriComponents, IConfigurationModel][]>((result, folder) => {\n\t\t\t\tconst { contents, overrides, keys } = this._folderConfigurations.get(folder)!;\n\t\t\t\tresult.push([folder, { contents, overrides, keys }]);\n\t\t\t\treturn result;\n\t\t\t}, [])\n\t\t};\n\t}\n\n\tallKeys(): string[] {\n\t\tconst keys: Set<string> = new Set<string>();\n\t\tthis._defaultConfiguration.freeze().keys.forEach(key => keys.add(key));\n\t\tthis.userConfiguration.freeze().keys.forEach(key => keys.add(key));\n\t\tthis._workspaceConfiguration.freeze().keys.forEach(key => keys.add(key));\n\t\tthis._folderConfigurations.forEach(folderConfiguraiton => folderConfiguraiton.freeze().keys.forEach(key => keys.add(key)));\n\t\treturn [...keys.values()];\n\t}\n\n\tprotected getAllKeysForOverrideIdentifier(overrideIdentifier: string): string[] {\n\t\tconst keys: Set<string> = new Set<string>();\n\t\tthis._defaultConfiguration.getKeysForOverrideIdentifier(overrideIdentifier).forEach(key => keys.add(key));\n\t\tthis.userConfiguration.getKeysForOverrideIdentifier(overrideIdentifier).forEach(key => keys.add(key));\n\t\tthis._workspaceConfiguration.getKeysForOverrideIdentifier(overrideIdentifier).forEach(key => keys.add(key));\n\t\tthis._folderConfigurations.forEach(folderConfiguraiton => folderConfiguraiton.getKeysForOverrideIdentifier(overrideIdentifier).forEach(key => keys.add(key)));\n\t\treturn [...keys.values()];\n\t}\n\n\tstatic parse(data: IConfigurationData): Configuration {\n\t\tconst defaultConfiguration = this.parseConfigurationModel(data.defaults);\n\t\tconst userConfiguration = this.parseConfigurationModel(data.user);\n\t\tconst workspaceConfiguration = this.parseConfigurationModel(data.workspace);\n\t\tconst folders: ResourceMap<ConfigurationModel> = data.folders.reduce((result, value) => {\n\t\t\tresult.set(URI.revive(value[0]), this.parseConfigurationModel(value[1]));\n\t\t\treturn result;\n\t\t}, new ResourceMap<ConfigurationModel>());\n\t\treturn new Configuration(defaultConfiguration, userConfiguration, new ConfigurationModel(), workspaceConfiguration, folders, new ConfigurationModel(), new ResourceMap<ConfigurationModel>(), false);\n\t}\n\n\tprivate static parseConfigurationModel(model: IConfigurationModel): ConfigurationModel {\n\t\treturn new ConfigurationModel(model.contents, model.keys, model.overrides).freeze();\n\t}\n\n}\n\nexport function mergeChanges(...changes: IConfigurationChange[]): IConfigurationChange {\n\tif (changes.length === 0) {\n\t\treturn { keys: [], overrides: [] };\n\t}\n\tif (changes.length === 1) {\n\t\treturn changes[0];\n\t}\n\tconst keysSet = new Set<string>();\n\tconst overridesMap = new Map<string, Set<string>>();\n\tfor (const change of changes) {\n\t\tchange.keys.forEach(key => keysSet.add(key));\n\t\tchange.overrides.forEach(([identifier, keys]) => {\n\t\t\tconst result = getOrSet(overridesMap, identifier, new Set<string>());\n\t\t\tkeys.forEach(key => result.add(key));\n\t\t});\n\t}\n\tconst overrides: [string, string[]][] = [];\n\toverridesMap.forEach((keys, identifier) => overrides.push([identifier, [...keys.values()]]));\n\treturn { keys: [...keysSet.values()], overrides };\n}\n\nexport class ConfigurationChangeEvent implements IConfigurationChangeEvent {\n\n\tprivate readonly affectedKeysTree: any;\n\treadonly affectedKeys: string[];\n\tsource!: ConfigurationTarget;\n\tsourceConfig: any;\n\n\tconstructor(readonly change: IConfigurationChange, private readonly previous: { workspace?: Workspace, data: IConfigurationData } | undefined, private readonly currentConfiguraiton: Configuration, private readonly currentWorkspace?: Workspace) {\n\t\tconst keysSet = new Set<string>();\n\t\tchange.keys.forEach(key => keysSet.add(key));\n\t\tchange.overrides.forEach(([, keys]) => keys.forEach(key => keysSet.add(key)));\n\t\tthis.affectedKeys = [...keysSet.values()];\n\n\t\tconst configurationModel = new ConfigurationModel();\n\t\tthis.affectedKeys.forEach(key => configurationModel.setValue(key, {}));\n\t\tthis.affectedKeysTree = configurationModel.contents;\n\t}\n\n\tprivate _previousConfiguration: Configuration | undefined = undefined;\n\tget previousConfiguration(): Configuration | undefined {\n\t\tif (!this._previousConfiguration && this.previous) {\n\t\t\tthis._previousConfiguration = Configuration.parse(this.previous.data);\n\t\t}\n\t\treturn this._previousConfiguration;\n\t}\n\n\taffectsConfiguration(section: string, overrides?: IConfigurationOverrides): boolean {\n\t\tif (this.doesAffectedKeysTreeContains(this.affectedKeysTree, section)) {\n\t\t\tif (overrides) {\n\t\t\t\tconst value1 = this.previousConfiguration ? this.previousConfiguration.getValue(section, overrides, this.previous?.workspace) : undefined;\n\t\t\t\tconst value2 = this.currentConfiguraiton.getValue(section, overrides, this.currentWorkspace);\n\t\t\t\treturn !objects.equals(value1, value2);\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tprivate doesAffectedKeysTreeContains(affectedKeysTree: any, section: string): boolean {\n\t\tlet requestedTree = toValuesTree({ [section]: true }, () => { });\n\n\t\tlet key;\n\t\twhile (typeof requestedTree === 'object' && (key = Object.keys(requestedTree)[0])) { // Only one key should present, since we added only one property\n\t\t\taffectedKeysTree = affectedKeysTree[key];\n\t\t\tif (!affectedKeysTree) {\n\t\t\t\treturn false; // Requested tree is not found\n\t\t\t}\n\t\t\trequestedTree = requestedTree[key];\n\t\t}\n\t\treturn true;\n\t}\n}\n\nexport class AllKeysConfigurationChangeEvent extends ConfigurationChangeEvent {\n\tconstructor(configuration: Configuration, workspace: Workspace, public source: ConfigurationTarget, public sourceConfig: any) {\n\t\tsuper({ keys: configuration.allKeys(), overrides: [] }, undefined, configuration, workspace);\n\t}\n\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { Event } from 'vs/base/common/event';\n\nexport const IRemoteAuthorityResolverService = createDecorator<IRemoteAuthorityResolverService>('remoteAuthorityResolverService');\n\nexport interface ResolvedAuthority {\n\treadonly authority: string;\n\treadonly host: string;\n\treadonly port: number;\n\treadonly connectionToken: string | undefined;\n}\n\nexport interface ResolvedOptions {\n\treadonly extensionHostEnv?: { [key: string]: string | null };\n}\n\nexport interface TunnelDescription {\n\tremoteAddress: { port: number, host: string };\n\tlocalAddress: { port: number, host: string } | string;\n}\nexport interface TunnelInformation {\n\tenvironmentTunnels?: TunnelDescription[];\n}\n\nexport interface ResolverResult {\n\tauthority: ResolvedAuthority;\n\toptions?: ResolvedOptions;\n\ttunnelInformation?: TunnelInformation;\n}\n\nexport interface IRemoteConnectionData {\n\thost: string;\n\tport: number;\n\tconnectionToken: string | undefined;\n}\n\nexport enum RemoteAuthorityResolverErrorCode {\n\tUnknown = 'Unknown',\n\tNotAvailable = 'NotAvailable',\n\tTemporarilyNotAvailable = 'TemporarilyNotAvailable',\n\tNoResolverFound = 'NoResolverFound'\n}\n\nexport class RemoteAuthorityResolverError extends Error {\n\n\tpublic static isTemporarilyNotAvailable(err: any): boolean {\n\t\treturn (err instanceof RemoteAuthorityResolverError) && err._code === RemoteAuthorityResolverErrorCode.TemporarilyNotAvailable;\n\t}\n\n\tpublic static isNoResolverFound(err: any): err is RemoteAuthorityResolverError {\n\t\treturn (err instanceof RemoteAuthorityResolverError) && err._code === RemoteAuthorityResolverErrorCode.NoResolverFound;\n\t}\n\n\tpublic static isHandled(err: any): boolean {\n\t\treturn (err instanceof RemoteAuthorityResolverError) && err.isHandled;\n\t}\n\n\tpublic readonly _message: string | undefined;\n\tpublic readonly _code: RemoteAuthorityResolverErrorCode;\n\tpublic readonly _detail: any;\n\n\tpublic isHandled: boolean;\n\n\tconstructor(message?: string, code: RemoteAuthorityResolverErrorCode = RemoteAuthorityResolverErrorCode.Unknown, detail?: any) {\n\t\tsuper(message);\n\n\t\tthis._message = message;\n\t\tthis._code = code;\n\t\tthis._detail = detail;\n\n\t\tthis.isHandled = (code === RemoteAuthorityResolverErrorCode.NotAvailable) && detail === true;\n\n\t\t// workaround when extending builtin objects and when compiling to ES5, see:\n\t\t// https://github.com/microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\n\t\tif (typeof (<any>Object).setPrototypeOf === 'function') {\n\t\t\t(<any>Object).setPrototypeOf(this, RemoteAuthorityResolverError.prototype);\n\t\t}\n\t}\n}\n\nexport interface IRemoteAuthorityResolverService {\n\n\treadonly _serviceBrand: undefined;\n\n\treadonly onDidChangeConnectionData: Event<void>;\n\n\tresolveAuthority(authority: string): Promise<ResolverResult>;\n\tgetConnectionData(authority: string): IRemoteConnectionData | null;\n\n\t_clearResolvedAuthority(authority: string): void;\n\t_setResolvedAuthority(resolvedAuthority: ResolvedAuthority, resolvedOptions?: ResolvedOptions): void;\n\t_setResolvedAuthorityError(authority: string, err: any): void;\n\t_setAuthorityConnectionToken(authority: string, connectionToken: string): void;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from 'vs/base/common/uri';\nimport { Schemas } from 'vs/base/common/network';\n\nexport function getRemoteAuthority(uri: URI): string | undefined {\n\treturn uri.scheme === Schemas.vscodeRemote ? uri.authority : undefined;\n}\n\nexport function getRemoteName(authority: string): string;\nexport function getRemoteName(authority: undefined): undefined;\nexport function getRemoteName(authority: string | undefined): string | undefined;\nexport function getRemoteName(authority: string | undefined): string | undefined {\n\tif (!authority) {\n\t\treturn undefined;\n\t}\n\tconst pos = authority.indexOf('+');\n\tif (pos < 0) {\n\t\t// e.g. localhost:8000\n\t\treturn authority;\n\t}\n\treturn authority.substr(0, pos);\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ISignService } from 'vs/platform/sign/common/sign';\n\ndeclare module vsda {\n\t// the signer is a native module that for historical reasons uses a lower case class name\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\texport class signer {\n\t\tsign(arg: any): any;\n\t}\n}\n\nexport class SignService implements ISignService {\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate vsda(): Promise<typeof vsda> {\n\t\treturn new Promise((resolve, reject) => require(['vsda'], resolve, reject));\n\t}\n\n\tasync sign(value: string): Promise<string> {\n\t\ttry {\n\t\t\tconst vsda = await this.vsda();\n\t\t\tconst signer = new vsda.signer();\n\t\t\tif (signer) {\n\t\t\t\treturn signer.sign(value);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t// ignore errors silently\n\t\t}\n\t\treturn value;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n/**\n * Color scheme used by the OS and by color themes.\n */\nexport enum ColorScheme {\n\tDARK = 'dark',\n\tLIGHT = 'light',\n\tHIGH_CONTRAST = 'hc'\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { Color } from 'vs/base/common/color';\nimport { IDisposable, toDisposable, Disposable } from 'vs/base/common/lifecycle';\nimport * as platform from 'vs/platform/registry/common/platform';\nimport { ColorIdentifier } from 'vs/platform/theme/common/colorRegistry';\nimport { Event, Emitter } from 'vs/base/common/event';\nimport { IEnvironmentService } from 'vs/platform/environment/common/environment';\nimport { ColorScheme } from 'vs/platform/theme/common/theme';\nimport { Codicon, CSSIcon } from 'vs/base/common/codicons';\n\nexport const IThemeService = createDecorator<IThemeService>('themeService');\n\nexport interface ThemeColor {\n\tid: string;\n}\n\nexport namespace ThemeColor {\n\texport function isThemeColor(obj: any): obj is ThemeColor {\n\t\treturn obj && typeof obj === 'object' && typeof (<ThemeColor>obj).id === 'string';\n\t}\n}\n\nexport function themeColorFromId(id: ColorIdentifier) {\n\treturn { id };\n}\n\n// theme icon\nexport interface ThemeIcon {\n\treadonly id: string;\n\treadonly color?: ThemeColor;\n}\n\nexport namespace ThemeIcon {\n\texport function isThemeIcon(obj: any): obj is ThemeIcon {\n\t\treturn obj && typeof obj === 'object' && typeof (<ThemeIcon>obj).id === 'string' && (typeof (<ThemeIcon>obj).color === 'undefined' || ThemeColor.isThemeColor((<ThemeIcon>obj).color));\n\t}\n\n\tconst _regexFromString = /^\\$\\(([a-z.]+\\/)?([a-z-~]+)\\)$/i;\n\n\texport function fromString(str: string): ThemeIcon | undefined {\n\t\tconst match = _regexFromString.exec(str);\n\t\tif (!match) {\n\t\t\treturn undefined;\n\t\t}\n\t\tlet [, owner, name] = match;\n\t\tif (!owner || owner === 'codicon/') {\n\t\t\treturn { id: name };\n\t\t}\n\t\treturn { id: owner + name };\n\t}\n\n\texport function modify(icon: ThemeIcon, modifier: 'disabled' | 'spin' | undefined): ThemeIcon {\n\t\tlet id = icon.id;\n\t\tconst tildeIndex = id.lastIndexOf('~');\n\t\tif (tildeIndex !== -1) {\n\t\t\tid = id.substring(0, tildeIndex);\n\t\t}\n\t\tif (modifier) {\n\t\t\tid = `${id}~${modifier}`;\n\t\t}\n\t\treturn { id };\n\t}\n\n\texport function isEqual(ti1: ThemeIcon, ti2: ThemeIcon): boolean {\n\t\treturn ti1.id === ti2.id && ti1.color?.id === ti2.color?.id;\n\t}\n\n\texport const asClassNameArray: (icon: ThemeIcon) => string[] = CSSIcon.asClassNameArray;\n\texport const asClassName: (icon: ThemeIcon) => string = CSSIcon.asClassName;\n\texport const asCSSSelector: (icon: ThemeIcon) => string = CSSIcon.asCSSSelector;\n}\n\nexport const FileThemeIcon = Codicon.file;\nexport const FolderThemeIcon = Codicon.folder;\n\nexport function getThemeTypeSelector(type: ColorScheme): string {\n\tswitch (type) {\n\t\tcase ColorScheme.DARK: return 'vs-dark';\n\t\tcase ColorScheme.HIGH_CONTRAST: return 'hc-black';\n\t\tdefault: return 'vs';\n\t}\n}\n\nexport interface ITokenStyle {\n\treadonly foreground?: number;\n\treadonly bold?: boolean;\n\treadonly underline?: boolean;\n\treadonly italic?: boolean;\n}\n\nexport interface IColorTheme {\n\n\treadonly type: ColorScheme;\n\n\treadonly label: string;\n\n\t/**\n\t * Resolves the color of the given color identifier. If the theme does not\n\t * specify the color, the default color is returned unless <code>useDefault</code> is set to false.\n\t * @param color the id of the color\n\t * @param useDefault specifies if the default color should be used. If not set, the default is used.\n\t */\n\tgetColor(color: ColorIdentifier, useDefault?: boolean): Color | undefined;\n\n\t/**\n\t * Returns whether the theme defines a value for the color. If not, that means the\n\t * default color will be used.\n\t */\n\tdefines(color: ColorIdentifier): boolean;\n\n\t/**\n\t * Returns the token style for a given classification. The result uses the <code>MetadataConsts</code> format\n\t */\n\tgetTokenStyleMetadata(type: string, modifiers: string[], modelLanguage: string): ITokenStyle | undefined;\n\n\t/**\n\t * List of all colors used with tokens. <code>getTokenStyleMetadata</code> references the colors by index into this list.\n\t */\n\treadonly tokenColorMap: string[];\n\n\t/**\n\t * Defines whether semantic highlighting should be enabled for the theme.\n\t */\n\treadonly semanticHighlighting: boolean;\n}\n\nexport interface IFileIconTheme {\n\treadonly hasFileIcons: boolean;\n\treadonly hasFolderIcons: boolean;\n\treadonly hidesExplorerArrows: boolean;\n}\n\nexport interface ICssStyleCollector {\n\taddRule(rule: string): void;\n}\n\nexport interface IThemingParticipant {\n\t(theme: IColorTheme, collector: ICssStyleCollector, environment: IEnvironmentService): void;\n}\n\nexport interface IThemeService {\n\treadonly _serviceBrand: undefined;\n\n\tgetColorTheme(): IColorTheme;\n\n\treadonly onDidColorThemeChange: Event<IColorTheme>;\n\n\tgetFileIconTheme(): IFileIconTheme;\n\n\treadonly onDidFileIconThemeChange: Event<IFileIconTheme>;\n\n}\n\n// static theming participant\nexport const Extensions = {\n\tThemingContribution: 'base.contributions.theming'\n};\n\nexport interface IThemingRegistry {\n\n\t/**\n\t * Register a theming participant that is invoked on every theme change.\n\t */\n\tonColorThemeChange(participant: IThemingParticipant): IDisposable;\n\n\tgetThemingParticipants(): IThemingParticipant[];\n\n\treadonly onThemingParticipantAdded: Event<IThemingParticipant>;\n}\n\nclass ThemingRegistry implements IThemingRegistry {\n\tprivate themingParticipants: IThemingParticipant[] = [];\n\tprivate readonly onThemingParticipantAddedEmitter: Emitter<IThemingParticipant>;\n\n\tconstructor() {\n\t\tthis.themingParticipants = [];\n\t\tthis.onThemingParticipantAddedEmitter = new Emitter<IThemingParticipant>();\n\t}\n\n\tpublic onColorThemeChange(participant: IThemingParticipant): IDisposable {\n\t\tthis.themingParticipants.push(participant);\n\t\tthis.onThemingParticipantAddedEmitter.fire(participant);\n\t\treturn toDisposable(() => {\n\t\t\tconst idx = this.themingParticipants.indexOf(participant);\n\t\t\tthis.themingParticipants.splice(idx, 1);\n\t\t});\n\t}\n\n\tpublic get onThemingParticipantAdded(): Event<IThemingParticipant> {\n\t\treturn this.onThemingParticipantAddedEmitter.event;\n\t}\n\n\tpublic getThemingParticipants(): IThemingParticipant[] {\n\t\treturn this.themingParticipants;\n\t}\n}\n\nlet themingRegistry = new ThemingRegistry();\nplatform.Registry.add(Extensions.ThemingContribution, themingRegistry);\n\nexport function registerThemingParticipant(participant: IThemingParticipant): IDisposable {\n\treturn themingRegistry.onColorThemeChange(participant);\n}\n\n/**\n * Utility base class for all themable components.\n */\nexport class Themable extends Disposable {\n\tprotected theme: IColorTheme;\n\n\tconstructor(\n\t\tprotected themeService: IThemeService\n\t) {\n\t\tsuper();\n\n\t\tthis.theme = themeService.getColorTheme();\n\n\t\t// Hook up to theme changes\n\t\tthis._register(this.themeService.onDidColorThemeChange(theme => this.onThemeChange(theme)));\n\t}\n\n\tprotected onThemeChange(theme: IColorTheme): void {\n\t\tthis.theme = theme;\n\n\t\tthis.updateStyles();\n\t}\n\n\tprotected updateStyles(): void {\n\t\t// Subclasses to override\n\t}\n\n\tprotected getColor(id: string, modify?: (color: Color, theme: IColorTheme) => Color): string | null {\n\t\tlet color = this.theme.getColor(id);\n\n\t\tif (color && modify) {\n\t\t\tcolor = modify(color, this.theme);\n\t\t}\n\n\t\treturn color ? color.toString() : null;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as platform from 'vs/platform/registry/common/platform';\nimport { IJSONSchema, IJSONSchemaMap } from 'vs/base/common/jsonSchema';\nimport { ThemeIcon } from 'vs/platform/theme/common/themeService';\nimport { Event, Emitter } from 'vs/base/common/event';\nimport { localize } from 'vs/nls';\nimport { Extensions as JSONExtensions, IJSONContributionRegistry } from 'vs/platform/jsonschemas/common/jsonContributionRegistry';\nimport { RunOnceScheduler } from 'vs/base/common/async';\nimport * as Codicons from 'vs/base/common/codicons';\n\n//  ------ API types\n\n\n// color registry\nexport const Extensions = {\n\tIconContribution: 'base.contributions.icons'\n};\n\nexport type IconDefaults = ThemeIcon | IconDefinition;\n\nexport interface IconDefinition {\n\tfontId?: string;\n\tcharacter: string;\n}\n\nexport interface IconContribution {\n\tid: string;\n\tdescription: string | undefined;\n\tdeprecationMessage?: string;\n\tdefaults: IconDefaults;\n}\n\nexport interface IIconRegistry {\n\n\treadonly onDidChange: Event<void>;\n\n\t/**\n\t * Register a icon to the registry.\n\t * @param id The icon id\n\t * @param defaults The default values\n\t * @description the description\n\t */\n\tregisterIcon(id: string, defaults: IconDefaults, description?: string): ThemeIcon;\n\n\t/**\n\t * Register a icon to the registry.\n\t */\n\tderegisterIcon(id: string): void;\n\n\t/**\n\t * Get all icon contributions\n\t */\n\tgetIcons(): IconContribution[];\n\n\t/**\n\t * Get the icon for the given id\n\t */\n\tgetIcon(id: string): IconContribution | undefined;\n\n\t/**\n\t * JSON schema for an object to assign icon values to one of the color contributions.\n\t */\n\tgetIconSchema(): IJSONSchema;\n\n\t/**\n\t * JSON schema to for a reference to a icon contribution.\n\t */\n\tgetIconReferenceSchema(): IJSONSchema;\n\n\t/**\n\t * The CSS for all icons\n\t */\n\tgetCSS(): string;\n\n}\n\nclass IconRegistry implements IIconRegistry {\n\n\tprivate readonly _onDidChange = new Emitter<void>();\n\treadonly onDidChange: Event<void> = this._onDidChange.event;\n\n\tprivate iconsById: { [key: string]: IconContribution };\n\tprivate iconSchema: IJSONSchema & { properties: IJSONSchemaMap } = {\n\t\tdefinitions: {\n\t\t\ticons: {\n\t\t\t\ttype: 'object',\n\t\t\t\tproperties: {\n\t\t\t\t\tfontId: { type: 'string', description: localize('iconDefintion.fontId', 'The id of the font to use. If not set, the font that is defined first is used.') },\n\t\t\t\t\tfontCharacter: { type: 'string', description: localize('iconDefintion.fontCharacter', 'The font character associated with the icon definition.') }\n\t\t\t\t},\n\t\t\t\tadditionalProperties: false,\n\t\t\t\tdefaultSnippets: [{ body: { fontCharacter: '\\\\\\\\e030' } }]\n\t\t\t}\n\t\t},\n\t\ttype: 'object',\n\t\tproperties: {}\n\t};\n\tprivate iconReferenceSchema: IJSONSchema & { enum: string[], enumDescriptions: string[] } = { type: 'string', enum: [], enumDescriptions: [] };\n\n\tconstructor() {\n\t\tthis.iconsById = {};\n\t}\n\n\tpublic registerIcon(id: string, defaults: IconDefaults, description?: string, deprecationMessage?: string): ThemeIcon {\n\t\tconst existing = this.iconsById[id];\n\t\tif (existing) {\n\t\t\tif (description && !existing.description) {\n\t\t\t\texisting.description = description;\n\t\t\t\tthis.iconSchema.properties[id].markdownDescription = `${description} $(${id})`;\n\t\t\t\tconst enumIndex = this.iconReferenceSchema.enum.indexOf(id);\n\t\t\t\tif (enumIndex !== -1) {\n\t\t\t\t\tthis.iconReferenceSchema.enumDescriptions[enumIndex] = description;\n\t\t\t\t}\n\t\t\t\tthis._onDidChange.fire();\n\t\t\t}\n\t\t\treturn existing;\n\t\t}\n\t\tlet iconContribution: IconContribution = { id, description, defaults, deprecationMessage };\n\t\tthis.iconsById[id] = iconContribution;\n\t\tlet propertySchema: IJSONSchema = { $ref: '#/definitions/icons' };\n\t\tif (deprecationMessage) {\n\t\t\tpropertySchema.deprecationMessage = deprecationMessage;\n\t\t}\n\t\tif (description) {\n\t\t\tpropertySchema.markdownDescription = `${description}: $(${id})`;\n\t\t}\n\t\tthis.iconSchema.properties[id] = propertySchema;\n\t\tthis.iconReferenceSchema.enum.push(id);\n\t\tthis.iconReferenceSchema.enumDescriptions.push(description || '');\n\n\t\tthis._onDidChange.fire();\n\t\treturn { id };\n\t}\n\n\n\tpublic deregisterIcon(id: string): void {\n\t\tdelete this.iconsById[id];\n\t\tdelete this.iconSchema.properties[id];\n\t\tconst index = this.iconReferenceSchema.enum.indexOf(id);\n\t\tif (index !== -1) {\n\t\t\tthis.iconReferenceSchema.enum.splice(index, 1);\n\t\t\tthis.iconReferenceSchema.enumDescriptions.splice(index, 1);\n\t\t}\n\t\tthis._onDidChange.fire();\n\t}\n\n\tpublic getIcons(): IconContribution[] {\n\t\treturn Object.keys(this.iconsById).map(id => this.iconsById[id]);\n\t}\n\n\tpublic getIcon(id: string): IconContribution | undefined {\n\t\treturn this.iconsById[id];\n\t}\n\n\tpublic getIconSchema(): IJSONSchema {\n\t\treturn this.iconSchema;\n\t}\n\n\tpublic getIconReferenceSchema(): IJSONSchema {\n\t\treturn this.iconReferenceSchema;\n\t}\n\n\tpublic getCSS() {\n\t\tconst rules = [];\n\t\tfor (let id in this.iconsById) {\n\t\t\tconst rule = this.formatRule(id);\n\t\t\tif (rule) {\n\t\t\t\trules.push(rule);\n\t\t\t}\n\t\t}\n\t\treturn rules.join('\\n');\n\t}\n\n\tprivate formatRule(id: string): string | undefined {\n\t\tlet definition = this.iconsById[id].defaults;\n\t\twhile (ThemeIcon.isThemeIcon(definition)) {\n\t\t\tconst c = this.iconsById[definition.id];\n\t\t\tif (!c) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tdefinition = c.defaults;\n\t\t}\n\t\treturn `.codicon-${id}:before { content: '${definition.character}'; }`;\n\t}\n\n\tpublic toString() {\n\t\tconst sorter = (i1: IconContribution, i2: IconContribution) => {\n\t\t\treturn i1.id.localeCompare(i2.id);\n\t\t};\n\t\tconst classNames = (i: IconContribution) => {\n\t\t\twhile (ThemeIcon.isThemeIcon(i.defaults)) {\n\t\t\t\ti = this.iconsById[i.defaults.id];\n\t\t\t}\n\t\t\treturn `codicon codicon-${i ? i.id : ''}`;\n\t\t};\n\n\t\tlet reference = [];\n\n\t\treference.push(`| preview     | identifier                        | default codicon id                | description`);\n\t\treference.push(`| ----------- | --------------------------------- | --------------------------------- | --------------------------------- |`);\n\t\tconst contributions = Object.keys(this.iconsById).map(key => this.iconsById[key]);\n\n\t\tfor (const i of contributions.filter(i => !!i.description).sort(sorter)) {\n\t\t\treference.push(`|<i class=\"${classNames(i)}\"></i>|${i.id}|${ThemeIcon.isThemeIcon(i.defaults) ? i.defaults.id : i.id}|${i.description || ''}|`);\n\t\t}\n\n\t\treference.push(`| preview     | identifier                        `);\n\t\treference.push(`| ----------- | --------------------------------- |`);\n\n\t\tfor (const i of contributions.filter(i => !ThemeIcon.isThemeIcon(i.defaults)).sort(sorter)) {\n\t\t\treference.push(`|<i class=\"${classNames(i)}\"></i>|${i.id}|`);\n\n\t\t}\n\n\t\treturn reference.join('\\n');\n\t}\n\n}\n\nconst iconRegistry = new IconRegistry();\nplatform.Registry.add(Extensions.IconContribution, iconRegistry);\n\nexport function registerIcon(id: string, defaults: IconDefaults, description: string, deprecationMessage?: string): ThemeIcon {\n\treturn iconRegistry.registerIcon(id, defaults, description, deprecationMessage);\n}\n\nexport function getIconRegistry(): IIconRegistry {\n\treturn iconRegistry;\n}\n\nfunction initialize() {\n\tfor (const icon of Codicons.iconRegistry.all) {\n\t\ticonRegistry.registerIcon(icon.id, icon.definition, icon.description);\n\t}\n\tCodicons.iconRegistry.onDidRegister(icon => iconRegistry.registerIcon(icon.id, icon.definition, icon.description));\n}\ninitialize();\n\nexport const iconsSchemaId = 'vscode://schemas/icons';\n\nlet schemaRegistry = platform.Registry.as<IJSONContributionRegistry>(JSONExtensions.JSONContribution);\nschemaRegistry.registerSchema(iconsSchemaId, iconRegistry.getIconSchema());\n\nconst delayer = new RunOnceScheduler(() => schemaRegistry.notifySchemaChanged(iconsSchemaId), 200);\niconRegistry.onDidChange(() => {\n\tif (!delayer.isScheduled()) {\n\t\tdelayer.schedule();\n\t}\n});\n\n\n//setTimeout(_ => console.log(iconRegistry.toString()), 5000);\n\n\n// common icons\n\nexport const widgetClose = registerIcon('widget-close', Codicons.Codicon.close, localize('widgetClose', 'Icon for the close action in widgets.'));\n\nexport const gotoPreviousLocation = registerIcon('goto-previous-location', Codicons.Codicon.arrowUp, localize('previousChangeIcon', 'Icon for goto previous editor location.'));\nexport const gotoNextLocation = registerIcon('goto-next-location', Codicons.Codicon.arrowDown, localize('nextChangeIcon', 'Icon for goto next editor location.'));\n\nexport const syncing = ThemeIcon.modify(Codicons.Codicon.sync, 'spin');\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from 'vs/base/common/uri';\nimport { joinPath, basenameOrAuthority } from 'vs/base/common/resources';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { TernarySearchTree } from 'vs/base/common/map';\nimport { Event } from 'vs/base/common/event';\nimport { IWorkspaceIdentifier, IStoredWorkspaceFolder, ISingleFolderWorkspaceIdentifier } from 'vs/platform/workspaces/common/workspaces';\nimport { IWorkspaceFolderProvider } from 'vs/base/common/labels';\n\nexport const IWorkspaceContextService = createDecorator<IWorkspaceContextService>('contextService');\n\nexport interface IWorkspaceContextService extends IWorkspaceFolderProvider {\n\n\treadonly _serviceBrand: undefined;\n\n\t/**\n\t * An event which fires on workbench state changes.\n\t */\n\treadonly onDidChangeWorkbenchState: Event<WorkbenchState>;\n\n\t/**\n\t * An event which fires on workspace name changes.\n\t */\n\treadonly onDidChangeWorkspaceName: Event<void>;\n\n\t/**\n\t * An event which fires on workspace folders change.\n\t */\n\treadonly onDidChangeWorkspaceFolders: Event<IWorkspaceFoldersChangeEvent>;\n\n\t/**\n\t * Provides access to the complete workspace object.\n\t */\n\tgetCompleteWorkspace(): Promise<IWorkspace>;\n\n\t/**\n\t * Provides access to the workspace object the window is running with.\n\t * Use `getCompleteWorkspace` to get complete workspace object.\n\t */\n\tgetWorkspace(): IWorkspace;\n\n\t/**\n\t * Return the state of the workbench.\n\t *\n\t * WorkbenchState.EMPTY - if the workbench was opened with empty window or file\n\t * WorkbenchState.FOLDER - if the workbench was opened with a folder\n\t * WorkbenchState.WORKSPACE - if the workbench was opened with a workspace\n\t */\n\tgetWorkbenchState(): WorkbenchState;\n\n\t/**\n\t * Returns the folder for the given resource from the workspace.\n\t * Can be null if there is no workspace or the resource is not inside the workspace.\n\t */\n\tgetWorkspaceFolder(resource: URI): IWorkspaceFolder | null;\n\n\t/**\n\t * Return `true` if the current workspace has the given identifier or root URI otherwise `false`.\n\t */\n\tisCurrentWorkspace(workspaceIdOrFolder: IWorkspaceIdentifier | ISingleFolderWorkspaceIdentifier | URI): boolean;\n\n\t/**\n\t * Returns if the provided resource is inside the workspace or not.\n\t */\n\tisInsideWorkspace(resource: URI): boolean;\n}\n\nexport const enum WorkbenchState {\n\tEMPTY = 1,\n\tFOLDER,\n\tWORKSPACE\n}\n\nexport interface IWorkspaceFoldersChangeEvent {\n\tadded: IWorkspaceFolder[];\n\tremoved: IWorkspaceFolder[];\n\tchanged: IWorkspaceFolder[];\n}\n\nexport interface IWorkspace {\n\n\t/**\n\t * the unique identifier of the workspace.\n\t */\n\treadonly id: string;\n\n\t/**\n\t * Folders in the workspace.\n\t */\n\treadonly folders: IWorkspaceFolder[];\n\n\t/**\n\t * the location of the workspace configuration\n\t */\n\treadonly configuration?: URI | null;\n}\n\nexport function isWorkspace(thing: unknown): thing is IWorkspace {\n\tconst candidate = thing as IWorkspace | undefined;\n\n\treturn !!(candidate && typeof candidate === 'object'\n\t\t&& typeof candidate.id === 'string'\n\t\t&& Array.isArray(candidate.folders));\n}\n\nexport interface IWorkspaceFolderData {\n\n\t/**\n\t * The associated URI for this workspace folder.\n\t */\n\treadonly uri: URI;\n\n\t/**\n\t * The name of this workspace folder. Defaults to\n\t * the basename of its [uri-path](#Uri.path)\n\t */\n\treadonly name: string;\n\n\t/**\n\t * The ordinal number of this workspace folder.\n\t */\n\treadonly index: number;\n}\n\nexport interface IWorkspaceFolder extends IWorkspaceFolderData {\n\n\t/**\n\t * Given workspace folder relative path, returns the resource with the absolute path.\n\t */\n\ttoResource: (relativePath: string) => URI;\n}\n\nexport function isWorkspaceFolder(thing: unknown): thing is IWorkspaceFolder {\n\tconst candidate = thing as IWorkspaceFolder;\n\n\treturn !!(candidate && typeof candidate === 'object'\n\t\t&& URI.isUri(candidate.uri)\n\t\t&& typeof candidate.name === 'string'\n\t\t&& typeof candidate.toResource === 'function');\n}\n\nexport class Workspace implements IWorkspace {\n\n\tprivate _foldersMap: TernarySearchTree<URI, WorkspaceFolder> = TernarySearchTree.forUris<WorkspaceFolder>(this._ignorePathCasing);\n\tprivate _folders!: WorkspaceFolder[];\n\n\tconstructor(\n\t\tprivate _id: string,\n\t\tfolders: WorkspaceFolder[],\n\t\tprivate _configuration: URI | null,\n\t\tprivate _ignorePathCasing: (key: URI) => boolean,\n\t) {\n\t\tthis.folders = folders;\n\t}\n\n\tupdate(workspace: Workspace) {\n\t\tthis._id = workspace.id;\n\t\tthis._configuration = workspace.configuration;\n\t\tthis._ignorePathCasing = workspace._ignorePathCasing;\n\t\tthis.folders = workspace.folders;\n\t}\n\n\tget folders(): WorkspaceFolder[] {\n\t\treturn this._folders;\n\t}\n\n\tset folders(folders: WorkspaceFolder[]) {\n\t\tthis._folders = folders;\n\t\tthis.updateFoldersMap();\n\t}\n\n\tget id(): string {\n\t\treturn this._id;\n\t}\n\n\tget configuration(): URI | null {\n\t\treturn this._configuration;\n\t}\n\n\tset configuration(configuration: URI | null) {\n\t\tthis._configuration = configuration;\n\t}\n\n\tgetFolder(resource: URI): IWorkspaceFolder | null {\n\t\tif (!resource) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this._foldersMap.findSubstr(resource.with({\n\t\t\tscheme: resource.scheme,\n\t\t\tauthority: resource.authority,\n\t\t\tpath: resource.path\n\t\t})) || null;\n\t}\n\n\tprivate updateFoldersMap(): void {\n\t\tthis._foldersMap = TernarySearchTree.forUris<WorkspaceFolder>(this._ignorePathCasing);\n\t\tfor (const folder of this.folders) {\n\t\t\tthis._foldersMap.set(folder.uri, folder);\n\t\t}\n\t}\n\n\ttoJSON(): IWorkspace {\n\t\treturn { id: this.id, folders: this.folders, configuration: this.configuration };\n\t}\n}\n\nexport class WorkspaceFolder implements IWorkspaceFolder {\n\n\treadonly uri: URI;\n\tname: string;\n\tindex: number;\n\n\tconstructor(data: IWorkspaceFolderData,\n\t\treadonly raw?: IStoredWorkspaceFolder) {\n\t\tthis.uri = data.uri;\n\t\tthis.index = data.index;\n\t\tthis.name = data.name;\n\t}\n\n\ttoResource(relativePath: string): URI {\n\t\treturn joinPath(this.uri, relativePath);\n\t}\n\n\ttoJSON(): IWorkspaceFolderData {\n\t\treturn { uri: this.uri, name: this.name, index: this.index };\n\t}\n}\n\nexport function toWorkspaceFolder(resource: URI): WorkspaceFolder {\n\treturn new WorkspaceFolder({ uri: resource, index: 0, name: basenameOrAuthority(resource) }, { uri: resource.toString() });\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { localize } from 'vs/nls';\nimport { IWorkspaceFolder, IWorkspace, WorkspaceFolder } from 'vs/platform/workspace/common/workspace';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { isWindows, isLinux, isMacintosh } from 'vs/base/common/platform';\nimport { extname, isAbsolute } from 'vs/base/common/path';\nimport { extname as resourceExtname, extUriBiasedIgnorePathCase, IExtUri } from 'vs/base/common/resources';\nimport * as jsonEdit from 'vs/base/common/jsonEdit';\nimport * as json from 'vs/base/common/json';\nimport { Schemas } from 'vs/base/common/network';\nimport { normalizeDriveLetter } from 'vs/base/common/labels';\nimport { toSlashes } from 'vs/base/common/extpath';\nimport { FormattingOptions } from 'vs/base/common/jsonFormatter';\nimport { getRemoteAuthority } from 'vs/platform/remote/common/remoteHosts';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { Event } from 'vs/base/common/event';\nimport { IEnvironmentService } from 'vs/platform/environment/common/environment';\n\nexport const WORKSPACE_EXTENSION = 'code-workspace';\nconst WORKSPACE_SUFFIX = `.${WORKSPACE_EXTENSION}`;\nexport const WORKSPACE_FILTER = [{ name: localize('codeWorkspace', \"Code Workspace\"), extensions: [WORKSPACE_EXTENSION] }];\nexport const UNTITLED_WORKSPACE_NAME = 'workspace.json';\n\nexport function hasWorkspaceFileExtension(path: string | URI) {\n\tconst ext = (typeof path === 'string') ? extname(path) : resourceExtname(path);\n\n\treturn ext === WORKSPACE_SUFFIX;\n}\n\nexport const IWorkspacesService = createDecorator<IWorkspacesService>('workspacesService');\n\nexport interface IWorkspacesService {\n\n\treadonly _serviceBrand: undefined;\n\n\t// Workspaces Management\n\tenterWorkspace(path: URI): Promise<IEnterWorkspaceResult | null>;\n\tcreateUntitledWorkspace(folders?: IWorkspaceFolderCreationData[], remoteAuthority?: string): Promise<IWorkspaceIdentifier>;\n\tdeleteUntitledWorkspace(workspace: IWorkspaceIdentifier): Promise<void>;\n\tgetWorkspaceIdentifier(workspacePath: URI): Promise<IWorkspaceIdentifier>;\n\n\t// Workspaces History\n\treadonly onRecentlyOpenedChange: Event<void>;\n\taddRecentlyOpened(recents: IRecent[]): Promise<void>;\n\tremoveRecentlyOpened(workspaces: URI[]): Promise<void>;\n\tclearRecentlyOpened(): Promise<void>;\n\tgetRecentlyOpened(): Promise<IRecentlyOpened>;\n\n\t// Dirty Workspaces\n\tgetDirtyWorkspaces(): Promise<Array<IWorkspaceIdentifier | URI>>;\n}\n\n//#region Workspaces Recently Opened\n\nexport interface IRecentlyOpened {\n\tworkspaces: Array<IRecentWorkspace | IRecentFolder>;\n\tfiles: IRecentFile[];\n}\n\nexport type IRecent = IRecentWorkspace | IRecentFolder | IRecentFile;\n\nexport interface IRecentWorkspace {\n\tworkspace: IWorkspaceIdentifier;\n\tlabel?: string;\n}\n\nexport interface IRecentFolder {\n\tfolderUri: URI;\n\tlabel?: string;\n}\n\nexport interface IRecentFile {\n\tfileUri: URI;\n\tlabel?: string;\n}\n\nexport function isRecentWorkspace(curr: IRecent): curr is IRecentWorkspace {\n\treturn curr.hasOwnProperty('workspace');\n}\n\nexport function isRecentFolder(curr: IRecent): curr is IRecentFolder {\n\treturn curr.hasOwnProperty('folderUri');\n}\n\nexport function isRecentFile(curr: IRecent): curr is IRecentFile {\n\treturn curr.hasOwnProperty('fileUri');\n}\n\n//#endregion\n\n//#region Identifiers / Payload\n\nexport interface IBaseWorkspaceIdentifier {\n\n\t/**\n\t * Every workspace (multi-root, single folder or empty)\n\t * has a unique identifier. It is not possible to open\n\t * a workspace with the same `id` in multiple windows\n\t */\n\tid: string;\n}\n\n/**\n * A single folder workspace identifier is a path to a folder + id.\n */\nexport interface ISingleFolderWorkspaceIdentifier extends IBaseWorkspaceIdentifier {\n\n\t/**\n\t * Folder path as `URI`.\n\t */\n\turi: URI;\n}\n\nexport function isSingleFolderWorkspaceIdentifier(obj: unknown): obj is ISingleFolderWorkspaceIdentifier {\n\tconst singleFolderIdentifier = obj as ISingleFolderWorkspaceIdentifier | undefined;\n\n\treturn typeof singleFolderIdentifier?.id === 'string' && URI.isUri(singleFolderIdentifier.uri);\n}\n\n/**\n * A multi-root workspace identifier is a path to a workspace file + id.\n */\nexport interface IWorkspaceIdentifier extends IBaseWorkspaceIdentifier {\n\n\t/**\n\t * Workspace config file path as `URI`.\n\t */\n\tconfigPath: URI;\n}\n\nexport function toWorkspaceIdentifier(workspace: IWorkspace): IWorkspaceIdentifier | ISingleFolderWorkspaceIdentifier | undefined {\n\n\t// Multi root\n\tif (workspace.configuration) {\n\t\treturn {\n\t\t\tid: workspace.id,\n\t\t\tconfigPath: workspace.configuration\n\t\t};\n\t}\n\n\t// Single folder\n\tif (workspace.folders.length === 1) {\n\t\treturn {\n\t\t\tid: workspace.id,\n\t\t\turi: workspace.folders[0].uri\n\t\t};\n\t}\n\n\t// Empty workspace\n\treturn undefined;\n}\n\nexport function isWorkspaceIdentifier(obj: unknown): obj is IWorkspaceIdentifier {\n\tconst workspaceIdentifier = obj as IWorkspaceIdentifier | undefined;\n\n\treturn typeof workspaceIdentifier?.id === 'string' && URI.isUri(workspaceIdentifier.configPath);\n}\n\nexport function reviveIdentifier(identifier: { id: string, uri?: UriComponents, configPath?: UriComponents } | undefined): IWorkspaceIdentifier | ISingleFolderWorkspaceIdentifier | undefined {\n\tif (identifier?.uri) {\n\t\treturn { id: identifier.id, uri: URI.revive(identifier.uri) };\n\t}\n\n\tif (identifier?.configPath) {\n\t\treturn { id: identifier.id, configPath: URI.revive(identifier.configPath) };\n\t}\n\n\treturn undefined;\n}\n\nexport function isUntitledWorkspace(path: URI, environmentService: IEnvironmentService): boolean {\n\treturn extUriBiasedIgnorePathCase.isEqualOrParent(path, environmentService.untitledWorkspacesHome);\n}\n\nexport interface IEmptyWorkspaceInitializationPayload extends IBaseWorkspaceIdentifier { }\n\nexport type IWorkspaceInitializationPayload = IWorkspaceIdentifier | ISingleFolderWorkspaceIdentifier | IEmptyWorkspaceInitializationPayload;\n\n//#endregion\n\n//#region Workspace File Utilities\n\nexport function isStoredWorkspaceFolder(obj: unknown): obj is IStoredWorkspaceFolder {\n\treturn isRawFileWorkspaceFolder(obj) || isRawUriWorkspaceFolder(obj);\n}\n\nexport function isRawFileWorkspaceFolder(obj: unknown): obj is IRawFileWorkspaceFolder {\n\tconst candidate = obj as IRawFileWorkspaceFolder | undefined;\n\n\treturn typeof candidate?.path === 'string' && (!candidate.name || typeof candidate.name === 'string');\n}\n\nexport function isRawUriWorkspaceFolder(obj: unknown): obj is IRawUriWorkspaceFolder {\n\tconst candidate = obj as IRawUriWorkspaceFolder | undefined;\n\n\treturn typeof candidate?.uri === 'string' && (!candidate.name || typeof candidate.name === 'string');\n}\n\nexport interface IRawFileWorkspaceFolder {\n\tpath: string;\n\tname?: string;\n}\n\nexport interface IRawUriWorkspaceFolder {\n\turi: string;\n\tname?: string;\n}\n\nexport type IStoredWorkspaceFolder = IRawFileWorkspaceFolder | IRawUriWorkspaceFolder;\n\nexport interface IResolvedWorkspace extends IWorkspaceIdentifier {\n\tfolders: IWorkspaceFolder[];\n\tremoteAuthority?: string;\n}\n\nexport interface IStoredWorkspace {\n\tfolders: IStoredWorkspaceFolder[];\n\tremoteAuthority?: string;\n}\n\nexport interface IWorkspaceFolderCreationData {\n\turi: URI;\n\tname?: string;\n}\n\nexport interface IUntitledWorkspaceInfo {\n\tworkspace: IWorkspaceIdentifier;\n\tremoteAuthority?: string;\n}\n\nexport interface IEnterWorkspaceResult {\n\tworkspace: IWorkspaceIdentifier;\n\tbackupPath?: string;\n}\n\n/**\n * Given a folder URI and the workspace config folder, computes the IStoredWorkspaceFolder using\n* a relative or absolute path or a uri.\n * Undefined is returned if the folderURI and the targetConfigFolderURI don't have the same schema or authority\n *\n * @param folderURI a workspace folder\n * @param forceAbsolute if set, keep the path absolute\n * @param folderName a workspace name\n * @param targetConfigFolderURI the folder where the workspace is living in\n * @param useSlashForPath if set, use forward slashes for file paths on windows\n */\nexport function getStoredWorkspaceFolder(folderURI: URI, forceAbsolute: boolean, folderName: string | undefined, targetConfigFolderURI: URI, useSlashForPath = !isWindows, extUri: IExtUri): IStoredWorkspaceFolder {\n\tif (folderURI.scheme !== targetConfigFolderURI.scheme) {\n\t\treturn { name: folderName, uri: folderURI.toString(true) };\n\t}\n\n\tlet folderPath = !forceAbsolute ? extUri.relativePath(targetConfigFolderURI, folderURI) : undefined;\n\tif (folderPath !== undefined) {\n\t\tif (folderPath.length === 0) {\n\t\t\tfolderPath = '.';\n\t\t} else if (isWindows && folderURI.scheme === Schemas.file && !useSlashForPath) {\n\t\t\t// Windows gets special treatment:\n\t\t\t// - use backslahes unless slash is used by other existing folders\n\t\t\tfolderPath = folderPath.replace(/\\//g, '\\\\');\n\t\t}\n\t} else {\n\n\t\t// use absolute path\n\t\tif (folderURI.scheme === Schemas.file) {\n\t\t\tfolderPath = folderURI.fsPath;\n\t\t\tif (isWindows) {\n\t\t\t\t// Windows gets special treatment:\n\t\t\t\t// - normalize all paths to get nice casing of drive letters\n\t\t\t\t// - use backslahes unless slash is used by other existing folders\n\t\t\t\tfolderPath = normalizeDriveLetter(folderPath);\n\t\t\t\tif (useSlashForPath) {\n\t\t\t\t\tfolderPath = toSlashes(folderPath);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (!extUri.isEqualAuthority(folderURI.authority, targetConfigFolderURI.authority)) {\n\t\t\t\treturn { name: folderName, uri: folderURI.toString(true) };\n\t\t\t}\n\t\t\tfolderPath = folderURI.path;\n\t\t}\n\t}\n\n\treturn { name: folderName, path: folderPath };\n}\n\nexport function toWorkspaceFolders(configuredFolders: IStoredWorkspaceFolder[], workspaceConfigFile: URI, extUri: IExtUri): WorkspaceFolder[] {\n\tlet result: WorkspaceFolder[] = [];\n\tlet seen: Set<string> = new Set();\n\n\tconst relativeTo = extUri.dirname(workspaceConfigFile);\n\tfor (let configuredFolder of configuredFolders) {\n\t\tlet uri: URI | null = null;\n\t\tif (isRawFileWorkspaceFolder(configuredFolder)) {\n\t\t\tif (configuredFolder.path) {\n\t\t\t\turi = extUri.resolvePath(relativeTo, configuredFolder.path);\n\t\t\t}\n\t\t} else if (isRawUriWorkspaceFolder(configuredFolder)) {\n\t\t\ttry {\n\t\t\t\turi = URI.parse(configuredFolder.uri);\n\t\t\t\t// this makes sure all workspace folder are absolute\n\t\t\t\tif (uri.path[0] !== '/') {\n\t\t\t\t\turi = uri.with({ path: '/' + uri.path });\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tconsole.warn(e);\n\t\t\t\t// ignore\n\t\t\t}\n\t\t}\n\t\tif (uri) {\n\t\t\t// remove duplicates\n\t\t\tlet comparisonKey = extUri.getComparisonKey(uri);\n\t\t\tif (!seen.has(comparisonKey)) {\n\t\t\t\tseen.add(comparisonKey);\n\n\t\t\t\tconst name = configuredFolder.name || extUri.basenameOrAuthority(uri);\n\t\t\t\tresult.push(new WorkspaceFolder({ uri, name, index: result.length }, configuredFolder));\n\t\t\t}\n\t\t}\n\t}\n\n\treturn result;\n}\n\n/**\n * Rewrites the content of a workspace file to be saved at a new location.\n * Throws an exception if file is not a valid workspace file\n */\nexport function rewriteWorkspaceFileForNewLocation(rawWorkspaceContents: string, configPathURI: URI, isFromUntitledWorkspace: boolean, targetConfigPathURI: URI, extUri: IExtUri) {\n\tlet storedWorkspace = doParseStoredWorkspace(configPathURI, rawWorkspaceContents);\n\n\tconst sourceConfigFolder = extUri.dirname(configPathURI);\n\tconst targetConfigFolder = extUri.dirname(targetConfigPathURI);\n\n\tconst rewrittenFolders: IStoredWorkspaceFolder[] = [];\n\tconst slashForPath = useSlashForPath(storedWorkspace.folders);\n\n\tfor (const folder of storedWorkspace.folders) {\n\t\tconst folderURI = isRawFileWorkspaceFolder(folder) ? extUri.resolvePath(sourceConfigFolder, folder.path) : URI.parse(folder.uri);\n\t\tlet absolute;\n\t\tif (isFromUntitledWorkspace) {\n\t\t\t// if it was an untitled workspace, try to make paths relative\n\t\t\tabsolute = false;\n\t\t} else {\n\t\t\t// for existing workspaces, preserve whether a path was absolute or relative\n\t\t\tabsolute = !isRawFileWorkspaceFolder(folder) || isAbsolute(folder.path);\n\t\t}\n\t\trewrittenFolders.push(getStoredWorkspaceFolder(folderURI, absolute, folder.name, targetConfigFolder, slashForPath, extUri));\n\t}\n\n\t// Preserve as much of the existing workspace as possible by using jsonEdit\n\t// and only changing the folders portion.\n\tconst formattingOptions: FormattingOptions = { insertSpaces: false, tabSize: 4, eol: (isLinux || isMacintosh) ? '\\n' : '\\r\\n' };\n\tconst edits = jsonEdit.setProperty(rawWorkspaceContents, ['folders'], rewrittenFolders, formattingOptions);\n\tlet newContent = jsonEdit.applyEdits(rawWorkspaceContents, edits);\n\n\tif (storedWorkspace.remoteAuthority === getRemoteAuthority(targetConfigPathURI)) {\n\t\t// unsaved remote workspaces have the remoteAuthority set. Remove it when no longer nexessary.\n\t\tnewContent = jsonEdit.applyEdits(newContent, jsonEdit.removeProperty(newContent, ['remoteAuthority'], formattingOptions));\n\t}\n\n\treturn newContent;\n}\n\nfunction doParseStoredWorkspace(path: URI, contents: string): IStoredWorkspace {\n\n\t// Parse workspace file\n\tlet storedWorkspace: IStoredWorkspace = json.parse(contents); // use fault tolerant parser\n\n\t// Filter out folders which do not have a path or uri set\n\tif (storedWorkspace && Array.isArray(storedWorkspace.folders)) {\n\t\tstoredWorkspace.folders = storedWorkspace.folders.filter(folder => isStoredWorkspaceFolder(folder));\n\t} else {\n\t\tthrow new Error(`${path} looks like an invalid workspace file.`);\n\t}\n\n\treturn storedWorkspace;\n}\n\nexport function useSlashForPath(storedFolders: IStoredWorkspaceFolder[]): boolean {\n\tif (isWindows) {\n\t\treturn storedFolders.some(folder => isRawFileWorkspaceFolder(folder) && folder.path.indexOf('/') >= 0);\n\t}\n\n\treturn true;\n}\n\n//#endregion\n\n//#region Workspace Storage\n\ninterface ISerializedRecentlyOpened {\n\tworkspaces3: Array<ISerializedWorkspace | string>; // workspace or URI.toString() // added in 1.32\n\tworkspaceLabels?: Array<string | null>; // added in 1.33\n\tfiles2: string[]; // files as URI.toString() // added in 1.32\n\tfileLabels?: Array<string | null>; // added in 1.33\n}\n\ninterface ISerializedWorkspace { id: string; configURIPath: string; }\n\nexport type RecentlyOpenedStorageData = object;\n\nexport function restoreRecentlyOpened(data: RecentlyOpenedStorageData | undefined, logService: ILogService): IRecentlyOpened {\n\tconst result: IRecentlyOpened = { workspaces: [], files: [] };\n\tif (data) {\n\t\tconst restoreGracefully = function <T>(entries: T[], func: (entry: T, index: number) => void) {\n\t\t\tfor (let i = 0; i < entries.length; i++) {\n\t\t\t\ttry {\n\t\t\t\t\tfunc(entries[i], i);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tlogService.warn(`Error restoring recent entry ${JSON.stringify(entries[i])}: ${e.toString()}. Skip entry.`);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tconst storedRecents = data as ISerializedRecentlyOpened;\n\t\tif (Array.isArray(storedRecents.workspaces3)) {\n\t\t\trestoreGracefully(storedRecents.workspaces3, (workspace, i) => {\n\t\t\t\tconst label: string | undefined = (Array.isArray(storedRecents.workspaceLabels) && storedRecents.workspaceLabels[i]) || undefined;\n\t\t\t\tif (typeof workspace === 'object' && typeof workspace.id === 'string' && typeof workspace.configURIPath === 'string') {\n\t\t\t\t\tresult.workspaces.push({ label, workspace: { id: workspace.id, configPath: URI.parse(workspace.configURIPath) } });\n\t\t\t\t} else if (typeof workspace === 'string') {\n\t\t\t\t\tresult.workspaces.push({ label, folderUri: URI.parse(workspace) });\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tif (Array.isArray(storedRecents.files2)) {\n\t\t\trestoreGracefully(storedRecents.files2, (file, i) => {\n\t\t\t\tconst label: string | undefined = (Array.isArray(storedRecents.fileLabels) && storedRecents.fileLabels[i]) || undefined;\n\t\t\t\tif (typeof file === 'string') {\n\t\t\t\t\tresult.files.push({ label, fileUri: URI.parse(file) });\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\treturn result;\n}\n\nexport function toStoreData(recents: IRecentlyOpened): RecentlyOpenedStorageData {\n\tconst serialized: ISerializedRecentlyOpened = { workspaces3: [], files2: [] };\n\n\tlet hasLabel = false;\n\tconst workspaceLabels: (string | null)[] = [];\n\tfor (const recent of recents.workspaces) {\n\t\tif (isRecentFolder(recent)) {\n\t\t\tserialized.workspaces3.push(recent.folderUri.toString());\n\t\t} else {\n\t\t\tserialized.workspaces3.push({ id: recent.workspace.id, configURIPath: recent.workspace.configPath.toString() });\n\t\t}\n\t\tworkspaceLabels.push(recent.label || null);\n\t\thasLabel = hasLabel || !!recent.label;\n\t}\n\n\tif (hasLabel) {\n\t\tserialized.workspaceLabels = workspaceLabels;\n\t}\n\n\thasLabel = false;\n\n\tconst fileLabels: (string | null)[] = [];\n\tfor (const recent of recents.files) {\n\t\tserialized.files2.push(recent.fileUri.toString());\n\t\tfileLabels.push(recent.label || null);\n\t\thasLabel = hasLabel || !!recent.label;\n\t}\n\n\tif (hasLabel) {\n\t\tserialized.fileLabels = fileLabels;\n\t}\n\n\treturn serialized;\n}\n\n//#endregion\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nexport class Cache<T> {\n\n\tprivate static readonly enableDebugLogging = false;\n\n\tprivate readonly _data = new Map<number, readonly T[]>();\n\tprivate _idPool = 1;\n\n\tconstructor(\n\t\tprivate readonly id: string\n\t) { }\n\n\tadd(item: readonly T[]): number {\n\t\tconst id = this._idPool++;\n\t\tthis._data.set(id, item);\n\t\tthis.logDebugInfo();\n\t\treturn id;\n\t}\n\n\tget(pid: number, id: number): T | undefined {\n\t\treturn this._data.has(pid) ? this._data.get(pid)![id] : undefined;\n\t}\n\n\tdelete(id: number) {\n\t\tthis._data.delete(id);\n\t\tthis.logDebugInfo();\n\t}\n\n\tprivate logDebugInfo() {\n\t\tif (!Cache.enableDebugLogging) {\n\t\t\treturn;\n\t\t}\n\t\tconsole.log(`${this.id} cache size — ${this._data.size}`);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type * as vscode from 'vscode';\nimport { IEditorTabDto, IExtHostEditorTabsShape } from 'vs/workbench/api/common/extHost.protocol';\nimport { URI } from 'vs/base/common/uri';\nimport { Emitter, Event } from 'vs/base/common/event';\n\n\nexport interface IEditorTab {\n\tname: string;\n\tgroup: number;\n\tresource: vscode.Uri\n}\n\nexport class ExtHostEditorTabs implements IExtHostEditorTabsShape {\n\n\tprivate readonly _onDidChangeTabs = new Emitter<void>();\n\treadonly onDidChangeTabs: Event<void> = this._onDidChangeTabs.event;\n\n\tprivate _tabs: IEditorTab[] = [];\n\n\tget tabs(): readonly IEditorTab[] {\n\t\treturn this._tabs;\n\t}\n\n\t$acceptEditorTabs(tabs: IEditorTabDto[]): void {\n\t\tthis._tabs = tabs.map(dto => {\n\t\t\treturn {\n\t\t\t\tname: dto.name,\n\t\t\t\tgroup: dto.group,\n\t\t\t\tresource: URI.revive(dto.resource)\n\t\t\t};\n\t\t});\n\t\tthis._onDidChangeTabs.fire();\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Schemas } from 'vs/base/common/network';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { ExtHostFileSystemInfoShape } from 'vs/workbench/api/common/extHost.protocol';\n\nexport class ExtHostFileSystemInfo implements ExtHostFileSystemInfoShape {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _systemSchemes = new Set(Object.keys(Schemas));\n\tprivate readonly _providerInfo = new Map<string, number>();\n\n\t$acceptProviderInfos(scheme: string, capabilities: number | null): void {\n\t\tif (capabilities === null) {\n\t\t\tthis._providerInfo.delete(scheme);\n\t\t} else {\n\t\t\tthis._providerInfo.set(scheme, capabilities);\n\t\t}\n\t}\n\n\tisFreeScheme(scheme: string): boolean {\n\t\treturn !this._providerInfo.has(scheme) && !this._systemSchemes.has(scheme);\n\t}\n\n\tgetCapabilities(scheme: string): number | undefined {\n\t\treturn this._providerInfo.get(scheme);\n\t}\n}\n\nexport interface IExtHostFileSystemInfo extends ExtHostFileSystemInfo { }\nexport const IExtHostFileSystemInfo = createDecorator<IExtHostFileSystemInfo>('IExtHostFileSystemInfo');\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IInitData } from './extHost.protocol';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\n\nexport const IExtHostInitDataService = createDecorator<IExtHostInitDataService>('IExtHostInitDataService');\n\nexport interface IExtHostInitDataService extends Readonly<IInitData> {\n\treadonly _serviceBrand: undefined;\n}\n\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type * as vscode from 'vscode';\nimport { IDisposable } from 'vs/base/common/lifecycle';\nimport { ExtHostStorage } from 'vs/workbench/api/common/extHostStorage';\nimport { IExtensionDescription } from 'vs/platform/extensions/common/extensions';\n\nexport class ExtensionMemento implements vscode.Memento {\n\n\tprotected readonly _id: string;\n\tprivate readonly _shared: boolean;\n\tprotected readonly _storage: ExtHostStorage;\n\n\tprivate readonly _init: Promise<ExtensionMemento>;\n\tprivate _value?: { [n: string]: any; };\n\tprivate readonly _storageListener: IDisposable;\n\n\tconstructor(id: string, global: boolean, storage: ExtHostStorage) {\n\t\tthis._id = id;\n\t\tthis._shared = global;\n\t\tthis._storage = storage;\n\n\t\tthis._init = this._storage.getValue(this._shared, this._id, Object.create(null)).then(value => {\n\t\t\tthis._value = value;\n\t\t\treturn this;\n\t\t});\n\n\t\tthis._storageListener = this._storage.onDidChangeStorage(e => {\n\t\t\tif (e.shared === this._shared && e.key === this._id) {\n\t\t\t\tthis._value = e.value;\n\t\t\t}\n\t\t});\n\t}\n\n\tget whenReady(): Promise<ExtensionMemento> {\n\t\treturn this._init;\n\t}\n\n\tget<T>(key: string): T | undefined;\n\tget<T>(key: string, defaultValue: T): T;\n\tget<T>(key: string, defaultValue?: T): T {\n\t\tlet value = this._value![key];\n\t\tif (typeof value === 'undefined') {\n\t\t\tvalue = defaultValue;\n\t\t}\n\t\treturn value;\n\t}\n\n\tupdate(key: string, value: any): Promise<void> {\n\t\tthis._value![key] = value;\n\t\treturn this._storage.setValue(this._shared, this._id, this._value!);\n\t}\n\n\tdispose(): void {\n\t\tthis._storageListener.dispose();\n\t}\n}\n\nexport class ExtensionGlobalMemento extends ExtensionMemento {\n\n\tprivate readonly _extension: IExtensionDescription;\n\n\tsetKeysForSync(keys: string[]): void {\n\t\tthis._storage.registerExtensionStorageKeysToSync({ id: this._id, version: this._extension.version }, keys);\n\t}\n\n\tconstructor(extensionDescription: IExtensionDescription, storage: ExtHostStorage) {\n\t\tsuper(extensionDescription.identifier.value, true, storage);\n\t\tthis._extension = extensionDescription;\n\t}\n\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ProxyIdentifier, IRPCProtocol } from 'vs/workbench/services/extensions/common/proxyIdentifier';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\n\nexport const IExtHostRpcService = createDecorator<IExtHostRpcService>('IExtHostRpcService');\n\nexport interface IExtHostRpcService extends IRPCProtocol {\n\treadonly _serviceBrand: undefined;\n}\n\nexport class ExtHostRpcService implements IExtHostRpcService {\n\treadonly _serviceBrand: undefined;\n\n\treadonly getProxy: <T>(identifier: ProxyIdentifier<T>) => T;\n\treadonly set: <T, R extends T> (identifier: ProxyIdentifier<T>, instance: R) => R;\n\treadonly assertRegistered: (identifiers: ProxyIdentifier<any>[]) => void;\n\treadonly drain: () => Promise<void>;\n\n\tconstructor(rpcProtocol: IRPCProtocol) {\n\t\tthis.getProxy = rpcProtocol.getProxy.bind(rpcProtocol);\n\t\tthis.set = rpcProtocol.set.bind(rpcProtocol);\n\t\tthis.assertRegistered = rpcProtocol.assertRegistered.bind(rpcProtocol);\n\t\tthis.drain = rpcProtocol.drain.bind(rpcProtocol);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type * as vscode from 'vscode';\n\nimport { ExtHostSecretState } from 'vs/workbench/api/common/exHostSecretState';\nimport { ExtensionIdentifier, IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { Emitter, Event } from 'vs/base/common/event';\n\nexport class ExtensionSecrets implements vscode.SecretStorage {\n\n\tprotected readonly _id: string;\n\treadonly #secretState: ExtHostSecretState;\n\n\tprivate _onDidChange = new Emitter<vscode.SecretStorageChangeEvent>();\n\treadonly onDidChange: Event<vscode.SecretStorageChangeEvent> = this._onDidChange.event;\n\n\n\tconstructor(extensionDescription: IExtensionDescription, secretState: ExtHostSecretState) {\n\t\tthis._id = ExtensionIdentifier.toKey(extensionDescription.identifier);\n\t\tthis.#secretState = secretState;\n\n\t\tthis.#secretState.onDidChangePassword(e => {\n\t\t\tif (e.extensionId === this._id) {\n\t\t\t\tthis._onDidChange.fire({ key: e.key });\n\t\t\t}\n\t\t});\n\t}\n\n\tget(key: string): Promise<string | undefined> {\n\t\treturn this.#secretState.get(this._id, key);\n\t}\n\n\tstore(key: string, value: string): Promise<void> {\n\t\treturn this.#secretState.store(this._id, key, value);\n\t}\n\n\tdelete(key: string): Promise<void> {\n\t\treturn this.#secretState.delete(this._id, key);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ExtHostTunnelServiceShape } from 'vs/workbench/api/common/extHost.protocol';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport * as vscode from 'vscode';\nimport { RemoteTunnel, TunnelCreationOptions, TunnelOptions } from 'vs/platform/remote/common/tunnel';\nimport { IDisposable } from 'vs/base/common/lifecycle';\nimport { Emitter } from 'vs/base/common/event';\nimport { IExtHostRpcService } from 'vs/workbench/api/common/extHostRpcService';\nimport { IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { CandidatePort } from 'vs/workbench/services/remote/common/remoteExplorerService';\n\nexport interface TunnelDto {\n\tremoteAddress: { port: number, host: string };\n\tlocalAddress: { port: number, host: string } | string;\n\tpublic: boolean;\n}\n\nexport namespace TunnelDto {\n\texport function fromApiTunnel(tunnel: vscode.Tunnel): TunnelDto {\n\t\treturn { remoteAddress: tunnel.remoteAddress, localAddress: tunnel.localAddress, public: !!tunnel.public };\n\t}\n\texport function fromServiceTunnel(tunnel: RemoteTunnel): TunnelDto {\n\t\treturn {\n\t\t\tremoteAddress: {\n\t\t\t\thost: tunnel.tunnelRemoteHost,\n\t\t\t\tport: tunnel.tunnelRemotePort\n\t\t\t},\n\t\t\tlocalAddress: tunnel.localAddress,\n\t\t\tpublic: tunnel.public\n\t\t};\n\t}\n}\n\nexport interface Tunnel extends vscode.Disposable {\n\tremote: { port: number, host: string };\n\tlocalAddress: string;\n}\n\nexport interface IExtHostTunnelService extends ExtHostTunnelServiceShape {\n\treadonly _serviceBrand: undefined;\n\topenTunnel(extension: IExtensionDescription, forward: TunnelOptions): Promise<vscode.Tunnel | undefined>;\n\tgetTunnels(): Promise<vscode.TunnelDescription[]>;\n\tonDidChangeTunnels: vscode.Event<void>;\n\tsetTunnelExtensionFunctions(provider: vscode.RemoteAuthorityResolver | undefined): Promise<IDisposable>;\n}\n\nexport const IExtHostTunnelService = createDecorator<IExtHostTunnelService>('IExtHostTunnelService');\n\nexport class ExtHostTunnelService implements IExtHostTunnelService {\n\tdeclare readonly _serviceBrand: undefined;\n\tonDidChangeTunnels: vscode.Event<void> = (new Emitter<void>()).event;\n\n\tconstructor(\n\t\t@IExtHostRpcService extHostRpc: IExtHostRpcService,\n\t) {\n\t}\n\tasync $applyCandidateFilter(candidates: CandidatePort[]): Promise<CandidatePort[]> {\n\t\treturn candidates;\n\t}\n\n\tasync openTunnel(extension: IExtensionDescription, forward: TunnelOptions): Promise<vscode.Tunnel | undefined> {\n\t\treturn undefined;\n\t}\n\tasync getTunnels(): Promise<vscode.TunnelDescription[]> {\n\t\treturn [];\n\t}\n\tasync setTunnelExtensionFunctions(provider: vscode.RemoteAuthorityResolver | undefined): Promise<IDisposable> {\n\t\treturn { dispose: () => { } };\n\t}\n\tasync $forwardPort(tunnelOptions: TunnelOptions, tunnelCreationOptions: TunnelCreationOptions): Promise<TunnelDto | undefined> { return undefined; }\n\tasync $closeTunnel(remote: { host: string, port: number }): Promise<void> { }\n\tasync $onDidTunnelsChange(): Promise<void> { }\n\tasync $registerCandidateFinder(): Promise<void> { }\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IURITransformer } from 'vs/base/common/uriIpc';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { URI, UriComponents } from 'vs/base/common/uri';\n\nexport interface IURITransformerService extends IURITransformer {\n\treadonly _serviceBrand: undefined;\n}\n\nexport const IURITransformerService = createDecorator<IURITransformerService>('IURITransformerService');\n\nexport class URITransformerService implements IURITransformerService {\n\tdeclare readonly _serviceBrand: undefined;\n\n\ttransformIncoming: (uri: UriComponents) => UriComponents;\n\ttransformOutgoing: (uri: UriComponents) => UriComponents;\n\ttransformOutgoingURI: (uri: URI) => URI;\n\ttransformOutgoingScheme: (scheme: string) => string;\n\n\tconstructor(delegate: IURITransformer | null) {\n\t\tif (!delegate) {\n\t\t\tthis.transformIncoming = arg => arg;\n\t\t\tthis.transformOutgoing = arg => arg;\n\t\t\tthis.transformOutgoingURI = arg => arg;\n\t\t\tthis.transformOutgoingScheme = arg => arg;\n\t\t} else {\n\t\t\tthis.transformIncoming = delegate.transformIncoming.bind(delegate);\n\t\t\tthis.transformOutgoing = delegate.transformOutgoing.bind(delegate);\n\t\t\tthis.transformOutgoingURI = delegate.transformOutgoingURI.bind(delegate);\n\t\t\tthis.transformOutgoingScheme = delegate.transformOutgoingScheme.bind(delegate);\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from 'vs/base/common/uri';\nimport type * as vscode from 'vscode';\n\nexport interface WebviewInitData {\n\treadonly isExtensionDevelopmentDebug: boolean;\n\treadonly webviewResourceRoot: string;\n\treadonly webviewCspSource: string;\n}\n\nexport function asWebviewUri(\n\tinitData: WebviewInitData,\n\tuuid: string,\n\tresource: vscode.Uri,\n): vscode.Uri {\n\tconst uri = initData.webviewResourceRoot\n\t\t// Make sure we preserve the scheme of the resource but convert it into a normal path segment\n\t\t// The scheme is important as we need to know if we are requesting a local or a remote resource.\n\t\t.replace('{{resource}}', resource.scheme + withoutScheme(resource))\n\t\t.replace('{{uuid}}', uuid);\n\treturn URI.parse(uri);\n}\n\nfunction withoutScheme(resource: vscode.Uri): string {\n\treturn resource.toString().replace(/^\\S+?:/, '');\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter } from 'vs/base/common/event';\nimport { DisposableStore } from 'vs/base/common/lifecycle';\nimport { IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { ExtHostTextEditor } from 'vs/workbench/api/common/extHostTextEditor';\nimport { ExtHostEditors } from 'vs/workbench/api/common/extHostTextEditors';\nimport type * as vscode from 'vscode';\nimport { ExtHostEditorInsetsShape, MainThreadEditorInsetsShape } from './extHost.protocol';\nimport { asWebviewUri, WebviewInitData } from 'vs/workbench/api/common/shared/webview';\nimport { generateUuid } from 'vs/base/common/uuid';\n\nexport class ExtHostEditorInsets implements ExtHostEditorInsetsShape {\n\n\tprivate _handlePool = 0;\n\tprivate _disposables = new DisposableStore();\n\tprivate _insets = new Map<number, { editor: vscode.TextEditor, inset: vscode.WebviewEditorInset, onDidReceiveMessage: Emitter<any> }>();\n\n\tconstructor(\n\t\tprivate readonly _proxy: MainThreadEditorInsetsShape,\n\t\tprivate readonly _editors: ExtHostEditors,\n\t\tprivate readonly _initData: WebviewInitData\n\t) {\n\n\t\t// dispose editor inset whenever the hosting editor goes away\n\t\tthis._disposables.add(_editors.onDidChangeVisibleTextEditors(() => {\n\t\t\tconst visibleEditor = _editors.getVisibleTextEditors();\n\t\t\tfor (const value of this._insets.values()) {\n\t\t\t\tif (visibleEditor.indexOf(value.editor) < 0) {\n\t\t\t\t\tvalue.inset.dispose(); // will remove from `this._insets`\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t}\n\n\tdispose(): void {\n\t\tthis._insets.forEach(value => value.inset.dispose());\n\t\tthis._disposables.dispose();\n\t}\n\n\tcreateWebviewEditorInset(editor: vscode.TextEditor, line: number, height: number, options: vscode.WebviewOptions | undefined, extension: IExtensionDescription): vscode.WebviewEditorInset {\n\n\t\tlet apiEditor: ExtHostTextEditor | undefined;\n\t\tfor (const candidate of this._editors.getVisibleTextEditors()) {\n\t\t\tif (candidate === editor) {\n\t\t\t\tapiEditor = <ExtHostTextEditor>candidate;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (!apiEditor) {\n\t\t\tthrow new Error('not a visible editor');\n\t\t}\n\n\t\tconst that = this;\n\t\tconst handle = this._handlePool++;\n\t\tconst onDidReceiveMessage = new Emitter<any>();\n\t\tconst onDidDispose = new Emitter<void>();\n\n\t\tconst webview = new class implements vscode.Webview {\n\n\t\t\tprivate readonly _uuid = generateUuid();\n\t\t\tprivate _html: string = '';\n\t\t\tprivate _options: vscode.WebviewOptions = Object.create(null);\n\n\t\t\tasWebviewUri(resource: vscode.Uri): vscode.Uri {\n\t\t\t\treturn asWebviewUri(that._initData, this._uuid, resource);\n\t\t\t}\n\n\t\t\tget cspSource(): string {\n\t\t\t\treturn that._initData.webviewCspSource;\n\t\t\t}\n\n\t\t\tset options(value: vscode.WebviewOptions) {\n\t\t\t\tthis._options = value;\n\t\t\t\tthat._proxy.$setOptions(handle, value);\n\t\t\t}\n\n\t\t\tget options(): vscode.WebviewOptions {\n\t\t\t\treturn this._options;\n\t\t\t}\n\n\t\t\tset html(value: string) {\n\t\t\t\tthis._html = value;\n\t\t\t\tthat._proxy.$setHtml(handle, value);\n\t\t\t}\n\n\t\t\tget html(): string {\n\t\t\t\treturn this._html;\n\t\t\t}\n\n\t\t\tget onDidReceiveMessage(): vscode.Event<any> {\n\t\t\t\treturn onDidReceiveMessage.event;\n\t\t\t}\n\n\t\t\tpostMessage(message: any): Thenable<boolean> {\n\t\t\t\treturn that._proxy.$postMessage(handle, message);\n\t\t\t}\n\t\t};\n\n\t\tconst inset = new class implements vscode.WebviewEditorInset {\n\n\t\t\treadonly editor: vscode.TextEditor = editor;\n\t\t\treadonly line: number = line;\n\t\t\treadonly height: number = height;\n\t\t\treadonly webview: vscode.Webview = webview;\n\t\t\treadonly onDidDispose: vscode.Event<void> = onDidDispose.event;\n\n\t\t\tdispose(): void {\n\t\t\t\tif (that._insets.has(handle)) {\n\t\t\t\t\tthat._insets.delete(handle);\n\t\t\t\t\tthat._proxy.$disposeEditorInset(handle);\n\t\t\t\t\tonDidDispose.fire();\n\n\t\t\t\t\t// final cleanup\n\t\t\t\t\tonDidDispose.dispose();\n\t\t\t\t\tonDidReceiveMessage.dispose();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis._proxy.$createEditorInset(handle, apiEditor.id, apiEditor.document.uri, line + 1, height, options || {}, extension.identifier, extension.extensionLocation);\n\t\tthis._insets.set(handle, { editor, inset, onDidReceiveMessage });\n\n\t\treturn inset;\n\t}\n\n\t$onDidDispose(handle: number): void {\n\t\tconst value = this._insets.get(handle);\n\t\tif (value) {\n\t\t\tvalue.inset.dispose();\n\t\t}\n\t}\n\n\t$onDidReceiveMessage(handle: number, message: any): void {\n\t\tconst value = this._insets.get(handle);\n\t\tif (value) {\n\t\t\tvalue.onDidReceiveMessage.fire(message);\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Command } from 'vs/editor/common/modes';\nimport { UriComponents, URI } from 'vs/base/common/uri';\nimport { Event, Emitter } from 'vs/base/common/event';\nimport { RawContextKey, ContextKeyExpression } from 'vs/platform/contextkey/common/contextkey';\nimport { localize } from 'vs/nls';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { IDisposable, Disposable, toDisposable } from 'vs/base/common/lifecycle';\nimport { ThemeIcon } from 'vs/platform/theme/common/themeService';\nimport { getOrSet } from 'vs/base/common/map';\nimport { Registry } from 'vs/platform/registry/common/platform';\nimport { IKeybindings } from 'vs/platform/keybinding/common/keybindingsRegistry';\nimport { IAction, IActionViewItem } from 'vs/base/common/actions';\nimport { ExtensionIdentifier } from 'vs/platform/extensions/common/extensions';\nimport { flatten, mergeSort } from 'vs/base/common/arrays';\nimport { SyncDescriptor } from 'vs/platform/instantiation/common/descriptors';\nimport { SetMap } from 'vs/base/common/collections';\nimport { IProgressIndicator } from 'vs/platform/progress/common/progress';\nimport Severity from 'vs/base/common/severity';\nimport { IPaneComposite } from 'vs/workbench/common/panecomposite';\nimport { IAccessibilityInformation } from 'vs/platform/accessibility/common/accessibility';\nimport { IMarkdownString } from 'vs/base/common/htmlContent';\nimport { mixin } from 'vs/base/common/objects';\nimport { Codicon } from 'vs/base/common/codicons';\nimport { registerIcon } from 'vs/platform/theme/common/iconRegistry';\nimport { CancellationToken } from 'vs/base/common/cancellation';\n\nexport const defaultViewIcon = registerIcon('default-view-icon', Codicon.window, localize('defaultViewIcon', 'Default view icon.'));\n\nexport namespace Extensions {\n\texport const ViewContainersRegistry = 'workbench.registry.view.containers';\n\texport const ViewsRegistry = 'workbench.registry.view';\n}\n\nexport const enum ViewContainerLocation {\n\tSidebar,\n\tPanel\n}\n\nexport function ViewContainerLocationToString(viewContainerLocation: ViewContainerLocation) {\n\tswitch (viewContainerLocation) {\n\t\tcase ViewContainerLocation.Sidebar: return 'sidebar';\n\t\tcase ViewContainerLocation.Panel: return 'panel';\n\t}\n}\n\nexport interface IViewContainerDescriptor {\n\n\treadonly id: string;\n\n\treadonly name: string;\n\n\treadonly ctorDescriptor: SyncDescriptor<IViewPaneContainer>;\n\n\treadonly storageId?: string;\n\n\treadonly icon?: ThemeIcon | URI;\n\n\treadonly alwaysUseContainerInfo?: boolean;\n\n\treadonly focusCommand?: { id: string, keybindings?: IKeybindings };\n\n\treadonly viewOrderDelegate?: ViewOrderDelegate;\n\n\treadonly hideIfEmpty?: boolean;\n\n\treadonly extensionId?: ExtensionIdentifier;\n\n\treadonly rejectAddedViews?: boolean;\n\n\treadonly order?: number;\n\n\trequestedIndex?: number;\n}\n\nexport interface IViewContainersRegistry {\n\t/**\n\t * An event that is triggered when a view container is registered.\n\t */\n\treadonly onDidRegister: Event<{ viewContainer: ViewContainer, viewContainerLocation: ViewContainerLocation }>;\n\n\t/**\n\t * An event that is triggered when a view container is deregistered.\n\t */\n\treadonly onDidDeregister: Event<{ viewContainer: ViewContainer, viewContainerLocation: ViewContainerLocation }>;\n\n\t/**\n\t * All registered view containers\n\t */\n\treadonly all: ViewContainer[];\n\n\t/**\n\t * Registers a view container to given location.\n\t * No op if a view container is already registered.\n\t *\n\t * @param viewContainerDescriptor descriptor of view container\n\t * @param location location of the view container\n\t *\n\t * @returns the registered ViewContainer.\n\t */\n\tregisterViewContainer(viewContainerDescriptor: IViewContainerDescriptor, location: ViewContainerLocation, isDefault?: boolean): ViewContainer;\n\n\t/**\n\t * Deregisters the given view container\n\t * No op if the view container is not registered\n\t */\n\tderegisterViewContainer(viewContainer: ViewContainer): void;\n\n\t/**\n\t * Returns the view container with given id.\n\t *\n\t * @returns the view container with given id.\n\t */\n\tget(id: string): ViewContainer | undefined;\n\n\t/**\n\t * Returns all view containers in the given location\n\t */\n\tgetViewContainers(location: ViewContainerLocation): ViewContainer[];\n\n\t/**\n\t * Returns the view container location\n\t */\n\tgetViewContainerLocation(container: ViewContainer): ViewContainerLocation;\n\n\t/**\n\t * Return the default view container from the given location\n\t */\n\tgetDefaultViewContainer(location: ViewContainerLocation): ViewContainer | undefined;\n}\n\ninterface ViewOrderDelegate {\n\tgetOrder(group?: string): number | undefined;\n}\n\nexport interface ViewContainer extends IViewContainerDescriptor { }\n\nclass ViewContainersRegistryImpl extends Disposable implements IViewContainersRegistry {\n\n\tprivate readonly _onDidRegister = this._register(new Emitter<{ viewContainer: ViewContainer, viewContainerLocation: ViewContainerLocation }>());\n\treadonly onDidRegister: Event<{ viewContainer: ViewContainer, viewContainerLocation: ViewContainerLocation }> = this._onDidRegister.event;\n\n\tprivate readonly _onDidDeregister = this._register(new Emitter<{ viewContainer: ViewContainer, viewContainerLocation: ViewContainerLocation }>());\n\treadonly onDidDeregister: Event<{ viewContainer: ViewContainer, viewContainerLocation: ViewContainerLocation }> = this._onDidDeregister.event;\n\n\tprivate readonly viewContainers: Map<ViewContainerLocation, ViewContainer[]> = new Map<ViewContainerLocation, ViewContainer[]>();\n\tprivate readonly defaultViewContainers: ViewContainer[] = [];\n\n\tget all(): ViewContainer[] {\n\t\treturn flatten([...this.viewContainers.values()]);\n\t}\n\n\tregisterViewContainer(viewContainerDescriptor: IViewContainerDescriptor, viewContainerLocation: ViewContainerLocation, isDefault?: boolean): ViewContainer {\n\t\tconst existing = this.get(viewContainerDescriptor.id);\n\t\tif (existing) {\n\t\t\treturn existing;\n\t\t}\n\n\t\tconst viewContainer: ViewContainer = viewContainerDescriptor;\n\t\tconst viewContainers = getOrSet(this.viewContainers, viewContainerLocation, []);\n\t\tviewContainers.push(viewContainer);\n\t\tif (isDefault) {\n\t\t\tthis.defaultViewContainers.push(viewContainer);\n\t\t}\n\t\tthis._onDidRegister.fire({ viewContainer, viewContainerLocation });\n\t\treturn viewContainer;\n\t}\n\n\tderegisterViewContainer(viewContainer: ViewContainer): void {\n\t\tfor (const viewContainerLocation of this.viewContainers.keys()) {\n\t\t\tconst viewContainers = this.viewContainers.get(viewContainerLocation)!;\n\t\t\tconst index = viewContainers?.indexOf(viewContainer);\n\t\t\tif (index !== -1) {\n\t\t\t\tviewContainers?.splice(index, 1);\n\t\t\t\tif (viewContainers.length === 0) {\n\t\t\t\t\tthis.viewContainers.delete(viewContainerLocation);\n\t\t\t\t}\n\t\t\t\tthis._onDidDeregister.fire({ viewContainer, viewContainerLocation });\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\tget(id: string): ViewContainer | undefined {\n\t\treturn this.all.filter(viewContainer => viewContainer.id === id)[0];\n\t}\n\n\tgetViewContainers(location: ViewContainerLocation): ViewContainer[] {\n\t\treturn [...(this.viewContainers.get(location) || [])];\n\t}\n\n\tgetViewContainerLocation(container: ViewContainer): ViewContainerLocation {\n\t\treturn [...this.viewContainers.keys()].filter(location => this.getViewContainers(location).filter(viewContainer => viewContainer?.id === container.id).length > 0)[0];\n\t}\n\n\tgetDefaultViewContainer(location: ViewContainerLocation): ViewContainer | undefined {\n\t\treturn this.defaultViewContainers.find(viewContainer => this.getViewContainerLocation(viewContainer) === location);\n\t}\n}\n\nRegistry.add(Extensions.ViewContainersRegistry, new ViewContainersRegistryImpl());\n\nexport interface IViewDescriptor {\n\n\treadonly type?: string;\n\n\treadonly id: string;\n\n\treadonly name: string;\n\n\treadonly ctorDescriptor: SyncDescriptor<IView>;\n\n\treadonly when?: ContextKeyExpression;\n\n\treadonly order?: number;\n\n\treadonly weight?: number;\n\n\treadonly collapsed?: boolean;\n\n\treadonly canToggleVisibility?: boolean;\n\n\treadonly canMoveView?: boolean;\n\n\treadonly containerIcon?: ThemeIcon | URI;\n\n\treadonly containerTitle?: string;\n\n\t// Applies only to newly created views\n\treadonly hideByDefault?: boolean;\n\n\treadonly workspace?: boolean;\n\n\treadonly focusCommand?: { id: string, keybindings?: IKeybindings };\n\n\t// For contributed remote explorer views\n\treadonly group?: string;\n\n\treadonly remoteAuthority?: string | string[];\n}\n\nexport interface IViewDescriptorRef {\n\tviewDescriptor: IViewDescriptor;\n\tindex: number;\n}\n\nexport interface IAddedViewDescriptorRef extends IViewDescriptorRef {\n\tcollapsed: boolean;\n\tsize?: number;\n}\n\nexport interface IAddedViewDescriptorState {\n\tviewDescriptor: IViewDescriptor,\n\tcollapsed?: boolean;\n\tvisible?: boolean;\n}\n\nexport interface IViewContainerModel {\n\n\treadonly viewContainer: ViewContainer;\n\n\treadonly title: string;\n\treadonly icon: ThemeIcon | URI | undefined;\n\treadonly onDidChangeContainerInfo: Event<{ title?: boolean, icon?: boolean }>;\n\n\treadonly allViewDescriptors: ReadonlyArray<IViewDescriptor>;\n\treadonly onDidChangeAllViewDescriptors: Event<{ added: ReadonlyArray<IViewDescriptor>, removed: ReadonlyArray<IViewDescriptor> }>;\n\n\treadonly activeViewDescriptors: ReadonlyArray<IViewDescriptor>;\n\treadonly onDidChangeActiveViewDescriptors: Event<{ added: ReadonlyArray<IViewDescriptor>, removed: ReadonlyArray<IViewDescriptor> }>;\n\n\treadonly visibleViewDescriptors: ReadonlyArray<IViewDescriptor>;\n\treadonly onDidAddVisibleViewDescriptors: Event<IAddedViewDescriptorRef[]>;\n\treadonly onDidRemoveVisibleViewDescriptors: Event<IViewDescriptorRef[]>\n\treadonly onDidMoveVisibleViewDescriptors: Event<{ from: IViewDescriptorRef; to: IViewDescriptorRef; }>\n\n\tisVisible(id: string): boolean;\n\tsetVisible(id: string, visible: boolean, size?: number): void;\n\n\tisCollapsed(id: string): boolean;\n\tsetCollapsed(id: string, collapsed: boolean): void;\n\n\tgetSize(id: string): number | undefined;\n\tsetSize(id: string, size: number): void\n\n\tmove(from: string, to: string): void;\n}\n\nexport enum ViewContentGroups {\n\tOpen = '2_open',\n\tDebug = '4_debug',\n\tSCM = '5_scm',\n\tMore = '9_more'\n}\n\nexport interface IViewContentDescriptor {\n\treadonly content: string;\n\treadonly when?: ContextKeyExpression | 'default';\n\treadonly group?: string;\n\treadonly order?: number;\n\treadonly precondition?: ContextKeyExpression | undefined;\n}\n\nexport interface IViewsRegistry {\n\n\treadonly onViewsRegistered: Event<{ views: IViewDescriptor[], viewContainer: ViewContainer }[]>;\n\n\treadonly onViewsDeregistered: Event<{ views: IViewDescriptor[], viewContainer: ViewContainer }>;\n\n\treadonly onDidChangeContainer: Event<{ views: IViewDescriptor[], from: ViewContainer, to: ViewContainer }>;\n\n\tregisterViews(views: IViewDescriptor[], viewContainer: ViewContainer): void;\n\n\tregisterViews2(views: { views: IViewDescriptor[], viewContainer: ViewContainer }[]): void;\n\n\tderegisterViews(views: IViewDescriptor[], viewContainer: ViewContainer): void;\n\n\tmoveViews(views: IViewDescriptor[], viewContainer: ViewContainer): void;\n\n\tgetViews(viewContainer: ViewContainer): IViewDescriptor[];\n\n\tgetView(id: string): IViewDescriptor | null;\n\n\tgetViewContainer(id: string): ViewContainer | null;\n\n\treadonly onDidChangeViewWelcomeContent: Event<string>;\n\tregisterViewWelcomeContent(id: string, viewContent: IViewContentDescriptor): IDisposable;\n\tgetViewWelcomeContent(id: string): IViewContentDescriptor[];\n}\n\nfunction compareViewContentDescriptors(a: IViewContentDescriptor, b: IViewContentDescriptor): number {\n\tconst aGroup = a.group ?? ViewContentGroups.More;\n\tconst bGroup = b.group ?? ViewContentGroups.More;\n\tif (aGroup !== bGroup) {\n\t\treturn aGroup.localeCompare(bGroup);\n\t}\n\treturn (a.order ?? 5) - (b.order ?? 5);\n}\n\nclass ViewsRegistry extends Disposable implements IViewsRegistry {\n\n\tprivate readonly _onViewsRegistered = this._register(new Emitter<{ views: IViewDescriptor[], viewContainer: ViewContainer }[]>());\n\treadonly onViewsRegistered = this._onViewsRegistered.event;\n\n\tprivate readonly _onViewsDeregistered: Emitter<{ views: IViewDescriptor[], viewContainer: ViewContainer }> = this._register(new Emitter<{ views: IViewDescriptor[], viewContainer: ViewContainer }>());\n\treadonly onViewsDeregistered: Event<{ views: IViewDescriptor[], viewContainer: ViewContainer }> = this._onViewsDeregistered.event;\n\n\tprivate readonly _onDidChangeContainer: Emitter<{ views: IViewDescriptor[], from: ViewContainer, to: ViewContainer }> = this._register(new Emitter<{ views: IViewDescriptor[], from: ViewContainer, to: ViewContainer }>());\n\treadonly onDidChangeContainer: Event<{ views: IViewDescriptor[], from: ViewContainer, to: ViewContainer }> = this._onDidChangeContainer.event;\n\n\tprivate readonly _onDidChangeViewWelcomeContent: Emitter<string> = this._register(new Emitter<string>());\n\treadonly onDidChangeViewWelcomeContent: Event<string> = this._onDidChangeViewWelcomeContent.event;\n\n\tprivate _viewContainers: ViewContainer[] = [];\n\tprivate _views: Map<ViewContainer, IViewDescriptor[]> = new Map<ViewContainer, IViewDescriptor[]>();\n\tprivate _viewWelcomeContents = new SetMap<string, IViewContentDescriptor>();\n\n\tregisterViews(views: IViewDescriptor[], viewContainer: ViewContainer): void {\n\t\tthis.registerViews2([{ views, viewContainer }]);\n\t}\n\n\tregisterViews2(views: { views: IViewDescriptor[], viewContainer: ViewContainer }[]): void {\n\t\tviews.forEach(({ views, viewContainer }) => this.addViews(views, viewContainer));\n\t\tthis._onViewsRegistered.fire(views);\n\t}\n\n\tderegisterViews(viewDescriptors: IViewDescriptor[], viewContainer: ViewContainer): void {\n\t\tconst views = this.removeViews(viewDescriptors, viewContainer);\n\t\tif (views.length) {\n\t\t\tthis._onViewsDeregistered.fire({ views, viewContainer });\n\t\t}\n\t}\n\n\tmoveViews(viewsToMove: IViewDescriptor[], viewContainer: ViewContainer): void {\n\t\tfor (const container of this._views.keys()) {\n\t\t\tif (container !== viewContainer) {\n\t\t\t\tconst views = this.removeViews(viewsToMove, container);\n\t\t\t\tif (views.length) {\n\t\t\t\t\tthis.addViews(views, viewContainer);\n\t\t\t\t\tthis._onDidChangeContainer.fire({ views, from: container, to: viewContainer });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tgetViews(loc: ViewContainer): IViewDescriptor[] {\n\t\treturn this._views.get(loc) || [];\n\t}\n\n\tgetView(id: string): IViewDescriptor | null {\n\t\tfor (const viewContainer of this._viewContainers) {\n\t\t\tconst viewDescriptor = (this._views.get(viewContainer) || []).filter(v => v.id === id)[0];\n\t\t\tif (viewDescriptor) {\n\t\t\t\treturn viewDescriptor;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetViewContainer(viewId: string): ViewContainer | null {\n\t\tfor (const viewContainer of this._viewContainers) {\n\t\t\tconst viewDescriptor = (this._views.get(viewContainer) || []).filter(v => v.id === viewId)[0];\n\t\t\tif (viewDescriptor) {\n\t\t\t\treturn viewContainer;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tregisterViewWelcomeContent(id: string, viewContent: IViewContentDescriptor): IDisposable {\n\t\tthis._viewWelcomeContents.add(id, viewContent);\n\t\tthis._onDidChangeViewWelcomeContent.fire(id);\n\n\t\treturn toDisposable(() => {\n\t\t\tthis._viewWelcomeContents.delete(id, viewContent);\n\t\t\tthis._onDidChangeViewWelcomeContent.fire(id);\n\t\t});\n\t}\n\n\tgetViewWelcomeContent(id: string): IViewContentDescriptor[] {\n\t\tconst result: IViewContentDescriptor[] = [];\n\t\tthis._viewWelcomeContents.forEach(id, descriptor => result.push(descriptor));\n\t\tmergeSort(result, compareViewContentDescriptors);\n\t\treturn result;\n\t}\n\n\tprivate addViews(viewDescriptors: IViewDescriptor[], viewContainer: ViewContainer): void {\n\t\tlet views = this._views.get(viewContainer);\n\t\tif (!views) {\n\t\t\tviews = [];\n\t\t\tthis._views.set(viewContainer, views);\n\t\t\tthis._viewContainers.push(viewContainer);\n\t\t}\n\t\tfor (const viewDescriptor of viewDescriptors) {\n\t\t\tif (this.getView(viewDescriptor.id) !== null) {\n\t\t\t\tthrow new Error(localize('duplicateId', \"A view with id '{0}' is already registered\", viewDescriptor.id));\n\t\t\t}\n\t\t\tviews.push(viewDescriptor);\n\t\t}\n\t}\n\n\tprivate removeViews(viewDescriptors: IViewDescriptor[], viewContainer: ViewContainer): IViewDescriptor[] {\n\t\tconst views = this._views.get(viewContainer);\n\t\tif (!views) {\n\t\t\treturn [];\n\t\t}\n\t\tconst viewsToDeregister: IViewDescriptor[] = [];\n\t\tconst remaningViews: IViewDescriptor[] = [];\n\t\tfor (const view of views) {\n\t\t\tif (!viewDescriptors.includes(view)) {\n\t\t\t\tremaningViews.push(view);\n\t\t\t} else {\n\t\t\t\tviewsToDeregister.push(view);\n\t\t\t}\n\t\t}\n\t\tif (viewsToDeregister.length) {\n\t\t\tif (remaningViews.length) {\n\t\t\t\tthis._views.set(viewContainer, remaningViews);\n\t\t\t} else {\n\t\t\t\tthis._views.delete(viewContainer);\n\t\t\t\tthis._viewContainers.splice(this._viewContainers.indexOf(viewContainer), 1);\n\t\t\t}\n\t\t}\n\t\treturn viewsToDeregister;\n\t}\n}\n\nRegistry.add(Extensions.ViewsRegistry, new ViewsRegistry());\n\nexport interface IView {\n\n\treadonly id: string;\n\n\tfocus(): void;\n\n\tisVisible(): boolean;\n\n\tisBodyVisible(): boolean;\n\n\tsetExpanded(expanded: boolean): boolean;\n\n\tgetProgressIndicator(): IProgressIndicator | undefined;\n}\n\nexport const IViewsService = createDecorator<IViewsService>('viewsService');\nexport interface IViewsService {\n\n\treadonly _serviceBrand: undefined;\n\n\t// View Container APIs\n\treadonly onDidChangeViewContainerVisibility: Event<{ id: string, visible: boolean, location: ViewContainerLocation }>;\n\tisViewContainerVisible(id: string): boolean;\n\topenViewContainer(id: string, focus?: boolean): Promise<IPaneComposite | null>;\n\tcloseViewContainer(id: string): void;\n\tgetVisibleViewContainer(location: ViewContainerLocation): ViewContainer | null;\n\tgetActiveViewPaneContainerWithId(viewContainerId: string): IViewPaneContainer | null;\n\n\t// View APIs\n\treadonly onDidChangeViewVisibility: Event<{ id: string, visible: boolean }>;\n\tisViewVisible(id: string): boolean;\n\topenView<T extends IView>(id: string, focus?: boolean): Promise<T | null>;\n\tcloseView(id: string): void;\n\tgetActiveViewWithId<T extends IView>(id: string): T | null;\n\tgetViewProgressIndicator(id: string): IProgressIndicator | undefined;\n}\n\n/**\n * View Contexts\n */\nexport const FocusedViewContext = new RawContextKey<string>('focusedView', '');\nexport function getVisbileViewContextKey(viewId: string): string { return `view.${viewId}.visible`; }\n\nexport const IViewDescriptorService = createDecorator<IViewDescriptorService>('viewDescriptorService');\n\nexport enum ViewVisibilityState {\n\tDefault = 0,\n\tExpand = 1\n}\n\nexport interface IViewDescriptorService {\n\n\treadonly _serviceBrand: undefined;\n\n\t// ViewContainers\n\treadonly viewContainers: ReadonlyArray<ViewContainer>;\n\treadonly onDidChangeViewContainers: Event<{ added: ReadonlyArray<{ container: ViewContainer, location: ViewContainerLocation }>, removed: ReadonlyArray<{ container: ViewContainer, location: ViewContainerLocation }> }>;\n\n\tgetDefaultViewContainer(location: ViewContainerLocation): ViewContainer | undefined;\n\tgetViewContainerById(id: string): ViewContainer | null;\n\tisViewContainerRemovedPermanently(id: string): boolean;\n\tgetDefaultViewContainerLocation(viewContainer: ViewContainer): ViewContainerLocation | null;\n\tgetViewContainerLocation(viewContainer: ViewContainer): ViewContainerLocation | null;\n\tgetViewContainersByLocation(location: ViewContainerLocation): ViewContainer[];\n\tgetViewContainerModel(viewContainer: ViewContainer): IViewContainerModel;\n\n\treadonly onDidChangeContainerLocation: Event<{ viewContainer: ViewContainer, from: ViewContainerLocation, to: ViewContainerLocation }>;\n\tmoveViewContainerToLocation(viewContainer: ViewContainer, location: ViewContainerLocation, requestedIndex?: number): void;\n\n\t// Views\n\tgetViewDescriptorById(id: string): IViewDescriptor | null;\n\tgetViewContainerByViewId(id: string): ViewContainer | null;\n\tgetDefaultContainerById(id: string): ViewContainer | null;\n\tgetViewLocationById(id: string): ViewContainerLocation | null;\n\n\treadonly onDidChangeContainer: Event<{ views: IViewDescriptor[], from: ViewContainer, to: ViewContainer }>;\n\tmoveViewsToContainer(views: IViewDescriptor[], viewContainer: ViewContainer, visibilityState?: ViewVisibilityState): void;\n\n\treadonly onDidChangeLocation: Event<{ views: IViewDescriptor[], from: ViewContainerLocation, to: ViewContainerLocation }>;\n\tmoveViewToLocation(view: IViewDescriptor, location: ViewContainerLocation): void;\n\n\treset(): void;\n}\n\n// Custom views\n\nexport interface ITreeView extends IDisposable {\n\n\tdataProvider: ITreeViewDataProvider | undefined;\n\n\tshowCollapseAllAction: boolean;\n\n\tcanSelectMany: boolean;\n\n\tmessage?: string;\n\n\ttitle: string;\n\n\tdescription: string | undefined;\n\n\treadonly visible: boolean;\n\n\treadonly onDidExpandItem: Event<ITreeItem>;\n\n\treadonly onDidCollapseItem: Event<ITreeItem>;\n\n\treadonly onDidChangeSelection: Event<ITreeItem[]>;\n\n\treadonly onDidChangeVisibility: Event<boolean>;\n\n\treadonly onDidChangeActions: Event<void>;\n\n\treadonly onDidChangeTitle: Event<string>;\n\n\treadonly onDidChangeDescription: Event<string | undefined>;\n\n\treadonly onDidChangeWelcomeState: Event<void>;\n\n\trefresh(treeItems?: ITreeItem[]): Promise<void>;\n\n\tsetVisibility(visible: boolean): void;\n\n\tfocus(): void;\n\n\tlayout(height: number, width: number): void;\n\n\tgetOptimalWidth(): number;\n\n\treveal(item: ITreeItem): Promise<void>;\n\n\texpand(itemOrItems: ITreeItem | ITreeItem[]): Promise<void>;\n\n\tsetSelection(items: ITreeItem[]): void;\n\n\tsetFocus(item: ITreeItem): void;\n\n\tshow(container: any): void;\n}\n\nexport interface IRevealOptions {\n\n\tselect?: boolean;\n\n\tfocus?: boolean;\n\n\texpand?: boolean | number;\n\n}\n\nexport interface ITreeViewDescriptor extends IViewDescriptor {\n\ttreeView: ITreeView;\n}\n\nexport type TreeViewItemHandleArg = {\n\t$treeViewId: string,\n\t$treeItemHandle: string\n};\n\nexport enum TreeItemCollapsibleState {\n\tNone = 0,\n\tCollapsed = 1,\n\tExpanded = 2\n}\n\nexport interface ITreeItemLabel {\n\n\tlabel: string;\n\n\thighlights?: [number, number][];\n\n\tstrikethrough?: boolean;\n\n}\n\nexport interface ITreeItem {\n\n\thandle: string;\n\n\tparentHandle?: string;\n\n\tcollapsibleState: TreeItemCollapsibleState;\n\n\tlabel?: ITreeItemLabel;\n\n\tdescription?: string | boolean;\n\n\ticon?: UriComponents;\n\n\ticonDark?: UriComponents;\n\n\tthemeIcon?: ThemeIcon;\n\n\tresourceUri?: UriComponents;\n\n\ttooltip?: string | IMarkdownString;\n\n\tcontextValue?: string;\n\n\tcommand?: Command;\n\n\tchildren?: ITreeItem[];\n\n\taccessibilityInformation?: IAccessibilityInformation;\n}\n\nexport class ResolvableTreeItem implements ITreeItem {\n\thandle!: string;\n\tparentHandle?: string;\n\tcollapsibleState!: TreeItemCollapsibleState;\n\tlabel?: ITreeItemLabel;\n\tdescription?: string | boolean;\n\ticon?: UriComponents;\n\ticonDark?: UriComponents;\n\tthemeIcon?: ThemeIcon;\n\tresourceUri?: UriComponents;\n\ttooltip?: string | IMarkdownString;\n\tcontextValue?: string;\n\tcommand?: Command;\n\tchildren?: ITreeItem[];\n\taccessibilityInformation?: IAccessibilityInformation;\n\tresolve: (token: CancellationToken) => Promise<void>;\n\tprivate resolved: boolean = false;\n\tprivate _hasResolve: boolean = false;\n\tconstructor(treeItem: ITreeItem, resolve?: ((token: CancellationToken) => Promise<ITreeItem | undefined>)) {\n\t\tmixin(this, treeItem);\n\t\tthis._hasResolve = !!resolve;\n\t\tthis.resolve = async (token: CancellationToken) => {\n\t\t\tif (resolve && !this.resolved) {\n\t\t\t\tconst resolvedItem = await resolve(token);\n\t\t\t\tif (resolvedItem) {\n\t\t\t\t\t// Resolvable elements. Currently tooltip and command.\n\t\t\t\t\tthis.tooltip = this.tooltip ?? resolvedItem.tooltip;\n\t\t\t\t\tthis.command = this.command ?? resolvedItem.command;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!token.isCancellationRequested) {\n\t\t\t\tthis.resolved = true;\n\t\t\t}\n\t\t};\n\t}\n\tget hasResolve(): boolean {\n\t\treturn this._hasResolve;\n\t}\n\tpublic resetResolve() {\n\t\tthis.resolved = false;\n\t}\n\tpublic asTreeItem(): ITreeItem {\n\t\treturn {\n\t\t\thandle: this.handle,\n\t\t\tparentHandle: this.parentHandle,\n\t\t\tcollapsibleState: this.collapsibleState,\n\t\t\tlabel: this.label,\n\t\t\tdescription: this.description,\n\t\t\ticon: this.icon,\n\t\t\ticonDark: this.iconDark,\n\t\t\tthemeIcon: this.themeIcon,\n\t\t\tresourceUri: this.resourceUri,\n\t\t\ttooltip: this.tooltip,\n\t\t\tcontextValue: this.contextValue,\n\t\t\tcommand: this.command,\n\t\t\tchildren: this.children,\n\t\t\taccessibilityInformation: this.accessibilityInformation\n\t\t};\n\t}\n}\n\nexport interface ITreeViewDataProvider {\n\treadonly isTreeEmpty?: boolean;\n\tonDidChangeEmpty?: Event<void>;\n\tgetChildren(element?: ITreeItem): Promise<ITreeItem[]>;\n\n}\n\nexport interface IEditableData {\n\tvalidationMessage: (value: string) => { content: string, severity: Severity } | null;\n\tplaceholder?: string | null;\n\tstartingValue?: string | null;\n\tonFinish: (value: string, success: boolean) => Promise<void>;\n}\n\nexport interface IViewPaneContainer {\n\tonDidAddViews: Event<IView[]>;\n\tonDidRemoveViews: Event<IView[]>;\n\tonDidChangeViewVisibility: Event<IView>;\n\n\treadonly views: IView[];\n\n\tsetVisible(visible: boolean): void;\n\tisVisible(): boolean;\n\tfocus(): void;\n\tgetActions(): IAction[];\n\tgetSecondaryActions(): IAction[];\n\tgetActionViewItem(action: IAction): IActionViewItem | undefined;\n\tgetActionsContext(): unknown;\n\tgetView(viewId: string): IView | undefined;\n\ttoggleViewVisibility(viewId: string): void;\n\tsaveState(): void;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from 'vs/base/common/uri';\nimport * as typeConverters from 'vs/workbench/api/common/extHostTypeConverters';\nimport { CommandsRegistry, ICommandService, ICommandHandler } from 'vs/platform/commands/common/commands';\nimport { ServicesAccessor } from 'vs/platform/instantiation/common/instantiation';\nimport { IOpenEmptyWindowOptions } from 'vs/platform/windows/common/windows';\nimport { IWorkspacesService, IRecent } from 'vs/platform/workspaces/common/workspaces';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { IEnvironmentService } from 'vs/platform/environment/common/environment';\nimport { IViewDescriptorService, IViewsService, ViewVisibilityState } from 'vs/workbench/common/views';\n\n// -----------------------------------------------------------------\n// The following commands are registered on both sides separately.\n//\n// We are trying to maintain backwards compatibility for cases where\n// API commands are encoded as markdown links, for example.\n// -----------------------------------------------------------------\n\nexport interface ICommandsExecutor {\n\texecuteCommand<T>(id: string, ...args: any[]): Promise<T | undefined>;\n}\n\nfunction adjustHandler(handler: (executor: ICommandsExecutor, ...args: any[]) => any): ICommandHandler {\n\treturn (accessor, ...args: any[]) => {\n\t\treturn handler(accessor.get(ICommandService), ...args);\n\t};\n}\n\ninterface INewWindowAPICommandOptions {\n\treuseWindow?: boolean;\n\tremoteAuthority?: string;\n}\n\nexport class NewWindowAPICommand {\n\tpublic static readonly ID = 'vscode.newWindow';\n\tpublic static execute(executor: ICommandsExecutor, options?: INewWindowAPICommandOptions): Promise<any> {\n\t\tconst commandOptions: IOpenEmptyWindowOptions = {\n\t\t\tforceReuseWindow: options && options.reuseWindow,\n\t\t\tremoteAuthority: options && options.remoteAuthority\n\t\t};\n\n\t\treturn executor.executeCommand('_files.newWindow', commandOptions);\n\t}\n}\nCommandsRegistry.registerCommand({\n\tid: NewWindowAPICommand.ID,\n\thandler: adjustHandler(NewWindowAPICommand.execute),\n\tdescription: {\n\t\tdescription: 'Opens an new window',\n\t\targs: [\n\t\t]\n\t}\n});\n\nCommandsRegistry.registerCommand('_workbench.removeFromRecentlyOpened', function (accessor: ServicesAccessor, uri: URI) {\n\tconst workspacesService = accessor.get(IWorkspacesService);\n\treturn workspacesService.removeRecentlyOpened([uri]);\n});\n\nexport class RemoveFromRecentlyOpenedAPICommand {\n\tpublic static readonly ID = 'vscode.removeFromRecentlyOpened';\n\tpublic static execute(executor: ICommandsExecutor, path: string | URI): Promise<any> {\n\t\tif (typeof path === 'string') {\n\t\t\tpath = path.match(/^[^:/?#]+:\\/\\//) ? URI.parse(path) : URI.file(path);\n\t\t} else {\n\t\t\tpath = URI.revive(path); // called from extension host\n\t\t}\n\t\treturn executor.executeCommand('_workbench.removeFromRecentlyOpened', path);\n\t}\n}\nCommandsRegistry.registerCommand(RemoveFromRecentlyOpenedAPICommand.ID, adjustHandler(RemoveFromRecentlyOpenedAPICommand.execute));\n\nexport interface OpenIssueReporterArgs {\n\treadonly extensionId: string;\n\treadonly issueTitle?: string;\n\treadonly issueBody?: string;\n}\n\nexport class OpenIssueReporter {\n\tpublic static readonly ID = 'vscode.openIssueReporter';\n\n\tpublic static execute(executor: ICommandsExecutor, args: string | OpenIssueReporterArgs): Promise<void> {\n\t\tconst commandArgs = typeof args === 'string'\n\t\t\t? { extensionId: args }\n\t\t\t: args;\n\t\treturn executor.executeCommand('workbench.action.openIssueReporter', commandArgs);\n\t}\n}\n\ninterface RecentEntry {\n\turi: URI;\n\ttype: 'workspace' | 'folder' | 'file';\n\tlabel?: string;\n}\n\nCommandsRegistry.registerCommand('_workbench.addToRecentlyOpened', async function (accessor: ServicesAccessor, recentEntry: RecentEntry) {\n\tconst workspacesService = accessor.get(IWorkspacesService);\n\tlet recent: IRecent | undefined = undefined;\n\tconst uri = recentEntry.uri;\n\tconst label = recentEntry.label;\n\tif (recentEntry.type === 'workspace') {\n\t\tconst workspace = await workspacesService.getWorkspaceIdentifier(uri);\n\t\trecent = { workspace, label };\n\t} else if (recentEntry.type === 'folder') {\n\t\trecent = { folderUri: uri, label };\n\t} else {\n\t\trecent = { fileUri: uri, label };\n\t}\n\treturn workspacesService.addRecentlyOpened([recent]);\n});\n\nCommandsRegistry.registerCommand('_workbench.getRecentlyOpened', async function (accessor: ServicesAccessor) {\n\tconst workspacesService = accessor.get(IWorkspacesService);\n\treturn workspacesService.getRecentlyOpened();\n});\n\nCommandsRegistry.registerCommand('_extensionTests.setLogLevel', function (accessor: ServicesAccessor, level: number) {\n\tconst logService = accessor.get(ILogService);\n\tconst environmentService = accessor.get(IEnvironmentService);\n\n\tif (environmentService.isExtensionDevelopment && !!environmentService.extensionTestsLocationURI) {\n\t\tlogService.setLevel(level);\n\t}\n});\n\n\nCommandsRegistry.registerCommand('_extensionTests.getLogLevel', function (accessor: ServicesAccessor) {\n\tconst logService = accessor.get(ILogService);\n\n\treturn logService.getLevel();\n});\n\n\nCommandsRegistry.registerCommand('_workbench.action.moveViews', async function (accessor: ServicesAccessor, options: { viewIds: string[], destinationId: string }) {\n\tconst viewDescriptorService = accessor.get(IViewDescriptorService);\n\n\tconst destination = viewDescriptorService.getViewContainerById(options.destinationId);\n\tif (!destination) {\n\t\treturn;\n\t}\n\n\t// FYI, don't use `moveViewsToContainer` in 1 shot, because it expects all views to have the same current location\n\tfor (const viewId of options.viewIds) {\n\t\tconst viewDescriptor = viewDescriptorService.getViewDescriptorById(viewId);\n\t\tif (viewDescriptor?.canMoveView) {\n\t\t\tviewDescriptorService.moveViewsToContainer([viewDescriptor], destination, ViewVisibilityState.Default);\n\t\t}\n\t}\n\n\tawait accessor.get(IViewsService).openViewContainer(destination.id, true);\n});\n\nexport class MoveViewsAPICommand {\n\tpublic static readonly ID = 'vscode.moveViews';\n\tpublic static execute(executor: ICommandsExecutor, options: { viewIds: string[], destinationId: string }): Promise<any> {\n\t\tif (!Array.isArray(options?.viewIds) || typeof options?.destinationId !== 'string') {\n\t\t\treturn Promise.reject('Invalid arguments');\n\t\t}\n\n\t\treturn executor.executeCommand('_workbench.action.moveViews', options);\n\t}\n}\nCommandsRegistry.registerCommand({\n\tid: MoveViewsAPICommand.ID,\n\thandler: adjustHandler(MoveViewsAPICommand.execute),\n\tdescription: {\n\t\tdescription: 'Move Views',\n\t\targs: []\n\t}\n});\n\n\n// -----------------------------------------------------------------\n// The following commands are registered on the renderer but as API\n// command. DO NOT USE this unless you have understood what this\n// means\n// -----------------------------------------------------------------\n\n\nclass OpenAPICommand {\n\tpublic static readonly ID = 'vscode.open';\n\tpublic static execute(executor: ICommandsExecutor, resource: URI): Promise<any> {\n\n\t\treturn executor.executeCommand('_workbench.open', resource);\n\t}\n}\nCommandsRegistry.registerCommand(OpenAPICommand.ID, adjustHandler(OpenAPICommand.execute));\n\nclass DiffAPICommand {\n\tpublic static readonly ID = 'vscode.diff';\n\tpublic static execute(executor: ICommandsExecutor, left: URI, right: URI, label: string, options?: typeConverters.TextEditorOpenOptions): Promise<any> {\n\t\treturn executor.executeCommand('_workbench.diff', [\n\t\t\tleft, right,\n\t\t\tlabel,\n\t\t]);\n\t}\n}\nCommandsRegistry.registerCommand(DiffAPICommand.ID, adjustHandler(DiffAPICommand.execute));\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { IDebugAdapter } from 'vs/workbench/contrib/debug/common/debug';\nimport { timeout } from 'vs/base/common/async';\nimport { localize } from 'vs/nls';\n\n/**\n * Abstract implementation of the low level API for a debug adapter.\n * Missing is how this API communicates with the debug adapter.\n */\nexport abstract class AbstractDebugAdapter implements IDebugAdapter {\n\tprivate sequence: number;\n\tprivate pendingRequests = new Map<number, (e: DebugProtocol.Response) => void>();\n\tprivate requestCallback: ((request: DebugProtocol.Request) => void) | undefined;\n\tprivate eventCallback: ((request: DebugProtocol.Event) => void) | undefined;\n\tprivate messageCallback: ((message: DebugProtocol.ProtocolMessage) => void) | undefined;\n\tprivate queue: DebugProtocol.ProtocolMessage[] = [];\n\tprotected readonly _onError = new Emitter<Error>();\n\tprotected readonly _onExit = new Emitter<number | null>();\n\n\tconstructor() {\n\t\tthis.sequence = 1;\n\t}\n\n\tabstract startSession(): Promise<void>;\n\n\tabstract stopSession(): Promise<void>;\n\n\tabstract sendMessage(message: DebugProtocol.ProtocolMessage): void;\n\n\tget onError(): Event<Error> {\n\t\treturn this._onError.event;\n\t}\n\n\tget onExit(): Event<number | null> {\n\t\treturn this._onExit.event;\n\t}\n\n\tonMessage(callback: (message: DebugProtocol.ProtocolMessage) => void): void {\n\t\tif (this.messageCallback) {\n\t\t\tthis._onError.fire(new Error(`attempt to set more than one 'Message' callback`));\n\t\t}\n\t\tthis.messageCallback = callback;\n\t}\n\n\tonEvent(callback: (event: DebugProtocol.Event) => void): void {\n\t\tif (this.eventCallback) {\n\t\t\tthis._onError.fire(new Error(`attempt to set more than one 'Event' callback`));\n\t\t}\n\t\tthis.eventCallback = callback;\n\t}\n\n\tonRequest(callback: (request: DebugProtocol.Request) => void): void {\n\t\tif (this.requestCallback) {\n\t\t\tthis._onError.fire(new Error(`attempt to set more than one 'Request' callback`));\n\t\t}\n\t\tthis.requestCallback = callback;\n\t}\n\n\tsendResponse(response: DebugProtocol.Response): void {\n\t\tif (response.seq > 0) {\n\t\t\tthis._onError.fire(new Error(`attempt to send more than one response for command ${response.command}`));\n\t\t} else {\n\t\t\tthis.internalSend('response', response);\n\t\t}\n\t}\n\n\tsendRequest(command: string, args: any, clb: (result: DebugProtocol.Response) => void, timeout?: number): number {\n\t\tconst request: any = {\n\t\t\tcommand: command\n\t\t};\n\t\tif (args && Object.keys(args).length > 0) {\n\t\t\trequest.arguments = args;\n\t\t}\n\t\tthis.internalSend('request', request);\n\t\tif (typeof timeout === 'number') {\n\t\t\tconst timer = setTimeout(() => {\n\t\t\t\tclearTimeout(timer);\n\t\t\t\tconst clb = this.pendingRequests.get(request.seq);\n\t\t\t\tif (clb) {\n\t\t\t\t\tthis.pendingRequests.delete(request.seq);\n\t\t\t\t\tconst err: DebugProtocol.Response = {\n\t\t\t\t\t\ttype: 'response',\n\t\t\t\t\t\tseq: 0,\n\t\t\t\t\t\trequest_seq: request.seq,\n\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\tcommand,\n\t\t\t\t\t\tmessage: localize('timeout', \"Timeout after {0} ms for '{1}'\", timeout, command)\n\t\t\t\t\t};\n\t\t\t\t\tclb(err);\n\t\t\t\t}\n\t\t\t}, timeout);\n\t\t}\n\t\tif (clb) {\n\t\t\t// store callback for this request\n\t\t\tthis.pendingRequests.set(request.seq, clb);\n\t\t}\n\n\t\treturn request.seq;\n\t}\n\n\tacceptMessage(message: DebugProtocol.ProtocolMessage): void {\n\t\tif (this.messageCallback) {\n\t\t\tthis.messageCallback(message);\n\t\t} else {\n\t\t\tthis.queue.push(message);\n\t\t\tif (this.queue.length === 1) {\n\t\t\t\t// first item = need to start processing loop\n\t\t\t\tthis.processQueue();\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Returns whether we should insert a timeout between processing messageA\n\t * and messageB. Artificially queueing protocol messages guarantees that any\n\t * microtasks for previous message finish before next message is processed.\n\t * This is essential ordering when using promises anywhere along the call path.\n\t *\n\t * For example, take the following, where `chooseAndSendGreeting` returns\n\t * a person name and then emits a greeting event:\n\t *\n\t * ```\n\t * let person: string;\n\t * adapter.onGreeting(() => console.log('hello', person));\n\t * person = await adapter.chooseAndSendGreeting();\n\t * ```\n\t *\n\t * Because the event is dispatched synchronously, it may fire before person\n\t * is assigned if they're processed in the same task. Inserting a task\n\t * boundary avoids this issue.\n\t */\n\tprotected needsTaskBoundaryBetween(messageA: DebugProtocol.ProtocolMessage, messageB: DebugProtocol.ProtocolMessage) {\n\t\treturn messageA.type !== 'event' || messageB.type !== 'event';\n\t}\n\n\t/**\n\t * Reads and dispatches items from the queue until it is empty.\n\t */\n\tprivate async processQueue() {\n\t\tlet message: DebugProtocol.ProtocolMessage | undefined;\n\t\twhile (this.queue.length) {\n\t\t\tif (!message || this.needsTaskBoundaryBetween(this.queue[0], message)) {\n\t\t\t\tawait timeout(0);\n\t\t\t}\n\n\t\t\tmessage = this.queue.shift();\n\t\t\tif (!message) {\n\t\t\t\treturn; // may have been disposed of\n\t\t\t}\n\n\t\t\tswitch (message.type) {\n\t\t\t\tcase 'event':\n\t\t\t\t\tif (this.eventCallback) {\n\t\t\t\t\t\tthis.eventCallback(<DebugProtocol.Event>message);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'request':\n\t\t\t\t\tif (this.requestCallback) {\n\t\t\t\t\t\tthis.requestCallback(<DebugProtocol.Request>message);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'response':\n\t\t\t\t\tconst response = <DebugProtocol.Response>message;\n\t\t\t\t\tconst clb = this.pendingRequests.get(response.request_seq);\n\t\t\t\t\tif (clb) {\n\t\t\t\t\t\tthis.pendingRequests.delete(response.request_seq);\n\t\t\t\t\t\tclb(response);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate internalSend(typ: 'request' | 'response' | 'event', message: DebugProtocol.ProtocolMessage): void {\n\t\tmessage.type = typ;\n\t\tmessage.seq = this.sequence++;\n\t\tthis.sendMessage(message);\n\t}\n\n\tprotected async cancelPendingRequests(): Promise<void> {\n\t\tif (this.pendingRequests.size === 0) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst pending = new Map<number, (e: DebugProtocol.Response) => void>();\n\t\tthis.pendingRequests.forEach((value, key) => pending.set(key, value));\n\t\tawait timeout(500);\n\t\tpending.forEach((callback, request_seq) => {\n\t\t\tconst err: DebugProtocol.Response = {\n\t\t\t\ttype: 'response',\n\t\t\t\tseq: 0,\n\t\t\t\trequest_seq,\n\t\t\t\tsuccess: false,\n\t\t\t\tcommand: 'canceled',\n\t\t\t\tmessage: 'canceled'\n\t\t\t};\n\t\t\tcallback(err);\n\t\t\tthis.pendingRequests.delete(request_seq);\n\t\t});\n\t}\n\n\tgetPendingRequestIds(): number[] {\n\t\treturn Array.from(this.pendingRequests.keys());\n\t}\n\n\tdispose(): void {\n\t\tthis.queue = [];\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { equalsIgnoreCase } from 'vs/base/common/strings';\nimport { IDebuggerContribution, IDebugSession, IConfigPresentation } from 'vs/workbench/contrib/debug/common/debug';\nimport { URI as uri } from 'vs/base/common/uri';\nimport { isAbsolute } from 'vs/base/common/path';\nimport { deepClone } from 'vs/base/common/objects';\nimport { Schemas } from 'vs/base/common/network';\n\nconst _formatPIIRegexp = /{([^}]+)}/g;\n\nexport function formatPII(value: string, excludePII: boolean, args: { [key: string]: string } | undefined): string {\n\treturn value.replace(_formatPIIRegexp, function (match, group) {\n\t\tif (excludePII && group.length > 0 && group[0] !== '_') {\n\t\t\treturn match;\n\t\t}\n\n\t\treturn args && args.hasOwnProperty(group) ?\n\t\t\targs[group] :\n\t\t\tmatch;\n\t});\n}\n\n/**\n * Filters exceptions (keys marked with \"!\") from the given object. Used to\n * ensure exception data is not sent on web remotes, see #97628.\n */\nexport function filterExceptionsFromTelemetry<T extends { [key: string]: unknown }>(data: T): Partial<T> {\n\tconst output: Partial<T> = {};\n\tfor (const key of Object.keys(data) as (keyof T & string)[]) {\n\t\tif (!key.startsWith('!')) {\n\t\t\toutput[key] = data[key];\n\t\t}\n\t}\n\n\treturn output;\n}\n\n\nexport function isSessionAttach(session: IDebugSession): boolean {\n\treturn session.configuration.request === 'attach' && !getExtensionHostDebugSession(session);\n}\n\n/**\n * Returns the session or any parent which is an extension host debug session.\n * Returns undefined if there's none.\n */\nexport function getExtensionHostDebugSession(session: IDebugSession): IDebugSession | void {\n\tlet type = session.configuration.type;\n\tif (!type) {\n\t\treturn;\n\t}\n\n\tif (type === 'vslsShare') {\n\t\ttype = (<any>session.configuration).adapterProxy.configuration.type;\n\t}\n\n\tif (equalsIgnoreCase(type, 'extensionhost') || equalsIgnoreCase(type, 'pwa-extensionhost')) {\n\t\treturn session;\n\t}\n\n\treturn session.parentSession ? getExtensionHostDebugSession(session.parentSession) : undefined;\n}\n\n// only a debugger contributions with a label, program, or runtime attribute is considered a \"defining\" or \"main\" debugger contribution\nexport function isDebuggerMainContribution(dbg: IDebuggerContribution) {\n\treturn dbg.type && (dbg.label || dbg.program || dbg.runtime);\n}\n\nexport function getExactExpressionStartAndEnd(lineContent: string, looseStart: number, looseEnd: number): { start: number, end: number } {\n\tlet matchingExpression: string | undefined = undefined;\n\tlet startOffset = 0;\n\n\t// Some example supported expressions: myVar.prop, a.b.c.d, myVar?.prop, myVar->prop, MyClass::StaticProp, *myVar\n\t// Match any character except a set of characters which often break interesting sub-expressions\n\tlet expression: RegExp = /([^()\\[\\]{}<>\\s+\\-/%~#^;=|,`!]|\\->)+/g;\n\tlet result: RegExpExecArray | null = null;\n\n\t// First find the full expression under the cursor\n\twhile (result = expression.exec(lineContent)) {\n\t\tlet start = result.index + 1;\n\t\tlet end = start + result[0].length;\n\n\t\tif (start <= looseStart && end >= looseEnd) {\n\t\t\tmatchingExpression = result[0];\n\t\t\tstartOffset = start;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\t// If there are non-word characters after the cursor, we want to truncate the expression then.\n\t// For example in expression 'a.b.c.d', if the focus was under 'b', 'a.b' would be evaluated.\n\tif (matchingExpression) {\n\t\tlet subExpression: RegExp = /\\w+/g;\n\t\tlet subExpressionResult: RegExpExecArray | null = null;\n\t\twhile (subExpressionResult = subExpression.exec(matchingExpression)) {\n\t\t\tlet subEnd = subExpressionResult.index + 1 + startOffset + subExpressionResult[0].length;\n\t\t\tif (subEnd >= looseEnd) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (subExpressionResult) {\n\t\t\tmatchingExpression = matchingExpression.substring(0, subExpression.lastIndex);\n\t\t}\n\t}\n\n\treturn matchingExpression ?\n\t\t{ start: startOffset, end: startOffset + matchingExpression.length - 1 } :\n\t\t{ start: 0, end: 0 };\n}\n\n// RFC 2396, Appendix A: https://www.ietf.org/rfc/rfc2396.txt\nconst _schemePattern = /^[a-zA-Z][a-zA-Z0-9\\+\\-\\.]+:/;\n\nexport function isUri(s: string | undefined): boolean {\n\t// heuristics: a valid uri starts with a scheme and\n\t// the scheme has at least 2 characters so that it doesn't look like a drive letter.\n\treturn !!(s && s.match(_schemePattern));\n}\n\nfunction stringToUri(source: PathContainer): string | undefined {\n\tif (typeof source.path === 'string') {\n\t\tif (typeof source.sourceReference === 'number' && source.sourceReference > 0) {\n\t\t\t// if there is a source reference, don't touch path\n\t\t} else {\n\t\t\tif (isUri(source.path)) {\n\t\t\t\treturn <string><unknown>uri.parse(source.path);\n\t\t\t} else {\n\t\t\t\t// assume path\n\t\t\t\tif (isAbsolute(source.path)) {\n\t\t\t\t\treturn <string><unknown>uri.file(source.path);\n\t\t\t\t} else {\n\t\t\t\t\t// leave relative path as is\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn source.path;\n}\n\nfunction uriToString(source: PathContainer): string | undefined {\n\tif (typeof source.path === 'object') {\n\t\tconst u = uri.revive(source.path);\n\t\tif (u) {\n\t\t\tif (u.scheme === Schemas.file) {\n\t\t\t\treturn u.fsPath;\n\t\t\t} else {\n\t\t\t\treturn u.toString();\n\t\t\t}\n\t\t}\n\t}\n\treturn source.path;\n}\n\n// path hooks helpers\n\ninterface PathContainer {\n\tpath?: string;\n\tsourceReference?: number;\n}\n\nexport function convertToDAPaths(message: DebugProtocol.ProtocolMessage, toUri: boolean): DebugProtocol.ProtocolMessage {\n\n\tconst fixPath = toUri ? stringToUri : uriToString;\n\n\t// since we modify Source.paths in the message in place, we need to make a copy of it (see #61129)\n\tconst msg = deepClone(message);\n\n\tconvertPaths(msg, (toDA: boolean, source: PathContainer | undefined) => {\n\t\tif (toDA && source) {\n\t\t\tsource.path = fixPath(source);\n\t\t}\n\t});\n\treturn msg;\n}\n\nexport function convertToVSCPaths(message: DebugProtocol.ProtocolMessage, toUri: boolean): DebugProtocol.ProtocolMessage {\n\n\tconst fixPath = toUri ? stringToUri : uriToString;\n\n\t// since we modify Source.paths in the message in place, we need to make a copy of it (see #61129)\n\tconst msg = deepClone(message);\n\n\tconvertPaths(msg, (toDA: boolean, source: PathContainer | undefined) => {\n\t\tif (!toDA && source) {\n\t\t\tsource.path = fixPath(source);\n\t\t}\n\t});\n\treturn msg;\n}\n\nfunction convertPaths(msg: DebugProtocol.ProtocolMessage, fixSourcePath: (toDA: boolean, source: PathContainer | undefined) => void): void {\n\n\tswitch (msg.type) {\n\t\tcase 'event':\n\t\t\tconst event = <DebugProtocol.Event>msg;\n\t\t\tswitch (event.event) {\n\t\t\t\tcase 'output':\n\t\t\t\t\tfixSourcePath(false, (<DebugProtocol.OutputEvent>event).body.source);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'loadedSource':\n\t\t\t\t\tfixSourcePath(false, (<DebugProtocol.LoadedSourceEvent>event).body.source);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'breakpoint':\n\t\t\t\t\tfixSourcePath(false, (<DebugProtocol.BreakpointEvent>event).body.breakpoint.source);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'request':\n\t\t\tconst request = <DebugProtocol.Request>msg;\n\t\t\tswitch (request.command) {\n\t\t\t\tcase 'setBreakpoints':\n\t\t\t\t\tfixSourcePath(true, (<DebugProtocol.SetBreakpointsArguments>request.arguments).source);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'breakpointLocations':\n\t\t\t\t\tfixSourcePath(true, (<DebugProtocol.BreakpointLocationsArguments>request.arguments).source);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'source':\n\t\t\t\t\tfixSourcePath(true, (<DebugProtocol.SourceArguments>request.arguments).source);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'gotoTargets':\n\t\t\t\t\tfixSourcePath(true, (<DebugProtocol.GotoTargetsArguments>request.arguments).source);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'launchVSCode':\n\t\t\t\t\trequest.arguments.args.forEach((arg: PathContainer | undefined) => fixSourcePath(false, arg));\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'response':\n\t\t\tconst response = <DebugProtocol.Response>msg;\n\t\t\tif (response.success && response.body) {\n\t\t\t\tswitch (response.command) {\n\t\t\t\t\tcase 'stackTrace':\n\t\t\t\t\t\t(<DebugProtocol.StackTraceResponse>response).body.stackFrames.forEach(frame => fixSourcePath(false, frame.source));\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'loadedSources':\n\t\t\t\t\t\t(<DebugProtocol.LoadedSourcesResponse>response).body.sources.forEach(source => fixSourcePath(false, source));\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'scopes':\n\t\t\t\t\t\t(<DebugProtocol.ScopesResponse>response).body.scopes.forEach(scope => fixSourcePath(false, scope.source));\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'setFunctionBreakpoints':\n\t\t\t\t\t\t(<DebugProtocol.SetFunctionBreakpointsResponse>response).body.breakpoints.forEach(bp => fixSourcePath(false, bp.source));\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'setBreakpoints':\n\t\t\t\t\t\t(<DebugProtocol.SetBreakpointsResponse>response).body.breakpoints.forEach(bp => fixSourcePath(false, bp.source));\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t}\n}\n\nexport function getVisibleAndSorted<T extends { presentation?: IConfigPresentation }>(array: T[]): T[] {\n\treturn array.filter(config => !config.presentation?.hidden).sort((first, second) => {\n\t\tif (!first.presentation) {\n\t\t\tif (!second.presentation) {\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\treturn 1;\n\t\t}\n\t\tif (!second.presentation) {\n\t\t\treturn -1;\n\t\t}\n\t\tif (!first.presentation.group) {\n\t\t\tif (!second.presentation.group) {\n\t\t\t\treturn compareOrders(first.presentation.order, second.presentation.order);\n\t\t\t}\n\t\t\treturn 1;\n\t\t}\n\t\tif (!second.presentation.group) {\n\t\t\treturn -1;\n\t\t}\n\t\tif (first.presentation.group !== second.presentation.group) {\n\t\t\treturn first.presentation.group.localeCompare(second.presentation.group);\n\t\t}\n\n\t\treturn compareOrders(first.presentation.order, second.presentation.order);\n\t});\n}\n\nfunction compareOrders(first: number | undefined, second: number | undefined): number {\n\tif (typeof first !== 'number') {\n\t\tif (typeof second !== 'number') {\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn 1;\n\t}\n\tif (typeof second !== 'number') {\n\t\treturn -1;\n\t}\n\n\treturn first - second;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { exists } from 'vs/base/node/pfs';\nimport * as cp from 'child_process';\nimport * as stream from 'stream';\nimport * as nls from 'vs/nls';\nimport * as net from 'net';\nimport * as path from 'vs/base/common/path';\nimport * as strings from 'vs/base/common/strings';\nimport * as objects from 'vs/base/common/objects';\nimport * as platform from 'vs/base/common/platform';\nimport { ExtensionsChannelId } from 'vs/platform/extensionManagement/common/extensionManagement';\nimport { IOutputService } from 'vs/workbench/contrib/output/common/output';\nimport { IDebugAdapterExecutable, IDebuggerContribution, IPlatformSpecificAdapterContribution, IDebugAdapterServer, IDebugAdapterNamedPipeServer } from 'vs/workbench/contrib/debug/common/debug';\nimport { IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { AbstractDebugAdapter } from '../common/abstractDebugAdapter';\n\n/**\n * An implementation that communicates via two streams with the debug adapter.\n */\nexport abstract class StreamDebugAdapter extends AbstractDebugAdapter {\n\n\tprivate static readonly TWO_CRLF = '\\r\\n\\r\\n';\n\tprivate static readonly HEADER_LINESEPARATOR = /\\r?\\n/;\t// allow for non-RFC 2822 conforming line separators\n\tprivate static readonly HEADER_FIELDSEPARATOR = /: */;\n\n\tprivate outputStream!: stream.Writable;\n\tprivate rawData = Buffer.allocUnsafe(0);\n\tprivate contentLength = -1;\n\n\tconstructor() {\n\t\tsuper();\n\t}\n\n\tprotected connect(readable: stream.Readable, writable: stream.Writable): void {\n\n\t\tthis.outputStream = writable;\n\t\tthis.rawData = Buffer.allocUnsafe(0);\n\t\tthis.contentLength = -1;\n\n\t\treadable.on('data', (data: Buffer) => this.handleData(data));\n\t}\n\n\tsendMessage(message: DebugProtocol.ProtocolMessage): void {\n\n\t\tif (this.outputStream) {\n\t\t\tconst json = JSON.stringify(message);\n\t\t\tthis.outputStream.write(`Content-Length: ${Buffer.byteLength(json, 'utf8')}${StreamDebugAdapter.TWO_CRLF}${json}`, 'utf8');\n\t\t}\n\t}\n\n\tprivate handleData(data: Buffer): void {\n\n\t\tthis.rawData = Buffer.concat([this.rawData, data]);\n\n\t\twhile (true) {\n\t\t\tif (this.contentLength >= 0) {\n\t\t\t\tif (this.rawData.length >= this.contentLength) {\n\t\t\t\t\tconst message = this.rawData.toString('utf8', 0, this.contentLength);\n\t\t\t\t\tthis.rawData = this.rawData.slice(this.contentLength);\n\t\t\t\t\tthis.contentLength = -1;\n\t\t\t\t\tif (message.length > 0) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tthis.acceptMessage(<DebugProtocol.ProtocolMessage>JSON.parse(message));\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tthis._onError.fire(new Error((e.message || e) + '\\n' + message));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tcontinue;\t// there may be more complete messages to process\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst idx = this.rawData.indexOf(StreamDebugAdapter.TWO_CRLF);\n\t\t\t\tif (idx !== -1) {\n\t\t\t\t\tconst header = this.rawData.toString('utf8', 0, idx);\n\t\t\t\t\tconst lines = header.split(StreamDebugAdapter.HEADER_LINESEPARATOR);\n\t\t\t\t\tfor (const h of lines) {\n\t\t\t\t\t\tconst kvPair = h.split(StreamDebugAdapter.HEADER_FIELDSEPARATOR);\n\t\t\t\t\t\tif (kvPair[0] === 'Content-Length') {\n\t\t\t\t\t\t\tthis.contentLength = Number(kvPair[1]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.rawData = this.rawData.slice(idx + StreamDebugAdapter.TWO_CRLF.length);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\nexport abstract class NetworkDebugAdapter extends StreamDebugAdapter {\n\n\tprotected socket?: net.Socket;\n\n\tprotected abstract createConnection(connectionListener: () => void): net.Socket;\n\n\tstartSession(): Promise<void> {\n\t\treturn new Promise<void>((resolve, reject) => {\n\t\t\tlet connected = false;\n\n\t\t\tthis.socket = this.createConnection(() => {\n\t\t\t\tthis.connect(this.socket!, this.socket!);\n\t\t\t\tresolve();\n\t\t\t\tconnected = true;\n\t\t\t});\n\n\t\t\tthis.socket.on('close', () => {\n\t\t\t\tif (connected) {\n\t\t\t\t\tthis._onError.fire(new Error('connection closed'));\n\t\t\t\t} else {\n\t\t\t\t\treject(new Error('connection closed'));\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.socket.on('error', error => {\n\t\t\t\tif (connected) {\n\t\t\t\t\tthis._onError.fire(error);\n\t\t\t\t} else {\n\t\t\t\t\treject(error);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tasync stopSession(): Promise<void> {\n\t\tawait this.cancelPendingRequests();\n\t\tif (this.socket) {\n\t\t\tthis.socket.end();\n\t\t\tthis.socket = undefined;\n\t\t}\n\t}\n}\n\n/**\n * An implementation that connects to a debug adapter via a socket.\n*/\nexport class SocketDebugAdapter extends NetworkDebugAdapter {\n\n\tconstructor(private adapterServer: IDebugAdapterServer) {\n\t\tsuper();\n\t}\n\n\tprotected createConnection(connectionListener: () => void): net.Socket {\n\t\treturn net.createConnection(this.adapterServer.port, this.adapterServer.host || '127.0.0.1', connectionListener);\n\t}\n}\n\n/**\n * An implementation that connects to a debug adapter via a NamedPipe (on Windows)/UNIX Domain Socket (on non-Windows).\n */\nexport class NamedPipeDebugAdapter extends NetworkDebugAdapter {\n\n\tconstructor(private adapterServer: IDebugAdapterNamedPipeServer) {\n\t\tsuper();\n\t}\n\n\tprotected createConnection(connectionListener: () => void): net.Socket {\n\t\treturn net.createConnection(this.adapterServer.path, connectionListener);\n\t}\n}\n\n/**\n * An implementation that launches the debug adapter as a separate process and communicates via stdin/stdout.\n*/\nexport class ExecutableDebugAdapter extends StreamDebugAdapter {\n\n\tprivate serverProcess: cp.ChildProcess | undefined;\n\n\tconstructor(private adapterExecutable: IDebugAdapterExecutable, private debugType: string, private readonly outputService?: IOutputService) {\n\t\tsuper();\n\t}\n\n\tasync startSession(): Promise<void> {\n\n\t\tconst command = this.adapterExecutable.command;\n\t\tconst args = this.adapterExecutable.args;\n\t\tconst options = this.adapterExecutable.options || {};\n\n\t\ttry {\n\t\t\t// verify executables asynchronously\n\t\t\tif (command) {\n\t\t\t\tif (path.isAbsolute(command)) {\n\t\t\t\t\tconst commandExists = await exists(command);\n\t\t\t\t\tif (!commandExists) {\n\t\t\t\t\t\tthrow new Error(nls.localize('debugAdapterBinNotFound', \"Debug adapter executable '{0}' does not exist.\", command));\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// relative path\n\t\t\t\t\tif (command.indexOf('/') < 0 && command.indexOf('\\\\') < 0) {\n\t\t\t\t\t\t// no separators: command looks like a runtime name like 'node' or 'mono'\n\t\t\t\t\t\t// TODO: check that the runtime is available on PATH\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthrow new Error(nls.localize({ key: 'debugAdapterCannotDetermineExecutable', comment: ['Adapter executable file not found'] },\n\t\t\t\t\t\"Cannot determine executable for debug adapter '{0}'.\", this.debugType));\n\t\t\t}\n\n\t\t\tlet env = process.env;\n\t\t\tif (options.env && Object.keys(options.env).length > 0) {\n\t\t\t\tenv = objects.mixin(objects.deepClone(process.env), options.env);\n\t\t\t}\n\n\t\t\tif (command === 'node') {\n\t\t\t\tif (Array.isArray(args) && args.length > 0) {\n\t\t\t\t\tconst isElectron = !!process.env['ELECTRON_RUN_AS_NODE'] || !!process.versions['electron'];\n\t\t\t\t\tconst forkOptions: cp.ForkOptions = {\n\t\t\t\t\t\tenv: env,\n\t\t\t\t\t\texecArgv: isElectron ? ['-e', 'delete process.env.ELECTRON_RUN_AS_NODE;require(process.argv[1])'] : [],\n\t\t\t\t\t\tsilent: true\n\t\t\t\t\t};\n\t\t\t\t\tif (options.cwd) {\n\t\t\t\t\t\tforkOptions.cwd = options.cwd;\n\t\t\t\t\t}\n\t\t\t\t\tconst child = cp.fork(args[0], args.slice(1), forkOptions);\n\t\t\t\t\tif (!child.pid) {\n\t\t\t\t\t\tthrow new Error(nls.localize('unableToLaunchDebugAdapter', \"Unable to launch debug adapter from '{0}'.\", args[0]));\n\t\t\t\t\t}\n\t\t\t\t\tthis.serverProcess = child;\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error(nls.localize('unableToLaunchDebugAdapterNoArgs', \"Unable to launch debug adapter.\"));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst spawnOptions: cp.SpawnOptions = {\n\t\t\t\t\tenv: env\n\t\t\t\t};\n\t\t\t\tif (options.cwd) {\n\t\t\t\t\tspawnOptions.cwd = options.cwd;\n\t\t\t\t}\n\t\t\t\tthis.serverProcess = cp.spawn(command, args, spawnOptions);\n\t\t\t}\n\n\t\t\tthis.serverProcess.on('error', err => {\n\t\t\t\tthis._onError.fire(err);\n\t\t\t});\n\t\t\tthis.serverProcess.on('exit', (code, signal) => {\n\t\t\t\tthis._onExit.fire(code);\n\t\t\t});\n\n\t\t\tthis.serverProcess.stdout!.on('close', () => {\n\t\t\t\tthis._onError.fire(new Error('read error'));\n\t\t\t});\n\t\t\tthis.serverProcess.stdout!.on('error', error => {\n\t\t\t\tthis._onError.fire(error);\n\t\t\t});\n\n\t\t\tthis.serverProcess.stdin!.on('error', error => {\n\t\t\t\tthis._onError.fire(error);\n\t\t\t});\n\n\t\t\tconst outputService = this.outputService;\n\t\t\tif (outputService) {\n\t\t\t\tconst sanitize = (s: string) => s.toString().replace(/\\r?\\n$/mg, '');\n\t\t\t\t// this.serverProcess.stdout.on('data', (data: string) => {\n\t\t\t\t// \tconsole.log('%c' + sanitize(data), 'background: #ddd; font-style: italic;');\n\t\t\t\t// });\n\t\t\t\tthis.serverProcess.stderr!.on('data', (data: string) => {\n\t\t\t\t\tconst channel = outputService.getChannel(ExtensionsChannelId);\n\t\t\t\t\tif (channel) {\n\t\t\t\t\t\tchannel.append(sanitize(data));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.serverProcess.stderr!.resume();\n\t\t\t}\n\n\t\t\t// finally connect to the DA\n\t\t\tthis.connect(this.serverProcess.stdout!, this.serverProcess.stdin!);\n\n\t\t} catch (err) {\n\t\t\tthis._onError.fire(err);\n\t\t}\n\t}\n\n\tasync stopSession(): Promise<void> {\n\n\t\tif (!this.serverProcess) {\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\n\t\t// when killing a process in windows its child\n\t\t// processes are *not* killed but become root\n\t\t// processes. Therefore we use TASKKILL.EXE\n\t\tawait this.cancelPendingRequests();\n\t\tif (platform.isWindows) {\n\t\t\treturn new Promise<void>((c, e) => {\n\t\t\t\tconst killer = cp.exec(`taskkill /F /T /PID ${this.serverProcess!.pid}`, function (err, stdout, stderr) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\treturn e(err);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tkiller.on('exit', c);\n\t\t\t\tkiller.on('error', e);\n\t\t\t});\n\t\t} else {\n\t\t\tthis.serverProcess.kill('SIGTERM');\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\t}\n\n\tprivate static extract(platformContribution: IPlatformSpecificAdapterContribution, extensionFolderPath: string): IDebuggerContribution | undefined {\n\t\tif (!platformContribution) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst result: IDebuggerContribution = Object.create(null);\n\t\tif (platformContribution.runtime) {\n\t\t\tif (platformContribution.runtime.indexOf('./') === 0) {\t// TODO\n\t\t\t\tresult.runtime = path.join(extensionFolderPath, platformContribution.runtime);\n\t\t\t} else {\n\t\t\t\tresult.runtime = platformContribution.runtime;\n\t\t\t}\n\t\t}\n\t\tif (platformContribution.runtimeArgs) {\n\t\t\tresult.runtimeArgs = platformContribution.runtimeArgs;\n\t\t}\n\t\tif (platformContribution.program) {\n\t\t\tif (!path.isAbsolute(platformContribution.program)) {\n\t\t\t\tresult.program = path.join(extensionFolderPath, platformContribution.program);\n\t\t\t} else {\n\t\t\t\tresult.program = platformContribution.program;\n\t\t\t}\n\t\t}\n\t\tif (platformContribution.args) {\n\t\t\tresult.args = platformContribution.args;\n\t\t}\n\n\t\tconst contribution = platformContribution as IDebuggerContribution;\n\n\t\tif (contribution.win) {\n\t\t\tresult.win = ExecutableDebugAdapter.extract(contribution.win, extensionFolderPath);\n\t\t}\n\t\tif (contribution.winx86) {\n\t\t\tresult.winx86 = ExecutableDebugAdapter.extract(contribution.winx86, extensionFolderPath);\n\t\t}\n\t\tif (contribution.windows) {\n\t\t\tresult.windows = ExecutableDebugAdapter.extract(contribution.windows, extensionFolderPath);\n\t\t}\n\t\tif (contribution.osx) {\n\t\t\tresult.osx = ExecutableDebugAdapter.extract(contribution.osx, extensionFolderPath);\n\t\t}\n\t\tif (contribution.linux) {\n\t\t\tresult.linux = ExecutableDebugAdapter.extract(contribution.linux, extensionFolderPath);\n\t\t}\n\t\treturn result;\n\t}\n\n\tstatic platformAdapterExecutable(extensionDescriptions: IExtensionDescription[], debugType: string): IDebugAdapterExecutable | undefined {\n\t\tlet result: IDebuggerContribution = Object.create(null);\n\t\tdebugType = debugType.toLowerCase();\n\n\t\t// merge all contributions into one\n\t\tfor (const ed of extensionDescriptions) {\n\t\t\tif (ed.contributes) {\n\t\t\t\tconst debuggers = <IDebuggerContribution[]>ed.contributes['debuggers'];\n\t\t\t\tif (debuggers && debuggers.length > 0) {\n\t\t\t\t\tdebuggers.filter(dbg => typeof dbg.type === 'string' && strings.equalsIgnoreCase(dbg.type, debugType)).forEach(dbg => {\n\t\t\t\t\t\t// extract relevant attributes and make them absolute where needed\n\t\t\t\t\t\tconst extractedDbg = ExecutableDebugAdapter.extract(dbg, ed.extensionLocation.fsPath);\n\n\t\t\t\t\t\t// merge\n\t\t\t\t\t\tresult = objects.mixin(result, extractedDbg, ed.isBuiltin);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// select the right platform\n\t\tlet platformInfo: IPlatformSpecificAdapterContribution | undefined;\n\t\tif (platform.isWindows && !process.env.hasOwnProperty('PROCESSOR_ARCHITEW6432')) {\n\t\t\tplatformInfo = result.winx86 || result.win || result.windows;\n\t\t} else if (platform.isWindows) {\n\t\t\tplatformInfo = result.win || result.windows;\n\t\t} else if (platform.isMacintosh) {\n\t\t\tplatformInfo = result.osx;\n\t\t} else if (platform.isLinux) {\n\t\t\tplatformInfo = result.linux;\n\t\t}\n\t\tplatformInfo = platformInfo || result;\n\n\t\t// these are the relevant attributes\n\t\tlet program = platformInfo.program || result.program;\n\t\tconst args = platformInfo.args || result.args;\n\t\tlet runtime = platformInfo.runtime || result.runtime;\n\t\tconst runtimeArgs = platformInfo.runtimeArgs || result.runtimeArgs;\n\n\t\tif (runtime) {\n\t\t\treturn {\n\t\t\t\ttype: 'executable',\n\t\t\t\tcommand: runtime,\n\t\t\t\targs: (runtimeArgs || []).concat(typeof program === 'string' ? [program] : []).concat(args || [])\n\t\t\t};\n\t\t} else if (program) {\n\t\t\treturn {\n\t\t\t\ttype: 'executable',\n\t\t\t\tcommand: program,\n\t\t\t\targs: args || []\n\t\t\t};\n\t\t}\n\n\t\t// nothing found\n\t\treturn undefined;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nexport const DEFAULT_TERMINAL_OSX = 'Terminal.app';\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as cp from 'child_process';\nimport * as path from 'vs/base/common/path';\nimport * as processes from 'vs/base/node/processes';\nimport * as nls from 'vs/nls';\nimport * as pfs from 'vs/base/node/pfs';\nimport * as env from 'vs/base/common/platform';\nimport { IExternalTerminalService, IExternalTerminalConfiguration, IExternalTerminalSettings } from 'vs/workbench/contrib/externalTerminal/common/externalTerminal';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { optional } from 'vs/platform/instantiation/common/instantiation';\nimport { DEFAULT_TERMINAL_OSX } from 'vs/workbench/contrib/externalTerminal/node/externalTerminal';\nimport { FileAccess } from 'vs/base/common/network';\n\nconst TERMINAL_TITLE = nls.localize('console.title', \"VS Code Console\");\n\nexport class WindowsExternalTerminalService implements IExternalTerminalService {\n\tpublic _serviceBrand: undefined;\n\n\tprivate static readonly CMD = 'cmd.exe';\n\n\tconstructor(\n\t\t@optional(IConfigurationService) private readonly _configurationService: IConfigurationService\n\t) {\n\t}\n\n\tpublic openTerminal(cwd?: string): void {\n\t\tif (this._configurationService) {\n\t\t\tconst configuration = this._configurationService.getValue<IExternalTerminalConfiguration>();\n\t\t\tthis.spawnTerminal(cp, configuration, processes.getWindowsShell(), cwd);\n\t\t}\n\t}\n\n\tpublic runInTerminal(title: string, dir: string, args: string[], envVars: env.IProcessEnvironment, settings: IExternalTerminalSettings): Promise<number | undefined> {\n\n\t\tconst exec = settings.windowsExec || WindowsExternalTerminalService.getDefaultTerminalWindows();\n\n\t\treturn new Promise<number | undefined>((resolve, reject) => {\n\n\t\t\tconst title = `\"${dir} - ${TERMINAL_TITLE}\"`;\n\t\t\tconst command = `\"\"${args.join('\" \"')}\" & pause\"`; // use '|' to only pause on non-zero exit code\n\n\t\t\tconst cmdArgs = [\n\t\t\t\t'/c', 'start', title, '/wait', exec, '/c', command\n\t\t\t];\n\n\t\t\t// merge environment variables into a copy of the process.env\n\t\t\tconst env = Object.assign({}, process.env, envVars);\n\n\t\t\t// delete environment variables that have a null value\n\t\t\tObject.keys(env).filter(v => env[v] === null).forEach(key => delete env[key]);\n\n\t\t\tconst options: any = {\n\t\t\t\tcwd: dir,\n\t\t\t\tenv: env,\n\t\t\t\twindowsVerbatimArguments: true\n\t\t\t};\n\n\t\t\tconst cmd = cp.spawn(WindowsExternalTerminalService.CMD, cmdArgs, options);\n\t\t\tcmd.on('error', err => {\n\t\t\t\treject(improveError(err));\n\t\t\t});\n\n\t\t\tresolve(undefined);\n\t\t});\n\t}\n\n\tprivate spawnTerminal(spawner: typeof cp, configuration: IExternalTerminalConfiguration, command: string, cwd?: string): Promise<void> {\n\t\tconst terminalConfig = configuration.terminal.external;\n\t\tconst exec = terminalConfig.windowsExec || WindowsExternalTerminalService.getDefaultTerminalWindows();\n\n\t\t// Make the drive letter uppercase on Windows (see #9448)\n\t\tif (cwd && cwd[1] === ':') {\n\t\t\tcwd = cwd[0].toUpperCase() + cwd.substr(1);\n\t\t}\n\n\t\t// cmder ignores the environment cwd and instead opts to always open in %USERPROFILE%\n\t\t// unless otherwise specified\n\t\tconst basename = path.basename(exec).toLowerCase();\n\t\tif (basename === 'cmder' || basename === 'cmder.exe') {\n\t\t\tspawner.spawn(exec, cwd ? [cwd] : undefined);\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\n\t\tconst cmdArgs = ['/c', 'start', '/wait'];\n\t\tif (exec.indexOf(' ') >= 0) {\n\t\t\t// The \"\" argument is the window title. Without this, exec doesn't work when the path\n\t\t\t// contains spaces\n\t\t\tcmdArgs.push('\"\"');\n\t\t}\n\t\tcmdArgs.push(exec);\n\t\t// Add starting directory parameter for Windows Terminal (see #90734)\n\t\tif (basename === 'wt' || basename === 'wt.exe') {\n\t\t\tcmdArgs.push('-d .');\n\t\t}\n\n\t\treturn new Promise<void>((c, e) => {\n\t\t\tconst env = cwd ? { cwd: cwd } : undefined;\n\t\t\tconst child = spawner.spawn(command, cmdArgs, env);\n\t\t\tchild.on('error', e);\n\t\t\tchild.on('exit', () => c());\n\t\t});\n\t}\n\n\tprivate static _DEFAULT_TERMINAL_WINDOWS: string;\n\n\tpublic static getDefaultTerminalWindows(): string {\n\t\tif (!WindowsExternalTerminalService._DEFAULT_TERMINAL_WINDOWS) {\n\t\t\tconst isWoW64 = !!process.env.hasOwnProperty('PROCESSOR_ARCHITEW6432');\n\t\t\tWindowsExternalTerminalService._DEFAULT_TERMINAL_WINDOWS = `${process.env.windir ? process.env.windir : 'C:\\\\Windows'}\\\\${isWoW64 ? 'Sysnative' : 'System32'}\\\\cmd.exe`;\n\t\t}\n\t\treturn WindowsExternalTerminalService._DEFAULT_TERMINAL_WINDOWS;\n\t}\n}\n\nexport class MacExternalTerminalService implements IExternalTerminalService {\n\tpublic _serviceBrand: undefined;\n\n\tprivate static readonly OSASCRIPT = '/usr/bin/osascript';\t// osascript is the AppleScript interpreter on OS X\n\n\tconstructor(\n\t\t@optional(IConfigurationService) private readonly _configurationService: IConfigurationService\n\t) { }\n\n\tpublic openTerminal(cwd?: string): void {\n\t\tif (this._configurationService) {\n\t\t\tconst configuration = this._configurationService.getValue<IExternalTerminalConfiguration>();\n\t\t\tthis.spawnTerminal(cp, configuration, cwd);\n\t\t}\n\t}\n\n\tpublic runInTerminal(title: string, dir: string, args: string[], envVars: env.IProcessEnvironment, settings: IExternalTerminalSettings): Promise<number | undefined> {\n\n\t\tconst terminalApp = settings.osxExec || DEFAULT_TERMINAL_OSX;\n\n\t\treturn new Promise<number | undefined>((resolve, reject) => {\n\n\t\t\tif (terminalApp === DEFAULT_TERMINAL_OSX || terminalApp === 'iTerm.app') {\n\n\t\t\t\t// On OS X we launch an AppleScript that creates (or reuses) a Terminal window\n\t\t\t\t// and then launches the program inside that window.\n\n\t\t\t\tconst script = terminalApp === DEFAULT_TERMINAL_OSX ? 'TerminalHelper' : 'iTermHelper';\n\t\t\t\tconst scriptpath = FileAccess.asFileUri(`vs/workbench/contrib/externalTerminal/node/${script}.scpt`, require).fsPath;\n\n\t\t\t\tconst osaArgs = [\n\t\t\t\t\tscriptpath,\n\t\t\t\t\t'-t', title || TERMINAL_TITLE,\n\t\t\t\t\t'-w', dir,\n\t\t\t\t];\n\n\t\t\t\tfor (let a of args) {\n\t\t\t\t\tosaArgs.push('-a');\n\t\t\t\t\tosaArgs.push(a);\n\t\t\t\t}\n\n\t\t\t\tif (envVars) {\n\t\t\t\t\tfor (let key in envVars) {\n\t\t\t\t\t\tconst value = envVars[key];\n\t\t\t\t\t\tif (value === null) {\n\t\t\t\t\t\t\tosaArgs.push('-u');\n\t\t\t\t\t\t\tosaArgs.push(key);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tosaArgs.push('-e');\n\t\t\t\t\t\t\tosaArgs.push(`${key}=${value}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlet stderr = '';\n\t\t\t\tconst osa = cp.spawn(MacExternalTerminalService.OSASCRIPT, osaArgs);\n\t\t\t\tosa.on('error', err => {\n\t\t\t\t\treject(improveError(err));\n\t\t\t\t});\n\t\t\t\tosa.stderr.on('data', (data) => {\n\t\t\t\t\tstderr += data.toString();\n\t\t\t\t});\n\t\t\t\tosa.on('exit', (code: number) => {\n\t\t\t\t\tif (code === 0) {\t// OK\n\t\t\t\t\t\tresolve(undefined);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (stderr) {\n\t\t\t\t\t\t\tconst lines = stderr.split('\\n', 1);\n\t\t\t\t\t\t\treject(new Error(lines[0]));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treject(new Error(nls.localize('mac.terminal.script.failed', \"Script '{0}' failed with exit code {1}\", script, code)));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treject(new Error(nls.localize('mac.terminal.type.not.supported', \"'{0}' not supported\", terminalApp)));\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate spawnTerminal(spawner: typeof cp, configuration: IExternalTerminalConfiguration, cwd?: string): Promise<void> {\n\t\tconst terminalConfig = configuration.terminal.external;\n\t\tconst terminalApp = terminalConfig.osxExec || DEFAULT_TERMINAL_OSX;\n\n\t\treturn new Promise<void>((c, e) => {\n\t\t\tconst args = ['-a', terminalApp];\n\t\t\tif (cwd) {\n\t\t\t\targs.push(cwd);\n\t\t\t}\n\t\t\tconst child = spawner.spawn('/usr/bin/open', args);\n\t\t\tchild.on('error', e);\n\t\t\tchild.on('exit', () => c());\n\t\t});\n\t}\n}\n\nexport class LinuxExternalTerminalService implements IExternalTerminalService {\n\tpublic _serviceBrand: undefined;\n\n\tprivate static readonly WAIT_MESSAGE = nls.localize('press.any.key', \"Press any key to continue...\");\n\n\tconstructor(\n\t\t@optional(IConfigurationService) private readonly _configurationService: IConfigurationService\n\t) { }\n\n\tpublic openTerminal(cwd?: string): void {\n\t\tif (this._configurationService) {\n\t\t\tconst configuration = this._configurationService.getValue<IExternalTerminalConfiguration>();\n\t\t\tthis.spawnTerminal(cp, configuration, cwd);\n\t\t}\n\t}\n\n\tpublic runInTerminal(title: string, dir: string, args: string[], envVars: env.IProcessEnvironment, settings: IExternalTerminalSettings): Promise<number | undefined> {\n\n\t\tconst execPromise = settings.linuxExec ? Promise.resolve(settings.linuxExec) : LinuxExternalTerminalService.getDefaultTerminalLinuxReady();\n\n\t\treturn new Promise<number | undefined>((resolve, reject) => {\n\n\t\t\tlet termArgs: string[] = [];\n\t\t\t//termArgs.push('--title');\n\t\t\t//termArgs.push(`\"${TERMINAL_TITLE}\"`);\n\t\t\texecPromise.then(exec => {\n\t\t\t\tif (exec.indexOf('gnome-terminal') >= 0) {\n\t\t\t\t\ttermArgs.push('-x');\n\t\t\t\t} else {\n\t\t\t\t\ttermArgs.push('-e');\n\t\t\t\t}\n\t\t\t\ttermArgs.push('bash');\n\t\t\t\ttermArgs.push('-c');\n\n\t\t\t\tconst bashCommand = `${quote(args)}; echo; read -p \"${LinuxExternalTerminalService.WAIT_MESSAGE}\" -n1;`;\n\t\t\t\ttermArgs.push(`''${bashCommand}''`);\t// wrapping argument in two sets of ' because node is so \"friendly\" that it removes one set...\n\n\t\t\t\t// merge environment variables into a copy of the process.env\n\t\t\t\tconst env = Object.assign({}, process.env, envVars);\n\n\t\t\t\t// delete environment variables that have a null value\n\t\t\t\tObject.keys(env).filter(v => env[v] === null).forEach(key => delete env[key]);\n\n\t\t\t\tconst options: any = {\n\t\t\t\t\tcwd: dir,\n\t\t\t\t\tenv: env\n\t\t\t\t};\n\n\t\t\t\tlet stderr = '';\n\t\t\t\tconst cmd = cp.spawn(exec, termArgs, options);\n\t\t\t\tcmd.on('error', err => {\n\t\t\t\t\treject(improveError(err));\n\t\t\t\t});\n\t\t\t\tcmd.stderr.on('data', (data) => {\n\t\t\t\t\tstderr += data.toString();\n\t\t\t\t});\n\t\t\t\tcmd.on('exit', (code: number) => {\n\t\t\t\t\tif (code === 0) {\t// OK\n\t\t\t\t\t\tresolve(undefined);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (stderr) {\n\t\t\t\t\t\t\tconst lines = stderr.split('\\n', 1);\n\t\t\t\t\t\t\treject(new Error(lines[0]));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treject(new Error(nls.localize('linux.term.failed', \"'{0}' failed with exit code {1}\", exec, code)));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tprivate spawnTerminal(spawner: typeof cp, configuration: IExternalTerminalConfiguration, cwd?: string): Promise<void> {\n\t\tconst terminalConfig = configuration.terminal.external;\n\t\tconst execPromise = terminalConfig.linuxExec ? Promise.resolve(terminalConfig.linuxExec) : LinuxExternalTerminalService.getDefaultTerminalLinuxReady();\n\n\t\treturn new Promise<void>((c, e) => {\n\t\t\texecPromise.then(exec => {\n\t\t\t\tconst env = cwd ? { cwd } : undefined;\n\t\t\t\tconst child = spawner.spawn(exec, [], env);\n\t\t\t\tchild.on('error', e);\n\t\t\t\tchild.on('exit', () => c());\n\t\t\t});\n\t\t});\n\t}\n\n\tprivate static _DEFAULT_TERMINAL_LINUX_READY: Promise<string>;\n\n\tpublic static async getDefaultTerminalLinuxReady(): Promise<string> {\n\t\tif (!LinuxExternalTerminalService._DEFAULT_TERMINAL_LINUX_READY) {\n\t\t\tLinuxExternalTerminalService._DEFAULT_TERMINAL_LINUX_READY = new Promise(async r => {\n\t\t\t\tif (env.isLinux) {\n\t\t\t\t\tconst isDebian = await pfs.exists('/etc/debian_version');\n\t\t\t\t\tif (isDebian) {\n\t\t\t\t\t\tr('x-terminal-emulator');\n\t\t\t\t\t} else if (process.env.DESKTOP_SESSION === 'gnome' || process.env.DESKTOP_SESSION === 'gnome-classic') {\n\t\t\t\t\t\tr('gnome-terminal');\n\t\t\t\t\t} else if (process.env.DESKTOP_SESSION === 'kde-plasma') {\n\t\t\t\t\t\tr('konsole');\n\t\t\t\t\t} else if (process.env.COLORTERM) {\n\t\t\t\t\t\tr(process.env.COLORTERM);\n\t\t\t\t\t} else if (process.env.TERM) {\n\t\t\t\t\t\tr(process.env.TERM);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tr('xterm');\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tr('xterm');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn LinuxExternalTerminalService._DEFAULT_TERMINAL_LINUX_READY;\n\t}\n}\n\n/**\n * tries to turn OS errors into more meaningful error messages\n */\nfunction improveError(err: Error): Error {\n\tif ('errno' in err && err['errno'] === 'ENOENT' && 'path' in err && typeof err['path'] === 'string') {\n\t\treturn new Error(nls.localize('ext.term.app.not.found', \"can't find terminal application '{0}'\", err['path']));\n\t}\n\treturn err;\n}\n\n/**\n * Quote args if necessary and combine into a space separated string.\n */\nfunction quote(args: string[]): string {\n\tlet r = '';\n\tfor (let a of args) {\n\t\tif (a.indexOf(' ') >= 0) {\n\t\t\tr += '\"' + a + '\"';\n\t\t} else {\n\t\t\tr += a;\n\t\t}\n\t\tr += ' ';\n\t}\n\treturn r;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as cp from 'child_process';\nimport * as platform from 'vs/base/common/platform';\nimport { WindowsExternalTerminalService, MacExternalTerminalService, LinuxExternalTerminalService } from 'vs/workbench/contrib/externalTerminal/node/externalTerminalService';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { IExternalTerminalService } from 'vs/workbench/contrib/externalTerminal/common/externalTerminal';\nimport { ExtHostConfigProvider } from 'vs/workbench/api/common/extHostConfiguration';\nimport { getDriveLetter } from 'vs/base/common/extpath';\n\nlet externalTerminalService: IExternalTerminalService | undefined = undefined;\n\nexport function runInExternalTerminal(args: DebugProtocol.RunInTerminalRequestArguments, configProvider: ExtHostConfigProvider): Promise<number | undefined> {\n\tif (!externalTerminalService) {\n\t\tif (platform.isWindows) {\n\t\t\texternalTerminalService = new WindowsExternalTerminalService(<IConfigurationService><unknown>undefined);\n\t\t} else if (platform.isMacintosh) {\n\t\t\texternalTerminalService = new MacExternalTerminalService(<IConfigurationService><unknown>undefined);\n\t\t} else if (platform.isLinux) {\n\t\t\texternalTerminalService = new LinuxExternalTerminalService(<IConfigurationService><unknown>undefined);\n\t\t} else {\n\t\t\tthrow new Error('external terminals not supported on this platform');\n\t\t}\n\t}\n\tconst config = configProvider.getConfiguration('terminal');\n\treturn externalTerminalService.runInTerminal(args.title!, args.cwd, args.args, args.env || {}, config.external || {});\n}\n\nfunction spawnAsPromised(command: string, args: string[]): Promise<string> {\n\treturn new Promise((resolve, reject) => {\n\t\tlet stdout = '';\n\t\tconst child = cp.spawn(command, args);\n\t\tif (child.pid) {\n\t\t\tchild.stdout.on('data', (data: Buffer) => {\n\t\t\t\tstdout += data.toString();\n\t\t\t});\n\t\t}\n\t\tchild.on('error', err => {\n\t\t\treject(err);\n\t\t});\n\t\tchild.on('close', code => {\n\t\t\tresolve(stdout);\n\t\t});\n\t});\n}\n\nexport function hasChildProcesses(processId: number | undefined): Promise<boolean> {\n\tif (processId) {\n\t\t// if shell has at least one child process, assume that shell is busy\n\t\tif (platform.isWindows) {\n\t\t\treturn spawnAsPromised('wmic', ['process', 'get', 'ParentProcessId']).then(stdout => {\n\t\t\t\tconst pids = stdout.split('\\r\\n');\n\t\t\t\treturn pids.some(p => parseInt(p) === processId);\n\t\t\t}, error => {\n\t\t\t\treturn true;\n\t\t\t});\n\t\t} else {\n\t\t\treturn spawnAsPromised('/usr/bin/pgrep', ['-lP', String(processId)]).then(stdout => {\n\t\t\t\tconst r = stdout.trim();\n\t\t\t\tif (r.length === 0 || r.indexOf(' tmux') >= 0) { // ignore 'tmux'; see #43683\n\t\t\t\t\treturn false;\n\t\t\t\t} else {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}, error => {\n\t\t\t\treturn true;\n\t\t\t});\n\t\t}\n\t}\n\t// fall back to safe side\n\treturn Promise.resolve(true);\n}\n\nconst enum ShellType { cmd, powershell, bash }\n\n\nexport function prepareCommand(shell: string, args: string[], cwd?: string, env?: { [key: string]: string | null; }): string {\n\n\tshell = shell.trim().toLowerCase();\n\n\t// try to determine the shell type\n\tlet shellType;\n\tif (shell.indexOf('powershell') >= 0 || shell.indexOf('pwsh') >= 0) {\n\t\tshellType = ShellType.powershell;\n\t} else if (shell.indexOf('cmd.exe') >= 0) {\n\t\tshellType = ShellType.cmd;\n\t} else if (shell.indexOf('bash') >= 0) {\n\t\tshellType = ShellType.bash;\n\t} else if (platform.isWindows) {\n\t\tshellType = ShellType.cmd; // pick a good default for Windows\n\t} else {\n\t\tshellType = ShellType.bash;\t// pick a good default for anything else\n\t}\n\n\tlet quote: (s: string) => string;\n\t// begin command with a space to avoid polluting shell history\n\tlet command = ' ';\n\n\tswitch (shellType) {\n\n\t\tcase ShellType.powershell:\n\n\t\t\tquote = (s: string) => {\n\t\t\t\ts = s.replace(/\\'/g, '\\'\\'');\n\t\t\t\tif (s.length > 0 && s.charAt(s.length - 1) === '\\\\') {\n\t\t\t\t\treturn `'${s}\\\\'`;\n\t\t\t\t}\n\t\t\t\treturn `'${s}'`;\n\t\t\t};\n\n\t\t\tif (cwd) {\n\t\t\t\tconst driveLetter = getDriveLetter(cwd);\n\t\t\t\tif (driveLetter) {\n\t\t\t\t\tcommand += `${driveLetter}:; `;\n\t\t\t\t}\n\t\t\t\tcommand += `cd ${quote(cwd)}; `;\n\t\t\t}\n\t\t\tif (env) {\n\t\t\t\tfor (let key in env) {\n\t\t\t\t\tconst value = env[key];\n\t\t\t\t\tif (value === null) {\n\t\t\t\t\t\tcommand += `Remove-Item env:${key}; `;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcommand += `\\${env:${key}}='${value}'; `;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (args.length > 0) {\n\t\t\t\tconst cmd = quote(args.shift()!);\n\t\t\t\tcommand += (cmd[0] === '\\'') ? `& ${cmd} ` : `${cmd} `;\n\t\t\t\tfor (let a of args) {\n\t\t\t\t\tcommand += `${quote(a)} `;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase ShellType.cmd:\n\n\t\t\tquote = (s: string) => {\n\t\t\t\ts = s.replace(/\\\"/g, '\"\"');\n\t\t\t\treturn (s.indexOf(' ') >= 0 || s.indexOf('\"') >= 0 || s.length === 0) ? `\"${s}\"` : s;\n\t\t\t};\n\n\t\t\tif (cwd) {\n\t\t\t\tconst driveLetter = getDriveLetter(cwd);\n\t\t\t\tif (driveLetter) {\n\t\t\t\t\tcommand += `${driveLetter}: && `;\n\t\t\t\t}\n\t\t\t\tcommand += `cd ${quote(cwd)} && `;\n\t\t\t}\n\t\t\tif (env) {\n\t\t\t\tcommand += 'cmd /C \"';\n\t\t\t\tfor (let key in env) {\n\t\t\t\t\tlet value = env[key];\n\t\t\t\t\tif (value === null) {\n\t\t\t\t\t\tcommand += `set \"${key}=\" && `;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvalue = value.replace(/[\\^\\&\\|\\<\\>]/g, s => `^${s}`);\n\t\t\t\t\t\tcommand += `set \"${key}=${value}\" && `;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (let a of args) {\n\t\t\t\tcommand += `${quote(a)} `;\n\t\t\t}\n\t\t\tif (env) {\n\t\t\t\tcommand += '\"';\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase ShellType.bash:\n\n\t\t\tquote = (s: string) => {\n\t\t\t\ts = s.replace(/([\"'\\\\\\$])/g, '\\\\$1');\n\t\t\t\treturn (s.indexOf(' ') >= 0 || s.indexOf(';') >= 0 || s.length === 0) ? `\"${s}\"` : s;\n\t\t\t};\n\n\t\t\tconst hardQuote = (s: string) => {\n\t\t\t\treturn /[^\\w@%\\/+=,.:^-]/.test(s) ? `'${s.replace(/'/g, '\\'\\\\\\'\\'')}'` : s;\n\t\t\t};\n\n\t\t\tif (cwd) {\n\t\t\t\tcommand += `cd ${quote(cwd)} ; `;\n\t\t\t}\n\t\t\tif (env) {\n\t\t\t\tcommand += '/usr/bin/env';\n\t\t\t\tfor (let key in env) {\n\t\t\t\t\tconst value = env[key];\n\t\t\t\t\tif (value === null) {\n\t\t\t\t\t\tcommand += ` -u ${hardQuote(key)}`;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcommand += ` ${hardQuote(`${key}=${value}`)}`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcommand += ' ';\n\t\t\t}\n\t\t\tfor (let a of args) {\n\t\t\t\tcommand += `${quote(a)} `;\n\t\t\t}\n\t\t\tbreak;\n\t}\n\n\treturn command;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { IDiffResult, ISequence } from 'vs/base/common/diff/diff';\nimport { Event } from 'vs/base/common/event';\nimport * as glob from 'vs/base/common/glob';\nimport * as UUID from 'vs/base/common/uuid';\nimport { Schemas } from 'vs/base/common/network';\nimport { basename } from 'vs/base/common/path';\nimport { isWindows } from 'vs/base/common/platform';\nimport { ISplice } from 'vs/base/common/sequence';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport * as editorCommon from 'vs/editor/common/editorCommon';\nimport { Command } from 'vs/editor/common/modes';\nimport { IAccessibilityInformation } from 'vs/platform/accessibility/common/accessibility';\nimport { RawContextKey } from 'vs/platform/contextkey/common/contextkey';\nimport { IEditorModel } from 'vs/platform/editor/common/editor';\nimport { ExtensionIdentifier } from 'vs/platform/extensions/common/extensions';\nimport { IRevertOptions } from 'vs/workbench/common/editor';\nimport { NotebookTextModel } from 'vs/workbench/contrib/notebook/common/model/notebookTextModel';\nimport { IDisposable } from 'vs/base/common/lifecycle';\nimport { IFileStatWithMetadata } from 'vs/platform/files/common/files';\nimport { ThemeColor } from 'vs/platform/theme/common/themeService';\n\nexport enum CellKind {\n\tMarkdown = 1,\n\tCode = 2\n}\n\nexport enum CellOutputKind {\n\tText = 1,\n\tError = 2,\n\tRich = 3\n}\n\nexport const NOTEBOOK_DISPLAY_ORDER = [\n\t'application/json',\n\t'application/javascript',\n\t'text/html',\n\t'image/svg+xml',\n\t'text/markdown',\n\t'image/png',\n\t'image/jpeg',\n\t'text/plain'\n];\n\nexport const ACCESSIBLE_NOTEBOOK_DISPLAY_ORDER = [\n\t'text/markdown',\n\t'application/json',\n\t'text/plain',\n\t'text/html',\n\t'image/svg+xml',\n\t'image/png',\n\t'image/jpeg',\n];\n\nexport const BUILTIN_RENDERER_ID = '_builtin';\nexport const RENDERER_NOT_AVAILABLE = '_notAvailable';\n\nexport enum NotebookRunState {\n\tRunning = 1,\n\tIdle = 2\n}\n\nexport const notebookDocumentMetadataDefaults: Required<NotebookDocumentMetadata> = {\n\teditable: true,\n\trunnable: true,\n\tcellEditable: true,\n\tcellRunnable: true,\n\tcellHasExecutionOrder: true,\n\tdisplayOrder: NOTEBOOK_DISPLAY_ORDER,\n\tcustom: {},\n\trunState: NotebookRunState.Idle,\n\tlanguages: [],\n\ttrusted: true\n};\n\nexport interface NotebookDocumentMetadata {\n\teditable: boolean;\n\trunnable: boolean;\n\tcellEditable: boolean;\n\tcellRunnable: boolean;\n\tcellHasExecutionOrder: boolean;\n\tdisplayOrder?: (string | glob.IRelativePattern)[];\n\tcustom?: { [key: string]: unknown };\n\trunState?: NotebookRunState;\n\tlanguages: string[];\n\ttrusted: boolean;\n}\n\nexport enum NotebookCellRunState {\n\tRunning = 1,\n\tIdle = 2,\n\tSuccess = 3,\n\tError = 4\n}\n\nexport interface NotebookCellMetadata {\n\teditable?: boolean;\n\trunnable?: boolean;\n\tbreakpointMargin?: boolean;\n\thasExecutionOrder?: boolean;\n\texecutionOrder?: number;\n\tstatusMessage?: string;\n\trunState?: NotebookCellRunState;\n\trunStartTime?: number;\n\tlastRunDuration?: number;\n\tinputCollapsed?: boolean;\n\toutputCollapsed?: boolean;\n\tcustom?: { [key: string]: unknown };\n}\n\nexport type TransientMetadata = { [K in keyof NotebookCellMetadata]?: boolean };\n\nexport interface TransientOptions {\n\ttransientOutputs: boolean;\n\ttransientMetadata: TransientMetadata;\n}\n\nexport interface INotebookDisplayOrder {\n\tdefaultOrder: string[];\n\tuserOrder?: string[];\n}\n\nexport interface INotebookMimeTypeSelector {\n\tmimeTypes?: string[];\n}\n\nexport interface INotebookRendererInfo {\n\tid: string;\n\tdisplayName: string;\n\tentrypoint: URI;\n\tpreloads: ReadonlyArray<URI>;\n\textensionLocation: URI;\n\textensionId: ExtensionIdentifier;\n\n\tmatches(mimeType: string): boolean;\n}\n\nexport interface IStreamOutput {\n\toutputKind: CellOutputKind.Text;\n\ttext: string;\n}\n\nexport interface IErrorOutput {\n\toutputKind: CellOutputKind.Error;\n\t/**\n\t * Exception Name\n\t */\n\tename: string;\n\t/**\n\t * Exception Value\n\t */\n\tevalue: string;\n\t/**\n\t * Exception call stacks\n\t */\n\ttraceback: string[];\n}\n\nexport interface NotebookCellOutputMetadata {\n\t/**\n\t * Additional attributes of a cell metadata.\n\t */\n\tcustom?: { [key: string]: unknown };\n}\n\nexport interface IDisplayOutput {\n\toutputKind: CellOutputKind.Rich;\n\t/**\n\t * { mime_type: value }\n\t */\n\tdata: { [key: string]: unknown; }\n\n\tmetadata?: NotebookCellOutputMetadata;\n}\n\nexport enum MimeTypeRendererResolver {\n\tCore,\n\tActive,\n\tLazy\n}\n\nexport interface IOrderedMimeType {\n\tmimeType: string;\n\trendererId: string;\n\tisTrusted: boolean;\n}\n\nexport interface ITransformedDisplayOutputDto extends IDisplayOutput {\n\toutputId: string;\n}\n\nexport function isTransformedDisplayOutput(thing: unknown): thing is ITransformedDisplayOutputDto {\n\treturn (thing as ITransformedDisplayOutputDto).outputKind === CellOutputKind.Rich && !!(thing as ITransformedDisplayOutputDto).outputId;\n}\n\n\nexport const addIdToOutput = (output: IRawOutput, id = UUID.generateUuid()): IProcessedOutput => output.outputKind === CellOutputKind.Rich\n\t? ({ ...output, outputId: id }) : output;\n\n\nexport type IProcessedOutput = ITransformedDisplayOutputDto | IStreamOutput | IErrorOutput;\n\nexport type IRawOutput = IDisplayOutput | IStreamOutput | IErrorOutput;\n\nexport interface IOutputRenderRequestOutputInfo {\n\tindex: number;\n\toutputId: string;\n\thandlerId: string;\n\tmimeType: string;\n\toutput?: IRawOutput;\n}\n\nexport interface IOutputRenderRequestCellInfo<T> {\n\tkey: T;\n\toutputs: IOutputRenderRequestOutputInfo[];\n}\n\nexport interface IOutputRenderRequest<T> {\n\titems: IOutputRenderRequestCellInfo<T>[];\n}\n\nexport interface IOutputRenderResponseOutputInfo {\n\tindex: number;\n\toutputId: string;\n\tmimeType: string;\n\thandlerId: string;\n\ttransformedOutput: string;\n}\n\nexport interface IOutputRenderResponseCellInfo<T> {\n\tkey: T;\n\toutputs: IOutputRenderResponseOutputInfo[];\n}\n\n\nexport interface IOutputRenderResponse<T> {\n\titems: IOutputRenderResponseCellInfo<T>[];\n}\n\n\nexport interface ICell {\n\treadonly uri: URI;\n\thandle: number;\n\tlanguage: string;\n\tcellKind: CellKind;\n\toutputs: IProcessedOutput[];\n\tmetadata?: NotebookCellMetadata;\n\tonDidChangeOutputs?: Event<NotebookCellOutputsSplice[]>;\n\tonDidChangeLanguage: Event<string>;\n\tonDidChangeMetadata: Event<void>;\n}\n\nexport interface LanguageInfo {\n\tfile_extension: string;\n}\n\nexport interface IMetadata {\n\tlanguage_info: LanguageInfo;\n}\n\nexport interface INotebookTextModel {\n\treadonly viewType: string;\n\tmetadata: NotebookDocumentMetadata\n\treadonly uri: URI;\n\treadonly versionId: number;\n\tlanguages: string[];\n\treadonly cells: readonly ICell[];\n\tonWillDispose(listener: () => void): IDisposable;\n}\n\nexport type NotebookCellTextModelSplice<T> = [\n\tnumber /* start */,\n\tnumber,\n\tT[]\n];\n\nexport type NotebookCellOutputsSplice = [\n\tnumber /* start */,\n\tnumber /* delete count */,\n\tIProcessedOutput[]\n];\n\nexport interface IMainCellDto {\n\thandle: number;\n\turi: UriComponents,\n\tsource: string[];\n\teol: string;\n\tlanguage: string;\n\tcellKind: CellKind;\n\toutputs: IProcessedOutput[];\n\tmetadata?: NotebookCellMetadata;\n}\n\nexport type NotebookCellsSplice2 = [\n\tnumber /* start */,\n\tnumber /* delete count */,\n\tIMainCellDto[]\n];\n\nexport enum NotebookCellsChangeType {\n\tModelChange = 1,\n\tMove = 2,\n\tCellClearOutput = 3,\n\tCellsClearOutput = 4,\n\tChangeLanguage = 5,\n\tInitialize = 6,\n\tChangeCellMetadata = 7,\n\tOutput = 8,\n\tChangeCellContent = 9,\n\tChangeDocumentMetadata = 10,\n\tUnknown = 11\n}\n\nexport interface NotebookCellsInitializeEvent<T> {\n\treadonly kind: NotebookCellsChangeType.Initialize;\n\treadonly changes: NotebookCellTextModelSplice<T>[];\n}\n\nexport interface NotebookCellContentChangeEvent {\n\treadonly kind: NotebookCellsChangeType.ChangeCellContent;\n}\n\nexport interface NotebookCellsModelChangedEvent<T> {\n\treadonly kind: NotebookCellsChangeType.ModelChange;\n\treadonly changes: NotebookCellTextModelSplice<T>[];\n}\n\nexport interface NotebookCellsModelMoveEvent<T> {\n\treadonly kind: NotebookCellsChangeType.Move;\n\treadonly index: number;\n\treadonly length: number;\n\treadonly newIdx: number;\n\treadonly cells: T[];\n}\n\nexport interface NotebookOutputChangedEvent {\n\treadonly kind: NotebookCellsChangeType.Output;\n\treadonly index: number;\n\treadonly outputs: IProcessedOutput[];\n}\n\nexport interface NotebookCellsChangeLanguageEvent {\n\treadonly kind: NotebookCellsChangeType.ChangeLanguage;\n\treadonly index: number;\n\treadonly language: string;\n}\n\nexport interface NotebookCellsChangeMetadataEvent {\n\treadonly kind: NotebookCellsChangeType.ChangeCellMetadata;\n\treadonly index: number;\n\treadonly metadata: NotebookCellMetadata | undefined;\n}\n\nexport interface NotebookDocumentChangeMetadataEvent {\n\treadonly kind: NotebookCellsChangeType.ChangeDocumentMetadata;\n\treadonly metadata: NotebookDocumentMetadata | undefined;\n}\n\nexport interface NotebookDocumentUnknownChangeEvent {\n\treadonly kind: NotebookCellsChangeType.Unknown;\n}\n\nexport type NotebookRawContentEventDto = NotebookCellsInitializeEvent<IMainCellDto> | NotebookDocumentChangeMetadataEvent | NotebookCellContentChangeEvent | NotebookCellsModelChangedEvent<IMainCellDto> | NotebookCellsModelMoveEvent<IMainCellDto> | NotebookOutputChangedEvent | NotebookCellsChangeLanguageEvent | NotebookCellsChangeMetadataEvent | NotebookDocumentUnknownChangeEvent;\n\nexport type NotebookCellsChangedEventDto = {\n\treadonly rawEvents: NotebookRawContentEventDto[];\n\treadonly versionId: number;\n};\n\nexport type NotebookRawContentEvent = (NotebookCellsInitializeEvent<ICell> | NotebookDocumentChangeMetadataEvent | NotebookCellContentChangeEvent | NotebookCellsModelChangedEvent<ICell> | NotebookCellsModelMoveEvent<ICell> | NotebookOutputChangedEvent | NotebookCellsChangeLanguageEvent | NotebookCellsChangeMetadataEvent | NotebookDocumentUnknownChangeEvent) & { transient: boolean; };\nexport type NotebookTextModelChangedEvent = {\n\treadonly rawEvents: NotebookRawContentEvent[];\n\treadonly versionId: number;\n\treadonly synchronous: boolean;\n\treadonly endSelections?: number[];\n};\n\nexport const enum CellEditType {\n\tReplace = 1,\n\tOutput = 2,\n\tMetadata = 3,\n\tCellLanguage = 4,\n\tDocumentMetadata = 5,\n\tOutputsSplice = 6,\n\tMove = 7,\n\tUnknown = 8,\n\tCellContent = 9\n}\n\nexport interface ICellDto2 {\n\tsource: string;\n\tlanguage: string;\n\tcellKind: CellKind;\n\toutputs: IProcessedOutput[];\n\tmetadata?: NotebookCellMetadata;\n}\n\nexport interface ICellReplaceEdit {\n\teditType: CellEditType.Replace;\n\tindex: number;\n\tcount: number;\n\tcells: ICellDto2[];\n}\n\nexport interface ICellOutputEdit {\n\teditType: CellEditType.Output;\n\tindex: number;\n\toutputs: IProcessedOutput[];\n}\n\nexport interface ICellMetadataEdit {\n\teditType: CellEditType.Metadata;\n\tindex: number;\n\tmetadata: NotebookCellMetadata;\n}\n\n\nexport interface ICellLanguageEdit {\n\teditType: CellEditType.CellLanguage;\n\tindex: number;\n\tlanguage: string;\n}\n\nexport interface IDocumentMetadataEdit {\n\teditType: CellEditType.DocumentMetadata;\n\tmetadata: NotebookDocumentMetadata;\n}\n\nexport interface ICellOutputsSpliceEdit {\n\teditType: CellEditType.OutputsSplice;\n\tindex: number;\n\tsplices: NotebookCellOutputsSplice[];\n}\n\nexport interface ICellMoveEdit {\n\teditType: CellEditType.Move;\n\tindex: number;\n\tlength: number;\n\tnewIdx: number;\n}\n\nexport interface IDocumentUnknownEdit {\n\teditType: CellEditType.Unknown;\n}\n\nexport type ICellEditOperation = ICellReplaceEdit | ICellOutputEdit | ICellMetadataEdit | ICellLanguageEdit | IDocumentMetadataEdit | ICellOutputsSpliceEdit | ICellMoveEdit | IDocumentUnknownEdit;\n\nexport interface INotebookEditData {\n\tdocumentVersionId: number;\n\tcellEdits: ICellEditOperation[];\n}\n\nexport interface NotebookDataDto {\n\treadonly cells: ICellDto2[];\n\treadonly languages: string[];\n\treadonly metadata: NotebookDocumentMetadata;\n}\n\nexport function getCellUndoRedoComparisonKey(uri: URI) {\n\tconst data = CellUri.parse(uri);\n\tif (!data) {\n\t\treturn uri.toString();\n\t}\n\n\treturn data.notebook.toString();\n}\n\n\nexport namespace CellUri {\n\n\texport const scheme = Schemas.vscodeNotebookCell;\n\n\tconst _regex = /^ch(\\d{7,})/;\n\n\texport function generate(notebook: URI, handle: number): URI {\n\t\treturn notebook.with({\n\t\t\tscheme,\n\t\t\tfragment: `ch${handle.toString().padStart(7, '0')}${notebook.scheme !== Schemas.file ? notebook.scheme : ''}`\n\t\t});\n\t}\n\n\texport function parse(cell: URI): { notebook: URI, handle: number } | undefined {\n\t\tif (cell.scheme !== scheme) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst match = _regex.exec(cell.fragment);\n\t\tif (!match) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst handle = Number(match[1]);\n\t\treturn {\n\t\t\thandle,\n\t\t\tnotebook: cell.with({\n\t\t\t\tscheme: cell.fragment.substr(match[0].length) || Schemas.file,\n\t\t\t\tfragment: null\n\t\t\t})\n\t\t};\n\t}\n\n\texport function generateCellMetadataUri(notebook: URI, handle: number): URI {\n\t\treturn notebook.with({\n\t\t\tscheme: Schemas.vscodeNotebookCellMetadata,\n\t\t\tfragment: `ch${handle.toString().padStart(7, '0')}${notebook.scheme !== Schemas.file ? notebook.scheme : ''}`\n\t\t});\n\t}\n\n\texport function parseCellMetadataUri(metadata: URI) {\n\t\tif (metadata.scheme !== Schemas.vscodeNotebookCellMetadata) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst match = _regex.exec(metadata.fragment);\n\t\tif (!match) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst handle = Number(match[1]);\n\t\treturn {\n\t\t\thandle,\n\t\t\tnotebook: metadata.with({\n\t\t\t\tscheme: metadata.fragment.substr(match[0].length) || Schemas.file,\n\t\t\t\tfragment: null\n\t\t\t})\n\t\t};\n\t}\n}\n\nexport function mimeTypeIsAlwaysSecure(mimeType: string) {\n\tif ([\n\t\t'application/json',\n\t\t'text/markdown',\n\t\t'image/png',\n\t\t'text/plain'\n\t].indexOf(mimeType) > -1) {\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n\nexport function mimeTypeSupportedByCore(mimeType: string) {\n\tif ([\n\t\t'application/json',\n\t\t'application/javascript',\n\t\t'text/html',\n\t\t'image/svg+xml',\n\t\t'text/markdown',\n\t\t'image/png',\n\t\t'image/jpeg',\n\t\t'text/plain',\n\t\t'text/x-javascript'\n\t].indexOf(mimeType) > -1) {\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n\n// if (isWindows) {\n// \tvalue = value.replace(/\\//g, '\\\\');\n// }\n\nfunction matchGlobUniversal(pattern: string, path: string) {\n\tif (isWindows) {\n\t\tpattern = pattern.replace(/\\//g, '\\\\');\n\t\tpath = path.replace(/\\//g, '\\\\');\n\t}\n\n\treturn glob.match(pattern, path);\n}\n\n\nfunction getMimeTypeOrder(mimeType: string, userDisplayOrder: string[], documentDisplayOrder: string[], defaultOrder: string[]) {\n\tlet order = 0;\n\tfor (let i = 0; i < userDisplayOrder.length; i++) {\n\t\tif (matchGlobUniversal(userDisplayOrder[i], mimeType)) {\n\t\t\treturn order;\n\t\t}\n\t\torder++;\n\t}\n\n\tfor (let i = 0; i < documentDisplayOrder.length; i++) {\n\t\tif (matchGlobUniversal(documentDisplayOrder[i], mimeType)) {\n\t\t\treturn order;\n\t\t}\n\n\t\torder++;\n\t}\n\n\tfor (let i = 0; i < defaultOrder.length; i++) {\n\t\tif (matchGlobUniversal(defaultOrder[i], mimeType)) {\n\t\t\treturn order;\n\t\t}\n\n\t\torder++;\n\t}\n\n\treturn order;\n}\n\nexport function sortMimeTypes(mimeTypes: string[], userDisplayOrder: string[], documentDisplayOrder: string[], defaultOrder: string[]) {\n\tconst sorted = mimeTypes.sort((a, b) => {\n\t\treturn getMimeTypeOrder(a, userDisplayOrder, documentDisplayOrder, defaultOrder) - getMimeTypeOrder(b, userDisplayOrder, documentDisplayOrder, defaultOrder);\n\t});\n\n\treturn sorted;\n}\n\ninterface IMutableSplice<T> extends ISplice<T> {\n\tdeleteCount: number;\n}\n\nexport function diff<T>(before: T[], after: T[], contains: (a: T) => boolean, equal: (a: T, b: T) => boolean = (a: T, b: T) => a === b): ISplice<T>[] {\n\tconst result: IMutableSplice<T>[] = [];\n\n\tfunction pushSplice(start: number, deleteCount: number, toInsert: T[]): void {\n\t\tif (deleteCount === 0 && toInsert.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst latest = result[result.length - 1];\n\n\t\tif (latest && latest.start + latest.deleteCount === start) {\n\t\t\tlatest.deleteCount += deleteCount;\n\t\t\tlatest.toInsert.push(...toInsert);\n\t\t} else {\n\t\t\tresult.push({ start, deleteCount, toInsert });\n\t\t}\n\t}\n\n\tlet beforeIdx = 0;\n\tlet afterIdx = 0;\n\n\twhile (true) {\n\t\tif (beforeIdx === before.length) {\n\t\t\tpushSplice(beforeIdx, 0, after.slice(afterIdx));\n\t\t\tbreak;\n\t\t}\n\n\t\tif (afterIdx === after.length) {\n\t\t\tpushSplice(beforeIdx, before.length - beforeIdx, []);\n\t\t\tbreak;\n\t\t}\n\n\t\tconst beforeElement = before[beforeIdx];\n\t\tconst afterElement = after[afterIdx];\n\n\t\tif (equal(beforeElement, afterElement)) {\n\t\t\t// equal\n\t\t\tbeforeIdx += 1;\n\t\t\tafterIdx += 1;\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (contains(afterElement)) {\n\t\t\t// `afterElement` exists before, which means some elements before `afterElement` are deleted\n\t\t\tpushSplice(beforeIdx, 1, []);\n\t\t\tbeforeIdx += 1;\n\t\t} else {\n\t\t\t// `afterElement` added\n\t\t\tpushSplice(beforeIdx, 0, [afterElement]);\n\t\t\tafterIdx += 1;\n\t\t}\n\t}\n\n\treturn result;\n}\n\nexport interface ICellEditorViewState {\n\tselections: editorCommon.ICursorState[];\n}\n\nexport const NOTEBOOK_EDITOR_CURSOR_BOUNDARY = new RawContextKey<'none' | 'top' | 'bottom' | 'both'>('notebookEditorCursorAtBoundary', 'none');\nexport const NOTEBOOK_EDITOR_CURSOR_BEGIN_END = new RawContextKey<boolean>('notebookEditorCursorAtEditorBeginEnd', false);\n\n\nexport interface INotebookEditorModel extends IEditorModel {\n\treadonly onDidChangeDirty: Event<void>;\n\treadonly resource: URI;\n\treadonly viewType: string;\n\treadonly notebook: NotebookTextModel;\n\treadonly lastResolvedFileStat: IFileStatWithMetadata | undefined;\n\tisDirty(): boolean;\n\tisUntitled(): boolean;\n\tsave(): Promise<boolean>;\n\tsaveAs(target: URI): Promise<boolean>;\n\trevert(options?: IRevertOptions | undefined): Promise<void>;\n}\n\nexport interface INotebookDiffEditorModel extends IEditorModel {\n\toriginal: INotebookEditorModel;\n\tmodified: INotebookEditorModel;\n\tresolveOriginalFromDisk(): Promise<void>;\n\tresolveModifiedFromDisk(): Promise<void>;\n}\n\nexport interface INotebookTextModelBackup {\n\tmetadata: NotebookDocumentMetadata;\n\tlanguages: string[];\n\tcells: ICellDto2[]\n}\n\nexport interface NotebookDocumentBackupData {\n\treadonly viewType: string;\n\treadonly name: string;\n\treadonly backupId?: string;\n\treadonly mtime?: number;\n}\n\n/**\n * [start, end]\n */\nexport interface ICellRange {\n\t/**\n\t * zero based index\n\t */\n\tstart: number;\n\n\t/**\n\t * zero based index\n\t */\n\tend: number;\n}\n\nexport interface IEditor extends editorCommon.ICompositeCodeEditor {\n\treadonly onDidChangeModel: Event<NotebookTextModel | undefined>;\n\treadonly onDidFocusEditorWidget: Event<void>;\n\treadonly onDidChangeVisibleRanges: Event<void>;\n\treadonly onDidChangeSelection: Event<void>;\n\tgetSelectionHandles(): number[];\n\tisNotebookEditor: boolean;\n\tvisibleRanges: ICellRange[];\n\turi?: URI;\n\ttextModel?: NotebookTextModel;\n\tgetId(): string;\n\thasFocus(): boolean;\n}\n\nexport enum NotebookEditorPriority {\n\tdefault = 'default',\n\toption = 'option',\n}\n\nexport interface INotebookSearchOptions {\n\tregex?: boolean;\n\twholeWord?: boolean;\n\tcaseSensitive?: boolean\n\twordSeparators?: string;\n}\n\nexport interface INotebookExclusiveDocumentFilter {\n\tinclude?: string | glob.IRelativePattern;\n\texclude?: string | glob.IRelativePattern;\n}\n\nexport interface INotebookDocumentFilter {\n\tviewType?: string | string[];\n\tfilenamePattern?: string | glob.IRelativePattern | INotebookExclusiveDocumentFilter;\n}\n\n//TODO@rebornix test\n\nexport function isDocumentExcludePattern(filenamePattern: string | glob.IRelativePattern | INotebookExclusiveDocumentFilter): filenamePattern is { include: string | glob.IRelativePattern; exclude: string | glob.IRelativePattern; } {\n\tconst arg = filenamePattern as INotebookExclusiveDocumentFilter;\n\n\tif ((typeof arg.include === 'string' || glob.isRelativePattern(arg.include))\n\t\t&& (typeof arg.exclude === 'string' || glob.isRelativePattern(arg.exclude))) {\n\t\treturn true;\n\t}\n\n\treturn false;\n}\nexport function notebookDocumentFilterMatch(filter: INotebookDocumentFilter, viewType: string, resource: URI): boolean {\n\tif (Array.isArray(filter.viewType) && filter.viewType.indexOf(viewType) >= 0) {\n\t\treturn true;\n\t}\n\n\tif (filter.viewType === viewType) {\n\t\treturn true;\n\t}\n\n\tif (filter.filenamePattern) {\n\t\tlet filenamePattern = isDocumentExcludePattern(filter.filenamePattern) ? filter.filenamePattern.include : (filter.filenamePattern as string | glob.IRelativePattern);\n\t\tlet excludeFilenamePattern = isDocumentExcludePattern(filter.filenamePattern) ? filter.filenamePattern.exclude : undefined;\n\n\t\tif (glob.match(filenamePattern, basename(resource.fsPath).toLowerCase())) {\n\t\t\tif (excludeFilenamePattern) {\n\t\t\t\tif (glob.match(excludeFilenamePattern, basename(resource.fsPath).toLowerCase())) {\n\t\t\t\t\t// should exclude\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n}\n\nexport interface INotebookKernelInfoDto2 {\n\tid?: string;\n\tfriendlyId: string;\n\tlabel: string;\n\textension: ExtensionIdentifier;\n\textensionLocation: URI;\n\tproviderHandle?: number;\n\tdescription?: string;\n\tdetail?: string;\n\tisPreferred?: boolean;\n\tpreloads?: UriComponents[];\n}\n\nexport interface INotebookKernelInfo2 extends INotebookKernelInfoDto2 {\n\tresolve(uri: URI, editorId: string, token: CancellationToken): Promise<void>;\n\texecuteNotebookCell(uri: URI, handle: number | undefined): Promise<void>;\n\tcancelNotebookCell(uri: URI, handle: number | undefined): Promise<void>;\n}\n\nexport interface INotebookKernelProvider {\n\tproviderExtensionId: string;\n\tproviderDescription?: string;\n\tselector: INotebookDocumentFilter;\n\tonDidChangeKernels: Event<URI | undefined>;\n\tprovideKernels(uri: URI, token: CancellationToken): Promise<INotebookKernelInfoDto2[]>;\n\tresolveKernel(editorId: string, uri: UriComponents, kernelId: string, token: CancellationToken): Promise<void>;\n\texecuteNotebook(uri: URI, kernelId: string, handle: number | undefined): Promise<void>;\n\tcancelNotebook(uri: URI, kernelId: string, handle: number | undefined): Promise<void>;\n}\n\nexport class CellSequence implements ISequence {\n\n\tconstructor(readonly textModel: NotebookTextModel) {\n\t}\n\n\tgetElements(): string[] | number[] | Int32Array {\n\t\tconst hashValue = new Int32Array(this.textModel.cells.length);\n\t\tfor (let i = 0; i < this.textModel.cells.length; i++) {\n\t\t\thashValue[i] = this.textModel.cells[i].getHashValue();\n\t\t}\n\n\t\treturn hashValue;\n\t}\n}\n\nexport interface INotebookDiffResult {\n\tcellsDiff: IDiffResult,\n\tlinesDiff?: { originalCellhandle: number, modifiedCellhandle: number, lineChanges: editorCommon.ILineChange[] }[];\n}\n\nexport interface INotebookCellStatusBarEntry {\n\treadonly cellResource: URI;\n\treadonly alignment: CellStatusbarAlignment;\n\treadonly priority?: number;\n\treadonly text: string;\n\treadonly tooltip: string | undefined;\n\treadonly command: string | Command | undefined;\n\treadonly accessibilityInformation?: IAccessibilityInformation;\n\treadonly visible: boolean;\n\treadonly opacity?: string;\n}\n\nexport const DisplayOrderKey = 'notebook.displayOrder';\nexport const CellToolbarLocKey = 'notebook.cellToolbarLocation';\nexport const ShowCellStatusBarKey = 'notebook.showCellStatusBar';\nexport const NotebookTextDiffEditorPreview = 'notebook.diff.enablePreview';\n\nexport const enum CellStatusbarAlignment {\n\tLEFT,\n\tRIGHT\n}\n\nexport interface INotebookDecorationRenderOptions {\n\tbackgroundColor?: string | ThemeColor;\n\tborderColor?: string | ThemeColor;\n\ttop?: editorCommon.IContentDecorationRenderOptions;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { hash } from 'vs/base/common/hash';\nimport { Disposable, DisposableStore, dispose, IDisposable } from 'vs/base/common/lifecycle';\nimport { Schemas } from 'vs/base/common/network';\nimport { joinPath } from 'vs/base/common/resources';\nimport { ISplice } from 'vs/base/common/sequence';\nimport { URI } from 'vs/base/common/uri';\nimport * as UUID from 'vs/base/common/uuid';\nimport { CellKind, INotebookDocumentPropertiesChangeData, IWorkspaceCellEditDto, MainThreadBulkEditsShape, MainThreadNotebookShape, NotebookCellOutputsSplice, WorkspaceEditType } from 'vs/workbench/api/common/extHost.protocol';\nimport { ExtHostDocumentsAndEditors, IExtHostModelAddedData } from 'vs/workbench/api/common/extHostDocumentsAndEditors';\nimport { CellEditType, CellOutputKind, diff, IMainCellDto, IProcessedOutput, NotebookCellMetadata, NotebookCellsChangedEventDto, NotebookCellsChangeType, NotebookCellsSplice2, notebookDocumentMetadataDefaults } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport * as vscode from 'vscode';\nimport { Cache } from './cache';\n\n\ninterface IObservable<T> {\n\tproxy: T;\n\tonDidChange: Event<void>;\n}\n\nfunction getObservable<T extends Object>(obj: T): IObservable<T> {\n\tconst onDidChange = new Emitter<void>();\n\tconst proxy = new Proxy(obj, {\n\t\tset(target: T, p: PropertyKey, value: any, _receiver: any): boolean {\n\t\t\ttarget[p as keyof T] = value;\n\t\t\tonDidChange.fire();\n\t\t\treturn true;\n\t\t}\n\t});\n\n\treturn {\n\t\tproxy,\n\t\tonDidChange: onDidChange.event\n\t};\n}\n\nclass RawContentChangeEvent {\n\n\tconstructor(readonly start: number, readonly deletedCount: number, readonly deletedItems: ExtHostCell[], readonly items: ExtHostCell[]) { }\n\n\tstatic asApiEvent(event: RawContentChangeEvent): vscode.NotebookCellsChangeData {\n\t\treturn Object.freeze({\n\t\t\tstart: event.start,\n\t\t\tdeletedCount: event.deletedCount,\n\t\t\tdeletedItems: event.deletedItems.map(data => data.cell),\n\t\t\titems: event.items.map(data => data.cell)\n\t\t});\n\t}\n}\n\nexport class ExtHostCell extends Disposable {\n\n\tstatic asModelAddData(notebook: vscode.NotebookDocument, cell: IMainCellDto): IExtHostModelAddedData {\n\t\treturn {\n\t\t\tEOL: cell.eol,\n\t\t\tlines: cell.source,\n\t\t\tmodeId: cell.language,\n\t\t\turi: cell.uri,\n\t\t\tisDirty: false,\n\t\t\tversionId: 1,\n\t\t\tnotebook\n\t\t};\n\t}\n\n\tprivate _onDidDispose = new Emitter<void>();\n\treadonly onDidDispose: Event<void> = this._onDidDispose.event;\n\n\tprivate _onDidChangeOutputs = new Emitter<ISplice<IProcessedOutput>[]>();\n\treadonly onDidChangeOutputs: Event<ISplice<IProcessedOutput>[]> = this._onDidChangeOutputs.event;\n\n\tprivate _outputs: any[];\n\tprivate _outputMapping = new WeakMap<vscode.CellOutput, string | undefined /* output ID */>();\n\n\tprivate _metadata: vscode.NotebookCellMetadata;\n\tprivate _metadataChangeListener: IDisposable;\n\n\treadonly handle: number;\n\treadonly uri: URI;\n\treadonly cellKind: CellKind;\n\n\tprivate _cell: vscode.NotebookCell | undefined;\n\n\tconstructor(\n\t\tprivate readonly _mainThreadBulkEdits: MainThreadBulkEditsShape,\n\t\tprivate readonly _notebook: ExtHostNotebookDocument,\n\t\tprivate readonly _extHostDocument: ExtHostDocumentsAndEditors,\n\t\tprivate readonly _cellData: IMainCellDto,\n\t) {\n\t\tsuper();\n\n\t\tthis.handle = _cellData.handle;\n\t\tthis.uri = URI.revive(_cellData.uri);\n\t\tthis.cellKind = _cellData.cellKind;\n\n\t\tthis._outputs = _cellData.outputs;\n\t\tfor (const output of this._outputs) {\n\t\t\tthis._outputMapping.set(output, output.outputId);\n\t\t\tdelete output.outputId;\n\t\t}\n\n\t\tconst observableMetadata = getObservable(_cellData.metadata ?? {});\n\t\tthis._metadata = observableMetadata.proxy;\n\t\tthis._metadataChangeListener = this._register(observableMetadata.onDidChange(() => {\n\t\t\tthis._updateMetadata();\n\t\t}));\n\t}\n\n\tget cell(): vscode.NotebookCell {\n\t\tif (!this._cell) {\n\t\t\tconst that = this;\n\t\t\tconst data = this._extHostDocument.getDocument(this.uri);\n\t\t\tif (!data) {\n\t\t\t\tthrow new Error(`MISSING extHostDocument for notebook cell: ${this.uri}`);\n\t\t\t}\n\t\t\tthis._cell = Object.freeze({\n\t\t\t\tget index() { return that._notebook.getCellIndex(that); },\n\t\t\t\tnotebook: that._notebook.notebookDocument,\n\t\t\t\turi: that.uri,\n\t\t\t\tcellKind: this._cellData.cellKind,\n\t\t\t\tdocument: data.document,\n\t\t\t\tget language() { return data!.document.languageId; },\n\t\t\t\tget outputs() { return that._outputs; },\n\t\t\t\tset outputs(value) { that._updateOutputs(value); },\n\t\t\t\tget metadata() { return that._metadata; },\n\t\t\t\tset metadata(value) {\n\t\t\t\t\tthat.setMetadata(value);\n\t\t\t\t\tthat._updateMetadata();\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\treturn this._cell;\n\t}\n\n\tdispose() {\n\t\tsuper.dispose();\n\t\tthis._onDidDispose.fire();\n\t}\n\n\tsetOutputs(newOutputs: vscode.CellOutput[]): void {\n\t\tthis._outputs = newOutputs;\n\t}\n\n\tprivate _updateOutputs(newOutputs: vscode.CellOutput[]) {\n\t\tconst rawDiffs = diff<vscode.CellOutput>(this._outputs || [], newOutputs || [], (a) => {\n\t\t\treturn this._outputMapping.has(a);\n\t\t});\n\n\t\tconst transformedDiffs: ISplice<IProcessedOutput>[] = rawDiffs.map(diff => {\n\t\t\tfor (let i = diff.start; i < diff.start + diff.deleteCount; i++) {\n\t\t\t\tthis._outputMapping.delete(this._outputs[i]);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tdeleteCount: diff.deleteCount,\n\t\t\t\tstart: diff.start,\n\t\t\t\ttoInsert: diff.toInsert.map((output): IProcessedOutput => {\n\t\t\t\t\tif (output.outputKind === CellOutputKind.Rich) {\n\t\t\t\t\t\tconst uuid = UUID.generateUuid();\n\t\t\t\t\t\tthis._outputMapping.set(output, uuid);\n\t\t\t\t\t\treturn { ...output, outputId: uuid };\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._outputMapping.set(output, undefined);\n\t\t\t\t\treturn output;\n\t\t\t\t})\n\t\t\t};\n\t\t});\n\n\t\tthis._outputs = newOutputs;\n\t\tthis._onDidChangeOutputs.fire(transformedDiffs);\n\t}\n\n\tsetMetadata(newMetadata: vscode.NotebookCellMetadata): void {\n\t\t// Don't apply metadata defaults here, 'undefined' means 'inherit from document metadata'\n\t\tthis._metadataChangeListener.dispose();\n\t\tconst observableMetadata = getObservable(newMetadata);\n\t\tthis._metadata = observableMetadata.proxy;\n\t\tthis._metadataChangeListener = this._register(observableMetadata.onDidChange(() => {\n\t\t\tthis._updateMetadata();\n\t\t}));\n\t}\n\n\tprivate _updateMetadata(): Promise<boolean> {\n\t\tconst index = this._notebook.notebookDocument.cells.indexOf(this.cell);\n\t\tconst edit: IWorkspaceCellEditDto = {\n\t\t\t_type: WorkspaceEditType.Cell,\n\t\t\tmetadata: undefined,\n\t\t\tresource: this._notebook.uri,\n\t\t\tnotebookVersionId: this._notebook.notebookDocument.version,\n\t\t\tedit: { editType: CellEditType.Metadata, index, metadata: this._metadata }\n\t\t};\n\n\t\treturn this._mainThreadBulkEdits.$tryApplyWorkspaceEdit({ edits: [edit] });\n\t}\n}\n\nexport interface INotebookEventEmitter {\n\temitModelChange(events: vscode.NotebookCellsChangeEvent): void;\n\temitDocumentMetadataChange(event: vscode.NotebookDocumentMetadataChangeEvent): void;\n\temitCellOutputsChange(event: vscode.NotebookCellOutputsChangeEvent): void;\n\temitCellLanguageChange(event: vscode.NotebookCellLanguageChangeEvent): void;\n\temitCellMetadataChange(event: vscode.NotebookCellMetadataChangeEvent): void;\n}\n\nfunction hashPath(resource: URI): string {\n\tconst str = resource.scheme === Schemas.file || resource.scheme === Schemas.untitled ? resource.fsPath : resource.toString();\n\treturn hash(str) + '';\n}\n\nexport class ExtHostNotebookDocument extends Disposable {\n\n\tprivate static _handlePool: number = 0;\n\treadonly handle = ExtHostNotebookDocument._handlePool++;\n\n\tprivate _cells: ExtHostCell[] = [];\n\n\tprivate _cellDisposableMapping = new Map<number, DisposableStore>();\n\n\tprivate _notebook: vscode.NotebookDocument | undefined;\n\tprivate _metadata: Required<vscode.NotebookDocumentMetadata>;\n\tprivate _metadataChangeListener: IDisposable;\n\tprivate _versionId = 0;\n\tprivate _isDirty: boolean = false;\n\tprivate _backupCounter = 1;\n\tprivate _backup?: vscode.NotebookDocumentBackup;\n\tprivate _disposed = false;\n\tprivate _languages: string[] = [];\n\n\tprivate readonly _edits = new Cache<vscode.NotebookDocumentEditEvent>('notebook documents');\n\n\tconstructor(\n\t\tprivate readonly _proxy: MainThreadNotebookShape,\n\t\tprivate readonly _documentsAndEditors: ExtHostDocumentsAndEditors,\n\t\tprivate readonly _mainThreadBulkEdits: MainThreadBulkEditsShape,\n\t\tprivate readonly _emitter: INotebookEventEmitter,\n\t\tprivate readonly _viewType: string,\n\t\tprivate readonly _contentOptions: vscode.NotebookDocumentContentOptions,\n\t\tmetadata: Required<vscode.NotebookDocumentMetadata>,\n\t\tpublic readonly uri: URI,\n\t\tprivate readonly _storagePath: URI | undefined\n\t) {\n\t\tsuper();\n\n\t\tconst observableMetadata = getObservable(metadata);\n\t\tthis._metadata = observableMetadata.proxy;\n\t\tthis._metadataChangeListener = this._register(observableMetadata.onDidChange(() => {\n\t\t\tthis._tryUpdateMetadata();\n\t\t}));\n\t}\n\n\tdispose() {\n\t\tthis._disposed = true;\n\t\tsuper.dispose();\n\t\tdispose(this._cellDisposableMapping.values());\n\t}\n\n\tprivate _updateMetadata(newMetadata: Required<vscode.NotebookDocumentMetadata>) {\n\t\tthis._metadataChangeListener.dispose();\n\t\tnewMetadata = {\n\t\t\t...notebookDocumentMetadataDefaults,\n\t\t\t...newMetadata\n\t\t};\n\t\tif (this._metadataChangeListener) {\n\t\t\tthis._metadataChangeListener.dispose();\n\t\t}\n\n\t\tconst observableMetadata = getObservable(newMetadata);\n\t\tthis._metadata = observableMetadata.proxy;\n\t\tthis._metadataChangeListener = this._register(observableMetadata.onDidChange(() => {\n\t\t\tthis._tryUpdateMetadata();\n\t\t}));\n\n\t\tthis._tryUpdateMetadata();\n\t}\n\n\tprivate _tryUpdateMetadata() {\n\t\tconst edit: IWorkspaceCellEditDto = {\n\t\t\t_type: WorkspaceEditType.Cell,\n\t\t\tmetadata: undefined,\n\t\t\tedit: { editType: CellEditType.DocumentMetadata, metadata: this._metadata },\n\t\t\tresource: this.uri,\n\t\t\tnotebookVersionId: this.notebookDocument.version,\n\t\t};\n\n\t\treturn this._mainThreadBulkEdits.$tryApplyWorkspaceEdit({ edits: [edit] });\n\t}\n\n\tget notebookDocument(): vscode.NotebookDocument {\n\t\tif (!this._notebook) {\n\t\t\tconst that = this;\n\t\t\tthis._notebook = Object.freeze({\n\t\t\t\tget uri() { return that.uri; },\n\t\t\t\tget version() { return that._versionId; },\n\t\t\t\tget fileName() { return that.uri.fsPath; },\n\t\t\t\tget viewType() { return that._viewType; },\n\t\t\t\tget isDirty() { return that._isDirty; },\n\t\t\t\tget isUntitled() { return that.uri.scheme === Schemas.untitled; },\n\t\t\t\tget cells(): ReadonlyArray<vscode.NotebookCell> { return that._cells.map(cell => cell.cell); },\n\t\t\t\tget languages() { return that._languages; },\n\t\t\t\tset languages(value: string[]) { that._trySetLanguages(value); },\n\t\t\t\tget metadata() { return that._metadata; },\n\t\t\t\tset metadata(value: Required<vscode.NotebookDocumentMetadata>) { that._updateMetadata(value); },\n\t\t\t\tget contentOptions() { return that._contentOptions; }\n\t\t\t});\n\t\t}\n\t\treturn this._notebook;\n\t}\n\n\tprivate _trySetLanguages(newLanguages: string[]) {\n\t\tthis._languages = newLanguages;\n\t\tthis._proxy.$updateNotebookLanguages(this._viewType, this.uri, this._languages);\n\t}\n\n\tgetNewBackupUri(): URI {\n\t\tif (!this._storagePath) {\n\t\t\tthrow new Error('Backup requires a valid storage path');\n\t\t}\n\t\tconst fileName = hashPath(this.uri) + (this._backupCounter++);\n\t\treturn joinPath(this._storagePath, fileName);\n\t}\n\n\tupdateBackup(backup: vscode.NotebookDocumentBackup): void {\n\t\tthis._backup?.delete();\n\t\tthis._backup = backup;\n\t}\n\n\tdisposeBackup(): void {\n\t\tthis._backup?.delete();\n\t\tthis._backup = undefined;\n\t}\n\n\tacceptDocumentPropertiesChanged(data: INotebookDocumentPropertiesChangeData) {\n\t\tconst newMetadata = {\n\t\t\t...notebookDocumentMetadataDefaults,\n\t\t\t...data.metadata\n\t\t};\n\n\t\tif (this._metadataChangeListener) {\n\t\t\tthis._metadataChangeListener.dispose();\n\t\t}\n\n\t\tconst observableMetadata = getObservable(newMetadata);\n\t\tthis._metadata = observableMetadata.proxy;\n\t\tthis._metadataChangeListener = this._register(observableMetadata.onDidChange(() => {\n\t\t\tthis._tryUpdateMetadata();\n\t\t}));\n\n\t\tthis._emitter.emitDocumentMetadataChange({ document: this.notebookDocument });\n\t}\n\n\tacceptModelChanged(event: NotebookCellsChangedEventDto, isDirty: boolean): void {\n\t\tthis._versionId = event.versionId;\n\t\tthis._isDirty = isDirty;\n\t\tevent.rawEvents.forEach(e => {\n\t\t\tif (e.kind === NotebookCellsChangeType.Initialize) {\n\t\t\t\tthis._spliceNotebookCells(e.changes, true);\n\t\t\t} if (e.kind === NotebookCellsChangeType.ModelChange) {\n\t\t\t\tthis._spliceNotebookCells(e.changes, false);\n\t\t\t} else if (e.kind === NotebookCellsChangeType.Move) {\n\t\t\t\tthis._moveCell(e.index, e.newIdx);\n\t\t\t} else if (e.kind === NotebookCellsChangeType.Output) {\n\t\t\t\tthis._setCellOutputs(e.index, e.outputs);\n\t\t\t} else if (e.kind === NotebookCellsChangeType.ChangeLanguage) {\n\t\t\t\tthis._changeCellLanguage(e.index, e.language);\n\t\t\t} else if (e.kind === NotebookCellsChangeType.ChangeCellMetadata) {\n\t\t\t\tthis._changeCellMetadata(e.index, e.metadata);\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate _spliceNotebookCells(splices: NotebookCellsSplice2[], initialization: boolean): void {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst contentChangeEvents: RawContentChangeEvent[] = [];\n\t\tconst addedCellDocuments: IExtHostModelAddedData[] = [];\n\t\tconst removedCellDocuments: URI[] = [];\n\n\t\tsplices.reverse().forEach(splice => {\n\t\t\tconst cellDtos = splice[2];\n\t\t\tconst newCells = cellDtos.map(cell => {\n\n\t\t\t\tconst extCell = new ExtHostCell(this._mainThreadBulkEdits, this, this._documentsAndEditors, cell);\n\n\t\t\t\tif (!initialization) {\n\t\t\t\t\taddedCellDocuments.push(ExtHostCell.asModelAddData(this.notebookDocument, cell));\n\t\t\t\t}\n\n\t\t\t\tif (!this._cellDisposableMapping.has(extCell.handle)) {\n\t\t\t\t\tconst store = new DisposableStore();\n\t\t\t\t\tstore.add(extCell);\n\t\t\t\t\tthis._cellDisposableMapping.set(extCell.handle, store);\n\t\t\t\t}\n\n\t\t\t\tconst store = this._cellDisposableMapping.get(extCell.handle)!;\n\n\t\t\t\tstore.add(extCell.onDidChangeOutputs((diffs) => {\n\t\t\t\t\tthis.eventuallyUpdateCellOutputs(extCell, diffs);\n\t\t\t\t}));\n\n\t\t\t\treturn extCell;\n\t\t\t});\n\n\t\t\tfor (let j = splice[0]; j < splice[0] + splice[1]; j++) {\n\t\t\t\tthis._cellDisposableMapping.get(this._cells[j].handle)?.dispose();\n\t\t\t\tthis._cellDisposableMapping.delete(this._cells[j].handle);\n\t\t\t}\n\n\t\t\tconst deletedItems = this._cells.splice(splice[0], splice[1], ...newCells);\n\t\t\tfor (let cell of deletedItems) {\n\t\t\t\tremovedCellDocuments.push(cell.uri);\n\t\t\t}\n\n\t\t\tcontentChangeEvents.push(new RawContentChangeEvent(splice[0], splice[1], deletedItems, newCells));\n\t\t});\n\n\t\tthis._documentsAndEditors.acceptDocumentsAndEditorsDelta({\n\t\t\taddedDocuments: addedCellDocuments,\n\t\t\tremovedDocuments: removedCellDocuments\n\t\t});\n\n\t\tif (!initialization) {\n\t\t\tthis._emitter.emitModelChange({\n\t\t\t\tdocument: this.notebookDocument,\n\t\t\t\tchanges: contentChangeEvents.map(RawContentChangeEvent.asApiEvent)\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate _moveCell(index: number, newIdx: number): void {\n\t\tconst cells = this._cells.splice(index, 1);\n\t\tthis._cells.splice(newIdx, 0, ...cells);\n\t\tconst changes: vscode.NotebookCellsChangeData[] = [{\n\t\t\tstart: index,\n\t\t\tdeletedCount: 1,\n\t\t\tdeletedItems: cells.map(data => data.cell),\n\t\t\titems: []\n\t\t}, {\n\t\t\tstart: newIdx,\n\t\t\tdeletedCount: 0,\n\t\t\tdeletedItems: [],\n\t\t\titems: cells.map(data => data.cell)\n\t\t}];\n\t\tthis._emitter.emitModelChange({\n\t\t\tdocument: this.notebookDocument,\n\t\t\tchanges\n\t\t});\n\t}\n\n\tprivate _setCellOutputs(index: number, outputs: IProcessedOutput[]): void {\n\t\tconst cell = this._cells[index];\n\t\tcell.setOutputs(outputs);\n\t\tthis._emitter.emitCellOutputsChange({ document: this.notebookDocument, cells: [cell.cell] });\n\t}\n\n\tprivate _changeCellLanguage(index: number, language: string): void {\n\t\tconst cell = this._cells[index];\n\t\tconst event: vscode.NotebookCellLanguageChangeEvent = { document: this.notebookDocument, cell: cell.cell, language };\n\t\tthis._emitter.emitCellLanguageChange(event);\n\t}\n\n\tprivate _changeCellMetadata(index: number, newMetadata: NotebookCellMetadata | undefined): void {\n\t\tconst cell = this._cells[index];\n\t\tcell.setMetadata(newMetadata || {});\n\t\tconst event: vscode.NotebookCellMetadataChangeEvent = { document: this.notebookDocument, cell: cell.cell };\n\t\tthis._emitter.emitCellMetadataChange(event);\n\t}\n\n\tasync eventuallyUpdateCellOutputs(cell: ExtHostCell, diffs: ISplice<IProcessedOutput>[]) {\n\t\tconst outputDtos: NotebookCellOutputsSplice[] = diffs.map(diff => {\n\t\t\tconst outputs = diff.toInsert;\n\t\t\treturn [diff.start, diff.deleteCount, outputs];\n\t\t});\n\n\t\tif (!outputDtos.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait this._proxy.$spliceNotebookCellOutputs(this._viewType, this.uri, cell.handle, outputDtos);\n\t\tthis._emitter.emitCellOutputsChange({\n\t\t\tdocument: this.notebookDocument,\n\t\t\tcells: [cell.cell]\n\t\t});\n\t}\n\n\tgetCell(cellHandle: number): ExtHostCell | undefined {\n\t\treturn this._cells.find(cell => cell.handle === cellHandle);\n\t}\n\n\tgetCellIndex(cell: ExtHostCell): number {\n\t\treturn this._cells.indexOf(cell);\n\t}\n\n\taddEdit(item: vscode.NotebookDocumentEditEvent): number {\n\t\treturn this._edits.add([item]);\n\t}\n\n\tasync undo(editId: number, isDirty: boolean): Promise<void> {\n\t\tawait this.getEdit(editId).undo();\n\t\t// if (!isDirty) {\n\t\t// \tthis.disposeBackup();\n\t\t// }\n\t}\n\n\tasync redo(editId: number, isDirty: boolean): Promise<void> {\n\t\tawait this.getEdit(editId).redo();\n\t\t// if (!isDirty) {\n\t\t// \tthis.disposeBackup();\n\t\t// }\n\t}\n\n\tprivate getEdit(editId: number): vscode.NotebookDocumentEditEvent {\n\t\tconst edit = this._edits.get(editId, 0);\n\t\tif (!edit) {\n\t\t\tthrow new Error('No edit found');\n\t\t}\n\n\t\treturn edit;\n\t}\n\n\tdisposeEdits(editIds: number[]): void {\n\t\tfor (const id of editIds) {\n\t\t\tthis._edits.delete(id);\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { coalesceInPlace, equals } from 'vs/base/common/arrays';\nimport { illegalArgument } from 'vs/base/common/errors';\nimport { IRelativePattern } from 'vs/base/common/glob';\nimport { isMarkdownString, MarkdownString as BaseMarkdownString } from 'vs/base/common/htmlContent';\nimport { ResourceMap } from 'vs/base/common/map';\nimport { isStringArray } from 'vs/base/common/types';\nimport { URI } from 'vs/base/common/uri';\nimport { generateUuid } from 'vs/base/common/uuid';\nimport { FileSystemProviderErrorCode, markAsFileSystemProviderError } from 'vs/platform/files/common/files';\nimport { RemoteAuthorityResolverErrorCode } from 'vs/platform/remote/common/remoteAuthorityResolver';\nimport { addIdToOutput, CellEditType, ICellEditOperation, IDisplayOutput, notebookDocumentMetadataDefaults } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport type * as vscode from 'vscode';\n\nfunction es5ClassCompat(target: Function): any {\n\t///@ts-expect-error\n\tfunction _() { return Reflect.construct(target, arguments, this.constructor); }\n\tObject.defineProperty(_, 'name', Object.getOwnPropertyDescriptor(target, 'name')!);\n\tObject.setPrototypeOf(_, target);\n\tObject.setPrototypeOf(_.prototype, target.prototype);\n\treturn _;\n}\n\n@es5ClassCompat\nexport class Disposable {\n\n\tstatic from(...inDisposables: { dispose(): any; }[]): Disposable {\n\t\tlet disposables: ReadonlyArray<{ dispose(): any; }> | undefined = inDisposables;\n\t\treturn new Disposable(function () {\n\t\t\tif (disposables) {\n\t\t\t\tfor (const disposable of disposables) {\n\t\t\t\t\tif (disposable && typeof disposable.dispose === 'function') {\n\t\t\t\t\t\tdisposable.dispose();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tdisposables = undefined;\n\t\t\t}\n\t\t});\n\t}\n\n\t#callOnDispose?: () => any;\n\n\tconstructor(callOnDispose: () => any) {\n\t\tthis.#callOnDispose = callOnDispose;\n\t}\n\n\tdispose(): any {\n\t\tif (typeof this.#callOnDispose === 'function') {\n\t\t\tthis.#callOnDispose();\n\t\t\tthis.#callOnDispose = undefined;\n\t\t}\n\t}\n}\n\n@es5ClassCompat\nexport class Position {\n\n\tstatic Min(...positions: Position[]): Position {\n\t\tif (positions.length === 0) {\n\t\t\tthrow new TypeError();\n\t\t}\n\t\tlet result = positions[0];\n\t\tfor (let i = 1; i < positions.length; i++) {\n\t\t\tconst p = positions[i];\n\t\t\tif (p.isBefore(result!)) {\n\t\t\t\tresult = p;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tstatic Max(...positions: Position[]): Position {\n\t\tif (positions.length === 0) {\n\t\t\tthrow new TypeError();\n\t\t}\n\t\tlet result = positions[0];\n\t\tfor (let i = 1; i < positions.length; i++) {\n\t\t\tconst p = positions[i];\n\t\t\tif (p.isAfter(result!)) {\n\t\t\t\tresult = p;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tstatic isPosition(other: any): other is Position {\n\t\tif (!other) {\n\t\t\treturn false;\n\t\t}\n\t\tif (other instanceof Position) {\n\t\t\treturn true;\n\t\t}\n\t\tlet { line, character } = <Position>other;\n\t\tif (typeof line === 'number' && typeof character === 'number') {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tprivate _line: number;\n\tprivate _character: number;\n\n\tget line(): number {\n\t\treturn this._line;\n\t}\n\n\tget character(): number {\n\t\treturn this._character;\n\t}\n\n\tconstructor(line: number, character: number) {\n\t\tif (line < 0) {\n\t\t\tthrow illegalArgument('line must be non-negative');\n\t\t}\n\t\tif (character < 0) {\n\t\t\tthrow illegalArgument('character must be non-negative');\n\t\t}\n\t\tthis._line = line;\n\t\tthis._character = character;\n\t}\n\n\tisBefore(other: Position): boolean {\n\t\tif (this._line < other._line) {\n\t\t\treturn true;\n\t\t}\n\t\tif (other._line < this._line) {\n\t\t\treturn false;\n\t\t}\n\t\treturn this._character < other._character;\n\t}\n\n\tisBeforeOrEqual(other: Position): boolean {\n\t\tif (this._line < other._line) {\n\t\t\treturn true;\n\t\t}\n\t\tif (other._line < this._line) {\n\t\t\treturn false;\n\t\t}\n\t\treturn this._character <= other._character;\n\t}\n\n\tisAfter(other: Position): boolean {\n\t\treturn !this.isBeforeOrEqual(other);\n\t}\n\n\tisAfterOrEqual(other: Position): boolean {\n\t\treturn !this.isBefore(other);\n\t}\n\n\tisEqual(other: Position): boolean {\n\t\treturn this._line === other._line && this._character === other._character;\n\t}\n\n\tcompareTo(other: Position): number {\n\t\tif (this._line < other._line) {\n\t\t\treturn -1;\n\t\t} else if (this._line > other.line) {\n\t\t\treturn 1;\n\t\t} else {\n\t\t\t// equal line\n\t\t\tif (this._character < other._character) {\n\t\t\t\treturn -1;\n\t\t\t} else if (this._character > other._character) {\n\t\t\t\treturn 1;\n\t\t\t} else {\n\t\t\t\t// equal line and character\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\t}\n\n\ttranslate(change: { lineDelta?: number; characterDelta?: number; }): Position;\n\ttranslate(lineDelta?: number, characterDelta?: number): Position;\n\ttranslate(lineDeltaOrChange: number | undefined | { lineDelta?: number; characterDelta?: number; }, characterDelta: number = 0): Position {\n\n\t\tif (lineDeltaOrChange === null || characterDelta === null) {\n\t\t\tthrow illegalArgument();\n\t\t}\n\n\t\tlet lineDelta: number;\n\t\tif (typeof lineDeltaOrChange === 'undefined') {\n\t\t\tlineDelta = 0;\n\t\t} else if (typeof lineDeltaOrChange === 'number') {\n\t\t\tlineDelta = lineDeltaOrChange;\n\t\t} else {\n\t\t\tlineDelta = typeof lineDeltaOrChange.lineDelta === 'number' ? lineDeltaOrChange.lineDelta : 0;\n\t\t\tcharacterDelta = typeof lineDeltaOrChange.characterDelta === 'number' ? lineDeltaOrChange.characterDelta : 0;\n\t\t}\n\n\t\tif (lineDelta === 0 && characterDelta === 0) {\n\t\t\treturn this;\n\t\t}\n\t\treturn new Position(this.line + lineDelta, this.character + characterDelta);\n\t}\n\n\twith(change: { line?: number; character?: number; }): Position;\n\twith(line?: number, character?: number): Position;\n\twith(lineOrChange: number | undefined | { line?: number; character?: number; }, character: number = this.character): Position {\n\n\t\tif (lineOrChange === null || character === null) {\n\t\t\tthrow illegalArgument();\n\t\t}\n\n\t\tlet line: number;\n\t\tif (typeof lineOrChange === 'undefined') {\n\t\t\tline = this.line;\n\n\t\t} else if (typeof lineOrChange === 'number') {\n\t\t\tline = lineOrChange;\n\n\t\t} else {\n\t\t\tline = typeof lineOrChange.line === 'number' ? lineOrChange.line : this.line;\n\t\t\tcharacter = typeof lineOrChange.character === 'number' ? lineOrChange.character : this.character;\n\t\t}\n\n\t\tif (line === this.line && character === this.character) {\n\t\t\treturn this;\n\t\t}\n\t\treturn new Position(line, character);\n\t}\n\n\ttoJSON(): any {\n\t\treturn { line: this.line, character: this.character };\n\t}\n}\n\n@es5ClassCompat\nexport class Range {\n\n\tstatic isRange(thing: any): thing is vscode.Range {\n\t\tif (thing instanceof Range) {\n\t\t\treturn true;\n\t\t}\n\t\tif (!thing) {\n\t\t\treturn false;\n\t\t}\n\t\treturn Position.isPosition((<Range>thing).start)\n\t\t\t&& Position.isPosition((<Range>thing.end));\n\t}\n\n\tprotected _start: Position;\n\tprotected _end: Position;\n\n\tget start(): Position {\n\t\treturn this._start;\n\t}\n\n\tget end(): Position {\n\t\treturn this._end;\n\t}\n\n\tconstructor(start: Position, end: Position);\n\tconstructor(startLine: number, startColumn: number, endLine: number, endColumn: number);\n\tconstructor(startLineOrStart: number | Position, startColumnOrEnd: number | Position, endLine?: number, endColumn?: number) {\n\t\tlet start: Position | undefined;\n\t\tlet end: Position | undefined;\n\n\t\tif (typeof startLineOrStart === 'number' && typeof startColumnOrEnd === 'number' && typeof endLine === 'number' && typeof endColumn === 'number') {\n\t\t\tstart = new Position(startLineOrStart, startColumnOrEnd);\n\t\t\tend = new Position(endLine, endColumn);\n\t\t} else if (startLineOrStart instanceof Position && startColumnOrEnd instanceof Position) {\n\t\t\tstart = startLineOrStart;\n\t\t\tend = startColumnOrEnd;\n\t\t}\n\n\t\tif (!start || !end) {\n\t\t\tthrow new Error('Invalid arguments');\n\t\t}\n\n\t\tif (start.isBefore(end)) {\n\t\t\tthis._start = start;\n\t\t\tthis._end = end;\n\t\t} else {\n\t\t\tthis._start = end;\n\t\t\tthis._end = start;\n\t\t}\n\t}\n\n\tcontains(positionOrRange: Position | Range): boolean {\n\t\tif (positionOrRange instanceof Range) {\n\t\t\treturn this.contains(positionOrRange._start)\n\t\t\t\t&& this.contains(positionOrRange._end);\n\n\t\t} else if (positionOrRange instanceof Position) {\n\t\t\tif (positionOrRange.isBefore(this._start)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (this._end.isBefore(positionOrRange)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tisEqual(other: Range): boolean {\n\t\treturn this._start.isEqual(other._start) && this._end.isEqual(other._end);\n\t}\n\n\tintersection(other: Range): Range | undefined {\n\t\tconst start = Position.Max(other.start, this._start);\n\t\tconst end = Position.Min(other.end, this._end);\n\t\tif (start.isAfter(end)) {\n\t\t\t// this happens when there is no overlap:\n\t\t\t// |-----|\n\t\t\t//          |----|\n\t\t\treturn undefined;\n\t\t}\n\t\treturn new Range(start, end);\n\t}\n\n\tunion(other: Range): Range {\n\t\tif (this.contains(other)) {\n\t\t\treturn this;\n\t\t} else if (other.contains(this)) {\n\t\t\treturn other;\n\t\t}\n\t\tconst start = Position.Min(other.start, this._start);\n\t\tconst end = Position.Max(other.end, this.end);\n\t\treturn new Range(start, end);\n\t}\n\n\tget isEmpty(): boolean {\n\t\treturn this._start.isEqual(this._end);\n\t}\n\n\tget isSingleLine(): boolean {\n\t\treturn this._start.line === this._end.line;\n\t}\n\n\twith(change: { start?: Position, end?: Position; }): Range;\n\twith(start?: Position, end?: Position): Range;\n\twith(startOrChange: Position | undefined | { start?: Position, end?: Position; }, end: Position = this.end): Range {\n\n\t\tif (startOrChange === null || end === null) {\n\t\t\tthrow illegalArgument();\n\t\t}\n\n\t\tlet start: Position;\n\t\tif (!startOrChange) {\n\t\t\tstart = this.start;\n\n\t\t} else if (Position.isPosition(startOrChange)) {\n\t\t\tstart = startOrChange;\n\n\t\t} else {\n\t\t\tstart = startOrChange.start || this.start;\n\t\t\tend = startOrChange.end || this.end;\n\t\t}\n\n\t\tif (start.isEqual(this._start) && end.isEqual(this.end)) {\n\t\t\treturn this;\n\t\t}\n\t\treturn new Range(start, end);\n\t}\n\n\ttoJSON(): any {\n\t\treturn [this.start, this.end];\n\t}\n}\n\n@es5ClassCompat\nexport class Selection extends Range {\n\n\tstatic isSelection(thing: any): thing is Selection {\n\t\tif (thing instanceof Selection) {\n\t\t\treturn true;\n\t\t}\n\t\tif (!thing) {\n\t\t\treturn false;\n\t\t}\n\t\treturn Range.isRange(thing)\n\t\t\t&& Position.isPosition((<Selection>thing).anchor)\n\t\t\t&& Position.isPosition((<Selection>thing).active)\n\t\t\t&& typeof (<Selection>thing).isReversed === 'boolean';\n\t}\n\n\tprivate _anchor: Position;\n\n\tpublic get anchor(): Position {\n\t\treturn this._anchor;\n\t}\n\n\tprivate _active: Position;\n\n\tpublic get active(): Position {\n\t\treturn this._active;\n\t}\n\n\tconstructor(anchor: Position, active: Position);\n\tconstructor(anchorLine: number, anchorColumn: number, activeLine: number, activeColumn: number);\n\tconstructor(anchorLineOrAnchor: number | Position, anchorColumnOrActive: number | Position, activeLine?: number, activeColumn?: number) {\n\t\tlet anchor: Position | undefined;\n\t\tlet active: Position | undefined;\n\n\t\tif (typeof anchorLineOrAnchor === 'number' && typeof anchorColumnOrActive === 'number' && typeof activeLine === 'number' && typeof activeColumn === 'number') {\n\t\t\tanchor = new Position(anchorLineOrAnchor, anchorColumnOrActive);\n\t\t\tactive = new Position(activeLine, activeColumn);\n\t\t} else if (anchorLineOrAnchor instanceof Position && anchorColumnOrActive instanceof Position) {\n\t\t\tanchor = anchorLineOrAnchor;\n\t\t\tactive = anchorColumnOrActive;\n\t\t}\n\n\t\tif (!anchor || !active) {\n\t\t\tthrow new Error('Invalid arguments');\n\t\t}\n\n\t\tsuper(anchor, active);\n\n\t\tthis._anchor = anchor;\n\t\tthis._active = active;\n\t}\n\n\tget isReversed(): boolean {\n\t\treturn this._anchor === this._end;\n\t}\n\n\ttoJSON() {\n\t\treturn {\n\t\t\tstart: this.start,\n\t\t\tend: this.end,\n\t\t\tactive: this.active,\n\t\t\tanchor: this.anchor\n\t\t};\n\t}\n}\n\nexport class ResolvedAuthority {\n\treadonly host: string;\n\treadonly port: number;\n\treadonly connectionToken: string | undefined;\n\n\tconstructor(host: string, port: number, connectionToken?: string) {\n\t\tif (typeof host !== 'string' || host.length === 0) {\n\t\t\tthrow illegalArgument('host');\n\t\t}\n\t\tif (typeof port !== 'number' || port === 0 || Math.round(port) !== port) {\n\t\t\tthrow illegalArgument('port');\n\t\t}\n\t\tif (typeof connectionToken !== 'undefined') {\n\t\t\tif (typeof connectionToken !== 'string' || connectionToken.length === 0 || !/^[0-9A-Za-z\\-]+$/.test(connectionToken)) {\n\t\t\t\tthrow illegalArgument('connectionToken');\n\t\t\t}\n\t\t}\n\t\tthis.host = host;\n\t\tthis.port = Math.round(port);\n\t\tthis.connectionToken = connectionToken;\n\t}\n}\n\nexport class RemoteAuthorityResolverError extends Error {\n\n\tstatic NotAvailable(message?: string, handled?: boolean): RemoteAuthorityResolverError {\n\t\treturn new RemoteAuthorityResolverError(message, RemoteAuthorityResolverErrorCode.NotAvailable, handled);\n\t}\n\n\tstatic TemporarilyNotAvailable(message?: string): RemoteAuthorityResolverError {\n\t\treturn new RemoteAuthorityResolverError(message, RemoteAuthorityResolverErrorCode.TemporarilyNotAvailable);\n\t}\n\n\tpublic readonly _message: string | undefined;\n\tpublic readonly _code: RemoteAuthorityResolverErrorCode;\n\tpublic readonly _detail: any;\n\n\tconstructor(message?: string, code: RemoteAuthorityResolverErrorCode = RemoteAuthorityResolverErrorCode.Unknown, detail?: any) {\n\t\tsuper(message);\n\n\t\tthis._message = message;\n\t\tthis._code = code;\n\t\tthis._detail = detail;\n\n\t\t// workaround when extending builtin objects and when compiling to ES5, see:\n\t\t// https://github.com/microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\n\t\tif (typeof (<any>Object).setPrototypeOf === 'function') {\n\t\t\t(<any>Object).setPrototypeOf(this, RemoteAuthorityResolverError.prototype);\n\t\t}\n\t}\n}\n\nexport enum EndOfLine {\n\tLF = 1,\n\tCRLF = 2\n}\n\nexport enum EnvironmentVariableMutatorType {\n\tReplace = 1,\n\tAppend = 2,\n\tPrepend = 3\n}\n\n@es5ClassCompat\nexport class TextEdit {\n\n\tstatic isTextEdit(thing: any): thing is TextEdit {\n\t\tif (thing instanceof TextEdit) {\n\t\t\treturn true;\n\t\t}\n\t\tif (!thing) {\n\t\t\treturn false;\n\t\t}\n\t\treturn Range.isRange((<TextEdit>thing))\n\t\t\t&& typeof (<TextEdit>thing).newText === 'string';\n\t}\n\n\tstatic replace(range: Range, newText: string): TextEdit {\n\t\treturn new TextEdit(range, newText);\n\t}\n\n\tstatic insert(position: Position, newText: string): TextEdit {\n\t\treturn TextEdit.replace(new Range(position, position), newText);\n\t}\n\n\tstatic delete(range: Range): TextEdit {\n\t\treturn TextEdit.replace(range, '');\n\t}\n\n\tstatic setEndOfLine(eol: EndOfLine): TextEdit {\n\t\tconst ret = new TextEdit(new Range(new Position(0, 0), new Position(0, 0)), '');\n\t\tret.newEol = eol;\n\t\treturn ret;\n\t}\n\n\tprotected _range: Range;\n\tprotected _newText: string | null;\n\tprotected _newEol?: EndOfLine;\n\n\tget range(): Range {\n\t\treturn this._range;\n\t}\n\n\tset range(value: Range) {\n\t\tif (value && !Range.isRange(value)) {\n\t\t\tthrow illegalArgument('range');\n\t\t}\n\t\tthis._range = value;\n\t}\n\n\tget newText(): string {\n\t\treturn this._newText || '';\n\t}\n\n\tset newText(value: string) {\n\t\tif (value && typeof value !== 'string') {\n\t\t\tthrow illegalArgument('newText');\n\t\t}\n\t\tthis._newText = value;\n\t}\n\n\tget newEol(): EndOfLine | undefined {\n\t\treturn this._newEol;\n\t}\n\n\tset newEol(value: EndOfLine | undefined) {\n\t\tif (value && typeof value !== 'number') {\n\t\t\tthrow illegalArgument('newEol');\n\t\t}\n\t\tthis._newEol = value;\n\t}\n\n\tconstructor(range: Range, newText: string | null) {\n\t\tthis._range = range;\n\t\tthis._newText = newText;\n\t}\n\n\ttoJSON(): any {\n\t\treturn {\n\t\t\trange: this.range,\n\t\t\tnewText: this.newText,\n\t\t\tnewEol: this._newEol\n\t\t};\n\t}\n}\n\nexport interface IFileOperationOptions {\n\toverwrite?: boolean;\n\tignoreIfExists?: boolean;\n\tignoreIfNotExists?: boolean;\n\trecursive?: boolean;\n}\n\nexport const enum FileEditType {\n\tFile = 1,\n\tText = 2,\n\tCell = 3\n}\n\nexport interface IFileOperation {\n\t_type: FileEditType.File;\n\tfrom?: URI;\n\tto?: URI;\n\toptions?: IFileOperationOptions;\n\tmetadata?: vscode.WorkspaceEditEntryMetadata;\n}\n\nexport interface IFileTextEdit {\n\t_type: FileEditType.Text;\n\turi: URI;\n\tedit: TextEdit;\n\tmetadata?: vscode.WorkspaceEditEntryMetadata;\n}\n\nexport interface IFileCellEdit {\n\t_type: FileEditType.Cell;\n\turi: URI;\n\tedit?: ICellEditOperation;\n\tnotebookMetadata?: vscode.NotebookDocumentMetadata;\n\tmetadata?: vscode.WorkspaceEditEntryMetadata;\n}\n\n@es5ClassCompat\nexport class WorkspaceEdit implements vscode.WorkspaceEdit {\n\n\tprivate readonly _edits = new Array<IFileOperation | IFileTextEdit | IFileCellEdit>();\n\n\n\t_allEntries(): ReadonlyArray<IFileTextEdit | IFileOperation | IFileCellEdit> {\n\t\treturn this._edits;\n\t}\n\n\t// --- file\n\n\trenameFile(from: vscode.Uri, to: vscode.Uri, options?: { overwrite?: boolean, ignoreIfExists?: boolean; }, metadata?: vscode.WorkspaceEditEntryMetadata): void {\n\t\tthis._edits.push({ _type: FileEditType.File, from, to, options, metadata });\n\t}\n\n\tcreateFile(uri: vscode.Uri, options?: { overwrite?: boolean, ignoreIfExists?: boolean; }, metadata?: vscode.WorkspaceEditEntryMetadata): void {\n\t\tthis._edits.push({ _type: FileEditType.File, from: undefined, to: uri, options, metadata });\n\t}\n\n\tdeleteFile(uri: vscode.Uri, options?: { recursive?: boolean, ignoreIfNotExists?: boolean; }, metadata?: vscode.WorkspaceEditEntryMetadata): void {\n\t\tthis._edits.push({ _type: FileEditType.File, from: uri, to: undefined, options, metadata });\n\t}\n\n\t// --- notebook\n\n\treplaceNotebookMetadata(uri: URI, value: vscode.NotebookDocumentMetadata, metadata?: vscode.WorkspaceEditEntryMetadata): void {\n\t\tthis._edits.push({ _type: FileEditType.Cell, metadata, uri, edit: { editType: CellEditType.DocumentMetadata, metadata: { ...notebookDocumentMetadataDefaults, ...value } }, notebookMetadata: value });\n\t}\n\n\treplaceNotebookCells(uri: URI, start: number, end: number, cells: vscode.NotebookCellData[], metadata?: vscode.WorkspaceEditEntryMetadata): void {\n\t\tif (start !== end || cells.length > 0) {\n\t\t\tthis._edits.push({ _type: FileEditType.Cell, metadata, uri, edit: { editType: CellEditType.Replace, index: start, count: end - start, cells: cells.map(cell => ({ ...cell, outputs: cell.outputs.map(output => addIdToOutput(output)) })) } });\n\t\t}\n\t}\n\n\treplaceNotebookCellOutput(uri: URI, index: number, outputs: (vscode.NotebookCellOutput | vscode.CellOutput)[], metadata?: vscode.WorkspaceEditEntryMetadata): void {\n\t\tthis._edits.push({\n\t\t\t_type: FileEditType.Cell, metadata, uri, edit: {\n\t\t\t\teditType: CellEditType.Output, index, outputs: outputs.map(output => {\n\t\t\t\t\tif (NotebookCellOutput.isNotebookCellOutput(output)) {\n\t\t\t\t\t\treturn addIdToOutput(output.toJSON());\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn addIdToOutput(output);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t});\n\t}\n\n\treplaceNotebookCellMetadata(uri: URI, index: number, cellMetadata: vscode.NotebookCellMetadata, metadata?: vscode.WorkspaceEditEntryMetadata): void {\n\t\tthis._edits.push({ _type: FileEditType.Cell, metadata, uri, edit: { editType: CellEditType.Metadata, index, metadata: cellMetadata } });\n\t}\n\n\t// --- text\n\n\treplace(uri: URI, range: Range, newText: string, metadata?: vscode.WorkspaceEditEntryMetadata): void {\n\t\tthis._edits.push({ _type: FileEditType.Text, uri, edit: new TextEdit(range, newText), metadata });\n\t}\n\n\tinsert(resource: URI, position: Position, newText: string, metadata?: vscode.WorkspaceEditEntryMetadata): void {\n\t\tthis.replace(resource, new Range(position, position), newText, metadata);\n\t}\n\n\tdelete(resource: URI, range: Range, metadata?: vscode.WorkspaceEditEntryMetadata): void {\n\t\tthis.replace(resource, range, '', metadata);\n\t}\n\n\t// --- text (Maplike)\n\n\thas(uri: URI): boolean {\n\t\treturn this._edits.some(edit => edit._type === FileEditType.Text && edit.uri.toString() === uri.toString());\n\t}\n\n\tset(uri: URI, edits: TextEdit[]): void {\n\t\tif (!edits) {\n\t\t\t// remove all text edits for `uri`\n\t\t\tfor (let i = 0; i < this._edits.length; i++) {\n\t\t\t\tconst element = this._edits[i];\n\t\t\t\tif (element._type === FileEditType.Text && element.uri.toString() === uri.toString()) {\n\t\t\t\t\tthis._edits[i] = undefined!; // will be coalesced down below\n\t\t\t\t}\n\t\t\t}\n\t\t\tcoalesceInPlace(this._edits);\n\t\t} else {\n\t\t\t// append edit to the end\n\t\t\tfor (const edit of edits) {\n\t\t\t\tif (edit) {\n\t\t\t\t\tthis._edits.push({ _type: FileEditType.Text, uri, edit });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tget(uri: URI): TextEdit[] {\n\t\tconst res: TextEdit[] = [];\n\t\tfor (let candidate of this._edits) {\n\t\t\tif (candidate._type === FileEditType.Text && candidate.uri.toString() === uri.toString()) {\n\t\t\t\tres.push(candidate.edit);\n\t\t\t}\n\t\t}\n\t\treturn res;\n\t}\n\n\tentries(): [URI, TextEdit[]][] {\n\t\tconst textEdits = new ResourceMap<[URI, TextEdit[]]>();\n\t\tfor (let candidate of this._edits) {\n\t\t\tif (candidate._type === FileEditType.Text) {\n\t\t\t\tlet textEdit = textEdits.get(candidate.uri);\n\t\t\t\tif (!textEdit) {\n\t\t\t\t\ttextEdit = [candidate.uri, []];\n\t\t\t\t\ttextEdits.set(candidate.uri, textEdit);\n\t\t\t\t}\n\t\t\t\ttextEdit[1].push(candidate.edit);\n\t\t\t}\n\t\t}\n\t\treturn [...textEdits.values()];\n\t}\n\n\tget size(): number {\n\t\treturn this.entries().length;\n\t}\n\n\ttoJSON(): any {\n\t\treturn this.entries();\n\t}\n}\n\n@es5ClassCompat\nexport class SnippetString {\n\n\tstatic isSnippetString(thing: any): thing is SnippetString {\n\t\tif (thing instanceof SnippetString) {\n\t\t\treturn true;\n\t\t}\n\t\tif (!thing) {\n\t\t\treturn false;\n\t\t}\n\t\treturn typeof (<SnippetString>thing).value === 'string';\n\t}\n\n\tprivate static _escape(value: string): string {\n\t\treturn value.replace(/\\$|}|\\\\/g, '\\\\$&');\n\t}\n\n\tprivate _tabstop: number = 1;\n\n\tvalue: string;\n\n\tconstructor(value?: string) {\n\t\tthis.value = value || '';\n\t}\n\n\tappendText(string: string): SnippetString {\n\t\tthis.value += SnippetString._escape(string);\n\t\treturn this;\n\t}\n\n\tappendTabstop(number: number = this._tabstop++): SnippetString {\n\t\tthis.value += '$';\n\t\tthis.value += number;\n\t\treturn this;\n\t}\n\n\tappendPlaceholder(value: string | ((snippet: SnippetString) => any), number: number = this._tabstop++): SnippetString {\n\n\t\tif (typeof value === 'function') {\n\t\t\tconst nested = new SnippetString();\n\t\t\tnested._tabstop = this._tabstop;\n\t\t\tvalue(nested);\n\t\t\tthis._tabstop = nested._tabstop;\n\t\t\tvalue = nested.value;\n\t\t} else {\n\t\t\tvalue = SnippetString._escape(value);\n\t\t}\n\n\t\tthis.value += '${';\n\t\tthis.value += number;\n\t\tthis.value += ':';\n\t\tthis.value += value;\n\t\tthis.value += '}';\n\n\t\treturn this;\n\t}\n\n\tappendChoice(values: string[], number: number = this._tabstop++): SnippetString {\n\t\tconst value = values.map(s => s.replace(/\\$|}|\\\\|,/g, '\\\\$&')).join(',');\n\n\t\tthis.value += '${';\n\t\tthis.value += number;\n\t\tthis.value += '|';\n\t\tthis.value += value;\n\t\tthis.value += '|}';\n\n\t\treturn this;\n\t}\n\n\tappendVariable(name: string, defaultValue?: string | ((snippet: SnippetString) => any)): SnippetString {\n\n\t\tif (typeof defaultValue === 'function') {\n\t\t\tconst nested = new SnippetString();\n\t\t\tnested._tabstop = this._tabstop;\n\t\t\tdefaultValue(nested);\n\t\t\tthis._tabstop = nested._tabstop;\n\t\t\tdefaultValue = nested.value;\n\n\t\t} else if (typeof defaultValue === 'string') {\n\t\t\tdefaultValue = defaultValue.replace(/\\$|}/g, '\\\\$&');\n\t\t}\n\n\t\tthis.value += '${';\n\t\tthis.value += name;\n\t\tif (defaultValue) {\n\t\t\tthis.value += ':';\n\t\t\tthis.value += defaultValue;\n\t\t}\n\t\tthis.value += '}';\n\n\n\t\treturn this;\n\t}\n}\n\nexport enum DiagnosticTag {\n\tUnnecessary = 1,\n\tDeprecated = 2\n}\n\nexport enum DiagnosticSeverity {\n\tHint = 3,\n\tInformation = 2,\n\tWarning = 1,\n\tError = 0\n}\n\n@es5ClassCompat\nexport class Location {\n\n\tstatic isLocation(thing: any): thing is Location {\n\t\tif (thing instanceof Location) {\n\t\t\treturn true;\n\t\t}\n\t\tif (!thing) {\n\t\t\treturn false;\n\t\t}\n\t\treturn Range.isRange((<Location>thing).range)\n\t\t\t&& URI.isUri((<Location>thing).uri);\n\t}\n\n\turi: URI;\n\trange!: Range;\n\n\tconstructor(uri: URI, rangeOrPosition: Range | Position) {\n\t\tthis.uri = uri;\n\n\t\tif (!rangeOrPosition) {\n\t\t\t//that's OK\n\t\t} else if (rangeOrPosition instanceof Range) {\n\t\t\tthis.range = rangeOrPosition;\n\t\t} else if (rangeOrPosition instanceof Position) {\n\t\t\tthis.range = new Range(rangeOrPosition, rangeOrPosition);\n\t\t} else {\n\t\t\tthrow new Error('Illegal argument');\n\t\t}\n\t}\n\n\ttoJSON(): any {\n\t\treturn {\n\t\t\turi: this.uri,\n\t\t\trange: this.range\n\t\t};\n\t}\n}\n\n@es5ClassCompat\nexport class DiagnosticRelatedInformation {\n\n\tstatic is(thing: any): thing is DiagnosticRelatedInformation {\n\t\tif (!thing) {\n\t\t\treturn false;\n\t\t}\n\t\treturn typeof (<DiagnosticRelatedInformation>thing).message === 'string'\n\t\t\t&& (<DiagnosticRelatedInformation>thing).location\n\t\t\t&& Range.isRange((<DiagnosticRelatedInformation>thing).location.range)\n\t\t\t&& URI.isUri((<DiagnosticRelatedInformation>thing).location.uri);\n\t}\n\n\tlocation: Location;\n\tmessage: string;\n\n\tconstructor(location: Location, message: string) {\n\t\tthis.location = location;\n\t\tthis.message = message;\n\t}\n\n\tstatic isEqual(a: DiagnosticRelatedInformation, b: DiagnosticRelatedInformation): boolean {\n\t\tif (a === b) {\n\t\t\treturn true;\n\t\t}\n\t\tif (!a || !b) {\n\t\t\treturn false;\n\t\t}\n\t\treturn a.message === b.message\n\t\t\t&& a.location.range.isEqual(b.location.range)\n\t\t\t&& a.location.uri.toString() === b.location.uri.toString();\n\t}\n}\n\n@es5ClassCompat\nexport class Diagnostic {\n\n\trange: Range;\n\tmessage: string;\n\tseverity: DiagnosticSeverity;\n\tsource?: string;\n\tcode?: string | number;\n\trelatedInformation?: DiagnosticRelatedInformation[];\n\ttags?: DiagnosticTag[];\n\n\tconstructor(range: Range, message: string, severity: DiagnosticSeverity = DiagnosticSeverity.Error) {\n\t\tif (!Range.isRange(range)) {\n\t\t\tthrow new TypeError('range must be set');\n\t\t}\n\t\tif (!message) {\n\t\t\tthrow new TypeError('message must be set');\n\t\t}\n\t\tthis.range = range;\n\t\tthis.message = message;\n\t\tthis.severity = severity;\n\t}\n\n\ttoJSON(): any {\n\t\treturn {\n\t\t\tseverity: DiagnosticSeverity[this.severity],\n\t\t\tmessage: this.message,\n\t\t\trange: this.range,\n\t\t\tsource: this.source,\n\t\t\tcode: this.code,\n\t\t};\n\t}\n\n\tstatic isEqual(a: Diagnostic | undefined, b: Diagnostic | undefined): boolean {\n\t\tif (a === b) {\n\t\t\treturn true;\n\t\t}\n\t\tif (!a || !b) {\n\t\t\treturn false;\n\t\t}\n\t\treturn a.message === b.message\n\t\t\t&& a.severity === b.severity\n\t\t\t&& a.code === b.code\n\t\t\t&& a.severity === b.severity\n\t\t\t&& a.source === b.source\n\t\t\t&& a.range.isEqual(b.range)\n\t\t\t&& equals(a.tags, b.tags)\n\t\t\t&& equals(a.relatedInformation, b.relatedInformation, DiagnosticRelatedInformation.isEqual);\n\t}\n}\n\n@es5ClassCompat\nexport class Hover {\n\n\tpublic contents: vscode.MarkdownString[] | vscode.MarkedString[];\n\tpublic range: Range | undefined;\n\n\tconstructor(\n\t\tcontents: vscode.MarkdownString | vscode.MarkedString | vscode.MarkdownString[] | vscode.MarkedString[],\n\t\trange?: Range\n\t) {\n\t\tif (!contents) {\n\t\t\tthrow new Error('Illegal argument, contents must be defined');\n\t\t}\n\t\tif (Array.isArray(contents)) {\n\t\t\tthis.contents = <vscode.MarkdownString[] | vscode.MarkedString[]>contents;\n\t\t} else if (isMarkdownString(contents)) {\n\t\t\tthis.contents = [contents];\n\t\t} else {\n\t\t\tthis.contents = [contents];\n\t\t}\n\t\tthis.range = range;\n\t}\n}\n\nexport enum DocumentHighlightKind {\n\tText = 0,\n\tRead = 1,\n\tWrite = 2\n}\n\n@es5ClassCompat\nexport class DocumentHighlight {\n\n\trange: Range;\n\tkind: DocumentHighlightKind;\n\n\tconstructor(range: Range, kind: DocumentHighlightKind = DocumentHighlightKind.Text) {\n\t\tthis.range = range;\n\t\tthis.kind = kind;\n\t}\n\n\ttoJSON(): any {\n\t\treturn {\n\t\t\trange: this.range,\n\t\t\tkind: DocumentHighlightKind[this.kind]\n\t\t};\n\t}\n}\n\nexport enum SymbolKind {\n\tFile = 0,\n\tModule = 1,\n\tNamespace = 2,\n\tPackage = 3,\n\tClass = 4,\n\tMethod = 5,\n\tProperty = 6,\n\tField = 7,\n\tConstructor = 8,\n\tEnum = 9,\n\tInterface = 10,\n\tFunction = 11,\n\tVariable = 12,\n\tConstant = 13,\n\tString = 14,\n\tNumber = 15,\n\tBoolean = 16,\n\tArray = 17,\n\tObject = 18,\n\tKey = 19,\n\tNull = 20,\n\tEnumMember = 21,\n\tStruct = 22,\n\tEvent = 23,\n\tOperator = 24,\n\tTypeParameter = 25\n}\n\nexport enum SymbolTag {\n\tDeprecated = 1,\n}\n\n@es5ClassCompat\nexport class SymbolInformation {\n\n\tstatic validate(candidate: SymbolInformation): void {\n\t\tif (!candidate.name) {\n\t\t\tthrow new Error('name must not be falsy');\n\t\t}\n\t}\n\n\tname: string;\n\tlocation!: Location;\n\tkind: SymbolKind;\n\ttags?: SymbolTag[];\n\tcontainerName: string | undefined;\n\n\tconstructor(name: string, kind: SymbolKind, containerName: string | undefined, location: Location);\n\tconstructor(name: string, kind: SymbolKind, range: Range, uri?: URI, containerName?: string);\n\tconstructor(name: string, kind: SymbolKind, rangeOrContainer: string | undefined | Range, locationOrUri?: Location | URI, containerName?: string) {\n\t\tthis.name = name;\n\t\tthis.kind = kind;\n\t\tthis.containerName = containerName;\n\n\t\tif (typeof rangeOrContainer === 'string') {\n\t\t\tthis.containerName = rangeOrContainer;\n\t\t}\n\n\t\tif (locationOrUri instanceof Location) {\n\t\t\tthis.location = locationOrUri;\n\t\t} else if (rangeOrContainer instanceof Range) {\n\t\t\tthis.location = new Location(locationOrUri!, rangeOrContainer);\n\t\t}\n\n\t\tSymbolInformation.validate(this);\n\t}\n\n\ttoJSON(): any {\n\t\treturn {\n\t\t\tname: this.name,\n\t\t\tkind: SymbolKind[this.kind],\n\t\t\tlocation: this.location,\n\t\t\tcontainerName: this.containerName\n\t\t};\n\t}\n}\n\n@es5ClassCompat\nexport class DocumentSymbol {\n\n\tstatic validate(candidate: DocumentSymbol): void {\n\t\tif (!candidate.name) {\n\t\t\tthrow new Error('name must not be falsy');\n\t\t}\n\t\tif (!candidate.range.contains(candidate.selectionRange)) {\n\t\t\tthrow new Error('selectionRange must be contained in fullRange');\n\t\t}\n\t\tif (candidate.children) {\n\t\t\tcandidate.children.forEach(DocumentSymbol.validate);\n\t\t}\n\t}\n\n\tname: string;\n\tdetail: string;\n\tkind: SymbolKind;\n\ttags?: SymbolTag[];\n\trange: Range;\n\tselectionRange: Range;\n\tchildren: DocumentSymbol[];\n\n\tconstructor(name: string, detail: string, kind: SymbolKind, range: Range, selectionRange: Range) {\n\t\tthis.name = name;\n\t\tthis.detail = detail;\n\t\tthis.kind = kind;\n\t\tthis.range = range;\n\t\tthis.selectionRange = selectionRange;\n\t\tthis.children = [];\n\n\t\tDocumentSymbol.validate(this);\n\t}\n}\n\n\nexport enum CodeActionTrigger {\n\tAutomatic = 1,\n\tManual = 2,\n}\n\n@es5ClassCompat\nexport class CodeAction {\n\ttitle: string;\n\n\tcommand?: vscode.Command;\n\n\tedit?: WorkspaceEdit;\n\n\tdiagnostics?: Diagnostic[];\n\n\tkind?: CodeActionKind;\n\n\tisPreferred?: boolean;\n\n\tconstructor(title: string, kind?: CodeActionKind) {\n\t\tthis.title = title;\n\t\tthis.kind = kind;\n\t}\n}\n\n\n@es5ClassCompat\nexport class CodeActionKind {\n\tprivate static readonly sep = '.';\n\n\tpublic static Empty: CodeActionKind;\n\tpublic static QuickFix: CodeActionKind;\n\tpublic static Refactor: CodeActionKind;\n\tpublic static RefactorExtract: CodeActionKind;\n\tpublic static RefactorInline: CodeActionKind;\n\tpublic static RefactorRewrite: CodeActionKind;\n\tpublic static Source: CodeActionKind;\n\tpublic static SourceOrganizeImports: CodeActionKind;\n\tpublic static SourceFixAll: CodeActionKind;\n\n\tconstructor(\n\t\tpublic readonly value: string\n\t) { }\n\n\tpublic append(parts: string): CodeActionKind {\n\t\treturn new CodeActionKind(this.value ? this.value + CodeActionKind.sep + parts : parts);\n\t}\n\n\tpublic intersects(other: CodeActionKind): boolean {\n\t\treturn this.contains(other) || other.contains(this);\n\t}\n\n\tpublic contains(other: CodeActionKind): boolean {\n\t\treturn this.value === other.value || other.value.startsWith(this.value + CodeActionKind.sep);\n\t}\n}\nCodeActionKind.Empty = new CodeActionKind('');\nCodeActionKind.QuickFix = CodeActionKind.Empty.append('quickfix');\nCodeActionKind.Refactor = CodeActionKind.Empty.append('refactor');\nCodeActionKind.RefactorExtract = CodeActionKind.Refactor.append('extract');\nCodeActionKind.RefactorInline = CodeActionKind.Refactor.append('inline');\nCodeActionKind.RefactorRewrite = CodeActionKind.Refactor.append('rewrite');\nCodeActionKind.Source = CodeActionKind.Empty.append('source');\nCodeActionKind.SourceOrganizeImports = CodeActionKind.Source.append('organizeImports');\nCodeActionKind.SourceFixAll = CodeActionKind.Source.append('fixAll');\n\n@es5ClassCompat\nexport class SelectionRange {\n\n\trange: Range;\n\tparent?: SelectionRange;\n\n\tconstructor(range: Range, parent?: SelectionRange) {\n\t\tthis.range = range;\n\t\tthis.parent = parent;\n\n\t\tif (parent && !parent.range.contains(this.range)) {\n\t\t\tthrow new Error('Invalid argument: parent must contain this range');\n\t\t}\n\t}\n}\n\nexport class CallHierarchyItem {\n\n\t_sessionId?: string;\n\t_itemId?: string;\n\n\tkind: SymbolKind;\n\tname: string;\n\tdetail?: string;\n\turi: URI;\n\trange: Range;\n\tselectionRange: Range;\n\n\tconstructor(kind: SymbolKind, name: string, detail: string, uri: URI, range: Range, selectionRange: Range) {\n\t\tthis.kind = kind;\n\t\tthis.name = name;\n\t\tthis.detail = detail;\n\t\tthis.uri = uri;\n\t\tthis.range = range;\n\t\tthis.selectionRange = selectionRange;\n\t}\n}\n\nexport class CallHierarchyIncomingCall {\n\n\tfrom: vscode.CallHierarchyItem;\n\tfromRanges: vscode.Range[];\n\n\tconstructor(item: vscode.CallHierarchyItem, fromRanges: vscode.Range[]) {\n\t\tthis.fromRanges = fromRanges;\n\t\tthis.from = item;\n\t}\n}\nexport class CallHierarchyOutgoingCall {\n\n\tto: vscode.CallHierarchyItem;\n\tfromRanges: vscode.Range[];\n\n\tconstructor(item: vscode.CallHierarchyItem, fromRanges: vscode.Range[]) {\n\t\tthis.fromRanges = fromRanges;\n\t\tthis.to = item;\n\t}\n}\n\n@es5ClassCompat\nexport class CodeLens {\n\n\trange: Range;\n\n\tcommand: vscode.Command | undefined;\n\n\tconstructor(range: Range, command?: vscode.Command) {\n\t\tthis.range = range;\n\t\tthis.command = command;\n\t}\n\n\tget isResolved(): boolean {\n\t\treturn !!this.command;\n\t}\n}\n\n@es5ClassCompat\nexport class MarkdownString implements vscode.MarkdownString {\n\n\treadonly #delegate: BaseMarkdownString;\n\n\tstatic isMarkdownString(thing: any): thing is vscode.MarkdownString {\n\t\tif (thing instanceof MarkdownString) {\n\t\t\treturn true;\n\t\t}\n\t\treturn thing && thing.appendCodeblock && thing.appendMarkdown && thing.appendText && (thing.value !== undefined);\n\t}\n\n\tconstructor(value?: string, supportThemeIcons: boolean = false) {\n\t\tthis.#delegate = new BaseMarkdownString(value, { supportThemeIcons });\n\t}\n\n\tget value(): string {\n\t\treturn this.#delegate.value;\n\t}\n\tset value(value: string) {\n\t\tthis.#delegate.value = value;\n\t}\n\n\tget isTrusted(): boolean | undefined {\n\t\treturn this.#delegate.isTrusted;\n\t}\n\n\tset isTrusted(value: boolean | undefined) {\n\t\tthis.#delegate.isTrusted = value;\n\t}\n\n\tget supportThemeIcons(): boolean | undefined {\n\t\treturn this.#delegate.supportThemeIcons;\n\t}\n\n\tappendText(value: string): vscode.MarkdownString {\n\t\tthis.#delegate.appendText(value);\n\t\treturn this;\n\t}\n\n\tappendMarkdown(value: string): vscode.MarkdownString {\n\t\tthis.#delegate.appendMarkdown(value);\n\t\treturn this;\n\t}\n\n\tappendCodeblock(value: string, language?: string): vscode.MarkdownString {\n\t\tthis.#delegate.appendCodeblock(language ?? '', value);\n\t\treturn this;\n\t}\n\n\n}\n\n@es5ClassCompat\nexport class ParameterInformation {\n\n\tlabel: string | [number, number];\n\tdocumentation?: string | vscode.MarkdownString;\n\n\tconstructor(label: string | [number, number], documentation?: string | vscode.MarkdownString) {\n\t\tthis.label = label;\n\t\tthis.documentation = documentation;\n\t}\n}\n\n@es5ClassCompat\nexport class SignatureInformation {\n\n\tlabel: string;\n\tdocumentation?: string | vscode.MarkdownString;\n\tparameters: ParameterInformation[];\n\tactiveParameter?: number;\n\n\tconstructor(label: string, documentation?: string | vscode.MarkdownString) {\n\t\tthis.label = label;\n\t\tthis.documentation = documentation;\n\t\tthis.parameters = [];\n\t}\n}\n\n@es5ClassCompat\nexport class SignatureHelp {\n\n\tsignatures: SignatureInformation[];\n\tactiveSignature: number = 0;\n\tactiveParameter: number = 0;\n\n\tconstructor() {\n\t\tthis.signatures = [];\n\t}\n}\n\nexport enum SignatureHelpTriggerKind {\n\tInvoke = 1,\n\tTriggerCharacter = 2,\n\tContentChange = 3,\n}\n\n@es5ClassCompat\nexport class InlineHint {\n\ttext: string;\n\trange: Range;\n\tdescription?: string | vscode.MarkdownString;\n\twhitespaceBefore?: boolean;\n\twhitespaceAfter?: boolean;\n\n\tconstructor(text: string, range: Range, description?: string | vscode.MarkdownString, whitespaceBefore?: boolean, whitespaceAfter?: boolean) {\n\t\tthis.text = text;\n\t\tthis.range = range;\n\t\tthis.description = description;\n\t\tthis.whitespaceBefore = whitespaceBefore;\n\t\tthis.whitespaceAfter = whitespaceAfter;\n\t}\n}\n\nexport enum CompletionTriggerKind {\n\tInvoke = 0,\n\tTriggerCharacter = 1,\n\tTriggerForIncompleteCompletions = 2\n}\n\nexport interface CompletionContext {\n\treadonly triggerKind: CompletionTriggerKind;\n\treadonly triggerCharacter?: string;\n}\n\nexport enum CompletionItemKind {\n\tText = 0,\n\tMethod = 1,\n\tFunction = 2,\n\tConstructor = 3,\n\tField = 4,\n\tVariable = 5,\n\tClass = 6,\n\tInterface = 7,\n\tModule = 8,\n\tProperty = 9,\n\tUnit = 10,\n\tValue = 11,\n\tEnum = 12,\n\tKeyword = 13,\n\tSnippet = 14,\n\tColor = 15,\n\tFile = 16,\n\tReference = 17,\n\tFolder = 18,\n\tEnumMember = 19,\n\tConstant = 20,\n\tStruct = 21,\n\tEvent = 22,\n\tOperator = 23,\n\tTypeParameter = 24,\n\tUser = 25,\n\tIssue = 26\n}\n\nexport enum CompletionItemTag {\n\tDeprecated = 1,\n}\n\nexport interface CompletionItemLabel {\n\tname: string;\n\tparameters?: string;\n\tqualifier?: string;\n\ttype?: string;\n}\n\n\n@es5ClassCompat\nexport class CompletionItem implements vscode.CompletionItem {\n\n\tlabel: string;\n\tlabel2?: CompletionItemLabel;\n\tkind?: CompletionItemKind;\n\ttags?: CompletionItemTag[];\n\tdetail?: string;\n\tdocumentation?: string | vscode.MarkdownString;\n\tsortText?: string;\n\tfilterText?: string;\n\tpreselect?: boolean;\n\tinsertText?: string | SnippetString;\n\tkeepWhitespace?: boolean;\n\trange?: Range | { inserting: Range; replacing: Range; };\n\tcommitCharacters?: string[];\n\ttextEdit?: TextEdit;\n\tadditionalTextEdits?: TextEdit[];\n\tcommand?: vscode.Command;\n\n\tconstructor(label: string, kind?: CompletionItemKind) {\n\t\tthis.label = label;\n\t\tthis.kind = kind;\n\t}\n\n\ttoJSON(): any {\n\t\treturn {\n\t\t\tlabel: this.label,\n\t\t\tlabel2: this.label2,\n\t\t\tkind: this.kind && CompletionItemKind[this.kind],\n\t\t\tdetail: this.detail,\n\t\t\tdocumentation: this.documentation,\n\t\t\tsortText: this.sortText,\n\t\t\tfilterText: this.filterText,\n\t\t\tpreselect: this.preselect,\n\t\t\tinsertText: this.insertText,\n\t\t\ttextEdit: this.textEdit\n\t\t};\n\t}\n}\n\n@es5ClassCompat\nexport class CompletionList {\n\n\tisIncomplete?: boolean;\n\titems: vscode.CompletionItem[];\n\n\tconstructor(items: vscode.CompletionItem[] = [], isIncomplete: boolean = false) {\n\t\tthis.items = items;\n\t\tthis.isIncomplete = isIncomplete;\n\t}\n}\n\nexport enum ViewColumn {\n\tActive = -1,\n\tBeside = -2,\n\tOne = 1,\n\tTwo = 2,\n\tThree = 3,\n\tFour = 4,\n\tFive = 5,\n\tSix = 6,\n\tSeven = 7,\n\tEight = 8,\n\tNine = 9\n}\n\nexport enum StatusBarAlignment {\n\tLeft = 1,\n\tRight = 2\n}\n\nexport enum TextEditorLineNumbersStyle {\n\tOff = 0,\n\tOn = 1,\n\tRelative = 2\n}\n\nexport enum TextDocumentSaveReason {\n\tManual = 1,\n\tAfterDelay = 2,\n\tFocusOut = 3\n}\n\nexport enum TextEditorRevealType {\n\tDefault = 0,\n\tInCenter = 1,\n\tInCenterIfOutsideViewport = 2,\n\tAtTop = 3\n}\n\nexport enum TextEditorSelectionChangeKind {\n\tKeyboard = 1,\n\tMouse = 2,\n\tCommand = 3\n}\n\n/**\n * These values match very carefully the values of `TrackedRangeStickiness`\n */\nexport enum DecorationRangeBehavior {\n\t/**\n\t * TrackedRangeStickiness.AlwaysGrowsWhenTypingAtEdges\n\t */\n\tOpenOpen = 0,\n\t/**\n\t * TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges\n\t */\n\tClosedClosed = 1,\n\t/**\n\t * TrackedRangeStickiness.GrowsOnlyWhenTypingBefore\n\t */\n\tOpenClosed = 2,\n\t/**\n\t * TrackedRangeStickiness.GrowsOnlyWhenTypingAfter\n\t */\n\tClosedOpen = 3\n}\n\nexport namespace TextEditorSelectionChangeKind {\n\texport function fromValue(s: string | undefined) {\n\t\tswitch (s) {\n\t\t\tcase 'keyboard': return TextEditorSelectionChangeKind.Keyboard;\n\t\t\tcase 'mouse': return TextEditorSelectionChangeKind.Mouse;\n\t\t\tcase 'api': return TextEditorSelectionChangeKind.Command;\n\t\t}\n\t\treturn undefined;\n\t}\n}\n\n@es5ClassCompat\nexport class DocumentLink {\n\n\trange: Range;\n\n\ttarget?: URI;\n\n\ttooltip?: string;\n\n\tconstructor(range: Range, target: URI | undefined) {\n\t\tif (target && !(URI.isUri(target))) {\n\t\t\tthrow illegalArgument('target');\n\t\t}\n\t\tif (!Range.isRange(range) || range.isEmpty) {\n\t\t\tthrow illegalArgument('range');\n\t\t}\n\t\tthis.range = range;\n\t\tthis.target = target;\n\t}\n}\n\n@es5ClassCompat\nexport class Color {\n\treadonly red: number;\n\treadonly green: number;\n\treadonly blue: number;\n\treadonly alpha: number;\n\n\tconstructor(red: number, green: number, blue: number, alpha: number) {\n\t\tthis.red = red;\n\t\tthis.green = green;\n\t\tthis.blue = blue;\n\t\tthis.alpha = alpha;\n\t}\n}\n\nexport type IColorFormat = string | { opaque: string, transparent: string; };\n\n@es5ClassCompat\nexport class ColorInformation {\n\trange: Range;\n\n\tcolor: Color;\n\n\tconstructor(range: Range, color: Color) {\n\t\tif (color && !(color instanceof Color)) {\n\t\t\tthrow illegalArgument('color');\n\t\t}\n\t\tif (!Range.isRange(range) || range.isEmpty) {\n\t\t\tthrow illegalArgument('range');\n\t\t}\n\t\tthis.range = range;\n\t\tthis.color = color;\n\t}\n}\n\n@es5ClassCompat\nexport class ColorPresentation {\n\tlabel: string;\n\ttextEdit?: TextEdit;\n\tadditionalTextEdits?: TextEdit[];\n\n\tconstructor(label: string) {\n\t\tif (!label || typeof label !== 'string') {\n\t\t\tthrow illegalArgument('label');\n\t\t}\n\t\tthis.label = label;\n\t}\n}\n\nexport enum ColorFormat {\n\tRGB = 0,\n\tHEX = 1,\n\tHSL = 2\n}\n\nexport enum SourceControlInputBoxValidationType {\n\tError = 0,\n\tWarning = 1,\n\tInformation = 2\n}\n\nexport enum TaskRevealKind {\n\tAlways = 1,\n\n\tSilent = 2,\n\n\tNever = 3\n}\n\nexport enum TaskPanelKind {\n\tShared = 1,\n\n\tDedicated = 2,\n\n\tNew = 3\n}\n\n@es5ClassCompat\nexport class TaskGroup implements vscode.TaskGroup {\n\n\tprivate _id: string;\n\n\tpublic static Clean: TaskGroup = new TaskGroup('clean', 'Clean');\n\n\tpublic static Build: TaskGroup = new TaskGroup('build', 'Build');\n\n\tpublic static Rebuild: TaskGroup = new TaskGroup('rebuild', 'Rebuild');\n\n\tpublic static Test: TaskGroup = new TaskGroup('test', 'Test');\n\n\tpublic static from(value: string) {\n\t\tswitch (value) {\n\t\t\tcase 'clean':\n\t\t\t\treturn TaskGroup.Clean;\n\t\t\tcase 'build':\n\t\t\t\treturn TaskGroup.Build;\n\t\t\tcase 'rebuild':\n\t\t\t\treturn TaskGroup.Rebuild;\n\t\t\tcase 'test':\n\t\t\t\treturn TaskGroup.Test;\n\t\t\tdefault:\n\t\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tconstructor(id: string, _label: string) {\n\t\tif (typeof id !== 'string') {\n\t\t\tthrow illegalArgument('name');\n\t\t}\n\t\tif (typeof _label !== 'string') {\n\t\t\tthrow illegalArgument('name');\n\t\t}\n\t\tthis._id = id;\n\t}\n\n\tget id(): string {\n\t\treturn this._id;\n\t}\n}\n\nfunction computeTaskExecutionId(values: string[]): string {\n\tlet id: string = '';\n\tfor (let i = 0; i < values.length; i++) {\n\t\tid += values[i].replace(/,/g, ',,') + ',';\n\t}\n\treturn id;\n}\n\n@es5ClassCompat\nexport class ProcessExecution implements vscode.ProcessExecution {\n\n\tprivate _process: string;\n\tprivate _args: string[];\n\tprivate _options: vscode.ProcessExecutionOptions | undefined;\n\n\tconstructor(process: string, options?: vscode.ProcessExecutionOptions);\n\tconstructor(process: string, args: string[], options?: vscode.ProcessExecutionOptions);\n\tconstructor(process: string, varg1?: string[] | vscode.ProcessExecutionOptions, varg2?: vscode.ProcessExecutionOptions) {\n\t\tif (typeof process !== 'string') {\n\t\t\tthrow illegalArgument('process');\n\t\t}\n\t\tthis._args = [];\n\t\tthis._process = process;\n\t\tif (varg1 !== undefined) {\n\t\t\tif (Array.isArray(varg1)) {\n\t\t\t\tthis._args = varg1;\n\t\t\t\tthis._options = varg2;\n\t\t\t} else {\n\t\t\t\tthis._options = varg1;\n\t\t\t}\n\t\t}\n\t}\n\n\n\tget process(): string {\n\t\treturn this._process;\n\t}\n\n\tset process(value: string) {\n\t\tif (typeof value !== 'string') {\n\t\t\tthrow illegalArgument('process');\n\t\t}\n\t\tthis._process = value;\n\t}\n\n\tget args(): string[] {\n\t\treturn this._args;\n\t}\n\n\tset args(value: string[]) {\n\t\tif (!Array.isArray(value)) {\n\t\t\tvalue = [];\n\t\t}\n\t\tthis._args = value;\n\t}\n\n\tget options(): vscode.ProcessExecutionOptions | undefined {\n\t\treturn this._options;\n\t}\n\n\tset options(value: vscode.ProcessExecutionOptions | undefined) {\n\t\tthis._options = value;\n\t}\n\n\tpublic computeId(): string {\n\t\tconst props: string[] = [];\n\t\tprops.push('process');\n\t\tif (this._process !== undefined) {\n\t\t\tprops.push(this._process);\n\t\t}\n\t\tif (this._args && this._args.length > 0) {\n\t\t\tfor (let arg of this._args) {\n\t\t\t\tprops.push(arg);\n\t\t\t}\n\t\t}\n\t\treturn computeTaskExecutionId(props);\n\t}\n}\n\n@es5ClassCompat\nexport class ShellExecution implements vscode.ShellExecution {\n\n\tprivate _commandLine: string | undefined;\n\tprivate _command: string | vscode.ShellQuotedString | undefined;\n\tprivate _args: (string | vscode.ShellQuotedString)[] = [];\n\tprivate _options: vscode.ShellExecutionOptions | undefined;\n\n\tconstructor(commandLine: string, options?: vscode.ShellExecutionOptions);\n\tconstructor(command: string | vscode.ShellQuotedString, args: (string | vscode.ShellQuotedString)[], options?: vscode.ShellExecutionOptions);\n\tconstructor(arg0: string | vscode.ShellQuotedString, arg1?: vscode.ShellExecutionOptions | (string | vscode.ShellQuotedString)[], arg2?: vscode.ShellExecutionOptions) {\n\t\tif (Array.isArray(arg1)) {\n\t\t\tif (!arg0) {\n\t\t\t\tthrow illegalArgument('command can\\'t be undefined or null');\n\t\t\t}\n\t\t\tif (typeof arg0 !== 'string' && typeof arg0.value !== 'string') {\n\t\t\t\tthrow illegalArgument('command');\n\t\t\t}\n\t\t\tthis._command = arg0;\n\t\t\tthis._args = arg1 as (string | vscode.ShellQuotedString)[];\n\t\t\tthis._options = arg2;\n\t\t} else {\n\t\t\tif (typeof arg0 !== 'string') {\n\t\t\t\tthrow illegalArgument('commandLine');\n\t\t\t}\n\t\t\tthis._commandLine = arg0;\n\t\t\tthis._options = arg1;\n\t\t}\n\t}\n\n\tget commandLine(): string | undefined {\n\t\treturn this._commandLine;\n\t}\n\n\tset commandLine(value: string | undefined) {\n\t\tif (typeof value !== 'string') {\n\t\t\tthrow illegalArgument('commandLine');\n\t\t}\n\t\tthis._commandLine = value;\n\t}\n\n\tget command(): string | vscode.ShellQuotedString {\n\t\treturn this._command ? this._command : '';\n\t}\n\n\tset command(value: string | vscode.ShellQuotedString) {\n\t\tif (typeof value !== 'string' && typeof value.value !== 'string') {\n\t\t\tthrow illegalArgument('command');\n\t\t}\n\t\tthis._command = value;\n\t}\n\n\tget args(): (string | vscode.ShellQuotedString)[] {\n\t\treturn this._args;\n\t}\n\n\tset args(value: (string | vscode.ShellQuotedString)[]) {\n\t\tthis._args = value || [];\n\t}\n\n\tget options(): vscode.ShellExecutionOptions | undefined {\n\t\treturn this._options;\n\t}\n\n\tset options(value: vscode.ShellExecutionOptions | undefined) {\n\t\tthis._options = value;\n\t}\n\n\tpublic computeId(): string {\n\t\tconst props: string[] = [];\n\t\tprops.push('shell');\n\t\tif (this._commandLine !== undefined) {\n\t\t\tprops.push(this._commandLine);\n\t\t}\n\t\tif (this._command !== undefined) {\n\t\t\tprops.push(typeof this._command === 'string' ? this._command : this._command.value);\n\t\t}\n\t\tif (this._args && this._args.length > 0) {\n\t\t\tfor (let arg of this._args) {\n\t\t\t\tprops.push(typeof arg === 'string' ? arg : arg.value);\n\t\t\t}\n\t\t}\n\t\treturn computeTaskExecutionId(props);\n\t}\n}\n\nexport enum ShellQuoting {\n\tEscape = 1,\n\tStrong = 2,\n\tWeak = 3\n}\n\nexport enum TaskScope {\n\tGlobal = 1,\n\tWorkspace = 2\n}\n\nexport class CustomExecution implements vscode.CustomExecution {\n\tprivate _callback: (resolvedDefintion: vscode.TaskDefinition) => Thenable<vscode.Pseudoterminal>;\n\tconstructor(callback: (resolvedDefintion: vscode.TaskDefinition) => Thenable<vscode.Pseudoterminal>) {\n\t\tthis._callback = callback;\n\t}\n\tpublic computeId(): string {\n\t\treturn 'customExecution' + generateUuid();\n\t}\n\n\tpublic set callback(value: (resolvedDefintion: vscode.TaskDefinition) => Thenable<vscode.Pseudoterminal>) {\n\t\tthis._callback = value;\n\t}\n\n\tpublic get callback(): ((resolvedDefintion: vscode.TaskDefinition) => Thenable<vscode.Pseudoterminal>) {\n\t\treturn this._callback;\n\t}\n}\n\n@es5ClassCompat\nexport class Task implements vscode.Task {\n\n\tprivate static ExtensionCallbackType: string = 'customExecution';\n\tprivate static ProcessType: string = 'process';\n\tprivate static ShellType: string = 'shell';\n\tprivate static EmptyType: string = '$empty';\n\n\tprivate __id: string | undefined;\n\tprivate __deprecated: boolean = false;\n\n\tprivate _definition: vscode.TaskDefinition;\n\tprivate _scope: vscode.TaskScope.Global | vscode.TaskScope.Workspace | vscode.WorkspaceFolder | undefined;\n\tprivate _name: string;\n\tprivate _execution: ProcessExecution | ShellExecution | CustomExecution | undefined;\n\tprivate _problemMatchers: string[];\n\tprivate _hasDefinedMatchers: boolean;\n\tprivate _isBackground: boolean;\n\tprivate _source: string;\n\tprivate _group: TaskGroup | undefined;\n\tprivate _presentationOptions: vscode.TaskPresentationOptions;\n\tprivate _runOptions: vscode.RunOptions;\n\tprivate _detail: string | undefined;\n\n\tconstructor(definition: vscode.TaskDefinition, name: string, source: string, execution?: ProcessExecution | ShellExecution | CustomExecution, problemMatchers?: string | string[]);\n\tconstructor(definition: vscode.TaskDefinition, scope: vscode.TaskScope.Global | vscode.TaskScope.Workspace | vscode.WorkspaceFolder, name: string, source: string, execution?: ProcessExecution | ShellExecution | CustomExecution, problemMatchers?: string | string[]);\n\tconstructor(definition: vscode.TaskDefinition, arg2: string | (vscode.TaskScope.Global | vscode.TaskScope.Workspace) | vscode.WorkspaceFolder, arg3: any, arg4?: any, arg5?: any, arg6?: any) {\n\t\tthis._definition = this.definition = definition;\n\t\tlet problemMatchers: string | string[];\n\t\tif (typeof arg2 === 'string') {\n\t\t\tthis._name = this.name = arg2;\n\t\t\tthis._source = this.source = arg3;\n\t\t\tthis.execution = arg4;\n\t\t\tproblemMatchers = arg5;\n\t\t\tthis.__deprecated = true;\n\t\t} else if (arg2 === TaskScope.Global || arg2 === TaskScope.Workspace) {\n\t\t\tthis.target = arg2;\n\t\t\tthis._name = this.name = arg3;\n\t\t\tthis._source = this.source = arg4;\n\t\t\tthis.execution = arg5;\n\t\t\tproblemMatchers = arg6;\n\t\t} else {\n\t\t\tthis.target = arg2;\n\t\t\tthis._name = this.name = arg3;\n\t\t\tthis._source = this.source = arg4;\n\t\t\tthis.execution = arg5;\n\t\t\tproblemMatchers = arg6;\n\t\t}\n\t\tif (typeof problemMatchers === 'string') {\n\t\t\tthis._problemMatchers = [problemMatchers];\n\t\t\tthis._hasDefinedMatchers = true;\n\t\t} else if (Array.isArray(problemMatchers)) {\n\t\t\tthis._problemMatchers = problemMatchers;\n\t\t\tthis._hasDefinedMatchers = true;\n\t\t} else {\n\t\t\tthis._problemMatchers = [];\n\t\t\tthis._hasDefinedMatchers = false;\n\t\t}\n\t\tthis._isBackground = false;\n\t\tthis._presentationOptions = Object.create(null);\n\t\tthis._runOptions = Object.create(null);\n\t}\n\n\tget _id(): string | undefined {\n\t\treturn this.__id;\n\t}\n\n\tset _id(value: string | undefined) {\n\t\tthis.__id = value;\n\t}\n\n\tget _deprecated(): boolean {\n\t\treturn this.__deprecated;\n\t}\n\n\tprivate clear(): void {\n\t\tif (this.__id === undefined) {\n\t\t\treturn;\n\t\t}\n\t\tthis.__id = undefined;\n\t\tthis._scope = undefined;\n\t\tthis.computeDefinitionBasedOnExecution();\n\t}\n\n\tprivate computeDefinitionBasedOnExecution(): void {\n\t\tif (this._execution instanceof ProcessExecution) {\n\t\t\tthis._definition = {\n\t\t\t\ttype: Task.ProcessType,\n\t\t\t\tid: this._execution.computeId()\n\t\t\t};\n\t\t} else if (this._execution instanceof ShellExecution) {\n\t\t\tthis._definition = {\n\t\t\t\ttype: Task.ShellType,\n\t\t\t\tid: this._execution.computeId()\n\t\t\t};\n\t\t} else if (this._execution instanceof CustomExecution) {\n\t\t\tthis._definition = {\n\t\t\t\ttype: Task.ExtensionCallbackType,\n\t\t\t\tid: this._execution.computeId()\n\t\t\t};\n\t\t} else {\n\t\t\tthis._definition = {\n\t\t\t\ttype: Task.EmptyType,\n\t\t\t\tid: generateUuid()\n\t\t\t};\n\t\t}\n\t}\n\n\tget definition(): vscode.TaskDefinition {\n\t\treturn this._definition;\n\t}\n\n\tset definition(value: vscode.TaskDefinition) {\n\t\tif (value === undefined || value === null) {\n\t\t\tthrow illegalArgument('Kind can\\'t be undefined or null');\n\t\t}\n\t\tthis.clear();\n\t\tthis._definition = value;\n\t}\n\n\tget scope(): vscode.TaskScope.Global | vscode.TaskScope.Workspace | vscode.WorkspaceFolder | undefined {\n\t\treturn this._scope;\n\t}\n\n\tset target(value: vscode.TaskScope.Global | vscode.TaskScope.Workspace | vscode.WorkspaceFolder) {\n\t\tthis.clear();\n\t\tthis._scope = value;\n\t}\n\n\tget name(): string {\n\t\treturn this._name;\n\t}\n\n\tset name(value: string) {\n\t\tif (typeof value !== 'string') {\n\t\t\tthrow illegalArgument('name');\n\t\t}\n\t\tthis.clear();\n\t\tthis._name = value;\n\t}\n\n\tget execution(): ProcessExecution | ShellExecution | CustomExecution | undefined {\n\t\treturn this._execution;\n\t}\n\n\tset execution(value: ProcessExecution | ShellExecution | CustomExecution | undefined) {\n\t\tif (value === null) {\n\t\t\tvalue = undefined;\n\t\t}\n\t\tthis.clear();\n\t\tthis._execution = value;\n\t\tconst type = this._definition.type;\n\t\tif (Task.EmptyType === type || Task.ProcessType === type || Task.ShellType === type || Task.ExtensionCallbackType === type) {\n\t\t\tthis.computeDefinitionBasedOnExecution();\n\t\t}\n\t}\n\n\tget problemMatchers(): string[] {\n\t\treturn this._problemMatchers;\n\t}\n\n\tset problemMatchers(value: string[]) {\n\t\tif (!Array.isArray(value)) {\n\t\t\tthis.clear();\n\t\t\tthis._problemMatchers = [];\n\t\t\tthis._hasDefinedMatchers = false;\n\t\t\treturn;\n\t\t} else {\n\t\t\tthis.clear();\n\t\t\tthis._problemMatchers = value;\n\t\t\tthis._hasDefinedMatchers = true;\n\t\t}\n\t}\n\n\tget hasDefinedMatchers(): boolean {\n\t\treturn this._hasDefinedMatchers;\n\t}\n\n\tget isBackground(): boolean {\n\t\treturn this._isBackground;\n\t}\n\n\tset isBackground(value: boolean) {\n\t\tif (value !== true && value !== false) {\n\t\t\tvalue = false;\n\t\t}\n\t\tthis.clear();\n\t\tthis._isBackground = value;\n\t}\n\n\tget source(): string {\n\t\treturn this._source;\n\t}\n\n\tset source(value: string) {\n\t\tif (typeof value !== 'string' || value.length === 0) {\n\t\t\tthrow illegalArgument('source must be a string of length > 0');\n\t\t}\n\t\tthis.clear();\n\t\tthis._source = value;\n\t}\n\n\tget group(): TaskGroup | undefined {\n\t\treturn this._group;\n\t}\n\n\tset group(value: TaskGroup | undefined) {\n\t\tif (value === null) {\n\t\t\tvalue = undefined;\n\t\t}\n\t\tthis.clear();\n\t\tthis._group = value;\n\t}\n\n\tget detail(): string | undefined {\n\t\treturn this._detail;\n\t}\n\n\tset detail(value: string | undefined) {\n\t\tif (value === null) {\n\t\t\tvalue = undefined;\n\t\t}\n\t\tthis._detail = value;\n\t}\n\n\tget presentationOptions(): vscode.TaskPresentationOptions {\n\t\treturn this._presentationOptions;\n\t}\n\n\tset presentationOptions(value: vscode.TaskPresentationOptions) {\n\t\tif (value === null || value === undefined) {\n\t\t\tvalue = Object.create(null);\n\t\t}\n\t\tthis.clear();\n\t\tthis._presentationOptions = value;\n\t}\n\n\tget runOptions(): vscode.RunOptions {\n\t\treturn this._runOptions;\n\t}\n\n\tset runOptions(value: vscode.RunOptions) {\n\t\tif (value === null || value === undefined) {\n\t\t\tvalue = Object.create(null);\n\t\t}\n\t\tthis.clear();\n\t\tthis._runOptions = value;\n\t}\n}\n\n\nexport enum ProgressLocation {\n\tSourceControl = 1,\n\tWindow = 10,\n\tNotification = 15\n}\n\n@es5ClassCompat\nexport class TreeItem {\n\n\tlabel?: string | vscode.TreeItemLabel;\n\tresourceUri?: URI;\n\ticonPath?: string | URI | { light: string | URI; dark: string | URI; };\n\tcommand?: vscode.Command;\n\tcontextValue?: string;\n\ttooltip?: string | vscode.MarkdownString;\n\n\tconstructor(label: string | vscode.TreeItemLabel, collapsibleState?: vscode.TreeItemCollapsibleState);\n\tconstructor(resourceUri: URI, collapsibleState?: vscode.TreeItemCollapsibleState);\n\tconstructor(arg1: string | vscode.TreeItemLabel | URI, public collapsibleState: vscode.TreeItemCollapsibleState = TreeItemCollapsibleState.None) {\n\t\tif (URI.isUri(arg1)) {\n\t\t\tthis.resourceUri = arg1;\n\t\t} else {\n\t\t\tthis.label = arg1;\n\t\t}\n\t}\n\n}\n\nexport enum TreeItemCollapsibleState {\n\tNone = 0,\n\tCollapsed = 1,\n\tExpanded = 2\n}\n\n@es5ClassCompat\nexport class ThemeIcon {\n\n\tstatic File: ThemeIcon;\n\tstatic Folder: ThemeIcon;\n\n\treadonly id: string;\n\treadonly color?: ThemeColor;\n\n\tconstructor(id: string, color?: ThemeColor) {\n\t\tthis.id = id;\n\t\tthis.color = color;\n\t}\n}\nThemeIcon.File = new ThemeIcon('file');\nThemeIcon.Folder = new ThemeIcon('folder');\n\n\n@es5ClassCompat\nexport class ThemeColor {\n\tid: string;\n\tconstructor(id: string) {\n\t\tthis.id = id;\n\t}\n}\n\nexport enum ConfigurationTarget {\n\tGlobal = 1,\n\n\tWorkspace = 2,\n\n\tWorkspaceFolder = 3\n}\n\n@es5ClassCompat\nexport class RelativePattern implements IRelativePattern {\n\tbase: string;\n\tpattern: string;\n\n\t// expose a `baseFolder: URI` property as a workaround for the short-coming\n\t// of `IRelativePattern` only supporting `base: string` which always translates\n\t// to a `file://` URI. With `baseFolder` we can support non-file based folders\n\t// in searches\n\t// (https://github.com/microsoft/vscode/commit/6326543b11cf4998c8fd1564cab5c429a2416db3)\n\treadonly baseFolder?: URI;\n\n\tconstructor(base: vscode.WorkspaceFolder | URI | string, pattern: string) {\n\t\tif (typeof base !== 'string') {\n\t\t\tif (!base || !URI.isUri(base) && !URI.isUri(base.uri)) {\n\t\t\t\tthrow illegalArgument('base');\n\t\t\t}\n\t\t}\n\n\t\tif (typeof pattern !== 'string') {\n\t\t\tthrow illegalArgument('pattern');\n\t\t}\n\n\t\tif (typeof base === 'string') {\n\t\t\tthis.baseFolder = URI.file(base);\n\t\t\tthis.base = base;\n\t\t} else if (URI.isUri(base)) {\n\t\t\tthis.baseFolder = base;\n\t\t\tthis.base = base.fsPath;\n\t\t} else {\n\t\t\tthis.baseFolder = base.uri;\n\t\t\tthis.base = base.uri.fsPath;\n\t\t}\n\n\t\tthis.pattern = pattern;\n\t}\n}\n\n@es5ClassCompat\nexport class Breakpoint {\n\n\tprivate _id: string | undefined;\n\n\treadonly enabled: boolean;\n\treadonly condition?: string;\n\treadonly hitCondition?: string;\n\treadonly logMessage?: string;\n\n\tprotected constructor(enabled?: boolean, condition?: string, hitCondition?: string, logMessage?: string) {\n\t\tthis.enabled = typeof enabled === 'boolean' ? enabled : true;\n\t\tif (typeof condition === 'string') {\n\t\t\tthis.condition = condition;\n\t\t}\n\t\tif (typeof hitCondition === 'string') {\n\t\t\tthis.hitCondition = hitCondition;\n\t\t}\n\t\tif (typeof logMessage === 'string') {\n\t\t\tthis.logMessage = logMessage;\n\t\t}\n\t}\n\n\tget id(): string {\n\t\tif (!this._id) {\n\t\t\tthis._id = generateUuid();\n\t\t}\n\t\treturn this._id;\n\t}\n}\n\n@es5ClassCompat\nexport class SourceBreakpoint extends Breakpoint {\n\treadonly location: Location;\n\n\tconstructor(location: Location, enabled?: boolean, condition?: string, hitCondition?: string, logMessage?: string) {\n\t\tsuper(enabled, condition, hitCondition, logMessage);\n\t\tif (location === null) {\n\t\t\tthrow illegalArgument('location');\n\t\t}\n\t\tthis.location = location;\n\t}\n}\n\n@es5ClassCompat\nexport class FunctionBreakpoint extends Breakpoint {\n\treadonly functionName: string;\n\n\tconstructor(functionName: string, enabled?: boolean, condition?: string, hitCondition?: string, logMessage?: string) {\n\t\tsuper(enabled, condition, hitCondition, logMessage);\n\t\tthis.functionName = functionName;\n\t}\n}\n\n@es5ClassCompat\nexport class DataBreakpoint extends Breakpoint {\n\treadonly label: string;\n\treadonly dataId: string;\n\treadonly canPersist: boolean;\n\n\tconstructor(label: string, dataId: string, canPersist: boolean, enabled?: boolean, condition?: string, hitCondition?: string, logMessage?: string) {\n\t\tsuper(enabled, condition, hitCondition, logMessage);\n\t\tif (!dataId) {\n\t\t\tthrow illegalArgument('dataId');\n\t\t}\n\t\tthis.label = label;\n\t\tthis.dataId = dataId;\n\t\tthis.canPersist = canPersist;\n\t}\n}\n\n\n@es5ClassCompat\nexport class DebugAdapterExecutable implements vscode.DebugAdapterExecutable {\n\treadonly command: string;\n\treadonly args: string[];\n\treadonly options?: vscode.DebugAdapterExecutableOptions;\n\n\tconstructor(command: string, args: string[], options?: vscode.DebugAdapterExecutableOptions) {\n\t\tthis.command = command;\n\t\tthis.args = args || [];\n\t\tthis.options = options;\n\t}\n}\n\n@es5ClassCompat\nexport class DebugAdapterServer implements vscode.DebugAdapterServer {\n\treadonly port: number;\n\treadonly host?: string;\n\n\tconstructor(port: number, host?: string) {\n\t\tthis.port = port;\n\t\tthis.host = host;\n\t}\n}\n\n@es5ClassCompat\nexport class DebugAdapterNamedPipeServer implements vscode.DebugAdapterNamedPipeServer {\n\tconstructor(public readonly path: string) {\n\t}\n}\n\n@es5ClassCompat\nexport class DebugAdapterInlineImplementation implements vscode.DebugAdapterInlineImplementation {\n\treadonly implementation: vscode.DebugAdapter;\n\n\tconstructor(impl: vscode.DebugAdapter) {\n\t\tthis.implementation = impl;\n\t}\n}\n\n@es5ClassCompat\nexport class EvaluatableExpression implements vscode.EvaluatableExpression {\n\treadonly range: vscode.Range;\n\treadonly expression?: string;\n\n\tconstructor(range: vscode.Range, expression?: string) {\n\t\tthis.range = range;\n\t\tthis.expression = expression;\n\t}\n}\n\n//#region file api\n\nexport enum FileChangeType {\n\tChanged = 1,\n\tCreated = 2,\n\tDeleted = 3,\n}\n\n@es5ClassCompat\nexport class FileSystemError extends Error {\n\n\tstatic FileExists(messageOrUri?: string | URI): FileSystemError {\n\t\treturn new FileSystemError(messageOrUri, FileSystemProviderErrorCode.FileExists, FileSystemError.FileExists);\n\t}\n\tstatic FileNotFound(messageOrUri?: string | URI): FileSystemError {\n\t\treturn new FileSystemError(messageOrUri, FileSystemProviderErrorCode.FileNotFound, FileSystemError.FileNotFound);\n\t}\n\tstatic FileNotADirectory(messageOrUri?: string | URI): FileSystemError {\n\t\treturn new FileSystemError(messageOrUri, FileSystemProviderErrorCode.FileNotADirectory, FileSystemError.FileNotADirectory);\n\t}\n\tstatic FileIsADirectory(messageOrUri?: string | URI): FileSystemError {\n\t\treturn new FileSystemError(messageOrUri, FileSystemProviderErrorCode.FileIsADirectory, FileSystemError.FileIsADirectory);\n\t}\n\tstatic NoPermissions(messageOrUri?: string | URI): FileSystemError {\n\t\treturn new FileSystemError(messageOrUri, FileSystemProviderErrorCode.NoPermissions, FileSystemError.NoPermissions);\n\t}\n\tstatic Unavailable(messageOrUri?: string | URI): FileSystemError {\n\t\treturn new FileSystemError(messageOrUri, FileSystemProviderErrorCode.Unavailable, FileSystemError.Unavailable);\n\t}\n\n\treadonly code: string;\n\n\tconstructor(uriOrMessage?: string | URI, code: FileSystemProviderErrorCode = FileSystemProviderErrorCode.Unknown, terminator?: Function) {\n\t\tsuper(URI.isUri(uriOrMessage) ? uriOrMessage.toString(true) : uriOrMessage);\n\n\t\tthis.code = terminator?.name ?? 'Unknown';\n\n\t\t// mark the error as file system provider error so that\n\t\t// we can extract the error code on the receiving side\n\t\tmarkAsFileSystemProviderError(this, code);\n\n\t\t// workaround when extending builtin objects and when compiling to ES5, see:\n\t\t// https://github.com/microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\n\t\tif (typeof (<any>Object).setPrototypeOf === 'function') {\n\t\t\t(<any>Object).setPrototypeOf(this, FileSystemError.prototype);\n\t\t}\n\n\t\tif (typeof Error.captureStackTrace === 'function' && typeof terminator === 'function') {\n\t\t\t// nice stack traces\n\t\t\tError.captureStackTrace(this, terminator);\n\t\t}\n\t}\n}\n\n//#endregion\n\n//#region folding api\n\n@es5ClassCompat\nexport class FoldingRange {\n\n\tstart: number;\n\n\tend: number;\n\n\tkind?: FoldingRangeKind;\n\n\tconstructor(start: number, end: number, kind?: FoldingRangeKind) {\n\t\tthis.start = start;\n\t\tthis.end = end;\n\t\tthis.kind = kind;\n\t}\n}\n\nexport enum FoldingRangeKind {\n\tComment = 1,\n\tImports = 2,\n\tRegion = 3\n}\n\n//#endregion\n\n//#region Comment\nexport enum CommentThreadCollapsibleState {\n\t/**\n\t * Determines an item is collapsed\n\t */\n\tCollapsed = 0,\n\t/**\n\t * Determines an item is expanded\n\t */\n\tExpanded = 1\n}\n\nexport enum CommentMode {\n\tEditing = 0,\n\tPreview = 1\n}\n\n//#endregion\n\n//#region Semantic Coloring\n\nexport class SemanticTokensLegend {\n\tpublic readonly tokenTypes: string[];\n\tpublic readonly tokenModifiers: string[];\n\n\tconstructor(tokenTypes: string[], tokenModifiers: string[] = []) {\n\t\tthis.tokenTypes = tokenTypes;\n\t\tthis.tokenModifiers = tokenModifiers;\n\t}\n}\n\nfunction isStrArrayOrUndefined(arg: any): arg is string[] | undefined {\n\treturn ((typeof arg === 'undefined') || isStringArray(arg));\n}\n\nexport class SemanticTokensBuilder {\n\n\tprivate _prevLine: number;\n\tprivate _prevChar: number;\n\tprivate _dataIsSortedAndDeltaEncoded: boolean;\n\tprivate _data: number[];\n\tprivate _dataLen: number;\n\tprivate _tokenTypeStrToInt: Map<string, number>;\n\tprivate _tokenModifierStrToInt: Map<string, number>;\n\tprivate _hasLegend: boolean;\n\n\tconstructor(legend?: vscode.SemanticTokensLegend) {\n\t\tthis._prevLine = 0;\n\t\tthis._prevChar = 0;\n\t\tthis._dataIsSortedAndDeltaEncoded = true;\n\t\tthis._data = [];\n\t\tthis._dataLen = 0;\n\t\tthis._tokenTypeStrToInt = new Map<string, number>();\n\t\tthis._tokenModifierStrToInt = new Map<string, number>();\n\t\tthis._hasLegend = false;\n\t\tif (legend) {\n\t\t\tthis._hasLegend = true;\n\t\t\tfor (let i = 0, len = legend.tokenTypes.length; i < len; i++) {\n\t\t\t\tthis._tokenTypeStrToInt.set(legend.tokenTypes[i], i);\n\t\t\t}\n\t\t\tfor (let i = 0, len = legend.tokenModifiers.length; i < len; i++) {\n\t\t\t\tthis._tokenModifierStrToInt.set(legend.tokenModifiers[i], i);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic push(line: number, char: number, length: number, tokenType: number, tokenModifiers?: number): void;\n\tpublic push(range: Range, tokenType: string, tokenModifiers?: string[]): void;\n\tpublic push(arg0: any, arg1: any, arg2: any, arg3?: any, arg4?: any): void {\n\t\tif (typeof arg0 === 'number' && typeof arg1 === 'number' && typeof arg2 === 'number' && typeof arg3 === 'number' && (typeof arg4 === 'number' || typeof arg4 === 'undefined')) {\n\t\t\tif (typeof arg4 === 'undefined') {\n\t\t\t\targ4 = 0;\n\t\t\t}\n\t\t\t// 1st overload\n\t\t\treturn this._pushEncoded(arg0, arg1, arg2, arg3, arg4);\n\t\t}\n\t\tif (Range.isRange(arg0) && typeof arg1 === 'string' && isStrArrayOrUndefined(arg2)) {\n\t\t\t// 2nd overload\n\t\t\treturn this._push(arg0, arg1, arg2);\n\t\t}\n\t\tthrow illegalArgument();\n\t}\n\n\tprivate _push(range: vscode.Range, tokenType: string, tokenModifiers?: string[]): void {\n\t\tif (!this._hasLegend) {\n\t\t\tthrow new Error('Legend must be provided in constructor');\n\t\t}\n\t\tif (range.start.line !== range.end.line) {\n\t\t\tthrow new Error('`range` cannot span multiple lines');\n\t\t}\n\t\tif (!this._tokenTypeStrToInt.has(tokenType)) {\n\t\t\tthrow new Error('`tokenType` is not in the provided legend');\n\t\t}\n\t\tconst line = range.start.line;\n\t\tconst char = range.start.character;\n\t\tconst length = range.end.character - range.start.character;\n\t\tconst nTokenType = this._tokenTypeStrToInt.get(tokenType)!;\n\t\tlet nTokenModifiers = 0;\n\t\tif (tokenModifiers) {\n\t\t\tfor (const tokenModifier of tokenModifiers) {\n\t\t\t\tif (!this._tokenModifierStrToInt.has(tokenModifier)) {\n\t\t\t\t\tthrow new Error('`tokenModifier` is not in the provided legend');\n\t\t\t\t}\n\t\t\t\tconst nTokenModifier = this._tokenModifierStrToInt.get(tokenModifier)!;\n\t\t\t\tnTokenModifiers |= (1 << nTokenModifier) >>> 0;\n\t\t\t}\n\t\t}\n\t\tthis._pushEncoded(line, char, length, nTokenType, nTokenModifiers);\n\t}\n\n\tprivate _pushEncoded(line: number, char: number, length: number, tokenType: number, tokenModifiers: number): void {\n\t\tif (this._dataIsSortedAndDeltaEncoded && (line < this._prevLine || (line === this._prevLine && char < this._prevChar))) {\n\t\t\t// push calls were ordered and are no longer ordered\n\t\t\tthis._dataIsSortedAndDeltaEncoded = false;\n\n\t\t\t// Remove delta encoding from data\n\t\t\tconst tokenCount = (this._data.length / 5) | 0;\n\t\t\tlet prevLine = 0;\n\t\t\tlet prevChar = 0;\n\t\t\tfor (let i = 0; i < tokenCount; i++) {\n\t\t\t\tlet line = this._data[5 * i];\n\t\t\t\tlet char = this._data[5 * i + 1];\n\n\t\t\t\tif (line === 0) {\n\t\t\t\t\t// on the same line as previous token\n\t\t\t\t\tline = prevLine;\n\t\t\t\t\tchar += prevChar;\n\t\t\t\t} else {\n\t\t\t\t\t// on a different line than previous token\n\t\t\t\t\tline += prevLine;\n\t\t\t\t}\n\n\t\t\t\tthis._data[5 * i] = line;\n\t\t\t\tthis._data[5 * i + 1] = char;\n\n\t\t\t\tprevLine = line;\n\t\t\t\tprevChar = char;\n\t\t\t}\n\t\t}\n\n\t\tlet pushLine = line;\n\t\tlet pushChar = char;\n\t\tif (this._dataIsSortedAndDeltaEncoded && this._dataLen > 0) {\n\t\t\tpushLine -= this._prevLine;\n\t\t\tif (pushLine === 0) {\n\t\t\t\tpushChar -= this._prevChar;\n\t\t\t}\n\t\t}\n\n\t\tthis._data[this._dataLen++] = pushLine;\n\t\tthis._data[this._dataLen++] = pushChar;\n\t\tthis._data[this._dataLen++] = length;\n\t\tthis._data[this._dataLen++] = tokenType;\n\t\tthis._data[this._dataLen++] = tokenModifiers;\n\n\t\tthis._prevLine = line;\n\t\tthis._prevChar = char;\n\t}\n\n\tprivate static _sortAndDeltaEncode(data: number[]): Uint32Array {\n\t\tlet pos: number[] = [];\n\t\tconst tokenCount = (data.length / 5) | 0;\n\t\tfor (let i = 0; i < tokenCount; i++) {\n\t\t\tpos[i] = i;\n\t\t}\n\t\tpos.sort((a, b) => {\n\t\t\tconst aLine = data[5 * a];\n\t\t\tconst bLine = data[5 * b];\n\t\t\tif (aLine === bLine) {\n\t\t\t\tconst aChar = data[5 * a + 1];\n\t\t\t\tconst bChar = data[5 * b + 1];\n\t\t\t\treturn aChar - bChar;\n\t\t\t}\n\t\t\treturn aLine - bLine;\n\t\t});\n\t\tconst result = new Uint32Array(data.length);\n\t\tlet prevLine = 0;\n\t\tlet prevChar = 0;\n\t\tfor (let i = 0; i < tokenCount; i++) {\n\t\t\tconst srcOffset = 5 * pos[i];\n\t\t\tconst line = data[srcOffset + 0];\n\t\t\tconst char = data[srcOffset + 1];\n\t\t\tconst length = data[srcOffset + 2];\n\t\t\tconst tokenType = data[srcOffset + 3];\n\t\t\tconst tokenModifiers = data[srcOffset + 4];\n\n\t\t\tconst pushLine = line - prevLine;\n\t\t\tconst pushChar = (pushLine === 0 ? char - prevChar : char);\n\n\t\t\tconst dstOffset = 5 * i;\n\t\t\tresult[dstOffset + 0] = pushLine;\n\t\t\tresult[dstOffset + 1] = pushChar;\n\t\t\tresult[dstOffset + 2] = length;\n\t\t\tresult[dstOffset + 3] = tokenType;\n\t\t\tresult[dstOffset + 4] = tokenModifiers;\n\n\t\t\tprevLine = line;\n\t\t\tprevChar = char;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tpublic build(resultId?: string): SemanticTokens {\n\t\tif (!this._dataIsSortedAndDeltaEncoded) {\n\t\t\treturn new SemanticTokens(SemanticTokensBuilder._sortAndDeltaEncode(this._data), resultId);\n\t\t}\n\t\treturn new SemanticTokens(new Uint32Array(this._data), resultId);\n\t}\n}\n\nexport class SemanticTokens {\n\treadonly resultId?: string;\n\treadonly data: Uint32Array;\n\n\tconstructor(data: Uint32Array, resultId?: string) {\n\t\tthis.resultId = resultId;\n\t\tthis.data = data;\n\t}\n}\n\nexport class SemanticTokensEdit {\n\treadonly start: number;\n\treadonly deleteCount: number;\n\treadonly data?: Uint32Array;\n\n\tconstructor(start: number, deleteCount: number, data?: Uint32Array) {\n\t\tthis.start = start;\n\t\tthis.deleteCount = deleteCount;\n\t\tthis.data = data;\n\t}\n}\n\nexport class SemanticTokensEdits {\n\treadonly resultId?: string;\n\treadonly edits: SemanticTokensEdit[];\n\n\tconstructor(edits: SemanticTokensEdit[], resultId?: string) {\n\t\tthis.resultId = resultId;\n\t\tthis.edits = edits;\n\t}\n}\n\n//#endregion\n\n//#region debug\nexport enum DebugConsoleMode {\n\t/**\n\t * Debug session should have a separate debug console.\n\t */\n\tSeparate = 0,\n\n\t/**\n\t * Debug session should share debug console with its parent session.\n\t * This value has no effect for sessions which do not have a parent session.\n\t */\n\tMergeWithParent = 1\n}\n\nexport enum DebugConfigurationProviderTriggerKind {\n\t/**\n\t *\t`DebugConfigurationProvider.provideDebugConfigurations` is called to provide the initial debug configurations for a newly created launch.json.\n\t */\n\tInitial = 1,\n\t/**\n\t * `DebugConfigurationProvider.provideDebugConfigurations` is called to provide dynamically generated debug configurations when the user asks for them through the UI (e.g. via the \"Select and Start Debugging\" command).\n\t */\n\tDynamic = 2\n}\n\n//#endregion\n\n@es5ClassCompat\nexport class QuickInputButtons {\n\n\tstatic readonly Back: vscode.QuickInputButton = { iconPath: new ThemeIcon('arrow-left') };\n\n\tprivate constructor() { }\n}\n\nexport enum ExtensionKind {\n\tUI = 1,\n\tWorkspace = 2\n}\n\nexport class FileDecoration {\n\n\tstatic validate(d: FileDecoration): void {\n\t\tif (d.badge && d.badge.length !== 1 && d.badge.length !== 2) {\n\t\t\tthrow new Error(`The 'badge'-property must be undefined or a short character`);\n\t\t}\n\t\tif (!d.color && !d.badge && !d.tooltip) {\n\t\t\tthrow new Error(`The decoration is empty`);\n\t\t}\n\t}\n\n\tbadge?: string;\n\ttooltip?: string;\n\tcolor?: vscode.ThemeColor;\n\tpriority?: number;\n\tpropagate?: boolean;\n\n\n\tconstructor(badge?: string, tooltip?: string, color?: ThemeColor) {\n\t\tthis.badge = badge;\n\t\tthis.tooltip = tooltip;\n\t\tthis.color = color;\n\t}\n}\n\n//#region Theming\n\n@es5ClassCompat\nexport class ColorTheme implements vscode.ColorTheme {\n\tconstructor(public readonly kind: ColorThemeKind) {\n\t}\n}\n\nexport enum ColorThemeKind {\n\tLight = 1,\n\tDark = 2,\n\tHighContrast = 3\n}\n\n//#endregion Theming\n\n//#region Notebook\n\nexport class NotebookCellOutputItem {\n\n\tstatic isNotebookCellOutputItem(obj: unknown): obj is vscode.NotebookCellOutputItem {\n\t\treturn obj instanceof NotebookCellOutputItem;\n\t}\n\n\tconstructor(\n\t\treadonly mime: string,\n\t\treadonly value: unknown, // JSON'able\n\t\treadonly metadata?: Record<string, string | number | boolean>\n\t) { }\n}\n\nexport class NotebookCellOutput {\n\n\tstatic isNotebookCellOutput(obj: unknown): obj is vscode.NotebookCellOutput {\n\t\treturn obj instanceof NotebookCellOutput;\n\t}\n\n\tconstructor(\n\t\treadonly outputs: NotebookCellOutputItem[],\n\t\treadonly metadata?: Record<string, string | number | boolean>\n\t) { }\n\n\ttoJSON(): IDisplayOutput {\n\t\tlet data: { [key: string]: unknown; } = {};\n\t\tlet custom: { [key: string]: unknown; } = {};\n\t\tlet hasMetadata = false;\n\n\t\tfor (let item of this.outputs) {\n\t\t\tdata[item.mime] = item.value;\n\t\t\tif (item.metadata) {\n\t\t\t\tcustom[item.mime] = item.metadata;\n\t\t\t\thasMetadata = true;\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\toutputKind: CellOutputKind.Rich,\n\t\t\tdata,\n\t\t\tmetadata: hasMetadata ? { custom } : undefined\n\t\t};\n\t}\n}\n\nexport enum CellKind {\n\tMarkdown = 1,\n\tCode = 2\n}\n\nexport enum CellOutputKind {\n\tText = 1,\n\tError = 2,\n\tRich = 3\n}\n\nexport enum NotebookCellRunState {\n\tRunning = 1,\n\tIdle = 2,\n\tSuccess = 3,\n\tError = 4\n}\n\nexport enum NotebookRunState {\n\tRunning = 1,\n\tIdle = 2\n}\n\nexport enum NotebookCellStatusBarAlignment {\n\tLeft = 1,\n\tRight = 2\n}\n\nexport enum NotebookEditorRevealType {\n\tDefault = 0,\n\tInCenter = 1,\n\tInCenterIfOutsideViewport = 2,\n\tAtTop = 3\n}\n\n\n//#endregion\n\n//#region Timeline\n\n@es5ClassCompat\nexport class TimelineItem implements vscode.TimelineItem {\n\tconstructor(public label: string, public timestamp: number) { }\n}\n\n//#endregion Timeline\n\n//#region ExtensionContext\n\nexport enum ExtensionMode {\n\t/**\n\t * The extension is installed normally (for example, from the marketplace\n\t * or VSIX) in VS Code.\n\t */\n\tProduction = 1,\n\n\t/**\n\t * The extension is running from an `--extensionDevelopmentPath` provided\n\t * when launching VS Code.\n\t */\n\tDevelopment = 2,\n\n\t/**\n\t * The extension is running from an `--extensionDevelopmentPath` and\n\t * the extension host is running unit tests.\n\t */\n\tTest = 3,\n}\n\nexport enum ExtensionRuntime {\n\t/**\n\t * The extension is running in a NodeJS extension host. Runtime access to NodeJS APIs is available.\n\t */\n\tNode = 1,\n\t/**\n\t * The extension is running in a Webworker extension host. Runtime access is limited to Webworker APIs.\n\t */\n\tWebworker = 2\n}\n\n//#endregion ExtensionContext\n\nexport enum StandardTokenType {\n\tOther = 0,\n\tComment = 1,\n\tString = 2,\n\tRegEx = 4\n}\n\n\nexport class LinkedEditingRanges {\n\tconstructor(public readonly ranges: Range[], public readonly wordPattern?: RegExp) {\n\t}\n}\n\n//#region Testing\nexport enum TestRunState {\n\tUnset = 0,\n\tQueued = 1,\n\tRunning = 2,\n\tPassed = 3,\n\tFailed = 4,\n\tSkipped = 5,\n\tErrored = 6\n}\n\nexport enum TestMessageSeverity {\n\tError = 0,\n\tWarning = 1,\n\tInformation = 2,\n\tHint = 3\n}\n\n@es5ClassCompat\nexport class TestState {\n\t#runState: TestRunState;\n\t#duration?: number;\n\t#messages: ReadonlyArray<Readonly<vscode.TestMessage>>;\n\n\tpublic get runState() {\n\t\treturn this.#runState;\n\t}\n\n\tpublic get duration() {\n\t\treturn this.#duration;\n\t}\n\n\tpublic get messages() {\n\t\treturn this.#messages;\n\t}\n\n\tconstructor(runState: TestRunState, messages: vscode.TestMessage[] = [], duration?: number) {\n\t\tthis.#runState = runState;\n\t\tthis.#messages = Object.freeze(messages.map(m => Object.freeze(m)));\n\t\tthis.#duration = duration;\n\t}\n}\n\nexport type RequiredTestItem = vscode.RequiredTestItem;\n\nexport type TestItem = vscode.TestItem;\n\n//#endregion\n\nexport enum ExternalUriOpenerPriority {\n\tNone = 0,\n\tOption = 1,\n\tDefault = 2,\n\tPreferred = 3,\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ok } from 'vs/base/common/assert';\nimport { Schemas } from 'vs/base/common/network';\nimport { regExpLeadsToEndlessLoop } from 'vs/base/common/strings';\nimport { URI } from 'vs/base/common/uri';\nimport { MirrorTextModel } from 'vs/editor/common/model/mirrorTextModel';\nimport { ensureValidWordDefinition, getWordAtText } from 'vs/editor/common/model/wordHelper';\nimport { MainThreadDocumentsShape } from 'vs/workbench/api/common/extHost.protocol';\nimport { EndOfLine, Position, Range } from 'vs/workbench/api/common/extHostTypes';\nimport type * as vscode from 'vscode';\nimport { equals } from 'vs/base/common/arrays';\n\nconst _modeId2WordDefinition = new Map<string, RegExp>();\nexport function setWordDefinitionFor(modeId: string, wordDefinition: RegExp | undefined): void {\n\tif (!wordDefinition) {\n\t\t_modeId2WordDefinition.delete(modeId);\n\t} else {\n\t\t_modeId2WordDefinition.set(modeId, wordDefinition);\n\t}\n}\n\nexport function getWordDefinitionFor(modeId: string): RegExp | undefined {\n\treturn _modeId2WordDefinition.get(modeId);\n}\n\nexport class ExtHostDocumentData extends MirrorTextModel {\n\n\tprivate _document?: vscode.TextDocument;\n\tprivate _isDisposed: boolean = false;\n\n\tconstructor(\n\t\tprivate readonly _proxy: MainThreadDocumentsShape,\n\t\turi: URI, lines: string[], eol: string, versionId: number,\n\t\tprivate _languageId: string,\n\t\tprivate _isDirty: boolean,\n\t\tprivate readonly _notebook?: vscode.NotebookDocument | undefined\n\t) {\n\t\tsuper(uri, lines, eol, versionId);\n\t}\n\n\tdispose(): void {\n\t\t// we don't really dispose documents but let\n\t\t// extensions still read from them. some\n\t\t// operations, live saving, will now error tho\n\t\tok(!this._isDisposed);\n\t\tthis._isDisposed = true;\n\t\tthis._isDirty = false;\n\t}\n\n\tequalLines(lines: readonly string[]): boolean {\n\t\treturn equals(this._lines, lines);\n\t}\n\n\tget document(): vscode.TextDocument {\n\t\tif (!this._document) {\n\t\t\tconst that = this;\n\t\t\tthis._document = {\n\t\t\t\tget uri() { return that._uri; },\n\t\t\t\tget fileName() { return that._uri.fsPath; },\n\t\t\t\tget isUntitled() { return that._uri.scheme === Schemas.untitled; },\n\t\t\t\tget languageId() { return that._languageId; },\n\t\t\t\tget version() { return that._versionId; },\n\t\t\t\tget isClosed() { return that._isDisposed; },\n\t\t\t\tget isDirty() { return that._isDirty; },\n\t\t\t\tget notebook() { return that._notebook; },\n\t\t\t\tsave() { return that._save(); },\n\t\t\t\tgetText(range?) { return range ? that._getTextInRange(range) : that.getText(); },\n\t\t\t\tget eol() { return that._eol === '\\n' ? EndOfLine.LF : EndOfLine.CRLF; },\n\t\t\t\tget lineCount() { return that._lines.length; },\n\t\t\t\tlineAt(lineOrPos: number | vscode.Position) { return that._lineAt(lineOrPos); },\n\t\t\t\toffsetAt(pos) { return that._offsetAt(pos); },\n\t\t\t\tpositionAt(offset) { return that._positionAt(offset); },\n\t\t\t\tvalidateRange(ran) { return that._validateRange(ran); },\n\t\t\t\tvalidatePosition(pos) { return that._validatePosition(pos); },\n\t\t\t\tgetWordRangeAtPosition(pos, regexp?) { return that._getWordRangeAtPosition(pos, regexp); },\n\t\t\t};\n\t\t}\n\t\treturn Object.freeze(this._document);\n\t}\n\n\t_acceptLanguageId(newLanguageId: string): void {\n\t\tok(!this._isDisposed);\n\t\tthis._languageId = newLanguageId;\n\t}\n\n\t_acceptIsDirty(isDirty: boolean): void {\n\t\tok(!this._isDisposed);\n\t\tthis._isDirty = isDirty;\n\t}\n\n\tprivate _save(): Promise<boolean> {\n\t\tif (this._isDisposed) {\n\t\t\treturn Promise.reject(new Error('Document has been closed'));\n\t\t}\n\t\treturn this._proxy.$trySaveDocument(this._uri);\n\t}\n\n\tprivate _getTextInRange(_range: vscode.Range): string {\n\t\tconst range = this._validateRange(_range);\n\n\t\tif (range.isEmpty) {\n\t\t\treturn '';\n\t\t}\n\n\t\tif (range.isSingleLine) {\n\t\t\treturn this._lines[range.start.line].substring(range.start.character, range.end.character);\n\t\t}\n\n\t\tconst lineEnding = this._eol,\n\t\t\tstartLineIndex = range.start.line,\n\t\t\tendLineIndex = range.end.line,\n\t\t\tresultLines: string[] = [];\n\n\t\tresultLines.push(this._lines[startLineIndex].substring(range.start.character));\n\t\tfor (let i = startLineIndex + 1; i < endLineIndex; i++) {\n\t\t\tresultLines.push(this._lines[i]);\n\t\t}\n\t\tresultLines.push(this._lines[endLineIndex].substring(0, range.end.character));\n\n\t\treturn resultLines.join(lineEnding);\n\t}\n\n\tprivate _lineAt(lineOrPosition: number | vscode.Position): vscode.TextLine {\n\n\t\tlet line: number | undefined;\n\t\tif (lineOrPosition instanceof Position) {\n\t\t\tline = lineOrPosition.line;\n\t\t} else if (typeof lineOrPosition === 'number') {\n\t\t\tline = lineOrPosition;\n\t\t}\n\n\t\tif (typeof line !== 'number' || line < 0 || line >= this._lines.length || Math.floor(line) !== line) {\n\t\t\tthrow new Error('Illegal value for `line`');\n\t\t}\n\n\t\treturn new ExtHostDocumentLine(line, this._lines[line], line === this._lines.length - 1);\n\t}\n\n\tprivate _offsetAt(position: vscode.Position): number {\n\t\tposition = this._validatePosition(position);\n\t\tthis._ensureLineStarts();\n\t\treturn this._lineStarts!.getAccumulatedValue(position.line - 1) + position.character;\n\t}\n\n\tprivate _positionAt(offset: number): vscode.Position {\n\t\toffset = Math.floor(offset);\n\t\toffset = Math.max(0, offset);\n\n\t\tthis._ensureLineStarts();\n\t\tconst out = this._lineStarts!.getIndexOf(offset);\n\n\t\tconst lineLength = this._lines[out.index].length;\n\n\t\t// Ensure we return a valid position\n\t\treturn new Position(out.index, Math.min(out.remainder, lineLength));\n\t}\n\n\t// ---- range math\n\n\tprivate _validateRange(range: vscode.Range): vscode.Range {\n\t\tif (!(range instanceof Range)) {\n\t\t\tthrow new Error('Invalid argument');\n\t\t}\n\n\t\tconst start = this._validatePosition(range.start);\n\t\tconst end = this._validatePosition(range.end);\n\n\t\tif (start === range.start && end === range.end) {\n\t\t\treturn range;\n\t\t}\n\t\treturn new Range(start.line, start.character, end.line, end.character);\n\t}\n\n\tprivate _validatePosition(position: vscode.Position): vscode.Position {\n\t\tif (!(position instanceof Position)) {\n\t\t\tthrow new Error('Invalid argument');\n\t\t}\n\n\t\tif (this._lines.length === 0) {\n\t\t\treturn position.with(0, 0);\n\t\t}\n\n\t\tlet { line, character } = position;\n\t\tlet hasChanged = false;\n\n\t\tif (line < 0) {\n\t\t\tline = 0;\n\t\t\tcharacter = 0;\n\t\t\thasChanged = true;\n\t\t}\n\t\telse if (line >= this._lines.length) {\n\t\t\tline = this._lines.length - 1;\n\t\t\tcharacter = this._lines[line].length;\n\t\t\thasChanged = true;\n\t\t}\n\t\telse {\n\t\t\tconst maxCharacter = this._lines[line].length;\n\t\t\tif (character < 0) {\n\t\t\t\tcharacter = 0;\n\t\t\t\thasChanged = true;\n\t\t\t}\n\t\t\telse if (character > maxCharacter) {\n\t\t\t\tcharacter = maxCharacter;\n\t\t\t\thasChanged = true;\n\t\t\t}\n\t\t}\n\n\t\tif (!hasChanged) {\n\t\t\treturn position;\n\t\t}\n\t\treturn new Position(line, character);\n\t}\n\n\tprivate _getWordRangeAtPosition(_position: vscode.Position, regexp?: RegExp): vscode.Range | undefined {\n\t\tconst position = this._validatePosition(_position);\n\n\t\tif (!regexp) {\n\t\t\t// use default when custom-regexp isn't provided\n\t\t\tregexp = getWordDefinitionFor(this._languageId);\n\n\t\t} else if (regExpLeadsToEndlessLoop(regexp)) {\n\t\t\t// use default when custom-regexp is bad\n\t\t\tthrow new Error(`[getWordRangeAtPosition]: ignoring custom regexp '${regexp.source}' because it matches the empty string.`);\n\t\t}\n\n\t\tconst wordAtText = getWordAtText(\n\t\t\tposition.character + 1,\n\t\t\tensureValidWordDefinition(regexp),\n\t\t\tthis._lines[position.line],\n\t\t\t0\n\t\t);\n\n\t\tif (wordAtText) {\n\t\t\treturn new Range(position.line, wordAtText.startColumn - 1, position.line, wordAtText.endColumn - 1);\n\t\t}\n\t\treturn undefined;\n\t}\n}\n\nexport class ExtHostDocumentLine implements vscode.TextLine {\n\n\tprivate readonly _line: number;\n\tprivate readonly _text: string;\n\tprivate readonly _isLastLine: boolean;\n\n\tconstructor(line: number, text: string, isLastLine: boolean) {\n\t\tthis._line = line;\n\t\tthis._text = text;\n\t\tthis._isLastLine = isLastLine;\n\t}\n\n\tpublic get lineNumber(): number {\n\t\treturn this._line;\n\t}\n\n\tpublic get text(): string {\n\t\treturn this._text;\n\t}\n\n\tpublic get range(): Range {\n\t\treturn new Range(this._line, 0, this._line, this._text.length);\n\t}\n\n\tpublic get rangeIncludingLineBreak(): Range {\n\t\tif (this._isLastLine) {\n\t\t\treturn this.range;\n\t\t}\n\t\treturn new Range(this._line, 0, this._line + 1, 0);\n\t}\n\n\tpublic get firstNonWhitespaceCharacterIndex(): number {\n\t\t//TODO@api, rename to 'leadingWhitespaceLength'\n\t\treturn /^(\\s*)/.exec(this._text)![1].length;\n\t}\n\n\tpublic get isEmptyOrWhitespace(): boolean {\n\t\treturn this.firstNonWhitespaceCharacterIndex === this._text.length;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as types from 'vs/workbench/api/common/extHostTypes';\nimport * as vscode from 'vscode';\nimport { Event, Emitter } from 'vs/base/common/event';\nimport { ExtHostNotebookController } from 'vs/workbench/api/common/extHostNotebook';\nimport { ExtHostDocuments } from 'vs/workbench/api/common/extHostDocuments';\nimport { PrefixSumComputer } from 'vs/editor/common/viewModel/prefixSumComputer';\nimport { DisposableStore } from 'vs/base/common/lifecycle';\nimport { score } from 'vs/editor/common/modes/languageSelector';\nimport { CellKind } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport { ResourceMap } from 'vs/base/common/map';\nimport { URI } from 'vs/base/common/uri';\nimport { generateUuid } from 'vs/base/common/uuid';\n\nexport class ExtHostNotebookConcatDocument implements vscode.NotebookConcatTextDocument {\n\n\tprivate _disposables = new DisposableStore();\n\tprivate _isClosed = false;\n\n\tprivate _cells!: vscode.NotebookCell[];\n\tprivate _cellUris!: ResourceMap<number>;\n\tprivate _cellLengths!: PrefixSumComputer;\n\tprivate _cellLines!: PrefixSumComputer;\n\tprivate _versionId = 0;\n\n\tprivate readonly _onDidChange = new Emitter<void>();\n\treadonly onDidChange: Event<void> = this._onDidChange.event;\n\n\treadonly uri = URI.from({ scheme: 'vscode-concat-doc', path: generateUuid() });\n\n\tconstructor(\n\t\textHostNotebooks: ExtHostNotebookController,\n\t\textHostDocuments: ExtHostDocuments,\n\t\tprivate readonly _notebook: vscode.NotebookDocument,\n\t\tprivate readonly _selector: vscode.DocumentSelector | undefined,\n\t) {\n\t\tthis._init();\n\n\t\tthis._disposables.add(extHostDocuments.onDidChangeDocument(e => {\n\t\t\tconst cellIdx = this._cellUris.get(e.document.uri);\n\t\t\tif (cellIdx !== undefined) {\n\t\t\t\tthis._cellLengths.changeValue(cellIdx, this._cells[cellIdx].document.getText().length + 1);\n\t\t\t\tthis._cellLines.changeValue(cellIdx, this._cells[cellIdx].document.lineCount);\n\t\t\t\tthis._versionId += 1;\n\t\t\t\tthis._onDidChange.fire(undefined);\n\t\t\t}\n\t\t}));\n\t\tconst documentChange = (document: vscode.NotebookDocument) => {\n\t\t\tif (document === this._notebook) {\n\t\t\t\tthis._init();\n\t\t\t\tthis._versionId += 1;\n\t\t\t\tthis._onDidChange.fire(undefined);\n\t\t\t}\n\t\t};\n\n\t\tthis._disposables.add(extHostNotebooks.onDidChangeCellLanguage(e => documentChange(e.document)));\n\t\tthis._disposables.add(extHostNotebooks.onDidChangeNotebookCells(e => documentChange(e.document)));\n\t}\n\n\tdispose(): void {\n\t\tthis._disposables.dispose();\n\t\tthis._isClosed = true;\n\t}\n\n\tget isClosed() {\n\t\treturn this._isClosed;\n\t}\n\n\tprivate _init() {\n\t\tthis._cells = [];\n\t\tthis._cellUris = new ResourceMap();\n\t\tconst cellLengths: number[] = [];\n\t\tconst cellLineCounts: number[] = [];\n\t\tfor (const cell of this._notebook.cells) {\n\t\t\tif (cell.cellKind === CellKind.Code && (!this._selector || score(this._selector, cell.uri, cell.language, true))) {\n\t\t\t\tthis._cellUris.set(cell.uri, this._cells.length);\n\t\t\t\tthis._cells.push(cell);\n\t\t\t\tcellLengths.push(cell.document.getText().length + 1);\n\t\t\t\tcellLineCounts.push(cell.document.lineCount);\n\t\t\t}\n\t\t}\n\t\tthis._cellLengths = new PrefixSumComputer(new Uint32Array(cellLengths));\n\t\tthis._cellLines = new PrefixSumComputer(new Uint32Array(cellLineCounts));\n\t}\n\n\tget version(): number {\n\t\treturn this._versionId;\n\t}\n\n\tgetText(range?: vscode.Range): string {\n\t\tif (!range) {\n\t\t\tlet result = '';\n\t\t\tfor (const cell of this._cells) {\n\t\t\t\tresult += cell.document.getText() + '\\n';\n\t\t\t}\n\t\t\t// remove last newline again\n\t\t\tresult = result.slice(0, -1);\n\t\t\treturn result;\n\t\t}\n\n\t\tif (range.isEmpty) {\n\t\t\treturn '';\n\t\t}\n\n\t\t// get start and end locations and create substrings\n\t\tconst start = this.locationAt(range.start);\n\t\tconst end = this.locationAt(range.end);\n\t\tconst startCell = this._cells[this._cellUris.get(start.uri) ?? -1];\n\t\tconst endCell = this._cells[this._cellUris.get(end.uri) ?? -1];\n\n\t\tif (!startCell || !endCell) {\n\t\t\treturn '';\n\t\t} else if (startCell === endCell) {\n\t\t\treturn startCell.document.getText(new types.Range(start.range.start, end.range.end));\n\t\t} else {\n\t\t\tconst a = startCell.document.getText(new types.Range(start.range.start, new types.Position(startCell.document.lineCount, 0)));\n\t\t\tconst b = endCell.document.getText(new types.Range(new types.Position(0, 0), end.range.end));\n\t\t\treturn a + '\\n' + b;\n\t\t}\n\t}\n\n\toffsetAt(position: vscode.Position): number {\n\t\tconst idx = this._cellLines.getIndexOf(position.line);\n\t\tconst offset1 = this._cellLengths.getAccumulatedValue(idx.index - 1);\n\t\tconst offset2 = this._cells[idx.index].document.offsetAt(position.with(idx.remainder));\n\t\treturn offset1 + offset2;\n\t}\n\n\tpositionAt(locationOrOffset: vscode.Location | number): vscode.Position {\n\t\tif (typeof locationOrOffset === 'number') {\n\t\t\tconst idx = this._cellLengths.getIndexOf(locationOrOffset);\n\t\t\tconst lineCount = this._cellLines.getAccumulatedValue(idx.index - 1);\n\t\t\treturn this._cells[idx.index].document.positionAt(idx.remainder).translate(lineCount);\n\t\t}\n\n\t\tconst idx = this._cellUris.get(locationOrOffset.uri);\n\t\tif (idx !== undefined) {\n\t\t\tconst line = this._cellLines.getAccumulatedValue(idx - 1);\n\t\t\treturn new types.Position(line + locationOrOffset.range.start.line, locationOrOffset.range.start.character);\n\t\t}\n\t\t// do better?\n\t\t// return undefined;\n\t\treturn new types.Position(0, 0);\n\t}\n\n\tlocationAt(positionOrRange: vscode.Range | vscode.Position): types.Location {\n\t\tif (!types.Range.isRange(positionOrRange)) {\n\t\t\tpositionOrRange = new types.Range(<types.Position>positionOrRange, <types.Position>positionOrRange);\n\t\t}\n\n\t\tconst startIdx = this._cellLines.getIndexOf(positionOrRange.start.line);\n\t\tlet endIdx = startIdx;\n\t\tif (!positionOrRange.isEmpty) {\n\t\t\tendIdx = this._cellLines.getIndexOf(positionOrRange.end.line);\n\t\t}\n\n\t\tconst startPos = new types.Position(startIdx.remainder, positionOrRange.start.character);\n\t\tconst endPos = new types.Position(endIdx.remainder, positionOrRange.end.character);\n\t\tconst range = new types.Range(startPos, endPos);\n\n\t\tconst startCell = this._cells[startIdx.index];\n\t\treturn new types.Location(startCell.uri, <types.Range>startCell.document.validateRange(range));\n\t}\n\n\tcontains(uri: vscode.Uri): boolean {\n\t\treturn this._cellUris.has(uri);\n\t}\n\n\tvalidateRange(range: vscode.Range): vscode.Range {\n\t\tconst start = this.validatePosition(range.start);\n\t\tconst end = this.validatePosition(range.end);\n\t\treturn range.with(start, end);\n\t}\n\n\tvalidatePosition(position: vscode.Position): vscode.Position {\n\t\tconst startIdx = this._cellLines.getIndexOf(position.line);\n\n\t\tconst cellPosition = new types.Position(startIdx.remainder, position.character);\n\t\tconst validCellPosition = this._cells[startIdx.index].document.validatePosition(cellPosition);\n\n\t\tconst line = this._cellLines.getAccumulatedValue(startIdx.index - 1);\n\t\treturn new types.Position(line + validCellPosition.line, validCellPosition.character);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { readonly } from 'vs/base/common/errors';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport { MainThreadNotebookShape } from 'vs/workbench/api/common/extHost.protocol';\nimport * as extHostTypes from 'vs/workbench/api/common/extHostTypes';\nimport { addIdToOutput, CellEditType, ICellEditOperation, ICellReplaceEdit, INotebookEditData, notebookDocumentMetadataDefaults } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport * as vscode from 'vscode';\nimport { ExtHostNotebookDocument } from './extHostNotebookDocument';\n\nclass NotebookEditorCellEditBuilder implements vscode.NotebookEditorEdit {\n\n\tprivate readonly _documentVersionId: number;\n\n\tprivate _finalized: boolean = false;\n\tprivate _collectedEdits: ICellEditOperation[] = [];\n\n\tconstructor(documentVersionId: number) {\n\t\tthis._documentVersionId = documentVersionId;\n\t}\n\n\tfinalize(): INotebookEditData {\n\t\tthis._finalized = true;\n\t\treturn {\n\t\t\tdocumentVersionId: this._documentVersionId,\n\t\t\tcellEdits: this._collectedEdits\n\t\t};\n\t}\n\n\tprivate _throwIfFinalized() {\n\t\tif (this._finalized) {\n\t\t\tthrow new Error('Edit is only valid while callback runs');\n\t\t}\n\t}\n\n\treplaceMetadata(value: vscode.NotebookDocumentMetadata): void {\n\t\tthis._throwIfFinalized();\n\t\tthis._collectedEdits.push({\n\t\t\teditType: CellEditType.DocumentMetadata,\n\t\t\tmetadata: { ...notebookDocumentMetadataDefaults, ...value }\n\t\t});\n\t}\n\n\treplaceCellMetadata(index: number, metadata: vscode.NotebookCellMetadata): void {\n\t\tthis._throwIfFinalized();\n\t\tthis._collectedEdits.push({\n\t\t\teditType: CellEditType.Metadata,\n\t\t\tindex,\n\t\t\tmetadata\n\t\t});\n\t}\n\n\treplaceCellOutput(index: number, outputs: (vscode.NotebookCellOutput | vscode.CellOutput)[]): void {\n\t\tthis._throwIfFinalized();\n\t\tthis._collectedEdits.push({\n\t\t\teditType: CellEditType.Output,\n\t\t\tindex,\n\t\t\toutputs: outputs.map(output => {\n\t\t\t\tif (extHostTypes.NotebookCellOutput.isNotebookCellOutput(output)) {\n\t\t\t\t\treturn addIdToOutput(output.toJSON());\n\t\t\t\t} else {\n\t\t\t\t\treturn addIdToOutput(output);\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\t}\n\n\treplaceCells(from: number, to: number, cells: vscode.NotebookCellData[]): void {\n\t\tthis._throwIfFinalized();\n\t\tif (from === to && cells.length === 0) {\n\t\t\treturn;\n\t\t}\n\t\tthis._collectedEdits.push({\n\t\t\teditType: CellEditType.Replace,\n\t\t\tindex: from,\n\t\t\tcount: to - from,\n\t\t\tcells: cells.map(data => {\n\t\t\t\treturn {\n\t\t\t\t\t...data,\n\t\t\t\t\toutputs: data.outputs.map(output => addIdToOutput(output)),\n\t\t\t\t};\n\t\t\t})\n\t\t});\n\t}\n}\n\nexport class ExtHostNotebookEditor extends Disposable implements vscode.NotebookEditor {\n\n\t//TODO@rebornix noop setter?\n\tselection?: vscode.NotebookCell;\n\n\tprivate _visibleRanges: vscode.NotebookCellRange[] = [];\n\tprivate _viewColumn?: vscode.ViewColumn;\n\tprivate _active: boolean = false;\n\tprivate _visible: boolean = false;\n\tprivate _kernel?: vscode.NotebookKernel;\n\n\tprivate _onDidDispose = new Emitter<void>();\n\tprivate _onDidReceiveMessage = new Emitter<any>();\n\n\treadonly onDidDispose: Event<void> = this._onDidDispose.event;\n\treadonly onDidReceiveMessage: vscode.Event<any> = this._onDidReceiveMessage.event;\n\n\tprivate _hasDecorationsForKey: { [key: string]: boolean; } = Object.create(null);\n\n\tconstructor(\n\t\treadonly id: string,\n\t\tprivate readonly _viewType: string,\n\t\tprivate readonly _proxy: MainThreadNotebookShape,\n\t\tprivate readonly _webComm: vscode.NotebookCommunication,\n\t\treadonly notebookData: ExtHostNotebookDocument,\n\t) {\n\t\tsuper();\n\t\tthis._register(this._webComm.onDidReceiveMessage(e => {\n\t\t\tthis._onDidReceiveMessage.fire(e);\n\t\t}));\n\t}\n\n\tget viewColumn(): vscode.ViewColumn | undefined {\n\t\treturn this._viewColumn;\n\t}\n\n\tset viewColumn(_value) {\n\t\tthrow readonly('viewColumn');\n\t}\n\n\tget kernel() {\n\t\treturn this._kernel;\n\t}\n\n\tset kernel(_kernel: vscode.NotebookKernel | undefined) {\n\t\tthrow readonly('kernel');\n\t}\n\n\t_acceptKernel(kernel?: vscode.NotebookKernel) {\n\t\tthis._kernel = kernel;\n\t}\n\n\tget visible(): boolean {\n\t\treturn this._visible;\n\t}\n\n\tset visible(_state: boolean) {\n\t\tthrow readonly('visible');\n\t}\n\n\t_acceptVisibility(value: boolean) {\n\t\tthis._visible = value;\n\t}\n\n\tget visibleRanges() {\n\t\treturn this._visibleRanges;\n\t}\n\n\tset visibleRanges(_range: vscode.NotebookCellRange[]) {\n\t\tthrow readonly('visibleRanges');\n\t}\n\n\t_acceptVisibleRanges(value: vscode.NotebookCellRange[]): void {\n\t\tthis._visibleRanges = value;\n\t}\n\n\tget active(): boolean {\n\t\treturn this._active;\n\t}\n\n\tset active(_state: boolean) {\n\t\tthrow readonly('active');\n\t}\n\n\t_acceptActive(value: boolean) {\n\t\tthis._active = value;\n\t}\n\n\tget document(): vscode.NotebookDocument {\n\t\treturn this.notebookData.notebookDocument;\n\t}\n\n\tedit(callback: (editBuilder: NotebookEditorCellEditBuilder) => void): Thenable<boolean> {\n\t\tconst edit = new NotebookEditorCellEditBuilder(this.document.version);\n\t\tcallback(edit);\n\t\treturn this._applyEdit(edit.finalize());\n\t}\n\n\tprivate _applyEdit(editData: INotebookEditData): Promise<boolean> {\n\n\t\t// return when there is nothing to do\n\t\tif (editData.cellEdits.length === 0) {\n\t\t\treturn Promise.resolve(true);\n\t\t}\n\n\t\tconst compressedEdits: ICellEditOperation[] = [];\n\t\tlet compressedEditsIndex = -1;\n\n\t\tfor (let i = 0; i < editData.cellEdits.length; i++) {\n\t\t\tif (compressedEditsIndex < 0) {\n\t\t\t\tcompressedEdits.push(editData.cellEdits[i]);\n\t\t\t\tcompressedEditsIndex++;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst prevIndex = compressedEditsIndex;\n\t\t\tconst prev = compressedEdits[prevIndex];\n\n\t\t\tif (prev.editType === CellEditType.Replace && editData.cellEdits[i].editType === CellEditType.Replace) {\n\t\t\t\tconst edit = editData.cellEdits[i];\n\t\t\t\tif ((edit.editType !== CellEditType.DocumentMetadata && edit.editType !== CellEditType.Unknown) && prev.index === edit.index) {\n\t\t\t\t\tprev.cells.push(...(editData.cellEdits[i] as ICellReplaceEdit).cells);\n\t\t\t\t\tprev.count += (editData.cellEdits[i] as ICellReplaceEdit).count;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcompressedEdits.push(editData.cellEdits[i]);\n\t\t\tcompressedEditsIndex++;\n\t\t}\n\n\t\treturn this._proxy.$tryApplyEdits(this._viewType, this.document.uri, editData.documentVersionId, compressedEdits);\n\t}\n\n\tsetDecorations(decorationType: vscode.NotebookEditorDecorationType, range: vscode.NotebookCellRange): void {\n\t\tconst willBeEmpty = (range.start === range.end);\n\t\tif (willBeEmpty && !this._hasDecorationsForKey[decorationType.key]) {\n\t\t\t// avoid no-op call to the renderer\n\t\t\treturn;\n\t\t}\n\t\tif (willBeEmpty) {\n\t\t\tdelete this._hasDecorationsForKey[decorationType.key];\n\t\t} else {\n\t\t\tthis._hasDecorationsForKey[decorationType.key] = true;\n\t\t}\n\n\t\treturn this._proxy.$trySetDecorations(\n\t\t\tthis.id,\n\t\t\trange,\n\t\t\tdecorationType.key\n\t\t);\n\t}\n\n\trevealRange(range: vscode.NotebookCellRange, revealType?: extHostTypes.NotebookEditorRevealType) {\n\t\tthis._proxy.$tryRevealRange(this.id, range, revealType || extHostTypes.NotebookEditorRevealType.Default);\n\t}\n\n\tasync postMessage(message: any): Promise<boolean> {\n\t\treturn this._webComm.postMessage(message);\n\t}\n\n\tasWebviewUri(localResource: vscode.Uri): vscode.Uri {\n\t\treturn this._webComm.asWebviewUri(localResource);\n\t}\n\n\tdispose() {\n\t\tthis._onDidDispose.fire();\n\t\tsuper.dispose();\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ColorTheme, ColorThemeKind } from './extHostTypes';\nimport { IExtHostRpcService } from 'vs/workbench/api/common/extHostRpcService';\nimport { ExtHostThemingShape } from 'vs/workbench/api/common/extHost.protocol';\nimport { Emitter, Event } from 'vs/base/common/event';\n\nexport class ExtHostTheming implements ExtHostThemingShape {\n\n\treadonly _serviceBrand: undefined;\n\n\tprivate _actual: ColorTheme;\n\tprivate _onDidChangeActiveColorTheme: Emitter<ColorTheme>;\n\n\tconstructor(\n\t\t@IExtHostRpcService _extHostRpc: IExtHostRpcService\n\t) {\n\t\tthis._actual = new ColorTheme(ColorThemeKind.Dark);\n\t\tthis._onDidChangeActiveColorTheme = new Emitter<ColorTheme>();\n\t}\n\n\tpublic get activeColorTheme(): ColorTheme {\n\t\treturn this._actual;\n\t}\n\n\t$onColorThemeChange(type: string): void {\n\t\tlet kind = type === 'light' ? ColorThemeKind.Light : type === 'dark' ? ColorThemeKind.Dark : ColorThemeKind.HighContrast;\n\t\tthis._actual = new ColorTheme(kind);\n\t\tthis._onDidChangeActiveColorTheme.fire(this._actual);\n\t}\n\n\tpublic get onDidChangeActiveColorTheme(): Event<ColorTheme> {\n\t\treturn this._onDidChangeActiveColorTheme.event;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Action } from 'vs/base/common/actions';\nimport { Event } from 'vs/base/common/event';\nimport { LinkedMap } from 'vs/base/common/map';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { IDisposable } from 'vs/base/common/lifecycle';\n\nimport { IWorkspaceFolder, IWorkspace } from 'vs/platform/workspace/common/workspace';\nimport { Task, ContributedTask, CustomTask, TaskSet, TaskSorter, TaskEvent, TaskIdentifier, ConfiguringTask, TaskRunSource } from 'vs/workbench/contrib/tasks/common/tasks';\nimport { ITaskSummary, TaskTerminateResponse, TaskSystemInfo } from 'vs/workbench/contrib/tasks/common/taskSystem';\nimport { IStringDictionary } from 'vs/base/common/collections';\nimport { RawContextKey } from 'vs/platform/contextkey/common/contextkey';\n\nexport { ITaskSummary, Task, TaskTerminateResponse };\n\nexport const CustomExecutionSupportedContext = new RawContextKey<boolean>('customExecutionSupported', true);\nexport const ShellExecutionSupportedContext = new RawContextKey<boolean>('shellExecutionSupported', false);\nexport const ProcessExecutionSupportedContext = new RawContextKey<boolean>('processExecutionSupported', false);\n\nexport const ITaskService = createDecorator<ITaskService>('taskService');\n\nexport interface ITaskProvider {\n\tprovideTasks(validTypes: IStringDictionary<boolean>): Promise<TaskSet>;\n\tresolveTask(task: ConfiguringTask): Promise<ContributedTask | undefined>;\n}\n\nexport interface ProblemMatcherRunOptions {\n\tattachProblemMatcher?: boolean;\n}\n\nexport interface CustomizationProperties {\n\tgroup?: string | { kind?: string; isDefault?: boolean; };\n\tproblemMatcher?: string | string[];\n\tisBackground?: boolean;\n}\n\nexport interface TaskFilter {\n\tversion?: string;\n\ttype?: string;\n}\n\ninterface WorkspaceTaskResult {\n\tset: TaskSet | undefined;\n\tconfigurations: {\n\t\tbyIdentifier: IStringDictionary<ConfiguringTask>;\n\t} | undefined;\n\thasErrors: boolean;\n}\n\nexport interface WorkspaceFolderTaskResult extends WorkspaceTaskResult {\n\tworkspaceFolder: IWorkspaceFolder;\n}\n\nexport const USER_TASKS_GROUP_KEY = 'settings';\n\nexport interface ITaskService {\n\treadonly _serviceBrand: undefined;\n\tonDidStateChange: Event<TaskEvent>;\n\tsupportsMultipleTaskExecutions: boolean;\n\n\tconfigureAction(): Action;\n\tbuild(): Promise<ITaskSummary>;\n\trunTest(): Promise<ITaskSummary>;\n\trun(task: Task | undefined, options?: ProblemMatcherRunOptions): Promise<ITaskSummary | undefined>;\n\tinTerminal(): boolean;\n\tisActive(): Promise<boolean>;\n\tgetActiveTasks(): Promise<Task[]>;\n\tgetBusyTasks(): Promise<Task[]>;\n\trestart(task: Task): void;\n\tterminate(task: Task): Promise<TaskTerminateResponse>;\n\tterminateAll(): Promise<TaskTerminateResponse[]>;\n\ttasks(filter?: TaskFilter): Promise<Task[]>;\n\ttaskTypes(): string[];\n\tgetWorkspaceTasks(runSource?: TaskRunSource): Promise<Map<string, WorkspaceFolderTaskResult>>;\n\treadRecentTasks(): Promise<(Task | ConfiguringTask)[]>;\n\tremoveRecentlyUsedTask(taskRecentlyUsedKey: string): void;\n\t/**\n\t * @param alias The task's name, label or defined identifier.\n\t */\n\tgetTask(workspaceFolder: IWorkspace | IWorkspaceFolder | string, alias: string | TaskIdentifier, compareId?: boolean): Promise<Task | undefined>;\n\ttryResolveTask(configuringTask: ConfiguringTask): Promise<Task | undefined>;\n\tgetTasksForGroup(group: string): Promise<Task[]>;\n\tgetRecentlyUsedTasks(): LinkedMap<string, string>;\n\tmigrateRecentTasks(tasks: Task[]): Promise<void>;\n\tcreateSorter(): TaskSorter;\n\n\tgetTaskDescription(task: Task | ConfiguringTask): string | undefined;\n\tcanCustomize(task: ContributedTask | CustomTask): boolean;\n\tcustomize(task: ContributedTask | CustomTask | ConfiguringTask, properties?: {}, openConfig?: boolean): Promise<void>;\n\topenConfig(task: CustomTask | ConfiguringTask | undefined): Promise<boolean>;\n\n\tregisterTaskProvider(taskProvider: ITaskProvider, type: string): IDisposable;\n\n\tregisterTaskSystem(scheme: string, taskSystemInfo: TaskSystemInfo): void;\n\tregisterSupportedExecutions(custom?: boolean, shell?: boolean, process?: boolean): void;\n\n\textensionCallbackTaskComplete(task: Task, result: number | undefined): Promise<void>;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { Event } from 'vs/base/common/event';\nimport { IProcessEnvironment } from 'vs/base/common/platform';\nimport { ThemeIcon } from 'vs/platform/theme/common/themeService';\n\nexport const IEnvironmentVariableService = createDecorator<IEnvironmentVariableService>('environmentVariableService');\n\nexport enum EnvironmentVariableMutatorType {\n\tReplace = 1,\n\tAppend = 2,\n\tPrepend = 3\n}\n\nexport interface IEnvironmentVariableMutator {\n\treadonly value: string;\n\treadonly type: EnvironmentVariableMutatorType;\n}\n\nexport interface IExtensionOwnedEnvironmentVariableMutator extends IEnvironmentVariableMutator {\n\treadonly extensionIdentifier: string;\n}\n\nexport interface IEnvironmentVariableCollection {\n\treadonly map: ReadonlyMap<string, IEnvironmentVariableMutator>;\n}\n\nexport interface IEnvironmentVariableCollectionWithPersistence extends IEnvironmentVariableCollection {\n\treadonly persistent: boolean;\n}\n\nexport interface IMergedEnvironmentVariableCollectionDiff {\n\tadded: ReadonlyMap<string, IExtensionOwnedEnvironmentVariableMutator[]>;\n\tchanged: ReadonlyMap<string, IExtensionOwnedEnvironmentVariableMutator[]>;\n\tremoved: ReadonlyMap<string, IExtensionOwnedEnvironmentVariableMutator[]>;\n}\n\n/**\n * Represents an environment variable collection that results from merging several collections\n * together.\n */\nexport interface IMergedEnvironmentVariableCollection {\n\treadonly map: ReadonlyMap<string, IExtensionOwnedEnvironmentVariableMutator[]>;\n\n\t/**\n\t * Applies this collection to a process environment.\n\t */\n\tapplyToProcessEnvironment(env: IProcessEnvironment): void;\n\n\t/**\n\t * Generates a diff of this connection against another. Returns undefined if the collections are\n\t * the same.\n\t */\n\tdiff(other: IMergedEnvironmentVariableCollection): IMergedEnvironmentVariableCollectionDiff | undefined;\n}\n\n/**\n * Tracks and persists environment variable collections as defined by extensions.\n */\nexport interface IEnvironmentVariableService {\n\treadonly _serviceBrand: undefined;\n\n\t/**\n\t * Gets a single collection constructed by merging all environment variable collections into\n\t * one.\n\t */\n\treadonly collections: ReadonlyMap<string, IEnvironmentVariableCollection>;\n\n\t/**\n\t * Gets a single collection constructed by merging all environment variable collections into\n\t * one.\n\t */\n\treadonly mergedCollection: IMergedEnvironmentVariableCollection;\n\n\t/**\n\t * An event that is fired when an extension's environment variable collection changes, the event\n\t * provides the new merged collection.\n\t */\n\tonDidChangeCollections: Event<IMergedEnvironmentVariableCollection>;\n\n\t/**\n\t * Sets an extension's environment variable collection.\n\t */\n\tset(extensionIdentifier: string, collection: IEnvironmentVariableCollection): void;\n\n\t/**\n\t * Deletes an extension's environment variable collection.\n\t */\n\tdelete(extensionIdentifier: string): void;\n}\n\n/** [variable, mutator] */\nexport type ISerializableEnvironmentVariableCollection = [string, IEnvironmentVariableMutator][];\n\nexport interface IEnvironmentVariableInfo {\n\treadonly requiresAction: boolean;\n\tgetInfo(): string;\n\tgetIcon(): ThemeIcon;\n\tgetActions?(): { label: string, iconClass?: string, run: () => void, commandId: string }[];\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IEnvironmentVariableCollection, EnvironmentVariableMutatorType, IMergedEnvironmentVariableCollection, IMergedEnvironmentVariableCollectionDiff, IExtensionOwnedEnvironmentVariableMutator } from 'vs/workbench/contrib/terminal/common/environmentVariable';\nimport { IProcessEnvironment, isWindows } from 'vs/base/common/platform';\n\nexport class MergedEnvironmentVariableCollection implements IMergedEnvironmentVariableCollection {\n\treadonly map: Map<string, IExtensionOwnedEnvironmentVariableMutator[]> = new Map();\n\n\tconstructor(collections: Map<string, IEnvironmentVariableCollection>) {\n\t\tcollections.forEach((collection, extensionIdentifier) => {\n\t\t\tconst it = collection.map.entries();\n\t\t\tlet next = it.next();\n\t\t\twhile (!next.done) {\n\t\t\t\tconst variable = next.value[0];\n\t\t\t\tlet entry = this.map.get(variable);\n\t\t\t\tif (!entry) {\n\t\t\t\t\tentry = [];\n\t\t\t\t\tthis.map.set(variable, entry);\n\t\t\t\t}\n\n\t\t\t\t// If the first item in the entry is replace ignore any other entries as they would\n\t\t\t\t// just get replaced by this one.\n\t\t\t\tif (entry.length > 0 && entry[0].type === EnvironmentVariableMutatorType.Replace) {\n\t\t\t\t\tnext = it.next();\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Mutators get applied in the reverse order than they are created\n\t\t\t\tconst mutator = next.value[1];\n\t\t\t\tentry.unshift({\n\t\t\t\t\textensionIdentifier,\n\t\t\t\t\tvalue: mutator.value,\n\t\t\t\t\ttype: mutator.type\n\t\t\t\t});\n\n\t\t\t\tnext = it.next();\n\t\t\t}\n\t\t});\n\t}\n\n\tapplyToProcessEnvironment(env: IProcessEnvironment): void {\n\t\tlet lowerToActualVariableNames: { [lowerKey: string]: string | undefined } | undefined;\n\t\tif (isWindows) {\n\t\t\tlowerToActualVariableNames = {};\n\t\t\tObject.keys(env).forEach(e => lowerToActualVariableNames![e.toLowerCase()] = e);\n\t\t}\n\t\tthis.map.forEach((mutators, variable) => {\n\t\t\tconst actualVariable = isWindows ? lowerToActualVariableNames![variable.toLowerCase()] || variable : variable;\n\t\t\tmutators.forEach(mutator => {\n\t\t\t\tswitch (mutator.type) {\n\t\t\t\t\tcase EnvironmentVariableMutatorType.Append:\n\t\t\t\t\t\tenv[actualVariable] = (env[actualVariable] || '') + mutator.value;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase EnvironmentVariableMutatorType.Prepend:\n\t\t\t\t\t\tenv[actualVariable] = mutator.value + (env[actualVariable] || '');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase EnvironmentVariableMutatorType.Replace:\n\t\t\t\t\t\tenv[actualVariable] = mutator.value;\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tdiff(other: IMergedEnvironmentVariableCollection): IMergedEnvironmentVariableCollectionDiff | undefined {\n\t\tconst added: Map<string, IExtensionOwnedEnvironmentVariableMutator[]> = new Map();\n\t\tconst changed: Map<string, IExtensionOwnedEnvironmentVariableMutator[]> = new Map();\n\t\tconst removed: Map<string, IExtensionOwnedEnvironmentVariableMutator[]> = new Map();\n\n\t\t// Find added\n\t\tother.map.forEach((otherMutators, variable) => {\n\t\t\tconst currentMutators = this.map.get(variable);\n\t\t\tconst result = getMissingMutatorsFromArray(otherMutators, currentMutators);\n\t\t\tif (result) {\n\t\t\t\tadded.set(variable, result);\n\t\t\t}\n\t\t});\n\n\t\t// Find removed\n\t\tthis.map.forEach((currentMutators, variable) => {\n\t\t\tconst otherMutators = other.map.get(variable);\n\t\t\tconst result = getMissingMutatorsFromArray(currentMutators, otherMutators);\n\t\t\tif (result) {\n\t\t\t\tremoved.set(variable, result);\n\t\t\t}\n\t\t});\n\n\t\t// Find changed\n\t\tthis.map.forEach((currentMutators, variable) => {\n\t\t\tconst otherMutators = other.map.get(variable);\n\t\t\tconst result = getChangedMutatorsFromArray(currentMutators, otherMutators);\n\t\t\tif (result) {\n\t\t\t\tchanged.set(variable, result);\n\t\t\t}\n\t\t});\n\n\t\tif (added.size === 0 && changed.size === 0 && removed.size === 0) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn { added, changed, removed };\n\t}\n}\n\nfunction getMissingMutatorsFromArray(\n\tcurrent: IExtensionOwnedEnvironmentVariableMutator[],\n\tother: IExtensionOwnedEnvironmentVariableMutator[] | undefined\n): IExtensionOwnedEnvironmentVariableMutator[] | undefined {\n\t// If it doesn't exist, all are removed\n\tif (!other) {\n\t\treturn current;\n\t}\n\n\t// Create a map to help\n\tconst otherMutatorExtensions = new Set<string>();\n\tother.forEach(m => otherMutatorExtensions.add(m.extensionIdentifier));\n\n\t// Find entries removed from other\n\tconst result: IExtensionOwnedEnvironmentVariableMutator[] = [];\n\tcurrent.forEach(mutator => {\n\t\tif (!otherMutatorExtensions.has(mutator.extensionIdentifier)) {\n\t\t\tresult.push(mutator);\n\t\t}\n\t});\n\n\treturn result.length === 0 ? undefined : result;\n}\n\nfunction getChangedMutatorsFromArray(\n\tcurrent: IExtensionOwnedEnvironmentVariableMutator[],\n\tother: IExtensionOwnedEnvironmentVariableMutator[] | undefined\n): IExtensionOwnedEnvironmentVariableMutator[] | undefined {\n\t// If it doesn't exist, none are changed (they are removed)\n\tif (!other) {\n\t\treturn undefined;\n\t}\n\n\t// Create a map to help\n\tconst otherMutatorExtensions = new Map<string, IExtensionOwnedEnvironmentVariableMutator>();\n\tother.forEach(m => otherMutatorExtensions.set(m.extensionIdentifier, m));\n\n\t// Find entries that exist in both but are not equal\n\tconst result: IExtensionOwnedEnvironmentVariableMutator[] = [];\n\tcurrent.forEach(mutator => {\n\t\tconst otherMutator = otherMutatorExtensions.get(mutator.extensionIdentifier);\n\t\tif (otherMutator && (mutator.type !== otherMutator.type || mutator.value !== otherMutator.value)) {\n\t\t\t// Return the new result, not the old one\n\t\t\tresult.push(otherMutator);\n\t\t}\n\t});\n\n\treturn result.length === 0 ? undefined : result;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IEnvironmentVariableMutator, ISerializableEnvironmentVariableCollection } from 'vs/workbench/contrib/terminal/common/environmentVariable';\n\n// This file is shared between the renderer and extension host\n\nexport function serializeEnvironmentVariableCollection(collection: ReadonlyMap<string, IEnvironmentVariableMutator>): ISerializableEnvironmentVariableCollection {\n\treturn [...collection.entries()];\n}\n\nexport function deserializeEnvironmentVariableCollection(\n\tserializedCollection: ISerializableEnvironmentVariableCollection\n): Map<string, IEnvironmentVariableMutator> {\n\treturn new Map<string, IEnvironmentVariableMutator>(serializedCollection);\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as nls from 'vs/nls';\nimport { Event } from 'vs/base/common/event';\nimport { IDisposable } from 'vs/base/common/lifecycle';\nimport { RawContextKey } from 'vs/platform/contextkey/common/contextkey';\nimport { URI } from 'vs/base/common/uri';\nimport { OperatingSystem } from 'vs/base/common/platform';\nimport { IEnvironmentVariableInfo } from 'vs/workbench/contrib/terminal/common/environmentVariable';\nimport { IExtensionPointDescriptor } from 'vs/workbench/services/extensions/common/extensionsRegistry';\n\nexport const TERMINAL_VIEW_ID = 'terminal';\n\n/** A context key that is set when there is at least one opened integrated terminal. */\nexport const KEYBINDING_CONTEXT_TERMINAL_IS_OPEN = new RawContextKey<boolean>('terminalIsOpen', false);\n\n/** A context key that is set when the integrated terminal has focus. */\nexport const KEYBINDING_CONTEXT_TERMINAL_FOCUS = new RawContextKey<boolean>('terminalFocus', false);\n\nexport const KEYBINDING_CONTEXT_TERMINAL_SHELL_TYPE_KEY = 'terminalShellType';\n/** A context key that is set to the detected shell for the most recently active terminal, this is set to the last known value when no terminals exist. */\nexport const KEYBINDING_CONTEXT_TERMINAL_SHELL_TYPE = new RawContextKey<string>(KEYBINDING_CONTEXT_TERMINAL_SHELL_TYPE_KEY, undefined);\n\nexport const KEYBINDING_CONTEXT_TERMINAL_ALT_BUFFER_ACTIVE = new RawContextKey<boolean>('terminalAltBufferActive', false);\n\n/** A context key that is set when the integrated terminal does not have focus. */\nexport const KEYBINDING_CONTEXT_TERMINAL_NOT_FOCUSED = KEYBINDING_CONTEXT_TERMINAL_FOCUS.toNegated();\n\n/** A context key that is set when the user is navigating the accessibility tree */\nexport const KEYBINDING_CONTEXT_TERMINAL_A11Y_TREE_FOCUS = new RawContextKey<boolean>('terminalA11yTreeFocus', false);\n\n/** A keybinding context key that is set when the integrated terminal has text selected. */\nexport const KEYBINDING_CONTEXT_TERMINAL_TEXT_SELECTED = new RawContextKey<boolean>('terminalTextSelected', false);\n/** A keybinding context key that is set when the integrated terminal does not have text selected. */\nexport const KEYBINDING_CONTEXT_TERMINAL_TEXT_NOT_SELECTED = KEYBINDING_CONTEXT_TERMINAL_TEXT_SELECTED.toNegated();\n\n/**  A context key that is set when the find widget in integrated terminal is visible. */\nexport const KEYBINDING_CONTEXT_TERMINAL_FIND_VISIBLE = new RawContextKey<boolean>('terminalFindVisible', false);\n/**  A context key that is set when the find widget in integrated terminal is not visible. */\nexport const KEYBINDING_CONTEXT_TERMINAL_FIND_NOT_VISIBLE = KEYBINDING_CONTEXT_TERMINAL_FIND_VISIBLE.toNegated();\n/**  A context key that is set when the find widget find input in integrated terminal is focused. */\nexport const KEYBINDING_CONTEXT_TERMINAL_FIND_INPUT_FOCUSED = new RawContextKey<boolean>('terminalFindInputFocused', false);\n/**  A context key that is set when the find widget in integrated terminal is focused. */\nexport const KEYBINDING_CONTEXT_TERMINAL_FIND_FOCUSED = new RawContextKey<boolean>('terminalFindFocused', false);\n/**  A context key that is set when the find widget find input in integrated terminal is not focused. */\nexport const KEYBINDING_CONTEXT_TERMINAL_FIND_INPUT_NOT_FOCUSED = KEYBINDING_CONTEXT_TERMINAL_FIND_INPUT_FOCUSED.toNegated();\n\nexport const KEYBINDING_CONTEXT_TERMINAL_PROCESS_SUPPORTED = new RawContextKey<boolean>('terminalProcessSupported', false);\n\nexport const IS_WORKSPACE_SHELL_ALLOWED_STORAGE_KEY = 'terminal.integrated.isWorkspaceShellAllowed';\nexport const NEVER_MEASURE_RENDER_TIME_STORAGE_KEY = 'terminal.integrated.neverMeasureRenderTime';\n\nexport const TERMINAL_CREATION_COMMANDS = ['workbench.action.terminal.toggleTerminal', 'workbench.action.terminal.new', 'workbench.action.togglePanel', 'workbench.action.terminal.focus'];\n\nexport const TerminalCursorStyle = {\n\tBLOCK: 'block',\n\tLINE: 'line',\n\tUNDERLINE: 'underline'\n};\n\nexport const TERMINAL_CONFIG_SECTION = 'terminal.integrated';\n\nexport const TERMINAL_ACTION_CATEGORY = nls.localize('terminalCategory', \"Terminal\");\n\nexport const DEFAULT_LETTER_SPACING = 0;\nexport const MINIMUM_LETTER_SPACING = -5;\nexport const DEFAULT_LINE_HEIGHT = 1;\n\nexport const MINIMUM_FONT_WEIGHT = 1;\nexport const MAXIMUM_FONT_WEIGHT = 1000;\nexport const DEFAULT_FONT_WEIGHT = 'normal';\nexport const DEFAULT_BOLD_FONT_WEIGHT = 'bold';\nexport const SUGGESTIONS_FONT_WEIGHT = ['normal', 'bold', '100', '200', '300', '400', '500', '600', '700', '800', '900'];\n\nexport type FontWeight = 'normal' | 'bold' | number;\n\nexport interface ITerminalConfiguration {\n\tshell: {\n\t\tlinux: string | null;\n\t\tosx: string | null;\n\t\twindows: string | null;\n\t};\n\tautomationShell: {\n\t\tlinux: string | null;\n\t\tosx: string | null;\n\t\twindows: string | null;\n\t};\n\tshellArgs: {\n\t\tlinux: string[];\n\t\tosx: string[];\n\t\twindows: string[];\n\t};\n\taltClickMovesCursor: boolean;\n\tmacOptionIsMeta: boolean;\n\tmacOptionClickForcesSelection: boolean;\n\trendererType: 'auto' | 'canvas' | 'dom' | 'experimentalWebgl';\n\trightClickBehavior: 'default' | 'copyPaste' | 'paste' | 'selectWord';\n\tcursorBlinking: boolean;\n\tcursorStyle: string;\n\tcursorWidth: number;\n\tdrawBoldTextInBrightColors: boolean;\n\tfastScrollSensitivity: number;\n\tfontFamily: string;\n\tfontWeight: FontWeight;\n\tfontWeightBold: FontWeight;\n\tminimumContrastRatio: number;\n\tmouseWheelScrollSensitivity: number;\n\tsendKeybindingsToShell: boolean;\n\t// fontLigatures: boolean;\n\tfontSize: number;\n\tletterSpacing: number;\n\tlineHeight: number;\n\tdetectLocale: 'auto' | 'off' | 'on';\n\tscrollback: number;\n\tcommandsToSkipShell: string[];\n\tallowChords: boolean;\n\tallowMnemonics: boolean;\n\tcwd: string;\n\tconfirmOnExit: boolean;\n\tenableBell: boolean;\n\tinheritEnv: boolean;\n\tenv: {\n\t\tlinux: { [key: string]: string };\n\t\tosx: { [key: string]: string };\n\t\twindows: { [key: string]: string };\n\t};\n\tenvironmentChangesIndicator: 'off' | 'on' | 'warnonly';\n\tshowExitAlert: boolean;\n\tsplitCwd: 'workspaceRoot' | 'initial' | 'inherited';\n\twindowsEnableConpty: boolean;\n\twordSeparators: string;\n\texperimentalUseTitleEvent: boolean;\n\tenableFileLinks: boolean;\n\tunicodeVersion: '6' | '11';\n\texperimentalLinkProvider: boolean;\n\tlocalEchoLatencyThreshold: number;\n\tlocalEchoExcludePrograms: ReadonlyArray<string>;\n\tlocalEchoStyle: 'bold' | 'dim' | 'italic' | 'underlined' | 'inverted' | string;\n\tserverSpawn: boolean;\n\tenablePersistentSessions: boolean;\n\tflowControl: boolean;\n}\n\nexport const DEFAULT_LOCAL_ECHO_EXCLUDE: ReadonlyArray<string> = ['vim', 'vi', 'nano', 'tmux'];\n\nexport interface ITerminalConfigHelper {\n\tconfig: ITerminalConfiguration;\n\n\tonWorkspacePermissionsChanged: Event<boolean>;\n\n\tconfigFontIsMonospace(): boolean;\n\tgetFont(): ITerminalFont;\n\t/** Sets whether a workspace shell configuration is allowed or not */\n\tsetWorkspaceShellAllowed(isAllowed: boolean): void;\n\tcheckWorkspaceShellPermissions(osOverride?: OperatingSystem): boolean;\n\tshowRecommendations(shellLaunchConfig: IShellLaunchConfig): void;\n}\n\nexport interface ITerminalFont {\n\tfontFamily: string;\n\tfontSize: number;\n\tletterSpacing: number;\n\tlineHeight: number;\n\tcharWidth?: number;\n\tcharHeight?: number;\n}\n\nexport interface ITerminalEnvironment {\n\t[key: string]: string | null;\n}\n\nexport interface IRemoteTerminalAttachTarget {\n\tid: number;\n\tpid: number;\n\ttitle: string;\n\tcwd: string;\n\tworkspaceId: string;\n\tworkspaceName: string;\n\tisOrphan: boolean;\n}\n\nexport interface IRawTerminalInstanceLayoutInfo<T> {\n\trelativeSize: number;\n\tterminal: T;\n}\n\nexport type ITerminalInstanceLayoutInfoById = IRawTerminalInstanceLayoutInfo<number>;\nexport type ITerminalInstanceLayoutInfo = IRawTerminalInstanceLayoutInfo<IRemoteTerminalAttachTarget>;\n\nexport interface IRawTerminalTabLayoutInfo<T> {\n\tisActive: boolean;\n\tactiveTerminalProcessId: number;\n\tterminals: IRawTerminalInstanceLayoutInfo<T>[];\n}\n\nexport type ITerminalTabLayoutInfoById = IRawTerminalTabLayoutInfo<number>;\nexport type ITerminalTabLayoutInfo = IRawTerminalTabLayoutInfo<IRemoteTerminalAttachTarget | null>;\n\nexport interface IRawTerminalsLayoutInfo<T> {\n\ttabs: IRawTerminalTabLayoutInfo<T>[];\n}\n\nexport type ITerminalsLayoutInfo = IRawTerminalsLayoutInfo<IRemoteTerminalAttachTarget | null>;\nexport type ITerminalsLayoutInfoById = IRawTerminalsLayoutInfo<number>;\n\nexport interface IShellLaunchConfig {\n\t/**\n\t * The name of the terminal, if this is not set the name of the process will be used.\n\t */\n\tname?: string;\n\n\t/**\n\t * The shell executable (bash, cmd, etc.).\n\t */\n\texecutable?: string;\n\n\t/**\n\t * The CLI arguments to use with executable, a string[] is in argv format and will be escaped,\n\t * a string is in \"CommandLine\" pre-escaped format and will be used as is. The string option is\n\t * only supported on Windows and will throw an exception if used on macOS or Linux.\n\t */\n\targs?: string[] | string;\n\n\t/**\n\t * The current working directory of the terminal, this overrides the `terminal.integrated.cwd`\n\t * settings key.\n\t */\n\tcwd?: string | URI;\n\n\t/**\n\t * A custom environment for the terminal, if this is not set the environment will be inherited\n\t * from the VS Code process.\n\t */\n\tenv?: ITerminalEnvironment;\n\n\t/**\n\t * Whether to ignore a custom cwd from the `terminal.integrated.cwd` settings key (e.g. if the\n\t * shell is being launched by an extension).\n\t */\n\tignoreConfigurationCwd?: boolean;\n\n\t/** Whether to wait for a key press before closing the terminal. */\n\twaitOnExit?: boolean | string;\n\n\t/**\n\t * A string including ANSI escape sequences that will be written to the terminal emulator\n\t * _before_ the terminal process has launched, a trailing \\n is added at the end of the string.\n\t * This allows for example the terminal instance to display a styled message as the first line\n\t * of the terminal. Use \\x1b over \\033 or \\e for the escape control character.\n\t */\n\tinitialText?: string;\n\n\t/**\n\t * Whether an extension is controlling the terminal via a `vscode.Pseudoterminal`.\n\t */\n\tisExtensionTerminal?: boolean;\n\n\t/**\n\t * A UUID generated by the extension host process for terminals created on the extension host process.\n\t */\n\textHostTerminalId?: string;\n\n\t/**\n\t * This is a terminal that attaches to an already running remote terminal.\n\t */\n\tremoteAttach?: { id: number; pid: number; title: string; cwd: string; };\n\n\t/**\n\t * Whether the terminal process environment should be exactly as provided in\n\t * `TerminalOptions.env`. When this is false (default), the environment will be based on the\n\t * window's environment and also apply configured platform settings like\n\t * `terminal.integrated.windows.env` on top. When this is true, the complete environment must be\n\t * provided as nothing will be inherited from the process or any configuration.\n\t */\n\tstrictEnv?: boolean;\n\n\t/**\n\t * When enabled the terminal will run the process as normal but not be surfaced to the user\n\t * until `Terminal.show` is called. The typical usage for this is when you need to run\n\t * something that may need interactivity but only want to tell the user about it when\n\t * interaction is needed. Note that the terminals will still be exposed to all extensions\n\t * as normal.\n\t */\n\thideFromUser?: boolean;\n\n\t/**\n\t * Whether this terminal is not a terminal that the user directly created and uses, but rather\n\t * a terminal used to drive some VS Code feature.\n\t */\n\tisFeatureTerminal?: boolean;\n\n\t/**\n\t * Whether flow control is enabled for this terminal.\n\t */\n\tflowControl?: boolean;\n}\n\n/**\n * Provides access to native Windows calls that can be injected into non-native layers.\n */\nexport interface ITerminalNativeWindowsDelegate {\n\t/**\n\t * Gets the Windows build number, eg. this would be `19041` for Windows 10 version 2004\n\t */\n\tgetWindowsBuildNumber(): number;\n\t/**\n\t * Converts a regular Windows path into the WSL path equivalent, eg. `C:\\` -> `/mnt/c`\n\t * @param path The Windows path.\n\t */\n\tgetWslPath(path: string): Promise<string>;\n}\n\nexport interface IShellDefinition {\n\tlabel: string;\n\tpath: string;\n}\n\nexport interface ITerminalDimensions {\n\t/**\n\t * The columns of the terminal.\n\t */\n\treadonly cols: number;\n\n\t/**\n\t * The rows of the terminal.\n\t */\n\treadonly rows: number;\n}\n\nexport interface ITerminalDimensionsOverride extends ITerminalDimensions {\n\t/**\n\t * indicate that xterm must receive these exact dimensions, even if they overflow the ui!\n\t */\n\tforceExactSize?: boolean;\n}\n\nexport interface ICommandTracker {\n\tscrollToPreviousCommand(): void;\n\tscrollToNextCommand(): void;\n\tselectToPreviousCommand(): void;\n\tselectToNextCommand(): void;\n\tselectToPreviousLine(): void;\n\tselectToNextLine(): void;\n}\n\nexport interface INavigationMode {\n\texitNavigationMode(): void;\n\tfocusPreviousLine(): void;\n\tfocusNextLine(): void;\n}\n\nexport interface IBeforeProcessDataEvent {\n\t/**\n\t * The data of the event, this can be modified by the event listener to change what gets sent\n\t * to the terminal.\n\t */\n\tdata: string;\n}\n\nexport interface IProcessDataEvent {\n\tdata: string;\n\tsync: boolean;\n}\n\nexport interface ITerminalProcessManager extends IDisposable {\n\treadonly processState: ProcessState;\n\treadonly ptyProcessReady: Promise<void>;\n\treadonly shellProcessId: number | undefined;\n\treadonly remoteAuthority: string | undefined;\n\treadonly os: OperatingSystem | undefined;\n\treadonly userHome: string | undefined;\n\treadonly environmentVariableInfo: IEnvironmentVariableInfo | undefined;\n\treadonly remoteTerminalId: number | undefined;\n\n\treadonly onProcessReady: Event<void>;\n\treadonly onBeforeProcessData: Event<IBeforeProcessDataEvent>;\n\treadonly onProcessData: Event<IProcessDataEvent>;\n\treadonly onProcessTitle: Event<string>;\n\treadonly onProcessExit: Event<number | undefined>;\n\treadonly onProcessOverrideDimensions: Event<ITerminalDimensionsOverride | undefined>;\n\treadonly onProcessResolvedShellLaunchConfig: Event<IShellLaunchConfig>;\n\treadonly onEnvironmentVariableInfoChanged: Event<IEnvironmentVariableInfo>;\n\n\tdispose(immediate?: boolean): void;\n\tcreateProcess(shellLaunchConfig: IShellLaunchConfig, cols: number, rows: number, isScreenReaderModeEnabled: boolean): Promise<ITerminalLaunchError | undefined>;\n\twrite(data: string): void;\n\tsetDimensions(cols: number, rows: number): void;\n\tacknowledgeDataEvent(charCount: number): void;\n\n\tgetInitialCwd(): Promise<string>;\n\tgetCwd(): Promise<string>;\n\tgetLatency(): Promise<number>;\n}\n\nexport const enum ProcessState {\n\t// The process has not been initialized yet.\n\tUNINITIALIZED,\n\t// The process is currently launching, the process is marked as launching\n\t// for a short duration after being created and is helpful to indicate\n\t// whether the process died as a result of bad shell and args.\n\tLAUNCHING,\n\t// The process is running normally.\n\tRUNNING,\n\t// The process was killed during launch, likely as a result of bad shell and\n\t// args.\n\tKILLED_DURING_LAUNCH,\n\t// The process was killed by the user (the event originated from VS Code).\n\tKILLED_BY_USER,\n\t// The process was killed by itself, for example the shell crashed or `exit`\n\t// was run.\n\tKILLED_BY_PROCESS\n}\n\nexport interface ITerminalProcessExtHostProxy extends IDisposable {\n\treadonly terminalId: number;\n\n\temitData(data: string): void;\n\temitTitle(title: string): void;\n\temitReady(pid: number, cwd: string): void;\n\temitExit(exitCode: number | undefined): void;\n\temitOverrideDimensions(dimensions: ITerminalDimensions | undefined): void;\n\temitResolvedShellLaunchConfig(shellLaunchConfig: IShellLaunchConfig): void;\n\temitInitialCwd(initialCwd: string): void;\n\temitCwd(cwd: string): void;\n\temitLatency(latency: number): void;\n\n\tonInput: Event<string>;\n\tonResize: Event<{ cols: number, rows: number }>;\n\tonAcknowledgeDataEvent: Event<number>;\n\tonShutdown: Event<boolean>;\n\tonRequestInitialCwd: Event<void>;\n\tonRequestCwd: Event<void>;\n\tonRequestLatency: Event<void>;\n}\n\nexport interface ISpawnExtHostProcessRequest {\n\tproxy: ITerminalProcessExtHostProxy;\n\tshellLaunchConfig: IShellLaunchConfig;\n\tactiveWorkspaceRootUri: URI | undefined;\n\tcols: number;\n\trows: number;\n\tisWorkspaceShellAllowed: boolean;\n\tcallback: (error: ITerminalLaunchError | undefined) => void;\n}\n\nexport interface IStartExtensionTerminalRequest {\n\tproxy: ITerminalProcessExtHostProxy;\n\tcols: number;\n\trows: number;\n\tcallback: (error: ITerminalLaunchError | undefined) => void;\n}\n\nexport interface IAvailableShellsRequest {\n\tcallback: (shells: IShellDefinition[]) => void;\n}\n\nexport interface IDefaultShellAndArgsRequest {\n\tuseAutomationShell: boolean;\n\tcallback: (shell: string, args: string[] | string | undefined) => void;\n}\n\nexport enum LinuxDistro {\n\tFedora,\n\tUbuntu,\n\tUnknown\n}\n\nexport enum TitleEventSource {\n\t/** From the API or the rename command that overrides any other type */\n\tApi,\n\t/** From the process name property*/\n\tProcess,\n\t/** From the VT sequence */\n\tSequence\n}\n\nexport interface IWindowsShellHelper extends IDisposable {\n\treadonly onShellNameChange: Event<string>;\n\n\tgetShellName(): Promise<string>;\n}\n\nexport interface ITerminalLaunchError {\n\tmessage: string;\n\tcode?: number;\n}\n\n/**\n * An interface representing a raw terminal child process, this contains a subset of the\n * child_process.ChildProcess node.js interface.\n */\nexport interface ITerminalChildProcess {\n\tonProcessData: Event<IProcessDataEvent | string>;\n\tonProcessExit: Event<number | undefined>;\n\tonProcessReady: Event<{ pid: number, cwd: string }>;\n\tonProcessTitleChanged: Event<string>;\n\tonProcessOverrideDimensions?: Event<ITerminalDimensionsOverride | undefined>;\n\tonProcessResolvedShellLaunchConfig?: Event<IShellLaunchConfig>;\n\n\t/**\n\t * Starts the process.\n\t *\n\t * @returns undefined when the process was successfully started, otherwise an object containing\n\t * information on what went wrong.\n\t */\n\tstart(): Promise<ITerminalLaunchError | { remoteTerminalId: number } | undefined>;\n\n\t/**\n\t * Shutdown the terminal process.\n\t *\n\t * @param immediate When true the process will be killed immediately, otherwise the process will\n\t * be given some time to make sure no additional data comes through.\n\t */\n\tshutdown(immediate: boolean): void;\n\tinput(data: string): void;\n\tresize(cols: number, rows: number): void;\n\n\t/**\n\t * Acknowledge a data event has been parsed by the terminal, this is used to implement flow\n\t * control to ensure remote processes to not get too far ahead of the client and flood the\n\t * connection.\n\t * @param charCount The number of characters being acknowledged.\n\t */\n\tacknowledgeDataEvent(charCount: number): void;\n\n\tgetInitialCwd(): Promise<string>;\n\tgetCwd(): Promise<string>;\n\tgetLatency(): Promise<number>;\n}\n\nexport const enum FlowControlConstants {\n\t/**\n\t * The number of _unacknowledged_ chars to have been sent before the pty is paused in order for\n\t * the client to catch up.\n\t */\n\tHighWatermarkChars = 100000,\n\t/**\n\t * After flow control pauses the pty for the client the catch up, this is the number of\n\t * _unacknowledged_ chars to have been caught up to on the client before resuming the pty again.\n\t * This is used to attempt to prevent pauses in the flowing data; ideally while the pty is\n\t * paused the number of unacknowledged chars would always be greater than 0 or the client will\n\t * appear to stutter. In reality this balance is hard to accomplish though so heavy commands\n\t * will likely pause as latency grows, not flooding the connection is the important thing as\n\t * it's shared with other core functionality.\n\t */\n\tLowWatermarkChars = 5000,\n\t/**\n\t * The number characters that are accumulated on the client side before sending an ack event.\n\t * This must be less than or equal to LowWatermarkChars or the terminal max never unpause.\n\t */\n\tCharCountAckSize = 5000\n}\n\nexport const enum TERMINAL_COMMAND_ID {\n\tFIND_NEXT = 'workbench.action.terminal.findNext',\n\tFIND_PREVIOUS = 'workbench.action.terminal.findPrevious',\n\tTOGGLE = 'workbench.action.terminal.toggleTerminal',\n\tKILL = 'workbench.action.terminal.kill',\n\tQUICK_KILL = 'workbench.action.terminal.quickKill',\n\tCONFIGURE_TERMINAL_SETTINGS = 'workbench.action.terminal.openSettings',\n\tCOPY_SELECTION = 'workbench.action.terminal.copySelection',\n\tSELECT_ALL = 'workbench.action.terminal.selectAll',\n\tDELETE_WORD_LEFT = 'workbench.action.terminal.deleteWordLeft',\n\tDELETE_WORD_RIGHT = 'workbench.action.terminal.deleteWordRight',\n\tDELETE_TO_LINE_START = 'workbench.action.terminal.deleteToLineStart',\n\tMOVE_TO_LINE_START = 'workbench.action.terminal.moveToLineStart',\n\tMOVE_TO_LINE_END = 'workbench.action.terminal.moveToLineEnd',\n\tNEW = 'workbench.action.terminal.new',\n\tNEW_WITH_CWD = 'workbench.action.terminal.newWithCwd',\n\tNEW_LOCAL = 'workbench.action.terminal.newLocal',\n\tNEW_IN_ACTIVE_WORKSPACE = 'workbench.action.terminal.newInActiveWorkspace',\n\tSPLIT = 'workbench.action.terminal.split',\n\tSPLIT_IN_ACTIVE_WORKSPACE = 'workbench.action.terminal.splitInActiveWorkspace',\n\tRELAUNCH = 'workbench.action.terminal.relaunch',\n\tFOCUS_PREVIOUS_PANE = 'workbench.action.terminal.focusPreviousPane',\n\tFOCUS_NEXT_PANE = 'workbench.action.terminal.focusNextPane',\n\tRESIZE_PANE_LEFT = 'workbench.action.terminal.resizePaneLeft',\n\tRESIZE_PANE_RIGHT = 'workbench.action.terminal.resizePaneRight',\n\tRESIZE_PANE_UP = 'workbench.action.terminal.resizePaneUp',\n\tRESIZE_PANE_DOWN = 'workbench.action.terminal.resizePaneDown',\n\tFOCUS = 'workbench.action.terminal.focus',\n\tFOCUS_NEXT = 'workbench.action.terminal.focusNext',\n\tFOCUS_PREVIOUS = 'workbench.action.terminal.focusPrevious',\n\tPASTE = 'workbench.action.terminal.paste',\n\tSELECT_DEFAULT_SHELL = 'workbench.action.terminal.selectDefaultShell',\n\tRUN_SELECTED_TEXT = 'workbench.action.terminal.runSelectedText',\n\tRUN_ACTIVE_FILE = 'workbench.action.terminal.runActiveFile',\n\tSWITCH_TERMINAL = 'workbench.action.terminal.switchTerminal',\n\tSCROLL_DOWN_LINE = 'workbench.action.terminal.scrollDown',\n\tSCROLL_DOWN_PAGE = 'workbench.action.terminal.scrollDownPage',\n\tSCROLL_TO_BOTTOM = 'workbench.action.terminal.scrollToBottom',\n\tSCROLL_UP_LINE = 'workbench.action.terminal.scrollUp',\n\tSCROLL_UP_PAGE = 'workbench.action.terminal.scrollUpPage',\n\tSCROLL_TO_TOP = 'workbench.action.terminal.scrollToTop',\n\tCLEAR = 'workbench.action.terminal.clear',\n\tCLEAR_SELECTION = 'workbench.action.terminal.clearSelection',\n\tMANAGE_WORKSPACE_SHELL_PERMISSIONS = 'workbench.action.terminal.manageWorkspaceShellPermissions',\n\tRENAME = 'workbench.action.terminal.rename',\n\tRENAME_WITH_ARG = 'workbench.action.terminal.renameWithArg',\n\tFIND_FOCUS = 'workbench.action.terminal.focusFind',\n\tFIND_HIDE = 'workbench.action.terminal.hideFind',\n\tQUICK_OPEN_TERM = 'workbench.action.quickOpenTerm',\n\tSCROLL_TO_PREVIOUS_COMMAND = 'workbench.action.terminal.scrollToPreviousCommand',\n\tSCROLL_TO_NEXT_COMMAND = 'workbench.action.terminal.scrollToNextCommand',\n\tSELECT_TO_PREVIOUS_COMMAND = 'workbench.action.terminal.selectToPreviousCommand',\n\tSELECT_TO_NEXT_COMMAND = 'workbench.action.terminal.selectToNextCommand',\n\tSELECT_TO_PREVIOUS_LINE = 'workbench.action.terminal.selectToPreviousLine',\n\tSELECT_TO_NEXT_LINE = 'workbench.action.terminal.selectToNextLine',\n\tTOGGLE_ESCAPE_SEQUENCE_LOGGING = 'toggleEscapeSequenceLogging',\n\tSEND_SEQUENCE = 'workbench.action.terminal.sendSequence',\n\tTOGGLE_FIND_REGEX = 'workbench.action.terminal.toggleFindRegex',\n\tTOGGLE_FIND_WHOLE_WORD = 'workbench.action.terminal.toggleFindWholeWord',\n\tTOGGLE_FIND_CASE_SENSITIVE = 'workbench.action.terminal.toggleFindCaseSensitive',\n\tNAVIGATION_MODE_EXIT = 'workbench.action.terminal.navigationModeExit',\n\tNAVIGATION_MODE_FOCUS_NEXT = 'workbench.action.terminal.navigationModeFocusNext',\n\tNAVIGATION_MODE_FOCUS_PREVIOUS = 'workbench.action.terminal.navigationModeFocusPrevious',\n\tSHOW_ENVIRONMENT_INFORMATION = 'workbench.action.terminal.showEnvironmentInformation',\n\tSEARCH_WORKSPACE = 'workbench.action.terminal.searchWorkspace',\n\tATTACH_TO_REMOTE_TERMINAL = 'workbench.action.terminal.attachToSession'\n}\n\nexport const DEFAULT_COMMANDS_TO_SKIP_SHELL: string[] = [\n\tTERMINAL_COMMAND_ID.CLEAR_SELECTION,\n\tTERMINAL_COMMAND_ID.CLEAR,\n\tTERMINAL_COMMAND_ID.COPY_SELECTION,\n\tTERMINAL_COMMAND_ID.DELETE_TO_LINE_START,\n\tTERMINAL_COMMAND_ID.DELETE_WORD_LEFT,\n\tTERMINAL_COMMAND_ID.DELETE_WORD_RIGHT,\n\tTERMINAL_COMMAND_ID.FIND_FOCUS,\n\tTERMINAL_COMMAND_ID.FIND_HIDE,\n\tTERMINAL_COMMAND_ID.FIND_NEXT,\n\tTERMINAL_COMMAND_ID.FIND_PREVIOUS,\n\tTERMINAL_COMMAND_ID.TOGGLE_FIND_REGEX,\n\tTERMINAL_COMMAND_ID.TOGGLE_FIND_WHOLE_WORD,\n\tTERMINAL_COMMAND_ID.TOGGLE_FIND_CASE_SENSITIVE,\n\tTERMINAL_COMMAND_ID.FOCUS_NEXT_PANE,\n\tTERMINAL_COMMAND_ID.FOCUS_NEXT,\n\tTERMINAL_COMMAND_ID.FOCUS_PREVIOUS_PANE,\n\tTERMINAL_COMMAND_ID.FOCUS_PREVIOUS,\n\tTERMINAL_COMMAND_ID.FOCUS,\n\tTERMINAL_COMMAND_ID.KILL,\n\tTERMINAL_COMMAND_ID.MOVE_TO_LINE_END,\n\tTERMINAL_COMMAND_ID.MOVE_TO_LINE_START,\n\tTERMINAL_COMMAND_ID.NEW_IN_ACTIVE_WORKSPACE,\n\tTERMINAL_COMMAND_ID.NEW,\n\tTERMINAL_COMMAND_ID.PASTE,\n\tTERMINAL_COMMAND_ID.RESIZE_PANE_DOWN,\n\tTERMINAL_COMMAND_ID.RESIZE_PANE_LEFT,\n\tTERMINAL_COMMAND_ID.RESIZE_PANE_RIGHT,\n\tTERMINAL_COMMAND_ID.RESIZE_PANE_UP,\n\tTERMINAL_COMMAND_ID.RUN_ACTIVE_FILE,\n\tTERMINAL_COMMAND_ID.RUN_SELECTED_TEXT,\n\tTERMINAL_COMMAND_ID.SCROLL_DOWN_LINE,\n\tTERMINAL_COMMAND_ID.SCROLL_DOWN_PAGE,\n\tTERMINAL_COMMAND_ID.SCROLL_TO_BOTTOM,\n\tTERMINAL_COMMAND_ID.SCROLL_TO_NEXT_COMMAND,\n\tTERMINAL_COMMAND_ID.SCROLL_TO_PREVIOUS_COMMAND,\n\tTERMINAL_COMMAND_ID.SCROLL_TO_TOP,\n\tTERMINAL_COMMAND_ID.SCROLL_UP_LINE,\n\tTERMINAL_COMMAND_ID.SCROLL_UP_PAGE,\n\tTERMINAL_COMMAND_ID.SEND_SEQUENCE,\n\tTERMINAL_COMMAND_ID.SELECT_ALL,\n\tTERMINAL_COMMAND_ID.SELECT_TO_NEXT_COMMAND,\n\tTERMINAL_COMMAND_ID.SELECT_TO_NEXT_LINE,\n\tTERMINAL_COMMAND_ID.SELECT_TO_PREVIOUS_COMMAND,\n\tTERMINAL_COMMAND_ID.SELECT_TO_PREVIOUS_LINE,\n\tTERMINAL_COMMAND_ID.SPLIT_IN_ACTIVE_WORKSPACE,\n\tTERMINAL_COMMAND_ID.SPLIT,\n\tTERMINAL_COMMAND_ID.TOGGLE,\n\tTERMINAL_COMMAND_ID.NAVIGATION_MODE_EXIT,\n\tTERMINAL_COMMAND_ID.NAVIGATION_MODE_FOCUS_NEXT,\n\tTERMINAL_COMMAND_ID.NAVIGATION_MODE_FOCUS_PREVIOUS,\n\t'editor.action.toggleTabFocusMode',\n\t'workbench.action.quickOpen',\n\t'workbench.action.quickOpenPreviousEditor',\n\t'workbench.action.showCommands',\n\t'workbench.action.tasks.build',\n\t'workbench.action.tasks.restartTask',\n\t'workbench.action.tasks.runTask',\n\t'workbench.action.tasks.reRunTask',\n\t'workbench.action.tasks.showLog',\n\t'workbench.action.tasks.showTasks',\n\t'workbench.action.tasks.terminate',\n\t'workbench.action.tasks.test',\n\t'workbench.action.toggleFullScreen',\n\t'workbench.action.terminal.focusAtIndex1',\n\t'workbench.action.terminal.focusAtIndex2',\n\t'workbench.action.terminal.focusAtIndex3',\n\t'workbench.action.terminal.focusAtIndex4',\n\t'workbench.action.terminal.focusAtIndex5',\n\t'workbench.action.terminal.focusAtIndex6',\n\t'workbench.action.terminal.focusAtIndex7',\n\t'workbench.action.terminal.focusAtIndex8',\n\t'workbench.action.terminal.focusAtIndex9',\n\t'workbench.action.focusSecondEditorGroup',\n\t'workbench.action.focusThirdEditorGroup',\n\t'workbench.action.focusFourthEditorGroup',\n\t'workbench.action.focusFifthEditorGroup',\n\t'workbench.action.focusSixthEditorGroup',\n\t'workbench.action.focusSeventhEditorGroup',\n\t'workbench.action.focusEighthEditorGroup',\n\t'workbench.action.focusNextPart',\n\t'workbench.action.focusPreviousPart',\n\t'workbench.action.nextPanelView',\n\t'workbench.action.previousPanelView',\n\t'workbench.action.nextSideBarView',\n\t'workbench.action.previousSideBarView',\n\t'workbench.action.debug.start',\n\t'workbench.action.debug.stop',\n\t'workbench.action.debug.run',\n\t'workbench.action.debug.restart',\n\t'workbench.action.debug.continue',\n\t'workbench.action.debug.pause',\n\t'workbench.action.debug.stepInto',\n\t'workbench.action.debug.stepOut',\n\t'workbench.action.debug.stepOver',\n\t'workbench.action.nextEditor',\n\t'workbench.action.previousEditor',\n\t'workbench.action.nextEditorInGroup',\n\t'workbench.action.previousEditorInGroup',\n\t'workbench.action.openNextRecentlyUsedEditor',\n\t'workbench.action.openPreviousRecentlyUsedEditor',\n\t'workbench.action.openNextRecentlyUsedEditorInGroup',\n\t'workbench.action.openPreviousRecentlyUsedEditorInGroup',\n\t'workbench.action.quickOpenPreviousRecentlyUsedEditor',\n\t'workbench.action.quickOpenLeastRecentlyUsedEditor',\n\t'workbench.action.quickOpenPreviousRecentlyUsedEditorInGroup',\n\t'workbench.action.quickOpenLeastRecentlyUsedEditorInGroup',\n\t'workbench.action.focusActiveEditorGroup',\n\t'workbench.action.focusFirstEditorGroup',\n\t'workbench.action.focusLastEditorGroup',\n\t'workbench.action.firstEditorInGroup',\n\t'workbench.action.lastEditorInGroup',\n\t'workbench.action.navigateUp',\n\t'workbench.action.navigateDown',\n\t'workbench.action.navigateRight',\n\t'workbench.action.navigateLeft',\n\t'workbench.action.togglePanel',\n\t'workbench.action.quickOpenView',\n\t'workbench.action.toggleMaximizedPanel'\n];\n\nexport interface ITerminalContributions {\n\ttypes?: ITerminalTypeContribution[];\n}\n\nexport interface ITerminalTypeContribution {\n\ttitle: string;\n\tcommand: string;\n}\n\nexport const terminalContributionsDescriptor: IExtensionPointDescriptor = {\n\textensionPoint: 'terminal',\n\tdefaultExtensionKind: 'workspace',\n\tjsonSchema: {\n\t\tdescription: nls.localize('vscode.extension.contributes.terminal', 'Contributes terminal functionality.'),\n\t\ttype: 'object',\n\t\tproperties: {\n\t\t\ttypes: {\n\t\t\t\ttype: 'array',\n\t\t\t\tdescription: nls.localize('vscode.extension.contributes.terminal.types', \"Defines additional terminal types that the user can create.\"),\n\t\t\t\titems: {\n\t\t\t\t\ttype: 'object',\n\t\t\t\t\trequired: ['command', 'title'],\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tcommand: {\n\t\t\t\t\t\t\tdescription: nls.localize('vscode.extension.contributes.terminal.types.command', \"Command to execute when the user creates this type of terminal.\"),\n\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttitle: {\n\t\t\t\t\t\t\tdescription: nls.localize('vscode.extension.contributes.terminal.types.title', \"Title for this type of terminal.\"),\n\t\t\t\t\t\t\ttype: 'string',\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t},\n};\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Event } from 'vs/base/common/event';\nimport { IDisposable } from 'vs/base/common/lifecycle';\nimport { IProcessDataEvent } from 'vs/workbench/contrib/terminal/common/terminal';\n\ninterface TerminalDataBuffer extends IDisposable {\n\tdata: string[];\n\ttimeoutId: any;\n}\n\nexport class TerminalDataBufferer implements IDisposable {\n\tprivate readonly _terminalBufferMap = new Map<number, TerminalDataBuffer>();\n\n\tconstructor(private readonly _callback: (id: number, data: string) => void) {\n\t}\n\n\tdispose() {\n\t\tfor (const buffer of this._terminalBufferMap.values()) {\n\t\t\tbuffer.dispose();\n\t\t}\n\t}\n\n\tstartBuffering(id: number, event: Event<string | IProcessDataEvent>, throttleBy: number = 5): IDisposable {\n\t\tlet disposable: IDisposable;\n\t\tdisposable = event((e: string | IProcessDataEvent) => {\n\t\t\tconst data = (typeof e === 'string' ? e : e.data);\n\t\t\tlet buffer = this._terminalBufferMap.get(id);\n\t\t\tif (buffer) {\n\t\t\t\tbuffer.data.push(data);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst timeoutId = setTimeout(() => this._flushBuffer(id), throttleBy);\n\t\t\tbuffer = {\n\t\t\t\tdata: [data],\n\t\t\t\ttimeoutId: timeoutId,\n\t\t\t\tdispose: () => {\n\t\t\t\t\tclearTimeout(timeoutId);\n\t\t\t\t\tthis._flushBuffer(id);\n\t\t\t\t\tdisposable.dispose();\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis._terminalBufferMap.set(id, buffer);\n\t\t});\n\t\treturn disposable;\n\t}\n\n\tstopBuffering(id: number) {\n\t\tconst buffer = this._terminalBufferMap.get(id);\n\t\tif (buffer) {\n\t\t\tbuffer.dispose();\n\t\t}\n\t}\n\n\tprivate _flushBuffer(id: number): void {\n\t\tconst buffer = this._terminalBufferMap.get(id);\n\t\tif (buffer) {\n\t\t\tthis._terminalBufferMap.delete(id);\n\t\t\tthis._callback(id, buffer.data.join(''));\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as path from 'vs/base/common/path';\nimport * as platform from 'vs/base/common/platform';\nimport { URI as Uri } from 'vs/base/common/uri';\nimport { IWorkspaceFolder } from 'vs/platform/workspace/common/workspace';\nimport { IShellLaunchConfig, ITerminalEnvironment } from 'vs/workbench/contrib/terminal/common/terminal';\nimport { IConfigurationResolverService } from 'vs/workbench/services/configurationResolver/common/configurationResolver';\nimport { sanitizeProcessEnvironment } from 'vs/base/common/processes';\nimport { ILogService } from 'vs/platform/log/common/log';\n\n/**\n * This module contains utility functions related to the environment, cwd and paths.\n */\n\nexport function mergeEnvironments(parent: platform.IProcessEnvironment, other: ITerminalEnvironment | undefined): void {\n\tif (!other) {\n\t\treturn;\n\t}\n\n\t// On Windows apply the new values ignoring case, while still retaining\n\t// the case of the original key.\n\tif (platform.isWindows) {\n\t\tfor (const configKey in other) {\n\t\t\tlet actualKey = configKey;\n\t\t\tfor (const envKey in parent) {\n\t\t\t\tif (configKey.toLowerCase() === envKey.toLowerCase()) {\n\t\t\t\t\tactualKey = envKey;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst value = other[configKey];\n\t\t\t_mergeEnvironmentValue(parent, actualKey, value);\n\t\t}\n\t} else {\n\t\tObject.keys(other).forEach((key) => {\n\t\t\tconst value = other[key];\n\t\t\t_mergeEnvironmentValue(parent, key, value);\n\t\t});\n\t}\n}\n\nfunction _mergeEnvironmentValue(env: ITerminalEnvironment, key: string, value: string | null): void {\n\tif (typeof value === 'string') {\n\t\tenv[key] = value;\n\t} else {\n\t\tdelete env[key];\n\t}\n}\n\nexport function addTerminalEnvironmentKeys(env: platform.IProcessEnvironment, version: string | undefined, locale: string | undefined, detectLocale: 'auto' | 'off' | 'on'): void {\n\tenv['TERM_PROGRAM'] = 'vscode';\n\tif (version) {\n\t\tenv['TERM_PROGRAM_VERSION'] = version;\n\t}\n\tif (shouldSetLangEnvVariable(env, detectLocale)) {\n\t\tenv['LANG'] = getLangEnvVariable(locale);\n\t}\n\tenv['COLORTERM'] = 'truecolor';\n}\n\nfunction mergeNonNullKeys(env: platform.IProcessEnvironment, other: ITerminalEnvironment | undefined) {\n\tif (!other) {\n\t\treturn;\n\t}\n\tfor (const key of Object.keys(other)) {\n\t\tconst value = other[key];\n\t\tif (value) {\n\t\t\tenv[key] = value;\n\t\t}\n\t}\n}\n\nfunction resolveConfigurationVariables(variableResolver: VariableResolver, env: ITerminalEnvironment): ITerminalEnvironment {\n\tObject.keys(env).forEach((key) => {\n\t\tconst value = env[key];\n\t\tif (typeof value === 'string') {\n\t\t\ttry {\n\t\t\t\tenv[key] = variableResolver(value);\n\t\t\t} catch (e) {\n\t\t\t\tenv[key] = value;\n\t\t\t}\n\t\t}\n\t});\n\treturn env;\n}\n\nexport function shouldSetLangEnvVariable(env: platform.IProcessEnvironment, detectLocale: 'auto' | 'off' | 'on'): boolean {\n\tif (detectLocale === 'on') {\n\t\treturn true;\n\t}\n\tif (detectLocale === 'auto') {\n\t\tconst lang = env['LANG'];\n\t\treturn !lang || (lang.search(/\\.UTF\\-8$/) === -1 && lang.search(/\\.utf8$/) === -1 && lang.search(/\\.euc.+/) === -1);\n\t}\n\treturn false; // 'off'\n}\n\nexport function getLangEnvVariable(locale?: string): string {\n\tconst parts = locale ? locale.split('-') : [];\n\tconst n = parts.length;\n\tif (n === 0) {\n\t\t// Fallback to en_US if the locale is unknown\n\t\treturn 'en_US.UTF-8';\n\t}\n\tif (n === 1) {\n\t\t// The local may only contain the language, not the variant, if this is the case guess the\n\t\t// variant such that it can be used as a valid $LANG variable. The language variant chosen\n\t\t// is the original and/or most prominent with help from\n\t\t// https://stackoverflow.com/a/2502675/1156119\n\t\t// The list of locales was generated by running `locale -a` on macOS\n\t\tconst languageVariants: { [key: string]: string } = {\n\t\t\taf: 'ZA',\n\t\t\tam: 'ET',\n\t\t\tbe: 'BY',\n\t\t\tbg: 'BG',\n\t\t\tca: 'ES',\n\t\t\tcs: 'CZ',\n\t\t\tda: 'DK',\n\t\t\t// de: 'AT',\n\t\t\t// de: 'CH',\n\t\t\tde: 'DE',\n\t\t\tel: 'GR',\n\t\t\t// en: 'AU',\n\t\t\t// en: 'CA',\n\t\t\t// en: 'GB',\n\t\t\t// en: 'IE',\n\t\t\t// en: 'NZ',\n\t\t\ten: 'US',\n\t\t\tes: 'ES',\n\t\t\tet: 'EE',\n\t\t\teu: 'ES',\n\t\t\tfi: 'FI',\n\t\t\t// fr: 'BE',\n\t\t\t// fr: 'CA',\n\t\t\t// fr: 'CH',\n\t\t\tfr: 'FR',\n\t\t\the: 'IL',\n\t\t\thr: 'HR',\n\t\t\thu: 'HU',\n\t\t\thy: 'AM',\n\t\t\tis: 'IS',\n\t\t\t// it: 'CH',\n\t\t\tit: 'IT',\n\t\t\tja: 'JP',\n\t\t\tkk: 'KZ',\n\t\t\tko: 'KR',\n\t\t\tlt: 'LT',\n\t\t\t// nl: 'BE',\n\t\t\tnl: 'NL',\n\t\t\tno: 'NO',\n\t\t\tpl: 'PL',\n\t\t\tpt: 'BR',\n\t\t\t// pt: 'PT',\n\t\t\tro: 'RO',\n\t\t\tru: 'RU',\n\t\t\tsk: 'SK',\n\t\t\tsl: 'SI',\n\t\t\tsr: 'YU',\n\t\t\tsv: 'SE',\n\t\t\ttr: 'TR',\n\t\t\tuk: 'UA',\n\t\t\tzh: 'CN',\n\t\t};\n\t\tif (parts[0] in languageVariants) {\n\t\t\tparts.push(languageVariants[parts[0]]);\n\t\t}\n\t} else {\n\t\t// Ensure the variant is uppercase to be a valid $LANG\n\t\tparts[1] = parts[1].toUpperCase();\n\t}\n\treturn parts.join('_') + '.UTF-8';\n}\n\nexport function getCwd(\n\tshell: IShellLaunchConfig,\n\tuserHome: string | undefined,\n\tvariableResolver: VariableResolver | undefined,\n\troot: Uri | undefined,\n\tcustomCwd: string | undefined,\n\tlogService?: ILogService\n): string {\n\tif (shell.cwd) {\n\t\tconst unresolved = (typeof shell.cwd === 'object') ? shell.cwd.fsPath : shell.cwd;\n\t\tconst resolved = _resolveCwd(unresolved, variableResolver);\n\t\treturn _sanitizeCwd(resolved || unresolved);\n\t}\n\n\tlet cwd: string | undefined;\n\n\tif (!shell.ignoreConfigurationCwd && customCwd) {\n\t\tif (variableResolver) {\n\t\t\tcustomCwd = _resolveCwd(customCwd, variableResolver, logService);\n\t\t}\n\t\tif (customCwd) {\n\t\t\tif (path.isAbsolute(customCwd)) {\n\t\t\t\tcwd = customCwd;\n\t\t\t} else if (root) {\n\t\t\t\tcwd = path.join(root.fsPath, customCwd);\n\t\t\t}\n\t\t}\n\t}\n\n\t// If there was no custom cwd or it was relative with no workspace\n\tif (!cwd) {\n\t\tcwd = root ? root.fsPath : userHome || '';\n\t}\n\n\treturn _sanitizeCwd(cwd);\n}\n\nfunction _resolveCwd(cwd: string, variableResolver: VariableResolver | undefined, logService?: ILogService): string | undefined {\n\tif (variableResolver) {\n\t\ttry {\n\t\t\treturn variableResolver(cwd);\n\t\t} catch (e) {\n\t\t\tlogService?.error('Could not resolve terminal cwd', e);\n\t\t\treturn undefined;\n\t\t}\n\t}\n\treturn cwd;\n}\n\nfunction _sanitizeCwd(cwd: string): string {\n\t// Make the drive letter uppercase on Windows (see #9448)\n\tif (platform.platform === platform.Platform.Windows && cwd && cwd[1] === ':') {\n\t\treturn cwd[0].toUpperCase() + cwd.substr(1);\n\t}\n\treturn cwd;\n}\n\nexport function escapeNonWindowsPath(path: string): string {\n\tlet newPath = path;\n\tif (newPath.indexOf('\\\\') !== 0) {\n\t\tnewPath = newPath.replace(/\\\\/g, '\\\\\\\\');\n\t}\n\tif (newPath.indexOf(' ') !== -1) {\n\t\tnewPath = newPath.replace(/ /g, '\\\\ ');\n\t}\n\tconst bannedChars = /[\\`\\$\\|\\&\\>\\~\\#\\!\\^\\*\\;\\<\\\"\\']/g;\n\tnewPath = newPath.replace(bannedChars, '');\n\treturn `'${newPath}'`;\n}\n\nexport type TerminalShellSetting = (\n\t`terminal.integrated.automationShell.windows`\n\t| `terminal.integrated.automationShell.osx`\n\t| `terminal.integrated.automationShell.linux`\n\t| `terminal.integrated.shell.windows`\n\t| `terminal.integrated.shell.osx`\n\t| `terminal.integrated.shell.linux`\n);\n\nexport type TerminalShellArgsSetting = (\n\t`terminal.integrated.shellArgs.windows`\n\t| `terminal.integrated.shellArgs.osx`\n\t| `terminal.integrated.shellArgs.linux`\n);\n\nexport type VariableResolver = (str: string) => string;\n\nexport function createVariableResolver(lastActiveWorkspace: IWorkspaceFolder | undefined, configurationResolverService: IConfigurationResolverService | undefined): VariableResolver | undefined {\n\tif (!configurationResolverService) {\n\t\treturn undefined;\n\t}\n\treturn (str) => configurationResolverService.resolve(lastActiveWorkspace, str);\n}\n\nexport function getDefaultShell(\n\tfetchSetting: (key: TerminalShellSetting) => { userValue?: string | string[], value?: string | string[], defaultValue?: string | string[] },\n\tisWorkspaceShellAllowed: boolean,\n\tdefaultShell: string,\n\tisWoW64: boolean,\n\twindir: string | undefined,\n\tvariableResolver: VariableResolver | undefined,\n\tlogService: ILogService,\n\tuseAutomationShell: boolean,\n\tplatformOverride: platform.Platform = platform.platform\n): string {\n\tlet maybeExecutable: string | null = null;\n\tif (useAutomationShell) {\n\t\t// If automationShell is specified, this should override the normal setting\n\t\tmaybeExecutable = getShellSetting(fetchSetting, isWorkspaceShellAllowed, 'automationShell', platformOverride);\n\t}\n\tif (!maybeExecutable) {\n\t\tmaybeExecutable = getShellSetting(fetchSetting, isWorkspaceShellAllowed, 'shell', platformOverride);\n\t}\n\tlet executable: string = maybeExecutable || defaultShell;\n\n\t// Change Sysnative to System32 if the OS is Windows but NOT WoW64. It's\n\t// safe to assume that this was used by accident as Sysnative does not\n\t// exist and will break the terminal in non-WoW64 environments.\n\tif ((platformOverride === platform.Platform.Windows) && !isWoW64 && windir) {\n\t\tconst sysnativePath = path.join(windir, 'Sysnative').replace(/\\//g, '\\\\').toLowerCase();\n\t\tif (executable && executable.toLowerCase().indexOf(sysnativePath) === 0) {\n\t\t\texecutable = path.join(windir, 'System32', executable.substr(sysnativePath.length + 1));\n\t\t}\n\t}\n\n\t// Convert / to \\ on Windows for convenience\n\tif (executable && platformOverride === platform.Platform.Windows) {\n\t\texecutable = executable.replace(/\\//g, '\\\\');\n\t}\n\n\tif (variableResolver) {\n\t\ttry {\n\t\t\texecutable = variableResolver(executable);\n\t\t} catch (e) {\n\t\t\tlogService.error(`Could not resolve shell`, e);\n\t\t}\n\t}\n\n\treturn executable;\n}\n\nexport function getDefaultShellArgs(\n\tfetchSetting: (key: TerminalShellSetting | TerminalShellArgsSetting) => { userValue?: string | string[], value?: string | string[], defaultValue?: string | string[] },\n\tisWorkspaceShellAllowed: boolean,\n\tuseAutomationShell: boolean,\n\tvariableResolver: VariableResolver | undefined,\n\tlogService: ILogService,\n\tplatformOverride: platform.Platform = platform.platform,\n): string | string[] {\n\tif (useAutomationShell) {\n\t\tif (!!getShellSetting(fetchSetting, isWorkspaceShellAllowed, 'automationShell', platformOverride)) {\n\t\t\treturn [];\n\t\t}\n\t}\n\n\tconst platformKey = platformOverride === platform.Platform.Windows ? 'windows' : platformOverride === platform.Platform.Mac ? 'osx' : 'linux';\n\tconst shellArgsConfigValue = fetchSetting(<TerminalShellArgsSetting>`terminal.integrated.shellArgs.${platformKey}`);\n\tlet args = ((isWorkspaceShellAllowed ? shellArgsConfigValue.value : shellArgsConfigValue.userValue) || shellArgsConfigValue.defaultValue);\n\tif (!args) {\n\t\treturn [];\n\t}\n\tif (typeof args === 'string' && platformOverride === platform.Platform.Windows) {\n\t\treturn variableResolver ? variableResolver(args) : args;\n\t}\n\tif (variableResolver) {\n\t\tconst resolvedArgs: string[] = [];\n\t\tfor (const arg of args) {\n\t\t\ttry {\n\t\t\t\tresolvedArgs.push(variableResolver(arg));\n\t\t\t} catch (e) {\n\t\t\t\tlogService.error(`Could not resolve terminal.integrated.shellArgs.${platformKey}`, e);\n\t\t\t\tresolvedArgs.push(arg);\n\t\t\t}\n\t\t}\n\t\targs = resolvedArgs;\n\t}\n\treturn args;\n}\n\nfunction getShellSetting(\n\tfetchSetting: (key: TerminalShellSetting) => { userValue?: string | string[], value?: string | string[], defaultValue?: string | string[] },\n\tisWorkspaceShellAllowed: boolean,\n\ttype: 'automationShell' | 'shell',\n\tplatformOverride: platform.Platform = platform.platform,\n): string | null {\n\tconst platformKey = platformOverride === platform.Platform.Windows ? 'windows' : platformOverride === platform.Platform.Mac ? 'osx' : 'linux';\n\tconst shellConfigValue = fetchSetting(<TerminalShellSetting>`terminal.integrated.${type}.${platformKey}`);\n\tconst executable = (isWorkspaceShellAllowed ? <string>shellConfigValue.value : <string>shellConfigValue.userValue) || (<string | null>shellConfigValue.defaultValue);\n\treturn executable;\n}\n\nexport function createTerminalEnvironment(\n\tshellLaunchConfig: IShellLaunchConfig,\n\tenvFromConfig: { userValue?: ITerminalEnvironment, value?: ITerminalEnvironment, defaultValue?: ITerminalEnvironment },\n\tvariableResolver: VariableResolver | undefined,\n\tisWorkspaceShellAllowed: boolean,\n\tversion: string | undefined,\n\tdetectLocale: 'auto' | 'off' | 'on',\n\tbaseEnv: platform.IProcessEnvironment\n): platform.IProcessEnvironment {\n\t// Create a terminal environment based on settings, launch config and permissions\n\tlet env: platform.IProcessEnvironment = {};\n\tif (shellLaunchConfig.strictEnv) {\n\t\t// strictEnv is true, only use the requested env (ignoring null entries)\n\t\tmergeNonNullKeys(env, shellLaunchConfig.env);\n\t} else {\n\t\t// Merge process env with the env from config and from shellLaunchConfig\n\t\tmergeNonNullKeys(env, baseEnv);\n\n\t\t// const platformKey = platform.isWindows ? 'windows' : (platform.isMacintosh ? 'osx' : 'linux');\n\t\t// const envFromConfigValue = this._workspaceConfigurationService.inspect<ITerminalEnvironment | undefined>(`terminal.integrated.env.${platformKey}`);\n\t\tconst allowedEnvFromConfig = { ...(isWorkspaceShellAllowed ? envFromConfig.value : envFromConfig.userValue) };\n\n\t\t// Resolve env vars from config and shell\n\t\tif (variableResolver) {\n\t\t\tif (allowedEnvFromConfig) {\n\t\t\t\tresolveConfigurationVariables(variableResolver, allowedEnvFromConfig);\n\t\t\t}\n\t\t\tif (shellLaunchConfig.env) {\n\t\t\t\tresolveConfigurationVariables(variableResolver, shellLaunchConfig.env);\n\t\t\t}\n\t\t}\n\n\t\t// Sanitize the environment, removing any undesirable VS Code and Electron environment\n\t\t// variables\n\t\tsanitizeProcessEnvironment(env, 'VSCODE_IPC_HOOK_CLI');\n\n\t\t// Merge config (settings) and ShellLaunchConfig environments\n\t\tmergeEnvironments(env, allowedEnvFromConfig);\n\t\tmergeEnvironments(env, shellLaunchConfig.env);\n\n\t\t// Adding other env keys necessary to create the process\n\t\taddTerminalEnvironmentKeys(env, version, platform.locale, detectLocale);\n\t}\n\treturn env;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as os from 'os';\nimport * as platform from 'vs/base/common/platform';\nimport { readFile, fileExists, stat, lstat } from 'vs/base/node/pfs';\nimport { LinuxDistro, IShellDefinition } from 'vs/workbench/contrib/terminal/common/terminal';\nimport { coalesce } from 'vs/base/common/arrays';\nimport { normalize, basename } from 'vs/base/common/path';\nimport { enumeratePowerShellInstallations } from 'vs/base/node/powershell';\n\nlet detectedDistro = LinuxDistro.Unknown;\nif (platform.isLinux) {\n\tconst file = '/etc/os-release';\n\tfileExists(file).then(async exists => {\n\t\tif (!exists) {\n\t\t\treturn;\n\t\t}\n\t\tconst buffer = await readFile(file);\n\t\tconst contents = buffer.toString();\n\t\tif (/NAME=\"?Fedora\"?/.test(contents)) {\n\t\t\tdetectedDistro = LinuxDistro.Fedora;\n\t\t} else if (/NAME=\"?Ubuntu\"?/.test(contents)) {\n\t\t\tdetectedDistro = LinuxDistro.Ubuntu;\n\t\t}\n\t});\n}\n\nexport const linuxDistro = detectedDistro;\n\nexport function getWindowsBuildNumber(): number {\n\tconst osVersion = (/(\\d+)\\.(\\d+)\\.(\\d+)/g).exec(os.release());\n\tlet buildNumber: number = 0;\n\tif (osVersion && osVersion.length === 4) {\n\t\tbuildNumber = parseInt(osVersion[3]);\n\t}\n\treturn buildNumber;\n}\n\nexport function detectAvailableShells(): Promise<IShellDefinition[]> {\n\treturn platform.isWindows ? detectAvailableWindowsShells() : detectAvailableUnixShells();\n}\n\nasync function detectAvailableWindowsShells(): Promise<IShellDefinition[]> {\n\t// Determine the correct System32 path. We want to point to Sysnative\n\t// when the 32-bit version of VS Code is running on a 64-bit machine.\n\t// The reason for this is because PowerShell's important PSReadline\n\t// module doesn't work if this is not the case. See #27915.\n\tconst is32ProcessOn64Windows = process.env.hasOwnProperty('PROCESSOR_ARCHITEW6432');\n\tconst system32Path = `${process.env['windir']}\\\\${is32ProcessOn64Windows ? 'Sysnative' : 'System32'}`;\n\n\tlet useWSLexe = false;\n\n\tif (getWindowsBuildNumber() >= 16299) {\n\t\tuseWSLexe = true;\n\t}\n\n\tconst expectedLocations: { [key: string]: string[] } = {\n\t\t'Command Prompt': [`${system32Path}\\\\cmd.exe`],\n\t\t'WSL Bash': [`${system32Path}\\\\${useWSLexe ? 'wsl.exe' : 'bash.exe'}`],\n\t\t'Git Bash': [\n\t\t\t`${process.env['ProgramW6432']}\\\\Git\\\\bin\\\\bash.exe`,\n\t\t\t`${process.env['ProgramW6432']}\\\\Git\\\\usr\\\\bin\\\\bash.exe`,\n\t\t\t`${process.env['ProgramFiles']}\\\\Git\\\\bin\\\\bash.exe`,\n\t\t\t`${process.env['ProgramFiles']}\\\\Git\\\\usr\\\\bin\\\\bash.exe`,\n\t\t\t`${process.env['LocalAppData']}\\\\Programs\\\\Git\\\\bin\\\\bash.exe`,\n\t\t],\n\t\t// See #75945\n\t\t// Cygwin: [\n\t\t// \t`${process.env['HOMEDRIVE']}\\\\cygwin64\\\\bin\\\\bash.exe`,\n\t\t// \t`${process.env['HOMEDRIVE']}\\\\cygwin\\\\bin\\\\bash.exe`\n\t\t// ]\n\t};\n\n\t// Add all of the different kinds of PowerShells\n\tfor await (const pwshExe of enumeratePowerShellInstallations()) {\n\t\texpectedLocations[pwshExe.displayName] = [pwshExe.exePath];\n\t}\n\n\tconst promises: Promise<IShellDefinition | undefined>[] = [];\n\tObject.keys(expectedLocations).forEach(key => promises.push(validateShellPaths(key, expectedLocations[key])));\n\tconst shells = await Promise.all(promises);\n\treturn coalesce(shells);\n}\n\nasync function detectAvailableUnixShells(): Promise<IShellDefinition[]> {\n\tconst contents = await readFile('/etc/shells', 'utf8');\n\tconst shells = contents.split('\\n').filter(e => e.trim().indexOf('#') !== 0 && e.trim().length > 0);\n\treturn shells.map(e => {\n\t\treturn {\n\t\t\tlabel: basename(e),\n\t\t\tpath: e\n\t\t};\n\t});\n}\n\nasync function validateShellPaths(label: string, potentialPaths: string[]): Promise<IShellDefinition | undefined> {\n\tif (potentialPaths.length === 0) {\n\t\treturn Promise.resolve(undefined);\n\t}\n\tconst current = potentialPaths.shift()!;\n\tif (current! === '') {\n\t\treturn validateShellPaths(label, potentialPaths);\n\t}\n\ttry {\n\t\tconst result = await stat(normalize(current));\n\t\tif (result.isFile() || result.isSymbolicLink()) {\n\t\t\treturn {\n\t\t\t\tlabel,\n\t\t\t\tpath: current\n\t\t\t};\n\t\t}\n\t} catch (e) {\n\t\t// Also try using lstat as some symbolic links on Windows\n\t\t// throw 'permission denied' using 'stat' but don't throw\n\t\t// using 'lstat'\n\t\ttry {\n\t\t\tconst result = await lstat(normalize(current));\n\t\t\tif (result.isFile() || result.isSymbolicLink()) {\n\t\t\t\treturn {\n\t\t\t\t\tlabel,\n\t\t\t\t\tpath: current\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\tcatch (e) {\n\t\t\t// noop\n\t\t}\n\t}\n\treturn validateShellPaths(label, potentialPaths);\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IProcessEnvironment, isLinux, isMacintosh, isWindows } from 'vs/base/common/platform';\nimport { readFile, exists } from 'vs/base/node/pfs';\nimport * as path from 'vs/base/common/path';\nimport { isString } from 'vs/base/common/types';\nimport { getCaseInsensitive } from 'vs/base/common/objects';\n\nlet mainProcessParentEnv: IProcessEnvironment | undefined;\n\nexport async function getMainProcessParentEnv(baseEnvironment: IProcessEnvironment = process.env as IProcessEnvironment): Promise<IProcessEnvironment> {\n\tif (mainProcessParentEnv) {\n\t\treturn mainProcessParentEnv;\n\t}\n\n\t// For Linux use /proc/<pid>/status to get the parent of the main process and then fetch its\n\t// env using /proc/<pid>/environ.\n\tif (isLinux) {\n\t\tconst mainProcessId = process.ppid;\n\t\tconst codeProcessName = path.basename(process.argv[0]);\n\t\tlet pid: number = 0;\n\t\tlet ppid: number = mainProcessId;\n\t\tlet name: string = codeProcessName;\n\t\tdo {\n\t\t\tpid = ppid;\n\t\t\tconst status = await readFile(`/proc/${pid}/status`, 'utf8');\n\t\t\tconst splitByLine = status.split('\\n');\n\t\t\tsplitByLine.forEach(line => {\n\t\t\t\tif (line.indexOf('Name:') === 0) {\n\t\t\t\t\tname = line.replace(/^Name:\\s+/, '');\n\t\t\t\t}\n\t\t\t\tif (line.indexOf('PPid:') === 0) {\n\t\t\t\t\tppid = parseInt(line.replace(/^PPid:\\s+/, ''));\n\t\t\t\t}\n\t\t\t});\n\t\t} while (name === codeProcessName);\n\t\tconst rawEnv = await readFile(`/proc/${pid}/environ`, 'utf8');\n\t\tconst env: IProcessEnvironment = {};\n\t\trawEnv.split('\\0').forEach(e => {\n\t\t\tconst i = e.indexOf('=');\n\t\t\tenv[e.substr(0, i)] = e.substr(i + 1);\n\t\t});\n\t\tmainProcessParentEnv = env;\n\t}\n\n\t// For macOS we want the \"root\" environment as shells by default run as login shells. It\n\t// doesn't appear to be possible to get the \"root\" environment as `ps eww -o command` for\n\t// PID 1 (the parent of the main process when launched from the dock/finder) returns no\n\t// environment, because of this we will fill in the root environment using a allowlist of\n\t// environment variables that we have.\n\tif (isMacintosh) {\n\t\tmainProcessParentEnv = {};\n\t\t// This list was generated by diffing launching a terminal with {} and the system\n\t\t// terminal launched from finder.\n\t\tconst rootEnvVars = [\n\t\t\t'SHELL',\n\t\t\t'SSH_AUTH_SOCK',\n\t\t\t'Apple_PubSub_Socket_Render',\n\t\t\t'XPC_FLAGS',\n\t\t\t'XPC_SERVICE_NAME',\n\t\t\t'HOME',\n\t\t\t'LOGNAME',\n\t\t\t'TMPDIR'\n\t\t];\n\t\trootEnvVars.forEach(k => {\n\t\t\tif (baseEnvironment[k]) {\n\t\t\t\tmainProcessParentEnv![k] = baseEnvironment[k]!;\n\t\t\t}\n\t\t});\n\t}\n\n\t// TODO: Windows should return a fresh environment block, might need native code?\n\tif (isWindows) {\n\t\tmainProcessParentEnv = baseEnvironment;\n\t}\n\n\treturn mainProcessParentEnv!;\n}\n\nexport async function findExecutable(command: string, cwd?: string, paths?: string[], env: IProcessEnvironment = process.env as IProcessEnvironment): Promise<string | undefined> {\n\t// If we have an absolute path then we take it.\n\tif (path.isAbsolute(command)) {\n\t\treturn await exists(command) ? command : undefined;\n\t}\n\tif (cwd === undefined) {\n\t\tcwd = process.cwd();\n\t}\n\tconst dir = path.dirname(command);\n\tif (dir !== '.') {\n\t\t// We have a directory and the directory is relative (see above). Make the path absolute\n\t\t// to the current working directory.\n\t\tconst fullPath = path.join(cwd, command);\n\t\treturn await exists(fullPath) ? fullPath : undefined;\n\t}\n\tconst envPath = getCaseInsensitive(env, 'PATH');\n\tif (paths === undefined && isString(envPath)) {\n\t\tpaths = envPath.split(path.delimiter);\n\t}\n\t// No PATH environment. Make path absolute to the cwd.\n\tif (paths === undefined || paths.length === 0) {\n\t\tconst fullPath = path.join(cwd, command);\n\t\treturn await exists(fullPath) ? fullPath : undefined;\n\t}\n\t// We have a simple file name. We get the path variable from the env\n\t// and try to find the executable on the path.\n\tfor (let pathEntry of paths) {\n\t\t// The path entry is absolute.\n\t\tlet fullPath: string;\n\t\tif (path.isAbsolute(pathEntry)) {\n\t\t\tfullPath = path.join(pathEntry, command);\n\t\t} else {\n\t\t\tfullPath = path.join(cwd, pathEntry, command);\n\t\t}\n\n\t\tif (await exists(fullPath)) {\n\t\t\treturn fullPath;\n\t\t}\n\t\tif (isWindows) {\n\t\t\tlet withExtension = fullPath + '.com';\n\t\t\tif (await exists(withExtension)) {\n\t\t\t\treturn withExtension;\n\t\t\t}\n\t\t\twithExtension = fullPath + '.exe';\n\t\t\tif (await exists(withExtension)) {\n\t\t\t\treturn withExtension;\n\t\t\t}\n\t\t}\n\t}\n\tconst fullPath = path.join(cwd, command);\n\treturn await exists(fullPath) ? fullPath : undefined;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as path from 'vs/base/common/path';\nimport * as platform from 'vs/base/common/platform';\nimport type * as pty from 'node-pty';\nimport * as fs from 'fs';\nimport * as os from 'os';\nimport { Event, Emitter } from 'vs/base/common/event';\nimport { getWindowsBuildNumber } from 'vs/workbench/contrib/terminal/node/terminal';\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport { IShellLaunchConfig, ITerminalChildProcess, ITerminalDimensionsOverride, ITerminalLaunchError, FlowControlConstants } from 'vs/workbench/contrib/terminal/common/terminal';\nimport { exec } from 'child_process';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { stat } from 'vs/base/node/pfs';\nimport { findExecutable } from 'vs/workbench/contrib/terminal/node/terminalEnvironment';\nimport { URI } from 'vs/base/common/uri';\nimport { localize } from 'vs/nls';\n\n// Writing large amounts of data can be corrupted for some reason, after looking into this is\n// appears to be a race condition around writing to the FD which may be based on how powerful the\n// hardware is. The workaround for this is to space out when large amounts of data is being written\n// to the terminal. See https://github.com/microsoft/vscode/issues/38137\nconst WRITE_MAX_CHUNK_SIZE = 50;\nconst WRITE_INTERVAL_MS = 5;\n\nexport class TerminalProcess extends Disposable implements ITerminalChildProcess {\n\tprivate _exitCode: number | undefined;\n\tprivate _exitMessage: string | undefined;\n\tprivate _closeTimeout: any;\n\tprivate _ptyProcess: pty.IPty | undefined;\n\tprivate _currentTitle: string = '';\n\tprivate _processStartupComplete: Promise<void> | undefined;\n\tprivate _isDisposed: boolean = false;\n\tprivate _titleInterval: NodeJS.Timer | null = null;\n\tprivate _writeQueue: string[] = [];\n\tprivate _writeTimeout: NodeJS.Timeout | undefined;\n\tprivate _delayedResizer: DelayedResizer | undefined;\n\tprivate readonly _initialCwd: string;\n\tprivate readonly _ptyOptions: pty.IPtyForkOptions | pty.IWindowsPtyForkOptions;\n\n\tprivate _isPtyPaused: boolean = false;\n\tprivate _unacknowledgedCharCount: number = 0;\n\n\tpublic get exitMessage(): string | undefined { return this._exitMessage; }\n\n\tprivate readonly _onProcessData = this._register(new Emitter<string>());\n\tpublic get onProcessData(): Event<string> { return this._onProcessData.event; }\n\tprivate readonly _onProcessExit = this._register(new Emitter<number>());\n\tpublic get onProcessExit(): Event<number> { return this._onProcessExit.event; }\n\tprivate readonly _onProcessReady = this._register(new Emitter<{ pid: number, cwd: string }>());\n\tpublic get onProcessReady(): Event<{ pid: number, cwd: string }> { return this._onProcessReady.event; }\n\tprivate readonly _onProcessTitleChanged = this._register(new Emitter<string>());\n\tpublic get onProcessTitleChanged(): Event<string> { return this._onProcessTitleChanged.event; }\n\n\tconstructor(\n\t\tprivate readonly _shellLaunchConfig: IShellLaunchConfig,\n\t\tcwd: string,\n\t\tcols: number,\n\t\trows: number,\n\t\tenv: platform.IProcessEnvironment,\n\t\t/**\n\t\t * environment used for `findExecutable`\n\t\t */\n\t\tprivate readonly _executableEnv: platform.IProcessEnvironment,\n\t\twindowsEnableConpty: boolean,\n\t\t@ILogService private readonly _logService: ILogService\n\t) {\n\t\tsuper();\n\t\tlet name: string;\n\t\tif (platform.isWindows) {\n\t\t\tname = path.basename(this._shellLaunchConfig.executable || '');\n\t\t} else {\n\t\t\t// Using 'xterm-256color' here helps ensure that the majority of Linux distributions will use a\n\t\t\t// color prompt as defined in the default ~/.bashrc file.\n\t\t\tname = 'xterm-256color';\n\t\t}\n\t\tthis._initialCwd = cwd;\n\t\tconst useConpty = windowsEnableConpty && process.platform === 'win32' && getWindowsBuildNumber() >= 18309;\n\t\tthis._ptyOptions = {\n\t\t\tname,\n\t\t\tcwd,\n\t\t\tenv,\n\t\t\tcols,\n\t\t\trows,\n\t\t\tuseConpty,\n\t\t\t// This option will force conpty to not redraw the whole viewport on launch\n\t\t\tconptyInheritCursor: useConpty && !!_shellLaunchConfig.initialText\n\t\t};\n\t\t// Delay resizes to avoid conpty not respecting very early resize calls\n\t\tif (platform.isWindows && useConpty && cols === 0 && rows === 0 && this._shellLaunchConfig.executable?.endsWith('Git\\\\bin\\\\bash.exe')) {\n\t\t\tthis._delayedResizer = new DelayedResizer();\n\t\t\tthis._register(this._delayedResizer.onTrigger(dimensions => {\n\t\t\t\tthis._delayedResizer?.dispose();\n\t\t\t\tthis._delayedResizer = undefined;\n\t\t\t\tif (dimensions.cols && dimensions.rows) {\n\t\t\t\t\tthis.resize(dimensions.cols, dimensions.rows);\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t}\n\tonProcessOverrideDimensions?: Event<ITerminalDimensionsOverride | undefined> | undefined;\n\tonProcessResolvedShellLaunchConfig?: Event<IShellLaunchConfig> | undefined;\n\n\tpublic async start(): Promise<ITerminalLaunchError | undefined> {\n\t\tconst results = await Promise.all([this._validateCwd(), this._validateExecutable()]);\n\t\tconst firstError = results.find(r => r !== undefined);\n\t\tif (firstError) {\n\t\t\treturn firstError;\n\t\t}\n\n\t\ttry {\n\t\t\tawait this.setupPtyProcess(this._shellLaunchConfig, this._ptyOptions);\n\t\t\treturn undefined;\n\t\t} catch (err) {\n\t\t\tthis._logService.trace('IPty#spawn native exception', err);\n\t\t\treturn { message: `A native exception occurred during launch (${err.message})` };\n\t\t}\n\t}\n\n\tprivate async _validateCwd(): Promise<undefined | ITerminalLaunchError> {\n\t\ttry {\n\t\t\tconst result = await stat(this._initialCwd);\n\t\t\tif (!result.isDirectory()) {\n\t\t\t\treturn { message: localize('launchFail.cwdNotDirectory', \"Starting directory (cwd) \\\"{0}\\\" is not a directory\", this._initialCwd.toString()) };\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tif (err?.code === 'ENOENT') {\n\t\t\t\treturn { message: localize('launchFail.cwdDoesNotExist', \"Starting directory (cwd) \\\"{0}\\\" does not exist\", this._initialCwd.toString()) };\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate async _validateExecutable(): Promise<undefined | ITerminalLaunchError> {\n\t\tconst slc = this._shellLaunchConfig;\n\t\tif (!slc.executable) {\n\t\t\tthrow new Error('IShellLaunchConfig.executable not set');\n\t\t}\n\t\ttry {\n\t\t\tconst result = await stat(slc.executable);\n\t\t\tif (!result.isFile() && !result.isSymbolicLink()) {\n\t\t\t\treturn { message: localize('launchFail.executableIsNotFileOrSymlink', \"Path to shell executable \\\"{0}\\\" is not a file of a symlink\", slc.executable) };\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tif (err?.code === 'ENOENT') {\n\t\t\t\t// The executable isn't an absolute path, try find it on the PATH or CWD\n\t\t\t\tlet cwd = slc.cwd instanceof URI ? slc.cwd.path : slc.cwd!;\n\t\t\t\tconst envPaths: string[] | undefined = (slc.env && slc.env.PATH) ? slc.env.PATH.split(path.delimiter) : undefined;\n\t\t\t\tconst executable = await findExecutable(slc.executable!, cwd, envPaths, this._executableEnv);\n\t\t\t\tif (!executable) {\n\t\t\t\t\treturn { message: localize('launchFail.executableDoesNotExist', \"Path to shell executable \\\"{0}\\\" does not exist\", slc.executable) };\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate async setupPtyProcess(shellLaunchConfig: IShellLaunchConfig, options: pty.IPtyForkOptions): Promise<void> {\n\t\tconst args = shellLaunchConfig.args || [];\n\t\tthis._logService.trace('IPty#spawn', shellLaunchConfig.executable, args, options);\n\t\tconst ptyProcess = (await import('node-pty')).spawn(shellLaunchConfig.executable!, args, options);\n\t\tthis._ptyProcess = ptyProcess;\n\t\tthis._processStartupComplete = new Promise<void>(c => {\n\t\t\tthis.onProcessReady(() => c());\n\t\t});\n\t\tptyProcess.onData(data => {\n\t\t\tif (this._shellLaunchConfig.flowControl) {\n\t\t\t\tthis._unacknowledgedCharCount += data.length;\n\t\t\t\tif (!this._isPtyPaused && this._unacknowledgedCharCount > FlowControlConstants.HighWatermarkChars) {\n\t\t\t\t\tthis._logService.trace(`Flow control: Pause (${this._unacknowledgedCharCount} > ${FlowControlConstants.HighWatermarkChars})`);\n\t\t\t\t\tthis._isPtyPaused = true;\n\t\t\t\t\tptyProcess.pause();\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._onProcessData.fire(data);\n\t\t\tif (this._closeTimeout) {\n\t\t\t\tclearTimeout(this._closeTimeout);\n\t\t\t\tthis._queueProcessExit();\n\t\t\t}\n\t\t});\n\t\tptyProcess.onExit(e => {\n\t\t\tthis._exitCode = e.exitCode;\n\t\t\tthis._queueProcessExit();\n\t\t});\n\t\tthis._setupTitlePolling(ptyProcess);\n\t\tthis._sendProcessId(ptyProcess.pid);\n\t}\n\n\tpublic dispose(): void {\n\t\tthis._isDisposed = true;\n\t\tif (this._titleInterval) {\n\t\t\tclearInterval(this._titleInterval);\n\t\t}\n\t\tthis._titleInterval = null;\n\t\tthis._onProcessData.dispose();\n\t\tthis._onProcessExit.dispose();\n\t\tthis._onProcessReady.dispose();\n\t\tthis._onProcessTitleChanged.dispose();\n\t\tsuper.dispose();\n\t}\n\n\tprivate _setupTitlePolling(ptyProcess: pty.IPty) {\n\t\t// Send initial timeout async to give event listeners a chance to init\n\t\tsetTimeout(() => {\n\t\t\tthis._sendProcessTitle(ptyProcess);\n\t\t}, 0);\n\t\t// Setup polling for non-Windows, for Windows `process` doesn't change\n\t\tif (!platform.isWindows) {\n\t\t\tthis._titleInterval = setInterval(() => {\n\t\t\t\tif (this._currentTitle !== ptyProcess.process) {\n\t\t\t\t\tthis._sendProcessTitle(ptyProcess);\n\t\t\t\t}\n\t\t\t}, 200);\n\t\t}\n\t}\n\n\t// Allow any trailing data events to be sent before the exit event is sent.\n\t// See https://github.com/Tyriar/node-pty/issues/72\n\tprivate _queueProcessExit() {\n\t\tif (this._closeTimeout) {\n\t\t\tclearTimeout(this._closeTimeout);\n\t\t}\n\t\tthis._closeTimeout = setTimeout(() => this._kill(), 250);\n\t}\n\n\tprivate async _kill(): Promise<void> {\n\t\t// Wait to kill to process until the start up code has run. This prevents us from firing a process exit before a\n\t\t// process start.\n\t\tawait this._processStartupComplete;\n\t\tif (this._isDisposed) {\n\t\t\treturn;\n\t\t}\n\t\t// Attempt to kill the pty, it may have already been killed at this\n\t\t// point but we want to make sure\n\t\ttry {\n\t\t\tif (this._ptyProcess) {\n\t\t\t\tthis._logService.trace('IPty#kill');\n\t\t\t\tthis._ptyProcess.kill();\n\t\t\t}\n\t\t} catch (ex) {\n\t\t\t// Swallow, the pty has already been killed\n\t\t}\n\t\tthis._onProcessExit.fire(this._exitCode || 0);\n\t\tthis.dispose();\n\t}\n\n\tprivate _sendProcessId(pid: number) {\n\t\tthis._onProcessReady.fire({ pid, cwd: this._initialCwd });\n\t}\n\n\tprivate _sendProcessTitle(ptyProcess: pty.IPty): void {\n\t\tif (this._isDisposed) {\n\t\t\treturn;\n\t\t}\n\t\tthis._currentTitle = ptyProcess.process;\n\t\tthis._onProcessTitleChanged.fire(this._currentTitle);\n\t}\n\n\tpublic async shutdown(immediate: boolean): Promise<void> {\n\t\tif (immediate) {\n\t\t\tawait this._kill();\n\t\t} else {\n\t\t\tthis._queueProcessExit();\n\t\t}\n\t}\n\n\tpublic input(data: string): void {\n\t\tif (this._isDisposed || !this._ptyProcess) {\n\t\t\treturn;\n\t\t}\n\t\tfor (let i = 0; i <= Math.floor(data.length / WRITE_MAX_CHUNK_SIZE); i++) {\n\t\t\tthis._writeQueue.push(data.substr(i * WRITE_MAX_CHUNK_SIZE, WRITE_MAX_CHUNK_SIZE));\n\t\t}\n\t\tthis._startWrite();\n\t}\n\n\tprivate _startWrite(): void {\n\t\t// Don't write if it's already queued of is there is nothing to write\n\t\tif (this._writeTimeout !== undefined || this._writeQueue.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._doWrite();\n\n\t\t// Don't queue more writes if the queue is empty\n\t\tif (this._writeQueue.length === 0) {\n\t\t\tthis._writeTimeout = undefined;\n\t\t\treturn;\n\t\t}\n\n\t\t// Queue the next write\n\t\tthis._writeTimeout = setTimeout(() => {\n\t\t\tthis._writeTimeout = undefined;\n\t\t\tthis._startWrite();\n\t\t}, WRITE_INTERVAL_MS);\n\t}\n\n\tprivate _doWrite(): void {\n\t\tconst data = this._writeQueue.shift()!;\n\t\tthis._logService.trace('IPty#write', `${data.length} characters`);\n\t\tthis._ptyProcess!.write(data);\n\t}\n\n\tpublic resize(cols: number, rows: number): void {\n\t\tif (this._isDisposed) {\n\t\t\treturn;\n\t\t}\n\t\tif (typeof cols !== 'number' || typeof rows !== 'number' || isNaN(cols) || isNaN(rows)) {\n\t\t\treturn;\n\t\t}\n\t\t// Ensure that cols and rows are always >= 1, this prevents a native\n\t\t// exception in winpty.\n\t\tif (this._ptyProcess) {\n\t\t\tcols = Math.max(cols, 1);\n\t\t\trows = Math.max(rows, 1);\n\n\t\t\t// Delay resize if needed\n\t\t\tif (this._delayedResizer) {\n\t\t\t\tthis._delayedResizer.cols = cols;\n\t\t\t\tthis._delayedResizer.rows = rows;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._logService.trace('IPty#resize', cols, rows);\n\t\t\ttry {\n\t\t\t\tthis._ptyProcess.resize(cols, rows);\n\t\t\t} catch (e) {\n\t\t\t\t// Swallow error if the pty has already exited\n\t\t\t\tthis._logService.trace('IPty#resize exception ' + e.message);\n\t\t\t\tif (this._exitCode !== undefined && e.message !== 'ioctl(2) failed, EBADF') {\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic acknowledgeDataEvent(charCount: number): void {\n\t\tif (!this._shellLaunchConfig.flowControl) {\n\t\t\treturn;\n\t\t}\n\t\t// Prevent lower than 0 to heal from errors\n\t\tthis._unacknowledgedCharCount = Math.max(this._unacknowledgedCharCount - charCount, 0);\n\t\tthis._logService.trace(`Flow control: Ack ${charCount} chars (unacknowledged: ${this._unacknowledgedCharCount})`);\n\t\tif (this._isPtyPaused && this._unacknowledgedCharCount < FlowControlConstants.LowWatermarkChars) {\n\t\t\tthis._logService.trace(`Flow control: Resume (${this._unacknowledgedCharCount} < ${FlowControlConstants.LowWatermarkChars})`);\n\t\t\tthis._ptyProcess?.resume();\n\t\t\tthis._isPtyPaused = false;\n\t\t}\n\t}\n\n\tpublic clearUnacknowledgedChars(): void {\n\t\tif (!this._shellLaunchConfig.flowControl) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._unacknowledgedCharCount = 0;\n\t\tthis._logService.trace(`Flow control: Cleared all unacknowledged chars, forcing resume`);\n\t\tif (this._isPtyPaused) {\n\t\t\tthis._ptyProcess?.resume();\n\t\t\tthis._isPtyPaused = false;\n\t\t}\n\t}\n\n\tpublic getInitialCwd(): Promise<string> {\n\t\treturn Promise.resolve(this._initialCwd);\n\t}\n\n\tpublic getCwd(): Promise<string> {\n\t\tif (platform.isMacintosh) {\n\t\t\t// Disable cwd lookup on macOS Big Sur due to spawn blocking thread (darwin v20 is macOS\n\t\t\t// Big Sur) https://github.com/Microsoft/vscode/issues/105446\n\t\t\tconst osRelease = os.release().split('.');\n\t\t\tif (osRelease.length > 0 && parseInt(osRelease[0]) < 20) {\n\t\t\t\treturn new Promise<string>(resolve => {\n\t\t\t\t\tif (!this._ptyProcess) {\n\t\t\t\t\t\tresolve(this._initialCwd);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tthis._logService.trace('IPty#pid');\n\t\t\t\t\texec('lsof -OPln -p ' + this._ptyProcess.pid + ' | grep cwd', (error, stdout, stderr) => {\n\t\t\t\t\t\tif (!error && stdout !== '') {\n\t\t\t\t\t\t\tresolve(stdout.substring(stdout.indexOf('/'), stdout.length - 1));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis._logService.error('lsof did not run successfully, it may not be on the $PATH?', error, stdout, stderr);\n\t\t\t\t\t\t\tresolve(this._initialCwd);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (platform.isLinux) {\n\t\t\treturn new Promise<string>(resolve => {\n\t\t\t\tif (!this._ptyProcess) {\n\t\t\t\t\tresolve(this._initialCwd);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis._logService.trace('IPty#pid');\n\t\t\t\tfs.readlink('/proc/' + this._ptyProcess.pid + '/cwd', (err, linkedstr) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tresolve(this._initialCwd);\n\t\t\t\t\t}\n\t\t\t\t\tresolve(linkedstr);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\treturn new Promise<string>(resolve => {\n\t\t\tresolve(this._initialCwd);\n\t\t});\n\t}\n\n\tpublic getLatency(): Promise<number> {\n\t\treturn Promise.resolve(0);\n\t}\n}\n\n/**\n * Tracks the latest resize event to be trigger at a later point.\n */\nclass DelayedResizer extends Disposable {\n\tpublic rows: number | undefined;\n\tpublic cols: number | undefined;\n\tprivate _timeout: NodeJS.Timeout;\n\n\tprivate readonly _onTrigger = this._register(new Emitter<{ rows?: number, cols?: number }>());\n\tpublic get onTrigger(): Event<{ rows?: number, cols?: number }> { return this._onTrigger.event; }\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis._timeout = setTimeout(() => {\n\t\t\tthis._onTrigger.fire({ rows: this.rows, cols: this.cols });\n\t\t}, 1000);\n\t\tthis._register({\n\t\t\tdispose: () => {\n\t\t\t\tclearTimeout(this._timeout);\n\t\t\t}\n\t\t});\n\t}\n\n\tdispose(): void {\n\t\tsuper.dispose();\n\t\tclearTimeout(this._timeout);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IMarkdownString } from 'vs/base/common/htmlContent';\nimport { URI } from 'vs/base/common/uri';\nimport { Location as ModeLocation } from 'vs/editor/common/modes';\nimport { ExtHostTestingResource } from 'vs/workbench/api/common/extHost.protocol';\nimport { TestMessageSeverity, TestRunState } from 'vs/workbench/api/common/extHostTypes';\n\nexport interface TestIdWithProvider {\n\ttestId: string;\n\tproviderId: string;\n}\n\n/**\n * Request to them main thread to run a set of tests.\n */\nexport interface RunTestsRequest {\n\ttests: TestIdWithProvider[];\n\tdebug: boolean;\n}\n\n/**\n * Request from the main thread to run tests for a single provider.\n */\nexport interface RunTestForProviderRequest {\n\tproviderId: string;\n\tids: string[];\n\tdebug: boolean;\n}\n\n/**\n * Response to a  {@link RunTestsRequest}\n */\nexport interface RunTestsResult {\n\t// todo\n}\n\nexport const EMPTY_TEST_RESULT: RunTestsResult = {};\n\nexport const collectTestResults = (results: ReadonlyArray<RunTestsResult>) => {\n\treturn results[0] || {}; // todo\n};\n\nexport interface ITestMessage {\n\tmessage: string | IMarkdownString;\n\tseverity: TestMessageSeverity | undefined;\n\texpectedOutput: string | undefined;\n\tactualOutput: string | undefined;\n\tlocation: ModeLocation | undefined;\n}\n\nexport interface ITestState {\n\trunState: TestRunState;\n\tduration: number | undefined;\n\tmessages: ITestMessage[];\n}\n\n/**\n * The TestItem from .d.ts, as a plain object without children.\n */\nexport interface ITestItem {\n\t/** ID of the test given by the test provider */\n\textId: string;\n\tlabel: string;\n\tchildren?: never;\n\tlocation: ModeLocation | undefined;\n\tdescription: string | undefined;\n\trunnable: boolean;\n\tdebuggable: boolean;\n\tstate: ITestState;\n}\n\n/**\n * TestItem-like shape, butm with an ID and children as strings.\n */\nexport interface InternalTestItem {\n\tid: string;\n\tproviderId: string;\n\tparent: string | null;\n\titem: ITestItem;\n}\n\nexport interface InternalTestItemWithChildren extends InternalTestItem {\n\tchildren: InternalTestItemWithChildren[];\n}\n\nexport interface InternalTestResults {\n\ttests: InternalTestItemWithChildren[];\n}\n\nexport const enum TestDiffOpType {\n\t/** Adds a new test (with children) */\n\tAdd,\n\t/** Shallow-updates an existing test */\n\tUpdate,\n\t/** Removes a test (and all its children) */\n\tRemove,\n\t/** Changes the number of providers running initial test discovery. */\n\tDeltaDiscoverComplete,\n\t/** Changes the number of providers who are yet to publish their collection roots. */\n\tDeltaRootsComplete,\n}\n\nexport type TestsDiffOp =\n\t| [op: TestDiffOpType.Add, item: InternalTestItem]\n\t| [op: TestDiffOpType.Update, item: InternalTestItem]\n\t| [op: TestDiffOpType.Remove, itemId: string]\n\t| [op: TestDiffOpType.DeltaDiscoverComplete | TestDiffOpType.DeltaRootsComplete, amount: number];\n\n/**\n * Utility function to get a unique string for a subscription to a resource,\n * useful to keep maps of document or workspace folder subscription info.\n */\nexport const getTestSubscriptionKey = (resource: ExtHostTestingResource, uri: URI) => `${resource}:${uri.toString()}`;\n\n/**\n * Request from the ext host or main thread to indicate that tests have\n * changed. It's assumed that any item upserted *must* have its children\n * previously also upserted, or upserted as part of the same operation.\n * Children that no longer exist in an upserted item will be removed.\n */\nexport type TestsDiff = TestsDiffOp[];\n\n/**\n * @private\n */\nexport interface IncrementalTestCollectionItem extends InternalTestItem {\n\tchildren: Set<string>;\n}\n\n/**\n * The IncrementalChangeCollector is used in the IncrementalTestCollection\n * and called with diff changes as they're applied. This is used in the\n * ext host to create a cohesive change event from a diff.\n */\nexport class IncrementalChangeCollector<T> {\n\t/**\n\t * A node was added.\n\t */\n\tpublic add(node: T): void { }\n\n\t/**\n\t * A node in the collection was updated.\n\t */\n\tpublic update(node: T): void { }\n\n\t/**\n\t * A node was removed.\n\t */\n\tpublic remove(node: T, isNestedOperation: boolean): void { }\n\n\t/**\n\t * Called when the diff has been applied.\n\t */\n\tpublic complete(): void { }\n}\n\n/**\n * Maintains tests in this extension host sent from the main thread.\n */\nexport abstract class AbstractIncrementalTestCollection<T extends IncrementalTestCollectionItem>  {\n\t/**\n\t * Map of item IDs to test item objects.\n\t */\n\tprotected readonly items = new Map<string, T>();\n\n\t/**\n\t * ID of test root items.\n\t */\n\tprotected readonly roots = new Set<string>();\n\n\t/**\n\t * Applies the diff to the collection.\n\t */\n\tpublic apply(diff: TestsDiff) {\n\t\tconst changes = this.createChangeCollector();\n\n\t\tfor (const op of diff) {\n\t\t\tswitch (op[0]) {\n\t\t\t\tcase TestDiffOpType.Add: {\n\t\t\t\t\tconst item = op[1];\n\t\t\t\t\tif (!item.parent) {\n\t\t\t\t\t\tthis.roots.add(item.id);\n\t\t\t\t\t\tconst created = this.createItem(item);\n\t\t\t\t\t\tthis.items.set(item.id, created);\n\t\t\t\t\t\tchanges.add(created);\n\t\t\t\t\t} else if (this.items.has(item.parent)) {\n\t\t\t\t\t\tconst parent = this.items.get(item.parent)!;\n\t\t\t\t\t\tparent.children.add(item.id);\n\t\t\t\t\t\tconst created = this.createItem(item, parent);\n\t\t\t\t\t\tthis.items.set(item.id, created);\n\t\t\t\t\t\tchanges.add(created);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcase TestDiffOpType.Update: {\n\t\t\t\t\tconst item = op[1];\n\t\t\t\t\tconst existing = this.items.get(item.id);\n\t\t\t\t\tif (existing) {\n\t\t\t\t\t\tObject.assign(existing.item, item.item);\n\t\t\t\t\t\tchanges.update(existing);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcase TestDiffOpType.Remove: {\n\t\t\t\t\tconst toRemove = this.items.get(op[1]);\n\t\t\t\t\tif (!toRemove) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (toRemove.parent) {\n\t\t\t\t\t\tconst parent = this.items.get(toRemove.parent)!;\n\t\t\t\t\t\tparent.children.delete(toRemove.id);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.roots.delete(toRemove.id);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst queue: Iterable<string>[] = [[op[1]]];\n\t\t\t\t\twhile (queue.length) {\n\t\t\t\t\t\tfor (const itemId of queue.pop()!) {\n\t\t\t\t\t\t\tconst existing = this.items.get(itemId);\n\t\t\t\t\t\t\tif (existing) {\n\t\t\t\t\t\t\t\tqueue.push(existing.children);\n\t\t\t\t\t\t\t\tthis.items.delete(itemId);\n\t\t\t\t\t\t\t\tchanges.remove(existing, existing !== toRemove);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcase TestDiffOpType.DeltaDiscoverComplete:\n\t\t\t\t\tthis.updateBusyProviders(op[1]);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase TestDiffOpType.DeltaRootsComplete:\n\t\t\t\t\tthis.updatePendingRoots(op[1]);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tchanges.complete();\n\t}\n\n\t/**\n\t * Updates the number of providers who are still discovering items.\n\t */\n\tprotected updateBusyProviders(delta: number) {\n\t\t// no-op\n\t}\n\n\t/**\n\t * Updates the number of test root sources who are yet to report. When\n\t * the total pending test roots reaches 0, the roots for all providers\n\t * will exist in the collection.\n\t */\n\tprotected updatePendingRoots(delta: number) {\n\t\t// no-op\n\t}\n\n\t/**\n\t * Called before a diff is applied to create a new change collector.\n\t */\n\tprotected createChangeCollector() {\n\t\treturn new IncrementalChangeCollector<T>();\n\t}\n\n\t/**\n\t * Creates a new item for the collection from the internal test item.\n\t */\n\tprotected abstract createItem(internal: InternalTestItem, parent?: T): T;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as paths from 'vs/base/common/path';\nimport * as process from 'vs/base/common/process';\nimport * as types from 'vs/base/common/types';\nimport * as objects from 'vs/base/common/objects';\nimport { IStringDictionary } from 'vs/base/common/collections';\nimport { IProcessEnvironment, isWindows, isMacintosh, isLinux } from 'vs/base/common/platform';\nimport { normalizeDriveLetter } from 'vs/base/common/labels';\nimport { localize } from 'vs/nls';\nimport { URI as uri } from 'vs/base/common/uri';\nimport { IConfigurationResolverService } from 'vs/workbench/services/configurationResolver/common/configurationResolver';\nimport { IWorkspaceFolder } from 'vs/platform/workspace/common/workspace';\nimport { ILabelService } from 'vs/platform/label/common/label';\n\nexport interface IVariableResolveContext {\n\tgetFolderUri(folderName: string): uri | undefined;\n\tgetWorkspaceFolderCount(): number;\n\tgetConfigurationValue(folderUri: uri | undefined, section: string): string | undefined;\n\tgetExecPath(): string | undefined;\n\tgetFilePath(): string | undefined;\n\tgetWorkspaceFolderPathForFile?(): string | undefined;\n\tgetSelectedText(): string | undefined;\n\tgetLineNumber(): string | undefined;\n}\n\nexport class AbstractVariableResolverService implements IConfigurationResolverService {\n\n\tstatic readonly VARIABLE_LHS = '${';\n\tstatic readonly VARIABLE_REGEXP = /\\$\\{(.*?)\\}/g;\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate _context: IVariableResolveContext;\n\tprivate _labelService?: ILabelService;\n\tprivate _envVariables?: IProcessEnvironment;\n\tprotected _contributedVariables: Map<string, () => Promise<string | undefined>> = new Map();\n\n\n\tconstructor(_context: IVariableResolveContext, _labelService?: ILabelService, _envVariables?: IProcessEnvironment) {\n\t\tthis._context = _context;\n\t\tthis._labelService = _labelService;\n\t\tif (_envVariables) {\n\t\t\tif (isWindows) {\n\t\t\t\t// windows env variables are case insensitive\n\t\t\t\tconst ev: IProcessEnvironment = Object.create(null);\n\t\t\t\tthis._envVariables = ev;\n\t\t\t\tObject.keys(_envVariables).forEach(key => {\n\t\t\t\t\tev[key.toLowerCase()] = _envVariables[key];\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis._envVariables = _envVariables;\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic resolve(root: IWorkspaceFolder | undefined, value: string): string;\n\tpublic resolve(root: IWorkspaceFolder | undefined, value: string[]): string[];\n\tpublic resolve(root: IWorkspaceFolder | undefined, value: IStringDictionary<string>): IStringDictionary<string>;\n\tpublic resolve(root: IWorkspaceFolder | undefined, value: any): any {\n\t\treturn this.recursiveResolve(root ? root.uri : undefined, value);\n\t}\n\n\tpublic resolveAnyBase(workspaceFolder: IWorkspaceFolder | undefined, config: any, commandValueMapping?: IStringDictionary<string>, resolvedVariables?: Map<string, string>): any {\n\n\t\tconst result = objects.deepClone(config) as any;\n\n\t\t// hoist platform specific attributes to top level\n\t\tif (isWindows && result.windows) {\n\t\t\tObject.keys(result.windows).forEach(key => result[key] = result.windows[key]);\n\t\t} else if (isMacintosh && result.osx) {\n\t\t\tObject.keys(result.osx).forEach(key => result[key] = result.osx[key]);\n\t\t} else if (isLinux && result.linux) {\n\t\t\tObject.keys(result.linux).forEach(key => result[key] = result.linux[key]);\n\t\t}\n\n\t\t// delete all platform specific sections\n\t\tdelete result.windows;\n\t\tdelete result.osx;\n\t\tdelete result.linux;\n\n\t\t// substitute all variables recursively in string values\n\t\treturn this.recursiveResolve(workspaceFolder ? workspaceFolder.uri : undefined, result, commandValueMapping, resolvedVariables);\n\t}\n\n\tpublic resolveAny(workspaceFolder: IWorkspaceFolder | undefined, config: any, commandValueMapping?: IStringDictionary<string>): any {\n\t\treturn this.resolveAnyBase(workspaceFolder, config, commandValueMapping);\n\t}\n\n\tpublic resolveAnyMap(workspaceFolder: IWorkspaceFolder | undefined, config: any, commandValueMapping?: IStringDictionary<string>): { newConfig: any, resolvedVariables: Map<string, string> } {\n\t\tconst resolvedVariables = new Map<string, string>();\n\t\tconst newConfig = this.resolveAnyBase(workspaceFolder, config, commandValueMapping, resolvedVariables);\n\t\treturn { newConfig, resolvedVariables };\n\t}\n\n\tpublic resolveWithInteractionReplace(folder: IWorkspaceFolder | undefined, config: any, section?: string, variables?: IStringDictionary<string>): Promise<any> {\n\t\tthrow new Error('resolveWithInteractionReplace not implemented.');\n\t}\n\n\tpublic resolveWithInteraction(folder: IWorkspaceFolder | undefined, config: any, section?: string, variables?: IStringDictionary<string>): Promise<Map<string, string> | undefined> {\n\t\tthrow new Error('resolveWithInteraction not implemented.');\n\t}\n\n\tpublic contributeVariable(variable: string, resolution: () => Promise<string | undefined>): void {\n\t\tif (this._contributedVariables.has(variable)) {\n\t\t\tthrow new Error('Variable ' + variable + ' is contributed twice.');\n\t\t} else {\n\t\t\tthis._contributedVariables.set(variable, resolution);\n\t\t}\n\t}\n\n\tprivate recursiveResolve(folderUri: uri | undefined, value: any, commandValueMapping?: IStringDictionary<string>, resolvedVariables?: Map<string, string>): any {\n\t\tif (types.isString(value)) {\n\t\t\treturn this.resolveString(folderUri, value, commandValueMapping, resolvedVariables);\n\t\t} else if (types.isArray(value)) {\n\t\t\treturn value.map(s => this.recursiveResolve(folderUri, s, commandValueMapping, resolvedVariables));\n\t\t} else if (types.isObject(value)) {\n\t\t\tlet result: IStringDictionary<string | IStringDictionary<string> | string[]> = Object.create(null);\n\t\t\tObject.keys(value).forEach(key => {\n\t\t\t\tconst replaced = this.resolveString(folderUri, key, commandValueMapping, resolvedVariables);\n\t\t\t\tresult[replaced] = this.recursiveResolve(folderUri, value[key], commandValueMapping, resolvedVariables);\n\t\t\t});\n\t\t\treturn result;\n\t\t}\n\t\treturn value;\n\t}\n\n\tprivate resolveString(folderUri: uri | undefined, value: string, commandValueMapping: IStringDictionary<string> | undefined, resolvedVariables?: Map<string, string>): string {\n\n\t\t// loop through all variables occurrences in 'value'\n\t\tconst replaced = value.replace(AbstractVariableResolverService.VARIABLE_REGEXP, (match: string, variable: string) => {\n\t\t\t// disallow attempted nesting, see #77289\n\t\t\tif (variable.includes(AbstractVariableResolverService.VARIABLE_LHS)) {\n\t\t\t\treturn match;\n\t\t\t}\n\n\t\t\tlet resolvedValue = this.evaluateSingleVariable(match, variable, folderUri, commandValueMapping);\n\n\t\t\tif (resolvedVariables) {\n\t\t\t\tresolvedVariables.set(variable, resolvedValue);\n\t\t\t}\n\n\t\t\treturn resolvedValue;\n\t\t});\n\n\t\treturn replaced;\n\t}\n\n\tprivate fsPath(displayUri: uri): string {\n\t\treturn this._labelService ? this._labelService.getUriLabel(displayUri, { noPrefix: true }) : displayUri.fsPath;\n\t}\n\n\tprivate evaluateSingleVariable(match: string, variable: string, folderUri: uri | undefined, commandValueMapping: IStringDictionary<string> | undefined): string {\n\n\t\t// try to separate variable arguments from variable name\n\t\tlet argument: string | undefined;\n\t\tconst parts = variable.split(':');\n\t\tif (parts.length > 1) {\n\t\t\tvariable = parts[0];\n\t\t\targument = parts[1];\n\t\t}\n\n\t\t// common error handling for all variables that require an open editor\n\t\tconst getFilePath = (): string => {\n\n\t\t\tconst filePath = this._context.getFilePath();\n\t\t\tif (filePath) {\n\t\t\t\treturn filePath;\n\t\t\t}\n\t\t\tthrow new Error(localize('canNotResolveFile', \"Variable {0} can not be resolved. Please open an editor.\", match));\n\t\t};\n\n\t\t// common error handling for all variables that require an open editor\n\t\tconst getFolderPathForFile = (): string => {\n\n\t\t\tconst filePath = getFilePath();\t\t// throws error if no editor open\n\t\t\tif (this._context.getWorkspaceFolderPathForFile) {\n\t\t\t\tconst folderPath = this._context.getWorkspaceFolderPathForFile();\n\t\t\t\tif (folderPath) {\n\t\t\t\t\treturn folderPath;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthrow new Error(localize('canNotResolveFolderForFile', \"Variable {0}: can not find workspace folder of '{1}'.\", match, paths.basename(filePath)));\n\t\t};\n\n\t\t// common error handling for all variables that require an open folder and accept a folder name argument\n\t\tconst getFolderUri = (): uri => {\n\n\t\t\tif (argument) {\n\t\t\t\tconst folder = this._context.getFolderUri(argument);\n\t\t\t\tif (folder) {\n\t\t\t\t\treturn folder;\n\t\t\t\t}\n\t\t\t\tthrow new Error(localize('canNotFindFolder', \"Variable {0} can not be resolved. No such folder '{1}'.\", match, argument));\n\t\t\t}\n\n\t\t\tif (folderUri) {\n\t\t\t\treturn folderUri;\n\t\t\t}\n\n\t\t\tif (this._context.getWorkspaceFolderCount() > 1) {\n\t\t\t\tthrow new Error(localize('canNotResolveWorkspaceFolderMultiRoot', \"Variable {0} can not be resolved in a multi folder workspace. Scope this variable using ':' and a workspace folder name.\", match));\n\t\t\t}\n\t\t\tthrow new Error(localize('canNotResolveWorkspaceFolder', \"Variable {0} can not be resolved. Please open a folder.\", match));\n\t\t};\n\n\n\t\tswitch (variable) {\n\n\t\t\tcase 'env':\n\t\t\t\tif (argument) {\n\t\t\t\t\tif (this._envVariables) {\n\t\t\t\t\t\tconst env = this._envVariables[isWindows ? argument.toLowerCase() : argument];\n\t\t\t\t\t\tif (types.isString(env)) {\n\t\t\t\t\t\t\treturn env;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// For `env` we should do the same as a normal shell does - evaluates undefined envs to an empty string #46436\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\t\t\t\tthrow new Error(localize('missingEnvVarName', \"Variable {0} can not be resolved because no environment variable name is given.\", match));\n\n\t\t\tcase 'config':\n\t\t\t\tif (argument) {\n\t\t\t\t\tconst config = this._context.getConfigurationValue(folderUri, argument);\n\t\t\t\t\tif (types.isUndefinedOrNull(config)) {\n\t\t\t\t\t\tthrow new Error(localize('configNotFound', \"Variable {0} can not be resolved because setting '{1}' not found.\", match, argument));\n\t\t\t\t\t}\n\t\t\t\t\tif (types.isObject(config)) {\n\t\t\t\t\t\tthrow new Error(localize('configNoString', \"Variable {0} can not be resolved because '{1}' is a structured value.\", match, argument));\n\t\t\t\t\t}\n\t\t\t\t\treturn config;\n\t\t\t\t}\n\t\t\t\tthrow new Error(localize('missingConfigName', \"Variable {0} can not be resolved because no settings name is given.\", match));\n\n\t\t\tcase 'command':\n\t\t\t\treturn this.resolveFromMap(match, argument, commandValueMapping, 'command');\n\n\t\t\tcase 'input':\n\t\t\t\treturn this.resolveFromMap(match, argument, commandValueMapping, 'input');\n\n\t\t\tdefault: {\n\n\t\t\t\tswitch (variable) {\n\t\t\t\t\tcase 'workspaceRoot':\n\t\t\t\t\tcase 'workspaceFolder':\n\t\t\t\t\t\treturn normalizeDriveLetter(this.fsPath(getFolderUri()));\n\n\t\t\t\t\tcase 'cwd':\n\t\t\t\t\t\treturn ((folderUri || argument) ? normalizeDriveLetter(this.fsPath(getFolderUri())) : process.cwd());\n\n\t\t\t\t\tcase 'workspaceRootFolderName':\n\t\t\t\t\tcase 'workspaceFolderBasename':\n\t\t\t\t\t\treturn paths.basename(this.fsPath(getFolderUri()));\n\n\t\t\t\t\tcase 'lineNumber':\n\t\t\t\t\t\tconst lineNumber = this._context.getLineNumber();\n\t\t\t\t\t\tif (lineNumber) {\n\t\t\t\t\t\t\treturn lineNumber;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthrow new Error(localize('canNotResolveLineNumber', \"Variable {0} can not be resolved. Make sure to have a line selected in the active editor.\", match));\n\n\t\t\t\t\tcase 'selectedText':\n\t\t\t\t\t\tconst selectedText = this._context.getSelectedText();\n\t\t\t\t\t\tif (selectedText) {\n\t\t\t\t\t\t\treturn selectedText;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthrow new Error(localize('canNotResolveSelectedText', \"Variable {0} can not be resolved. Make sure to have some text selected in the active editor.\", match));\n\n\t\t\t\t\tcase 'file':\n\t\t\t\t\t\treturn getFilePath();\n\n\t\t\t\t\tcase 'fileWorkspaceFolder':\n\t\t\t\t\t\treturn getFolderPathForFile();\n\n\t\t\t\t\tcase 'relativeFile':\n\t\t\t\t\t\tif (folderUri || argument) {\n\t\t\t\t\t\t\treturn paths.relative(this.fsPath(getFolderUri()), getFilePath());\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn getFilePath();\n\n\t\t\t\t\tcase 'relativeFileDirname':\n\t\t\t\t\t\tconst dirname = paths.dirname(getFilePath());\n\t\t\t\t\t\tif (folderUri || argument) {\n\t\t\t\t\t\t\tconst relative = paths.relative(this.fsPath(getFolderUri()), dirname);\n\t\t\t\t\t\t\treturn relative.length === 0 ? '.' : relative;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn dirname;\n\n\t\t\t\t\tcase 'fileDirname':\n\t\t\t\t\t\treturn paths.dirname(getFilePath());\n\n\t\t\t\t\tcase 'fileExtname':\n\t\t\t\t\t\treturn paths.extname(getFilePath());\n\n\t\t\t\t\tcase 'fileBasename':\n\t\t\t\t\t\treturn paths.basename(getFilePath());\n\n\t\t\t\t\tcase 'fileBasenameNoExtension':\n\t\t\t\t\t\tconst basename = paths.basename(getFilePath());\n\t\t\t\t\t\treturn (basename.slice(0, basename.length - paths.extname(basename).length));\n\n\t\t\t\t\tcase 'fileDirnameBasename':\n\t\t\t\t\t\treturn paths.basename(paths.dirname(getFilePath()));\n\n\t\t\t\t\tcase 'execPath':\n\t\t\t\t\t\tconst ep = this._context.getExecPath();\n\t\t\t\t\t\tif (ep) {\n\t\t\t\t\t\t\treturn ep;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn match;\n\n\t\t\t\t\tcase 'pathSeparator':\n\t\t\t\t\t\treturn paths.sep;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\treturn this.resolveFromMap(match, variable, commandValueMapping, undefined);\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\treturn match;\n\t\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate resolveFromMap(match: string, argument: string | undefined, commandValueMapping: IStringDictionary<string> | undefined, prefix: string | undefined): string {\n\t\tif (argument && commandValueMapping) {\n\t\t\tconst v = (prefix === undefined) ? commandValueMapping[argument] : commandValueMapping[prefix + ':' + argument];\n\t\t\tif (typeof v === 'string') {\n\t\t\t\treturn v;\n\t\t\t}\n\t\t\tthrow new Error(localize('noValueForCommand', \"Variable {0} can not be resolved because the command has no value.\", match));\n\t\t}\n\t\treturn match;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Event } from 'vs/base/common/event';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { IEditorInput, IEditorPane, GroupIdentifier, IEditorInputWithOptions, CloseDirection, IEditorPartOptions, IEditorPartOptionsChangeEvent, EditorsOrder, IVisibleEditorPane, IEditorCloseEvent } from 'vs/workbench/common/editor';\nimport { IEditorOptions, ITextEditorOptions } from 'vs/platform/editor/common/editor';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { IDimension } from 'vs/editor/common/editorCommon';\nimport { IDisposable } from 'vs/base/common/lifecycle';\nimport { IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\n\nexport const IEditorGroupsService = createDecorator<IEditorGroupsService>('editorGroupsService');\n\nexport const enum GroupDirection {\n\tUP,\n\tDOWN,\n\tLEFT,\n\tRIGHT\n}\n\nexport const enum GroupOrientation {\n\tHORIZONTAL,\n\tVERTICAL\n}\n\nexport const enum GroupLocation {\n\tFIRST,\n\tLAST,\n\tNEXT,\n\tPREVIOUS\n}\n\nexport interface IFindGroupScope {\n\tdirection?: GroupDirection;\n\tlocation?: GroupLocation;\n}\n\nexport const enum GroupsArrangement {\n\n\t/**\n\t * Make the current active group consume the maximum\n\t * amount of space possible.\n\t */\n\tMINIMIZE_OTHERS,\n\n\t/**\n\t * Size all groups evenly.\n\t */\n\tEVEN,\n\n\t/**\n\t * Will behave like MINIMIZE_OTHERS if the active\n\t * group is not already maximized and EVEN otherwise\n\t */\n\tTOGGLE\n}\n\nexport interface GroupLayoutArgument {\n\tsize?: number;\n\tgroups?: GroupLayoutArgument[];\n}\n\nexport interface EditorGroupLayout {\n\torientation: GroupOrientation;\n\tgroups: GroupLayoutArgument[];\n}\n\nexport interface IMoveEditorOptions {\n\tindex?: number;\n\tinactive?: boolean;\n\tpreserveFocus?: boolean;\n}\n\nexport interface ICopyEditorOptions extends IMoveEditorOptions { }\n\nexport interface IAddGroupOptions {\n\tactivate?: boolean;\n}\n\nexport const enum MergeGroupMode {\n\tCOPY_EDITORS,\n\tMOVE_EDITORS\n}\n\nexport interface IMergeGroupOptions {\n\tmode?: MergeGroupMode;\n\tindex?: number;\n}\n\nexport interface ICloseEditorOptions {\n\tpreserveFocus?: boolean;\n}\n\nexport type ICloseEditorsFilter = {\n\texcept?: IEditorInput,\n\tdirection?: CloseDirection,\n\tsavedOnly?: boolean,\n\texcludeSticky?: boolean\n};\n\nexport interface ICloseAllEditorsOptions {\n\texcludeSticky?: boolean;\n}\n\nexport interface IEditorReplacement {\n\teditor: IEditorInput;\n\treplacement: IEditorInput;\n\toptions?: IEditorOptions | ITextEditorOptions;\n}\n\nexport const enum GroupsOrder {\n\n\t/**\n\t * Groups sorted by creation order (oldest one first)\n\t */\n\tCREATION_TIME,\n\n\t/**\n\t * Groups sorted by most recent activity (most recent active first)\n\t */\n\tMOST_RECENTLY_ACTIVE,\n\n\t/**\n\t * Groups sorted by grid widget order\n\t */\n\tGRID_APPEARANCE\n}\n\nexport interface IEditorGroupsService {\n\n\treadonly _serviceBrand: undefined;\n\n\t/**\n\t * An event for when the active editor group changes. The active editor\n\t * group is the default location for new editors to open.\n\t */\n\treadonly onDidActiveGroupChange: Event<IEditorGroup>;\n\n\t/**\n\t * An event for when a new group was added.\n\t */\n\treadonly onDidAddGroup: Event<IEditorGroup>;\n\n\t/**\n\t * An event for when a group was removed.\n\t */\n\treadonly onDidRemoveGroup: Event<IEditorGroup>;\n\n\t/**\n\t * An event for when a group was moved.\n\t */\n\treadonly onDidMoveGroup: Event<IEditorGroup>;\n\n\t/**\n\t * An event for when a group gets activated.\n\t */\n\treadonly onDidActivateGroup: Event<IEditorGroup>;\n\n\t/**\n\t * An event for when the group container is layed out.\n\t */\n\treadonly onDidLayout: Event<IDimension>;\n\n\t/**\n\t * An event for when the index of a group changes.\n\t */\n\treadonly onDidGroupIndexChange: Event<IEditorGroup>;\n\n\t/**\n\t * The size of the editor groups area.\n\t */\n\treadonly contentDimension: IDimension;\n\n\t/**\n\t * An active group is the default location for new editors to open.\n\t */\n\treadonly activeGroup: IEditorGroup;\n\n\t/**\n\t * All groups that are currently visible in the editor area in the\n\t * order of their creation (oldest first).\n\t */\n\treadonly groups: ReadonlyArray<IEditorGroup>;\n\n\t/**\n\t * The number of editor groups that are currently opened.\n\t */\n\treadonly count: number;\n\n\t/**\n\t * The current layout orientation of the root group.\n\t */\n\treadonly orientation: GroupOrientation;\n\n\t/**\n\t * A promise that resolves when groups have been restored.\n\t */\n\treadonly whenRestored: Promise<void>;\n\n\t/**\n\t * Find out if the editor group service has editors to restore from a previous session.\n\t */\n\treadonly willRestoreEditors: boolean;\n\n\t/**\n\t * Get all groups that are currently visible in the editor area.\n\t *\n\t * @param order the order of the editors to use\n\t */\n\tgetGroups(order: GroupsOrder): ReadonlyArray<IEditorGroup>;\n\n\t/**\n\t * Allows to convert a group identifier to a group.\n\t */\n\tgetGroup(identifier: GroupIdentifier): IEditorGroup | undefined;\n\n\t/**\n\t * Set a group as active. An active group is the default location for new editors to open.\n\t */\n\tactivateGroup(group: IEditorGroup | GroupIdentifier): IEditorGroup;\n\n\t/**\n\t * Returns the size of a group.\n\t */\n\tgetSize(group: IEditorGroup | GroupIdentifier): { width: number, height: number };\n\n\t/**\n\t * Sets the size of a group.\n\t */\n\tsetSize(group: IEditorGroup | GroupIdentifier, size: { width: number, height: number }): void;\n\n\t/**\n\t * Arrange all groups according to the provided arrangement.\n\t */\n\tarrangeGroups(arrangement: GroupsArrangement): void;\n\n\t/**\n\t * Applies the provided layout by either moving existing groups or creating new groups.\n\t */\n\tapplyLayout(layout: EditorGroupLayout): void;\n\n\t/**\n\t * Enable or disable centered editor layout.\n\t */\n\tcenterLayout(active: boolean): void;\n\n\t/**\n\t * Find out if the editor layout is currently centered.\n\t */\n\tisLayoutCentered(): boolean;\n\n\t/**\n\t * Sets the orientation of the root group to be either vertical or horizontal.\n\t */\n\tsetGroupOrientation(orientation: GroupOrientation): void;\n\n\t/**\n\t * Find a groupd in a specific scope:\n\t * * `GroupLocation.FIRST`: the first group\n\t * * `GroupLocation.LAST`: the last group\n\t * * `GroupLocation.NEXT`: the next group from either the active one or `source`\n\t * * `GroupLocation.PREVIOUS`: the previous group from either the active one or `source`\n\t * * `GroupDirection.UP`: the next group above the active one or `source`\n\t * * `GroupDirection.DOWN`: the next group below the active one or `source`\n\t * * `GroupDirection.LEFT`: the next group to the left of the active one or `source`\n\t * * `GroupDirection.RIGHT`: the next group to the right of the active one or `source`\n\t *\n\t * @param scope the scope of the group to search in\n\t * @param source optional source to search from\n\t * @param wrap optionally wrap around if reaching the edge of groups\n\t */\n\tfindGroup(scope: IFindGroupScope, source?: IEditorGroup | GroupIdentifier, wrap?: boolean): IEditorGroup;\n\n\t/**\n\t * Add a new group to the editor area. A new group is added by splitting a provided one in\n\t * one of the four directions.\n\t *\n\t * @param location the group from which to split to add a new group\n\t * @param direction the direction of where to split to\n\t * @param options configure the newly group with options\n\t */\n\taddGroup(location: IEditorGroup | GroupIdentifier, direction: GroupDirection, options?: IAddGroupOptions): IEditorGroup;\n\n\t/**\n\t * Remove a group from the editor area.\n\t */\n\tremoveGroup(group: IEditorGroup | GroupIdentifier): void;\n\n\t/**\n\t * Move a group to a new group in the editor area.\n\t *\n\t * @param group the group to move\n\t * @param location the group from which to split to add the moved group\n\t * @param direction the direction of where to split to\n\t */\n\tmoveGroup(group: IEditorGroup | GroupIdentifier, location: IEditorGroup | GroupIdentifier, direction: GroupDirection): IEditorGroup;\n\n\t/**\n\t * Merge the editors of a group into a target group. By default, all editors will\n\t * move and the source group will close. This behaviour can be configured via the\n\t * `IMergeGroupOptions` options.\n\t *\n\t * @param group the group to merge\n\t * @param target the target group to merge into\n\t * @param options controls how the merge should be performed. by default all editors\n\t * will be moved over to the target and the source group will close. Configure to\n\t * `MOVE_EDITORS_KEEP_GROUP` to prevent the source group from closing. Set to\n\t * `COPY_EDITORS` to copy the editors into the target instead of moding them.\n\t */\n\tmergeGroup(group: IEditorGroup | GroupIdentifier, target: IEditorGroup | GroupIdentifier, options?: IMergeGroupOptions): IEditorGroup;\n\n\t/**\n\t * Copy a group to a new group in the editor area.\n\t *\n\t * @param group the group to copy\n\t * @param location the group from which to split to add the copied group\n\t * @param direction the direction of where to split to\n\t */\n\tcopyGroup(group: IEditorGroup | GroupIdentifier, location: IEditorGroup | GroupIdentifier, direction: GroupDirection): IEditorGroup;\n\n\t/**\n\t * Access the options of the editor part.\n\t */\n\treadonly partOptions: IEditorPartOptions;\n\n\t/**\n\t * An event that notifies when editor part options change.\n\t */\n\treadonly onDidEditorPartOptionsChange: Event<IEditorPartOptionsChangeEvent>;\n\n\t/**\n\t * Enforce editor part options temporarily.\n\t */\n\tenforcePartOptions(options: IEditorPartOptions): IDisposable;\n}\n\nexport const enum GroupChangeKind {\n\n\t/* Group Changes */\n\tGROUP_ACTIVE,\n\tGROUP_INDEX,\n\n\t/* Editor Changes */\n\tEDITOR_OPEN,\n\tEDITOR_CLOSE,\n\tEDITOR_MOVE,\n\tEDITOR_ACTIVE,\n\tEDITOR_LABEL,\n\tEDITOR_PIN,\n\tEDITOR_STICKY,\n\tEDITOR_DIRTY\n}\n\nexport interface IGroupChangeEvent {\n\tkind: GroupChangeKind;\n\teditor?: IEditorInput;\n\teditorIndex?: number;\n}\n\nexport const enum OpenEditorContext {\n\tNEW_EDITOR = 1,\n\tMOVE_EDITOR = 2,\n\tCOPY_EDITOR = 3\n}\n\nexport interface IEditorGroup {\n\n\t/**\n\t * An aggregated event for when the group changes in any way.\n\t */\n\treadonly onDidGroupChange: Event<IGroupChangeEvent>;\n\n\t/**\n\t * An event that is fired when the group gets disposed.\n\t */\n\treadonly onWillDispose: Event<void>;\n\n\t/**\n\t * An event that is fired when an editor is about to close.\n\t */\n\treadonly onWillCloseEditor: Event<IEditorCloseEvent>;\n\n\t/**\n\t * A unique identifier of this group that remains identical even if the\n\t * group is moved to different locations.\n\t */\n\treadonly id: GroupIdentifier;\n\n\t/**\n\t * A number that indicates the position of this group in the visual\n\t * order of groups from left to right and top to bottom. The lowest\n\t * index will likely be top-left while the largest index in most\n\t * cases should be bottom-right, but that depends on the grid.\n\t */\n\treadonly index: number;\n\n\t/**\n\t * A human readable label for the group. This label can change depending\n\t * on the layout of all editor groups. Clients should listen on the\n\t * `onDidGroupChange` event to react to that.\n\t */\n\treadonly label: string;\n\n\t/**\n\t * A human readable label for the group to be used by screen readers.\n\t */\n\treadonly ariaLabel: string;\n\n\t/**\n\t * The active editor pane is the currently visible editor pane of the group.\n\t */\n\treadonly activeEditorPane: IVisibleEditorPane | undefined;\n\n\t/**\n\t * The active editor is the currently visible editor of the group\n\t * within the current active editor pane.\n\t */\n\treadonly activeEditor: IEditorInput | null;\n\n\t/**\n\t * The editor in the group that is in preview mode if any. There can\n\t * only ever be one editor in preview mode.\n\t */\n\treadonly previewEditor: IEditorInput | null;\n\n\t/**\n\t * The number of opened editors in this group.\n\t */\n\treadonly count: number;\n\n\t/**\n\t * The number of sticky editors in this group.\n\t */\n\treadonly stickyCount: number;\n\n\t/**\n\t * All opened editors in the group in sequential order of their appearance.\n\t */\n\treadonly editors: ReadonlyArray<IEditorInput>;\n\n\t/**\n\t * The scoped context key service for this group.\n\t */\n\treadonly scopedContextKeyService: IContextKeyService;\n\n\t/**\n\t * Get all editors that are currently opened in the group.\n\t *\n\t * @param order the order of the editors to use\n\t * @param options options to select only specific editors as instructed\n\t */\n\tgetEditors(order: EditorsOrder, options?: { excludeSticky?: boolean }): ReadonlyArray<IEditorInput>;\n\n\t/**\n\t * Returns the editor at a specific index of the group.\n\t */\n\tgetEditorByIndex(index: number): IEditorInput | undefined;\n\n\t/**\n\t * Returns the index of the editor in the group or -1 if not opened.\n\t */\n\tgetIndexOfEditor(editor: IEditorInput): number;\n\n\t/**\n\t * Open an editor in this group.\n\t *\n\t * @returns a promise that resolves around an IEditor instance unless\n\t * the call failed, or the editor was not opened as active editor.\n\t */\n\topenEditor(editor: IEditorInput, options?: IEditorOptions | ITextEditorOptions, context?: OpenEditorContext): Promise<IEditorPane | null>;\n\n\t/**\n\t * Opens editors in this group.\n\t *\n\t * @returns a promise that resolves around an IEditor instance unless\n\t * the call failed, or the editor was not opened as active editor. Since\n\t * a group can only ever have one active editor, even if many editors are\n\t * opened, the result will only be one editor.\n\t */\n\topenEditors(editors: IEditorInputWithOptions[]): Promise<IEditorPane | null>;\n\n\t/**\n\t * Find out if the provided editor is opened in the group.\n\t *\n\t * Note: An editor can be opened but not actively visible.\n\t */\n\tisOpened(editor: IEditorInput): boolean;\n\n\t/**\n\t * Find out if the provided editor is pinned in the group.\n\t */\n\tisPinned(editor: IEditorInput): boolean;\n\n\t/**\n\t * Find out if the provided editor or index of editor is sticky in the group.\n\t */\n\tisSticky(editorOrIndex: IEditorInput | number): boolean;\n\n\t/**\n\t * Find out if the provided editor is active in the group.\n\t */\n\tisActive(editor: IEditorInput): boolean;\n\n\t/**\n\t * Move an editor from this group either within this group or to another group.\n\t */\n\tmoveEditor(editor: IEditorInput, target: IEditorGroup, options?: IMoveEditorOptions): void;\n\n\t/**\n\t * Copy an editor from this group to another group.\n\t *\n\t * Note: It is currently not supported to show the same editor more than once in the same group.\n\t */\n\tcopyEditor(editor: IEditorInput, target: IEditorGroup, options?: ICopyEditorOptions): void;\n\n\t/**\n\t * Close an editor from the group. This may trigger a confirmation dialog if\n\t * the editor is dirty and thus returns a promise as value.\n\t *\n\t * @param editor the editor to close, or the currently active editor\n\t * if unspecified.\n\t *\n\t * @returns a promise when the editor is closed.\n\t */\n\tcloseEditor(editor?: IEditorInput, options?: ICloseEditorOptions): Promise<void>;\n\n\t/**\n\t * Closes specific editors in this group. This may trigger a confirmation dialog if\n\t * there are dirty editors and thus returns a promise as value.\n\t *\n\t * @returns a promise when all editors are closed.\n\t */\n\tcloseEditors(editors: IEditorInput[] | ICloseEditorsFilter, options?: ICloseEditorOptions): Promise<void>;\n\n\t/**\n\t * Closes all editors from the group. This may trigger a confirmation dialog if\n\t * there are dirty editors and thus returns a promise as value.\n\t *\n\t * @returns a promise when all editors are closed.\n\t */\n\tcloseAllEditors(options?: ICloseAllEditorsOptions): Promise<void>;\n\n\t/**\n\t * Replaces editors in this group with the provided replacement.\n\t *\n\t * @param editors the editors to replace\n\t *\n\t * @returns a promise that is resolved when the replaced active\n\t * editor (if any) has finished loading.\n\t */\n\treplaceEditors(editors: IEditorReplacement[]): Promise<void>;\n\n\t/**\n\t * Set an editor to be pinned. A pinned editor is not replaced\n\t * when another editor opens at the same location.\n\t *\n\t * @param editor the editor to pin, or the currently active editor\n\t * if unspecified.\n\t */\n\tpinEditor(editor?: IEditorInput): void;\n\n\t/**\n\t * Set an editor to be sticky. A sticky editor is showing in the beginning\n\t * of the tab stripe and will not be impacted by close operations.\n\t *\n\t * @param editor the editor to make sticky, or the currently active editor\n\t * if unspecified.\n\t */\n\tstickEditor(editor?: IEditorInput): void;\n\n\t/**\n\t * Set an editor to be non-sticky and thus moves back to a location after\n\t * sticky editors and can be closed normally.\n\t *\n\t * @param editor the editor to make unsticky, or the currently active editor\n\t * if unspecified.\n\t */\n\tunstickEditor(editor?: IEditorInput): void;\n\n\t/**\n\t * Move keyboard focus into the group.\n\t */\n\tfocus(): void;\n}\n\n\n//#region Editor Group Helpers\n\nexport function preferredSideBySideGroupDirection(configurationService: IConfigurationService): GroupDirection.DOWN | GroupDirection.RIGHT {\n\tconst openSideBySideDirection = configurationService.getValue<'right' | 'down'>('workbench.editor.openSideBySideDirection');\n\n\tif (openSideBySideDirection === 'down') {\n\t\treturn GroupDirection.DOWN;\n\t}\n\n\treturn GroupDirection.RIGHT;\n}\n\n//#endregion\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { IResourceEditorInput, IEditorOptions, ITextEditorOptions } from 'vs/platform/editor/common/editor';\nimport { IEditorInput, IEditorPane, GroupIdentifier, IEditorInputWithOptions, IUntitledTextResourceEditorInput, IResourceDiffEditorInput, ITextEditorPane, ITextDiffEditorPane, IEditorIdentifier, ISaveOptions, IRevertOptions, EditorsOrder, IVisibleEditorPane, IEditorCloseEvent } from 'vs/workbench/common/editor';\nimport { Event } from 'vs/base/common/event';\nimport { IEditor, IDiffEditor } from 'vs/editor/common/editorCommon';\nimport { IEditorGroup, IEditorReplacement, OpenEditorContext } from 'vs/workbench/services/editor/common/editorGroupsService';\nimport { IDisposable } from 'vs/base/common/lifecycle';\nimport { URI } from 'vs/base/common/uri';\n\nexport const IEditorService = createDecorator<IEditorService>('editorService');\n\nexport type IResourceEditorInputType = IResourceEditorInput | IUntitledTextResourceEditorInput | IResourceDiffEditorInput;\n\nexport interface IResourceEditorReplacement {\n\treadonly editor: IResourceEditorInputType;\n\treadonly replacement: IResourceEditorInputType;\n}\n\nexport const ACTIVE_GROUP = -1;\nexport type ACTIVE_GROUP_TYPE = typeof ACTIVE_GROUP;\n\nexport const SIDE_GROUP = -2;\nexport type SIDE_GROUP_TYPE = typeof SIDE_GROUP;\n\nexport interface IOpenEditorOverrideEntry {\n\tid: string;\n\tlabel: string;\n\tactive: boolean;\n\tdetail?: string;\n}\n\nexport interface IOpenEditorOverrideHandler {\n\topen(editor: IEditorInput, options: IEditorOptions | ITextEditorOptions | undefined, group: IEditorGroup, context: OpenEditorContext): IOpenEditorOverride | undefined;\n\tgetEditorOverrides?(resource: URI, options: IEditorOptions | undefined, group: IEditorGroup | undefined): IOpenEditorOverrideEntry[];\n}\n\nexport interface IOpenEditorOverride {\n\n\t/**\n\t * If defined, will prevent the opening of an editor and replace the resulting\n\t * promise with the provided promise for the openEditor() call.\n\t */\n\toverride?: Promise<IEditorPane | undefined>;\n}\n\nexport interface ISaveEditorsOptions extends ISaveOptions {\n\n\t/**\n\t * If true, will ask for a location of the editor to save to.\n\t */\n\treadonly saveAs?: boolean;\n}\n\nexport interface IBaseSaveRevertAllEditorOptions {\n\n\t/**\n\t * Whether to include untitled editors as well.\n\t */\n\treadonly includeUntitled?: boolean;\n\n\t/**\n\t * Whether to exclude sticky editors.\n\t */\n\treadonly excludeSticky?: boolean;\n}\n\nexport interface ISaveAllEditorsOptions extends ISaveEditorsOptions, IBaseSaveRevertAllEditorOptions { }\n\nexport interface IRevertAllEditorsOptions extends IRevertOptions, IBaseSaveRevertAllEditorOptions { }\n\nexport interface ICustomEditorInfo {\n\treadonly id: string;\n\treadonly displayName: string;\n\treadonly providerDisplayName: string;\n}\n\nexport interface ICustomEditorViewTypesHandler {\n\treadonly onDidChangeViewTypes: Event<void>;\n\n\tgetViewTypes(): ICustomEditorInfo[];\n}\n\nexport interface IEditorService {\n\n\treadonly _serviceBrand: undefined;\n\n\t/**\n\t * Emitted when the currently active editor changes.\n\t *\n\t * @see `IEditorService.activeEditorPane`\n\t */\n\treadonly onDidActiveEditorChange: Event<void>;\n\n\t/**\n\t * Emitted when any of the current visible editors changes.\n\t *\n\t * @see `IEditorService.visibleEditorPanes`\n\t */\n\treadonly onDidVisibleEditorsChange: Event<void>;\n\n\t/**\n\t * Emitted when an editor is closed.\n\t */\n\treadonly onDidCloseEditor: Event<IEditorCloseEvent>;\n\n\t/**\n\t * The currently active editor pane or `undefined` if none. The editor pane is\n\t * the workbench container for editors of any kind.\n\t *\n\t * @see `IEditorService.activeEditor` for access to the active editor input\n\t */\n\treadonly activeEditorPane: IVisibleEditorPane | undefined;\n\n\t/**\n\t * The currently active editor or `undefined` if none. An editor is active when it is\n\t * located in the currently active editor group. It will be `undefined` if the active\n\t * editor group has no editors open.\n\t */\n\treadonly activeEditor: IEditorInput | undefined;\n\n\t/**\n\t * The currently active text editor control or `undefined` if there is currently no active\n\t * editor or the active editor widget is neither a text nor a diff editor.\n\t *\n\t * @see `IEditorService.activeEditor`\n\t */\n\treadonly activeTextEditorControl: IEditor | IDiffEditor | undefined;\n\n\t/**\n\t * The currently active text editor mode or `undefined` if there is currently no active\n\t * editor or the active editor control is neither a text nor a diff editor. If the active\n\t * editor is a diff editor, the modified side's mode will be taken.\n\t */\n\treadonly activeTextEditorMode: string | undefined;\n\n\t/**\n\t * All editor panes that are currently visible across all editor groups.\n\t *\n\t * @see `IEditorService.visibleEditors` for access to the visible editor inputs\n\t */\n\treadonly visibleEditorPanes: ReadonlyArray<IVisibleEditorPane>;\n\n\t/**\n\t * All editors that are currently visible. An editor is visible when it is opened in an\n\t * editor group and active in that group. Multiple editor groups can be opened at the same time.\n\t */\n\treadonly visibleEditors: ReadonlyArray<IEditorInput>;\n\n\t/**\n\t * All text editor widgets that are currently visible across all editor groups. A text editor\n\t * widget is either a text or a diff editor.\n\t */\n\treadonly visibleTextEditorControls: ReadonlyArray<IEditor | IDiffEditor>;\n\n\t/**\n\t * All editors that are opened across all editor groups in sequential order\n\t * of appearance.\n\t *\n\t * This includes active as well as inactive editors in each editor group.\n\t */\n\treadonly editors: ReadonlyArray<IEditorInput>;\n\n\t/**\n\t * The total number of editors that are opened either inactive or active.\n\t */\n\treadonly count: number;\n\n\t/**\n\t * All editors that are opened across all editor groups with their group\n\t * identifier.\n\t *\n\t * @param order the order of the editors to use\n\t * @param options whether to exclude sticky editors or not\n\t */\n\tgetEditors(order: EditorsOrder, options?: { excludeSticky?: boolean }): ReadonlyArray<IEditorIdentifier>;\n\n\t/**\n\t * Open an editor in an editor group.\n\t *\n\t * @param editor the editor to open\n\t * @param options the options to use for the editor\n\t * @param group the target group. If unspecified, the editor will open in the currently\n\t * active group. Use `SIDE_GROUP_TYPE` to open the editor in a new editor group to the side\n\t * of the currently active group.\n\t *\n\t * @returns the editor that opened or `undefined` if the operation failed or the editor was not\n\t * opened to be active.\n\t */\n\topenEditor(editor: IEditorInput, options?: IEditorOptions | ITextEditorOptions, group?: IEditorGroup | GroupIdentifier | SIDE_GROUP_TYPE | ACTIVE_GROUP_TYPE): Promise<IEditorPane | undefined>;\n\topenEditor(editor: IResourceEditorInput | IUntitledTextResourceEditorInput, group?: IEditorGroup | GroupIdentifier | SIDE_GROUP_TYPE | ACTIVE_GROUP_TYPE): Promise<ITextEditorPane | undefined>;\n\topenEditor(editor: IResourceDiffEditorInput, group?: IEditorGroup | GroupIdentifier | SIDE_GROUP_TYPE | ACTIVE_GROUP_TYPE): Promise<ITextDiffEditorPane | undefined>;\n\n\t/**\n\t * Open editors in an editor group.\n\t *\n\t * @param editors the editors to open with associated options\n\t * @param group the target group. If unspecified, the editor will open in the currently\n\t * active group. Use `SIDE_GROUP_TYPE` to open the editor in a new editor group to the side\n\t * of the currently active group.\n\t *\n\t * @returns the editors that opened. The array can be empty or have less elements for editors\n\t * that failed to open or were instructed to open as inactive.\n\t */\n\topenEditors(editors: IEditorInputWithOptions[], group?: IEditorGroup | GroupIdentifier | SIDE_GROUP_TYPE | ACTIVE_GROUP_TYPE): Promise<ReadonlyArray<IEditorPane>>;\n\topenEditors(editors: IResourceEditorInputType[], group?: IEditorGroup | GroupIdentifier | SIDE_GROUP_TYPE | ACTIVE_GROUP_TYPE): Promise<ReadonlyArray<IEditorPane>>;\n\n\t/**\n\t * Replaces editors in an editor group with the provided replacement.\n\t *\n\t * @param editors the editors to replace\n\t *\n\t * @returns a promise that is resolved when the replaced active\n\t * editor (if any) has finished loading.\n\t */\n\treplaceEditors(editors: IResourceEditorReplacement[], group: IEditorGroup | GroupIdentifier): Promise<void>;\n\treplaceEditors(editors: IEditorReplacement[], group: IEditorGroup | GroupIdentifier): Promise<void>;\n\n\t/**\n\t * Find out if the provided editor is opened in any editor group.\n\t *\n\t * Note: An editor can be opened but not actively visible.\n\t *\n\t * @param editor the editor to check for being opened. If a\n\t * `IResourceEditorInput` is passed in, the resource is checked on\n\t * all opened editors. In case of a side by side editor, the\n\t * right hand side resource is considered only.\n\t */\n\tisOpen(editor: IResourceEditorInput): boolean;\n\tisOpen(editor: IEditorInput): boolean;\n\n\t/**\n\t * Find the existing editors for a given resource.\n\t */\n\tfindEditors(resource: URI, group: IEditorGroup | GroupIdentifier): IEditorInput[];\n\n\t/**\n\t * Get all available editor overrides for the editor input.\n\t */\n\tgetEditorOverrides(resource: URI, options: IEditorOptions | undefined, group: IEditorGroup | undefined): [IOpenEditorOverrideHandler, IOpenEditorOverrideEntry][];\n\n\t/**\n\t * Allows to override the opening of editors by installing a handler that will\n\t * be called each time an editor is about to open allowing to override the\n\t * operation to open a different editor.\n\t */\n\toverrideOpenEditor(handler: IOpenEditorOverrideHandler): IDisposable;\n\n\t/**\n\t * Register handlers for custom editor view types.\n\t * The handler will provide all available custom editors registered\n\t * and also notify the editor service when a custom editor view type is registered/unregistered.\n\t */\n\tregisterCustomEditorViewTypesHandler(source: string, handler: ICustomEditorViewTypesHandler): IDisposable;\n\n\t/**\n\t * Converts a lightweight input to a workbench editor input.\n\t */\n\tcreateEditorInput(input: IResourceEditorInputType): IEditorInput;\n\n\t/**\n\t * Save the provided list of editors.\n\t *\n\t * @returns `true` if all editors saved and `false` otherwise.\n\t */\n\tsave(editors: IEditorIdentifier | IEditorIdentifier[], options?: ISaveEditorsOptions): Promise<boolean>;\n\n\t/**\n\t * Save all editors.\n\t *\n\t * @returns `true` if all editors saved and `false` otherwise.\n\t */\n\tsaveAll(options?: ISaveAllEditorsOptions): Promise<boolean>;\n\n\t/**\n\t * Reverts the provided list of editors.\n\t *\n\t * @returns `true` if all editors reverted and `false` otherwise.\n\t */\n\trevert(editors: IEditorIdentifier | IEditorIdentifier[], options?: IRevertOptions): Promise<boolean>;\n\n\t/**\n\t * Reverts all editors.\n\t *\n\t * @returns `true` if all editors reverted and `false` otherwise.\n\t */\n\trevertAll(options?: IRevertAllEditorsOptions): Promise<boolean>;\n\n\t/**\n\t * Track the provided editors until all have been closed.\n\t *\n\t * @param options use `waitForSaved: true` to wait for the resources\n\t * being saved. If auto-save is enabled, it may be possible to close\n\t * an editor while the save continues in the background.\n\t */\n\twhenClosed(editors: IResourceEditorInput[], options?: { waitForSaved: boolean }): Promise<void>;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as modes from 'vs/editor/common/modes';\nimport * as types from './extHostTypes';\nimport * as search from 'vs/workbench/contrib/search/common/search';\nimport { ITextEditorOptions } from 'vs/platform/editor/common/editor';\nimport { IDecorationOptions, IThemeDecorationRenderOptions, IDecorationRenderOptions, IContentDecorationRenderOptions } from 'vs/editor/common/editorCommon';\nimport { EndOfLineSequence, TrackedRangeStickiness } from 'vs/editor/common/model';\nimport type * as vscode from 'vscode';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { ProgressLocation as MainProgressLocation } from 'vs/platform/progress/common/progress';\nimport { EditorGroupColumn, SaveReason } from 'vs/workbench/common/editor';\nimport { IPosition } from 'vs/editor/common/core/position';\nimport * as editorRange from 'vs/editor/common/core/range';\nimport { ISelection } from 'vs/editor/common/core/selection';\nimport * as htmlContent from 'vs/base/common/htmlContent';\nimport * as languageSelector from 'vs/editor/common/modes/languageSelector';\nimport * as extHostProtocol from 'vs/workbench/api/common/extHost.protocol';\nimport { MarkerSeverity, IRelatedInformation, IMarkerData, MarkerTag } from 'vs/platform/markers/common/markers';\nimport { ACTIVE_GROUP, SIDE_GROUP } from 'vs/workbench/services/editor/common/editorService';\nimport { ExtHostDocumentsAndEditors } from 'vs/workbench/api/common/extHostDocumentsAndEditors';\nimport { isString, isNumber } from 'vs/base/common/types';\nimport * as marked from 'vs/base/common/marked/marked';\nimport { parse } from 'vs/base/common/marshalling';\nimport { cloneAndChange } from 'vs/base/common/objects';\nimport { LogLevel as _MainLogLevel } from 'vs/platform/log/common/log';\nimport { coalesce, isNonEmptyArray } from 'vs/base/common/arrays';\nimport { RenderLineNumbersType } from 'vs/editor/common/config/editorOptions';\nimport { CommandsConverter } from 'vs/workbench/api/common/extHostCommands';\nimport { ExtHostNotebookController } from 'vs/workbench/api/common/extHostNotebook';\nimport { CellOutputKind, IDisplayOutput, INotebookDecorationRenderOptions } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport { ITestItem, ITestState } from 'vs/workbench/contrib/testing/common/testCollection';\n\nexport interface PositionLike {\n\tline: number;\n\tcharacter: number;\n}\n\nexport interface RangeLike {\n\tstart: PositionLike;\n\tend: PositionLike;\n}\n\nexport interface SelectionLike extends RangeLike {\n\tanchor: PositionLike;\n\tactive: PositionLike;\n}\nexport namespace Selection {\n\n\texport function to(selection: ISelection): types.Selection {\n\t\tconst { selectionStartLineNumber, selectionStartColumn, positionLineNumber, positionColumn } = selection;\n\t\tconst start = new types.Position(selectionStartLineNumber - 1, selectionStartColumn - 1);\n\t\tconst end = new types.Position(positionLineNumber - 1, positionColumn - 1);\n\t\treturn new types.Selection(start, end);\n\t}\n\n\texport function from(selection: SelectionLike): ISelection {\n\t\tconst { anchor, active } = selection;\n\t\treturn {\n\t\t\tselectionStartLineNumber: anchor.line + 1,\n\t\t\tselectionStartColumn: anchor.character + 1,\n\t\t\tpositionLineNumber: active.line + 1,\n\t\t\tpositionColumn: active.character + 1\n\t\t};\n\t}\n}\nexport namespace Range {\n\n\texport function from(range: undefined): undefined;\n\texport function from(range: RangeLike): editorRange.IRange;\n\texport function from(range: RangeLike | undefined): editorRange.IRange | undefined;\n\texport function from(range: RangeLike | undefined): editorRange.IRange | undefined {\n\t\tif (!range) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst { start, end } = range;\n\t\treturn {\n\t\t\tstartLineNumber: start.line + 1,\n\t\t\tstartColumn: start.character + 1,\n\t\t\tendLineNumber: end.line + 1,\n\t\t\tendColumn: end.character + 1\n\t\t};\n\t}\n\n\texport function to(range: undefined): types.Range;\n\texport function to(range: editorRange.IRange): types.Range;\n\texport function to(range: editorRange.IRange | undefined): types.Range | undefined;\n\texport function to(range: editorRange.IRange | undefined): types.Range | undefined {\n\t\tif (!range) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst { startLineNumber, startColumn, endLineNumber, endColumn } = range;\n\t\treturn new types.Range(startLineNumber - 1, startColumn - 1, endLineNumber - 1, endColumn - 1);\n\t}\n}\n\nexport namespace TokenType {\n\texport function to(type: modes.StandardTokenType): types.StandardTokenType {\n\t\tswitch (type) {\n\t\t\tcase modes.StandardTokenType.Comment: return types.StandardTokenType.Comment;\n\t\t\tcase modes.StandardTokenType.Other: return types.StandardTokenType.Other;\n\t\t\tcase modes.StandardTokenType.RegEx: return types.StandardTokenType.RegEx;\n\t\t\tcase modes.StandardTokenType.String: return types.StandardTokenType.String;\n\t\t}\n\t}\n}\n\nexport namespace Position {\n\texport function to(position: IPosition): types.Position {\n\t\treturn new types.Position(position.lineNumber - 1, position.column - 1);\n\t}\n\texport function from(position: types.Position | vscode.Position): IPosition {\n\t\treturn { lineNumber: position.line + 1, column: position.character + 1 };\n\t}\n}\n\nexport namespace DiagnosticTag {\n\texport function from(value: vscode.DiagnosticTag): MarkerTag | undefined {\n\t\tswitch (value) {\n\t\t\tcase types.DiagnosticTag.Unnecessary:\n\t\t\t\treturn MarkerTag.Unnecessary;\n\t\t\tcase types.DiagnosticTag.Deprecated:\n\t\t\t\treturn MarkerTag.Deprecated;\n\t\t}\n\t\treturn undefined;\n\t}\n\texport function to(value: MarkerTag): vscode.DiagnosticTag | undefined {\n\t\tswitch (value) {\n\t\t\tcase MarkerTag.Unnecessary:\n\t\t\t\treturn types.DiagnosticTag.Unnecessary;\n\t\t\tcase MarkerTag.Deprecated:\n\t\t\t\treturn types.DiagnosticTag.Deprecated;\n\t\t\tdefault:\n\t\t\t\treturn undefined;\n\t\t}\n\t}\n}\n\nexport namespace Diagnostic {\n\texport function from(value: vscode.Diagnostic): IMarkerData {\n\t\tlet code: string | { value: string; target: URI } | undefined;\n\n\t\tif (value.code) {\n\t\t\tif (isString(value.code) || isNumber(value.code)) {\n\t\t\t\tcode = String(value.code);\n\t\t\t} else {\n\t\t\t\tcode = {\n\t\t\t\t\tvalue: String(value.code.value),\n\t\t\t\t\ttarget: value.code.target,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\t...Range.from(value.range),\n\t\t\tmessage: value.message,\n\t\t\tsource: value.source,\n\t\t\tcode,\n\t\t\tseverity: DiagnosticSeverity.from(value.severity),\n\t\t\trelatedInformation: value.relatedInformation && value.relatedInformation.map(DiagnosticRelatedInformation.from),\n\t\t\ttags: Array.isArray(value.tags) ? coalesce(value.tags.map(DiagnosticTag.from)) : undefined,\n\t\t};\n\t}\n\n\texport function to(value: IMarkerData): vscode.Diagnostic {\n\t\tconst res = new types.Diagnostic(Range.to(value), value.message, DiagnosticSeverity.to(value.severity));\n\t\tres.source = value.source;\n\t\tres.code = isString(value.code) ? value.code : value.code?.value;\n\t\tres.relatedInformation = value.relatedInformation && value.relatedInformation.map(DiagnosticRelatedInformation.to);\n\t\tres.tags = value.tags && coalesce(value.tags.map(DiagnosticTag.to));\n\t\treturn res;\n\t}\n}\n\nexport namespace DiagnosticRelatedInformation {\n\texport function from(value: vscode.DiagnosticRelatedInformation): IRelatedInformation {\n\t\treturn {\n\t\t\t...Range.from(value.location.range),\n\t\t\tmessage: value.message,\n\t\t\tresource: value.location.uri\n\t\t};\n\t}\n\texport function to(value: IRelatedInformation): types.DiagnosticRelatedInformation {\n\t\treturn new types.DiagnosticRelatedInformation(new types.Location(value.resource, Range.to(value)), value.message);\n\t}\n}\nexport namespace DiagnosticSeverity {\n\n\texport function from(value: number): MarkerSeverity {\n\t\tswitch (value) {\n\t\t\tcase types.DiagnosticSeverity.Error:\n\t\t\t\treturn MarkerSeverity.Error;\n\t\t\tcase types.DiagnosticSeverity.Warning:\n\t\t\t\treturn MarkerSeverity.Warning;\n\t\t\tcase types.DiagnosticSeverity.Information:\n\t\t\t\treturn MarkerSeverity.Info;\n\t\t\tcase types.DiagnosticSeverity.Hint:\n\t\t\t\treturn MarkerSeverity.Hint;\n\t\t}\n\t\treturn MarkerSeverity.Error;\n\t}\n\n\texport function to(value: MarkerSeverity): types.DiagnosticSeverity {\n\t\tswitch (value) {\n\t\t\tcase MarkerSeverity.Info:\n\t\t\t\treturn types.DiagnosticSeverity.Information;\n\t\t\tcase MarkerSeverity.Warning:\n\t\t\t\treturn types.DiagnosticSeverity.Warning;\n\t\t\tcase MarkerSeverity.Error:\n\t\t\t\treturn types.DiagnosticSeverity.Error;\n\t\t\tcase MarkerSeverity.Hint:\n\t\t\t\treturn types.DiagnosticSeverity.Hint;\n\t\t\tdefault:\n\t\t\t\treturn types.DiagnosticSeverity.Error;\n\t\t}\n\t}\n}\n\nexport namespace ViewColumn {\n\texport function from(column?: vscode.ViewColumn): EditorGroupColumn {\n\t\tif (typeof column === 'number' && column >= types.ViewColumn.One) {\n\t\t\treturn column - 1; // adjust zero index (ViewColumn.ONE => 0)\n\t\t}\n\n\t\tif (column === types.ViewColumn.Beside) {\n\t\t\treturn SIDE_GROUP;\n\t\t}\n\n\t\treturn ACTIVE_GROUP; // default is always the active group\n\t}\n\n\texport function to(position: EditorGroupColumn): vscode.ViewColumn {\n\t\tif (typeof position === 'number' && position >= 0) {\n\t\t\treturn position + 1; // adjust to index (ViewColumn.ONE => 1)\n\t\t}\n\n\t\tthrow new Error(`invalid 'EditorGroupColumn'`);\n\t}\n}\n\nfunction isDecorationOptions(something: any): something is vscode.DecorationOptions {\n\treturn (typeof something.range !== 'undefined');\n}\n\nexport function isDecorationOptionsArr(something: vscode.Range[] | vscode.DecorationOptions[]): something is vscode.DecorationOptions[] {\n\tif (something.length === 0) {\n\t\treturn true;\n\t}\n\treturn isDecorationOptions(something[0]) ? true : false;\n}\n\nexport namespace MarkdownString {\n\n\texport function fromMany(markup: (vscode.MarkdownString | vscode.MarkedString)[]): htmlContent.IMarkdownString[] {\n\t\treturn markup.map(MarkdownString.from);\n\t}\n\n\tinterface Codeblock {\n\t\tlanguage: string;\n\t\tvalue: string;\n\t}\n\n\tfunction isCodeblock(thing: any): thing is Codeblock {\n\t\treturn thing && typeof thing === 'object'\n\t\t\t&& typeof (<Codeblock>thing).language === 'string'\n\t\t\t&& typeof (<Codeblock>thing).value === 'string';\n\t}\n\n\texport function from(markup: vscode.MarkdownString | vscode.MarkedString): htmlContent.IMarkdownString {\n\t\tlet res: htmlContent.IMarkdownString;\n\t\tif (isCodeblock(markup)) {\n\t\t\tconst { language, value } = markup;\n\t\t\tres = { value: '```' + language + '\\n' + value + '\\n```\\n' };\n\t\t} else if (types.MarkdownString.isMarkdownString(markup)) {\n\t\t\tres = { value: markup.value, isTrusted: markup.isTrusted, supportThemeIcons: markup.supportThemeIcons };\n\t\t} else if (typeof markup === 'string') {\n\t\t\tres = { value: markup };\n\t\t} else {\n\t\t\tres = { value: '' };\n\t\t}\n\n\t\t// extract uris into a separate object\n\t\tconst resUris: { [href: string]: UriComponents; } = Object.create(null);\n\t\tres.uris = resUris;\n\n\t\tconst collectUri = (href: string): string => {\n\t\t\ttry {\n\t\t\t\tlet uri = URI.parse(href, true);\n\t\t\t\turi = uri.with({ query: _uriMassage(uri.query, resUris) });\n\t\t\t\tresUris[href] = uri;\n\t\t\t} catch (e) {\n\t\t\t\t// ignore\n\t\t\t}\n\t\t\treturn '';\n\t\t};\n\t\tconst renderer = new marked.Renderer();\n\t\trenderer.link = collectUri;\n\t\trenderer.image = href => collectUri(htmlContent.parseHrefAndDimensions(href).href);\n\n\t\tmarked(res.value, { renderer });\n\n\t\treturn res;\n\t}\n\n\tfunction _uriMassage(part: string, bucket: { [n: string]: UriComponents; }): string {\n\t\tif (!part) {\n\t\t\treturn part;\n\t\t}\n\t\tlet data: any;\n\t\ttry {\n\t\t\tdata = parse(part);\n\t\t} catch (e) {\n\t\t\t// ignore\n\t\t}\n\t\tif (!data) {\n\t\t\treturn part;\n\t\t}\n\t\tlet changed = false;\n\t\tdata = cloneAndChange(data, value => {\n\t\t\tif (URI.isUri(value)) {\n\t\t\t\tconst key = `__uri_${Math.random().toString(16).slice(2, 8)}`;\n\t\t\t\tbucket[key] = value;\n\t\t\t\tchanged = true;\n\t\t\t\treturn key;\n\t\t\t} else {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t});\n\n\t\tif (!changed) {\n\t\t\treturn part;\n\t\t}\n\n\t\treturn JSON.stringify(data);\n\t}\n\n\texport function to(value: htmlContent.IMarkdownString): vscode.MarkdownString {\n\t\tconst result = new types.MarkdownString(value.value, value.supportThemeIcons);\n\t\tresult.isTrusted = value.isTrusted;\n\t\treturn result;\n\t}\n\n\texport function fromStrict(value: string | vscode.MarkdownString): undefined | string | htmlContent.IMarkdownString {\n\t\tif (!value) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn typeof value === 'string' ? value : MarkdownString.from(value);\n\t}\n}\n\nexport function fromRangeOrRangeWithMessage(ranges: vscode.Range[] | vscode.DecorationOptions[]): IDecorationOptions[] {\n\tif (isDecorationOptionsArr(ranges)) {\n\t\treturn ranges.map((r): IDecorationOptions => {\n\t\t\treturn {\n\t\t\t\trange: Range.from(r.range),\n\t\t\t\thoverMessage: Array.isArray(r.hoverMessage)\n\t\t\t\t\t? MarkdownString.fromMany(r.hoverMessage)\n\t\t\t\t\t: (r.hoverMessage ? MarkdownString.from(r.hoverMessage) : undefined),\n\t\t\t\trenderOptions: <any> /* URI vs Uri */r.renderOptions\n\t\t\t};\n\t\t});\n\t} else {\n\t\treturn ranges.map((r): IDecorationOptions => {\n\t\t\treturn {\n\t\t\t\trange: Range.from(r)\n\t\t\t};\n\t\t});\n\t}\n}\n\nexport function pathOrURIToURI(value: string | URI): URI {\n\tif (typeof value === 'undefined') {\n\t\treturn value;\n\t}\n\tif (typeof value === 'string') {\n\t\treturn URI.file(value);\n\t} else {\n\t\treturn value;\n\t}\n}\n\nexport namespace ThemableDecorationAttachmentRenderOptions {\n\texport function from(options: vscode.ThemableDecorationAttachmentRenderOptions): IContentDecorationRenderOptions {\n\t\tif (typeof options === 'undefined') {\n\t\t\treturn options;\n\t\t}\n\t\treturn {\n\t\t\tcontentText: options.contentText,\n\t\t\tcontentIconPath: options.contentIconPath ? pathOrURIToURI(options.contentIconPath) : undefined,\n\t\t\tborder: options.border,\n\t\t\tborderColor: <string | types.ThemeColor>options.borderColor,\n\t\t\tfontStyle: options.fontStyle,\n\t\t\tfontWeight: options.fontWeight,\n\t\t\ttextDecoration: options.textDecoration,\n\t\t\tcolor: <string | types.ThemeColor>options.color,\n\t\t\tbackgroundColor: <string | types.ThemeColor>options.backgroundColor,\n\t\t\tmargin: options.margin,\n\t\t\twidth: options.width,\n\t\t\theight: options.height,\n\t\t};\n\t}\n}\n\nexport namespace ThemableDecorationRenderOptions {\n\texport function from(options: vscode.ThemableDecorationRenderOptions): IThemeDecorationRenderOptions {\n\t\tif (typeof options === 'undefined') {\n\t\t\treturn options;\n\t\t}\n\t\treturn {\n\t\t\tbackgroundColor: <string | types.ThemeColor>options.backgroundColor,\n\t\t\toutline: options.outline,\n\t\t\toutlineColor: <string | types.ThemeColor>options.outlineColor,\n\t\t\toutlineStyle: options.outlineStyle,\n\t\t\toutlineWidth: options.outlineWidth,\n\t\t\tborder: options.border,\n\t\t\tborderColor: <string | types.ThemeColor>options.borderColor,\n\t\t\tborderRadius: options.borderRadius,\n\t\t\tborderSpacing: options.borderSpacing,\n\t\t\tborderStyle: options.borderStyle,\n\t\t\tborderWidth: options.borderWidth,\n\t\t\tfontStyle: options.fontStyle,\n\t\t\tfontWeight: options.fontWeight,\n\t\t\ttextDecoration: options.textDecoration,\n\t\t\tcursor: options.cursor,\n\t\t\tcolor: <string | types.ThemeColor>options.color,\n\t\t\topacity: options.opacity,\n\t\t\tletterSpacing: options.letterSpacing,\n\t\t\tgutterIconPath: options.gutterIconPath ? pathOrURIToURI(options.gutterIconPath) : undefined,\n\t\t\tgutterIconSize: options.gutterIconSize,\n\t\t\toverviewRulerColor: <string | types.ThemeColor>options.overviewRulerColor,\n\t\t\tbefore: options.before ? ThemableDecorationAttachmentRenderOptions.from(options.before) : undefined,\n\t\t\tafter: options.after ? ThemableDecorationAttachmentRenderOptions.from(options.after) : undefined,\n\t\t};\n\t}\n}\n\nexport namespace DecorationRangeBehavior {\n\texport function from(value: types.DecorationRangeBehavior): TrackedRangeStickiness {\n\t\tif (typeof value === 'undefined') {\n\t\t\treturn value;\n\t\t}\n\t\tswitch (value) {\n\t\t\tcase types.DecorationRangeBehavior.OpenOpen:\n\t\t\t\treturn TrackedRangeStickiness.AlwaysGrowsWhenTypingAtEdges;\n\t\t\tcase types.DecorationRangeBehavior.ClosedClosed:\n\t\t\t\treturn TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges;\n\t\t\tcase types.DecorationRangeBehavior.OpenClosed:\n\t\t\t\treturn TrackedRangeStickiness.GrowsOnlyWhenTypingBefore;\n\t\t\tcase types.DecorationRangeBehavior.ClosedOpen:\n\t\t\t\treturn TrackedRangeStickiness.GrowsOnlyWhenTypingAfter;\n\t\t}\n\t}\n}\n\nexport namespace DecorationRenderOptions {\n\texport function from(options: vscode.DecorationRenderOptions): IDecorationRenderOptions {\n\t\treturn {\n\t\t\tisWholeLine: options.isWholeLine,\n\t\t\trangeBehavior: options.rangeBehavior ? DecorationRangeBehavior.from(options.rangeBehavior) : undefined,\n\t\t\toverviewRulerLane: options.overviewRulerLane,\n\t\t\tlight: options.light ? ThemableDecorationRenderOptions.from(options.light) : undefined,\n\t\t\tdark: options.dark ? ThemableDecorationRenderOptions.from(options.dark) : undefined,\n\n\t\t\tbackgroundColor: <string | types.ThemeColor>options.backgroundColor,\n\t\t\toutline: options.outline,\n\t\t\toutlineColor: <string | types.ThemeColor>options.outlineColor,\n\t\t\toutlineStyle: options.outlineStyle,\n\t\t\toutlineWidth: options.outlineWidth,\n\t\t\tborder: options.border,\n\t\t\tborderColor: <string | types.ThemeColor>options.borderColor,\n\t\t\tborderRadius: options.borderRadius,\n\t\t\tborderSpacing: options.borderSpacing,\n\t\t\tborderStyle: options.borderStyle,\n\t\t\tborderWidth: options.borderWidth,\n\t\t\tfontStyle: options.fontStyle,\n\t\t\tfontWeight: options.fontWeight,\n\t\t\ttextDecoration: options.textDecoration,\n\t\t\tcursor: options.cursor,\n\t\t\tcolor: <string | types.ThemeColor>options.color,\n\t\t\topacity: options.opacity,\n\t\t\tletterSpacing: options.letterSpacing,\n\t\t\tgutterIconPath: options.gutterIconPath ? pathOrURIToURI(options.gutterIconPath) : undefined,\n\t\t\tgutterIconSize: options.gutterIconSize,\n\t\t\toverviewRulerColor: <string | types.ThemeColor>options.overviewRulerColor,\n\t\t\tbefore: options.before ? ThemableDecorationAttachmentRenderOptions.from(options.before) : undefined,\n\t\t\tafter: options.after ? ThemableDecorationAttachmentRenderOptions.from(options.after) : undefined,\n\t\t};\n\t}\n}\n\nexport namespace TextEdit {\n\n\texport function from(edit: vscode.TextEdit): modes.TextEdit {\n\t\treturn <modes.TextEdit>{\n\t\t\ttext: edit.newText,\n\t\t\teol: edit.newEol && EndOfLine.from(edit.newEol),\n\t\t\trange: Range.from(edit.range)\n\t\t};\n\t}\n\n\texport function to(edit: modes.TextEdit): types.TextEdit {\n\t\tconst result = new types.TextEdit(Range.to(edit.range), edit.text);\n\t\tresult.newEol = (typeof edit.eol === 'undefined' ? undefined : EndOfLine.to(edit.eol))!;\n\t\treturn result;\n\t}\n}\n\nexport namespace WorkspaceEdit {\n\texport function from(value: vscode.WorkspaceEdit, documents?: ExtHostDocumentsAndEditors, notebooks?: ExtHostNotebookController): extHostProtocol.IWorkspaceEditDto {\n\t\tconst result: extHostProtocol.IWorkspaceEditDto = {\n\t\t\tedits: []\n\t\t};\n\n\t\tif (value instanceof types.WorkspaceEdit) {\n\t\t\tfor (let entry of value._allEntries()) {\n\n\t\t\t\tif (entry._type === types.FileEditType.File) {\n\t\t\t\t\t// file operation\n\t\t\t\t\tresult.edits.push(<extHostProtocol.IWorkspaceFileEditDto>{\n\t\t\t\t\t\t_type: extHostProtocol.WorkspaceEditType.File,\n\t\t\t\t\t\toldUri: entry.from,\n\t\t\t\t\t\tnewUri: entry.to,\n\t\t\t\t\t\toptions: entry.options,\n\t\t\t\t\t\tmetadata: entry.metadata\n\t\t\t\t\t});\n\n\t\t\t\t} else if (entry._type === types.FileEditType.Text) {\n\t\t\t\t\t// text edits\n\t\t\t\t\tconst doc = documents?.getDocument(entry.uri);\n\t\t\t\t\tresult.edits.push(<extHostProtocol.IWorkspaceTextEditDto>{\n\t\t\t\t\t\t_type: extHostProtocol.WorkspaceEditType.Text,\n\t\t\t\t\t\tresource: entry.uri,\n\t\t\t\t\t\tedit: TextEdit.from(entry.edit),\n\t\t\t\t\t\tmodelVersionId: doc?.version,\n\t\t\t\t\t\tmetadata: entry.metadata\n\t\t\t\t\t});\n\t\t\t\t} else if (entry._type === types.FileEditType.Cell) {\n\t\t\t\t\tresult.edits.push(<extHostProtocol.IWorkspaceCellEditDto>{\n\t\t\t\t\t\t_type: extHostProtocol.WorkspaceEditType.Cell,\n\t\t\t\t\t\tmetadata: entry.metadata,\n\t\t\t\t\t\tresource: entry.uri,\n\t\t\t\t\t\tedit: entry.edit,\n\t\t\t\t\t\tnotebookMetadata: entry.notebookMetadata,\n\t\t\t\t\t\tnotebookVersionId: notebooks?.lookupNotebookDocument(entry.uri)?.notebookDocument.version\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\texport function to(value: extHostProtocol.IWorkspaceEditDto) {\n\t\tconst result = new types.WorkspaceEdit();\n\t\tfor (const edit of value.edits) {\n\t\t\tif ((<extHostProtocol.IWorkspaceTextEditDto>edit).edit) {\n\t\t\t\tresult.replace(\n\t\t\t\t\tURI.revive((<extHostProtocol.IWorkspaceTextEditDto>edit).resource),\n\t\t\t\t\tRange.to((<extHostProtocol.IWorkspaceTextEditDto>edit).edit.range),\n\t\t\t\t\t(<extHostProtocol.IWorkspaceTextEditDto>edit).edit.text\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tresult.renameFile(\n\t\t\t\t\tURI.revive((<extHostProtocol.IWorkspaceFileEditDto>edit).oldUri!),\n\t\t\t\t\tURI.revive((<extHostProtocol.IWorkspaceFileEditDto>edit).newUri!),\n\t\t\t\t\t(<extHostProtocol.IWorkspaceFileEditDto>edit).options\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n}\n\n\nexport namespace SymbolKind {\n\n\tconst _fromMapping: { [kind: number]: modes.SymbolKind; } = Object.create(null);\n\t_fromMapping[types.SymbolKind.File] = modes.SymbolKind.File;\n\t_fromMapping[types.SymbolKind.Module] = modes.SymbolKind.Module;\n\t_fromMapping[types.SymbolKind.Namespace] = modes.SymbolKind.Namespace;\n\t_fromMapping[types.SymbolKind.Package] = modes.SymbolKind.Package;\n\t_fromMapping[types.SymbolKind.Class] = modes.SymbolKind.Class;\n\t_fromMapping[types.SymbolKind.Method] = modes.SymbolKind.Method;\n\t_fromMapping[types.SymbolKind.Property] = modes.SymbolKind.Property;\n\t_fromMapping[types.SymbolKind.Field] = modes.SymbolKind.Field;\n\t_fromMapping[types.SymbolKind.Constructor] = modes.SymbolKind.Constructor;\n\t_fromMapping[types.SymbolKind.Enum] = modes.SymbolKind.Enum;\n\t_fromMapping[types.SymbolKind.Interface] = modes.SymbolKind.Interface;\n\t_fromMapping[types.SymbolKind.Function] = modes.SymbolKind.Function;\n\t_fromMapping[types.SymbolKind.Variable] = modes.SymbolKind.Variable;\n\t_fromMapping[types.SymbolKind.Constant] = modes.SymbolKind.Constant;\n\t_fromMapping[types.SymbolKind.String] = modes.SymbolKind.String;\n\t_fromMapping[types.SymbolKind.Number] = modes.SymbolKind.Number;\n\t_fromMapping[types.SymbolKind.Boolean] = modes.SymbolKind.Boolean;\n\t_fromMapping[types.SymbolKind.Array] = modes.SymbolKind.Array;\n\t_fromMapping[types.SymbolKind.Object] = modes.SymbolKind.Object;\n\t_fromMapping[types.SymbolKind.Key] = modes.SymbolKind.Key;\n\t_fromMapping[types.SymbolKind.Null] = modes.SymbolKind.Null;\n\t_fromMapping[types.SymbolKind.EnumMember] = modes.SymbolKind.EnumMember;\n\t_fromMapping[types.SymbolKind.Struct] = modes.SymbolKind.Struct;\n\t_fromMapping[types.SymbolKind.Event] = modes.SymbolKind.Event;\n\t_fromMapping[types.SymbolKind.Operator] = modes.SymbolKind.Operator;\n\t_fromMapping[types.SymbolKind.TypeParameter] = modes.SymbolKind.TypeParameter;\n\n\texport function from(kind: vscode.SymbolKind): modes.SymbolKind {\n\t\treturn typeof _fromMapping[kind] === 'number' ? _fromMapping[kind] : modes.SymbolKind.Property;\n\t}\n\n\texport function to(kind: modes.SymbolKind): vscode.SymbolKind {\n\t\tfor (const k in _fromMapping) {\n\t\t\tif (_fromMapping[k] === kind) {\n\t\t\t\treturn Number(k);\n\t\t\t}\n\t\t}\n\t\treturn types.SymbolKind.Property;\n\t}\n}\n\nexport namespace SymbolTag {\n\n\texport function from(kind: types.SymbolTag): modes.SymbolTag {\n\t\tswitch (kind) {\n\t\t\tcase types.SymbolTag.Deprecated: return modes.SymbolTag.Deprecated;\n\t\t}\n\t}\n\n\texport function to(kind: modes.SymbolTag): types.SymbolTag {\n\t\tswitch (kind) {\n\t\t\tcase modes.SymbolTag.Deprecated: return types.SymbolTag.Deprecated;\n\t\t}\n\t}\n}\n\nexport namespace WorkspaceSymbol {\n\texport function from(info: vscode.SymbolInformation): search.IWorkspaceSymbol {\n\t\treturn <search.IWorkspaceSymbol>{\n\t\t\tname: info.name,\n\t\t\tkind: SymbolKind.from(info.kind),\n\t\t\ttags: info.tags && info.tags.map(SymbolTag.from),\n\t\t\tcontainerName: info.containerName,\n\t\t\tlocation: location.from(info.location)\n\t\t};\n\t}\n\texport function to(info: search.IWorkspaceSymbol): types.SymbolInformation {\n\t\tconst result = new types.SymbolInformation(\n\t\t\tinfo.name,\n\t\t\tSymbolKind.to(info.kind),\n\t\t\tinfo.containerName,\n\t\t\tlocation.to(info.location)\n\t\t);\n\t\tresult.tags = info.tags && info.tags.map(SymbolTag.to);\n\t\treturn result;\n\t}\n}\n\nexport namespace DocumentSymbol {\n\texport function from(info: vscode.DocumentSymbol): modes.DocumentSymbol {\n\t\tconst result: modes.DocumentSymbol = {\n\t\t\tname: info.name || '!!MISSING: name!!',\n\t\t\tdetail: info.detail,\n\t\t\trange: Range.from(info.range),\n\t\t\tselectionRange: Range.from(info.selectionRange),\n\t\t\tkind: SymbolKind.from(info.kind),\n\t\t\ttags: info.tags?.map(SymbolTag.from) ?? []\n\t\t};\n\t\tif (info.children) {\n\t\t\tresult.children = info.children.map(from);\n\t\t}\n\t\treturn result;\n\t}\n\texport function to(info: modes.DocumentSymbol): vscode.DocumentSymbol {\n\t\tconst result = new types.DocumentSymbol(\n\t\t\tinfo.name,\n\t\t\tinfo.detail,\n\t\t\tSymbolKind.to(info.kind),\n\t\t\tRange.to(info.range),\n\t\t\tRange.to(info.selectionRange),\n\t\t);\n\t\tif (isNonEmptyArray(info.tags)) {\n\t\t\tresult.tags = info.tags.map(SymbolTag.to);\n\t\t}\n\t\tif (info.children) {\n\t\t\tresult.children = info.children.map(to) as any;\n\t\t}\n\t\treturn result;\n\t}\n}\n\nexport namespace CallHierarchyItem {\n\n\texport function to(item: extHostProtocol.ICallHierarchyItemDto): types.CallHierarchyItem {\n\t\tconst result = new types.CallHierarchyItem(\n\t\t\tSymbolKind.to(item.kind),\n\t\t\titem.name,\n\t\t\titem.detail || '',\n\t\t\tURI.revive(item.uri),\n\t\t\tRange.to(item.range),\n\t\t\tRange.to(item.selectionRange)\n\t\t);\n\n\t\tresult._sessionId = item._sessionId;\n\t\tresult._itemId = item._itemId;\n\n\t\treturn result;\n\t}\n}\n\nexport namespace CallHierarchyIncomingCall {\n\n\texport function to(item: extHostProtocol.IIncomingCallDto): types.CallHierarchyIncomingCall {\n\t\treturn new types.CallHierarchyIncomingCall(\n\t\t\tCallHierarchyItem.to(item.from),\n\t\t\titem.fromRanges.map(r => Range.to(r))\n\t\t);\n\t}\n}\n\nexport namespace CallHierarchyOutgoingCall {\n\n\texport function to(item: extHostProtocol.IOutgoingCallDto): types.CallHierarchyOutgoingCall {\n\t\treturn new types.CallHierarchyOutgoingCall(\n\t\t\tCallHierarchyItem.to(item.to),\n\t\t\titem.fromRanges.map(r => Range.to(r))\n\t\t);\n\t}\n}\n\n\nexport namespace location {\n\texport function from(value: vscode.Location): modes.Location {\n\t\treturn {\n\t\t\trange: value.range && Range.from(value.range),\n\t\t\turi: value.uri\n\t\t};\n\t}\n\n\texport function to(value: modes.Location): types.Location {\n\t\treturn new types.Location(value.uri, Range.to(value.range));\n\t}\n}\n\nexport namespace DefinitionLink {\n\texport function from(value: vscode.Location | vscode.DefinitionLink): modes.LocationLink {\n\t\tconst definitionLink = <vscode.DefinitionLink>value;\n\t\tconst location = <vscode.Location>value;\n\t\treturn {\n\t\t\toriginSelectionRange: definitionLink.originSelectionRange\n\t\t\t\t? Range.from(definitionLink.originSelectionRange)\n\t\t\t\t: undefined,\n\t\t\turi: definitionLink.targetUri ? definitionLink.targetUri : location.uri,\n\t\t\trange: Range.from(definitionLink.targetRange ? definitionLink.targetRange : location.range),\n\t\t\ttargetSelectionRange: definitionLink.targetSelectionRange\n\t\t\t\t? Range.from(definitionLink.targetSelectionRange)\n\t\t\t\t: undefined,\n\t\t};\n\t}\n\texport function to(value: modes.LocationLink): vscode.LocationLink {\n\t\treturn {\n\t\t\ttargetUri: value.uri,\n\t\t\ttargetRange: Range.to(value.range),\n\t\t\ttargetSelectionRange: value.targetSelectionRange\n\t\t\t\t? Range.to(value.targetSelectionRange)\n\t\t\t\t: undefined,\n\t\t\toriginSelectionRange: value.originSelectionRange\n\t\t\t\t? Range.to(value.originSelectionRange)\n\t\t\t\t: undefined\n\t\t};\n\t}\n}\n\nexport namespace Hover {\n\texport function from(hover: vscode.Hover): modes.Hover {\n\t\treturn <modes.Hover>{\n\t\t\trange: Range.from(hover.range),\n\t\t\tcontents: MarkdownString.fromMany(hover.contents)\n\t\t};\n\t}\n\n\texport function to(info: modes.Hover): types.Hover {\n\t\treturn new types.Hover(info.contents.map(MarkdownString.to), Range.to(info.range));\n\t}\n}\n\nexport namespace EvaluatableExpression {\n\texport function from(expression: vscode.EvaluatableExpression): modes.EvaluatableExpression {\n\t\treturn <modes.EvaluatableExpression>{\n\t\t\trange: Range.from(expression.range),\n\t\t\texpression: expression.expression\n\t\t};\n\t}\n\n\texport function to(info: modes.EvaluatableExpression): types.EvaluatableExpression {\n\t\treturn new types.EvaluatableExpression(Range.to(info.range), info.expression);\n\t}\n}\n\nexport namespace DocumentHighlight {\n\texport function from(documentHighlight: vscode.DocumentHighlight): modes.DocumentHighlight {\n\t\treturn {\n\t\t\trange: Range.from(documentHighlight.range),\n\t\t\tkind: documentHighlight.kind\n\t\t};\n\t}\n\texport function to(occurrence: modes.DocumentHighlight): types.DocumentHighlight {\n\t\treturn new types.DocumentHighlight(Range.to(occurrence.range), occurrence.kind);\n\t}\n}\n\nexport namespace CompletionTriggerKind {\n\texport function to(kind: modes.CompletionTriggerKind) {\n\t\tswitch (kind) {\n\t\t\tcase modes.CompletionTriggerKind.TriggerCharacter:\n\t\t\t\treturn types.CompletionTriggerKind.TriggerCharacter;\n\t\t\tcase modes.CompletionTriggerKind.TriggerForIncompleteCompletions:\n\t\t\t\treturn types.CompletionTriggerKind.TriggerForIncompleteCompletions;\n\t\t\tcase modes.CompletionTriggerKind.Invoke:\n\t\t\tdefault:\n\t\t\t\treturn types.CompletionTriggerKind.Invoke;\n\t\t}\n\t}\n}\n\nexport namespace CompletionContext {\n\texport function to(context: modes.CompletionContext): types.CompletionContext {\n\t\treturn {\n\t\t\ttriggerKind: CompletionTriggerKind.to(context.triggerKind),\n\t\t\ttriggerCharacter: context.triggerCharacter\n\t\t};\n\t}\n}\n\nexport namespace CompletionItemTag {\n\n\texport function from(kind: types.CompletionItemTag): modes.CompletionItemTag {\n\t\tswitch (kind) {\n\t\t\tcase types.CompletionItemTag.Deprecated: return modes.CompletionItemTag.Deprecated;\n\t\t}\n\t}\n\n\texport function to(kind: modes.CompletionItemTag): types.CompletionItemTag {\n\t\tswitch (kind) {\n\t\t\tcase modes.CompletionItemTag.Deprecated: return types.CompletionItemTag.Deprecated;\n\t\t}\n\t}\n}\n\nexport namespace CompletionItemKind {\n\n\tconst _from = new Map<types.CompletionItemKind, modes.CompletionItemKind>([\n\t\t[types.CompletionItemKind.Method, modes.CompletionItemKind.Method],\n\t\t[types.CompletionItemKind.Function, modes.CompletionItemKind.Function],\n\t\t[types.CompletionItemKind.Constructor, modes.CompletionItemKind.Constructor],\n\t\t[types.CompletionItemKind.Field, modes.CompletionItemKind.Field],\n\t\t[types.CompletionItemKind.Variable, modes.CompletionItemKind.Variable],\n\t\t[types.CompletionItemKind.Class, modes.CompletionItemKind.Class],\n\t\t[types.CompletionItemKind.Interface, modes.CompletionItemKind.Interface],\n\t\t[types.CompletionItemKind.Struct, modes.CompletionItemKind.Struct],\n\t\t[types.CompletionItemKind.Module, modes.CompletionItemKind.Module],\n\t\t[types.CompletionItemKind.Property, modes.CompletionItemKind.Property],\n\t\t[types.CompletionItemKind.Unit, modes.CompletionItemKind.Unit],\n\t\t[types.CompletionItemKind.Value, modes.CompletionItemKind.Value],\n\t\t[types.CompletionItemKind.Constant, modes.CompletionItemKind.Constant],\n\t\t[types.CompletionItemKind.Enum, modes.CompletionItemKind.Enum],\n\t\t[types.CompletionItemKind.EnumMember, modes.CompletionItemKind.EnumMember],\n\t\t[types.CompletionItemKind.Keyword, modes.CompletionItemKind.Keyword],\n\t\t[types.CompletionItemKind.Snippet, modes.CompletionItemKind.Snippet],\n\t\t[types.CompletionItemKind.Text, modes.CompletionItemKind.Text],\n\t\t[types.CompletionItemKind.Color, modes.CompletionItemKind.Color],\n\t\t[types.CompletionItemKind.File, modes.CompletionItemKind.File],\n\t\t[types.CompletionItemKind.Reference, modes.CompletionItemKind.Reference],\n\t\t[types.CompletionItemKind.Folder, modes.CompletionItemKind.Folder],\n\t\t[types.CompletionItemKind.Event, modes.CompletionItemKind.Event],\n\t\t[types.CompletionItemKind.Operator, modes.CompletionItemKind.Operator],\n\t\t[types.CompletionItemKind.TypeParameter, modes.CompletionItemKind.TypeParameter],\n\t\t[types.CompletionItemKind.Issue, modes.CompletionItemKind.Issue],\n\t\t[types.CompletionItemKind.User, modes.CompletionItemKind.User],\n\t]);\n\n\texport function from(kind: types.CompletionItemKind): modes.CompletionItemKind {\n\t\treturn _from.get(kind) ?? modes.CompletionItemKind.Property;\n\t}\n\n\tconst _to = new Map<modes.CompletionItemKind, types.CompletionItemKind>([\n\t\t[modes.CompletionItemKind.Method, types.CompletionItemKind.Method],\n\t\t[modes.CompletionItemKind.Function, types.CompletionItemKind.Function],\n\t\t[modes.CompletionItemKind.Constructor, types.CompletionItemKind.Constructor],\n\t\t[modes.CompletionItemKind.Field, types.CompletionItemKind.Field],\n\t\t[modes.CompletionItemKind.Variable, types.CompletionItemKind.Variable],\n\t\t[modes.CompletionItemKind.Class, types.CompletionItemKind.Class],\n\t\t[modes.CompletionItemKind.Interface, types.CompletionItemKind.Interface],\n\t\t[modes.CompletionItemKind.Struct, types.CompletionItemKind.Struct],\n\t\t[modes.CompletionItemKind.Module, types.CompletionItemKind.Module],\n\t\t[modes.CompletionItemKind.Property, types.CompletionItemKind.Property],\n\t\t[modes.CompletionItemKind.Unit, types.CompletionItemKind.Unit],\n\t\t[modes.CompletionItemKind.Value, types.CompletionItemKind.Value],\n\t\t[modes.CompletionItemKind.Constant, types.CompletionItemKind.Constant],\n\t\t[modes.CompletionItemKind.Enum, types.CompletionItemKind.Enum],\n\t\t[modes.CompletionItemKind.EnumMember, types.CompletionItemKind.EnumMember],\n\t\t[modes.CompletionItemKind.Keyword, types.CompletionItemKind.Keyword],\n\t\t[modes.CompletionItemKind.Snippet, types.CompletionItemKind.Snippet],\n\t\t[modes.CompletionItemKind.Text, types.CompletionItemKind.Text],\n\t\t[modes.CompletionItemKind.Color, types.CompletionItemKind.Color],\n\t\t[modes.CompletionItemKind.File, types.CompletionItemKind.File],\n\t\t[modes.CompletionItemKind.Reference, types.CompletionItemKind.Reference],\n\t\t[modes.CompletionItemKind.Folder, types.CompletionItemKind.Folder],\n\t\t[modes.CompletionItemKind.Event, types.CompletionItemKind.Event],\n\t\t[modes.CompletionItemKind.Operator, types.CompletionItemKind.Operator],\n\t\t[modes.CompletionItemKind.TypeParameter, types.CompletionItemKind.TypeParameter],\n\t\t[modes.CompletionItemKind.User, types.CompletionItemKind.User],\n\t\t[modes.CompletionItemKind.Issue, types.CompletionItemKind.Issue],\n\t]);\n\n\texport function to(kind: modes.CompletionItemKind): types.CompletionItemKind {\n\t\treturn _to.get(kind) ?? types.CompletionItemKind.Property;\n\t}\n}\n\nexport namespace CompletionItem {\n\n\texport function to(suggestion: modes.CompletionItem, converter?: CommandsConverter): types.CompletionItem {\n\n\t\tconst result = new types.CompletionItem(typeof suggestion.label === 'string' ? suggestion.label : suggestion.label.name);\n\t\tif (typeof suggestion.label !== 'string') {\n\t\t\tresult.label2 = suggestion.label;\n\t\t}\n\n\t\tresult.insertText = suggestion.insertText;\n\t\tresult.kind = CompletionItemKind.to(suggestion.kind);\n\t\tresult.tags = suggestion.tags?.map(CompletionItemTag.to);\n\t\tresult.detail = suggestion.detail;\n\t\tresult.documentation = htmlContent.isMarkdownString(suggestion.documentation) ? MarkdownString.to(suggestion.documentation) : suggestion.documentation;\n\t\tresult.sortText = suggestion.sortText;\n\t\tresult.filterText = suggestion.filterText;\n\t\tresult.preselect = suggestion.preselect;\n\t\tresult.commitCharacters = suggestion.commitCharacters;\n\n\t\t// range\n\t\tif (editorRange.Range.isIRange(suggestion.range)) {\n\t\t\tresult.range = Range.to(suggestion.range);\n\t\t} else if (typeof suggestion.range === 'object') {\n\t\t\tresult.range = { inserting: Range.to(suggestion.range.insert), replacing: Range.to(suggestion.range.replace) };\n\t\t}\n\n\t\tresult.keepWhitespace = typeof suggestion.insertTextRules === 'undefined' ? false : Boolean(suggestion.insertTextRules & modes.CompletionItemInsertTextRule.KeepWhitespace);\n\t\t// 'insertText'-logic\n\t\tif (typeof suggestion.insertTextRules !== 'undefined' && suggestion.insertTextRules & modes.CompletionItemInsertTextRule.InsertAsSnippet) {\n\t\t\tresult.insertText = new types.SnippetString(suggestion.insertText);\n\t\t} else {\n\t\t\tresult.insertText = suggestion.insertText;\n\t\t\tresult.textEdit = result.range instanceof types.Range ? new types.TextEdit(result.range, result.insertText) : undefined;\n\t\t}\n\t\tif (suggestion.additionalTextEdits && suggestion.additionalTextEdits.length > 0) {\n\t\t\tresult.additionalTextEdits = suggestion.additionalTextEdits.map(e => TextEdit.to(e as modes.TextEdit));\n\t\t}\n\t\tresult.command = converter && suggestion.command ? converter.fromInternal(suggestion.command) : undefined;\n\n\t\treturn result;\n\t}\n}\n\nexport namespace ParameterInformation {\n\texport function from(info: types.ParameterInformation): modes.ParameterInformation {\n\t\treturn {\n\t\t\tlabel: info.label,\n\t\t\tdocumentation: info.documentation ? MarkdownString.fromStrict(info.documentation) : undefined\n\t\t};\n\t}\n\texport function to(info: modes.ParameterInformation): types.ParameterInformation {\n\t\treturn {\n\t\t\tlabel: info.label,\n\t\t\tdocumentation: htmlContent.isMarkdownString(info.documentation) ? MarkdownString.to(info.documentation) : info.documentation\n\t\t};\n\t}\n}\n\nexport namespace SignatureInformation {\n\n\texport function from(info: types.SignatureInformation): modes.SignatureInformation {\n\t\treturn {\n\t\t\tlabel: info.label,\n\t\t\tdocumentation: info.documentation ? MarkdownString.fromStrict(info.documentation) : undefined,\n\t\t\tparameters: Array.isArray(info.parameters) ? info.parameters.map(ParameterInformation.from) : [],\n\t\t\tactiveParameter: info.activeParameter,\n\t\t};\n\t}\n\n\texport function to(info: modes.SignatureInformation): types.SignatureInformation {\n\t\treturn {\n\t\t\tlabel: info.label,\n\t\t\tdocumentation: htmlContent.isMarkdownString(info.documentation) ? MarkdownString.to(info.documentation) : info.documentation,\n\t\t\tparameters: Array.isArray(info.parameters) ? info.parameters.map(ParameterInformation.to) : [],\n\t\t\tactiveParameter: info.activeParameter,\n\t\t};\n\t}\n}\n\nexport namespace SignatureHelp {\n\n\texport function from(help: types.SignatureHelp): modes.SignatureHelp {\n\t\treturn {\n\t\t\tactiveSignature: help.activeSignature,\n\t\t\tactiveParameter: help.activeParameter,\n\t\t\tsignatures: Array.isArray(help.signatures) ? help.signatures.map(SignatureInformation.from) : [],\n\t\t};\n\t}\n\n\texport function to(help: modes.SignatureHelp): types.SignatureHelp {\n\t\treturn {\n\t\t\tactiveSignature: help.activeSignature,\n\t\t\tactiveParameter: help.activeParameter,\n\t\t\tsignatures: Array.isArray(help.signatures) ? help.signatures.map(SignatureInformation.to) : [],\n\t\t};\n\t}\n}\n\nexport namespace InlineHint {\n\n\texport function from(hint: vscode.InlineHint): modes.InlineHint {\n\t\treturn {\n\t\t\ttext: hint.text,\n\t\t\trange: Range.from(hint.range),\n\t\t\tdescription: hint.description && MarkdownString.fromStrict(hint.description),\n\t\t\twhitespaceBefore: hint.whitespaceBefore,\n\t\t\twhitespaceAfter: hint.whitespaceAfter\n\t\t};\n\t}\n\n\texport function to(hint: modes.InlineHint): vscode.InlineHint {\n\t\treturn new types.InlineHint(\n\t\t\thint.text,\n\t\t\tRange.to(hint.range),\n\t\t\thtmlContent.isMarkdownString(hint.description) ? MarkdownString.to(hint.description) : hint.description,\n\t\t\thint.whitespaceBefore,\n\t\t\thint.whitespaceAfter\n\t\t);\n\t}\n}\n\nexport namespace DocumentLink {\n\n\texport function from(link: vscode.DocumentLink): modes.ILink {\n\t\treturn {\n\t\t\trange: Range.from(link.range),\n\t\t\turl: link.target,\n\t\t\ttooltip: link.tooltip\n\t\t};\n\t}\n\n\texport function to(link: modes.ILink): vscode.DocumentLink {\n\t\tlet target: URI | undefined = undefined;\n\t\tif (link.url) {\n\t\t\ttry {\n\t\t\t\ttarget = typeof link.url === 'string' ? URI.parse(link.url, true) : URI.revive(link.url);\n\t\t\t} catch (err) {\n\t\t\t\t// ignore\n\t\t\t}\n\t\t}\n\t\treturn new types.DocumentLink(Range.to(link.range), target);\n\t}\n}\n\nexport namespace ColorPresentation {\n\texport function to(colorPresentation: modes.IColorPresentation): types.ColorPresentation {\n\t\tconst cp = new types.ColorPresentation(colorPresentation.label);\n\t\tif (colorPresentation.textEdit) {\n\t\t\tcp.textEdit = TextEdit.to(colorPresentation.textEdit);\n\t\t}\n\t\tif (colorPresentation.additionalTextEdits) {\n\t\t\tcp.additionalTextEdits = colorPresentation.additionalTextEdits.map(value => TextEdit.to(value));\n\t\t}\n\t\treturn cp;\n\t}\n\n\texport function from(colorPresentation: vscode.ColorPresentation): modes.IColorPresentation {\n\t\treturn {\n\t\t\tlabel: colorPresentation.label,\n\t\t\ttextEdit: colorPresentation.textEdit ? TextEdit.from(colorPresentation.textEdit) : undefined,\n\t\t\tadditionalTextEdits: colorPresentation.additionalTextEdits ? colorPresentation.additionalTextEdits.map(value => TextEdit.from(value)) : undefined\n\t\t};\n\t}\n}\n\nexport namespace Color {\n\texport function to(c: [number, number, number, number]): types.Color {\n\t\treturn new types.Color(c[0], c[1], c[2], c[3]);\n\t}\n\texport function from(color: types.Color): [number, number, number, number] {\n\t\treturn [color.red, color.green, color.blue, color.alpha];\n\t}\n}\n\n\nexport namespace SelectionRange {\n\texport function from(obj: vscode.SelectionRange): modes.SelectionRange {\n\t\treturn { range: Range.from(obj.range) };\n\t}\n\n\texport function to(obj: modes.SelectionRange): vscode.SelectionRange {\n\t\treturn new types.SelectionRange(Range.to(obj.range));\n\t}\n}\n\nexport namespace TextDocumentSaveReason {\n\n\texport function to(reason: SaveReason): vscode.TextDocumentSaveReason {\n\t\tswitch (reason) {\n\t\t\tcase SaveReason.AUTO:\n\t\t\t\treturn types.TextDocumentSaveReason.AfterDelay;\n\t\t\tcase SaveReason.EXPLICIT:\n\t\t\t\treturn types.TextDocumentSaveReason.Manual;\n\t\t\tcase SaveReason.FOCUS_CHANGE:\n\t\t\tcase SaveReason.WINDOW_CHANGE:\n\t\t\t\treturn types.TextDocumentSaveReason.FocusOut;\n\t\t}\n\t}\n}\n\nexport namespace TextEditorLineNumbersStyle {\n\texport function from(style: vscode.TextEditorLineNumbersStyle): RenderLineNumbersType {\n\t\tswitch (style) {\n\t\t\tcase types.TextEditorLineNumbersStyle.Off:\n\t\t\t\treturn RenderLineNumbersType.Off;\n\t\t\tcase types.TextEditorLineNumbersStyle.Relative:\n\t\t\t\treturn RenderLineNumbersType.Relative;\n\t\t\tcase types.TextEditorLineNumbersStyle.On:\n\t\t\tdefault:\n\t\t\t\treturn RenderLineNumbersType.On;\n\t\t}\n\t}\n\texport function to(style: RenderLineNumbersType): vscode.TextEditorLineNumbersStyle {\n\t\tswitch (style) {\n\t\t\tcase RenderLineNumbersType.Off:\n\t\t\t\treturn types.TextEditorLineNumbersStyle.Off;\n\t\t\tcase RenderLineNumbersType.Relative:\n\t\t\t\treturn types.TextEditorLineNumbersStyle.Relative;\n\t\t\tcase RenderLineNumbersType.On:\n\t\t\tdefault:\n\t\t\t\treturn types.TextEditorLineNumbersStyle.On;\n\t\t}\n\t}\n}\n\nexport namespace EndOfLine {\n\n\texport function from(eol: vscode.EndOfLine): EndOfLineSequence | undefined {\n\t\tif (eol === types.EndOfLine.CRLF) {\n\t\t\treturn EndOfLineSequence.CRLF;\n\t\t} else if (eol === types.EndOfLine.LF) {\n\t\t\treturn EndOfLineSequence.LF;\n\t\t}\n\t\treturn undefined;\n\t}\n\n\texport function to(eol: EndOfLineSequence): vscode.EndOfLine | undefined {\n\t\tif (eol === EndOfLineSequence.CRLF) {\n\t\t\treturn types.EndOfLine.CRLF;\n\t\t} else if (eol === EndOfLineSequence.LF) {\n\t\t\treturn types.EndOfLine.LF;\n\t\t}\n\t\treturn undefined;\n\t}\n}\n\nexport namespace ProgressLocation {\n\texport function from(loc: vscode.ProgressLocation | { viewId: string }): MainProgressLocation | string {\n\t\tif (typeof loc === 'object') {\n\t\t\treturn loc.viewId;\n\t\t}\n\n\t\tswitch (loc) {\n\t\t\tcase types.ProgressLocation.SourceControl: return MainProgressLocation.Scm;\n\t\t\tcase types.ProgressLocation.Window: return MainProgressLocation.Window;\n\t\t\tcase types.ProgressLocation.Notification: return MainProgressLocation.Notification;\n\t\t}\n\t\tthrow new Error(`Unknown 'ProgressLocation'`);\n\t}\n}\n\nexport namespace FoldingRange {\n\texport function from(r: vscode.FoldingRange): modes.FoldingRange {\n\t\tconst range: modes.FoldingRange = { start: r.start + 1, end: r.end + 1 };\n\t\tif (r.kind) {\n\t\t\trange.kind = FoldingRangeKind.from(r.kind);\n\t\t}\n\t\treturn range;\n\t}\n}\n\nexport namespace FoldingRangeKind {\n\texport function from(kind: vscode.FoldingRangeKind | undefined): modes.FoldingRangeKind | undefined {\n\t\tif (kind) {\n\t\t\tswitch (kind) {\n\t\t\t\tcase types.FoldingRangeKind.Comment:\n\t\t\t\t\treturn modes.FoldingRangeKind.Comment;\n\t\t\t\tcase types.FoldingRangeKind.Imports:\n\t\t\t\t\treturn modes.FoldingRangeKind.Imports;\n\t\t\t\tcase types.FoldingRangeKind.Region:\n\t\t\t\t\treturn modes.FoldingRangeKind.Region;\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n}\n\nexport interface TextEditorOpenOptions extends vscode.TextDocumentShowOptions {\n\tbackground?: boolean;\n\toverride?: boolean;\n}\n\nexport namespace TextEditorOpenOptions {\n\n\texport function from(options?: TextEditorOpenOptions): ITextEditorOptions | undefined {\n\t\tif (options) {\n\t\t\treturn {\n\t\t\t\tpinned: typeof options.preview === 'boolean' ? !options.preview : undefined,\n\t\t\t\tinactive: options.background,\n\t\t\t\tpreserveFocus: options.preserveFocus,\n\t\t\t\tselection: typeof options.selection === 'object' ? Range.from(options.selection) : undefined,\n\t\t\t\toverride: typeof options.override === 'boolean' ? false : undefined\n\t\t\t};\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n}\n\nexport namespace GlobPattern {\n\n\texport function from(pattern: vscode.GlobPattern): string | types.RelativePattern;\n\texport function from(pattern: undefined): undefined;\n\texport function from(pattern: null): null;\n\texport function from(pattern: vscode.GlobPattern | undefined | null): string | types.RelativePattern | undefined | null;\n\texport function from(pattern: vscode.GlobPattern | undefined | null): string | types.RelativePattern | undefined | null {\n\t\tif (pattern instanceof types.RelativePattern) {\n\t\t\treturn pattern;\n\t\t}\n\n\t\tif (typeof pattern === 'string') {\n\t\t\treturn pattern;\n\t\t}\n\n\t\tif (isRelativePattern(pattern)) {\n\t\t\treturn new types.RelativePattern(pattern.base, pattern.pattern);\n\t\t}\n\n\t\treturn pattern; // preserve `undefined` and `null`\n\t}\n\n\tfunction isRelativePattern(obj: any): obj is vscode.RelativePattern {\n\t\tconst rp = obj as vscode.RelativePattern;\n\t\treturn rp && typeof rp.base === 'string' && typeof rp.pattern === 'string';\n\t}\n}\n\nexport namespace LanguageSelector {\n\n\texport function from(selector: undefined): undefined;\n\texport function from(selector: vscode.DocumentSelector): languageSelector.LanguageSelector;\n\texport function from(selector: vscode.DocumentSelector | undefined): languageSelector.LanguageSelector | undefined;\n\texport function from(selector: vscode.DocumentSelector | undefined): languageSelector.LanguageSelector | undefined {\n\t\tif (!selector) {\n\t\t\treturn undefined;\n\t\t} else if (Array.isArray(selector)) {\n\t\t\treturn <languageSelector.LanguageSelector>selector.map(from);\n\t\t} else if (typeof selector === 'string') {\n\t\t\treturn selector;\n\t\t} else {\n\t\t\treturn <languageSelector.LanguageFilter>{\n\t\t\t\tlanguage: selector.language,\n\t\t\t\tscheme: selector.scheme,\n\t\t\t\tpattern: typeof selector.pattern === 'undefined' ? undefined : GlobPattern.from(selector.pattern),\n\t\t\t\texclusive: selector.exclusive\n\t\t\t};\n\t\t}\n\t}\n}\n\nexport namespace NotebookCellOutput {\n\texport function from(output: types.NotebookCellOutput): IDisplayOutput {\n\t\treturn output.toJSON();\n\t}\n}\n\nexport namespace NotebookCellOutputItem {\n\texport function from(output: types.NotebookCellOutputItem): IDisplayOutput {\n\t\treturn {\n\t\t\toutputKind: CellOutputKind.Rich,\n\t\t\tdata: { [output.mime]: output.value },\n\t\t\tmetadata: output.metadata && { custom: output.metadata }\n\t\t};\n\t}\n}\n\nexport namespace NotebookExclusiveDocumentPattern {\n\texport function from(pattern: { include: vscode.GlobPattern | undefined, exclude: vscode.GlobPattern | undefined }): { include: string | types.RelativePattern | undefined, exclude: string | types.RelativePattern | undefined };\n\texport function from(pattern: vscode.GlobPattern): string | types.RelativePattern;\n\texport function from(pattern: undefined): undefined;\n\texport function from(pattern: { include: vscode.GlobPattern | undefined | null, exclude: vscode.GlobPattern | undefined } | vscode.GlobPattern | undefined): string | types.RelativePattern | { include: string | types.RelativePattern | undefined, exclude: string | types.RelativePattern | undefined } | undefined;\n\texport function from(pattern: { include: vscode.GlobPattern | undefined | null, exclude: vscode.GlobPattern | undefined } | vscode.GlobPattern | undefined): string | types.RelativePattern | { include: string | types.RelativePattern | undefined, exclude: string | types.RelativePattern | undefined } | undefined {\n\t\tif (pattern === null || pattern === undefined) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (pattern instanceof types.RelativePattern) {\n\t\t\treturn pattern;\n\t\t}\n\n\t\tif (typeof pattern === 'string') {\n\t\t\treturn pattern;\n\t\t}\n\n\n\t\tif (isRelativePattern(pattern)) {\n\t\t\treturn new types.RelativePattern(pattern.base, pattern.pattern);\n\t\t}\n\n\t\tif (isExclusivePattern(pattern)) {\n\t\t\treturn {\n\t\t\t\tinclude: GlobPattern.from(pattern.include) || undefined,\n\t\t\t\texclude: GlobPattern.from(pattern.exclude) || undefined\n\t\t\t};\n\t\t}\n\n\t\treturn undefined; // preserve `undefined`\n\n\t}\n\n\texport function to(pattern: string | types.RelativePattern | { include: string | types.RelativePattern, exclude: string | types.RelativePattern }): { include: vscode.GlobPattern, exclude: vscode.GlobPattern } | vscode.GlobPattern {\n\t\tif (typeof pattern === 'string') {\n\t\t\treturn pattern;\n\t\t}\n\n\t\tif (isRelativePattern(pattern)) {\n\t\t\treturn {\n\t\t\t\tbase: pattern.base,\n\t\t\t\tpattern: pattern.pattern\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tinclude: pattern.include,\n\t\t\texclude: pattern.exclude\n\t\t};\n\t}\n\n\tfunction isExclusivePattern(obj: any): obj is { include: types.RelativePattern | undefined | null, exclude: types.RelativePattern | undefined | null } {\n\t\tconst ep = obj as { include: vscode.GlobPattern, exclude: vscode.GlobPattern };\n\t\tconst include = GlobPattern.from(ep.include);\n\t\tif (!(include && include instanceof types.RelativePattern || typeof include === 'string')) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst exclude = GlobPattern.from(ep.exclude);\n\t\tif (!(exclude && exclude instanceof types.RelativePattern || typeof exclude === 'string')) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tfunction isRelativePattern(obj: any): obj is vscode.RelativePattern {\n\t\tconst rp = obj as vscode.RelativePattern;\n\t\treturn rp && typeof rp.base === 'string' && typeof rp.pattern === 'string';\n\t}\n}\n\nexport namespace NotebookDecorationRenderOptions {\n\texport function from(options: vscode.NotebookDecorationRenderOptions): INotebookDecorationRenderOptions {\n\t\treturn {\n\t\t\tbackgroundColor: <string | types.ThemeColor>options.backgroundColor,\n\t\t\tborderColor: <string | types.ThemeColor>options.borderColor,\n\t\t\ttop: options.top ? ThemableDecorationAttachmentRenderOptions.from(options.top) : undefined\n\t\t};\n\t}\n}\n\nexport namespace TestState {\n\texport function from(item: vscode.TestState): ITestState {\n\t\treturn {\n\t\t\trunState: item.runState,\n\t\t\tduration: item.duration,\n\t\t\tmessages: item.messages.map(message => ({\n\t\t\t\tmessage: MarkdownString.fromStrict(message.message) || '',\n\t\t\t\tseverity: message.severity,\n\t\t\t\texpectedOutput: message.expectedOutput,\n\t\t\t\tactualOutput: message.actualOutput,\n\t\t\t\tlocation: message.location ? location.from(message.location) : undefined,\n\t\t\t})),\n\t\t};\n\t}\n\n\texport function to(item: ITestState): vscode.TestState {\n\t\treturn new types.TestState(\n\t\t\titem.runState,\n\t\t\titem.messages.map(message => ({\n\t\t\t\tmessage: typeof message.message === 'string' ? message.message : MarkdownString.to(message.message),\n\t\t\t\tseverity: message.severity,\n\t\t\t\texpectedOutput: message.expectedOutput,\n\t\t\t\tactualOutput: message.actualOutput,\n\t\t\t\tlocation: message.location && location.to({\n\t\t\t\t\trange: message.location.range,\n\t\t\t\t\turi: URI.revive(message.location.uri)\n\t\t\t\t}),\n\t\t\t})),\n\t\t\titem.duration,\n\t\t);\n\t}\n}\n\n\nexport namespace TestItem {\n\texport function from(item: vscode.TestItem, parentExtId?: string): ITestItem {\n\t\treturn {\n\t\t\textId: item.id ?? (parentExtId ? `${parentExtId}\\0${item.label}` : item.label),\n\t\t\tlabel: item.label,\n\t\t\tlocation: item.location ? location.from(item.location) : undefined,\n\t\t\tdebuggable: item.debuggable ?? false,\n\t\t\tdescription: item.description,\n\t\t\trunnable: item.runnable ?? true,\n\t\t\tstate: TestState.from(item.state),\n\t\t};\n\t}\n\n\texport function toShallow(item: ITestItem): Omit<vscode.RequiredTestItem, 'children'> {\n\t\treturn {\n\t\t\tid: item.extId,\n\t\t\tlabel: item.label,\n\t\t\tlocation: item.location && location.to({\n\t\t\t\trange: item.location.range,\n\t\t\t\turi: URI.revive(item.location.uri)\n\t\t\t}),\n\t\t\tdebuggable: item.debuggable,\n\t\t\tdescription: item.description,\n\t\t\trunnable: item.runnable,\n\t\t\tstate: TestState.to(item.state),\n\t\t};\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Event } from 'vs/base/common/event';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { illegalState } from 'vs/base/common/errors';\nimport { ExtHostDocumentSaveParticipantShape, IWorkspaceEditDto, WorkspaceEditType, MainThreadBulkEditsShape } from 'vs/workbench/api/common/extHost.protocol';\nimport { TextEdit } from 'vs/workbench/api/common/extHostTypes';\nimport { Range, TextDocumentSaveReason, EndOfLine } from 'vs/workbench/api/common/extHostTypeConverters';\nimport { ExtHostDocuments } from 'vs/workbench/api/common/extHostDocuments';\nimport { SaveReason } from 'vs/workbench/common/editor';\nimport type * as vscode from 'vscode';\nimport { LinkedList } from 'vs/base/common/linkedList';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { IExtensionDescription } from 'vs/platform/extensions/common/extensions';\n\ntype Listener = [Function, any, IExtensionDescription];\n\nexport class ExtHostDocumentSaveParticipant implements ExtHostDocumentSaveParticipantShape {\n\n\tprivate readonly _callbacks = new LinkedList<Listener>();\n\tprivate readonly _badListeners = new WeakMap<Function, number>();\n\n\tconstructor(\n\t\tprivate readonly _logService: ILogService,\n\t\tprivate readonly _documents: ExtHostDocuments,\n\t\tprivate readonly _mainThreadBulkEdits: MainThreadBulkEditsShape,\n\t\tprivate readonly _thresholds: { timeout: number; errors: number; } = { timeout: 1500, errors: 3 }\n\t) {\n\t\t//\n\t}\n\n\tdispose(): void {\n\t\tthis._callbacks.clear();\n\t}\n\n\tgetOnWillSaveTextDocumentEvent(extension: IExtensionDescription): Event<vscode.TextDocumentWillSaveEvent> {\n\t\treturn (listener, thisArg, disposables) => {\n\t\t\tconst remove = this._callbacks.push([listener, thisArg, extension]);\n\t\t\tconst result = { dispose: remove };\n\t\t\tif (Array.isArray(disposables)) {\n\t\t\t\tdisposables.push(result);\n\t\t\t}\n\t\t\treturn result;\n\t\t};\n\t}\n\n\tasync $participateInSave(data: UriComponents, reason: SaveReason): Promise<boolean[]> {\n\t\tconst resource = URI.revive(data);\n\n\t\tlet didTimeout = false;\n\t\tconst didTimeoutHandle = setTimeout(() => didTimeout = true, this._thresholds.timeout);\n\n\t\tconst results: boolean[] = [];\n\t\ttry {\n\t\t\tfor (let listener of [...this._callbacks]) { // copy to prevent concurrent modifications\n\t\t\t\tif (didTimeout) {\n\t\t\t\t\t// timeout - no more listeners\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tconst document = this._documents.getDocument(resource);\n\t\t\t\tconst success = await this._deliverEventAsyncAndBlameBadListeners(listener, <any>{ document, reason: TextDocumentSaveReason.to(reason) });\n\t\t\t\tresults.push(success);\n\t\t\t}\n\t\t} finally {\n\t\t\tclearTimeout(didTimeoutHandle);\n\t\t}\n\t\treturn results;\n\t}\n\n\tprivate _deliverEventAsyncAndBlameBadListeners([listener, thisArg, extension]: Listener, stubEvent: vscode.TextDocumentWillSaveEvent): Promise<any> {\n\t\tconst errors = this._badListeners.get(listener);\n\t\tif (typeof errors === 'number' && errors > this._thresholds.errors) {\n\t\t\t// bad listener - ignore\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\n\t\treturn this._deliverEventAsync(extension, listener, thisArg, stubEvent).then(() => {\n\t\t\t// don't send result across the wire\n\t\t\treturn true;\n\n\t\t}, err => {\n\n\t\t\tthis._logService.error(`onWillSaveTextDocument-listener from extension '${extension.identifier.value}' threw ERROR`);\n\t\t\tthis._logService.error(err);\n\n\t\t\tif (!(err instanceof Error) || (<Error>err).message !== 'concurrent_edits') {\n\t\t\t\tconst errors = this._badListeners.get(listener);\n\t\t\t\tthis._badListeners.set(listener, !errors ? 1 : errors + 1);\n\n\t\t\t\tif (typeof errors === 'number' && errors > this._thresholds.errors) {\n\t\t\t\t\tthis._logService.info(`onWillSaveTextDocument-listener from extension '${extension.identifier.value}' will now be IGNORED because of timeouts and/or errors`);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tprivate _deliverEventAsync(extension: IExtensionDescription, listener: Function, thisArg: any, stubEvent: vscode.TextDocumentWillSaveEvent): Promise<any> {\n\n\t\tconst promises: Promise<vscode.TextEdit[]>[] = [];\n\n\t\tconst t1 = Date.now();\n\t\tconst { document, reason } = stubEvent;\n\t\tconst { version } = document;\n\n\t\tconst event = Object.freeze(<vscode.TextDocumentWillSaveEvent>{\n\t\t\tdocument,\n\t\t\treason,\n\t\t\twaitUntil(p: Promise<any | vscode.TextEdit[]>) {\n\t\t\t\tif (Object.isFrozen(promises)) {\n\t\t\t\t\tthrow illegalState('waitUntil can not be called async');\n\t\t\t\t}\n\t\t\t\tpromises.push(Promise.resolve(p));\n\t\t\t}\n\t\t});\n\n\t\ttry {\n\t\t\t// fire event\n\t\t\tlistener.apply(thisArg, [event]);\n\t\t} catch (err) {\n\t\t\treturn Promise.reject(err);\n\t\t}\n\n\t\t// freeze promises after event call\n\t\tObject.freeze(promises);\n\n\t\treturn new Promise<vscode.TextEdit[][]>((resolve, reject) => {\n\t\t\t// join on all listener promises, reject after timeout\n\t\t\tconst handle = setTimeout(() => reject(new Error('timeout')), this._thresholds.timeout);\n\n\t\t\treturn Promise.all(promises).then(edits => {\n\t\t\t\tthis._logService.debug(`onWillSaveTextDocument-listener from extension '${extension.identifier.value}' finished after ${(Date.now() - t1)}ms`);\n\t\t\t\tclearTimeout(handle);\n\t\t\t\tresolve(edits);\n\t\t\t}).catch(err => {\n\t\t\t\tclearTimeout(handle);\n\t\t\t\treject(err);\n\t\t\t});\n\n\t\t}).then(values => {\n\t\t\tconst dto: IWorkspaceEditDto = { edits: [] };\n\t\t\tfor (const value of values) {\n\t\t\t\tif (Array.isArray(value) && (<vscode.TextEdit[]>value).every(e => e instanceof TextEdit)) {\n\t\t\t\t\tfor (const { newText, newEol, range } of value) {\n\t\t\t\t\t\tdto.edits.push({\n\t\t\t\t\t\t\t_type: WorkspaceEditType.Text,\n\t\t\t\t\t\t\tresource: document.uri,\n\t\t\t\t\t\t\tedit: {\n\t\t\t\t\t\t\t\trange: range && Range.from(range),\n\t\t\t\t\t\t\t\ttext: newText,\n\t\t\t\t\t\t\t\teol: newEol && EndOfLine.from(newEol)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// apply edits if any and if document\n\t\t\t// didn't change somehow in the meantime\n\t\t\tif (dto.edits.length === 0) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\tif (version === document.version) {\n\t\t\t\treturn this._mainThreadBulkEdits.$tryApplyWorkspaceEdit(dto);\n\t\t\t}\n\n\t\t\treturn Promise.reject(new Error('concurrent_edits'));\n\t\t});\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { AsyncEmitter, Emitter, Event, IWaitUntil } from 'vs/base/common/event';\nimport { IRelativePattern, parse } from 'vs/base/common/glob';\nimport { URI } from 'vs/base/common/uri';\nimport { ExtHostDocumentsAndEditors } from 'vs/workbench/api/common/extHostDocumentsAndEditors';\nimport type * as vscode from 'vscode';\nimport { ExtHostFileSystemEventServiceShape, FileSystemEvents, IMainContext, SourceTargetPair, IWorkspaceEditDto, IWillRunFileOperationParticipation } from './extHost.protocol';\nimport * as typeConverter from './extHostTypeConverters';\nimport { Disposable, WorkspaceEdit } from './extHostTypes';\nimport { IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { FileOperation } from 'vs/platform/files/common/files';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { ILogService } from 'vs/platform/log/common/log';\n\nclass FileSystemWatcher implements vscode.FileSystemWatcher {\n\n\tprivate readonly _onDidCreate = new Emitter<vscode.Uri>();\n\tprivate readonly _onDidChange = new Emitter<vscode.Uri>();\n\tprivate readonly _onDidDelete = new Emitter<vscode.Uri>();\n\tprivate _disposable: Disposable;\n\tprivate _config: number;\n\n\tget ignoreCreateEvents(): boolean {\n\t\treturn Boolean(this._config & 0b001);\n\t}\n\n\tget ignoreChangeEvents(): boolean {\n\t\treturn Boolean(this._config & 0b010);\n\t}\n\n\tget ignoreDeleteEvents(): boolean {\n\t\treturn Boolean(this._config & 0b100);\n\t}\n\n\tconstructor(dispatcher: Event<FileSystemEvents>, globPattern: string | IRelativePattern, ignoreCreateEvents?: boolean, ignoreChangeEvents?: boolean, ignoreDeleteEvents?: boolean) {\n\n\t\tthis._config = 0;\n\t\tif (ignoreCreateEvents) {\n\t\t\tthis._config += 0b001;\n\t\t}\n\t\tif (ignoreChangeEvents) {\n\t\t\tthis._config += 0b010;\n\t\t}\n\t\tif (ignoreDeleteEvents) {\n\t\t\tthis._config += 0b100;\n\t\t}\n\n\t\tconst parsedPattern = parse(globPattern);\n\n\t\tconst subscription = dispatcher(events => {\n\t\t\tif (!ignoreCreateEvents) {\n\t\t\t\tfor (let created of events.created) {\n\t\t\t\t\tconst uri = URI.revive(created);\n\t\t\t\t\tif (parsedPattern(uri.fsPath)) {\n\t\t\t\t\t\tthis._onDidCreate.fire(uri);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!ignoreChangeEvents) {\n\t\t\t\tfor (let changed of events.changed) {\n\t\t\t\t\tconst uri = URI.revive(changed);\n\t\t\t\t\tif (parsedPattern(uri.fsPath)) {\n\t\t\t\t\t\tthis._onDidChange.fire(uri);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!ignoreDeleteEvents) {\n\t\t\t\tfor (let deleted of events.deleted) {\n\t\t\t\t\tconst uri = URI.revive(deleted);\n\t\t\t\t\tif (parsedPattern(uri.fsPath)) {\n\t\t\t\t\t\tthis._onDidDelete.fire(uri);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis._disposable = Disposable.from(this._onDidCreate, this._onDidChange, this._onDidDelete, subscription);\n\t}\n\n\tdispose() {\n\t\tthis._disposable.dispose();\n\t}\n\n\tget onDidCreate(): Event<vscode.Uri> {\n\t\treturn this._onDidCreate.event;\n\t}\n\n\tget onDidChange(): Event<vscode.Uri> {\n\t\treturn this._onDidChange.event;\n\t}\n\n\tget onDidDelete(): Event<vscode.Uri> {\n\t\treturn this._onDidDelete.event;\n\t}\n}\n\ninterface IExtensionListener<E> {\n\textension: IExtensionDescription;\n\t(e: E): any;\n}\n\nexport class ExtHostFileSystemEventService implements ExtHostFileSystemEventServiceShape {\n\n\tprivate readonly _onFileSystemEvent = new Emitter<FileSystemEvents>();\n\n\tprivate readonly _onDidRenameFile = new Emitter<vscode.FileRenameEvent>();\n\tprivate readonly _onDidCreateFile = new Emitter<vscode.FileCreateEvent>();\n\tprivate readonly _onDidDeleteFile = new Emitter<vscode.FileDeleteEvent>();\n\tprivate readonly _onWillRenameFile = new AsyncEmitter<vscode.FileWillRenameEvent>();\n\tprivate readonly _onWillCreateFile = new AsyncEmitter<vscode.FileWillCreateEvent>();\n\tprivate readonly _onWillDeleteFile = new AsyncEmitter<vscode.FileWillDeleteEvent>();\n\n\treadonly onDidRenameFile: Event<vscode.FileRenameEvent> = this._onDidRenameFile.event;\n\treadonly onDidCreateFile: Event<vscode.FileCreateEvent> = this._onDidCreateFile.event;\n\treadonly onDidDeleteFile: Event<vscode.FileDeleteEvent> = this._onDidDeleteFile.event;\n\n\n\tconstructor(\n\t\tmainContext: IMainContext,\n\t\tprivate readonly _logService: ILogService,\n\t\tprivate readonly _extHostDocumentsAndEditors: ExtHostDocumentsAndEditors\n\t) {\n\t\t//\n\t}\n\n\t//--- file events\n\n\tcreateFileSystemWatcher(globPattern: string | IRelativePattern, ignoreCreateEvents?: boolean, ignoreChangeEvents?: boolean, ignoreDeleteEvents?: boolean): vscode.FileSystemWatcher {\n\t\treturn new FileSystemWatcher(this._onFileSystemEvent.event, globPattern, ignoreCreateEvents, ignoreChangeEvents, ignoreDeleteEvents);\n\t}\n\n\t$onFileEvent(events: FileSystemEvents) {\n\t\tthis._onFileSystemEvent.fire(events);\n\t}\n\n\n\t//--- file operations\n\n\t$onDidRunFileOperation(operation: FileOperation, files: SourceTargetPair[]): void {\n\t\tswitch (operation) {\n\t\t\tcase FileOperation.MOVE:\n\t\t\t\tthis._onDidRenameFile.fire(Object.freeze({ files: files.map(f => ({ oldUri: URI.revive(f.source!), newUri: URI.revive(f.target) })) }));\n\t\t\t\tbreak;\n\t\t\tcase FileOperation.DELETE:\n\t\t\t\tthis._onDidDeleteFile.fire(Object.freeze({ files: files.map(f => URI.revive(f.target)) }));\n\t\t\t\tbreak;\n\t\t\tcase FileOperation.CREATE:\n\t\t\t\tthis._onDidCreateFile.fire(Object.freeze({ files: files.map(f => URI.revive(f.target)) }));\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t//ignore, dont send\n\t\t}\n\t}\n\n\n\tgetOnWillRenameFileEvent(extension: IExtensionDescription): Event<vscode.FileWillRenameEvent> {\n\t\treturn this._createWillExecuteEvent(extension, this._onWillRenameFile);\n\t}\n\n\tgetOnWillCreateFileEvent(extension: IExtensionDescription): Event<vscode.FileWillCreateEvent> {\n\t\treturn this._createWillExecuteEvent(extension, this._onWillCreateFile);\n\t}\n\n\tgetOnWillDeleteFileEvent(extension: IExtensionDescription): Event<vscode.FileWillDeleteEvent> {\n\t\treturn this._createWillExecuteEvent(extension, this._onWillDeleteFile);\n\t}\n\n\tprivate _createWillExecuteEvent<E extends IWaitUntil>(extension: IExtensionDescription, emitter: AsyncEmitter<E>): Event<E> {\n\t\treturn (listener, thisArg, disposables) => {\n\t\t\tconst wrappedListener: IExtensionListener<E> = function wrapped(e: E) { listener.call(thisArg, e); };\n\t\t\twrappedListener.extension = extension;\n\t\t\treturn emitter.event(wrappedListener, undefined, disposables);\n\t\t};\n\t}\n\n\tasync $onWillRunFileOperation(operation: FileOperation, files: SourceTargetPair[], timeout: number, token: CancellationToken): Promise<IWillRunFileOperationParticipation | undefined> {\n\t\tswitch (operation) {\n\t\t\tcase FileOperation.MOVE:\n\t\t\t\treturn await this._fireWillEvent(this._onWillRenameFile, { files: files.map(f => ({ oldUri: URI.revive(f.source!), newUri: URI.revive(f.target) })) }, timeout, token);\n\t\t\tcase FileOperation.DELETE:\n\t\t\t\treturn await this._fireWillEvent(this._onWillDeleteFile, { files: files.map(f => URI.revive(f.target)) }, timeout, token);\n\t\t\tcase FileOperation.CREATE:\n\t\t\t\treturn await this._fireWillEvent(this._onWillCreateFile, { files: files.map(f => URI.revive(f.target)) }, timeout, token);\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate async _fireWillEvent<E extends IWaitUntil>(emitter: AsyncEmitter<E>, data: Omit<E, 'waitUntil'>, timeout: number, token: CancellationToken): Promise<IWillRunFileOperationParticipation | undefined> {\n\n\t\tconst extensionNames = new Set<string>();\n\t\tconst edits: WorkspaceEdit[] = [];\n\n\t\tawait emitter.fireAsync(data, token, async (thenable, listener) => {\n\t\t\t// ignore all results except for WorkspaceEdits. Those are stored in an array.\n\t\t\tconst now = Date.now();\n\t\t\tconst result = await Promise.resolve(thenable);\n\t\t\tif (result instanceof WorkspaceEdit) {\n\t\t\t\tedits.push(result);\n\t\t\t\textensionNames.add((<IExtensionListener<E>>listener).extension.displayName ?? (<IExtensionListener<E>>listener).extension.identifier.value);\n\t\t\t}\n\n\t\t\tif (Date.now() - now > timeout) {\n\t\t\t\tthis._logService.warn('SLOW file-participant', (<IExtensionListener<E>>listener).extension.identifier);\n\t\t\t}\n\t\t});\n\n\t\tif (token.isCancellationRequested) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (edits.length === 0) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// concat all WorkspaceEdits collected via waitUntil-call and send them over to the renderer\n\t\tconst dto: IWorkspaceEditDto = { edits: [] };\n\t\tfor (let edit of edits) {\n\t\t\tlet { edits } = typeConverter.WorkspaceEdit.from(edit, this._extHostDocumentsAndEditors);\n\t\t\tdto.edits = dto.edits.concat(edits);\n\t\t}\n\t\treturn { edit: dto, extensionNames: Array.from(extensionNames) };\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ProgressOptions } from 'vscode';\nimport { MainThreadProgressShape, ExtHostProgressShape } from './extHost.protocol';\nimport { ProgressLocation } from './extHostTypeConverters';\nimport { Progress, IProgressStep } from 'vs/platform/progress/common/progress';\nimport { localize } from 'vs/nls';\nimport { CancellationTokenSource, CancellationToken } from 'vs/base/common/cancellation';\nimport { throttle } from 'vs/base/common/decorators';\nimport { IExtensionDescription } from 'vs/platform/extensions/common/extensions';\n\nexport class ExtHostProgress implements ExtHostProgressShape {\n\n\tprivate _proxy: MainThreadProgressShape;\n\tprivate _handles: number = 0;\n\tprivate _mapHandleToCancellationSource: Map<number, CancellationTokenSource> = new Map();\n\n\tconstructor(proxy: MainThreadProgressShape) {\n\t\tthis._proxy = proxy;\n\t}\n\n\twithProgress<R>(extension: IExtensionDescription, options: ProgressOptions, task: (progress: Progress<IProgressStep>, token: CancellationToken) => Thenable<R>): Thenable<R> {\n\t\tconst handle = this._handles++;\n\t\tconst { title, location, cancellable } = options;\n\t\tconst source = localize('extensionSource', \"{0} (Extension)\", extension.displayName || extension.name);\n\n\t\tthis._proxy.$startProgress(handle, { location: ProgressLocation.from(location), title, source, cancellable }, extension);\n\t\treturn this._withProgress(handle, task, !!cancellable);\n\t}\n\n\tprivate _withProgress<R>(handle: number, task: (progress: Progress<IProgressStep>, token: CancellationToken) => Thenable<R>, cancellable: boolean): Thenable<R> {\n\t\tlet source: CancellationTokenSource | undefined;\n\t\tif (cancellable) {\n\t\t\tsource = new CancellationTokenSource();\n\t\t\tthis._mapHandleToCancellationSource.set(handle, source);\n\t\t}\n\n\t\tconst progressEnd = (handle: number): void => {\n\t\t\tthis._proxy.$progressEnd(handle);\n\t\t\tthis._mapHandleToCancellationSource.delete(handle);\n\t\t\tif (source) {\n\t\t\t\tsource.dispose();\n\t\t\t}\n\t\t};\n\n\t\tlet p: Thenable<R>;\n\n\t\ttry {\n\t\t\tp = task(new ProgressCallback(this._proxy, handle), cancellable && source ? source.token : CancellationToken.None);\n\t\t} catch (err) {\n\t\t\tprogressEnd(handle);\n\t\t\tthrow err;\n\t\t}\n\n\t\tp.then(result => progressEnd(handle), err => progressEnd(handle));\n\t\treturn p;\n\t}\n\n\tpublic $acceptProgressCanceled(handle: number): void {\n\t\tconst source = this._mapHandleToCancellationSource.get(handle);\n\t\tif (source) {\n\t\t\tsource.cancel();\n\t\t\tthis._mapHandleToCancellationSource.delete(handle);\n\t\t}\n\t}\n}\n\nfunction mergeProgress(result: IProgressStep, currentValue: IProgressStep): IProgressStep {\n\tresult.message = currentValue.message;\n\tif (typeof currentValue.increment === 'number') {\n\t\tif (typeof result.increment === 'number') {\n\t\t\tresult.increment += currentValue.increment;\n\t\t} else {\n\t\t\tresult.increment = currentValue.increment;\n\t\t}\n\t}\n\n\treturn result;\n}\n\nclass ProgressCallback extends Progress<IProgressStep> {\n\tconstructor(private _proxy: MainThreadProgressShape, private _handle: number) {\n\t\tsuper(p => this.throttledReport(p));\n\t}\n\n\t@throttle(100, (result: IProgressStep, currentValue: IProgressStep) => mergeProgress(result, currentValue), () => Object.create(null))\n\tthrottledReport(p: IProgressStep): void {\n\t\tthis._proxy.$progressReport(this._handle, p);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ok } from 'vs/base/common/assert';\nimport { illegalArgument, readonly } from 'vs/base/common/errors';\nimport { IdGenerator } from 'vs/base/common/idGenerator';\nimport { TextEditorCursorStyle } from 'vs/editor/common/config/editorOptions';\nimport { IRange } from 'vs/editor/common/core/range';\nimport { ISingleEditOperation } from 'vs/editor/common/model';\nimport { IResolvedTextEditorConfiguration, ITextEditorConfigurationUpdate, MainThreadTextEditorsShape } from 'vs/workbench/api/common/extHost.protocol';\nimport { ExtHostDocumentData } from 'vs/workbench/api/common/extHostDocumentData';\nimport * as TypeConverters from 'vs/workbench/api/common/extHostTypeConverters';\nimport { EndOfLine, Position, Range, Selection, SnippetString, TextEditorLineNumbersStyle, TextEditorRevealType } from 'vs/workbench/api/common/extHostTypes';\nimport type * as vscode from 'vscode';\nimport { ILogService } from 'vs/platform/log/common/log';\n\nexport class TextEditorDecorationType implements vscode.TextEditorDecorationType {\n\n\tprivate static readonly _Keys = new IdGenerator('TextEditorDecorationType');\n\n\tprivate _proxy: MainThreadTextEditorsShape;\n\tpublic key: string;\n\n\tconstructor(proxy: MainThreadTextEditorsShape, options: vscode.DecorationRenderOptions) {\n\t\tthis.key = TextEditorDecorationType._Keys.nextId();\n\t\tthis._proxy = proxy;\n\t\tthis._proxy.$registerTextEditorDecorationType(this.key, TypeConverters.DecorationRenderOptions.from(options));\n\t}\n\n\tpublic dispose(): void {\n\t\tthis._proxy.$removeTextEditorDecorationType(this.key);\n\t}\n}\n\nexport interface ITextEditOperation {\n\trange: vscode.Range;\n\ttext: string | null;\n\tforceMoveMarkers: boolean;\n}\n\nexport interface IEditData {\n\tdocumentVersionId: number;\n\tedits: ITextEditOperation[];\n\tsetEndOfLine: EndOfLine | undefined;\n\tundoStopBefore: boolean;\n\tundoStopAfter: boolean;\n}\n\nexport class TextEditorEdit {\n\n\tprivate readonly _document: vscode.TextDocument;\n\tprivate readonly _documentVersionId: number;\n\tprivate readonly _undoStopBefore: boolean;\n\tprivate readonly _undoStopAfter: boolean;\n\tprivate _collectedEdits: ITextEditOperation[] = [];\n\tprivate _setEndOfLine: EndOfLine | undefined = undefined;\n\tprivate _finalized: boolean = false;\n\n\tconstructor(document: vscode.TextDocument, options: { undoStopBefore: boolean; undoStopAfter: boolean; }) {\n\t\tthis._document = document;\n\t\tthis._documentVersionId = document.version;\n\t\tthis._undoStopBefore = options.undoStopBefore;\n\t\tthis._undoStopAfter = options.undoStopAfter;\n\t}\n\n\tfinalize(): IEditData {\n\t\tthis._finalized = true;\n\t\treturn {\n\t\t\tdocumentVersionId: this._documentVersionId,\n\t\t\tedits: this._collectedEdits,\n\t\t\tsetEndOfLine: this._setEndOfLine,\n\t\t\tundoStopBefore: this._undoStopBefore,\n\t\t\tundoStopAfter: this._undoStopAfter\n\t\t};\n\t}\n\n\tprivate _throwIfFinalized() {\n\t\tif (this._finalized) {\n\t\t\tthrow new Error('Edit is only valid while callback runs');\n\t\t}\n\t}\n\n\treplace(location: Position | Range | Selection, value: string): void {\n\t\tthis._throwIfFinalized();\n\t\tlet range: Range | null = null;\n\n\t\tif (location instanceof Position) {\n\t\t\trange = new Range(location, location);\n\t\t} else if (location instanceof Range) {\n\t\t\trange = location;\n\t\t} else {\n\t\t\tthrow new Error('Unrecognized location');\n\t\t}\n\n\t\tthis._pushEdit(range, value, false);\n\t}\n\n\tinsert(location: Position, value: string): void {\n\t\tthis._throwIfFinalized();\n\t\tthis._pushEdit(new Range(location, location), value, true);\n\t}\n\n\tdelete(location: Range | Selection): void {\n\t\tthis._throwIfFinalized();\n\t\tlet range: Range | null = null;\n\n\t\tif (location instanceof Range) {\n\t\t\trange = location;\n\t\t} else {\n\t\t\tthrow new Error('Unrecognized location');\n\t\t}\n\n\t\tthis._pushEdit(range, null, true);\n\t}\n\n\tprivate _pushEdit(range: Range, text: string | null, forceMoveMarkers: boolean): void {\n\t\tconst validRange = this._document.validateRange(range);\n\t\tthis._collectedEdits.push({\n\t\t\trange: validRange,\n\t\t\ttext: text,\n\t\t\tforceMoveMarkers: forceMoveMarkers\n\t\t});\n\t}\n\n\tsetEndOfLine(endOfLine: EndOfLine): void {\n\t\tthis._throwIfFinalized();\n\t\tif (endOfLine !== EndOfLine.LF && endOfLine !== EndOfLine.CRLF) {\n\t\t\tthrow illegalArgument('endOfLine');\n\t\t}\n\n\t\tthis._setEndOfLine = endOfLine;\n\t}\n}\n\nexport class ExtHostTextEditorOptions implements vscode.TextEditorOptions {\n\n\tprivate _proxy: MainThreadTextEditorsShape;\n\tprivate _id: string;\n\tprivate _logService: ILogService;\n\n\tprivate _tabSize!: number;\n\tprivate _indentSize!: number;\n\tprivate _insertSpaces!: boolean;\n\tprivate _cursorStyle!: TextEditorCursorStyle;\n\tprivate _lineNumbers!: TextEditorLineNumbersStyle;\n\n\tconstructor(proxy: MainThreadTextEditorsShape, id: string, source: IResolvedTextEditorConfiguration, logService: ILogService) {\n\t\tthis._proxy = proxy;\n\t\tthis._id = id;\n\t\tthis._accept(source);\n\t\tthis._logService = logService;\n\t}\n\n\tpublic _accept(source: IResolvedTextEditorConfiguration): void {\n\t\tthis._tabSize = source.tabSize;\n\t\tthis._indentSize = source.indentSize;\n\t\tthis._insertSpaces = source.insertSpaces;\n\t\tthis._cursorStyle = source.cursorStyle;\n\t\tthis._lineNumbers = TypeConverters.TextEditorLineNumbersStyle.to(source.lineNumbers);\n\t}\n\n\tpublic get tabSize(): number | string {\n\t\treturn this._tabSize;\n\t}\n\n\tprivate _validateTabSize(value: number | string): number | 'auto' | null {\n\t\tif (value === 'auto') {\n\t\t\treturn 'auto';\n\t\t}\n\t\tif (typeof value === 'number') {\n\t\t\tconst r = Math.floor(value);\n\t\t\treturn (r > 0 ? r : null);\n\t\t}\n\t\tif (typeof value === 'string') {\n\t\t\tconst r = parseInt(value, 10);\n\t\t\tif (isNaN(r)) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\treturn (r > 0 ? r : null);\n\t\t}\n\t\treturn null;\n\t}\n\n\tpublic set tabSize(value: number | string) {\n\t\tconst tabSize = this._validateTabSize(value);\n\t\tif (tabSize === null) {\n\t\t\t// ignore invalid call\n\t\t\treturn;\n\t\t}\n\t\tif (typeof tabSize === 'number') {\n\t\t\tif (this._tabSize === tabSize) {\n\t\t\t\t// nothing to do\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// reflect the new tabSize value immediately\n\t\t\tthis._tabSize = tabSize;\n\t\t}\n\t\tthis._warnOnError(this._proxy.$trySetOptions(this._id, {\n\t\t\ttabSize: tabSize\n\t\t}));\n\t}\n\n\tpublic get indentSize(): number | string {\n\t\treturn this._indentSize;\n\t}\n\n\tprivate _validateIndentSize(value: number | string): number | 'tabSize' | null {\n\t\tif (value === 'tabSize') {\n\t\t\treturn 'tabSize';\n\t\t}\n\t\tif (typeof value === 'number') {\n\t\t\tconst r = Math.floor(value);\n\t\t\treturn (r > 0 ? r : null);\n\t\t}\n\t\tif (typeof value === 'string') {\n\t\t\tconst r = parseInt(value, 10);\n\t\t\tif (isNaN(r)) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\treturn (r > 0 ? r : null);\n\t\t}\n\t\treturn null;\n\t}\n\n\tpublic set indentSize(value: number | string) {\n\t\tconst indentSize = this._validateIndentSize(value);\n\t\tif (indentSize === null) {\n\t\t\t// ignore invalid call\n\t\t\treturn;\n\t\t}\n\t\tif (typeof indentSize === 'number') {\n\t\t\tif (this._indentSize === indentSize) {\n\t\t\t\t// nothing to do\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// reflect the new indentSize value immediately\n\t\t\tthis._indentSize = indentSize;\n\t\t}\n\t\tthis._warnOnError(this._proxy.$trySetOptions(this._id, {\n\t\t\tindentSize: indentSize\n\t\t}));\n\t}\n\n\tpublic get insertSpaces(): boolean | string {\n\t\treturn this._insertSpaces;\n\t}\n\n\tprivate _validateInsertSpaces(value: boolean | string): boolean | 'auto' {\n\t\tif (value === 'auto') {\n\t\t\treturn 'auto';\n\t\t}\n\t\treturn (value === 'false' ? false : Boolean(value));\n\t}\n\n\tpublic set insertSpaces(value: boolean | string) {\n\t\tconst insertSpaces = this._validateInsertSpaces(value);\n\t\tif (typeof insertSpaces === 'boolean') {\n\t\t\tif (this._insertSpaces === insertSpaces) {\n\t\t\t\t// nothing to do\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// reflect the new insertSpaces value immediately\n\t\t\tthis._insertSpaces = insertSpaces;\n\t\t}\n\t\tthis._warnOnError(this._proxy.$trySetOptions(this._id, {\n\t\t\tinsertSpaces: insertSpaces\n\t\t}));\n\t}\n\n\tpublic get cursorStyle(): TextEditorCursorStyle {\n\t\treturn this._cursorStyle;\n\t}\n\n\tpublic set cursorStyle(value: TextEditorCursorStyle) {\n\t\tif (this._cursorStyle === value) {\n\t\t\t// nothing to do\n\t\t\treturn;\n\t\t}\n\t\tthis._cursorStyle = value;\n\t\tthis._warnOnError(this._proxy.$trySetOptions(this._id, {\n\t\t\tcursorStyle: value\n\t\t}));\n\t}\n\n\tpublic get lineNumbers(): TextEditorLineNumbersStyle {\n\t\treturn this._lineNumbers;\n\t}\n\n\tpublic set lineNumbers(value: TextEditorLineNumbersStyle) {\n\t\tif (this._lineNumbers === value) {\n\t\t\t// nothing to do\n\t\t\treturn;\n\t\t}\n\t\tthis._lineNumbers = value;\n\t\tthis._warnOnError(this._proxy.$trySetOptions(this._id, {\n\t\t\tlineNumbers: TypeConverters.TextEditorLineNumbersStyle.from(value)\n\t\t}));\n\t}\n\n\tpublic assign(newOptions: vscode.TextEditorOptions) {\n\t\tconst bulkConfigurationUpdate: ITextEditorConfigurationUpdate = {};\n\t\tlet hasUpdate = false;\n\n\t\tif (typeof newOptions.tabSize !== 'undefined') {\n\t\t\tconst tabSize = this._validateTabSize(newOptions.tabSize);\n\t\t\tif (tabSize === 'auto') {\n\t\t\t\thasUpdate = true;\n\t\t\t\tbulkConfigurationUpdate.tabSize = tabSize;\n\t\t\t} else if (typeof tabSize === 'number' && this._tabSize !== tabSize) {\n\t\t\t\t// reflect the new tabSize value immediately\n\t\t\t\tthis._tabSize = tabSize;\n\t\t\t\thasUpdate = true;\n\t\t\t\tbulkConfigurationUpdate.tabSize = tabSize;\n\t\t\t}\n\t\t}\n\n\t\t// if (typeof newOptions.indentSize !== 'undefined') {\n\t\t// \tconst indentSize = this._validateIndentSize(newOptions.indentSize);\n\t\t// \tif (indentSize === 'tabSize') {\n\t\t// \t\thasUpdate = true;\n\t\t// \t\tbulkConfigurationUpdate.indentSize = indentSize;\n\t\t// \t} else if (typeof indentSize === 'number' && this._indentSize !== indentSize) {\n\t\t// \t\t// reflect the new indentSize value immediately\n\t\t// \t\tthis._indentSize = indentSize;\n\t\t// \t\thasUpdate = true;\n\t\t// \t\tbulkConfigurationUpdate.indentSize = indentSize;\n\t\t// \t}\n\t\t// }\n\n\t\tif (typeof newOptions.insertSpaces !== 'undefined') {\n\t\t\tconst insertSpaces = this._validateInsertSpaces(newOptions.insertSpaces);\n\t\t\tif (insertSpaces === 'auto') {\n\t\t\t\thasUpdate = true;\n\t\t\t\tbulkConfigurationUpdate.insertSpaces = insertSpaces;\n\t\t\t} else if (this._insertSpaces !== insertSpaces) {\n\t\t\t\t// reflect the new insertSpaces value immediately\n\t\t\t\tthis._insertSpaces = insertSpaces;\n\t\t\t\thasUpdate = true;\n\t\t\t\tbulkConfigurationUpdate.insertSpaces = insertSpaces;\n\t\t\t}\n\t\t}\n\n\t\tif (typeof newOptions.cursorStyle !== 'undefined') {\n\t\t\tif (this._cursorStyle !== newOptions.cursorStyle) {\n\t\t\t\tthis._cursorStyle = newOptions.cursorStyle;\n\t\t\t\thasUpdate = true;\n\t\t\t\tbulkConfigurationUpdate.cursorStyle = newOptions.cursorStyle;\n\t\t\t}\n\t\t}\n\n\t\tif (typeof newOptions.lineNumbers !== 'undefined') {\n\t\t\tif (this._lineNumbers !== newOptions.lineNumbers) {\n\t\t\t\tthis._lineNumbers = newOptions.lineNumbers;\n\t\t\t\thasUpdate = true;\n\t\t\t\tbulkConfigurationUpdate.lineNumbers = TypeConverters.TextEditorLineNumbersStyle.from(newOptions.lineNumbers);\n\t\t\t}\n\t\t}\n\n\t\tif (hasUpdate) {\n\t\t\tthis._warnOnError(this._proxy.$trySetOptions(this._id, bulkConfigurationUpdate));\n\t\t}\n\t}\n\n\tprivate _warnOnError(promise: Promise<any>): void {\n\t\tpromise.catch(err => this._logService.warn(err));\n\t}\n}\n\nexport class ExtHostTextEditor implements vscode.TextEditor {\n\n\tprivate readonly _documentData: ExtHostDocumentData;\n\n\tprivate _selections: Selection[];\n\tprivate _options: ExtHostTextEditorOptions;\n\tprivate _visibleRanges: Range[];\n\tprivate _viewColumn: vscode.ViewColumn | undefined;\n\tprivate _disposed: boolean = false;\n\tprivate _hasDecorationsForKey: { [key: string]: boolean; };\n\n\tconstructor(\n\t\treadonly id: string,\n\t\tprivate readonly _proxy: MainThreadTextEditorsShape,\n\t\tprivate readonly _logService: ILogService,\n\t\tdocument: ExtHostDocumentData,\n\t\tselections: Selection[], options: IResolvedTextEditorConfiguration,\n\t\tvisibleRanges: Range[], viewColumn: vscode.ViewColumn | undefined\n\t) {\n\t\tthis._documentData = document;\n\t\tthis._selections = selections;\n\t\tthis._options = new ExtHostTextEditorOptions(this._proxy, this.id, options, _logService);\n\t\tthis._visibleRanges = visibleRanges;\n\t\tthis._viewColumn = viewColumn;\n\t\tthis._hasDecorationsForKey = Object.create(null);\n\t}\n\n\tdispose() {\n\t\tok(!this._disposed);\n\t\tthis._disposed = true;\n\t}\n\n\tshow(column: vscode.ViewColumn) {\n\t\tthis._proxy.$tryShowEditor(this.id, TypeConverters.ViewColumn.from(column));\n\t}\n\n\thide() {\n\t\tthis._proxy.$tryHideEditor(this.id);\n\t}\n\n\t// ---- the document\n\n\tget document(): vscode.TextDocument {\n\t\treturn this._documentData.document;\n\t}\n\n\tset document(value) {\n\t\tthrow readonly('document');\n\t}\n\n\t// ---- options\n\n\tget options(): vscode.TextEditorOptions {\n\t\treturn this._options;\n\t}\n\n\tset options(value: vscode.TextEditorOptions) {\n\t\tif (!this._disposed) {\n\t\t\tthis._options.assign(value);\n\t\t}\n\t}\n\n\t_acceptOptions(options: IResolvedTextEditorConfiguration): void {\n\t\tok(!this._disposed);\n\t\tthis._options._accept(options);\n\t}\n\n\t// ---- visible ranges\n\n\tget visibleRanges(): Range[] {\n\t\treturn this._visibleRanges;\n\t}\n\n\tset visibleRanges(value: Range[]) {\n\t\tthrow readonly('visibleRanges');\n\t}\n\n\t_acceptVisibleRanges(value: Range[]): void {\n\t\tok(!this._disposed);\n\t\tthis._visibleRanges = value;\n\t}\n\n\t// ---- view column\n\n\tget viewColumn(): vscode.ViewColumn | undefined {\n\t\treturn this._viewColumn;\n\t}\n\n\tset viewColumn(value) {\n\t\tthrow readonly('viewColumn');\n\t}\n\n\t_acceptViewColumn(value: vscode.ViewColumn) {\n\t\tok(!this._disposed);\n\t\tthis._viewColumn = value;\n\t}\n\n\t// ---- selections\n\n\tget selection(): Selection {\n\t\treturn this._selections && this._selections[0];\n\t}\n\n\tset selection(value: Selection) {\n\t\tif (!(value instanceof Selection)) {\n\t\t\tthrow illegalArgument('selection');\n\t\t}\n\t\tthis._selections = [value];\n\t\tthis._trySetSelection();\n\t}\n\n\tget selections(): Selection[] {\n\t\treturn this._selections;\n\t}\n\n\tset selections(value: Selection[]) {\n\t\tif (!Array.isArray(value) || value.some(a => !(a instanceof Selection))) {\n\t\t\tthrow illegalArgument('selections');\n\t\t}\n\t\tthis._selections = value;\n\t\tthis._trySetSelection();\n\t}\n\n\tsetDecorations(decorationType: vscode.TextEditorDecorationType, ranges: Range[] | vscode.DecorationOptions[]): void {\n\t\tconst willBeEmpty = (ranges.length === 0);\n\t\tif (willBeEmpty && !this._hasDecorationsForKey[decorationType.key]) {\n\t\t\t// avoid no-op call to the renderer\n\t\t\treturn;\n\t\t}\n\t\tif (willBeEmpty) {\n\t\t\tdelete this._hasDecorationsForKey[decorationType.key];\n\t\t} else {\n\t\t\tthis._hasDecorationsForKey[decorationType.key] = true;\n\t\t}\n\t\tthis._runOnProxy(\n\t\t\t() => {\n\t\t\t\tif (TypeConverters.isDecorationOptionsArr(ranges)) {\n\t\t\t\t\treturn this._proxy.$trySetDecorations(\n\t\t\t\t\t\tthis.id,\n\t\t\t\t\t\tdecorationType.key,\n\t\t\t\t\t\tTypeConverters.fromRangeOrRangeWithMessage(ranges)\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tconst _ranges: number[] = new Array<number>(4 * ranges.length);\n\t\t\t\t\tfor (let i = 0, len = ranges.length; i < len; i++) {\n\t\t\t\t\t\tconst range = ranges[i];\n\t\t\t\t\t\t_ranges[4 * i] = range.start.line + 1;\n\t\t\t\t\t\t_ranges[4 * i + 1] = range.start.character + 1;\n\t\t\t\t\t\t_ranges[4 * i + 2] = range.end.line + 1;\n\t\t\t\t\t\t_ranges[4 * i + 3] = range.end.character + 1;\n\t\t\t\t\t}\n\t\t\t\t\treturn this._proxy.$trySetDecorationsFast(\n\t\t\t\t\t\tthis.id,\n\t\t\t\t\t\tdecorationType.key,\n\t\t\t\t\t\t_ranges\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\trevealRange(range: Range, revealType: vscode.TextEditorRevealType): void {\n\t\tthis._runOnProxy(\n\t\t\t() => this._proxy.$tryRevealRange(\n\t\t\t\tthis.id,\n\t\t\t\tTypeConverters.Range.from(range),\n\t\t\t\t(revealType || TextEditorRevealType.Default)\n\t\t\t)\n\t\t);\n\t}\n\n\tprivate _trySetSelection(): Promise<vscode.TextEditor | null | undefined> {\n\t\tconst selection = this._selections.map(TypeConverters.Selection.from);\n\t\treturn this._runOnProxy(() => this._proxy.$trySetSelections(this.id, selection));\n\t}\n\n\t_acceptSelections(selections: Selection[]): void {\n\t\tok(!this._disposed);\n\t\tthis._selections = selections;\n\t}\n\n\t// ---- editing\n\n\tedit(callback: (edit: TextEditorEdit) => void, options: { undoStopBefore: boolean; undoStopAfter: boolean; } = { undoStopBefore: true, undoStopAfter: true }): Promise<boolean> {\n\t\tif (this._disposed) {\n\t\t\treturn Promise.reject(new Error('TextEditor#edit not possible on closed editors'));\n\t\t}\n\t\tconst edit = new TextEditorEdit(this._documentData.document, options);\n\t\tcallback(edit);\n\t\treturn this._applyEdit(edit);\n\t}\n\n\tprivate _applyEdit(editBuilder: TextEditorEdit): Promise<boolean> {\n\t\tconst editData = editBuilder.finalize();\n\n\t\t// return when there is nothing to do\n\t\tif (editData.edits.length === 0 && !editData.setEndOfLine) {\n\t\t\treturn Promise.resolve(true);\n\t\t}\n\n\t\t// check that the edits are not overlapping (i.e. illegal)\n\t\tconst editRanges = editData.edits.map(edit => edit.range);\n\n\t\t// sort ascending (by end and then by start)\n\t\teditRanges.sort((a, b) => {\n\t\t\tif (a.end.line === b.end.line) {\n\t\t\t\tif (a.end.character === b.end.character) {\n\t\t\t\t\tif (a.start.line === b.start.line) {\n\t\t\t\t\t\treturn a.start.character - b.start.character;\n\t\t\t\t\t}\n\t\t\t\t\treturn a.start.line - b.start.line;\n\t\t\t\t}\n\t\t\t\treturn a.end.character - b.end.character;\n\t\t\t}\n\t\t\treturn a.end.line - b.end.line;\n\t\t});\n\n\t\t// check that no edits are overlapping\n\t\tfor (let i = 0, count = editRanges.length - 1; i < count; i++) {\n\t\t\tconst rangeEnd = editRanges[i].end;\n\t\t\tconst nextRangeStart = editRanges[i + 1].start;\n\n\t\t\tif (nextRangeStart.isBefore(rangeEnd)) {\n\t\t\t\t// overlapping ranges\n\t\t\t\treturn Promise.reject(\n\t\t\t\t\tnew Error('Overlapping ranges are not allowed!')\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\t// prepare data for serialization\n\t\tconst edits = editData.edits.map((edit): ISingleEditOperation => {\n\t\t\treturn {\n\t\t\t\trange: TypeConverters.Range.from(edit.range),\n\t\t\t\ttext: edit.text,\n\t\t\t\tforceMoveMarkers: edit.forceMoveMarkers\n\t\t\t};\n\t\t});\n\n\t\treturn this._proxy.$tryApplyEdits(this.id, editData.documentVersionId, edits, {\n\t\t\tsetEndOfLine: typeof editData.setEndOfLine === 'number' ? TypeConverters.EndOfLine.from(editData.setEndOfLine) : undefined,\n\t\t\tundoStopBefore: editData.undoStopBefore,\n\t\t\tundoStopAfter: editData.undoStopAfter\n\t\t});\n\t}\n\n\tinsertSnippet(snippet: SnippetString, where?: Position | readonly Position[] | Range | readonly Range[], options: { undoStopBefore: boolean; undoStopAfter: boolean; } = { undoStopBefore: true, undoStopAfter: true }): Promise<boolean> {\n\t\tif (this._disposed) {\n\t\t\treturn Promise.reject(new Error('TextEditor#insertSnippet not possible on closed editors'));\n\t\t}\n\t\tlet ranges: IRange[];\n\n\t\tif (!where || (Array.isArray(where) && where.length === 0)) {\n\t\t\tranges = this._selections.map(range => TypeConverters.Range.from(range));\n\n\t\t} else if (where instanceof Position) {\n\t\t\tconst { lineNumber, column } = TypeConverters.Position.from(where);\n\t\t\tranges = [{ startLineNumber: lineNumber, startColumn: column, endLineNumber: lineNumber, endColumn: column }];\n\n\t\t} else if (where instanceof Range) {\n\t\t\tranges = [TypeConverters.Range.from(where)];\n\t\t} else {\n\t\t\tranges = [];\n\t\t\tfor (const posOrRange of where) {\n\t\t\t\tif (posOrRange instanceof Range) {\n\t\t\t\t\tranges.push(TypeConverters.Range.from(posOrRange));\n\t\t\t\t} else {\n\t\t\t\t\tconst { lineNumber, column } = TypeConverters.Position.from(posOrRange);\n\t\t\t\t\tranges.push({ startLineNumber: lineNumber, startColumn: column, endLineNumber: lineNumber, endColumn: column });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn this._proxy.$tryInsertSnippet(this.id, snippet.value, ranges, options);\n\t}\n\n\t// ---- util\n\n\tprivate _runOnProxy(callback: () => Promise<any>): Promise<ExtHostTextEditor | undefined | null> {\n\t\tif (this._disposed) {\n\t\t\tthis._logService.warn('TextEditor is closed/disposed');\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\t\treturn callback().then(() => this, err => {\n\t\t\tif (!(err instanceof Error && err.name === 'DISPOSED')) {\n\t\t\t\tthis._logService.warn(err);\n\t\t\t}\n\t\t\treturn null;\n\t\t});\n\t}\n}\n\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from 'vs/nls';\nimport type * as vscode from 'vscode';\nimport { basename } from 'vs/base/common/resources';\nimport { URI } from 'vs/base/common/uri';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { Disposable, DisposableStore, IDisposable } from 'vs/base/common/lifecycle';\nimport { ExtHostTreeViewsShape, MainThreadTreeViewsShape } from './extHost.protocol';\nimport { ITreeItem, TreeViewItemHandleArg, ITreeItemLabel, IRevealOptions } from 'vs/workbench/common/views';\nimport { ExtHostCommands, CommandsConverter } from 'vs/workbench/api/common/extHostCommands';\nimport { asPromise } from 'vs/base/common/async';\nimport { TreeItemCollapsibleState, ThemeIcon, MarkdownString as MarkdownStringType } from 'vs/workbench/api/common/extHostTypes';\nimport { isUndefinedOrNull, isString } from 'vs/base/common/types';\nimport { equals, coalesce } from 'vs/base/common/arrays';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { MarkdownString } from 'vs/workbench/api/common/extHostTypeConverters';\nimport { IMarkdownString } from 'vs/base/common/htmlContent';\nimport { CancellationTokenSource } from 'vs/base/common/cancellation';\nimport { Command } from 'vs/editor/common/modes';\n\ntype TreeItemHandle = string;\n\nfunction toTreeItemLabel(label: any, extension: IExtensionDescription): ITreeItemLabel | undefined {\n\tif (isString(label)) {\n\t\treturn { label };\n\t}\n\n\tif (label\n\t\t&& typeof label === 'object'\n\t\t&& typeof label.label === 'string') {\n\t\tlet highlights: [number, number][] | undefined = undefined;\n\t\tif (Array.isArray(label.highlights)) {\n\t\t\thighlights = (<[number, number][]>label.highlights).filter((highlight => highlight.length === 2 && typeof highlight[0] === 'number' && typeof highlight[1] === 'number'));\n\t\t\thighlights = highlights.length ? highlights : undefined;\n\t\t}\n\t\treturn { label: label.label, highlights };\n\t}\n\n\treturn undefined;\n}\n\n\nexport class ExtHostTreeViews implements ExtHostTreeViewsShape {\n\n\tprivate treeViews: Map<string, ExtHostTreeView<any>> = new Map<string, ExtHostTreeView<any>>();\n\n\tconstructor(\n\t\tprivate _proxy: MainThreadTreeViewsShape,\n\t\tprivate commands: ExtHostCommands,\n\t\tprivate logService: ILogService\n\t) {\n\n\t\tfunction isTreeViewItemHandleArg(arg: any): boolean {\n\t\t\treturn arg && arg.$treeViewId && arg.$treeItemHandle;\n\t\t}\n\t\tcommands.registerArgumentProcessor({\n\t\t\tprocessArgument: arg => {\n\t\t\t\tif (isTreeViewItemHandleArg(arg)) {\n\t\t\t\t\treturn this.convertArgument(arg);\n\t\t\t\t} else if (Array.isArray(arg) && (arg.length > 0)) {\n\t\t\t\t\treturn arg.map(item => {\n\t\t\t\t\t\tif (isTreeViewItemHandleArg(item)) {\n\t\t\t\t\t\t\treturn this.convertArgument(item);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn item;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn arg;\n\t\t\t}\n\t\t});\n\t}\n\n\tregisterTreeDataProvider<T>(id: string, treeDataProvider: vscode.TreeDataProvider<T>, extension: IExtensionDescription): vscode.Disposable {\n\t\tconst treeView = this.createTreeView(id, { treeDataProvider }, extension);\n\t\treturn { dispose: () => treeView.dispose() };\n\t}\n\n\tcreateTreeView<T>(viewId: string, options: vscode.TreeViewOptions<T>, extension: IExtensionDescription): vscode.TreeView<T> {\n\t\tif (!options || !options.treeDataProvider) {\n\t\t\tthrow new Error('Options with treeDataProvider is mandatory');\n\t\t}\n\n\t\tconst treeView = this.createExtHostTreeView(viewId, options, extension);\n\t\treturn {\n\t\t\tget onDidCollapseElement() { return treeView.onDidCollapseElement; },\n\t\t\tget onDidExpandElement() { return treeView.onDidExpandElement; },\n\t\t\tget selection() { return treeView.selectedElements; },\n\t\t\tget onDidChangeSelection() { return treeView.onDidChangeSelection; },\n\t\t\tget visible() { return treeView.visible; },\n\t\t\tget onDidChangeVisibility() { return treeView.onDidChangeVisibility; },\n\t\t\tget message() { return treeView.message; },\n\t\t\tset message(message: string) {\n\t\t\t\ttreeView.message = message;\n\t\t\t},\n\t\t\tget title() { return treeView.title; },\n\t\t\tset title(title: string) {\n\t\t\t\ttreeView.title = title;\n\t\t\t},\n\t\t\tget description() {\n\t\t\t\treturn treeView.description;\n\t\t\t},\n\t\t\tset description(description: string | undefined) {\n\t\t\t\ttreeView.description = description;\n\t\t\t},\n\t\t\treveal: (element: T, options?: IRevealOptions): Promise<void> => {\n\t\t\t\treturn treeView.reveal(element, options);\n\t\t\t},\n\t\t\tdispose: () => {\n\t\t\t\tthis.treeViews.delete(viewId);\n\t\t\t\ttreeView.dispose();\n\t\t\t}\n\t\t};\n\t}\n\n\t$getChildren(treeViewId: string, treeItemHandle?: string): Promise<ITreeItem[]> {\n\t\tconst treeView = this.treeViews.get(treeViewId);\n\t\tif (!treeView) {\n\t\t\treturn Promise.reject(new Error(localize('treeView.notRegistered', 'No tree view with id \\'{0}\\' registered.', treeViewId)));\n\t\t}\n\t\treturn treeView.getChildren(treeItemHandle);\n\t}\n\n\tasync $hasResolve(treeViewId: string): Promise<boolean> {\n\t\tconst treeView = this.treeViews.get(treeViewId);\n\t\tif (!treeView) {\n\t\t\tthrow new Error(localize('treeView.notRegistered', 'No tree view with id \\'{0}\\' registered.', treeViewId));\n\t\t}\n\t\treturn treeView.hasResolve;\n\t}\n\n\t$resolve(treeViewId: string, treeItemHandle: string, token: vscode.CancellationToken): Promise<ITreeItem | undefined> {\n\t\tconst treeView = this.treeViews.get(treeViewId);\n\t\tif (!treeView) {\n\t\t\tthrow new Error(localize('treeView.notRegistered', 'No tree view with id \\'{0}\\' registered.', treeViewId));\n\t\t}\n\t\treturn treeView.resolveTreeItem(treeItemHandle, token);\n\t}\n\n\t$setExpanded(treeViewId: string, treeItemHandle: string, expanded: boolean): void {\n\t\tconst treeView = this.treeViews.get(treeViewId);\n\t\tif (!treeView) {\n\t\t\tthrow new Error(localize('treeView.notRegistered', 'No tree view with id \\'{0}\\' registered.', treeViewId));\n\t\t}\n\t\ttreeView.setExpanded(treeItemHandle, expanded);\n\t}\n\n\t$setSelection(treeViewId: string, treeItemHandles: string[]): void {\n\t\tconst treeView = this.treeViews.get(treeViewId);\n\t\tif (!treeView) {\n\t\t\tthrow new Error(localize('treeView.notRegistered', 'No tree view with id \\'{0}\\' registered.', treeViewId));\n\t\t}\n\t\ttreeView.setSelection(treeItemHandles);\n\t}\n\n\t$setVisible(treeViewId: string, isVisible: boolean): void {\n\t\tconst treeView = this.treeViews.get(treeViewId);\n\t\tif (!treeView) {\n\t\t\tthrow new Error(localize('treeView.notRegistered', 'No tree view with id \\'{0}\\' registered.', treeViewId));\n\t\t}\n\t\ttreeView.setVisible(isVisible);\n\t}\n\n\tprivate createExtHostTreeView<T>(id: string, options: vscode.TreeViewOptions<T>, extension: IExtensionDescription): ExtHostTreeView<T> {\n\t\tconst treeView = new ExtHostTreeView<T>(id, options, this._proxy, this.commands.converter, this.logService, extension);\n\t\tthis.treeViews.set(id, treeView);\n\t\treturn treeView;\n\t}\n\n\tprivate convertArgument(arg: TreeViewItemHandleArg): any {\n\t\tconst treeView = this.treeViews.get(arg.$treeViewId);\n\t\treturn treeView ? treeView.getExtensionElement(arg.$treeItemHandle) : null;\n\t}\n}\n\ntype Root = null | undefined | void;\ntype TreeData<T> = { message: boolean, element: T | Root | false };\n\ninterface TreeNode extends IDisposable {\n\titem: ITreeItem;\n\textensionItem: vscode.TreeItem;\n\tparent: TreeNode | Root;\n\tchildren?: TreeNode[];\n\tdisposableStore: DisposableStore;\n}\n\nclass ExtHostTreeView<T> extends Disposable {\n\n\tprivate static readonly LABEL_HANDLE_PREFIX = '0';\n\tprivate static readonly ID_HANDLE_PREFIX = '1';\n\n\tprivate readonly dataProvider: vscode.TreeDataProvider<T>;\n\n\tprivate roots: TreeNode[] | null = null;\n\tprivate elements: Map<TreeItemHandle, T> = new Map<TreeItemHandle, T>();\n\tprivate nodes: Map<T, TreeNode> = new Map<T, TreeNode>();\n\n\tprivate _visible: boolean = false;\n\tget visible(): boolean { return this._visible; }\n\n\tprivate _selectedHandles: TreeItemHandle[] = [];\n\tget selectedElements(): T[] { return <T[]>this._selectedHandles.map(handle => this.getExtensionElement(handle)).filter(element => !isUndefinedOrNull(element)); }\n\n\tprivate _onDidExpandElement: Emitter<vscode.TreeViewExpansionEvent<T>> = this._register(new Emitter<vscode.TreeViewExpansionEvent<T>>());\n\treadonly onDidExpandElement: Event<vscode.TreeViewExpansionEvent<T>> = this._onDidExpandElement.event;\n\n\tprivate _onDidCollapseElement: Emitter<vscode.TreeViewExpansionEvent<T>> = this._register(new Emitter<vscode.TreeViewExpansionEvent<T>>());\n\treadonly onDidCollapseElement: Event<vscode.TreeViewExpansionEvent<T>> = this._onDidCollapseElement.event;\n\n\tprivate _onDidChangeSelection: Emitter<vscode.TreeViewSelectionChangeEvent<T>> = this._register(new Emitter<vscode.TreeViewSelectionChangeEvent<T>>());\n\treadonly onDidChangeSelection: Event<vscode.TreeViewSelectionChangeEvent<T>> = this._onDidChangeSelection.event;\n\n\tprivate _onDidChangeVisibility: Emitter<vscode.TreeViewVisibilityChangeEvent> = this._register(new Emitter<vscode.TreeViewVisibilityChangeEvent>());\n\treadonly onDidChangeVisibility: Event<vscode.TreeViewVisibilityChangeEvent> = this._onDidChangeVisibility.event;\n\n\tprivate _onDidChangeData: Emitter<TreeData<T>> = this._register(new Emitter<TreeData<T>>());\n\n\tprivate refreshPromise: Promise<void> = Promise.resolve();\n\tprivate refreshQueue: Promise<void> = Promise.resolve();\n\n\tconstructor(\n\t\tprivate viewId: string, options: vscode.TreeViewOptions<T>,\n\t\tprivate proxy: MainThreadTreeViewsShape,\n\t\tprivate commands: CommandsConverter,\n\t\tprivate logService: ILogService,\n\t\tprivate extension: IExtensionDescription\n\t) {\n\t\tsuper();\n\t\tif (extension.contributes && extension.contributes.views) {\n\t\t\tfor (const location in extension.contributes.views) {\n\t\t\t\tfor (const view of extension.contributes.views[location]) {\n\t\t\t\t\tif (view.id === viewId) {\n\t\t\t\t\t\tthis._title = view.name;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.dataProvider = options.treeDataProvider;\n\t\tthis.proxy.$registerTreeViewDataProvider(viewId, { showCollapseAll: !!options.showCollapseAll, canSelectMany: !!options.canSelectMany });\n\t\tif (this.dataProvider.onDidChangeTreeData) {\n\t\t\tthis._register(this.dataProvider.onDidChangeTreeData(element => this._onDidChangeData.fire({ message: false, element })));\n\t\t}\n\n\t\tlet refreshingPromise: Promise<void> | null;\n\t\tlet promiseCallback: () => void;\n\t\tthis._register(Event.debounce<TreeData<T>, { message: boolean, elements: (T | Root)[] }>(this._onDidChangeData.event, (result, current) => {\n\t\t\tif (!result) {\n\t\t\t\tresult = { message: false, elements: [] };\n\t\t\t}\n\t\t\tif (current.element !== false) {\n\t\t\t\tif (!refreshingPromise) {\n\t\t\t\t\t// New refresh has started\n\t\t\t\t\trefreshingPromise = new Promise(c => promiseCallback = c);\n\t\t\t\t\tthis.refreshPromise = this.refreshPromise.then(() => refreshingPromise!);\n\t\t\t\t}\n\t\t\t\tresult.elements.push(current.element);\n\t\t\t}\n\t\t\tif (current.message) {\n\t\t\t\tresult.message = true;\n\t\t\t}\n\t\t\treturn result;\n\t\t}, 200, true)(({ message, elements }) => {\n\t\t\tif (elements.length) {\n\t\t\t\tthis.refreshQueue = this.refreshQueue.then(() => {\n\t\t\t\t\tconst _promiseCallback = promiseCallback;\n\t\t\t\t\trefreshingPromise = null;\n\t\t\t\t\treturn this.refresh(elements).then(() => _promiseCallback());\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (message) {\n\t\t\t\tthis.proxy.$setMessage(this.viewId, this._message);\n\t\t\t}\n\t\t}));\n\t}\n\n\tgetChildren(parentHandle: TreeItemHandle | Root): Promise<ITreeItem[]> {\n\t\tconst parentElement = parentHandle ? this.getExtensionElement(parentHandle) : undefined;\n\t\tif (parentHandle && !parentElement) {\n\t\t\tthis.logService.error(`No tree item with id \\'${parentHandle}\\' found.`);\n\t\t\treturn Promise.resolve([]);\n\t\t}\n\n\t\tconst childrenNodes = this.getChildrenNodes(parentHandle); // Get it from cache\n\t\treturn (childrenNodes ? Promise.resolve(childrenNodes) : this.fetchChildrenNodes(parentElement))\n\t\t\t.then(nodes => nodes.map(n => n.item));\n\t}\n\n\tgetExtensionElement(treeItemHandle: TreeItemHandle): T | undefined {\n\t\treturn this.elements.get(treeItemHandle);\n\t}\n\n\treveal(element: T | undefined, options?: IRevealOptions): Promise<void> {\n\t\toptions = options ? options : { select: true, focus: false };\n\t\tconst select = isUndefinedOrNull(options.select) ? true : options.select;\n\t\tconst focus = isUndefinedOrNull(options.focus) ? false : options.focus;\n\t\tconst expand = isUndefinedOrNull(options.expand) ? false : options.expand;\n\n\t\tif (typeof this.dataProvider.getParent !== 'function') {\n\t\t\treturn Promise.reject(new Error(`Required registered TreeDataProvider to implement 'getParent' method to access 'reveal' method`));\n\t\t}\n\n\t\tif (element) {\n\t\t\treturn this.refreshPromise\n\t\t\t\t.then(() => this.resolveUnknownParentChain(element))\n\t\t\t\t.then(parentChain => this.resolveTreeNode(element, parentChain[parentChain.length - 1])\n\t\t\t\t\t.then(treeNode => this.proxy.$reveal(this.viewId, { item: treeNode.item, parentChain: parentChain.map(p => p.item) }, { select, focus, expand })), error => this.logService.error(error));\n\t\t} else {\n\t\t\treturn this.proxy.$reveal(this.viewId, undefined, { select, focus, expand });\n\t\t}\n\t}\n\n\tprivate _message: string = '';\n\tget message(): string {\n\t\treturn this._message;\n\t}\n\n\tset message(message: string) {\n\t\tthis._message = message;\n\t\tthis._onDidChangeData.fire({ message: true, element: false });\n\t}\n\n\tprivate _title: string = '';\n\tget title(): string {\n\t\treturn this._title;\n\t}\n\n\tset title(title: string) {\n\t\tthis._title = title;\n\t\tthis.proxy.$setTitle(this.viewId, title, this._description);\n\t}\n\n\tprivate _description: string | undefined;\n\tget description(): string | undefined {\n\t\treturn this._description;\n\t}\n\n\tset description(description: string | undefined) {\n\t\tthis._description = description;\n\t\tthis.proxy.$setTitle(this.viewId, this._title, description);\n\t}\n\n\tsetExpanded(treeItemHandle: TreeItemHandle, expanded: boolean): void {\n\t\tconst element = this.getExtensionElement(treeItemHandle);\n\t\tif (element) {\n\t\t\tif (expanded) {\n\t\t\t\tthis._onDidExpandElement.fire(Object.freeze({ element }));\n\t\t\t} else {\n\t\t\t\tthis._onDidCollapseElement.fire(Object.freeze({ element }));\n\t\t\t}\n\t\t}\n\t}\n\n\tsetSelection(treeItemHandles: TreeItemHandle[]): void {\n\t\tif (!equals(this._selectedHandles, treeItemHandles)) {\n\t\t\tthis._selectedHandles = treeItemHandles;\n\t\t\tthis._onDidChangeSelection.fire(Object.freeze({ selection: this.selectedElements }));\n\t\t}\n\t}\n\n\tsetVisible(visible: boolean): void {\n\t\tif (visible !== this._visible) {\n\t\t\tthis._visible = visible;\n\t\t\tthis._onDidChangeVisibility.fire(Object.freeze({ visible: this._visible }));\n\t\t}\n\t}\n\n\tget hasResolve(): boolean {\n\t\treturn !!this.dataProvider.resolveTreeItem;\n\t}\n\n\tasync resolveTreeItem(treeItemHandle: string, token: vscode.CancellationToken): Promise<ITreeItem | undefined> {\n\t\tif (!this.dataProvider.resolveTreeItem) {\n\t\t\treturn;\n\t\t}\n\t\tconst element = this.elements.get(treeItemHandle);\n\t\tif (element) {\n\t\t\tconst node = this.nodes.get(element);\n\t\t\tif (node) {\n\t\t\t\tconst resolve = await this.dataProvider.resolveTreeItem(node.extensionItem, element, token) ?? node.extensionItem;\n\t\t\t\t// Resolvable elements. Currently only tooltip and command.\n\t\t\t\tnode.item.tooltip = this.getTooltip(resolve.tooltip);\n\t\t\t\tnode.item.command = this.getCommand(node.disposableStore, resolve.command);\n\t\t\t\treturn node.item;\n\t\t\t}\n\t\t}\n\t\treturn;\n\t}\n\n\tprivate resolveUnknownParentChain(element: T): Promise<TreeNode[]> {\n\t\treturn this.resolveParent(element)\n\t\t\t.then((parent) => {\n\t\t\t\tif (!parent) {\n\t\t\t\t\treturn Promise.resolve([]);\n\t\t\t\t}\n\t\t\t\treturn this.resolveUnknownParentChain(parent)\n\t\t\t\t\t.then(result => this.resolveTreeNode(parent, result[result.length - 1])\n\t\t\t\t\t\t.then(parentNode => {\n\t\t\t\t\t\t\tresult.push(parentNode);\n\t\t\t\t\t\t\treturn result;\n\t\t\t\t\t\t}));\n\t\t\t});\n\t}\n\n\tprivate resolveParent(element: T): Promise<T | Root> {\n\t\tconst node = this.nodes.get(element);\n\t\tif (node) {\n\t\t\treturn Promise.resolve(node.parent ? this.elements.get(node.parent.item.handle) : undefined);\n\t\t}\n\t\treturn asPromise(() => this.dataProvider.getParent!(element));\n\t}\n\n\tprivate resolveTreeNode(element: T, parent?: TreeNode): Promise<TreeNode> {\n\t\tconst node = this.nodes.get(element);\n\t\tif (node) {\n\t\t\treturn Promise.resolve(node);\n\t\t}\n\t\treturn asPromise(() => this.dataProvider.getTreeItem(element))\n\t\t\t.then(extTreeItem => this.createHandle(element, extTreeItem, parent, true))\n\t\t\t.then(handle => this.getChildren(parent ? parent.item.handle : undefined)\n\t\t\t\t.then(() => {\n\t\t\t\t\tconst cachedElement = this.getExtensionElement(handle);\n\t\t\t\t\tif (cachedElement) {\n\t\t\t\t\t\tconst node = this.nodes.get(cachedElement);\n\t\t\t\t\t\tif (node) {\n\t\t\t\t\t\t\treturn Promise.resolve(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthrow new Error(`Cannot resolve tree item for element ${handle}`);\n\t\t\t\t}));\n\t}\n\n\tprivate getChildrenNodes(parentNodeOrHandle: TreeNode | TreeItemHandle | Root): TreeNode[] | null {\n\t\tif (parentNodeOrHandle) {\n\t\t\tlet parentNode: TreeNode | undefined;\n\t\t\tif (typeof parentNodeOrHandle === 'string') {\n\t\t\t\tconst parentElement = this.getExtensionElement(parentNodeOrHandle);\n\t\t\t\tparentNode = parentElement ? this.nodes.get(parentElement) : undefined;\n\t\t\t} else {\n\t\t\t\tparentNode = parentNodeOrHandle;\n\t\t\t}\n\t\t\treturn parentNode ? parentNode.children || null : null;\n\t\t}\n\t\treturn this.roots;\n\t}\n\n\tprivate async fetchChildrenNodes(parentElement?: T): Promise<TreeNode[]> {\n\t\t// clear children cache\n\t\tthis.clearChildren(parentElement);\n\n\t\tconst cts = new CancellationTokenSource(this._refreshCancellationSource.token);\n\n\t\ttry {\n\t\t\tconst parentNode = parentElement ? this.nodes.get(parentElement) : undefined;\n\t\t\tconst elements = await this.dataProvider.getChildren(parentElement);\n\t\t\tif (cts.token.isCancellationRequested) {\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tconst items = await Promise.all(coalesce(elements || []).map(async element => {\n\t\t\t\tconst item = await this.dataProvider.getTreeItem(element);\n\t\t\t\treturn item && !cts.token.isCancellationRequested ? this.createAndRegisterTreeNode(element, item, parentNode) : null;\n\t\t\t}));\n\t\t\tif (cts.token.isCancellationRequested) {\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\treturn coalesce(items);\n\t\t} finally {\n\t\t\tcts.dispose();\n\t\t}\n\t}\n\n\tprivate _refreshCancellationSource = new CancellationTokenSource();\n\n\tprivate refresh(elements: (T | Root)[]): Promise<void> {\n\t\tconst hasRoot = elements.some(element => !element);\n\t\tif (hasRoot) {\n\t\t\t// Cancel any pending children fetches\n\t\t\tthis._refreshCancellationSource.dispose(true);\n\t\t\tthis._refreshCancellationSource = new CancellationTokenSource();\n\n\t\t\tthis.clearAll(); // clear cache\n\t\t\treturn this.proxy.$refresh(this.viewId);\n\t\t} else {\n\t\t\tconst handlesToRefresh = this.getHandlesToRefresh(<T[]>elements);\n\t\t\tif (handlesToRefresh.length) {\n\t\t\t\treturn this.refreshHandles(handlesToRefresh);\n\t\t\t}\n\t\t}\n\t\treturn Promise.resolve(undefined);\n\t}\n\n\tprivate getHandlesToRefresh(elements: T[]): TreeItemHandle[] {\n\t\tconst elementsToUpdate = new Set<TreeItemHandle>();\n\t\tfor (const element of elements) {\n\t\t\tconst elementNode = this.nodes.get(element);\n\t\t\tif (elementNode && !elementsToUpdate.has(elementNode.item.handle)) {\n\t\t\t\t// check if an ancestor of extElement is already in the elements to update list\n\t\t\t\tlet currentNode: TreeNode | undefined = elementNode;\n\t\t\t\twhile (currentNode && currentNode.parent && !elementsToUpdate.has(currentNode.parent.item.handle)) {\n\t\t\t\t\tconst parentElement: T | undefined = this.elements.get(currentNode.parent.item.handle);\n\t\t\t\t\tcurrentNode = parentElement ? this.nodes.get(parentElement) : undefined;\n\t\t\t\t}\n\t\t\t\tif (currentNode && !currentNode.parent) {\n\t\t\t\t\telementsToUpdate.add(elementNode.item.handle);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst handlesToUpdate: TreeItemHandle[] = [];\n\t\t// Take only top level elements\n\t\telementsToUpdate.forEach((handle) => {\n\t\t\tconst element = this.elements.get(handle);\n\t\t\tif (element) {\n\t\t\t\tconst node = this.nodes.get(element);\n\t\t\t\tif (node && (!node.parent || !elementsToUpdate.has(node.parent.item.handle))) {\n\t\t\t\t\thandlesToUpdate.push(handle);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn handlesToUpdate;\n\t}\n\n\tprivate refreshHandles(itemHandles: TreeItemHandle[]): Promise<void> {\n\t\tconst itemsToRefresh: { [treeItemHandle: string]: ITreeItem } = {};\n\t\treturn Promise.all(itemHandles.map(treeItemHandle =>\n\t\t\tthis.refreshNode(treeItemHandle)\n\t\t\t\t.then(node => {\n\t\t\t\t\tif (node) {\n\t\t\t\t\t\titemsToRefresh[treeItemHandle] = node.item;\n\t\t\t\t\t}\n\t\t\t\t})))\n\t\t\t.then(() => Object.keys(itemsToRefresh).length ? this.proxy.$refresh(this.viewId, itemsToRefresh) : undefined);\n\t}\n\n\tprivate refreshNode(treeItemHandle: TreeItemHandle): Promise<TreeNode | null> {\n\t\tconst extElement = this.getExtensionElement(treeItemHandle);\n\t\tif (extElement) {\n\t\t\tconst existing = this.nodes.get(extElement);\n\t\t\tif (existing) {\n\t\t\t\tthis.clearChildren(extElement); // clear children cache\n\t\t\t\treturn asPromise(() => this.dataProvider.getTreeItem(extElement))\n\t\t\t\t\t.then(extTreeItem => {\n\t\t\t\t\t\tif (extTreeItem) {\n\t\t\t\t\t\t\tconst newNode = this.createTreeNode(extElement, extTreeItem, existing.parent);\n\t\t\t\t\t\t\tthis.updateNodeCache(extElement, newNode, existing, existing.parent);\n\t\t\t\t\t\t\texisting.dispose();\n\t\t\t\t\t\t\treturn newNode;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn Promise.resolve(null);\n\t}\n\n\tprivate createAndRegisterTreeNode(element: T, extTreeItem: vscode.TreeItem, parentNode: TreeNode | Root): TreeNode {\n\t\tconst node = this.createTreeNode(element, extTreeItem, parentNode);\n\t\tif (extTreeItem.id && this.elements.has(node.item.handle)) {\n\t\t\tthrow new Error(localize('treeView.duplicateElement', 'Element with id {0} is already registered', extTreeItem.id));\n\t\t}\n\t\tthis.addNodeToCache(element, node);\n\t\tthis.addNodeToParentCache(node, parentNode);\n\t\treturn node;\n\t}\n\n\tprivate getTooltip(tooltip?: string | vscode.MarkdownString): string | IMarkdownString | undefined {\n\t\tif (MarkdownStringType.isMarkdownString(tooltip)) {\n\t\t\treturn MarkdownString.from(tooltip);\n\t\t}\n\t\treturn tooltip;\n\t}\n\n\tprivate getCommand(disposable: DisposableStore, command?: vscode.Command): Command | undefined {\n\t\treturn command ? this.commands.toInternal(command, disposable) : undefined;\n\t}\n\n\tprivate createTreeNode(element: T, extensionTreeItem: vscode.TreeItem, parent: TreeNode | Root): TreeNode {\n\t\tconst disposableStore = new DisposableStore();\n\t\tconst handle = this.createHandle(element, extensionTreeItem, parent);\n\t\tconst icon = this.getLightIconPath(extensionTreeItem);\n\t\tconst item: ITreeItem = {\n\t\t\thandle,\n\t\t\tparentHandle: parent ? parent.item.handle : undefined,\n\t\t\tlabel: toTreeItemLabel(extensionTreeItem.label, this.extension),\n\t\t\tdescription: extensionTreeItem.description,\n\t\t\tresourceUri: extensionTreeItem.resourceUri,\n\t\t\ttooltip: this.getTooltip(extensionTreeItem.tooltip),\n\t\t\tcommand: this.getCommand(disposableStore, extensionTreeItem.command),\n\t\t\tcontextValue: extensionTreeItem.contextValue,\n\t\t\ticon,\n\t\t\ticonDark: this.getDarkIconPath(extensionTreeItem) || icon,\n\t\t\tthemeIcon: this.getThemeIcon(extensionTreeItem),\n\t\t\tcollapsibleState: isUndefinedOrNull(extensionTreeItem.collapsibleState) ? TreeItemCollapsibleState.None : extensionTreeItem.collapsibleState,\n\t\t\taccessibilityInformation: extensionTreeItem.accessibilityInformation\n\t\t};\n\n\t\treturn {\n\t\t\titem,\n\t\t\textensionItem: extensionTreeItem,\n\t\t\tparent,\n\t\t\tchildren: undefined,\n\t\t\tdisposableStore,\n\t\t\tdispose(): void { disposableStore.dispose(); }\n\t\t};\n\t}\n\n\tprivate getThemeIcon(extensionTreeItem: vscode.TreeItem): ThemeIcon | undefined {\n\t\treturn extensionTreeItem.iconPath instanceof ThemeIcon ? extensionTreeItem.iconPath : undefined;\n\t}\n\n\tprivate createHandle(element: T, { id, label, resourceUri }: vscode.TreeItem, parent: TreeNode | Root, returnFirst?: boolean): TreeItemHandle {\n\t\tif (id) {\n\t\t\treturn `${ExtHostTreeView.ID_HANDLE_PREFIX}/${id}`;\n\t\t}\n\n\t\tconst treeItemLabel = toTreeItemLabel(label, this.extension);\n\t\tconst prefix: string = parent ? parent.item.handle : ExtHostTreeView.LABEL_HANDLE_PREFIX;\n\t\tlet elementId = treeItemLabel ? treeItemLabel.label : resourceUri ? basename(resourceUri) : '';\n\t\telementId = elementId.indexOf('/') !== -1 ? elementId.replace('/', '//') : elementId;\n\t\tconst existingHandle = this.nodes.has(element) ? this.nodes.get(element)!.item.handle : undefined;\n\t\tconst childrenNodes = (this.getChildrenNodes(parent) || []);\n\n\t\tlet handle: TreeItemHandle;\n\t\tlet counter = 0;\n\t\tdo {\n\t\t\thandle = `${prefix}/${counter}:${elementId}`;\n\t\t\tif (returnFirst || !this.elements.has(handle) || existingHandle === handle) {\n\t\t\t\t// Return first if asked for or\n\t\t\t\t// Return if handle does not exist or\n\t\t\t\t// Return if handle is being reused\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcounter++;\n\t\t} while (counter <= childrenNodes.length);\n\n\t\treturn handle;\n\t}\n\n\tprivate getLightIconPath(extensionTreeItem: vscode.TreeItem): URI | undefined {\n\t\tif (extensionTreeItem.iconPath && !(extensionTreeItem.iconPath instanceof ThemeIcon)) {\n\t\t\tif (typeof extensionTreeItem.iconPath === 'string'\n\t\t\t\t|| URI.isUri(extensionTreeItem.iconPath)) {\n\t\t\t\treturn this.getIconPath(extensionTreeItem.iconPath);\n\t\t\t}\n\t\t\treturn this.getIconPath((<{ light: string | URI; dark: string | URI }>extensionTreeItem.iconPath).light);\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate getDarkIconPath(extensionTreeItem: vscode.TreeItem): URI | undefined {\n\t\tif (extensionTreeItem.iconPath && !(extensionTreeItem.iconPath instanceof ThemeIcon) && (<{ light: string | URI; dark: string | URI }>extensionTreeItem.iconPath).dark) {\n\t\t\treturn this.getIconPath((<{ light: string | URI; dark: string | URI }>extensionTreeItem.iconPath).dark);\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate getIconPath(iconPath: string | URI): URI {\n\t\tif (URI.isUri(iconPath)) {\n\t\t\treturn iconPath;\n\t\t}\n\t\treturn URI.file(iconPath);\n\t}\n\n\tprivate addNodeToCache(element: T, node: TreeNode): void {\n\t\tthis.elements.set(node.item.handle, element);\n\t\tthis.nodes.set(element, node);\n\t}\n\n\tprivate updateNodeCache(element: T, newNode: TreeNode, existing: TreeNode, parentNode: TreeNode | Root): void {\n\t\t// Remove from the cache\n\t\tthis.elements.delete(newNode.item.handle);\n\t\tthis.nodes.delete(element);\n\t\tif (newNode.item.handle !== existing.item.handle) {\n\t\t\tthis.elements.delete(existing.item.handle);\n\t\t}\n\n\t\t// Add the new node to the cache\n\t\tthis.addNodeToCache(element, newNode);\n\n\t\t// Replace the node in parent's children nodes\n\t\tconst childrenNodes = (this.getChildrenNodes(parentNode) || []);\n\t\tconst childNode = childrenNodes.filter(c => c.item.handle === existing.item.handle)[0];\n\t\tif (childNode) {\n\t\t\tchildrenNodes.splice(childrenNodes.indexOf(childNode), 1, newNode);\n\t\t}\n\t}\n\n\tprivate addNodeToParentCache(node: TreeNode, parentNode: TreeNode | Root): void {\n\t\tif (parentNode) {\n\t\t\tif (!parentNode.children) {\n\t\t\t\tparentNode.children = [];\n\t\t\t}\n\t\t\tparentNode.children.push(node);\n\t\t} else {\n\t\t\tif (!this.roots) {\n\t\t\t\tthis.roots = [];\n\t\t\t}\n\t\t\tthis.roots.push(node);\n\t\t}\n\t}\n\n\tprivate clearChildren(parentElement?: T): void {\n\t\tif (parentElement) {\n\t\t\tconst node = this.nodes.get(parentElement);\n\t\t\tif (node) {\n\t\t\t\tif (node.children) {\n\t\t\t\t\tfor (const child of node.children) {\n\t\t\t\t\t\tconst childElement = this.elements.get(child.item.handle);\n\t\t\t\t\t\tif (childElement) {\n\t\t\t\t\t\t\tthis.clear(childElement);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tnode.children = undefined;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.clearAll();\n\t\t}\n\t}\n\n\tprivate clear(element: T): void {\n\t\tconst node = this.nodes.get(element);\n\t\tif (node) {\n\t\t\tif (node.children) {\n\t\t\t\tfor (const child of node.children) {\n\t\t\t\t\tconst childElement = this.elements.get(child.item.handle);\n\t\t\t\t\tif (childElement) {\n\t\t\t\t\t\tthis.clear(childElement);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.nodes.delete(element);\n\t\t\tthis.elements.delete(node.item.handle);\n\t\t\tnode.dispose();\n\t\t}\n\t}\n\n\tprivate clearAll(): void {\n\t\tthis.roots = null;\n\t\tthis.elements.clear();\n\t\tthis.nodes.forEach(node => node.dispose());\n\t\tthis.nodes.clear();\n\t}\n\n\tdispose() {\n\t\tthis._refreshCancellationSource.dispose();\n\n\t\tthis.clearAll();\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { RunOnceScheduler } from 'vs/base/common/async';\nimport { throttle } from 'vs/base/common/decorators';\nimport { IDisposable } from 'vs/base/common/lifecycle';\nimport { generateUuid } from 'vs/base/common/uuid';\nimport { TestItem } from 'vs/workbench/api/common/extHostTypeConverters';\nimport { RequiredTestItem, TestItem as ApiTestItem } from 'vs/workbench/api/common/extHostTypes';\nimport { InternalTestItem, TestDiffOpType, TestsDiff, TestsDiffOp } from 'vs/workbench/contrib/testing/common/testCollection';\n\n/**\n * @private\n */\nexport class OwnedTestCollection {\n\tprotected readonly testIdToInternal = new Map<string, OwnedCollectionTestItem>();\n\n\t/**\n\t * Gets test information by ID, if it was defined and still exists in this\n\t * extension host.\n\t */\n\tpublic getTestById(id: string) {\n\t\treturn this.testIdToInternal.get(id);\n\t}\n\n\t/**\n\t * Creates a new test collection for a specific hierarchy for a workspace\n\t * or document observation.\n\t */\n\tpublic createForHierarchy(publishDiff: (diff: TestsDiff) => void = () => undefined) {\n\t\treturn new SingleUseTestCollection(this.testIdToInternal, publishDiff);\n\t}\n}\n/**\n * @private\n */\nexport interface OwnedCollectionTestItem extends InternalTestItem {\n\tactual: ApiTestItem;\n\tpreviousChildren: Set<string>;\n\tpreviousEquals: (v: ApiTestItem) => boolean;\n}\n\n\n/**\n * Maintains tests created and registered for a single set of hierarchies\n * for a workspace or document.\n * @private\n */\nexport class SingleUseTestCollection implements IDisposable {\n\tprotected readonly testItemToInternal = new Map<ApiTestItem, OwnedCollectionTestItem>();\n\tprotected diff: TestsDiff = [];\n\tprivate disposed = false;\n\n\t/**\n\t * Debouncer for sending diffs. We use both a throttle and a debounce here,\n\t * so that tests that all change state simultenously are effected together,\n\t * but so we don't send hundreds of test updates per second to the main thread.\n\t */\n\tprivate readonly debounceSendDiff = new RunOnceScheduler(() => this.throttleSendDiff(), 2);\n\n\tconstructor(private readonly testIdToInternal: Map<string, OwnedCollectionTestItem>, private readonly publishDiff: (diff: TestsDiff) => void) { }\n\n\t/**\n\t * Adds a new root node to the collection.\n\t */\n\tpublic addRoot(item: ApiTestItem, providerId: string) {\n\t\tthis.addItem(item, providerId, null);\n\t\tthis.debounceSendDiff.schedule();\n\t}\n\n\t/**\n\t * Gets test information by its reference, if it was defined and still exists\n\t * in this extension host.\n\t */\n\tpublic getTestByReference(item: ApiTestItem) {\n\t\treturn this.testItemToInternal.get(item);\n\t}\n\n\t/**\n\t * Should be called when an item change is fired on the test provider.\n\t */\n\tpublic onItemChange(item: ApiTestItem, providerId: string) {\n\t\tconst existing = this.testItemToInternal.get(item);\n\t\tif (!existing) {\n\t\t\tif (!this.disposed) {\n\t\t\t\tconsole.warn(`Received a TestProvider.onDidChangeTest for a test that wasn't seen before as a child.`);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tthis.addItem(item, providerId, existing.parent);\n\t\tthis.debounceSendDiff.schedule();\n\t}\n\n\t/**\n\t * Gets a diff of all changes that have been made, and clears the diff queue.\n\t */\n\tpublic collectDiff() {\n\t\tconst diff = this.diff;\n\t\tthis.diff = [];\n\t\treturn diff;\n\t}\n\n\t/**\n\t * Pushes a new diff entry onto the collected diff list.\n\t */\n\tpublic pushDiff(diff: TestsDiffOp) {\n\t\tthis.diff.push(diff);\n\t\tthis.debounceSendDiff.schedule();\n\t}\n\n\tpublic dispose() {\n\t\tfor (const item of this.testItemToInternal.values()) {\n\t\t\tthis.testIdToInternal.delete(item.id);\n\t\t}\n\n\t\tthis.diff = [];\n\t\tthis.disposed = true;\n\t}\n\n\tprotected getId(): string {\n\t\treturn generateUuid();\n\t}\n\n\tprivate addItem(actual: ApiTestItem, providerId: string, parent: string | null) {\n\t\tlet internal = this.testItemToInternal.get(actual);\n\t\tconst parentItem = parent ? this.testIdToInternal.get(parent) : null;\n\t\tif (!internal) {\n\t\t\tinternal = {\n\t\t\t\tactual,\n\t\t\t\tid: this.getId(),\n\t\t\t\tparent,\n\t\t\t\titem: TestItem.from(actual, parentItem?.item.extId),\n\t\t\t\tproviderId,\n\t\t\t\tpreviousChildren: new Set(),\n\t\t\t\tpreviousEquals: itemEqualityComparator(actual),\n\t\t\t};\n\n\t\t\tthis.testItemToInternal.set(actual, internal);\n\t\t\tthis.testIdToInternal.set(internal.id, internal);\n\t\t\tthis.diff.push([TestDiffOpType.Add, { id: internal.id, parent, providerId, item: internal.item }]);\n\t\t} else if (!internal.previousEquals(actual)) {\n\t\t\tinternal.item = TestItem.from(actual, parentItem?.item.extId);\n\t\t\tinternal.previousEquals = itemEqualityComparator(actual);\n\t\t\tthis.diff.push([TestDiffOpType.Update, { id: internal.id, parent, providerId, item: internal.item }]);\n\t\t}\n\n\t\t// If there are children, track which ones are deleted\n\t\t// and recursively and/update them.\n\t\tif (actual.children) {\n\t\t\tconst deletedChildren = internal.previousChildren;\n\t\t\tconst currentChildren = new Set<string>();\n\t\t\tfor (const child of actual.children) {\n\t\t\t\tconst c = this.addItem(child, providerId, internal.id);\n\t\t\t\tdeletedChildren.delete(c.id);\n\t\t\t\tcurrentChildren.add(c.id);\n\t\t\t}\n\n\t\t\tfor (const child of deletedChildren) {\n\t\t\t\tthis.removeItembyId(child);\n\t\t\t}\n\n\t\t\tinternal.previousChildren = currentChildren;\n\t\t}\n\n\n\t\treturn internal;\n\t}\n\n\tprivate removeItembyId(id: string) {\n\t\tthis.diff.push([TestDiffOpType.Remove, id]);\n\n\t\tconst queue = [this.testIdToInternal.get(id)];\n\t\twhile (queue.length) {\n\t\t\tconst item = queue.pop();\n\t\t\tif (!item) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis.testIdToInternal.delete(item.id);\n\t\t\tthis.testItemToInternal.delete(item.actual);\n\t\t\tfor (const child of item.previousChildren) {\n\t\t\t\tqueue.push(this.testIdToInternal.get(child));\n\t\t\t}\n\t\t}\n\t}\n\n\t@throttle(200)\n\tprotected throttleSendDiff() {\n\t\tthis.flushDiff();\n\t}\n\n\tpublic flushDiff() {\n\t\tconst diff = this.collectDiff();\n\t\tif (diff.length) {\n\t\t\tthis.publishDiff(diff);\n\t\t}\n\t}\n}\n\nconst keyMap: { [K in keyof Omit<RequiredTestItem, 'children'>]: null } = {\n\tid: null,\n\tlabel: null,\n\tlocation: null,\n\tstate: null,\n\tdebuggable: null,\n\tdescription: null,\n\trunnable: null\n};\n\nconst simpleProps = Object.keys(keyMap) as ReadonlyArray<keyof typeof keyMap>;\n\nconst itemEqualityComparator = (a: ApiTestItem) => {\n\tconst values: unknown[] = [];\n\tfor (const prop of simpleProps) {\n\t\tvalues.push(a[prop]);\n\t}\n\n\treturn (b: ApiTestItem) => {\n\t\tfor (let i = 0; i < simpleProps.length; i++) {\n\t\t\tif (values[i] !== b[simpleProps[i]]) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t};\n};\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ExtensionIdentifier, IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { Emitter } from 'vs/base/common/event';\nimport * as path from 'vs/base/common/path';\n\nexport class DeltaExtensionsResult {\n\tconstructor(\n\t\tpublic readonly removedDueToLooping: IExtensionDescription[]\n\t) { }\n}\n\nexport class ExtensionDescriptionRegistry {\n\tprivate readonly _onDidChange = new Emitter<void>();\n\tpublic readonly onDidChange = this._onDidChange.event;\n\n\tprivate _extensionDescriptions: IExtensionDescription[];\n\tprivate _extensionsMap!: Map<string, IExtensionDescription>;\n\tprivate _extensionsArr!: IExtensionDescription[];\n\tprivate _activationMap!: Map<string, IExtensionDescription[]>;\n\n\tconstructor(extensionDescriptions: IExtensionDescription[]) {\n\t\tthis._extensionDescriptions = extensionDescriptions;\n\t\tthis._initialize();\n\t}\n\n\tprivate _initialize(): void {\n\t\t// Ensure extensions are stored in the order: builtin, user, under development\n\t\tthis._extensionDescriptions.sort(extensionCmp);\n\n\t\tthis._extensionsMap = new Map<string, IExtensionDescription>();\n\t\tthis._extensionsArr = [];\n\t\tthis._activationMap = new Map<string, IExtensionDescription[]>();\n\n\t\tfor (const extensionDescription of this._extensionDescriptions) {\n\t\t\tif (this._extensionsMap.has(ExtensionIdentifier.toKey(extensionDescription.identifier))) {\n\t\t\t\t// No overwriting allowed!\n\t\t\t\tconsole.error('Extension `' + extensionDescription.identifier.value + '` is already registered');\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis._extensionsMap.set(ExtensionIdentifier.toKey(extensionDescription.identifier), extensionDescription);\n\t\t\tthis._extensionsArr.push(extensionDescription);\n\n\t\t\tif (Array.isArray(extensionDescription.activationEvents)) {\n\t\t\t\tfor (let activationEvent of extensionDescription.activationEvents) {\n\t\t\t\t\t// TODO@joao: there's no easy way to contribute this\n\t\t\t\t\tif (activationEvent === 'onUri') {\n\t\t\t\t\t\tactivationEvent = `onUri:${ExtensionIdentifier.toKey(extensionDescription.identifier)}`;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this._activationMap.has(activationEvent)) {\n\t\t\t\t\t\tthis._activationMap.set(activationEvent, []);\n\t\t\t\t\t}\n\t\t\t\t\tthis._activationMap.get(activationEvent)!.push(extensionDescription);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic keepOnly(extensionIds: ExtensionIdentifier[]): void {\n\t\tconst toKeep = new Set<string>();\n\t\textensionIds.forEach(extensionId => toKeep.add(ExtensionIdentifier.toKey(extensionId)));\n\t\tthis._extensionDescriptions = this._extensionDescriptions.filter(extension => toKeep.has(ExtensionIdentifier.toKey(extension.identifier)));\n\t\tthis._initialize();\n\t\tthis._onDidChange.fire(undefined);\n\t}\n\n\tpublic deltaExtensions(toAdd: IExtensionDescription[], toRemove: ExtensionIdentifier[]): DeltaExtensionsResult {\n\t\tif (toAdd.length > 0) {\n\t\t\tthis._extensionDescriptions = this._extensionDescriptions.concat(toAdd);\n\t\t}\n\n\t\t// Immediately remove looping extensions!\n\t\tconst looping = ExtensionDescriptionRegistry._findLoopingExtensions(this._extensionDescriptions);\n\t\ttoRemove = toRemove.concat(looping.map(ext => ext.identifier));\n\n\t\tif (toRemove.length > 0) {\n\t\t\tconst toRemoveSet = new Set<string>();\n\t\t\ttoRemove.forEach(extensionId => toRemoveSet.add(ExtensionIdentifier.toKey(extensionId)));\n\t\t\tthis._extensionDescriptions = this._extensionDescriptions.filter(extension => !toRemoveSet.has(ExtensionIdentifier.toKey(extension.identifier)));\n\t\t}\n\n\t\tthis._initialize();\n\t\tthis._onDidChange.fire(undefined);\n\t\treturn new DeltaExtensionsResult(looping);\n\t}\n\n\tprivate static _findLoopingExtensions(extensionDescriptions: IExtensionDescription[]): IExtensionDescription[] {\n\t\tconst G = new class {\n\n\t\t\tprivate _arcs = new Map<string, string[]>();\n\t\t\tprivate _nodesSet = new Set<string>();\n\t\t\tprivate _nodesArr: string[] = [];\n\n\t\t\taddNode(id: string): void {\n\t\t\t\tif (!this._nodesSet.has(id)) {\n\t\t\t\t\tthis._nodesSet.add(id);\n\t\t\t\t\tthis._nodesArr.push(id);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\taddArc(from: string, to: string): void {\n\t\t\t\tthis.addNode(from);\n\t\t\t\tthis.addNode(to);\n\t\t\t\tif (this._arcs.has(from)) {\n\t\t\t\t\tthis._arcs.get(from)!.push(to);\n\t\t\t\t} else {\n\t\t\t\t\tthis._arcs.set(from, [to]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tgetArcs(id: string): string[] {\n\t\t\t\tif (this._arcs.has(id)) {\n\t\t\t\t\treturn this._arcs.get(id)!;\n\t\t\t\t}\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\thasOnlyGoodArcs(id: string, good: Set<string>): boolean {\n\t\t\t\tconst dependencies = G.getArcs(id);\n\t\t\t\tfor (let i = 0; i < dependencies.length; i++) {\n\t\t\t\t\tif (!good.has(dependencies[i])) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tgetNodes(): string[] {\n\t\t\t\treturn this._nodesArr;\n\t\t\t}\n\t\t};\n\n\t\tlet descs = new Map<string, IExtensionDescription>();\n\t\tfor (let extensionDescription of extensionDescriptions) {\n\t\t\tconst extensionId = ExtensionIdentifier.toKey(extensionDescription.identifier);\n\t\t\tdescs.set(extensionId, extensionDescription);\n\t\t\tif (extensionDescription.extensionDependencies) {\n\t\t\t\tfor (let _depId of extensionDescription.extensionDependencies) {\n\t\t\t\t\tconst depId = ExtensionIdentifier.toKey(_depId);\n\t\t\t\t\tG.addArc(extensionId, depId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// initialize with all extensions with no dependencies.\n\t\tlet good = new Set<string>();\n\t\tG.getNodes().filter(id => G.getArcs(id).length === 0).forEach(id => good.add(id));\n\n\t\t// all other extensions will be processed below.\n\t\tlet nodes = G.getNodes().filter(id => !good.has(id));\n\n\t\tlet madeProgress: boolean;\n\t\tdo {\n\t\t\tmadeProgress = false;\n\n\t\t\t// find one extension which has only good deps\n\t\t\tfor (let i = 0; i < nodes.length; i++) {\n\t\t\t\tconst id = nodes[i];\n\n\t\t\t\tif (G.hasOnlyGoodArcs(id, good)) {\n\t\t\t\t\tnodes.splice(i, 1);\n\t\t\t\t\ti--;\n\t\t\t\t\tgood.add(id);\n\t\t\t\t\tmadeProgress = true;\n\t\t\t\t}\n\t\t\t}\n\t\t} while (madeProgress);\n\n\t\t// The remaining nodes are bad and have loops\n\t\treturn nodes.map(id => descs.get(id)!);\n\t}\n\n\tpublic containsActivationEvent(activationEvent: string): boolean {\n\t\treturn this._activationMap.has(activationEvent);\n\t}\n\n\tpublic containsExtension(extensionId: ExtensionIdentifier): boolean {\n\t\treturn this._extensionsMap.has(ExtensionIdentifier.toKey(extensionId));\n\t}\n\n\tpublic getExtensionDescriptionsForActivationEvent(activationEvent: string): IExtensionDescription[] {\n\t\tconst extensions = this._activationMap.get(activationEvent);\n\t\treturn extensions ? extensions.slice(0) : [];\n\t}\n\n\tpublic getAllExtensionDescriptions(): IExtensionDescription[] {\n\t\treturn this._extensionsArr.slice(0);\n\t}\n\n\tpublic getExtensionDescription(extensionId: ExtensionIdentifier | string): IExtensionDescription | undefined {\n\t\tconst extension = this._extensionsMap.get(ExtensionIdentifier.toKey(extensionId));\n\t\treturn extension ? extension : undefined;\n\t}\n}\n\nconst enum SortBucket {\n\tBuiltin = 0,\n\tUser = 1,\n\tDev = 2\n}\n\n/**\n * Ensure that:\n * - first are builtin extensions\n * - second are user extensions\n * - third are extensions under development\n *\n * In each bucket, extensions must be sorted alphabetically by their folder name.\n */\nfunction extensionCmp(a: IExtensionDescription, b: IExtensionDescription): number {\n\tconst aSortBucket = (a.isBuiltin ? SortBucket.Builtin : a.isUnderDevelopment ? SortBucket.Dev : SortBucket.User);\n\tconst bSortBucket = (b.isBuiltin ? SortBucket.Builtin : b.isUnderDevelopment ? SortBucket.Dev : SortBucket.User);\n\tif (aSortBucket !== bSortBucket) {\n\t\treturn aSortBucket - bSortBucket;\n\t}\n\tconst aLastSegment = path.posix.basename(a.extensionLocation.path);\n\tconst bLastSegment = path.posix.basename(b.extensionLocation.path);\n\tif (aLastSegment < bLastSegment) {\n\t\treturn -1;\n\t}\n\tif (aLastSegment > bLastSegment) {\n\t\treturn 1;\n\t}\n\treturn 0;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { VSBuffer } from 'vs/base/common/buffer';\n\nexport const enum ExtensionHostExitCode {\n\t// nodejs uses codes 1-13 and exit codes >128 are signal exits\n\tVersionMismatch = 55,\n\tStartTimeout60s = 56,\n\tUnexpectedError = 81,\n}\n\nexport interface IExtHostReadyMessage {\n\ttype: 'VSCODE_EXTHOST_IPC_READY';\n}\n\nexport interface IExtHostSocketMessage {\n\ttype: 'VSCODE_EXTHOST_IPC_SOCKET';\n\tinitialDataChunk: string;\n\tskipWebSocketFrames: boolean;\n\tpermessageDeflate: boolean;\n\tinflateBytes: string;\n}\n\nexport interface IExtHostReduceGraceTimeMessage {\n\ttype: 'VSCODE_EXTHOST_IPC_REDUCE_GRACE_TIME';\n}\n\nexport const enum MessageType {\n\tInitialized,\n\tReady,\n\tTerminate\n}\n\nexport function createMessageOfType(type: MessageType): VSBuffer {\n\tconst result = VSBuffer.alloc(1);\n\n\tswitch (type) {\n\t\tcase MessageType.Initialized: result.writeUInt8(1, 0); break;\n\t\tcase MessageType.Ready: result.writeUInt8(2, 0); break;\n\t\tcase MessageType.Terminate: result.writeUInt8(3, 0); break;\n\t}\n\n\treturn result;\n}\n\nexport function isMessageOfType(message: VSBuffer, type: MessageType): boolean {\n\tif (message.byteLength !== 1) {\n\t\treturn false;\n\t}\n\n\tswitch (message.readUInt8(0)) {\n\t\tcase 1: return type === MessageType.Initialized;\n\t\tcase 2: return type === MessageType.Ready;\n\t\tcase 3: return type === MessageType.Terminate;\n\t\tdefault: return false;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Event } from 'vs/base/common/event';\nimport Severity from 'vs/base/common/severity';\nimport { URI } from 'vs/base/common/uri';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { IExtensionPoint } from 'vs/workbench/services/extensions/common/extensionsRegistry';\nimport { ExtensionIdentifier, IExtension, ExtensionType, IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { getGalleryExtensionId } from 'vs/platform/extensionManagement/common/extensionManagementUtil';\nimport { IMessagePassingProtocol } from 'vs/base/parts/ipc/common/ipc';\nimport { ExtensionActivationReason } from 'vs/workbench/api/common/extHostExtensionActivator';\n\nexport const nullExtensionDescription = Object.freeze(<IExtensionDescription>{\n\tidentifier: new ExtensionIdentifier('nullExtensionDescription'),\n\tname: 'Null Extension Description',\n\tversion: '0.0.0',\n\tpublisher: 'vscode',\n\tenableProposedApi: false,\n\tengines: { vscode: '' },\n\textensionLocation: URI.parse('void:location'),\n\tisBuiltin: false,\n});\n\nexport const webWorkerExtHostConfig = 'extensions.webWorker';\n\nexport const IExtensionService = createDecorator<IExtensionService>('extensionService');\n\nexport interface IMessage {\n\ttype: Severity;\n\tmessage: string;\n\textensionId: ExtensionIdentifier;\n\textensionPointId: string;\n}\n\nexport interface IExtensionsStatus {\n\tmessages: IMessage[];\n\tactivationTimes: ActivationTimes | undefined;\n\truntimeErrors: Error[];\n}\n\nexport type ExtensionActivationError = string | MissingDependencyError;\nexport class MissingDependencyError {\n\tconstructor(readonly dependency: string) { }\n}\n\n/**\n * e.g.\n * ```\n * {\n *    startTime: 1511954813493000,\n *    endTime: 1511954835590000,\n *    deltas: [ 100, 1500, 123456, 1500, 100000 ],\n *    ids: [ 'idle', 'self', 'extension1', 'self', 'idle' ]\n * }\n * ```\n */\nexport interface IExtensionHostProfile {\n\t/**\n\t * Profiling start timestamp in microseconds.\n\t */\n\tstartTime: number;\n\t/**\n\t * Profiling end timestamp in microseconds.\n\t */\n\tendTime: number;\n\t/**\n\t * Duration of segment in microseconds.\n\t */\n\tdeltas: number[];\n\t/**\n\t * Segment identifier: extension id or one of the four known strings.\n\t */\n\tids: ProfileSegmentId[];\n\n\t/**\n\t * Get the information as a .cpuprofile.\n\t */\n\tdata: object;\n\n\t/**\n\t * Get the aggregated time per segmentId\n\t */\n\tgetAggregatedTimes(): Map<ProfileSegmentId, number>;\n}\n\nexport const enum ExtensionHostKind {\n\tLocalProcess,\n\tLocalWebWorker,\n\tRemote\n}\n\nexport interface IExtensionHost {\n\treadonly kind: ExtensionHostKind;\n\treadonly remoteAuthority: string | null;\n\treadonly onExit: Event<[number, string | null]>;\n\n\tstart(): Promise<IMessagePassingProtocol> | null;\n\tgetInspectPort(): number | undefined;\n\tenableInspectPort(): Promise<boolean>;\n\tdispose(): void;\n}\n\n\n/**\n * Extension id or one of the four known program states.\n */\nexport type ProfileSegmentId = string | 'idle' | 'program' | 'gc' | 'self';\n\nexport class ActivationTimes {\n\tconstructor(\n\t\tpublic readonly codeLoadingTime: number,\n\t\tpublic readonly activateCallTime: number,\n\t\tpublic readonly activateResolvedTime: number,\n\t\tpublic readonly activationReason: ExtensionActivationReason\n\t) {\n\t}\n}\n\nexport class ExtensionPointContribution<T> {\n\treadonly description: IExtensionDescription;\n\treadonly value: T;\n\n\tconstructor(description: IExtensionDescription, value: T) {\n\t\tthis.description = description;\n\t\tthis.value = value;\n\t}\n}\n\nexport const ExtensionHostLogFileName = 'exthost';\n\nexport interface IWillActivateEvent {\n\treadonly event: string;\n\treadonly activation: Promise<void>;\n}\n\nexport interface IResponsiveStateChangeEvent {\n\tisResponsive: boolean;\n}\n\nexport const enum ActivationKind {\n\tNormal = 0,\n\tImmediate = 1\n}\n\nexport interface IExtensionService {\n\treadonly _serviceBrand: undefined;\n\n\t/**\n\t * An event emitted when extensions are registered after their extension points got handled.\n\t *\n\t * This event will also fire on startup to signal the installed extensions.\n\t *\n\t * @returns the extensions that got registered\n\t */\n\tonDidRegisterExtensions: Event<void>;\n\n\t/**\n\t * @event\n\t * Fired when extensions status changes.\n\t * The event contains the ids of the extensions that have changed.\n\t */\n\tonDidChangeExtensionsStatus: Event<ExtensionIdentifier[]>;\n\n\t/**\n\t * Fired when the available extensions change (i.e. when extensions are added or removed).\n\t */\n\tonDidChangeExtensions: Event<void>;\n\n\t/**\n\t * An event that is fired when activation happens.\n\t */\n\tonWillActivateByEvent: Event<IWillActivateEvent>;\n\n\t/**\n\t * An event that is fired when an extension host changes its\n\t * responsive-state.\n\t */\n\tonDidChangeResponsiveChange: Event<IResponsiveStateChangeEvent>;\n\n\t/**\n\t * Send an activation event and activate interested extensions.\n\t *\n\t * This will wait for the normal startup of the extension host(s).\n\t *\n\t * In extraordinary circumstances, if the activation event needs to activate\n\t * one or more extensions before the normal startup is finished, then you can use\n\t * `ActivationKind.Immediate`. Please do not use this flag unless really necessary\n\t * and you understand all consequences.\n\t */\n\tactivateByEvent(activationEvent: string, activationKind?: ActivationKind): Promise<void>;\n\n\t/**\n\t * An promise that resolves when the installed extensions are registered after\n\t * their extension points got handled.\n\t */\n\twhenInstalledExtensionsRegistered(): Promise<boolean>;\n\n\t/**\n\t * Return all registered extensions\n\t */\n\tgetExtensions(): Promise<IExtensionDescription[]>;\n\n\t/**\n\t * Return a specific extension\n\t * @param id An extension id\n\t */\n\tgetExtension(id: string): Promise<IExtensionDescription | undefined>;\n\n\t/**\n\t * Returns `true` if the given extension can be added. Otherwise `false`.\n\t * @param extension An extension\n\t */\n\tcanAddExtension(extension: IExtensionDescription): boolean;\n\n\t/**\n\t * Returns `true` if the given extension can be removed. Otherwise `false`.\n\t * @param extension An extension\n\t */\n\tcanRemoveExtension(extension: IExtensionDescription): boolean;\n\n\t/**\n\t * Read all contributions to an extension point.\n\t */\n\treadExtensionPointContributions<T>(extPoint: IExtensionPoint<T>): Promise<ExtensionPointContribution<T>[]>;\n\n\t/**\n\t * Get information about extensions status.\n\t */\n\tgetExtensionsStatus(): { [id: string]: IExtensionsStatus };\n\n\t/**\n\t * Return the inspect port or `0`, the latter means inspection\n\t * is not possible.\n\t */\n\tgetInspectPort(tryEnableInspector: boolean): Promise<number>;\n\n\t/**\n\t * Restarts the extension host.\n\t */\n\trestartExtensionHost(): void;\n\n\t/**\n\t * Modify the environment of the remote extension host\n\t * @param env New properties for the remote extension host\n\t */\n\tsetRemoteEnvironment(env: { [key: string]: string | null }): Promise<void>;\n\n\t_logOrShowMessage(severity: Severity, msg: string): void;\n\t_activateById(extensionId: ExtensionIdentifier, reason: ExtensionActivationReason): Promise<void>;\n\t_onWillActivateExtension(extensionId: ExtensionIdentifier): void;\n\t_onDidActivateExtension(extensionId: ExtensionIdentifier, codeLoadingTime: number, activateCallTime: number, activateResolvedTime: number, activationReason: ExtensionActivationReason): void;\n\t_onExtensionRuntimeError(extensionId: ExtensionIdentifier, err: Error): void;\n\t_onExtensionHostExit(code: number): void;\n}\n\nexport interface ProfileSession {\n\tstop(): Promise<IExtensionHostProfile>;\n}\n\nexport function checkProposedApiEnabled(extension: IExtensionDescription): void {\n\tif (!extension.enableProposedApi) {\n\t\tthrowProposedApiError(extension);\n\t}\n}\n\nexport function throwProposedApiError(extension: IExtensionDescription): never {\n\tthrow new Error(`[${extension.identifier.value}]: Proposed API is only available when running out of dev or with the following command line switch: --enable-proposed-api ${extension.identifier.value}`);\n}\n\nexport function toExtension(extensionDescription: IExtensionDescription): IExtension {\n\treturn {\n\t\ttype: extensionDescription.isBuiltin ? ExtensionType.System : ExtensionType.User,\n\t\tisBuiltin: extensionDescription.isBuiltin || extensionDescription.isUserBuiltin,\n\t\tidentifier: { id: getGalleryExtensionId(extensionDescription.publisher, extensionDescription.name), uuid: extensionDescription.uuid },\n\t\tmanifest: extensionDescription,\n\t\tlocation: extensionDescription.extensionLocation,\n\t};\n}\n\nexport function toExtensionDescription(extension: IExtension): IExtensionDescription {\n\treturn {\n\t\tidentifier: new ExtensionIdentifier(extension.identifier.id),\n\t\tisBuiltin: extension.type === ExtensionType.System,\n\t\tisUserBuiltin: extension.type === ExtensionType.User && extension.isBuiltin,\n\t\tisUnderDevelopment: false,\n\t\textensionLocation: extension.location,\n\t\t...extension.manifest,\n\t\tuuid: extension.identifier.uuid\n\t};\n}\n\n\nexport class NullExtensionService implements IExtensionService {\n\tdeclare readonly _serviceBrand: undefined;\n\tonDidRegisterExtensions: Event<void> = Event.None;\n\tonDidChangeExtensionsStatus: Event<ExtensionIdentifier[]> = Event.None;\n\tonDidChangeExtensions: Event<void> = Event.None;\n\tonWillActivateByEvent: Event<IWillActivateEvent> = Event.None;\n\tonDidChangeResponsiveChange: Event<IResponsiveStateChangeEvent> = Event.None;\n\tactivateByEvent(_activationEvent: string): Promise<void> { return Promise.resolve(undefined); }\n\twhenInstalledExtensionsRegistered(): Promise<boolean> { return Promise.resolve(true); }\n\tgetExtensions(): Promise<IExtensionDescription[]> { return Promise.resolve([]); }\n\tgetExtension() { return Promise.resolve(undefined); }\n\treadExtensionPointContributions<T>(_extPoint: IExtensionPoint<T>): Promise<ExtensionPointContribution<T>[]> { return Promise.resolve(Object.create(null)); }\n\tgetExtensionsStatus(): { [id: string]: IExtensionsStatus; } { return Object.create(null); }\n\tgetInspectPort(_tryEnableInspector: boolean): Promise<number> { return Promise.resolve(0); }\n\trestartExtensionHost(): void { }\n\tasync setRemoteEnvironment(_env: { [key: string]: string | null }): Promise<void> { }\n\tcanAddExtension(): boolean { return false; }\n\tcanRemoveExtension(): boolean { return false; }\n\t_logOrShowMessage(_severity: Severity, _msg: string): void { }\n\t_activateById(_extensionId: ExtensionIdentifier, _reason: ExtensionActivationReason): Promise<void> { return Promise.resolve(); }\n\t_onWillActivateExtension(_extensionId: ExtensionIdentifier): void { }\n\t_onDidActivateExtension(_extensionId: ExtensionIdentifier, _codeLoadingTime: number, _activateCallTime: number, _activateResolvedTime: number, _activationReason: ExtensionActivationReason): void { }\n\t_onExtensionRuntimeError(_extensionId: ExtensionIdentifier, _err: Error): void { }\n\t_onExtensionHostExit(code: number): void { }\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as nls from 'vs/nls';\nimport type * as vscode from 'vscode';\nimport { IDisposable } from 'vs/base/common/lifecycle';\nimport { ExtensionDescriptionRegistry } from 'vs/workbench/services/extensions/common/extensionDescriptionRegistry';\nimport { ExtensionIdentifier } from 'vs/platform/extensions/common/extensions';\nimport { ExtensionActivationError, MissingDependencyError } from 'vs/workbench/services/extensions/common/extensions';\nimport { ILogService } from 'vs/platform/log/common/log';\n\nconst NO_OP_VOID_PROMISE = Promise.resolve<void>(undefined);\n\n/**\n * Represents the source code (module) of an extension.\n */\nexport interface IExtensionModule {\n\tactivate?(ctx: vscode.ExtensionContext): Promise<IExtensionAPI>;\n\tdeactivate?(): void;\n}\n\n/**\n * Represents the API of an extension (return value of `activate`).\n */\nexport interface IExtensionAPI {\n\t// _extensionAPIBrand: any;\n}\n\nexport type ExtensionActivationTimesFragment = {\n\tstartup?: { classification: 'SystemMetaData', purpose: 'PerformanceAndHealth', isMeasurement: true };\n\tcodeLoadingTime?: { classification: 'SystemMetaData', purpose: 'PerformanceAndHealth', isMeasurement: true };\n\tactivateCallTime?: { classification: 'SystemMetaData', purpose: 'PerformanceAndHealth', isMeasurement: true };\n\tactivateResolvedTime?: { classification: 'SystemMetaData', purpose: 'PerformanceAndHealth', isMeasurement: true };\n};\n\nexport class ExtensionActivationTimes {\n\n\tpublic static readonly NONE = new ExtensionActivationTimes(false, -1, -1, -1);\n\n\tpublic readonly startup: boolean;\n\tpublic readonly codeLoadingTime: number;\n\tpublic readonly activateCallTime: number;\n\tpublic readonly activateResolvedTime: number;\n\n\tconstructor(startup: boolean, codeLoadingTime: number, activateCallTime: number, activateResolvedTime: number) {\n\t\tthis.startup = startup;\n\t\tthis.codeLoadingTime = codeLoadingTime;\n\t\tthis.activateCallTime = activateCallTime;\n\t\tthis.activateResolvedTime = activateResolvedTime;\n\t}\n}\n\nexport class ExtensionActivationTimesBuilder {\n\n\tprivate readonly _startup: boolean;\n\tprivate _codeLoadingStart: number;\n\tprivate _codeLoadingStop: number;\n\tprivate _activateCallStart: number;\n\tprivate _activateCallStop: number;\n\tprivate _activateResolveStart: number;\n\tprivate _activateResolveStop: number;\n\n\tconstructor(startup: boolean) {\n\t\tthis._startup = startup;\n\t\tthis._codeLoadingStart = -1;\n\t\tthis._codeLoadingStop = -1;\n\t\tthis._activateCallStart = -1;\n\t\tthis._activateCallStop = -1;\n\t\tthis._activateResolveStart = -1;\n\t\tthis._activateResolveStop = -1;\n\t}\n\n\tprivate _delta(start: number, stop: number): number {\n\t\tif (start === -1 || stop === -1) {\n\t\t\treturn -1;\n\t\t}\n\t\treturn stop - start;\n\t}\n\n\tpublic build(): ExtensionActivationTimes {\n\t\treturn new ExtensionActivationTimes(\n\t\t\tthis._startup,\n\t\t\tthis._delta(this._codeLoadingStart, this._codeLoadingStop),\n\t\t\tthis._delta(this._activateCallStart, this._activateCallStop),\n\t\t\tthis._delta(this._activateResolveStart, this._activateResolveStop)\n\t\t);\n\t}\n\n\tpublic codeLoadingStart(): void {\n\t\tthis._codeLoadingStart = Date.now();\n\t}\n\n\tpublic codeLoadingStop(): void {\n\t\tthis._codeLoadingStop = Date.now();\n\t}\n\n\tpublic activateCallStart(): void {\n\t\tthis._activateCallStart = Date.now();\n\t}\n\n\tpublic activateCallStop(): void {\n\t\tthis._activateCallStop = Date.now();\n\t}\n\n\tpublic activateResolveStart(): void {\n\t\tthis._activateResolveStart = Date.now();\n\t}\n\n\tpublic activateResolveStop(): void {\n\t\tthis._activateResolveStop = Date.now();\n\t}\n}\n\nexport class ActivatedExtension {\n\n\tpublic readonly activationFailed: boolean;\n\tpublic readonly activationFailedError: Error | null;\n\tpublic readonly activationTimes: ExtensionActivationTimes;\n\tpublic readonly module: IExtensionModule;\n\tpublic readonly exports: IExtensionAPI | undefined;\n\tpublic readonly subscriptions: IDisposable[];\n\n\tconstructor(\n\t\tactivationFailed: boolean,\n\t\tactivationFailedError: Error | null,\n\t\tactivationTimes: ExtensionActivationTimes,\n\t\tmodule: IExtensionModule,\n\t\texports: IExtensionAPI | undefined,\n\t\tsubscriptions: IDisposable[]\n\t) {\n\t\tthis.activationFailed = activationFailed;\n\t\tthis.activationFailedError = activationFailedError;\n\t\tthis.activationTimes = activationTimes;\n\t\tthis.module = module;\n\t\tthis.exports = exports;\n\t\tthis.subscriptions = subscriptions;\n\t}\n}\n\nexport class EmptyExtension extends ActivatedExtension {\n\tconstructor(activationTimes: ExtensionActivationTimes) {\n\t\tsuper(false, null, activationTimes, { activate: undefined, deactivate: undefined }, undefined, []);\n\t}\n}\n\nexport class HostExtension extends ActivatedExtension {\n\tconstructor() {\n\t\tsuper(false, null, ExtensionActivationTimes.NONE, { activate: undefined, deactivate: undefined }, undefined, []);\n\t}\n}\n\nexport class FailedExtension extends ActivatedExtension {\n\tconstructor(activationError: Error) {\n\t\tsuper(true, activationError, ExtensionActivationTimes.NONE, { activate: undefined, deactivate: undefined }, undefined, []);\n\t}\n}\n\nexport interface IExtensionsActivatorHost {\n\tonExtensionActivationError(extensionId: ExtensionIdentifier, error: ExtensionActivationError): void;\n\tactualActivateExtension(extensionId: ExtensionIdentifier, reason: ExtensionActivationReason): Promise<ActivatedExtension>;\n}\n\nexport interface ExtensionActivationReason {\n\treadonly startup: boolean;\n\treadonly extensionId: ExtensionIdentifier;\n\treadonly activationEvent: string;\n}\n\ntype ActivationIdAndReason = { id: ExtensionIdentifier, reason: ExtensionActivationReason };\n\nexport class ExtensionsActivator {\n\n\tprivate readonly _registry: ExtensionDescriptionRegistry;\n\tprivate readonly _resolvedExtensionsSet: Set<string>;\n\tprivate readonly _hostExtensionsMap: Map<string, ExtensionIdentifier>;\n\tprivate readonly _host: IExtensionsActivatorHost;\n\tprivate readonly _activatingExtensions: Map<string, Promise<void>>;\n\tprivate readonly _activatedExtensions: Map<string, ActivatedExtension>;\n\t/**\n\t * A map of already activated events to speed things up if the same activation event is triggered multiple times.\n\t */\n\tprivate readonly _alreadyActivatedEvents: { [activationEvent: string]: boolean; };\n\n\tconstructor(\n\t\tregistry: ExtensionDescriptionRegistry,\n\t\tresolvedExtensions: ExtensionIdentifier[],\n\t\thostExtensions: ExtensionIdentifier[],\n\t\thost: IExtensionsActivatorHost,\n\t\t@ILogService private readonly _logService: ILogService\n\t) {\n\t\tthis._registry = registry;\n\t\tthis._resolvedExtensionsSet = new Set<string>();\n\t\tresolvedExtensions.forEach((extensionId) => this._resolvedExtensionsSet.add(ExtensionIdentifier.toKey(extensionId)));\n\t\tthis._hostExtensionsMap = new Map<string, ExtensionIdentifier>();\n\t\thostExtensions.forEach((extensionId) => this._hostExtensionsMap.set(ExtensionIdentifier.toKey(extensionId), extensionId));\n\t\tthis._host = host;\n\t\tthis._activatingExtensions = new Map<string, Promise<void>>();\n\t\tthis._activatedExtensions = new Map<string, ActivatedExtension>();\n\t\tthis._alreadyActivatedEvents = Object.create(null);\n\t}\n\n\tpublic isActivated(extensionId: ExtensionIdentifier): boolean {\n\t\tconst extensionKey = ExtensionIdentifier.toKey(extensionId);\n\n\t\treturn this._activatedExtensions.has(extensionKey);\n\t}\n\n\tpublic getActivatedExtension(extensionId: ExtensionIdentifier): ActivatedExtension {\n\t\tconst extensionKey = ExtensionIdentifier.toKey(extensionId);\n\n\t\tconst activatedExtension = this._activatedExtensions.get(extensionKey);\n\t\tif (!activatedExtension) {\n\t\t\tthrow new Error('Extension `' + extensionId.value + '` is not known or not activated');\n\t\t}\n\t\treturn activatedExtension;\n\t}\n\n\tpublic activateByEvent(activationEvent: string, startup: boolean): Promise<void> {\n\t\tif (this._alreadyActivatedEvents[activationEvent]) {\n\t\t\treturn NO_OP_VOID_PROMISE;\n\t\t}\n\t\tconst activateExtensions = this._registry.getExtensionDescriptionsForActivationEvent(activationEvent);\n\t\treturn this._activateExtensions(activateExtensions.map(e => ({\n\t\t\tid: e.identifier,\n\t\t\treason: { startup, extensionId: e.identifier, activationEvent }\n\t\t}))).then(() => {\n\t\t\tthis._alreadyActivatedEvents[activationEvent] = true;\n\t\t});\n\t}\n\n\tpublic activateById(extensionId: ExtensionIdentifier, reason: ExtensionActivationReason): Promise<void> {\n\t\tconst desc = this._registry.getExtensionDescription(extensionId);\n\t\tif (!desc) {\n\t\t\tthrow new Error('Extension `' + extensionId + '` is not known');\n\t\t}\n\n\t\treturn this._activateExtensions([{\n\t\t\tid: desc.identifier,\n\t\t\treason\n\t\t}]);\n\t}\n\n\t/**\n\t * Handle semantics related to dependencies for `currentExtension`.\n\t * semantics: `redExtensions` must wait for `greenExtensions`.\n\t */\n\tprivate _handleActivateRequest(currentActivation: ActivationIdAndReason, greenExtensions: { [id: string]: ActivationIdAndReason; }, redExtensions: ActivationIdAndReason[]): void {\n\t\tif (this._hostExtensionsMap.has(ExtensionIdentifier.toKey(currentActivation.id))) {\n\t\t\tgreenExtensions[ExtensionIdentifier.toKey(currentActivation.id)] = currentActivation;\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentExtension = this._registry.getExtensionDescription(currentActivation.id);\n\t\tif (!currentExtension) {\n\t\t\t// Error condition 0: unknown extension\n\t\t\tthis._host.onExtensionActivationError(currentActivation.id, new MissingDependencyError(currentActivation.id.value));\n\t\t\tconst error = new Error(`Unknown dependency '${currentActivation.id.value}'`);\n\t\t\tthis._activatedExtensions.set(ExtensionIdentifier.toKey(currentActivation.id), new FailedExtension(error));\n\t\t\treturn;\n\t\t}\n\n\t\tconst depIds = (typeof currentExtension.extensionDependencies === 'undefined' ? [] : currentExtension.extensionDependencies);\n\t\tlet currentExtensionGetsGreenLight = true;\n\n\t\tfor (let j = 0, lenJ = depIds.length; j < lenJ; j++) {\n\t\t\tconst depId = depIds[j];\n\n\t\t\tif (this._resolvedExtensionsSet.has(ExtensionIdentifier.toKey(depId))) {\n\t\t\t\t// This dependency is already resolved\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst dep = this._activatedExtensions.get(ExtensionIdentifier.toKey(depId));\n\t\t\tif (dep && !dep.activationFailed) {\n\t\t\t\t// the dependency is already activated OK\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (dep && dep.activationFailed) {\n\t\t\t\t// Error condition 2: a dependency has already failed activation\n\t\t\t\tthis._host.onExtensionActivationError(currentExtension.identifier, nls.localize('failedDep1', \"Cannot activate extension '{0}' because it depends on extension '{1}', which failed to activate.\", currentExtension.displayName || currentExtension.identifier.value, depId));\n\t\t\t\tconst error = new Error(`Dependency ${depId} failed to activate`);\n\t\t\t\t(<any>error).detail = dep.activationFailedError;\n\t\t\t\tthis._activatedExtensions.set(ExtensionIdentifier.toKey(currentExtension.identifier), new FailedExtension(error));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this._hostExtensionsMap.has(ExtensionIdentifier.toKey(depId))) {\n\t\t\t\t// must first wait for the dependency to activate\n\t\t\t\tcurrentExtensionGetsGreenLight = false;\n\t\t\t\tgreenExtensions[ExtensionIdentifier.toKey(depId)] = {\n\t\t\t\t\tid: this._hostExtensionsMap.get(ExtensionIdentifier.toKey(depId))!,\n\t\t\t\t\treason: currentActivation.reason\n\t\t\t\t};\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst depDesc = this._registry.getExtensionDescription(depId);\n\t\t\tif (depDesc) {\n\t\t\t\t// must first wait for the dependency to activate\n\t\t\t\tcurrentExtensionGetsGreenLight = false;\n\t\t\t\tgreenExtensions[ExtensionIdentifier.toKey(depId)] = {\n\t\t\t\t\tid: depDesc.identifier,\n\t\t\t\t\treason: currentActivation.reason\n\t\t\t\t};\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Error condition 1: unknown dependency\n\t\t\tthis._host.onExtensionActivationError(currentExtension.identifier, new MissingDependencyError(depId));\n\t\t\tconst error = new Error(`Unknown dependency '${depId}'`);\n\t\t\tthis._activatedExtensions.set(ExtensionIdentifier.toKey(currentExtension.identifier), new FailedExtension(error));\n\t\t\treturn;\n\t\t}\n\n\t\tif (currentExtensionGetsGreenLight) {\n\t\t\tgreenExtensions[ExtensionIdentifier.toKey(currentExtension.identifier)] = currentActivation;\n\t\t} else {\n\t\t\tredExtensions.push(currentActivation);\n\t\t}\n\t}\n\n\tprivate _activateExtensions(extensions: ActivationIdAndReason[]): Promise<void> {\n\t\tif (extensions.length === 0) {\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\n\t\textensions = extensions.filter((p) => !this._activatedExtensions.has(ExtensionIdentifier.toKey(p.id)));\n\t\tif (extensions.length === 0) {\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\n\t\tconst greenMap: { [id: string]: ActivationIdAndReason; } = Object.create(null),\n\t\t\tred: ActivationIdAndReason[] = [];\n\n\t\tfor (let i = 0, len = extensions.length; i < len; i++) {\n\t\t\tthis._handleActivateRequest(extensions[i], greenMap, red);\n\t\t}\n\n\t\t// Make sure no red is also green\n\t\tfor (let i = 0, len = red.length; i < len; i++) {\n\t\t\tconst redExtensionKey = ExtensionIdentifier.toKey(red[i].id);\n\t\t\tif (greenMap[redExtensionKey]) {\n\t\t\t\tdelete greenMap[redExtensionKey];\n\t\t\t}\n\t\t}\n\n\t\tconst green = Object.keys(greenMap).map(id => greenMap[id]);\n\n\t\tif (red.length === 0) {\n\t\t\t// Finally reached only leafs!\n\t\t\treturn Promise.all(green.map((p) => this._activateExtension(p.id, p.reason))).then(_ => undefined);\n\t\t}\n\n\t\treturn this._activateExtensions(green).then(_ => {\n\t\t\treturn this._activateExtensions(red);\n\t\t});\n\t}\n\n\tprivate _activateExtension(extensionId: ExtensionIdentifier, reason: ExtensionActivationReason): Promise<void> {\n\t\tconst extensionKey = ExtensionIdentifier.toKey(extensionId);\n\n\t\tif (this._activatedExtensions.has(extensionKey)) {\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\n\t\tconst currentlyActivatingExtension = this._activatingExtensions.get(extensionKey);\n\t\tif (currentlyActivatingExtension) {\n\t\t\treturn currentlyActivatingExtension;\n\t\t}\n\n\t\tconst newlyActivatingExtension = this._host.actualActivateExtension(extensionId, reason).then(undefined, (err) => {\n\t\t\tthis._host.onExtensionActivationError(extensionId, nls.localize('activationError', \"Activating extension '{0}' failed: {1}.\", extensionId.value, err.message));\n\t\t\tthis._logService.error(`Activating extension ${extensionId.value} failed due to an error:`);\n\t\t\tthis._logService.error(err);\n\t\t\t// Treat the extension as being empty\n\t\t\treturn new FailedExtension(err);\n\t\t}).then((x: ActivatedExtension) => {\n\t\t\tthis._activatedExtensions.set(extensionKey, x);\n\t\t\tthis._activatingExtensions.delete(extensionKey);\n\t\t});\n\n\t\tthis._activatingExtensions.set(extensionKey, newlyActivatingExtension);\n\t\treturn newlyActivatingExtension;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ILogService, DelegatedLogService, LogLevel } from 'vs/platform/log/common/log';\nimport { ExtHostLogServiceShape } from 'vs/workbench/api/common/extHost.protocol';\nimport { ExtensionHostLogFileName } from 'vs/workbench/services/extensions/common/extensions';\nimport { IExtHostInitDataService } from 'vs/workbench/api/common/extHostInitDataService';\nimport { Schemas } from 'vs/base/common/network';\nimport { SpdLogService } from 'vs/platform/log/node/spdlogService';\nimport { dirname } from 'vs/base/common/resources';\n\nexport class ExtHostLogService extends DelegatedLogService implements ILogService, ExtHostLogServiceShape {\n\n\tconstructor(\n\t\t@IExtHostInitDataService initData: IExtHostInitDataService,\n\t) {\n\t\tif (initData.logFile.scheme !== Schemas.file) { throw new Error('Only file-logging supported'); }\n\t\tsuper(new SpdLogService(ExtensionHostLogFileName, dirname(initData.logFile).fsPath, initData.logLevel));\n\t}\n\n\t$setLevel(level: LogLevel): void {\n\t\tthis.setLevel(level);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { onUnexpectedError } from 'vs/base/common/errors';\n\nexport class LazyPromise implements Promise<any> {\n\n\tprivate _actual: Promise<any> | null;\n\tprivate _actualOk: ((value?: any) => any) | null;\n\tprivate _actualErr: ((err?: any) => any) | null;\n\n\tprivate _hasValue: boolean;\n\tprivate _value: any;\n\n\tprivate _hasErr: boolean;\n\tprivate _err: any;\n\n\tconstructor() {\n\t\tthis._actual = null;\n\t\tthis._actualOk = null;\n\t\tthis._actualErr = null;\n\t\tthis._hasValue = false;\n\t\tthis._value = null;\n\t\tthis._hasErr = false;\n\t\tthis._err = null;\n\t}\n\n\tget [Symbol.toStringTag](): string {\n\t\treturn this.toString();\n\t}\n\n\tprivate _ensureActual(): Promise<any> {\n\t\tif (!this._actual) {\n\t\t\tthis._actual = new Promise<any>((c, e) => {\n\t\t\t\tthis._actualOk = c;\n\t\t\t\tthis._actualErr = e;\n\n\t\t\t\tif (this._hasValue) {\n\t\t\t\t\tthis._actualOk(this._value);\n\t\t\t\t}\n\n\t\t\t\tif (this._hasErr) {\n\t\t\t\t\tthis._actualErr(this._err);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn this._actual;\n\t}\n\n\tpublic resolveOk(value: any): void {\n\t\tif (this._hasValue || this._hasErr) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._hasValue = true;\n\t\tthis._value = value;\n\n\t\tif (this._actual) {\n\t\t\tthis._actualOk!(value);\n\t\t}\n\t}\n\n\tpublic resolveErr(err: any): void {\n\t\tif (this._hasValue || this._hasErr) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._hasErr = true;\n\t\tthis._err = err;\n\n\t\tif (this._actual) {\n\t\t\tthis._actualErr!(err);\n\t\t} else {\n\t\t\t// If nobody's listening at this point, it is safe to assume they never will,\n\t\t\t// since resolving this promise is always \"async\"\n\t\t\tonUnexpectedError(err);\n\t\t}\n\t}\n\n\tpublic then(success: any, error: any): any {\n\t\treturn this._ensureActual().then(success, error);\n\t}\n\n\tpublic catch(error: any): any {\n\t\treturn this._ensureActual().then(undefined, error);\n\t}\n\n\tpublic finally(callback: () => void): any {\n\t\treturn this._ensureActual().finally(callback);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nexport interface IRPCProtocol {\n\t/**\n\t * Returns a proxy to an object addressable/named in the extension host process or in the renderer process.\n\t */\n\tgetProxy<T>(identifier: ProxyIdentifier<T>): T;\n\n\t/**\n\t * Register manually created instance.\n\t */\n\tset<T, R extends T>(identifier: ProxyIdentifier<T>, instance: R): R;\n\n\t/**\n\t * Assert these identifiers are already registered via `.set`.\n\t */\n\tassertRegistered(identifiers: ProxyIdentifier<any>[]): void;\n\n\t/**\n\t * Wait for the write buffer (if applicable) to become empty.\n\t */\n\tdrain(): Promise<void>;\n}\n\nexport class ProxyIdentifier<T> {\n\tpublic static count = 0;\n\t_proxyIdentifierBrand: void;\n\n\tpublic readonly isMain: boolean;\n\tpublic readonly sid: string;\n\tpublic readonly nid: number;\n\n\tconstructor(isMain: boolean, sid: string) {\n\t\tthis.isMain = isMain;\n\t\tthis.sid = sid;\n\t\tthis.nid = (++ProxyIdentifier.count);\n\t}\n}\n\nconst identifiers: ProxyIdentifier<any>[] = [];\n\nexport function createMainContextProxyIdentifier<T>(identifier: string): ProxyIdentifier<T> {\n\tconst result = new ProxyIdentifier<T>(true, identifier);\n\tidentifiers[result.nid] = result;\n\treturn result;\n}\n\nexport function createExtHostContextProxyIdentifier<T>(identifier: string): ProxyIdentifier<T> {\n\tconst result = new ProxyIdentifier<T>(false, identifier);\n\tidentifiers[result.nid] = result;\n\treturn result;\n}\n\nexport function getStringIdentifierForProxy(nid: number): string {\n\treturn identifiers[nid].sid;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as performance from 'vs/base/common/performance';\nimport { VSBuffer } from 'vs/base/common/buffer';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { IRemoteConsoleLog } from 'vs/base/common/console';\nimport { SerializedError } from 'vs/base/common/errors';\nimport { IRelativePattern } from 'vs/base/common/glob';\nimport { IMarkdownString } from 'vs/base/common/htmlContent';\nimport { IDisposable } from 'vs/base/common/lifecycle';\nimport Severity from 'vs/base/common/severity';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { RenderLineNumbersType, TextEditorCursorStyle } from 'vs/editor/common/config/editorOptions';\nimport { IPosition } from 'vs/editor/common/core/position';\nimport { IRange } from 'vs/editor/common/core/range';\nimport { ISelection, Selection } from 'vs/editor/common/core/selection';\nimport * as editorCommon from 'vs/editor/common/editorCommon';\nimport { EndOfLineSequence, ISingleEditOperation } from 'vs/editor/common/model';\nimport { IModelChangedEvent } from 'vs/editor/common/model/mirrorTextModel';\nimport * as modes from 'vs/editor/common/modes';\nimport { CharacterPair, CommentRule, EnterAction } from 'vs/editor/common/modes/languageConfiguration';\nimport { ICommandHandlerDescription } from 'vs/platform/commands/common/commands';\nimport { ConfigurationTarget, IConfigurationData, IConfigurationChange, IConfigurationOverrides } from 'vs/platform/configuration/common/configuration';\nimport { ConfigurationScope } from 'vs/platform/configuration/common/configurationRegistry';\nimport { ExtensionIdentifier, IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport * as files from 'vs/platform/files/common/files';\nimport { ResourceLabelFormatter } from 'vs/platform/label/common/label';\nimport { LogLevel } from 'vs/platform/log/common/log';\nimport { IMarkerData } from 'vs/platform/markers/common/markers';\nimport { IProgressOptions, IProgressStep } from 'vs/platform/progress/common/progress';\nimport * as quickInput from 'vs/platform/quickinput/common/quickInput';\nimport { RemoteAuthorityResolverErrorCode, ResolverResult, TunnelDescription, IRemoteConnectionData } from 'vs/platform/remote/common/remoteAuthorityResolver';\nimport * as statusbar from 'vs/workbench/services/statusbar/common/statusbar';\nimport { ClassifiedEvent, GDPRClassification, StrictPropertyCheck } from 'vs/platform/telemetry/common/gdprTypings';\nimport { ITelemetryInfo } from 'vs/platform/telemetry/common/telemetry';\nimport { ThemeColor } from 'vs/platform/theme/common/themeService';\nimport * as tasks from 'vs/workbench/api/common/shared/tasks';\nimport { IRevealOptions, ITreeItem } from 'vs/workbench/common/views';\nimport { IAdapterDescriptor, IConfig, IDebugSessionReplMode } from 'vs/workbench/contrib/debug/common/debug';\nimport { ITextQueryBuilderOptions } from 'vs/workbench/contrib/search/common/queryBuilder';\nimport { ITerminalDimensions, IShellLaunchConfig, ITerminalLaunchError } from 'vs/workbench/contrib/terminal/common/terminal';\nimport { ActivationKind, ExtensionActivationError, ExtensionHostKind } from 'vs/workbench/services/extensions/common/extensions';\nimport { createExtHostContextProxyIdentifier as createExtId, createMainContextProxyIdentifier as createMainId, IRPCProtocol } from 'vs/workbench/services/extensions/common/proxyIdentifier';\nimport * as search from 'vs/workbench/services/search/common/search';\nimport { EditorGroupColumn, SaveReason } from 'vs/workbench/common/editor';\nimport { ExtensionActivationReason } from 'vs/workbench/api/common/extHostExtensionActivator';\nimport { TunnelDto } from 'vs/workbench/api/common/extHostTunnelService';\nimport { TunnelCreationOptions, TunnelProviderFeatures, TunnelOptions } from 'vs/platform/remote/common/tunnel';\nimport { Timeline, TimelineChangeEvent, TimelineOptions, TimelineProviderDescriptor, InternalTimelineOptions } from 'vs/workbench/contrib/timeline/common/timeline';\nimport { revive } from 'vs/base/common/marshalling';\nimport { IProcessedOutput, INotebookDisplayOrder, NotebookCellMetadata, NotebookDocumentMetadata, ICellEditOperation, NotebookCellsChangedEventDto, NotebookDataDto, IMainCellDto, INotebookDocumentFilter, INotebookKernelInfoDto2, TransientMetadata, INotebookCellStatusBarEntry, ICellRange, INotebookDecorationRenderOptions, INotebookExclusiveDocumentFilter } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport { CallHierarchyItem } from 'vs/workbench/contrib/callHierarchy/common/callHierarchy';\nimport { Dto } from 'vs/base/common/types';\nimport { ISerializableEnvironmentVariableCollection } from 'vs/workbench/contrib/terminal/common/environmentVariable';\nimport { DebugConfigurationProviderTriggerKind } from 'vs/workbench/api/common/extHostTypes';\nimport { IAccessibilityInformation } from 'vs/platform/accessibility/common/accessibility';\nimport { IExtensionIdWithVersion } from 'vs/platform/userDataSync/common/extensionsStorageSync';\nimport { InternalTestItem, InternalTestResults, RunTestForProviderRequest, RunTestsRequest, RunTestsResult, TestIdWithProvider, TestsDiff } from 'vs/workbench/contrib/testing/common/testCollection';\nimport { CandidatePort } from 'vs/workbench/services/remote/common/remoteExplorerService';\n\nexport interface IEnvironment {\n\tisExtensionDevelopmentDebug: boolean;\n\tappName: string;\n\tappRoot?: URI;\n\tappLanguage: string;\n\tappUriScheme: string;\n\textensionDevelopmentLocationURI?: URI[];\n\textensionTestsLocationURI?: URI;\n\tglobalStorageHome: URI;\n\tworkspaceStorageHome: URI;\n\twebviewResourceRoot: string;\n\twebviewCspSource: string;\n\tuseHostProxy?: boolean;\n}\n\nexport interface IStaticWorkspaceData {\n\tid: string;\n\tname: string;\n\tconfiguration?: UriComponents | null;\n\tisUntitled?: boolean | null;\n}\n\nexport interface IWorkspaceData extends IStaticWorkspaceData {\n\tfolders: { uri: UriComponents, name: string, index: number; }[];\n}\n\nexport interface IInitData {\n\tversion: string;\n\tcommit?: string;\n\tparentPid: number;\n\tenvironment: IEnvironment;\n\tworkspace?: IStaticWorkspaceData | null;\n\tresolvedExtensions: ExtensionIdentifier[];\n\thostExtensions: ExtensionIdentifier[];\n\textensions: IExtensionDescription[];\n\ttelemetryInfo: ITelemetryInfo;\n\tlogLevel: LogLevel;\n\tlogsLocation: URI;\n\tlogFile: URI;\n\tautoStart: boolean;\n\tremote: { isRemote: boolean; authority: string | undefined; connectionData: IRemoteConnectionData | null; };\n\tuiKind: UIKind;\n}\n\nexport interface IConfigurationInitData extends IConfigurationData {\n\tconfigurationScopes: [string, ConfigurationScope | undefined][];\n}\n\nexport interface IExtHostContext extends IRPCProtocol {\n\treadonly remoteAuthority: string | null;\n\treadonly extensionHostKind: ExtensionHostKind;\n}\n\nexport interface IMainContext extends IRPCProtocol {\n}\n\nexport enum UIKind {\n\tDesktop = 1,\n\tWeb = 2\n}\n\n// --- main thread\n\nexport interface MainThreadClipboardShape extends IDisposable {\n\t$readText(): Promise<string>;\n\t$writeText(value: string): Promise<void>;\n}\n\nexport interface MainThreadCommandsShape extends IDisposable {\n\t$registerCommand(id: string): void;\n\t$unregisterCommand(id: string): void;\n\t$executeCommand<T>(id: string, args: any[], retry: boolean): Promise<T | undefined>;\n\t$getCommands(): Promise<string[]>;\n}\n\nexport interface CommentProviderFeatures {\n\treactionGroup?: modes.CommentReaction[];\n\treactionHandler?: boolean;\n\toptions?: modes.CommentOptions;\n}\n\nexport type CommentThreadChanges = Partial<{\n\trange: IRange,\n\tlabel: string,\n\tcontextValue: string,\n\tcomments: modes.Comment[],\n\tcollapseState: modes.CommentThreadCollapsibleState;\n\tcanReply: boolean;\n}>;\n\nexport interface MainThreadCommentsShape extends IDisposable {\n\t$registerCommentController(handle: number, id: string, label: string): void;\n\t$unregisterCommentController(handle: number): void;\n\t$updateCommentControllerFeatures(handle: number, features: CommentProviderFeatures): void;\n\t$createCommentThread(handle: number, commentThreadHandle: number, threadId: string, resource: UriComponents, range: IRange, extensionId: ExtensionIdentifier): modes.CommentThread | undefined;\n\t$updateCommentThread(handle: number, commentThreadHandle: number, threadId: string, resource: UriComponents, changes: CommentThreadChanges): void;\n\t$deleteCommentThread(handle: number, commentThreadHandle: number): void;\n\t$onDidCommentThreadsChange(handle: number, event: modes.CommentThreadChangedEvent): void;\n}\n\nexport interface MainThreadAuthenticationShape extends IDisposable {\n\t$registerAuthenticationProvider(id: string, label: string, supportsMultipleAccounts: boolean): void;\n\t$unregisterAuthenticationProvider(id: string): void;\n\t$ensureProvider(id: string): Promise<void>;\n\t$getProviderIds(): Promise<string[]>;\n\t$sendDidChangeSessions(providerId: string, event: modes.AuthenticationSessionsChangeEvent): void;\n\t$getSession(providerId: string, scopes: string[], extensionId: string, extensionName: string, options: { createIfNone?: boolean, clearSessionPreference?: boolean }): Promise<modes.AuthenticationSession | undefined>;\n\t$selectSession(providerId: string, providerName: string, extensionId: string, extensionName: string, potentialSessions: modes.AuthenticationSession[], scopes: string[], clearSessionPreference: boolean): Promise<modes.AuthenticationSession>;\n\t$getSessionsPrompt(providerId: string, accountName: string, providerName: string, extensionId: string, extensionName: string): Promise<boolean>;\n\t$loginPrompt(providerName: string, extensionName: string): Promise<boolean>;\n\t$setTrustedExtensionAndAccountPreference(providerId: string, accountName: string, extensionId: string, extensionName: string, sessionId: string): Promise<void>;\n\t$requestNewSession(providerId: string, scopes: string[], extensionId: string, extensionName: string): Promise<void>;\n\n\t$getSessions(providerId: string): Promise<ReadonlyArray<modes.AuthenticationSession>>;\n\t$login(providerId: string, scopes: string[]): Promise<modes.AuthenticationSession>;\n\t$logout(providerId: string, sessionId: string): Promise<void>;\n}\n\nexport interface MainThreadSecretStateShape extends IDisposable {\n\t$getPassword(extensionId: string, key: string): Promise<string | undefined>;\n\t$setPassword(extensionId: string, key: string, value: string): Promise<void>;\n\t$deletePassword(extensionId: string, key: string): Promise<void>;\n}\n\nexport interface MainThreadConfigurationShape extends IDisposable {\n\t$updateConfigurationOption(target: ConfigurationTarget | null, key: string, value: any, overrides: IConfigurationOverrides | undefined, scopeToLanguage: boolean | undefined): Promise<void>;\n\t$removeConfigurationOption(target: ConfigurationTarget | null, key: string, overrides: IConfigurationOverrides | undefined, scopeToLanguage: boolean | undefined): Promise<void>;\n}\n\nexport interface MainThreadDiagnosticsShape extends IDisposable {\n\t$changeMany(owner: string, entries: [UriComponents, IMarkerData[] | undefined][]): void;\n\t$clear(owner: string): void;\n}\n\nexport interface MainThreadDialogOpenOptions {\n\tdefaultUri?: UriComponents;\n\topenLabel?: string;\n\tcanSelectFiles?: boolean;\n\tcanSelectFolders?: boolean;\n\tcanSelectMany?: boolean;\n\tfilters?: { [name: string]: string[]; };\n\ttitle?: string;\n}\n\nexport interface MainThreadDialogSaveOptions {\n\tdefaultUri?: UriComponents;\n\tsaveLabel?: string;\n\tfilters?: { [name: string]: string[]; };\n\ttitle?: string;\n}\n\nexport interface MainThreadDiaglogsShape extends IDisposable {\n\t$showOpenDialog(options?: MainThreadDialogOpenOptions): Promise<UriComponents[] | undefined>;\n\t$showSaveDialog(options?: MainThreadDialogSaveOptions): Promise<UriComponents | undefined>;\n}\n\nexport interface MainThreadDecorationsShape extends IDisposable {\n\t$registerDecorationProvider(handle: number, label: string): void;\n\t$unregisterDecorationProvider(handle: number): void;\n\t$onDidChange(handle: number, resources: UriComponents[] | null): void;\n}\n\nexport interface MainThreadDocumentContentProvidersShape extends IDisposable {\n\t$registerTextContentProvider(handle: number, scheme: string): void;\n\t$unregisterTextContentProvider(handle: number): void;\n\t$onVirtualDocumentChange(uri: UriComponents, value: string): void;\n}\n\nexport interface MainThreadDocumentsShape extends IDisposable {\n\t$tryCreateDocument(options?: { language?: string; content?: string; }): Promise<UriComponents>;\n\t$tryOpenDocument(uri: UriComponents): Promise<UriComponents>;\n\t$trySaveDocument(uri: UriComponents): Promise<boolean>;\n}\n\nexport interface ITextEditorConfigurationUpdate {\n\ttabSize?: number | 'auto';\n\tindentSize?: number | 'tabSize';\n\tinsertSpaces?: boolean | 'auto';\n\tcursorStyle?: TextEditorCursorStyle;\n\tlineNumbers?: RenderLineNumbersType;\n}\n\nexport interface IResolvedTextEditorConfiguration {\n\ttabSize: number;\n\tindentSize: number;\n\tinsertSpaces: boolean;\n\tcursorStyle: TextEditorCursorStyle;\n\tlineNumbers: RenderLineNumbersType;\n}\n\nexport enum TextEditorRevealType {\n\tDefault = 0,\n\tInCenter = 1,\n\tInCenterIfOutsideViewport = 2,\n\tAtTop = 3\n}\n\nexport interface IUndoStopOptions {\n\tundoStopBefore: boolean;\n\tundoStopAfter: boolean;\n}\n\nexport interface IApplyEditsOptions extends IUndoStopOptions {\n\tsetEndOfLine?: EndOfLineSequence;\n}\n\nexport interface ITextDocumentShowOptions {\n\tposition?: EditorGroupColumn;\n\tpreserveFocus?: boolean;\n\tpinned?: boolean;\n\tselection?: IRange;\n}\n\nexport interface MainThreadBulkEditsShape extends IDisposable {\n\t$tryApplyWorkspaceEdit(workspaceEditDto: IWorkspaceEditDto, undoRedoGroupId?: number): Promise<boolean>;\n}\n\nexport interface MainThreadTextEditorsShape extends IDisposable {\n\t$tryShowTextDocument(resource: UriComponents, options: ITextDocumentShowOptions): Promise<string | undefined>;\n\t$registerTextEditorDecorationType(key: string, options: editorCommon.IDecorationRenderOptions): void;\n\t$removeTextEditorDecorationType(key: string): void;\n\t$tryShowEditor(id: string, position: EditorGroupColumn): Promise<void>;\n\t$tryHideEditor(id: string): Promise<void>;\n\t$trySetOptions(id: string, options: ITextEditorConfigurationUpdate): Promise<void>;\n\t$trySetDecorations(id: string, key: string, ranges: editorCommon.IDecorationOptions[]): Promise<void>;\n\t$trySetDecorationsFast(id: string, key: string, ranges: number[]): Promise<void>;\n\t$tryRevealRange(id: string, range: IRange, revealType: TextEditorRevealType): Promise<void>;\n\t$trySetSelections(id: string, selections: ISelection[]): Promise<void>;\n\t$tryApplyEdits(id: string, modelVersionId: number, edits: ISingleEditOperation[], opts: IApplyEditsOptions): Promise<boolean>;\n\t$tryInsertSnippet(id: string, template: string, selections: readonly IRange[], opts: IUndoStopOptions): Promise<boolean>;\n\t$getDiffInformation(id: string): Promise<editorCommon.ILineChange[]>;\n}\n\nexport interface MainThreadTreeViewsShape extends IDisposable {\n\t$registerTreeViewDataProvider(treeViewId: string, options: { showCollapseAll: boolean, canSelectMany: boolean; }): void;\n\t$refresh(treeViewId: string, itemsToRefresh?: { [treeItemHandle: string]: ITreeItem; }): Promise<void>;\n\t$reveal(treeViewId: string, itemInfo: { item: ITreeItem, parentChain: ITreeItem[] } | undefined, options: IRevealOptions): Promise<void>;\n\t$setMessage(treeViewId: string, message: string): void;\n\t$setTitle(treeViewId: string, title: string, description: string | undefined): void;\n}\n\nexport interface MainThreadDownloadServiceShape extends IDisposable {\n\t$download(uri: UriComponents, to: UriComponents): Promise<void>;\n}\n\nexport interface MainThreadErrorsShape extends IDisposable {\n\t$onUnexpectedError(err: any | SerializedError): void;\n}\n\nexport interface MainThreadConsoleShape extends IDisposable {\n\t$logExtensionHostMessage(msg: IRemoteConsoleLog): void;\n}\n\nexport interface MainThreadKeytarShape extends IDisposable {\n\t$getPassword(service: string, account: string): Promise<string | null>;\n\t$setPassword(service: string, account: string, password: string): Promise<void>;\n\t$deletePassword(service: string, account: string): Promise<boolean>;\n\t$findPassword(service: string): Promise<string | null>;\n\t$findCredentials(service: string): Promise<Array<{ account: string, password: string; }>>;\n}\n\nexport interface IRegExpDto {\n\tpattern: string;\n\tflags?: string;\n}\nexport interface IIndentationRuleDto {\n\tdecreaseIndentPattern: IRegExpDto;\n\tincreaseIndentPattern: IRegExpDto;\n\tindentNextLinePattern?: IRegExpDto;\n\tunIndentedLinePattern?: IRegExpDto;\n}\nexport interface IOnEnterRuleDto {\n\tbeforeText: IRegExpDto;\n\tafterText?: IRegExpDto;\n\tpreviousLineText?: IRegExpDto;\n\taction: EnterAction;\n}\nexport interface ILanguageConfigurationDto {\n\tcomments?: CommentRule;\n\tbrackets?: CharacterPair[];\n\twordPattern?: IRegExpDto;\n\tindentationRules?: IIndentationRuleDto;\n\tonEnterRules?: IOnEnterRuleDto[];\n\t__electricCharacterSupport?: {\n\t\tbrackets?: any;\n\t\tdocComment?: {\n\t\t\tscope: string;\n\t\t\topen: string;\n\t\t\tlineStart: string;\n\t\t\tclose?: string;\n\t\t};\n\t};\n\t__characterPairSupport?: {\n\t\tautoClosingPairs: {\n\t\t\topen: string;\n\t\t\tclose: string;\n\t\t\tnotIn?: string[];\n\t\t}[];\n\t};\n}\n\nexport type GlobPattern = string | { base: string; pattern: string; };\n\nexport interface IDocumentFilterDto {\n\t$serialized: true;\n\tlanguage?: string;\n\tscheme?: string;\n\tpattern?: string | IRelativePattern;\n\texclusive?: boolean;\n}\n\nexport interface ISignatureHelpProviderMetadataDto {\n\treadonly triggerCharacters: readonly string[];\n\treadonly retriggerCharacters: readonly string[];\n}\n\nexport interface MainThreadLanguageFeaturesShape extends IDisposable {\n\t$unregister(handle: number): void;\n\t$registerDocumentSymbolProvider(handle: number, selector: IDocumentFilterDto[], label: string): void;\n\t$registerCodeLensSupport(handle: number, selector: IDocumentFilterDto[], eventHandle: number | undefined): void;\n\t$emitCodeLensEvent(eventHandle: number, event?: any): void;\n\t$registerDefinitionSupport(handle: number, selector: IDocumentFilterDto[]): void;\n\t$registerDeclarationSupport(handle: number, selector: IDocumentFilterDto[]): void;\n\t$registerImplementationSupport(handle: number, selector: IDocumentFilterDto[]): void;\n\t$registerTypeDefinitionSupport(handle: number, selector: IDocumentFilterDto[]): void;\n\t$registerHoverProvider(handle: number, selector: IDocumentFilterDto[]): void;\n\t$registerEvaluatableExpressionProvider(handle: number, selector: IDocumentFilterDto[]): void;\n\t$registerDocumentHighlightProvider(handle: number, selector: IDocumentFilterDto[]): void;\n\t$registerLinkedEditingRangeProvider(handle: number, selector: IDocumentFilterDto[]): void;\n\t$registerReferenceSupport(handle: number, selector: IDocumentFilterDto[]): void;\n\t$registerQuickFixSupport(handle: number, selector: IDocumentFilterDto[], metadata: ICodeActionProviderMetadataDto, displayName: string, supportsResolve: boolean): void;\n\t$registerDocumentFormattingSupport(handle: number, selector: IDocumentFilterDto[], extensionId: ExtensionIdentifier, displayName: string): void;\n\t$registerRangeFormattingSupport(handle: number, selector: IDocumentFilterDto[], extensionId: ExtensionIdentifier, displayName: string): void;\n\t$registerOnTypeFormattingSupport(handle: number, selector: IDocumentFilterDto[], autoFormatTriggerCharacters: string[], extensionId: ExtensionIdentifier): void;\n\t$registerNavigateTypeSupport(handle: number): void;\n\t$registerRenameSupport(handle: number, selector: IDocumentFilterDto[], supportsResolveInitialValues: boolean): void;\n\t$registerDocumentSemanticTokensProvider(handle: number, selector: IDocumentFilterDto[], legend: modes.SemanticTokensLegend, eventHandle: number | undefined): void;\n\t$emitDocumentSemanticTokensEvent(eventHandle: number): void;\n\t$registerDocumentRangeSemanticTokensProvider(handle: number, selector: IDocumentFilterDto[], legend: modes.SemanticTokensLegend): void;\n\t$registerSuggestSupport(handle: number, selector: IDocumentFilterDto[], triggerCharacters: string[], supportsResolveDetails: boolean, displayName: string): void;\n\t$registerSignatureHelpProvider(handle: number, selector: IDocumentFilterDto[], metadata: ISignatureHelpProviderMetadataDto): void;\n\t$registerInlineHintsProvider(handle: number, selector: IDocumentFilterDto[], eventHandle: number | undefined): void;\n\t$emitInlineHintsEvent(eventHandle: number, event?: any): void;\n\t$registerDocumentLinkProvider(handle: number, selector: IDocumentFilterDto[], supportsResolve: boolean): void;\n\t$registerDocumentColorProvider(handle: number, selector: IDocumentFilterDto[]): void;\n\t$registerFoldingRangeProvider(handle: number, selector: IDocumentFilterDto[], eventHandle: number | undefined): void;\n\t$emitFoldingRangeEvent(eventHandle: number, event?: any): void;\n\t$registerSelectionRangeProvider(handle: number, selector: IDocumentFilterDto[]): void;\n\t$registerCallHierarchyProvider(handle: number, selector: IDocumentFilterDto[]): void;\n\t$setLanguageConfiguration(handle: number, languageId: string, configuration: ILanguageConfigurationDto): void;\n}\n\nexport interface MainThreadLanguagesShape extends IDisposable {\n\t$getLanguages(): Promise<string[]>;\n\t$changeLanguage(resource: UriComponents, languageId: string): Promise<void>;\n\t$tokensAtPosition(resource: UriComponents, position: IPosition): Promise<undefined | { type: modes.StandardTokenType, range: IRange }>;\n}\n\nexport interface MainThreadMessageOptions {\n\textension?: IExtensionDescription;\n\tmodal?: boolean;\n\tuseCustom?: boolean;\n}\n\nexport interface MainThreadMessageServiceShape extends IDisposable {\n\t$showMessage(severity: Severity, message: string, options: MainThreadMessageOptions, commands: { title: string; isCloseAffordance: boolean; handle: number; }[]): Promise<number | undefined>;\n}\n\nexport interface MainThreadOutputServiceShape extends IDisposable {\n\t$register(label: string, log: boolean, file?: UriComponents): Promise<string>;\n\t$append(channelId: string, value: string): Promise<void> | undefined;\n\t$update(channelId: string): Promise<void> | undefined;\n\t$clear(channelId: string, till: number): Promise<void> | undefined;\n\t$reveal(channelId: string, preserveFocus: boolean): Promise<void> | undefined;\n\t$close(channelId: string): Promise<void> | undefined;\n\t$dispose(channelId: string): Promise<void> | undefined;\n}\n\nexport interface MainThreadProgressShape extends IDisposable {\n\n\t$startProgress(handle: number, options: IProgressOptions, extension?: IExtensionDescription): void;\n\t$progressReport(handle: number, message: IProgressStep): void;\n\t$progressEnd(handle: number): void;\n}\n\n/**\n * A terminal that is created on the extension host side is temporarily assigned\n * a UUID by the extension host that created it. Once the renderer side has assigned\n * a real numeric id, the numeric id will be used.\n *\n * All other terminals (that are not created on the extension host side) always\n * use the numeric id.\n */\nexport type TerminalIdentifier = number | string;\n\nexport interface TerminalLaunchConfig {\n\tname?: string;\n\tshellPath?: string;\n\tshellArgs?: string[] | string;\n\tcwd?: string | UriComponents;\n\tenv?: { [key: string]: string | null; };\n\twaitOnExit?: boolean;\n\tstrictEnv?: boolean;\n\thideFromUser?: boolean;\n\tisExtensionTerminal?: boolean;\n\tisFeatureTerminal?: boolean;\n}\n\nexport interface MainThreadTerminalServiceShape extends IDisposable {\n\t$createTerminal(extHostTerminalId: string, config: TerminalLaunchConfig): Promise<void>;\n\t$dispose(id: TerminalIdentifier): void;\n\t$hide(id: TerminalIdentifier): void;\n\t$sendText(id: TerminalIdentifier, text: string, addNewLine: boolean): void;\n\t$show(id: TerminalIdentifier, preserveFocus: boolean): void;\n\t$startSendingDataEvents(): void;\n\t$stopSendingDataEvents(): void;\n\t$startLinkProvider(): void;\n\t$stopLinkProvider(): void;\n\t$registerProcessSupport(isSupported: boolean): void;\n\t$setEnvironmentVariableCollection(extensionIdentifier: string, persistent: boolean, collection: ISerializableEnvironmentVariableCollection | undefined): void;\n\n\t// Process\n\t$sendProcessTitle(terminalId: number, title: string): void;\n\t$sendProcessData(terminalId: number, data: string): void;\n\t$sendProcessReady(terminalId: number, pid: number, cwd: string): void;\n\t$sendProcessExit(terminalId: number, exitCode: number | undefined): void;\n\t$sendProcessInitialCwd(terminalId: number, cwd: string): void;\n\t$sendProcessCwd(terminalId: number, initialCwd: string): void;\n\t$sendOverrideDimensions(terminalId: number, dimensions: ITerminalDimensions | undefined): void;\n\t$sendResolvedLaunchConfig(terminalId: number, shellLaunchConfig: IShellLaunchConfig): void;\n}\n\nexport interface TransferQuickPickItems extends quickInput.IQuickPickItem {\n\thandle: number;\n}\n\nexport interface TransferQuickInputButton {\n\thandle: number;\n\ticonPath: { dark: URI; light?: URI; } | { id: string; };\n\ttooltip?: string;\n}\n\nexport type TransferQuickInput = TransferQuickPick | TransferInputBox;\n\nexport interface BaseTransferQuickInput {\n\n\t[key: string]: any;\n\n\tid: number;\n\n\ttype?: 'quickPick' | 'inputBox';\n\n\tenabled?: boolean;\n\n\tbusy?: boolean;\n\n\tvisible?: boolean;\n}\n\nexport interface TransferQuickPick extends BaseTransferQuickInput {\n\n\ttype?: 'quickPick';\n\n\tvalue?: string;\n\n\tplaceholder?: string;\n\n\tbuttons?: TransferQuickInputButton[];\n\n\titems?: TransferQuickPickItems[];\n\n\tactiveItems?: number[];\n\n\tselectedItems?: number[];\n\n\tcanSelectMany?: boolean;\n\n\tignoreFocusOut?: boolean;\n\n\tmatchOnDescription?: boolean;\n\n\tmatchOnDetail?: boolean;\n\n\tsortByLabel?: boolean;\n}\n\nexport interface TransferInputBox extends BaseTransferQuickInput {\n\n\ttype?: 'inputBox';\n\n\tvalue?: string;\n\n\tplaceholder?: string;\n\n\tpassword?: boolean;\n\n\tbuttons?: TransferQuickInputButton[];\n\n\tprompt?: string;\n\n\tvalidationMessage?: string;\n}\n\nexport interface IInputBoxOptions {\n\tvalue?: string;\n\tvalueSelection?: [number, number];\n\tprompt?: string;\n\tplaceHolder?: string;\n\tpassword?: boolean;\n\tignoreFocusOut?: boolean;\n}\n\nexport interface MainThreadQuickOpenShape extends IDisposable {\n\t$show(instance: number, options: quickInput.IPickOptions<TransferQuickPickItems>, token: CancellationToken): Promise<number | number[] | undefined>;\n\t$setItems(instance: number, items: TransferQuickPickItems[]): Promise<void>;\n\t$setError(instance: number, error: Error): Promise<void>;\n\t$input(options: IInputBoxOptions | undefined, validateInput: boolean, token: CancellationToken): Promise<string | undefined>;\n\t$createOrUpdate(params: TransferQuickInput): Promise<void>;\n\t$dispose(id: number): Promise<void>;\n}\n\nexport interface MainThreadStatusBarShape extends IDisposable {\n\t$setEntry(id: number, statusId: string, statusName: string, text: string, tooltip: string | undefined, command: ICommandDto | undefined, color: string | ThemeColor | undefined, backgroundColor: string | ThemeColor | undefined, alignment: statusbar.StatusbarAlignment, priority: number | undefined, accessibilityInformation: IAccessibilityInformation | undefined): void;\n\t$dispose(id: number): void;\n}\n\nexport interface MainThreadStorageShape extends IDisposable {\n\t$getValue<T>(shared: boolean, key: string): Promise<T | undefined>;\n\t$setValue(shared: boolean, key: string, value: object): Promise<void>;\n\t$registerExtensionStorageKeysToSync(extension: IExtensionIdWithVersion, keys: string[]): void;\n}\n\nexport interface MainThreadTelemetryShape extends IDisposable {\n\t$publicLog(eventName: string, data?: any): void;\n\t$publicLog2<E extends ClassifiedEvent<T> = never, T extends GDPRClassification<T> = never>(eventName: string, data?: StrictPropertyCheck<T, E>): void;\n}\n\nexport interface MainThreadEditorInsetsShape extends IDisposable {\n\t$createEditorInset(handle: number, id: string, uri: UriComponents, line: number, height: number, options: modes.IWebviewOptions, extensionId: ExtensionIdentifier, extensionLocation: UriComponents): Promise<void>;\n\t$disposeEditorInset(handle: number): void;\n\n\t$setHtml(handle: number, value: string): void;\n\t$setOptions(handle: number, options: modes.IWebviewOptions): void;\n\t$postMessage(handle: number, value: any): Promise<boolean>;\n}\n\nexport interface ExtHostEditorInsetsShape {\n\t$onDidDispose(handle: number): void;\n\t$onDidReceiveMessage(handle: number, message: any): void;\n}\n\n//#region --- open editors model\n\nexport interface MainThreadEditorTabsShape extends IDisposable {\n\t// manage tabs: move, close, rearrange etc\n}\n\nexport interface IEditorTabDto {\n\tgroup: number;\n\tname: string;\n\tresource: UriComponents\n}\n\nexport interface IExtHostEditorTabsShape {\n\t$acceptEditorTabs(tabs: IEditorTabDto[]): void;\n}\n\n//#endregion\n\nexport type WebviewHandle = string;\n\nexport interface WebviewPanelShowOptions {\n\treadonly viewColumn?: EditorGroupColumn;\n\treadonly preserveFocus?: boolean;\n}\n\nexport interface WebviewExtensionDescription {\n\treadonly id: ExtensionIdentifier;\n\treadonly location: UriComponents;\n}\n\nexport interface NotebookExtensionDescription {\n\treadonly id: ExtensionIdentifier;\n\treadonly location: UriComponents;\n\treadonly description?: string;\n}\n\nexport enum WebviewEditorCapabilities {\n\tEditable,\n\tSupportsHotExit,\n}\n\nexport interface CustomTextEditorCapabilities {\n\treadonly supportsMove?: boolean;\n}\n\nexport interface MainThreadWebviewsShape extends IDisposable {\n\t$setHtml(handle: WebviewHandle, value: string): void;\n\t$setOptions(handle: WebviewHandle, options: modes.IWebviewOptions): void;\n\t$postMessage(handle: WebviewHandle, value: any): Promise<boolean>\n}\n\nexport interface MainThreadWebviewPanelsShape extends IDisposable {\n\t$createWebviewPanel(extension: WebviewExtensionDescription, handle: WebviewHandle, viewType: string, title: string, showOptions: WebviewPanelShowOptions, options: modes.IWebviewPanelOptions & modes.IWebviewOptions): void;\n\t$disposeWebview(handle: WebviewHandle): void;\n\t$reveal(handle: WebviewHandle, showOptions: WebviewPanelShowOptions): void;\n\t$setTitle(handle: WebviewHandle, value: string): void;\n\t$setIconPath(handle: WebviewHandle, value: { light: UriComponents, dark: UriComponents; } | undefined): void;\n\n\t$registerSerializer(viewType: string): void;\n\t$unregisterSerializer(viewType: string): void;\n}\n\nexport interface MainThreadCustomEditorsShape extends IDisposable {\n\t$registerTextEditorProvider(extension: WebviewExtensionDescription, viewType: string, options: modes.IWebviewPanelOptions, capabilities: CustomTextEditorCapabilities): void;\n\t$registerCustomEditorProvider(extension: WebviewExtensionDescription, viewType: string, options: modes.IWebviewPanelOptions, supportsMultipleEditorsPerDocument: boolean): void;\n\t$unregisterEditorProvider(viewType: string): void;\n\n\t$onDidEdit(resource: UriComponents, viewType: string, editId: number, label: string | undefined): void;\n\t$onContentChange(resource: UriComponents, viewType: string): void;\n}\n\nexport interface MainThreadWebviewViewsShape extends IDisposable {\n\t$registerWebviewViewProvider(extension: WebviewExtensionDescription, viewType: string, options?: { retainContextWhenHidden?: boolean }): void;\n\t$unregisterWebviewViewProvider(viewType: string): void;\n\n\t$setWebviewViewTitle(handle: WebviewHandle, value: string | undefined): void;\n\t$setWebviewViewDescription(handle: WebviewHandle, value: string | undefined): void;\n\n\t$show(handle: WebviewHandle, preserveFocus: boolean): void;\n}\n\nexport interface WebviewPanelViewStateData {\n\t[handle: string]: {\n\t\treadonly active: boolean;\n\t\treadonly visible: boolean;\n\t\treadonly position: EditorGroupColumn;\n\t};\n}\n\nexport interface ExtHostWebviewsShape {\n\t$onMessage(handle: WebviewHandle, message: any): void;\n\t$onMissingCsp(handle: WebviewHandle, extensionId: string): void;\n}\n\nexport interface ExtHostWebviewPanelsShape {\n\t$onDidChangeWebviewPanelViewStates(newState: WebviewPanelViewStateData): void;\n\t$onDidDisposeWebviewPanel(handle: WebviewHandle): Promise<void>;\n\t$deserializeWebviewPanel(newWebviewHandle: WebviewHandle, viewType: string, title: string, state: any, position: EditorGroupColumn, options: modes.IWebviewOptions & modes.IWebviewPanelOptions): Promise<void>;\n}\n\nexport interface ExtHostCustomEditorsShape {\n\t$resolveWebviewEditor(resource: UriComponents, newWebviewHandle: WebviewHandle, viewType: string, title: string, position: EditorGroupColumn, options: modes.IWebviewOptions & modes.IWebviewPanelOptions, cancellation: CancellationToken): Promise<void>;\n\t$createCustomDocument(resource: UriComponents, viewType: string, backupId: string | undefined, cancellation: CancellationToken): Promise<{ editable: boolean }>;\n\t$disposeCustomDocument(resource: UriComponents, viewType: string): Promise<void>;\n\n\t$undo(resource: UriComponents, viewType: string, editId: number, isDirty: boolean): Promise<void>;\n\t$redo(resource: UriComponents, viewType: string, editId: number, isDirty: boolean): Promise<void>;\n\t$revert(resource: UriComponents, viewType: string, cancellation: CancellationToken): Promise<void>;\n\t$disposeEdits(resourceComponents: UriComponents, viewType: string, editIds: number[]): void;\n\n\t$onSave(resource: UriComponents, viewType: string, cancellation: CancellationToken): Promise<void>;\n\t$onSaveAs(resource: UriComponents, viewType: string, targetResource: UriComponents, cancellation: CancellationToken): Promise<void>;\n\n\t$backup(resource: UriComponents, viewType: string, cancellation: CancellationToken): Promise<string>;\n\n\t$onMoveCustomEditor(handle: WebviewHandle, newResource: UriComponents, viewType: string): Promise<void>;\n}\n\nexport interface ExtHostWebviewViewsShape {\n\t$resolveWebviewView(webviewHandle: WebviewHandle, viewType: string, title: string | undefined, state: any, cancellation: CancellationToken): Promise<void>;\n\n\t$onDidChangeWebviewViewVisibility(webviewHandle: WebviewHandle, visible: boolean): void;\n\n\t$disposeWebviewView(webviewHandle: WebviewHandle): void;\n}\n\nexport enum CellKind {\n\tMarkdown = 1,\n\tCode = 2\n}\n\nexport enum CellOutputKind {\n\tText = 1,\n\tError = 2,\n\tRich = 3\n}\n\nexport interface ICellDto {\n\thandle: number;\n\turi: UriComponents,\n\tsource: string[];\n\tlanguage: string;\n\tcellKind: CellKind;\n\toutputs: IProcessedOutput[];\n\tmetadata?: NotebookCellMetadata;\n}\n\nexport type NotebookCellsSplice = [\n\tnumber /* start */,\n\tnumber /* delete count */,\n\tICellDto[]\n];\n\nexport type NotebookCellOutputsSplice = [\n\tnumber /* start */,\n\tnumber /* delete count */,\n\tIProcessedOutput[]\n];\n\nexport enum NotebookEditorRevealType {\n\tDefault = 0,\n\tInCenter = 1,\n\tInCenterIfOutsideViewport = 2,\n\tAtTop = 3\n}\n\nexport interface INotebookDocumentShowOptions {\n\tposition?: EditorGroupColumn;\n\tpreserveFocus?: boolean;\n\tpinned?: boolean;\n\tselection?: ICellRange;\n}\n\nexport type INotebookCellStatusBarEntryDto = Dto<INotebookCellStatusBarEntry>;\n\nexport interface MainThreadNotebookShape extends IDisposable {\n\t$registerNotebookProvider(extension: NotebookExtensionDescription, viewType: string, supportBackup: boolean, options: {\n\t\ttransientOutputs: boolean;\n\t\ttransientMetadata: TransientMetadata;\n\t\tviewOptions?: { displayName: string; filenamePattern: (string | IRelativePattern | INotebookExclusiveDocumentFilter)[]; exclusive: boolean; };\n\t}): Promise<void>;\n\t$updateNotebookProviderOptions(viewType: string, options?: { transientOutputs: boolean; transientMetadata: TransientMetadata; }): Promise<void>;\n\t$unregisterNotebookProvider(viewType: string): Promise<void>;\n\t$registerNotebookKernelProvider(extension: NotebookExtensionDescription, handle: number, documentFilter: INotebookDocumentFilter): Promise<void>;\n\t$unregisterNotebookKernelProvider(handle: number): Promise<void>;\n\t$onNotebookKernelChange(handle: number, uri: UriComponents | undefined): void;\n\t$tryApplyEdits(viewType: string, resource: UriComponents, modelVersionId: number, edits: ICellEditOperation[]): Promise<boolean>;\n\t$updateNotebookLanguages(viewType: string, resource: UriComponents, languages: string[]): Promise<void>;\n\t$spliceNotebookCellOutputs(viewType: string, resource: UriComponents, cellHandle: number, splices: NotebookCellOutputsSplice[]): Promise<void>;\n\t$postMessage(editorId: string, forRendererId: string | undefined, value: any): Promise<boolean>;\n\t$setStatusBarEntry(id: number, statusBarEntry: INotebookCellStatusBarEntryDto): Promise<void>;\n\t$tryOpenDocument(uriComponents: UriComponents, viewType?: string): Promise<URI>;\n\t$tryShowNotebookDocument(uriComponents: UriComponents, viewType: string, options: INotebookDocumentShowOptions): Promise<string>;\n\t$tryRevealRange(id: string, range: ICellRange, revealType: NotebookEditorRevealType): Promise<void>;\n\t$registerNotebookEditorDecorationType(key: string, options: INotebookDecorationRenderOptions): void;\n\t$removeNotebookEditorDecorationType(key: string): void;\n\t$trySetDecorations(id: string, range: ICellRange, decorationKey: string): void;\n\t$onUndoableContentChange(resource: UriComponents, viewType: string, editId: number, label: string | undefined): void;\n\t$onContentChange(resource: UriComponents, viewType: string): void;\n}\n\nexport interface MainThreadUrlsShape extends IDisposable {\n\t$registerUriHandler(handle: number, extensionId: ExtensionIdentifier): Promise<void>;\n\t$unregisterUriHandler(handle: number): Promise<void>;\n\t$createAppUri(uri: UriComponents): Promise<UriComponents>;\n}\n\nexport interface ExtHostUrlsShape {\n\t$handleExternalUri(handle: number, uri: UriComponents): Promise<void>;\n}\n\nexport interface MainThreadUriOpenersShape extends IDisposable {\n\t$registerUriOpener(id: string, schemes: readonly string[], extensionId: ExtensionIdentifier, label: string): Promise<void>;\n\t$unregisterUriOpener(id: string): Promise<void>;\n}\n\nexport interface ExtHostUriOpenersShape {\n\t$canOpenUri(id: string, uri: UriComponents, token: CancellationToken): Promise<modes.ExternalUriOpenerPriority>;\n\t$openUri(id: string, context: { resolvedUri: UriComponents, sourceUri: UriComponents }, token: CancellationToken): Promise<void>;\n}\n\nexport interface ITextSearchComplete {\n\tlimitHit?: boolean;\n}\n\nexport interface MainThreadWorkspaceShape extends IDisposable {\n\t$startFileSearch(includePattern: string | null, includeFolder: UriComponents | null, excludePatternOrDisregardExcludes: string | false | null, maxResults: number | null, token: CancellationToken): Promise<UriComponents[] | null>;\n\t$startTextSearch(query: search.IPatternInfo, folder: UriComponents | null, options: ITextQueryBuilderOptions, requestId: number, token: CancellationToken): Promise<ITextSearchComplete | null>;\n\t$checkExists(folders: readonly UriComponents[], includes: string[], token: CancellationToken): Promise<boolean>;\n\t$saveAll(includeUntitled?: boolean): Promise<boolean>;\n\t$updateWorkspaceFolders(extensionName: string, index: number, deleteCount: number, workspaceFoldersToAdd: { uri: UriComponents, name?: string; }[]): Promise<void>;\n\t$resolveProxy(url: string): Promise<string | undefined>;\n}\n\nexport interface IFileChangeDto {\n\tresource: UriComponents;\n\ttype: files.FileChangeType;\n}\n\nexport interface MainThreadFileSystemShape extends IDisposable {\n\t$registerFileSystemProvider(handle: number, scheme: string, capabilities: files.FileSystemProviderCapabilities): Promise<void>;\n\t$unregisterProvider(handle: number): void;\n\t$onFileSystemChange(handle: number, resource: IFileChangeDto[]): void;\n\n\t$stat(uri: UriComponents): Promise<files.IStat>;\n\t$readdir(resource: UriComponents): Promise<[string, files.FileType][]>;\n\t$readFile(resource: UriComponents): Promise<VSBuffer>;\n\t$writeFile(resource: UriComponents, content: VSBuffer): Promise<void>;\n\t$rename(resource: UriComponents, target: UriComponents, opts: files.FileOverwriteOptions): Promise<void>;\n\t$copy(resource: UriComponents, target: UriComponents, opts: files.FileOverwriteOptions): Promise<void>;\n\t$mkdir(resource: UriComponents): Promise<void>;\n\t$delete(resource: UriComponents, opts: files.FileDeleteOptions): Promise<void>;\n}\n\nexport interface MainThreadLabelServiceShape extends IDisposable {\n\t$registerResourceLabelFormatter(handle: number, formatter: ResourceLabelFormatter): void;\n\t$unregisterResourceLabelFormatter(handle: number): void;\n}\n\nexport interface MainThreadSearchShape extends IDisposable {\n\t$registerFileSearchProvider(handle: number, scheme: string): void;\n\t$registerTextSearchProvider(handle: number, scheme: string): void;\n\t$unregisterProvider(handle: number): void;\n\t$handleFileMatch(handle: number, session: number, data: UriComponents[]): void;\n\t$handleTextMatch(handle: number, session: number, data: search.IRawFileMatch2[]): void;\n\t$handleTelemetry(eventName: string, data: any): void;\n}\n\nexport interface MainThreadTaskShape extends IDisposable {\n\t$createTaskId(task: tasks.TaskDTO): Promise<string>;\n\t$registerTaskProvider(handle: number, type: string): Promise<void>;\n\t$unregisterTaskProvider(handle: number): Promise<void>;\n\t$fetchTasks(filter?: tasks.TaskFilterDTO): Promise<tasks.TaskDTO[]>;\n\t$getTaskExecution(value: tasks.TaskHandleDTO | tasks.TaskDTO): Promise<tasks.TaskExecutionDTO>;\n\t$executeTask(task: tasks.TaskHandleDTO | tasks.TaskDTO): Promise<tasks.TaskExecutionDTO>;\n\t$terminateTask(id: string): Promise<void>;\n\t$registerTaskSystem(scheme: string, info: tasks.TaskSystemInfoDTO): void;\n\t$customExecutionComplete(id: string, result?: number): Promise<void>;\n\t$registerSupportedExecutions(custom?: boolean, shell?: boolean, process?: boolean): Promise<void>;\n}\n\nexport interface MainThreadExtensionServiceShape extends IDisposable {\n\t$activateExtension(extensionId: ExtensionIdentifier, reason: ExtensionActivationReason): Promise<void>;\n\t$onWillActivateExtension(extensionId: ExtensionIdentifier): Promise<void>;\n\t$onDidActivateExtension(extensionId: ExtensionIdentifier, codeLoadingTime: number, activateCallTime: number, activateResolvedTime: number, activationReason: ExtensionActivationReason): void;\n\t$onExtensionActivationError(extensionId: ExtensionIdentifier, error: ExtensionActivationError): Promise<void>;\n\t$onExtensionRuntimeError(extensionId: ExtensionIdentifier, error: SerializedError): void;\n\t$onExtensionHostExit(code: number): Promise<void>;\n\t$setPerformanceMarks(marks: performance.PerformanceMark[]): Promise<void>;\n}\n\nexport interface SCMProviderFeatures {\n\thasQuickDiffProvider?: boolean;\n\tcount?: number;\n\tcommitTemplate?: string;\n\tacceptInputCommand?: modes.Command;\n\tstatusBarCommands?: ICommandDto[];\n}\n\nexport interface SCMGroupFeatures {\n\thideWhenEmpty?: boolean;\n}\n\nexport type SCMRawResource = [\n\tnumber /*handle*/,\n\tUriComponents /*resourceUri*/,\n\tUriComponents[] /*icons: light, dark*/,\n\tstring /*tooltip*/,\n\tboolean /*strike through*/,\n\tboolean /*faded*/,\n\tstring /*context value*/,\n\tICommandDto | undefined /*command*/\n];\n\nexport type SCMRawResourceSplice = [\n\tnumber /* start */,\n\tnumber /* delete count */,\n\tSCMRawResource[]\n];\n\nexport type SCMRawResourceSplices = [\n\tnumber, /*handle*/\n\tSCMRawResourceSplice[]\n];\n\nexport interface MainThreadSCMShape extends IDisposable {\n\t$registerSourceControl(handle: number, id: string, label: string, rootUri: UriComponents | undefined): void;\n\t$updateSourceControl(handle: number, features: SCMProviderFeatures): void;\n\t$unregisterSourceControl(handle: number): void;\n\n\t$registerGroups(sourceControlHandle: number, groups: [number /*handle*/, string /*id*/, string /*label*/, SCMGroupFeatures][], splices: SCMRawResourceSplices[]): void;\n\t$updateGroup(sourceControlHandle: number, handle: number, features: SCMGroupFeatures): void;\n\t$updateGroupLabel(sourceControlHandle: number, handle: number, label: string): void;\n\t$unregisterGroup(sourceControlHandle: number, handle: number): void;\n\n\t$spliceResourceStates(sourceControlHandle: number, splices: SCMRawResourceSplices[]): void;\n\n\t$setInputBoxValue(sourceControlHandle: number, value: string): void;\n\t$setInputBoxPlaceholder(sourceControlHandle: number, placeholder: string): void;\n\t$setInputBoxVisibility(sourceControlHandle: number, visible: boolean): void;\n\t$setValidationProviderIsEnabled(sourceControlHandle: number, enabled: boolean): void;\n}\n\nexport type DebugSessionUUID = string;\n\nexport interface IDebugConfiguration {\n\ttype: string;\n\tname: string;\n\trequest: string;\n\t[key: string]: any;\n}\n\nexport interface IStartDebuggingOptions {\n\tparentSessionID?: DebugSessionUUID;\n\trepl?: IDebugSessionReplMode;\n\tnoDebug?: boolean;\n\tcompact?: boolean;\n}\n\nexport interface MainThreadDebugServiceShape extends IDisposable {\n\t$registerDebugTypes(debugTypes: string[]): void;\n\t$sessionCached(sessionID: string): void;\n\t$acceptDAMessage(handle: number, message: DebugProtocol.ProtocolMessage): void;\n\t$acceptDAError(handle: number, name: string, message: string, stack: string | undefined): void;\n\t$acceptDAExit(handle: number, code: number | undefined, signal: string | undefined): void;\n\t$registerDebugConfigurationProvider(type: string, triggerKind: DebugConfigurationProviderTriggerKind, hasProvideMethod: boolean, hasResolveMethod: boolean, hasResolve2Method: boolean, handle: number): Promise<void>;\n\t$registerDebugAdapterDescriptorFactory(type: string, handle: number): Promise<void>;\n\t$unregisterDebugConfigurationProvider(handle: number): void;\n\t$unregisterDebugAdapterDescriptorFactory(handle: number): void;\n\t$startDebugging(folder: UriComponents | undefined, nameOrConfig: string | IDebugConfiguration, options: IStartDebuggingOptions): Promise<boolean>;\n\t$stopDebugging(sessionId: DebugSessionUUID | undefined): Promise<void>;\n\t$setDebugSessionName(id: DebugSessionUUID, name: string): void;\n\t$customDebugAdapterRequest(id: DebugSessionUUID, command: string, args: any): Promise<any>;\n\t$getDebugProtocolBreakpoint(id: DebugSessionUUID, breakpoinId: string): Promise<DebugProtocol.Breakpoint | undefined>;\n\t$appendDebugConsole(value: string): void;\n\t$startBreakpointEvents(): void;\n\t$registerBreakpoints(breakpoints: Array<ISourceMultiBreakpointDto | IFunctionBreakpointDto | IDataBreakpointDto>): Promise<void>;\n\t$unregisterBreakpoints(breakpointIds: string[], functionBreakpointIds: string[], dataBreakpointIds: string[]): Promise<void>;\n}\n\nexport interface IOpenUriOptions {\n\treadonly allowTunneling?: boolean;\n\treadonly allowContributedOpeners?: boolean | string;\n}\n\nexport interface MainThreadWindowShape extends IDisposable {\n\t$getWindowVisibility(): Promise<boolean>;\n\t$openUri(uri: UriComponents, uriString: string | undefined, options: IOpenUriOptions): Promise<boolean>;\n\t$asExternalUri(uri: UriComponents, options: IOpenUriOptions): Promise<UriComponents>;\n}\n\nexport interface MainThreadTunnelServiceShape extends IDisposable {\n\t$openTunnel(tunnelOptions: TunnelOptions, source: string | undefined): Promise<TunnelDto | undefined>;\n\t$closeTunnel(remote: { host: string, port: number }): Promise<void>;\n\t$getTunnels(): Promise<TunnelDescription[]>;\n\t$setTunnelProvider(features: TunnelProviderFeatures): Promise<void>;\n\t$setCandidateFinder(): Promise<void>;\n\t$setCandidateFilter(): Promise<void>;\n\t$onFoundNewCandidates(candidates: { host: string, port: number, detail: string }[]): Promise<void>;\n}\n\nexport interface MainThreadTimelineShape extends IDisposable {\n\t$registerTimelineProvider(provider: TimelineProviderDescriptor): void;\n\t$unregisterTimelineProvider(source: string): void;\n\t$emitTimelineChangeEvent(e: TimelineChangeEvent | undefined): void;\n}\n\n// -- extension host\n\nexport interface ExtHostCommandsShape {\n\t$executeContributedCommand<T>(id: string, ...args: any[]): Promise<T>;\n\t$getContributedCommandHandlerDescriptions(): Promise<{ [id: string]: string | ICommandHandlerDescription; }>;\n}\n\nexport interface ExtHostConfigurationShape {\n\t$initializeConfiguration(data: IConfigurationInitData): void;\n\t$acceptConfigurationChanged(data: IConfigurationInitData, change: IConfigurationChange): void;\n}\n\nexport interface ExtHostDiagnosticsShape {\n\t$acceptMarkersChange(data: [UriComponents, IMarkerData[]][]): void;\n}\n\nexport interface ExtHostDocumentContentProvidersShape {\n\t$provideTextDocumentContent(handle: number, uri: UriComponents): Promise<string | null | undefined>;\n}\n\nexport interface IModelAddedData {\n\turi: UriComponents;\n\tversionId: number;\n\tlines: string[];\n\tEOL: string;\n\tmodeId: string;\n\tisDirty: boolean;\n}\nexport interface ExtHostDocumentsShape {\n\t$acceptModelModeChanged(strURL: UriComponents, oldModeId: string, newModeId: string): void;\n\t$acceptModelSaved(strURL: UriComponents): void;\n\t$acceptDirtyStateChanged(strURL: UriComponents, isDirty: boolean): void;\n\t$acceptModelChanged(strURL: UriComponents, e: IModelChangedEvent, isDirty: boolean): void;\n}\n\nexport interface ExtHostDocumentSaveParticipantShape {\n\t$participateInSave(resource: UriComponents, reason: SaveReason): Promise<boolean[]>;\n}\n\nexport interface ITextEditorAddData {\n\tid: string;\n\tdocumentUri: UriComponents;\n\toptions: IResolvedTextEditorConfiguration;\n\tselections: ISelection[];\n\tvisibleRanges: IRange[];\n\teditorPosition: EditorGroupColumn | undefined;\n}\nexport interface ITextEditorPositionData {\n\t[id: string]: EditorGroupColumn;\n}\nexport interface IEditorPropertiesChangeData {\n\toptions: IResolvedTextEditorConfiguration | null;\n\tselections: ISelectionChangeEvent | null;\n\tvisibleRanges: IRange[] | null;\n}\nexport interface ISelectionChangeEvent {\n\tselections: Selection[];\n\tsource?: string;\n}\n\nexport interface ExtHostEditorsShape {\n\t$acceptEditorPropertiesChanged(id: string, props: IEditorPropertiesChangeData): void;\n\t$acceptEditorPositionData(data: ITextEditorPositionData): void;\n}\n\nexport interface IDocumentsAndEditorsDelta {\n\tremovedDocuments?: UriComponents[];\n\taddedDocuments?: IModelAddedData[];\n\tremovedEditors?: string[];\n\taddedEditors?: ITextEditorAddData[];\n\tnewActiveEditor?: string | null;\n}\n\nexport interface ExtHostDocumentsAndEditorsShape {\n\t$acceptDocumentsAndEditorsDelta(delta: IDocumentsAndEditorsDelta): void;\n}\n\nexport interface ExtHostTreeViewsShape {\n\t$getChildren(treeViewId: string, treeItemHandle?: string): Promise<ITreeItem[]>;\n\t$setExpanded(treeViewId: string, treeItemHandle: string, expanded: boolean): void;\n\t$setSelection(treeViewId: string, treeItemHandles: string[]): void;\n\t$setVisible(treeViewId: string, visible: boolean): void;\n\t$hasResolve(treeViewId: string): Promise<boolean>;\n\t$resolve(treeViewId: string, treeItemHandle: string, token: CancellationToken): Promise<ITreeItem | undefined>;\n}\n\nexport interface ExtHostWorkspaceShape {\n\t$initializeWorkspace(workspace: IWorkspaceData | null): void;\n\t$acceptWorkspaceData(workspace: IWorkspaceData | null): void;\n\t$handleTextSearchResult(result: search.IRawFileMatch2, requestId: number): void;\n}\n\nexport interface ExtHostFileSystemInfoShape {\n\t$acceptProviderInfos(scheme: string, capabilities: number | null): void;\n}\n\nexport interface ExtHostFileSystemShape {\n\t$stat(handle: number, resource: UriComponents): Promise<files.IStat>;\n\t$readdir(handle: number, resource: UriComponents): Promise<[string, files.FileType][]>;\n\t$readFile(handle: number, resource: UriComponents): Promise<VSBuffer>;\n\t$writeFile(handle: number, resource: UriComponents, content: VSBuffer, opts: files.FileWriteOptions): Promise<void>;\n\t$rename(handle: number, resource: UriComponents, target: UriComponents, opts: files.FileOverwriteOptions): Promise<void>;\n\t$copy(handle: number, resource: UriComponents, target: UriComponents, opts: files.FileOverwriteOptions): Promise<void>;\n\t$mkdir(handle: number, resource: UriComponents): Promise<void>;\n\t$delete(handle: number, resource: UriComponents, opts: files.FileDeleteOptions): Promise<void>;\n\t$watch(handle: number, session: number, resource: UriComponents, opts: files.IWatchOptions): void;\n\t$unwatch(handle: number, session: number): void;\n\t$open(handle: number, resource: UriComponents, opts: files.FileOpenOptions): Promise<number>;\n\t$close(handle: number, fd: number): Promise<void>;\n\t$read(handle: number, fd: number, pos: number, length: number): Promise<VSBuffer>;\n\t$write(handle: number, fd: number, pos: number, data: VSBuffer): Promise<number>;\n}\n\nexport interface ExtHostLabelServiceShape {\n\t$registerResourceLabelFormatter(formatter: ResourceLabelFormatter): IDisposable;\n}\n\nexport interface ExtHostAuthenticationShape {\n\t$getSessions(id: string): Promise<ReadonlyArray<modes.AuthenticationSession>>;\n\t$getSessionAccessToken(id: string, sessionId: string): Promise<string>;\n\t$login(id: string, scopes: string[]): Promise<modes.AuthenticationSession>;\n\t$logout(id: string, sessionId: string): Promise<void>;\n\t$onDidChangeAuthenticationSessions(id: string, label: string, event: modes.AuthenticationSessionsChangeEvent): Promise<void>;\n\t$onDidChangeAuthenticationProviders(added: modes.AuthenticationProviderInformation[], removed: modes.AuthenticationProviderInformation[]): Promise<void>;\n\t$setProviders(providers: modes.AuthenticationProviderInformation[]): Promise<void>;\n}\n\nexport interface ExtHostSecretStateShape {\n\t$onDidChangePassword(e: { extensionId: string, key: string }): Promise<void>;\n}\n\nexport interface ExtHostSearchShape {\n\t$provideFileSearchResults(handle: number, session: number, query: search.IRawQuery, token: CancellationToken): Promise<search.ISearchCompleteStats>;\n\t$provideTextSearchResults(handle: number, session: number, query: search.IRawTextQuery, token: CancellationToken): Promise<search.ISearchCompleteStats>;\n\t$clearCache(cacheKey: string): Promise<void>;\n}\n\nexport interface IResolveAuthorityErrorResult {\n\ttype: 'error';\n\terror: {\n\t\tmessage: string | undefined;\n\t\tcode: RemoteAuthorityResolverErrorCode;\n\t\tdetail: any;\n\t};\n}\n\nexport interface IResolveAuthorityOKResult {\n\ttype: 'ok';\n\tvalue: ResolverResult;\n}\n\nexport type IResolveAuthorityResult = IResolveAuthorityErrorResult | IResolveAuthorityOKResult;\n\nexport interface ExtHostExtensionServiceShape {\n\t$resolveAuthority(remoteAuthority: string, resolveAttempt: number): Promise<IResolveAuthorityResult>;\n\t$startExtensionHost(enabledExtensionIds: ExtensionIdentifier[]): Promise<void>;\n\t$activateByEvent(activationEvent: string, activationKind: ActivationKind): Promise<void>;\n\t$activate(extensionId: ExtensionIdentifier, reason: ExtensionActivationReason): Promise<boolean>;\n\t$setRemoteEnvironment(env: { [key: string]: string | null; }): Promise<void>;\n\t$updateRemoteConnectionData(connectionData: IRemoteConnectionData): Promise<void>;\n\n\t$deltaExtensions(toAdd: IExtensionDescription[], toRemove: ExtensionIdentifier[]): Promise<void>;\n\n\t$test_latency(n: number): Promise<number>;\n\t$test_up(b: VSBuffer): Promise<number>;\n\t$test_down(size: number): Promise<VSBuffer>;\n}\n\nexport interface FileSystemEvents {\n\tcreated: UriComponents[];\n\tchanged: UriComponents[];\n\tdeleted: UriComponents[];\n}\n\nexport interface SourceTargetPair {\n\tsource?: UriComponents;\n\ttarget: UriComponents;\n}\n\nexport interface IWillRunFileOperationParticipation {\n\tedit: IWorkspaceEditDto;\n\textensionNames: string[]\n}\n\nexport interface ExtHostFileSystemEventServiceShape {\n\t$onFileEvent(events: FileSystemEvents): void;\n\t$onWillRunFileOperation(operation: files.FileOperation, files: SourceTargetPair[], timeout: number, token: CancellationToken): Promise<IWillRunFileOperationParticipation | undefined>;\n\t$onDidRunFileOperation(operation: files.FileOperation, files: SourceTargetPair[]): void;\n}\n\nexport interface ObjectIdentifier {\n\t$ident?: number;\n}\n\nexport namespace ObjectIdentifier {\n\texport const name = '$ident';\n\texport function mixin<T>(obj: T, id: number): T & ObjectIdentifier {\n\t\tObject.defineProperty(obj, name, { value: id, enumerable: true });\n\t\treturn <T & ObjectIdentifier>obj;\n\t}\n\texport function of(obj: any): number {\n\t\treturn obj[name];\n\t}\n}\n\nexport interface ExtHostHeapServiceShape {\n\t$onGarbageCollection(ids: number[]): void;\n}\nexport interface IRawColorInfo {\n\tcolor: [number, number, number, number];\n\trange: IRange;\n}\n\nexport class IdObject {\n\t_id?: number;\n\tprivate static _n = 0;\n\tstatic mixin<T extends object>(object: T): T & IdObject {\n\t\t(<any>object)._id = IdObject._n++;\n\t\treturn <any>object;\n\t}\n}\n\nexport const enum ISuggestDataDtoField {\n\tlabel = 'a',\n\tkind = 'b',\n\tdetail = 'c',\n\tdocumentation = 'd',\n\tsortText = 'e',\n\tfilterText = 'f',\n\tpreselect = 'g',\n\tinsertText = 'h',\n\tinsertTextRules = 'i',\n\trange = 'j',\n\tcommitCharacters = 'k',\n\tadditionalTextEdits = 'l',\n\tcommand = 'm',\n\tkindModifier = 'n',\n\n\t// to merge into label\n\tlabel2 = 'o',\n}\n\nexport interface ISuggestDataDto {\n\t[ISuggestDataDtoField.label]: string;\n\t[ISuggestDataDtoField.label2]?: string | modes.CompletionItemLabel;\n\t[ISuggestDataDtoField.kind]?: modes.CompletionItemKind;\n\t[ISuggestDataDtoField.detail]?: string;\n\t[ISuggestDataDtoField.documentation]?: string | IMarkdownString;\n\t[ISuggestDataDtoField.sortText]?: string;\n\t[ISuggestDataDtoField.filterText]?: string;\n\t[ISuggestDataDtoField.preselect]?: true;\n\t[ISuggestDataDtoField.insertText]?: string;\n\t[ISuggestDataDtoField.insertTextRules]?: modes.CompletionItemInsertTextRule;\n\t[ISuggestDataDtoField.range]?: IRange | { insert: IRange, replace: IRange; };\n\t[ISuggestDataDtoField.commitCharacters]?: string[];\n\t[ISuggestDataDtoField.additionalTextEdits]?: ISingleEditOperation[];\n\t[ISuggestDataDtoField.command]?: modes.Command;\n\t[ISuggestDataDtoField.kindModifier]?: modes.CompletionItemTag[];\n\t// not-standard\n\tx?: ChainedCacheId;\n}\n\nexport const enum ISuggestResultDtoField {\n\tdefaultRanges = 'a',\n\tcompletions = 'b',\n\tisIncomplete = 'c',\n\tduration = 'd',\n}\n\nexport interface ISuggestResultDto {\n\t[ISuggestResultDtoField.defaultRanges]: { insert: IRange, replace: IRange; };\n\t[ISuggestResultDtoField.completions]: ISuggestDataDto[];\n\t[ISuggestResultDtoField.isIncomplete]: undefined | true;\n\t[ISuggestResultDtoField.duration]: number;\n\tx?: number;\n}\n\nexport interface ISignatureHelpDto {\n\tid: CacheId;\n\tsignatures: modes.SignatureInformation[];\n\tactiveSignature: number;\n\tactiveParameter: number;\n}\n\nexport interface ISignatureHelpContextDto {\n\treadonly triggerKind: modes.SignatureHelpTriggerKind;\n\treadonly triggerCharacter?: string;\n\treadonly isRetrigger: boolean;\n\treadonly activeSignatureHelp?: ISignatureHelpDto;\n}\n\nexport interface IInlineHintDto {\n\ttext: string;\n\trange: IRange;\n\thoverMessage?: string;\n\twhitespaceBefore?: boolean;\n\twhitespaceAfter?: boolean;\n}\n\nexport interface IInlineHintsDto {\n\thints: IInlineHintDto[]\n}\n\nexport interface ILocationDto {\n\turi: UriComponents;\n\trange: IRange;\n}\n\nexport interface IDefinitionLinkDto {\n\toriginSelectionRange?: IRange;\n\turi: UriComponents;\n\trange: IRange;\n\ttargetSelectionRange?: IRange;\n}\n\nexport interface IWorkspaceSymbolDto extends IdObject {\n\tname: string;\n\tcontainerName?: string;\n\tkind: modes.SymbolKind;\n\tlocation: ILocationDto;\n}\n\nexport interface IWorkspaceSymbolsDto extends IdObject {\n\tsymbols: IWorkspaceSymbolDto[];\n}\n\nexport interface IWorkspaceEditEntryMetadataDto {\n\tneedsConfirmation: boolean;\n\tlabel: string;\n\tdescription?: string;\n\ticonPath?: { id: string } | UriComponents | { light: UriComponents, dark: UriComponents };\n}\n\nexport const enum WorkspaceEditType {\n\tFile = 1,\n\tText = 2,\n\tCell = 3,\n}\n\nexport interface IWorkspaceFileEditDto {\n\t_type: WorkspaceEditType.File;\n\toldUri?: UriComponents;\n\tnewUri?: UriComponents;\n\toptions?: modes.WorkspaceFileEditOptions\n\tmetadata?: IWorkspaceEditEntryMetadataDto;\n}\n\nexport interface IWorkspaceTextEditDto {\n\t_type: WorkspaceEditType.Text;\n\tresource: UriComponents;\n\tedit: modes.TextEdit;\n\tmodelVersionId?: number;\n\tmetadata?: IWorkspaceEditEntryMetadataDto;\n}\n\nexport interface IWorkspaceCellEditDto {\n\t_type: WorkspaceEditType.Cell;\n\tresource: UriComponents;\n\tedit: ICellEditOperation;\n\tnotebookVersionId?: number;\n\tmetadata?: IWorkspaceEditEntryMetadataDto;\n}\n\nexport interface IWorkspaceEditDto {\n\tedits: Array<IWorkspaceFileEditDto | IWorkspaceTextEditDto | IWorkspaceCellEditDto>;\n\n\t// todo@jrieken reject should go into rename\n\trejectReason?: string;\n}\n\nexport function reviveWorkspaceEditDto(data: IWorkspaceEditDto | undefined): modes.WorkspaceEdit {\n\tif (data && data.edits) {\n\t\tfor (const edit of data.edits) {\n\t\t\tif (typeof (<IWorkspaceTextEditDto>edit).resource === 'object') {\n\t\t\t\t(<IWorkspaceTextEditDto>edit).resource = URI.revive((<IWorkspaceTextEditDto>edit).resource);\n\t\t\t} else {\n\t\t\t\t(<IWorkspaceFileEditDto>edit).newUri = URI.revive((<IWorkspaceFileEditDto>edit).newUri);\n\t\t\t\t(<IWorkspaceFileEditDto>edit).oldUri = URI.revive((<IWorkspaceFileEditDto>edit).oldUri);\n\t\t\t}\n\t\t\tif (edit.metadata && edit.metadata.iconPath) {\n\t\t\t\tedit.metadata = revive(edit.metadata);\n\t\t\t}\n\t\t}\n\t}\n\treturn <modes.WorkspaceEdit>data;\n}\n\nexport type ICommandDto = ObjectIdentifier & modes.Command;\n\nexport interface ICodeActionDto {\n\tcacheId?: ChainedCacheId;\n\ttitle: string;\n\tedit?: IWorkspaceEditDto;\n\tdiagnostics?: IMarkerData[];\n\tcommand?: ICommandDto;\n\tkind?: string;\n\tisPreferred?: boolean;\n\tdisabled?: string;\n}\n\nexport interface ICodeActionListDto {\n\tcacheId: CacheId;\n\tactions: ReadonlyArray<ICodeActionDto>;\n}\n\nexport interface ICodeActionProviderMetadataDto {\n\treadonly providedKinds?: readonly string[];\n\treadonly documentation?: ReadonlyArray<{ readonly kind: string, readonly command: ICommandDto }>;\n}\n\nexport type CacheId = number;\nexport type ChainedCacheId = [CacheId, CacheId];\n\nexport interface ILinksListDto {\n\tid?: CacheId;\n\tlinks: ILinkDto[];\n}\n\nexport interface ILinkDto {\n\tcacheId?: ChainedCacheId;\n\trange: IRange;\n\turl?: string | UriComponents;\n\ttooltip?: string;\n}\n\nexport interface ICodeLensListDto {\n\tcacheId?: number;\n\tlenses: ICodeLensDto[];\n}\n\nexport interface ICodeLensDto {\n\tcacheId?: ChainedCacheId;\n\trange: IRange;\n\tcommand?: ICommandDto;\n}\n\nexport type ICallHierarchyItemDto = Dto<CallHierarchyItem>;\n\nexport interface IIncomingCallDto {\n\tfrom: ICallHierarchyItemDto;\n\tfromRanges: IRange[];\n}\n\nexport interface IOutgoingCallDto {\n\tfromRanges: IRange[];\n\tto: ICallHierarchyItemDto;\n}\n\nexport interface ILanguageWordDefinitionDto {\n\tlanguageId: string;\n\tregexSource: string;\n\tregexFlags: string\n}\n\nexport interface ILinkedEditingRangesDto {\n\tranges: IRange[];\n\twordPattern?: IRegExpDto;\n}\n\nexport interface ExtHostLanguageFeaturesShape {\n\t$provideDocumentSymbols(handle: number, resource: UriComponents, token: CancellationToken): Promise<modes.DocumentSymbol[] | undefined>;\n\t$provideCodeLenses(handle: number, resource: UriComponents, token: CancellationToken): Promise<ICodeLensListDto | undefined>;\n\t$resolveCodeLens(handle: number, symbol: ICodeLensDto, token: CancellationToken): Promise<ICodeLensDto | undefined>;\n\t$releaseCodeLenses(handle: number, id: number): void;\n\t$provideDefinition(handle: number, resource: UriComponents, position: IPosition, token: CancellationToken): Promise<IDefinitionLinkDto[]>;\n\t$provideDeclaration(handle: number, resource: UriComponents, position: IPosition, token: CancellationToken): Promise<IDefinitionLinkDto[]>;\n\t$provideImplementation(handle: number, resource: UriComponents, position: IPosition, token: CancellationToken): Promise<IDefinitionLinkDto[]>;\n\t$provideTypeDefinition(handle: number, resource: UriComponents, position: IPosition, token: CancellationToken): Promise<IDefinitionLinkDto[]>;\n\t$provideHover(handle: number, resource: UriComponents, position: IPosition, token: CancellationToken): Promise<modes.Hover | undefined>;\n\t$provideEvaluatableExpression(handle: number, resource: UriComponents, position: IPosition, token: CancellationToken): Promise<modes.EvaluatableExpression | undefined>;\n\t$provideDocumentHighlights(handle: number, resource: UriComponents, position: IPosition, token: CancellationToken): Promise<modes.DocumentHighlight[] | undefined>;\n\t$provideLinkedEditingRanges(handle: number, resource: UriComponents, position: IPosition, token: CancellationToken): Promise<ILinkedEditingRangesDto | undefined>;\n\t$provideReferences(handle: number, resource: UriComponents, position: IPosition, context: modes.ReferenceContext, token: CancellationToken): Promise<ILocationDto[] | undefined>;\n\t$provideCodeActions(handle: number, resource: UriComponents, rangeOrSelection: IRange | ISelection, context: modes.CodeActionContext, token: CancellationToken): Promise<ICodeActionListDto | undefined>;\n\t$resolveCodeAction(handle: number, id: ChainedCacheId, token: CancellationToken): Promise<IWorkspaceEditDto | undefined>;\n\t$releaseCodeActions(handle: number, cacheId: number): void;\n\t$provideDocumentFormattingEdits(handle: number, resource: UriComponents, options: modes.FormattingOptions, token: CancellationToken): Promise<ISingleEditOperation[] | undefined>;\n\t$provideDocumentRangeFormattingEdits(handle: number, resource: UriComponents, range: IRange, options: modes.FormattingOptions, token: CancellationToken): Promise<ISingleEditOperation[] | undefined>;\n\t$provideOnTypeFormattingEdits(handle: number, resource: UriComponents, position: IPosition, ch: string, options: modes.FormattingOptions, token: CancellationToken): Promise<ISingleEditOperation[] | undefined>;\n\t$provideWorkspaceSymbols(handle: number, search: string, token: CancellationToken): Promise<IWorkspaceSymbolsDto>;\n\t$resolveWorkspaceSymbol(handle: number, symbol: IWorkspaceSymbolDto, token: CancellationToken): Promise<IWorkspaceSymbolDto | undefined>;\n\t$releaseWorkspaceSymbols(handle: number, id: number): void;\n\t$provideRenameEdits(handle: number, resource: UriComponents, position: IPosition, newName: string, token: CancellationToken): Promise<IWorkspaceEditDto | undefined>;\n\t$resolveRenameLocation(handle: number, resource: UriComponents, position: IPosition, token: CancellationToken): Promise<modes.RenameLocation | undefined>;\n\t$provideDocumentSemanticTokens(handle: number, resource: UriComponents, previousResultId: number, token: CancellationToken): Promise<VSBuffer | null>;\n\t$releaseDocumentSemanticTokens(handle: number, semanticColoringResultId: number): void;\n\t$provideDocumentRangeSemanticTokens(handle: number, resource: UriComponents, range: IRange, token: CancellationToken): Promise<VSBuffer | null>;\n\t$provideCompletionItems(handle: number, resource: UriComponents, position: IPosition, context: modes.CompletionContext, token: CancellationToken): Promise<ISuggestResultDto | undefined>;\n\t$resolveCompletionItem(handle: number, id: ChainedCacheId, token: CancellationToken): Promise<ISuggestDataDto | undefined>;\n\t$releaseCompletionItems(handle: number, id: number): void;\n\t$provideSignatureHelp(handle: number, resource: UriComponents, position: IPosition, context: modes.SignatureHelpContext, token: CancellationToken): Promise<ISignatureHelpDto | undefined>;\n\t$releaseSignatureHelp(handle: number, id: number): void;\n\t$provideInlineHints(handle: number, resource: UriComponents, range: IRange, token: CancellationToken): Promise<IInlineHintsDto | undefined>\n\t$provideDocumentLinks(handle: number, resource: UriComponents, token: CancellationToken): Promise<ILinksListDto | undefined>;\n\t$resolveDocumentLink(handle: number, id: ChainedCacheId, token: CancellationToken): Promise<ILinkDto | undefined>;\n\t$releaseDocumentLinks(handle: number, id: number): void;\n\t$provideDocumentColors(handle: number, resource: UriComponents, token: CancellationToken): Promise<IRawColorInfo[]>;\n\t$provideColorPresentations(handle: number, resource: UriComponents, colorInfo: IRawColorInfo, token: CancellationToken): Promise<modes.IColorPresentation[] | undefined>;\n\t$provideFoldingRanges(handle: number, resource: UriComponents, context: modes.FoldingContext, token: CancellationToken): Promise<modes.FoldingRange[] | undefined>;\n\t$provideSelectionRanges(handle: number, resource: UriComponents, positions: IPosition[], token: CancellationToken): Promise<modes.SelectionRange[][]>;\n\t$prepareCallHierarchy(handle: number, resource: UriComponents, position: IPosition, token: CancellationToken): Promise<ICallHierarchyItemDto[] | undefined>;\n\t$provideCallHierarchyIncomingCalls(handle: number, sessionId: string, itemId: string, token: CancellationToken): Promise<IIncomingCallDto[] | undefined>;\n\t$provideCallHierarchyOutgoingCalls(handle: number, sessionId: string, itemId: string, token: CancellationToken): Promise<IOutgoingCallDto[] | undefined>;\n\t$releaseCallHierarchy(handle: number, sessionId: string): void;\n\t$setWordDefinitions(wordDefinitions: ILanguageWordDefinitionDto[]): void;\n}\n\nexport interface ExtHostQuickOpenShape {\n\t$onItemSelected(handle: number): void;\n\t$validateInput(input: string): Promise<string | null | undefined>;\n\t$onDidChangeActive(sessionId: number, handles: number[]): void;\n\t$onDidChangeSelection(sessionId: number, handles: number[]): void;\n\t$onDidAccept(sessionId: number): void;\n\t$onDidChangeValue(sessionId: number, value: string): void;\n\t$onDidTriggerButton(sessionId: number, handle: number): void;\n\t$onDidHide(sessionId: number): void;\n}\n\nexport interface IShellLaunchConfigDto {\n\tname?: string;\n\texecutable?: string;\n\targs?: string[] | string;\n\tcwd?: string | UriComponents;\n\tenv?: { [key: string]: string | null; };\n\thideFromUser?: boolean;\n\tflowControl?: boolean;\n}\n\nexport interface IShellDefinitionDto {\n\tlabel: string;\n\tpath: string;\n}\n\nexport interface IShellAndArgsDto {\n\tshell: string;\n\targs: string[] | string | undefined;\n}\n\nexport interface ITerminalLinkDto {\n\t/** The ID of the link to enable activation and disposal. */\n\tid: number;\n\t/** The startIndex of the link in the line. */\n\tstartIndex: number;\n\t/** The length of the link in the line. */\n\tlength: number;\n\t/** The descriptive label for what the link does when activated. */\n\tlabel?: string;\n}\n\nexport interface ITerminalDimensionsDto {\n\tcolumns: number;\n\trows: number;\n}\n\nexport interface ExtHostTerminalServiceShape {\n\t$acceptTerminalClosed(id: number, exitCode: number | undefined): void;\n\t$acceptTerminalOpened(id: number, extHostTerminalId: string | undefined, name: string, shellLaunchConfig: IShellLaunchConfigDto): void;\n\t$acceptActiveTerminalChanged(id: number | null): void;\n\t$acceptTerminalProcessId(id: number, processId: number): void;\n\t$acceptTerminalProcessData(id: number, data: string): void;\n\t$acceptTerminalTitleChange(id: number, name: string): void;\n\t$acceptTerminalDimensions(id: number, cols: number, rows: number): void;\n\t$acceptTerminalMaximumDimensions(id: number, cols: number, rows: number): void;\n\t$spawnExtHostProcess(id: number, shellLaunchConfig: IShellLaunchConfigDto, activeWorkspaceRootUri: UriComponents | undefined, cols: number, rows: number, isWorkspaceShellAllowed: boolean): Promise<ITerminalLaunchError | undefined>;\n\t$startExtensionTerminal(id: number, initialDimensions: ITerminalDimensionsDto | undefined): Promise<ITerminalLaunchError | undefined>;\n\t$acceptProcessAckDataEvent(id: number, charCount: number): void;\n\t$acceptProcessInput(id: number, data: string): void;\n\t$acceptProcessResize(id: number, cols: number, rows: number): void;\n\t$acceptProcessShutdown(id: number, immediate: boolean): void;\n\t$acceptProcessRequestInitialCwd(id: number): void;\n\t$acceptProcessRequestCwd(id: number): void;\n\t$acceptProcessRequestLatency(id: number): number;\n\t$acceptWorkspacePermissionsChanged(isAllowed: boolean): void;\n\t$getAvailableShells(): Promise<IShellDefinitionDto[]>;\n\t$getDefaultShellAndArgs(useAutomationShell: boolean): Promise<IShellAndArgsDto>;\n\t$provideLinks(id: number, line: string): Promise<ITerminalLinkDto[]>;\n\t$activateLink(id: number, linkId: number): void;\n\t$initEnvironmentVariableCollections(collections: [string, ISerializableEnvironmentVariableCollection][]): void;\n}\n\nexport interface ExtHostSCMShape {\n\t$provideOriginalResource(sourceControlHandle: number, uri: UriComponents, token: CancellationToken): Promise<UriComponents | null>;\n\t$onInputBoxValueChange(sourceControlHandle: number, value: string): void;\n\t$executeResourceCommand(sourceControlHandle: number, groupHandle: number, handle: number, preserveFocus: boolean): Promise<void>;\n\t$validateInput(sourceControlHandle: number, value: string, cursorPosition: number): Promise<[string, number] | undefined>;\n\t$setSelectedSourceControl(selectedSourceControlHandle: number | undefined): Promise<void>;\n}\n\nexport interface ExtHostTaskShape {\n\t$provideTasks(handle: number, validTypes: { [key: string]: boolean; }): Thenable<tasks.TaskSetDTO>;\n\t$resolveTask(handle: number, taskDTO: tasks.TaskDTO): Thenable<tasks.TaskDTO | undefined>;\n\t$onDidStartTask(execution: tasks.TaskExecutionDTO, terminalId: number, resolvedDefinition: tasks.TaskDefinitionDTO): void;\n\t$onDidStartTaskProcess(value: tasks.TaskProcessStartedDTO): void;\n\t$onDidEndTaskProcess(value: tasks.TaskProcessEndedDTO): void;\n\t$OnDidEndTask(execution: tasks.TaskExecutionDTO): void;\n\t$resolveVariables(workspaceFolder: UriComponents, toResolve: { process?: { name: string; cwd?: string; }, variables: string[]; }): Promise<{ process?: string; variables: { [key: string]: string; }; }>;\n\t$getDefaultShellAndArgs(): Thenable<{ shell: string, args: string[] | string | undefined; }>;\n\t$jsonTasksSupported(): Thenable<boolean>;\n\t$findExecutable(command: string, cwd?: string, paths?: string[]): Promise<string | undefined>;\n}\n\nexport interface IBreakpointDto {\n\ttype: string;\n\tid?: string;\n\tenabled: boolean;\n\tcondition?: string;\n\thitCondition?: string;\n\tlogMessage?: string;\n}\n\nexport interface IFunctionBreakpointDto extends IBreakpointDto {\n\ttype: 'function';\n\tfunctionName: string;\n}\n\nexport interface IDataBreakpointDto extends IBreakpointDto {\n\ttype: 'data';\n\tdataId: string;\n\tcanPersist: boolean;\n\tlabel: string;\n\taccessTypes?: DebugProtocol.DataBreakpointAccessType[];\n}\n\nexport interface ISourceBreakpointDto extends IBreakpointDto {\n\ttype: 'source';\n\turi: UriComponents;\n\tline: number;\n\tcharacter: number;\n}\n\nexport interface IBreakpointsDeltaDto {\n\tadded?: Array<ISourceBreakpointDto | IFunctionBreakpointDto | IDataBreakpointDto>;\n\tremoved?: string[];\n\tchanged?: Array<ISourceBreakpointDto | IFunctionBreakpointDto | IDataBreakpointDto>;\n}\n\nexport interface ISourceMultiBreakpointDto {\n\ttype: 'sourceMulti';\n\turi: UriComponents;\n\tlines: {\n\t\tid: string;\n\t\tenabled: boolean;\n\t\tcondition?: string;\n\t\thitCondition?: string;\n\t\tlogMessage?: string;\n\t\tline: number;\n\t\tcharacter: number;\n\t}[];\n}\n\nexport interface IDebugSessionFullDto {\n\tid: DebugSessionUUID;\n\ttype: string;\n\tname: string;\n\tfolderUri: UriComponents | undefined;\n\tconfiguration: IConfig;\n}\n\nexport type IDebugSessionDto = IDebugSessionFullDto | DebugSessionUUID;\n\nexport interface ExtHostDebugServiceShape {\n\t$substituteVariables(folder: UriComponents | undefined, config: IConfig): Promise<IConfig>;\n\t$runInTerminal(args: DebugProtocol.RunInTerminalRequestArguments): Promise<number | undefined>;\n\t$startDASession(handle: number, session: IDebugSessionDto): Promise<void>;\n\t$stopDASession(handle: number): Promise<void>;\n\t$sendDAMessage(handle: number, message: DebugProtocol.ProtocolMessage): void;\n\t$resolveDebugConfiguration(handle: number, folder: UriComponents | undefined, debugConfiguration: IConfig, token: CancellationToken): Promise<IConfig | null | undefined>;\n\t$resolveDebugConfigurationWithSubstitutedVariables(handle: number, folder: UriComponents | undefined, debugConfiguration: IConfig, token: CancellationToken): Promise<IConfig | null | undefined>;\n\t$provideDebugConfigurations(handle: number, folder: UriComponents | undefined, token: CancellationToken): Promise<IConfig[]>;\n\t$provideDebugAdapter(handle: number, session: IDebugSessionDto): Promise<IAdapterDescriptor>;\n\t$acceptDebugSessionStarted(session: IDebugSessionDto): void;\n\t$acceptDebugSessionTerminated(session: IDebugSessionDto): void;\n\t$acceptDebugSessionActiveChanged(session: IDebugSessionDto | undefined): void;\n\t$acceptDebugSessionCustomEvent(session: IDebugSessionDto, event: any): void;\n\t$acceptBreakpointsDelta(delta: IBreakpointsDeltaDto): void;\n\t$acceptDebugSessionNameChanged(session: IDebugSessionDto, name: string): void;\n}\n\n\nexport interface DecorationRequest {\n\treadonly id: number;\n\treadonly uri: UriComponents;\n}\n\nexport type DecorationData = [boolean, string, string, ThemeColor];\nexport type DecorationReply = { [id: number]: DecorationData; };\n\nexport interface ExtHostDecorationsShape {\n\t$provideDecorations(handle: number, requests: DecorationRequest[], token: CancellationToken): Promise<DecorationReply>;\n}\n\nexport interface ExtHostWindowShape {\n\t$onDidChangeWindowFocus(value: boolean): void;\n}\n\nexport interface ExtHostLogServiceShape {\n\t$setLevel(level: LogLevel): void;\n}\n\nexport interface MainThreadLogShape {\n\t$log(file: UriComponents, level: LogLevel, args: any[]): void;\n}\n\nexport interface ExtHostOutputServiceShape {\n\t$setVisibleChannel(channelId: string | null): void;\n}\n\nexport interface ExtHostProgressShape {\n\t$acceptProgressCanceled(handle: number): void;\n}\n\nexport interface ExtHostCommentsShape {\n\t$createCommentThreadTemplate(commentControllerHandle: number, uriComponents: UriComponents, range: IRange): void;\n\t$updateCommentThreadTemplate(commentControllerHandle: number, threadHandle: number, range: IRange): Promise<void>;\n\t$deleteCommentThread(commentControllerHandle: number, commentThreadHandle: number): void;\n\t$provideCommentingRanges(commentControllerHandle: number, uriComponents: UriComponents, token: CancellationToken): Promise<IRange[] | undefined>;\n\t$toggleReaction(commentControllerHandle: number, threadHandle: number, uri: UriComponents, comment: modes.Comment, reaction: modes.CommentReaction): Promise<void>;\n}\n\nexport interface INotebookSelectionChangeEvent {\n\t// handles\n\tselections: number[];\n}\n\nexport interface INotebookCellVisibleRange {\n\tstart: number;\n\tend: number;\n}\n\nexport interface INotebookVisibleRangesEvent {\n\tranges: INotebookCellVisibleRange[];\n}\n\nexport interface INotebookEditorPropertiesChangeData {\n\tvisibleRanges: INotebookVisibleRangesEvent | null;\n\tselections: INotebookSelectionChangeEvent | null;\n}\n\nexport interface INotebookDocumentPropertiesChangeData {\n\tmetadata: NotebookDocumentMetadata | null;\n}\n\nexport interface INotebookModelAddedData {\n\turi: UriComponents;\n\tversionId: number;\n\tcells: IMainCellDto[],\n\tviewType: string;\n\tmetadata?: NotebookDocumentMetadata;\n\tattachedEditor?: { id: string; selections: number[]; visibleRanges: ICellRange[] }\n\tcontentOptions: { transientOutputs: boolean; transientMetadata: TransientMetadata; }\n}\n\nexport interface INotebookEditorAddData {\n\tid: string;\n\tdocumentUri: UriComponents;\n\tselections: number[];\n\tvisibleRanges: ICellRange[];\n}\n\nexport interface INotebookDocumentsAndEditorsDelta {\n\tremovedDocuments?: UriComponents[];\n\taddedDocuments?: INotebookModelAddedData[];\n\tremovedEditors?: string[];\n\taddedEditors?: INotebookEditorAddData[];\n\tnewActiveEditor?: string | null;\n\tvisibleEditors?: string[];\n}\n\nexport interface ExtHostNotebookShape {\n\t$resolveNotebookData(viewType: string, uri: UriComponents, backupId?: string): Promise<NotebookDataDto>;\n\t$resolveNotebookEditor(viewType: string, uri: UriComponents, editorId: string): Promise<void>;\n\t$provideNotebookKernels(handle: number, uri: UriComponents, token: CancellationToken): Promise<INotebookKernelInfoDto2[]>;\n\t$resolveNotebookKernel(handle: number, editorId: string, uri: UriComponents, kernelId: string, token: CancellationToken): Promise<void>;\n\t$executeNotebookKernelFromProvider(handle: number, uri: UriComponents, kernelId: string, cellHandle: number | undefined): Promise<void>;\n\t$cancelNotebookKernelFromProvider(handle: number, uri: UriComponents, kernelId: string, cellHandle: number | undefined): Promise<void>;\n\t$saveNotebook(viewType: string, uri: UriComponents, token: CancellationToken): Promise<boolean>;\n\t$saveNotebookAs(viewType: string, uri: UriComponents, target: UriComponents, token: CancellationToken): Promise<boolean>;\n\t$backup(viewType: string, uri: UriComponents, cancellation: CancellationToken): Promise<string | undefined>;\n\t$acceptDisplayOrder(displayOrder: INotebookDisplayOrder): void;\n\t$acceptNotebookActiveKernelChange(event: { uri: UriComponents, providerHandle: number | undefined, kernelFriendlyId: string | undefined }): void;\n\t$onDidReceiveMessage(editorId: string, rendererId: string | undefined, message: unknown): void;\n\t$acceptModelChanged(uriComponents: UriComponents, event: NotebookCellsChangedEventDto, isDirty: boolean): void;\n\t$acceptModelSaved(uriComponents: UriComponents): void;\n\t$acceptEditorPropertiesChanged(id: string, data: INotebookEditorPropertiesChangeData): void;\n\t$acceptDocumentPropertiesChanged(uriComponents: UriComponents, data: INotebookDocumentPropertiesChangeData): void;\n\t$acceptDocumentAndEditorsDelta(delta: INotebookDocumentsAndEditorsDelta): void;\n\t$undoNotebook(viewType: string, uri: UriComponents, editId: number, isDirty: boolean): Promise<void>;\n\t$redoNotebook(viewType: string, uri: UriComponents, editId: number, isDirty: boolean): Promise<void>;\n\n}\n\nexport interface ExtHostStorageShape {\n\t$acceptValue(shared: boolean, key: string, value: object | undefined): void;\n}\n\nexport interface ExtHostThemingShape {\n\t$onColorThemeChange(themeType: string): void;\n}\n\nexport interface MainThreadThemingShape extends IDisposable {\n}\n\nexport interface ExtHostTunnelServiceShape {\n\t$forwardPort(tunnelOptions: TunnelOptions, tunnelCreationOptions: TunnelCreationOptions): Promise<TunnelDto | undefined>;\n\t$closeTunnel(remote: { host: string, port: number }, silent?: boolean): Promise<void>;\n\t$onDidTunnelsChange(): Promise<void>;\n\t$registerCandidateFinder(enable: boolean): Promise<void>;\n\t$applyCandidateFilter(candidates: CandidatePort[]): Promise<CandidatePort[]>;\n}\n\nexport interface ExtHostTimelineShape {\n\t$getTimeline(source: string, uri: UriComponents, options: TimelineOptions, token: CancellationToken, internalOptions?: InternalTimelineOptions): Promise<Timeline | undefined>;\n}\n\nexport const enum ExtHostTestingResource {\n\tWorkspace,\n\tTextDocument\n}\n\nexport interface ExtHostTestingShape {\n\t$runTestsForProvider(req: RunTestForProviderRequest, token: CancellationToken): Promise<RunTestsResult>;\n\t$subscribeToTests(resource: ExtHostTestingResource, uri: UriComponents): void;\n\t$unsubscribeFromTests(resource: ExtHostTestingResource, uri: UriComponents): void;\n\t$lookupTest(test: TestIdWithProvider): Promise<InternalTestItem | undefined>;\n\t$acceptDiff(resource: ExtHostTestingResource, uri: UriComponents, diff: TestsDiff): void;\n\t$publishTestResults(results: InternalTestResults): void;\n}\n\nexport interface MainThreadTestingShape {\n\t$registerTestProvider(id: string): void;\n\t$unregisterTestProvider(id: string): void;\n\t$subscribeToDiffs(resource: ExtHostTestingResource, uri: UriComponents): void;\n\t$unsubscribeFromDiffs(resource: ExtHostTestingResource, uri: UriComponents): void;\n\t$publishDiff(resource: ExtHostTestingResource, uri: UriComponents, diff: TestsDiff): void;\n\t$runTests(req: RunTestsRequest, token: CancellationToken): Promise<RunTestsResult>;\n}\n\n// --- proxy identifiers\n\nexport const MainContext = {\n\tMainThreadAuthentication: createMainId<MainThreadAuthenticationShape>('MainThreadAuthentication'),\n\tMainThreadBulkEdits: createMainId<MainThreadBulkEditsShape>('MainThreadBulkEdits'),\n\tMainThreadClipboard: createMainId<MainThreadClipboardShape>('MainThreadClipboard'),\n\tMainThreadCommands: createMainId<MainThreadCommandsShape>('MainThreadCommands'),\n\tMainThreadComments: createMainId<MainThreadCommentsShape>('MainThreadComments'),\n\tMainThreadConfiguration: createMainId<MainThreadConfigurationShape>('MainThreadConfiguration'),\n\tMainThreadConsole: createMainId<MainThreadConsoleShape>('MainThreadConsole'),\n\tMainThreadDebugService: createMainId<MainThreadDebugServiceShape>('MainThreadDebugService'),\n\tMainThreadDecorations: createMainId<MainThreadDecorationsShape>('MainThreadDecorations'),\n\tMainThreadDiagnostics: createMainId<MainThreadDiagnosticsShape>('MainThreadDiagnostics'),\n\tMainThreadDialogs: createMainId<MainThreadDiaglogsShape>('MainThreadDiaglogs'),\n\tMainThreadDocuments: createMainId<MainThreadDocumentsShape>('MainThreadDocuments'),\n\tMainThreadDocumentContentProviders: createMainId<MainThreadDocumentContentProvidersShape>('MainThreadDocumentContentProviders'),\n\tMainThreadTextEditors: createMainId<MainThreadTextEditorsShape>('MainThreadTextEditors'),\n\tMainThreadEditorInsets: createMainId<MainThreadEditorInsetsShape>('MainThreadEditorInsets'),\n\tMainThreadEditorTabs: createMainId<MainThreadEditorTabsShape>('MainThreadEditorTabs'),\n\tMainThreadErrors: createMainId<MainThreadErrorsShape>('MainThreadErrors'),\n\tMainThreadTreeViews: createMainId<MainThreadTreeViewsShape>('MainThreadTreeViews'),\n\tMainThreadDownloadService: createMainId<MainThreadDownloadServiceShape>('MainThreadDownloadService'),\n\tMainThreadKeytar: createMainId<MainThreadKeytarShape>('MainThreadKeytar'),\n\tMainThreadLanguageFeatures: createMainId<MainThreadLanguageFeaturesShape>('MainThreadLanguageFeatures'),\n\tMainThreadLanguages: createMainId<MainThreadLanguagesShape>('MainThreadLanguages'),\n\tMainThreadLog: createMainId<MainThreadLogShape>('MainThread'),\n\tMainThreadMessageService: createMainId<MainThreadMessageServiceShape>('MainThreadMessageService'),\n\tMainThreadOutputService: createMainId<MainThreadOutputServiceShape>('MainThreadOutputService'),\n\tMainThreadProgress: createMainId<MainThreadProgressShape>('MainThreadProgress'),\n\tMainThreadQuickOpen: createMainId<MainThreadQuickOpenShape>('MainThreadQuickOpen'),\n\tMainThreadStatusBar: createMainId<MainThreadStatusBarShape>('MainThreadStatusBar'),\n\tMainThreadSecretState: createMainId<MainThreadSecretStateShape>('MainThreadSecretState'),\n\tMainThreadStorage: createMainId<MainThreadStorageShape>('MainThreadStorage'),\n\tMainThreadTelemetry: createMainId<MainThreadTelemetryShape>('MainThreadTelemetry'),\n\tMainThreadTerminalService: createMainId<MainThreadTerminalServiceShape>('MainThreadTerminalService'),\n\tMainThreadWebviews: createMainId<MainThreadWebviewsShape>('MainThreadWebviews'),\n\tMainThreadWebviewPanels: createMainId<MainThreadWebviewPanelsShape>('MainThreadWebviewPanels'),\n\tMainThreadWebviewViews: createMainId<MainThreadWebviewViewsShape>('MainThreadWebviewViews'),\n\tMainThreadCustomEditors: createMainId<MainThreadCustomEditorsShape>('MainThreadCustomEditors'),\n\tMainThreadUrls: createMainId<MainThreadUrlsShape>('MainThreadUrls'),\n\tMainThreadUriOpeners: createMainId<MainThreadUriOpenersShape>('MainThreadUriOpeners'),\n\tMainThreadWorkspace: createMainId<MainThreadWorkspaceShape>('MainThreadWorkspace'),\n\tMainThreadFileSystem: createMainId<MainThreadFileSystemShape>('MainThreadFileSystem'),\n\tMainThreadExtensionService: createMainId<MainThreadExtensionServiceShape>('MainThreadExtensionService'),\n\tMainThreadSCM: createMainId<MainThreadSCMShape>('MainThreadSCM'),\n\tMainThreadSearch: createMainId<MainThreadSearchShape>('MainThreadSearch'),\n\tMainThreadTask: createMainId<MainThreadTaskShape>('MainThreadTask'),\n\tMainThreadWindow: createMainId<MainThreadWindowShape>('MainThreadWindow'),\n\tMainThreadLabelService: createMainId<MainThreadLabelServiceShape>('MainThreadLabelService'),\n\tMainThreadNotebook: createMainId<MainThreadNotebookShape>('MainThreadNotebook'),\n\tMainThreadTheming: createMainId<MainThreadThemingShape>('MainThreadTheming'),\n\tMainThreadTunnelService: createMainId<MainThreadTunnelServiceShape>('MainThreadTunnelService'),\n\tMainThreadTimeline: createMainId<MainThreadTimelineShape>('MainThreadTimeline'),\n\tMainThreadTesting: createMainId<MainThreadTestingShape>('MainThreadTesting'),\n};\n\nexport const ExtHostContext = {\n\tExtHostCommands: createExtId<ExtHostCommandsShape>('ExtHostCommands'),\n\tExtHostConfiguration: createExtId<ExtHostConfigurationShape>('ExtHostConfiguration'),\n\tExtHostDiagnostics: createExtId<ExtHostDiagnosticsShape>('ExtHostDiagnostics'),\n\tExtHostDebugService: createExtId<ExtHostDebugServiceShape>('ExtHostDebugService'),\n\tExtHostDecorations: createExtId<ExtHostDecorationsShape>('ExtHostDecorations'),\n\tExtHostDocumentsAndEditors: createExtId<ExtHostDocumentsAndEditorsShape>('ExtHostDocumentsAndEditors'),\n\tExtHostDocuments: createExtId<ExtHostDocumentsShape>('ExtHostDocuments'),\n\tExtHostDocumentContentProviders: createExtId<ExtHostDocumentContentProvidersShape>('ExtHostDocumentContentProviders'),\n\tExtHostDocumentSaveParticipant: createExtId<ExtHostDocumentSaveParticipantShape>('ExtHostDocumentSaveParticipant'),\n\tExtHostEditors: createExtId<ExtHostEditorsShape>('ExtHostEditors'),\n\tExtHostTreeViews: createExtId<ExtHostTreeViewsShape>('ExtHostTreeViews'),\n\tExtHostFileSystem: createExtId<ExtHostFileSystemShape>('ExtHostFileSystem'),\n\tExtHostFileSystemInfo: createExtId<ExtHostFileSystemInfoShape>('ExtHostFileSystemInfo'),\n\tExtHostFileSystemEventService: createExtId<ExtHostFileSystemEventServiceShape>('ExtHostFileSystemEventService'),\n\tExtHostLanguageFeatures: createExtId<ExtHostLanguageFeaturesShape>('ExtHostLanguageFeatures'),\n\tExtHostQuickOpen: createExtId<ExtHostQuickOpenShape>('ExtHostQuickOpen'),\n\tExtHostExtensionService: createExtId<ExtHostExtensionServiceShape>('ExtHostExtensionService'),\n\tExtHostLogService: createExtId<ExtHostLogServiceShape>('ExtHostLogService'),\n\tExtHostTerminalService: createExtId<ExtHostTerminalServiceShape>('ExtHostTerminalService'),\n\tExtHostSCM: createExtId<ExtHostSCMShape>('ExtHostSCM'),\n\tExtHostSearch: createExtId<ExtHostSearchShape>('ExtHostSearch'),\n\tExtHostTask: createExtId<ExtHostTaskShape>('ExtHostTask'),\n\tExtHostWorkspace: createExtId<ExtHostWorkspaceShape>('ExtHostWorkspace'),\n\tExtHostWindow: createExtId<ExtHostWindowShape>('ExtHostWindow'),\n\tExtHostWebviews: createExtId<ExtHostWebviewsShape>('ExtHostWebviews'),\n\tExtHostWebviewPanels: createExtId<ExtHostWebviewPanelsShape>('ExtHostWebviewPanels'),\n\tExtHostCustomEditors: createExtId<ExtHostCustomEditorsShape>('ExtHostCustomEditors'),\n\tExtHostWebviewViews: createExtId<ExtHostWebviewViewsShape>('ExtHostWebviewViews'),\n\tExtHostEditorInsets: createExtId<ExtHostEditorInsetsShape>('ExtHostEditorInsets'),\n\tExtHostEditorTabs: createExtId<IExtHostEditorTabsShape>('ExtHostEditorTabs'),\n\tExtHostProgress: createMainId<ExtHostProgressShape>('ExtHostProgress'),\n\tExtHostComments: createMainId<ExtHostCommentsShape>('ExtHostComments'),\n\tExtHostSecretState: createMainId<ExtHostSecretStateShape>('ExtHostSecretState'),\n\tExtHostStorage: createMainId<ExtHostStorageShape>('ExtHostStorage'),\n\tExtHostUrls: createExtId<ExtHostUrlsShape>('ExtHostUrls'),\n\tExtHostUriOpeners: createExtId<ExtHostUriOpenersShape>('ExtHostUriOpeners'),\n\tExtHostOutputService: createMainId<ExtHostOutputServiceShape>('ExtHostOutputService'),\n\tExtHosLabelService: createMainId<ExtHostLabelServiceShape>('ExtHostLabelService'),\n\tExtHostNotebook: createMainId<ExtHostNotebookShape>('ExtHostNotebook'),\n\tExtHostTheming: createMainId<ExtHostThemingShape>('ExtHostTheming'),\n\tExtHostTunnelService: createMainId<ExtHostTunnelServiceShape>('ExtHostTunnelService'),\n\tExtHostAuthentication: createMainId<ExtHostAuthenticationShape>('ExtHostAuthentication'),\n\tExtHostTimeline: createMainId<ExtHostTimelineShape>('ExtHostTimeline'),\n\tExtHostTesting: createMainId<ExtHostTestingShape>('ExtHostTesting'),\n};\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ExtHostSecretStateShape, MainContext, MainThreadSecretStateShape } from 'vs/workbench/api/common/extHost.protocol';\nimport { Emitter } from 'vs/base/common/event';\nimport { IExtHostRpcService } from 'vs/workbench/api/common/extHostRpcService';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\n\nexport class ExtHostSecretState implements ExtHostSecretStateShape {\n\tprivate _proxy: MainThreadSecretStateShape;\n\tprivate _onDidChangePassword = new Emitter<{ extensionId: string, key: string }>();\n\treadonly onDidChangePassword = this._onDidChangePassword.event;\n\n\tconstructor(mainContext: IExtHostRpcService) {\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadSecretState);\n\t}\n\n\tasync $onDidChangePassword(e: { extensionId: string, key: string }): Promise<void> {\n\t\tthis._onDidChangePassword.fire(e);\n\t}\n\n\tget(extensionId: string, key: string): Promise<string | undefined> {\n\t\treturn this._proxy.$getPassword(extensionId, key);\n\t}\n\n\tstore(extensionId: string, key: string, value: string): Promise<void> {\n\t\treturn this._proxy.$setPassword(extensionId, key, value);\n\t}\n\n\tdelete(extensionId: string, key: string): Promise<void> {\n\t\treturn this._proxy.$deletePassword(extensionId, key);\n\t}\n}\n\nexport interface IExtHostSecretState extends ExtHostSecretState { }\nexport const IExtHostSecretState = createDecorator<IExtHostSecretState>('IExtHostSecretState');\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport * as extHostProtocol from 'vs/workbench/api/common/extHost.protocol';\nimport { IExtHostRpcService } from 'vs/workbench/api/common/extHostRpcService';\n\nexport interface IExtHostApiDeprecationService {\n\treadonly _serviceBrand: undefined;\n\n\treport(apiId: string, extension: IExtensionDescription, migrationSuggestion: string): void;\n}\n\nexport const IExtHostApiDeprecationService = createDecorator<IExtHostApiDeprecationService>('IExtHostApiDeprecationService');\n\nexport class ExtHostApiDeprecationService implements IExtHostApiDeprecationService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _reportedUsages = new Set<string>();\n\tprivate readonly _telemetryShape: extHostProtocol.MainThreadTelemetryShape;\n\n\tconstructor(\n\t\t@IExtHostRpcService rpc: IExtHostRpcService,\n\t\t@ILogService private readonly _extHostLogService: ILogService,\n\t) {\n\t\tthis._telemetryShape = rpc.getProxy(extHostProtocol.MainContext.MainThreadTelemetry);\n\t}\n\n\tpublic report(apiId: string, extension: IExtensionDescription, migrationSuggestion: string): void {\n\t\tconst key = this.getUsageKey(apiId, extension);\n\t\tif (this._reportedUsages.has(key)) {\n\t\t\treturn;\n\t\t}\n\t\tthis._reportedUsages.add(key);\n\n\t\tif (extension.isUnderDevelopment) {\n\t\t\tthis._extHostLogService.warn(`[Deprecation Warning] '${apiId}' is deprecated. ${migrationSuggestion}`);\n\t\t}\n\n\t\ttype DeprecationTelemetry = {\n\t\t\textensionId: string;\n\t\t\tapiId: string;\n\t\t};\n\t\ttype DeprecationTelemetryMeta = {\n\t\t\textensionId: { classification: 'SystemMetaData', purpose: 'PerformanceAndHealth' };\n\t\t\tapiId: { classification: 'SystemMetaData', purpose: 'PerformanceAndHealth' };\n\t\t};\n\t\tthis._telemetryShape.$publicLog2<DeprecationTelemetry, DeprecationTelemetryMeta>('extHostDeprecatedApiUsage', {\n\t\t\textensionId: extension.identifier.value,\n\t\t\tapiId: apiId,\n\t\t});\n\t}\n\n\tprivate getUsageKey(apiId: string, extension: IExtensionDescription): string {\n\t\treturn `${apiId}-${extension.identifier.value}`;\n\t}\n}\n\n\nexport const NullApiDeprecationService = Object.freeze(new class implements IExtHostApiDeprecationService {\n\tdeclare readonly _serviceBrand: undefined;\n\n\tpublic report(_apiId: string, _extension: IExtensionDescription, _warningMessage: string): void {\n\t\t// noop\n\t}\n}());\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type * as vscode from 'vscode';\nimport * as modes from 'vs/editor/common/modes';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { IMainContext, MainContext, MainThreadAuthenticationShape, ExtHostAuthenticationShape } from 'vs/workbench/api/common/extHost.protocol';\nimport { Disposable } from 'vs/workbench/api/common/extHostTypes';\nimport { IExtensionDescription, ExtensionIdentifier } from 'vs/platform/extensions/common/extensions';\n\ninterface GetSessionsRequest {\n\tscopes: string;\n\tresult: Promise<vscode.AuthenticationSession | undefined>;\n}\n\ninterface ProviderWithMetadata {\n\tlabel: string;\n\tprovider: vscode.AuthenticationProvider;\n\toptions: vscode.AuthenticationProviderOptions;\n}\n\nexport class ExtHostAuthentication implements ExtHostAuthenticationShape {\n\tprivate _proxy: MainThreadAuthenticationShape;\n\tprivate _authenticationProviders: Map<string, ProviderWithMetadata> = new Map<string, ProviderWithMetadata>();\n\n\tprivate _providers: vscode.AuthenticationProviderInformation[] = [];\n\n\tprivate _onDidChangeAuthenticationProviders = new Emitter<vscode.AuthenticationProvidersChangeEvent>();\n\treadonly onDidChangeAuthenticationProviders: Event<vscode.AuthenticationProvidersChangeEvent> = this._onDidChangeAuthenticationProviders.event;\n\n\tprivate _onDidChangeSessions = new Emitter<vscode.AuthenticationSessionsChangeEvent>();\n\treadonly onDidChangeSessions: Event<vscode.AuthenticationSessionsChangeEvent> = this._onDidChangeSessions.event;\n\n\tprivate _inFlightRequests = new Map<string, GetSessionsRequest[]>();\n\n\tconstructor(mainContext: IMainContext) {\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadAuthentication);\n\t}\n\n\t$setProviders(providers: vscode.AuthenticationProviderInformation[]): Promise<void> {\n\t\tthis._providers = providers;\n\t\treturn Promise.resolve();\n\t}\n\n\tget providers(): ReadonlyArray<vscode.AuthenticationProviderInformation> {\n\t\treturn Object.freeze(this._providers.slice());\n\t}\n\n\tasync getSession(requestingExtension: IExtensionDescription, providerId: string, scopes: string[], options: vscode.AuthenticationGetSessionOptions & { createIfNone: true }): Promise<vscode.AuthenticationSession>;\n\tasync getSession(requestingExtension: IExtensionDescription, providerId: string, scopes: string[], options: vscode.AuthenticationGetSessionOptions = {}): Promise<vscode.AuthenticationSession | undefined> {\n\t\tconst extensionId = ExtensionIdentifier.toKey(requestingExtension.identifier);\n\t\tconst inFlightRequests = this._inFlightRequests.get(extensionId) || [];\n\t\tconst sortedScopes = scopes.sort().join(' ');\n\t\tlet inFlightRequest: GetSessionsRequest | undefined = inFlightRequests.find(request => request.scopes === sortedScopes);\n\n\t\tif (inFlightRequest) {\n\t\t\treturn inFlightRequest.result;\n\t\t} else {\n\t\t\tconst session = this._getSession(requestingExtension, extensionId, providerId, scopes, options);\n\t\t\tinFlightRequest = {\n\t\t\t\tscopes: sortedScopes,\n\t\t\t\tresult: session\n\t\t\t};\n\n\t\t\tinFlightRequests.push(inFlightRequest);\n\t\t\tthis._inFlightRequests.set(extensionId, inFlightRequests);\n\n\t\t\ttry {\n\t\t\t\tawait session;\n\t\t\t} finally {\n\t\t\t\tconst requestIndex = inFlightRequests.findIndex(request => request.scopes === sortedScopes);\n\t\t\t\tif (requestIndex > -1) {\n\t\t\t\t\tinFlightRequests.splice(requestIndex);\n\t\t\t\t\tthis._inFlightRequests.set(extensionId, inFlightRequests);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn session;\n\t\t}\n\t}\n\n\tprivate async _getSession(requestingExtension: IExtensionDescription, extensionId: string, providerId: string, scopes: string[], options: vscode.AuthenticationGetSessionOptions = {}): Promise<vscode.AuthenticationSession | undefined> {\n\t\tawait this._proxy.$ensureProvider(providerId);\n\t\tconst providerData = this._authenticationProviders.get(providerId);\n\t\tconst extensionName = requestingExtension.displayName || requestingExtension.name;\n\n\t\tif (!providerData) {\n\t\t\treturn this._proxy.$getSession(providerId, scopes, extensionId, extensionName, options);\n\t\t}\n\n\t\tconst orderedScopes = scopes.sort().join(' ');\n\t\tconst sessions = (await providerData.provider.getSessions()).filter(session => session.scopes.slice().sort().join(' ') === orderedScopes);\n\n\t\tlet session: vscode.AuthenticationSession | undefined = undefined;\n\t\tif (sessions.length) {\n\t\t\tif (!providerData.options.supportsMultipleAccounts) {\n\t\t\t\tsession = sessions[0];\n\t\t\t\tconst allowed = await this._proxy.$getSessionsPrompt(providerId, session.account.label, providerData.label, extensionId, extensionName);\n\t\t\t\tif (!allowed) {\n\t\t\t\t\tthrow new Error('User did not consent to login.');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// On renderer side, confirm consent, ask user to choose between accounts if multiple sessions are valid\n\t\t\t\tconst selected = await this._proxy.$selectSession(providerId, providerData.label, extensionId, extensionName, sessions, scopes, !!options.clearSessionPreference);\n\t\t\t\tsession = sessions.find(session => session.id === selected.id);\n\t\t\t}\n\n\t\t} else {\n\t\t\tif (options.createIfNone) {\n\t\t\t\tconst isAllowed = await this._proxy.$loginPrompt(providerData.label, extensionName);\n\t\t\t\tif (!isAllowed) {\n\t\t\t\t\tthrow new Error('User did not consent to login.');\n\t\t\t\t}\n\n\t\t\t\tsession = await providerData.provider.login(scopes);\n\t\t\t\tawait this._proxy.$setTrustedExtensionAndAccountPreference(providerId, session.account.label, extensionId, extensionName, session.id);\n\t\t\t} else {\n\t\t\t\tawait this._proxy.$requestNewSession(providerId, scopes, extensionId, extensionName);\n\t\t\t}\n\t\t}\n\n\t\treturn session;\n\t}\n\n\tasync logout(providerId: string, sessionId: string): Promise<void> {\n\t\tconst providerData = this._authenticationProviders.get(providerId);\n\t\tif (!providerData) {\n\t\t\treturn this._proxy.$logout(providerId, sessionId);\n\t\t}\n\n\t\treturn providerData.provider.logout(sessionId);\n\t}\n\n\tregisterAuthenticationProvider(id: string, label: string, provider: vscode.AuthenticationProvider, options?: vscode.AuthenticationProviderOptions): vscode.Disposable {\n\t\tif (this._authenticationProviders.get(id)) {\n\t\t\tthrow new Error(`An authentication provider with id '${id}' is already registered.`);\n\t\t}\n\n\t\tthis._authenticationProviders.set(id, { label, provider, options: options ?? { supportsMultipleAccounts: false } });\n\n\t\tif (!this._providers.find(p => p.id === id)) {\n\t\t\tthis._providers.push({\n\t\t\t\tid: id,\n\t\t\t\tlabel: label\n\t\t\t});\n\t\t}\n\n\t\tconst listener = provider.onDidChangeSessions(e => {\n\t\t\tthis._proxy.$sendDidChangeSessions(id, e);\n\t\t});\n\n\t\tthis._proxy.$registerAuthenticationProvider(id, label, options?.supportsMultipleAccounts ?? false);\n\n\t\treturn new Disposable(() => {\n\t\t\tlistener.dispose();\n\t\t\tthis._authenticationProviders.delete(id);\n\n\t\t\tconst i = this._providers.findIndex(p => p.id === id);\n\t\t\tif (i > -1) {\n\t\t\t\tthis._providers.splice(i);\n\t\t\t}\n\n\t\t\tthis._proxy.$unregisterAuthenticationProvider(id);\n\t\t});\n\t}\n\n\t$login(providerId: string, scopes: string[]): Promise<modes.AuthenticationSession> {\n\t\tconst providerData = this._authenticationProviders.get(providerId);\n\t\tif (providerData) {\n\t\t\treturn Promise.resolve(providerData.provider.login(scopes));\n\t\t}\n\n\t\tthrow new Error(`Unable to find authentication provider with handle: ${providerId}`);\n\t}\n\n\t$logout(providerId: string, sessionId: string): Promise<void> {\n\t\tconst providerData = this._authenticationProviders.get(providerId);\n\t\tif (providerData) {\n\t\t\treturn Promise.resolve(providerData.provider.logout(sessionId));\n\t\t}\n\n\t\tthrow new Error(`Unable to find authentication provider with handle: ${providerId}`);\n\t}\n\n\t$getSessions(providerId: string): Promise<ReadonlyArray<modes.AuthenticationSession>> {\n\t\tconst providerData = this._authenticationProviders.get(providerId);\n\t\tif (providerData) {\n\t\t\treturn Promise.resolve(providerData.provider.getSessions());\n\t\t}\n\n\t\tthrow new Error(`Unable to find authentication provider with handle: ${providerId}`);\n\t}\n\n\tasync $getSessionAccessToken(providerId: string, sessionId: string): Promise<string> {\n\t\tconst providerData = this._authenticationProviders.get(providerId);\n\t\tif (providerData) {\n\t\t\tconst sessions = await providerData.provider.getSessions();\n\t\t\tconst session = sessions.find(session => session.id === sessionId);\n\t\t\tif (session) {\n\t\t\t\treturn session.accessToken;\n\t\t\t}\n\n\t\t\tthrow new Error(`Unable to find session with id: ${sessionId}`);\n\t\t}\n\n\t\tthrow new Error(`Unable to find authentication provider with handle: ${providerId}`);\n\t}\n\n\t$onDidChangeAuthenticationSessions(id: string, label: string, event: modes.AuthenticationSessionsChangeEvent) {\n\t\tthis._onDidChangeSessions.fire({ provider: { id, label }, ...event });\n\t\treturn Promise.resolve();\n\t}\n\n\t$onDidChangeAuthenticationProviders(added: modes.AuthenticationProviderInformation[], removed: modes.AuthenticationProviderInformation[]) {\n\t\tadded.forEach(provider => {\n\t\t\tif (!this._providers.some(p => p.id === provider.id)) {\n\t\t\t\tthis._providers.push(provider);\n\t\t\t}\n\t\t});\n\n\t\tremoved.forEach(p => {\n\t\t\tconst index = this._providers.findIndex(provider => provider.id === p.id);\n\t\t\tif (index > -1) {\n\t\t\t\tthis._providers.splice(index);\n\t\t\t}\n\t\t});\n\n\t\tthis._onDidChangeAuthenticationProviders.fire({ added, removed });\n\t\treturn Promise.resolve();\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { MainContext, MainThreadBulkEditsShape } from 'vs/workbench/api/common/extHost.protocol';\nimport { ExtHostDocumentsAndEditors } from 'vs/workbench/api/common/extHostDocumentsAndEditors';\nimport { ExtHostNotebookController } from 'vs/workbench/api/common/extHostNotebook';\nimport { IExtHostRpcService } from 'vs/workbench/api/common/extHostRpcService';\nimport { WorkspaceEdit } from 'vs/workbench/api/common/extHostTypeConverters';\nimport type * as vscode from 'vscode';\n\nexport class ExtHostBulkEdits {\n\n\tprivate readonly _proxy: MainThreadBulkEditsShape;\n\n\tconstructor(\n\t\t@IExtHostRpcService extHostRpc: IExtHostRpcService,\n\t\tprivate readonly _extHostDocumentsAndEditors: ExtHostDocumentsAndEditors,\n\t\tprivate readonly _extHostNotebooks: ExtHostNotebookController,\n\t) {\n\t\tthis._proxy = extHostRpc.getProxy(MainContext.MainThreadBulkEdits);\n\t}\n\n\tapplyWorkspaceEdit(edit: vscode.WorkspaceEdit): Promise<boolean> {\n\t\tconst dto = WorkspaceEdit.from(edit, this._extHostDocumentsAndEditors, this._extHostNotebooks);\n\t\treturn this._proxy.$tryApplyWorkspaceEdit(dto);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IMainContext, MainContext, MainThreadClipboardShape } from 'vs/workbench/api/common/extHost.protocol';\nimport type * as vscode from 'vscode';\n\nexport class ExtHostClipboard implements vscode.Clipboard {\n\n\tprivate readonly _proxy: MainThreadClipboardShape;\n\n\tconstructor(mainContext: IMainContext) {\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadClipboard);\n\t}\n\n\treadText(): Promise<string> {\n\t\treturn this._proxy.$readText();\n\t}\n\n\twriteText(value: string): Promise<void> {\n\t\treturn this._proxy.$writeText(value);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { validateConstraint } from 'vs/base/common/types';\nimport { ICommandHandlerDescription } from 'vs/platform/commands/common/commands';\nimport * as extHostTypes from 'vs/workbench/api/common/extHostTypes';\nimport * as extHostTypeConverter from 'vs/workbench/api/common/extHostTypeConverters';\nimport { cloneAndChange } from 'vs/base/common/objects';\nimport { MainContext, MainThreadCommandsShape, ExtHostCommandsShape, ObjectIdentifier, ICommandDto } from './extHost.protocol';\nimport { isNonEmptyArray } from 'vs/base/common/arrays';\nimport * as modes from 'vs/editor/common/modes';\nimport type * as vscode from 'vscode';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { revive } from 'vs/base/common/marshalling';\nimport { IRange, Range } from 'vs/editor/common/core/range';\nimport { IPosition, Position } from 'vs/editor/common/core/position';\nimport { URI } from 'vs/base/common/uri';\nimport { DisposableStore, toDisposable } from 'vs/base/common/lifecycle';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { IExtHostRpcService } from 'vs/workbench/api/common/extHostRpcService';\nimport { ISelection } from 'vs/editor/common/core/selection';\n\ninterface CommandHandler {\n\tcallback: Function;\n\tthisArg: any;\n\tdescription?: ICommandHandlerDescription;\n}\n\nexport interface ArgumentProcessor {\n\tprocessArgument(arg: any): any;\n}\n\nexport class ExtHostCommands implements ExtHostCommandsShape {\n\n\treadonly _serviceBrand: undefined;\n\n\tprivate readonly _commands = new Map<string, CommandHandler>();\n\tprivate readonly _apiCommands = new Map<string, ApiCommand>();\n\n\tprivate readonly _proxy: MainThreadCommandsShape;\n\tprivate readonly _logService: ILogService;\n\tprivate readonly _argumentProcessors: ArgumentProcessor[];\n\n\treadonly converter: CommandsConverter;\n\n\tconstructor(\n\t\t@IExtHostRpcService extHostRpc: IExtHostRpcService,\n\t\t@ILogService logService: ILogService\n\t) {\n\t\tthis._proxy = extHostRpc.getProxy(MainContext.MainThreadCommands);\n\t\tthis._logService = logService;\n\t\tthis.converter = new CommandsConverter(\n\t\t\tthis,\n\t\t\tid => {\n\t\t\t\t// API commands that have no return type (void) can be\n\t\t\t\t// converted to their internal command and don't need\n\t\t\t\t// any indirection commands\n\t\t\t\tconst candidate = this._apiCommands.get(id);\n\t\t\t\treturn candidate?.result === ApiCommandResult.Void\n\t\t\t\t\t? candidate : undefined;\n\t\t\t},\n\t\t\tlogService\n\t\t);\n\t\tthis._argumentProcessors = [\n\t\t\t{\n\t\t\t\tprocessArgument(a) {\n\t\t\t\t\t// URI, Regex\n\t\t\t\t\treturn revive(a);\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tprocessArgument(arg) {\n\t\t\t\t\treturn cloneAndChange(arg, function (obj) {\n\t\t\t\t\t\t// Reverse of https://github.com/microsoft/vscode/blob/1f28c5fc681f4c01226460b6d1c7e91b8acb4a5b/src/vs/workbench/api/node/extHostCommands.ts#L112-L127\n\t\t\t\t\t\tif (Range.isIRange(obj)) {\n\t\t\t\t\t\t\treturn extHostTypeConverter.Range.to(obj);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (Position.isIPosition(obj)) {\n\t\t\t\t\t\t\treturn extHostTypeConverter.Position.to(obj);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (Range.isIRange((obj as modes.Location).range) && URI.isUri((obj as modes.Location).uri)) {\n\t\t\t\t\t\t\treturn extHostTypeConverter.location.to(obj);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!Array.isArray(obj)) {\n\t\t\t\t\t\t\treturn obj;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t}\n\n\tregisterArgumentProcessor(processor: ArgumentProcessor): void {\n\t\tthis._argumentProcessors.push(processor);\n\t}\n\n\tregisterApiCommand(apiCommand: ApiCommand): extHostTypes.Disposable {\n\n\n\t\tconst registration = this.registerCommand(false, apiCommand.id, async (...apiArgs) => {\n\n\t\t\tconst internalArgs = apiCommand.args.map((arg, i) => {\n\t\t\t\tif (!arg.validate(apiArgs[i])) {\n\t\t\t\t\tthrow new Error(`Invalid argument '${arg.name}' when running '${apiCommand.id}', received: ${apiArgs[i]}`);\n\t\t\t\t}\n\t\t\t\treturn arg.convert(apiArgs[i]);\n\t\t\t});\n\n\t\t\tconst internalResult = await this.executeCommand(apiCommand.internalId, ...internalArgs);\n\t\t\treturn apiCommand.result.convert(internalResult, apiArgs, this.converter);\n\t\t}, undefined, {\n\t\t\tdescription: apiCommand.description,\n\t\t\targs: apiCommand.args,\n\t\t\treturns: apiCommand.result.description\n\t\t});\n\n\t\tthis._apiCommands.set(apiCommand.id, apiCommand);\n\n\t\treturn new extHostTypes.Disposable(() => {\n\t\t\tregistration.dispose();\n\t\t\tthis._apiCommands.delete(apiCommand.id);\n\t\t});\n\t}\n\n\tregisterCommand(global: boolean, id: string, callback: <T>(...args: any[]) => T | Thenable<T>, thisArg?: any, description?: ICommandHandlerDescription): extHostTypes.Disposable {\n\t\tthis._logService.trace('ExtHostCommands#registerCommand', id);\n\n\t\tif (!id.trim().length) {\n\t\t\tthrow new Error('invalid id');\n\t\t}\n\n\t\tif (this._commands.has(id)) {\n\t\t\tthrow new Error(`command '${id}' already exists`);\n\t\t}\n\n\t\tthis._commands.set(id, { callback, thisArg, description });\n\t\tif (global) {\n\t\t\tthis._proxy.$registerCommand(id);\n\t\t}\n\n\t\treturn new extHostTypes.Disposable(() => {\n\t\t\tif (this._commands.delete(id)) {\n\t\t\t\tif (global) {\n\t\t\t\t\tthis._proxy.$unregisterCommand(id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\texecuteCommand<T>(id: string, ...args: any[]): Promise<T> {\n\t\tthis._logService.trace('ExtHostCommands#executeCommand', id);\n\t\treturn this._doExecuteCommand(id, args, true);\n\t}\n\n\tprivate async _doExecuteCommand<T>(id: string, args: any[], retry: boolean): Promise<T> {\n\n\t\tif (this._commands.has(id)) {\n\t\t\t// we stay inside the extension host and support\n\t\t\t// to pass any kind of parameters around\n\t\t\treturn this._executeContributedCommand<T>(id, args);\n\n\t\t} else {\n\t\t\t// automagically convert some argument types\n\t\t\tconst toArgs = cloneAndChange(args, function (value) {\n\t\t\t\tif (value instanceof extHostTypes.Position) {\n\t\t\t\t\treturn extHostTypeConverter.Position.from(value);\n\t\t\t\t}\n\t\t\t\tif (value instanceof extHostTypes.Range) {\n\t\t\t\t\treturn extHostTypeConverter.Range.from(value);\n\t\t\t\t}\n\t\t\t\tif (value instanceof extHostTypes.Location) {\n\t\t\t\t\treturn extHostTypeConverter.location.from(value);\n\t\t\t\t}\n\t\t\t\tif (!Array.isArray(value)) {\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\ttry {\n\t\t\t\tconst result = await this._proxy.$executeCommand<T>(id, toArgs, retry);\n\t\t\t\treturn revive<any>(result);\n\t\t\t} catch (e) {\n\t\t\t\t// Rerun the command when it wasn't known, had arguments, and when retry\n\t\t\t\t// is enabled. We do this because the command might be registered inside\n\t\t\t\t// the extension host now and can therfore accept the arguments as-is.\n\t\t\t\tif (e instanceof Error && e.message === '$executeCommand:retry') {\n\t\t\t\t\treturn this._doExecuteCommand(id, args, false);\n\t\t\t\t} else {\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async _executeContributedCommand<T>(id: string, args: any[]): Promise<T> {\n\t\tconst command = this._commands.get(id);\n\t\tif (!command) {\n\t\t\tthrow new Error('Unknown command');\n\t\t}\n\t\tlet { callback, thisArg, description } = command;\n\t\tif (description) {\n\t\t\tfor (let i = 0; i < description.args.length; i++) {\n\t\t\t\ttry {\n\t\t\t\t\tvalidateConstraint(args[i], description.args[i].constraint);\n\t\t\t\t} catch (err) {\n\t\t\t\t\tthrow new Error(`Running the contributed command: '${id}' failed. Illegal argument '${description.args[i].name}' - ${description.args[i].description}`);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\treturn await callback.apply(thisArg, args);\n\t\t} catch (err) {\n\t\t\tthis._logService.error(err, id);\n\t\t\tthrow new Error(`Running the contributed command: '${id}' failed.`);\n\t\t}\n\t}\n\n\t$executeContributedCommand<T>(id: string, ...args: any[]): Promise<T> {\n\t\tthis._logService.trace('ExtHostCommands#$executeContributedCommand', id);\n\n\t\tif (!this._commands.has(id)) {\n\t\t\treturn Promise.reject(new Error(`Contributed command '${id}' does not exist.`));\n\t\t} else {\n\t\t\targs = args.map(arg => this._argumentProcessors.reduce((r, p) => p.processArgument(r), arg));\n\t\t\treturn this._executeContributedCommand(id, args);\n\t\t}\n\t}\n\n\tgetCommands(filterUnderscoreCommands: boolean = false): Promise<string[]> {\n\t\tthis._logService.trace('ExtHostCommands#getCommands', filterUnderscoreCommands);\n\n\t\treturn this._proxy.$getCommands().then(result => {\n\t\t\tif (filterUnderscoreCommands) {\n\t\t\t\tresult = result.filter(command => command[0] !== '_');\n\t\t\t}\n\t\t\treturn result;\n\t\t});\n\t}\n\n\t$getContributedCommandHandlerDescriptions(): Promise<{ [id: string]: string | ICommandHandlerDescription }> {\n\t\tconst result: { [id: string]: string | ICommandHandlerDescription } = Object.create(null);\n\t\tfor (let [id, command] of this._commands) {\n\t\t\tlet { description } = command;\n\t\t\tif (description) {\n\t\t\t\tresult[id] = description;\n\t\t\t}\n\t\t}\n\t\treturn Promise.resolve(result);\n\t}\n}\n\nexport interface IExtHostCommands extends ExtHostCommands { }\nexport const IExtHostCommands = createDecorator<IExtHostCommands>('IExtHostCommands');\n\nexport class CommandsConverter {\n\n\tprivate readonly _delegatingCommandId: string;\n\tprivate readonly _cache = new Map<number, vscode.Command>();\n\tprivate _cachIdPool = 0;\n\n\t// --- conversion between internal and api commands\n\tconstructor(\n\t\tprivate readonly _commands: ExtHostCommands,\n\t\tprivate readonly _lookupApiCommand: (id: string) => ApiCommand | undefined,\n\t\tprivate readonly _logService: ILogService\n\t) {\n\t\tthis._delegatingCommandId = `_vscode_delegate_cmd_${Date.now().toString(36)}`;\n\t\tthis._commands.registerCommand(true, this._delegatingCommandId, this._executeConvertedCommand, this);\n\t}\n\n\ttoInternal(command: vscode.Command, disposables: DisposableStore): ICommandDto;\n\ttoInternal(command: vscode.Command | undefined, disposables: DisposableStore): ICommandDto | undefined;\n\ttoInternal(command: vscode.Command | undefined, disposables: DisposableStore): ICommandDto | undefined {\n\n\t\tif (!command) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst result: ICommandDto = {\n\t\t\t$ident: undefined,\n\t\t\tid: command.command,\n\t\t\ttitle: command.title,\n\t\t\ttooltip: command.tooltip\n\t\t};\n\n\t\tif (!command.command) {\n\t\t\t// falsy command id -> return converted command but don't attempt any\n\t\t\t// argument or API-command dance since this command won't run anyways\n\t\t\treturn result;\n\t\t}\n\n\t\tconst apiCommand = this._lookupApiCommand(command.command);\n\t\tif (apiCommand) {\n\t\t\t// API command with return-value can be converted inplace\n\t\t\tresult.id = apiCommand.internalId;\n\t\t\tresult.arguments = apiCommand.args.map((arg, i) => arg.convert(command.arguments && command.arguments[i]));\n\n\n\t\t} else if (isNonEmptyArray(command.arguments)) {\n\t\t\t// we have a contributed command with arguments. that\n\t\t\t// means we don't want to send the arguments around\n\n\t\t\tconst id = ++this._cachIdPool;\n\t\t\tthis._cache.set(id, command);\n\t\t\tdisposables.add(toDisposable(() => {\n\t\t\t\tthis._cache.delete(id);\n\t\t\t\tthis._logService.trace('CommandsConverter#DISPOSE', id);\n\t\t\t}));\n\t\t\tresult.$ident = id;\n\n\t\t\tresult.id = this._delegatingCommandId;\n\t\t\tresult.arguments = [id];\n\n\t\t\tthis._logService.trace('CommandsConverter#CREATE', command.command, id);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tfromInternal(command: modes.Command): vscode.Command | undefined {\n\n\t\tconst id = ObjectIdentifier.of(command);\n\t\tif (typeof id === 'number') {\n\t\t\treturn this._cache.get(id);\n\n\t\t} else {\n\t\t\treturn {\n\t\t\t\tcommand: command.id,\n\t\t\t\ttitle: command.title,\n\t\t\t\targuments: command.arguments\n\t\t\t};\n\t\t}\n\t}\n\n\tprivate _executeConvertedCommand<R>(...args: any[]): Promise<R> {\n\t\tconst actualCmd = this._cache.get(args[0]);\n\t\tthis._logService.trace('CommandsConverter#EXECUTE', args[0], actualCmd ? actualCmd.command : 'MISSING');\n\n\t\tif (!actualCmd) {\n\t\t\treturn Promise.reject('actual command NOT FOUND');\n\t\t}\n\t\treturn this._commands.executeCommand(actualCmd.command, ...(actualCmd.arguments || []));\n\t}\n\n}\n\n\nexport class ApiCommandArgument<V, O = V> {\n\n\tstatic readonly Uri = new ApiCommandArgument<URI>('uri', 'Uri of a text document', v => URI.isUri(v), v => v);\n\tstatic readonly Position = new ApiCommandArgument<extHostTypes.Position, IPosition>('position', 'A position in a text document', v => extHostTypes.Position.isPosition(v), extHostTypeConverter.Position.from);\n\tstatic readonly Range = new ApiCommandArgument<extHostTypes.Range, IRange>('range', 'A range in a text document', v => extHostTypes.Range.isRange(v), extHostTypeConverter.Range.from);\n\tstatic readonly Selection = new ApiCommandArgument<extHostTypes.Selection, ISelection>('selection', 'A selection in a text document', v => extHostTypes.Selection.isSelection(v), extHostTypeConverter.Selection.from);\n\tstatic readonly Number = new ApiCommandArgument<number>('number', '', v => typeof v === 'number', v => v);\n\tstatic readonly String = new ApiCommandArgument<string>('string', '', v => typeof v === 'string', v => v);\n\n\tstatic readonly CallHierarchyItem = new ApiCommandArgument('item', 'A call hierarchy item', v => v instanceof extHostTypes.CallHierarchyItem, extHostTypeConverter.CallHierarchyItem.to);\n\n\tconstructor(\n\t\treadonly name: string,\n\t\treadonly description: string,\n\t\treadonly validate: (v: V) => boolean,\n\t\treadonly convert: (v: V) => O\n\t) { }\n\n\toptional(): ApiCommandArgument<V | undefined | null, O | undefined | null> {\n\t\treturn new ApiCommandArgument(\n\t\t\tthis.name, `(optional) ${this.description}`,\n\t\t\tvalue => value === undefined || value === null || this.validate(value),\n\t\t\tvalue => value === undefined ? undefined : value === null ? null : this.convert(value)\n\t\t);\n\t}\n\n\twith(name: string | undefined, description: string | undefined): ApiCommandArgument<V, O> {\n\t\treturn new ApiCommandArgument(name ?? this.name, description ?? this.description, this.validate, this.convert);\n\t}\n}\n\nexport class ApiCommandResult<V, O = V> {\n\n\tstatic readonly Void = new ApiCommandResult<void, void>('no result', v => v);\n\n\tconstructor(\n\t\treadonly description: string,\n\t\treadonly convert: (v: V, apiArgs: any[], cmdConverter: CommandsConverter) => O\n\t) { }\n}\n\nexport class ApiCommand {\n\n\tconstructor(\n\t\treadonly id: string,\n\t\treadonly internalId: string,\n\t\treadonly description: string,\n\t\treadonly args: ApiCommandArgument<any, any>[],\n\t\treadonly result: ApiCommandResult<any, any>\n\t) { }\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from 'vs/base/common/uri';\nimport { DisposableStore } from 'vs/base/common/lifecycle';\nimport type * as vscode from 'vscode';\nimport * as typeConverters from 'vs/workbench/api/common/extHostTypeConverters';\nimport * as types from 'vs/workbench/api/common/extHostTypes';\nimport { IRawColorInfo, IWorkspaceEditDto, ICallHierarchyItemDto, IIncomingCallDto, IOutgoingCallDto } from 'vs/workbench/api/common/extHost.protocol';\nimport * as modes from 'vs/editor/common/modes';\nimport * as search from 'vs/workbench/contrib/search/common/search';\nimport { ICommandHandlerDescription } from 'vs/platform/commands/common/commands';\nimport { ApiCommand, ApiCommandArgument, ApiCommandResult, ExtHostCommands } from 'vs/workbench/api/common/extHostCommands';\nimport { CustomCodeAction } from 'vs/workbench/api/common/extHostLanguageFeatures';\nimport { ICommandsExecutor, RemoveFromRecentlyOpenedAPICommand, OpenIssueReporter, OpenIssueReporterArgs } from './apiCommands';\nimport { isFalsyOrEmpty } from 'vs/base/common/arrays';\nimport { IRange } from 'vs/editor/common/core/range';\nimport { IPosition } from 'vs/editor/common/core/position';\nimport { TransientMetadata } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport { ITextEditorOptions } from 'vs/platform/editor/common/editor';\nimport { VSBuffer } from 'vs/base/common/buffer';\nimport { decodeSemanticTokensDto } from 'vs/editor/common/services/semanticTokensDto';\n\n//#region --- NEW world\n\nconst newCommands: ApiCommand[] = [\n\t// -- document highlights\n\tnew ApiCommand(\n\t\t'vscode.executeDocumentHighlights', '_executeDocumentHighlights', 'Execute document highlight provider.',\n\t\t[ApiCommandArgument.Uri, ApiCommandArgument.Position],\n\t\tnew ApiCommandResult<modes.DocumentHighlight[], types.DocumentHighlight[] | undefined>('A promise that resolves to an array of SymbolInformation and DocumentSymbol instances.', tryMapWith(typeConverters.DocumentHighlight.to))\n\t),\n\t// -- document symbols\n\tnew ApiCommand(\n\t\t'vscode.executeDocumentSymbolProvider', '_executeDocumentSymbolProvider', 'Execute document symbol provider.',\n\t\t[ApiCommandArgument.Uri],\n\t\tnew ApiCommandResult<modes.DocumentSymbol[], vscode.SymbolInformation[] | undefined>('A promise that resolves to an array of DocumentHighlight-instances.', (value, apiArgs) => {\n\n\t\t\tif (isFalsyOrEmpty(value)) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tclass MergedInfo extends types.SymbolInformation implements vscode.DocumentSymbol {\n\t\t\t\tstatic to(symbol: modes.DocumentSymbol): MergedInfo {\n\t\t\t\t\tconst res = new MergedInfo(\n\t\t\t\t\t\tsymbol.name,\n\t\t\t\t\t\ttypeConverters.SymbolKind.to(symbol.kind),\n\t\t\t\t\t\tsymbol.containerName || '',\n\t\t\t\t\t\tnew types.Location(apiArgs[0], typeConverters.Range.to(symbol.range))\n\t\t\t\t\t);\n\t\t\t\t\tres.detail = symbol.detail;\n\t\t\t\t\tres.range = res.location.range;\n\t\t\t\t\tres.selectionRange = typeConverters.Range.to(symbol.selectionRange);\n\t\t\t\t\tres.children = symbol.children ? symbol.children.map(MergedInfo.to) : [];\n\t\t\t\t\treturn res;\n\t\t\t\t}\n\n\t\t\t\tdetail!: string;\n\t\t\t\trange!: vscode.Range;\n\t\t\t\tselectionRange!: vscode.Range;\n\t\t\t\tchildren!: vscode.DocumentSymbol[];\n\t\t\t\tcontainerName!: string;\n\t\t\t}\n\t\t\treturn value.map(MergedInfo.to);\n\n\t\t})\n\t),\n\t// -- formatting\n\tnew ApiCommand(\n\t\t'vscode.executeFormatDocumentProvider', '_executeFormatDocumentProvider', 'Execute document format provider.',\n\t\t[ApiCommandArgument.Uri, new ApiCommandArgument('options', 'Formatting options', _ => true, v => v)],\n\t\tnew ApiCommandResult<modes.TextEdit[], types.TextEdit[] | undefined>('A promise that resolves to an array of TextEdits.', tryMapWith(typeConverters.TextEdit.to))\n\t),\n\tnew ApiCommand(\n\t\t'vscode.executeFormatRangeProvider', '_executeFormatRangeProvider', 'Execute range format provider.',\n\t\t[ApiCommandArgument.Uri, ApiCommandArgument.Range, new ApiCommandArgument('options', 'Formatting options', _ => true, v => v)],\n\t\tnew ApiCommandResult<modes.TextEdit[], types.TextEdit[] | undefined>('A promise that resolves to an array of TextEdits.', tryMapWith(typeConverters.TextEdit.to))\n\t),\n\tnew ApiCommand(\n\t\t'vscode.executeFormatOnTypeProvider', '_executeFormatOnTypeProvider', 'Execute format on type provider.',\n\t\t[ApiCommandArgument.Uri, ApiCommandArgument.Position, new ApiCommandArgument('ch', 'Trigger character', v => typeof v === 'string', v => v), new ApiCommandArgument('options', 'Formatting options', _ => true, v => v)],\n\t\tnew ApiCommandResult<modes.TextEdit[], types.TextEdit[] | undefined>('A promise that resolves to an array of TextEdits.', tryMapWith(typeConverters.TextEdit.to))\n\t),\n\t// -- go to symbol (definition, type definition, declaration, impl, references)\n\tnew ApiCommand(\n\t\t'vscode.executeDefinitionProvider', '_executeDefinitionProvider', 'Execute all definition providers.',\n\t\t[ApiCommandArgument.Uri, ApiCommandArgument.Position],\n\t\tnew ApiCommandResult<(modes.Location | modes.LocationLink)[], (types.Location | vscode.LocationLink)[] | undefined>('A promise that resolves to an array of Location or LocationLink instances.', mapLocationOrLocationLink)\n\t),\n\tnew ApiCommand(\n\t\t'vscode.executeTypeDefinitionProvider', '_executeTypeDefinitionProvider', 'Execute all type definition providers.',\n\t\t[ApiCommandArgument.Uri, ApiCommandArgument.Position],\n\t\tnew ApiCommandResult<(modes.Location | modes.LocationLink)[], (types.Location | vscode.LocationLink)[] | undefined>('A promise that resolves to an array of Location or LocationLink instances.', mapLocationOrLocationLink)\n\t),\n\tnew ApiCommand(\n\t\t'vscode.executeDeclarationProvider', '_executeDeclarationProvider', 'Execute all declaration providers.',\n\t\t[ApiCommandArgument.Uri, ApiCommandArgument.Position],\n\t\tnew ApiCommandResult<(modes.Location | modes.LocationLink)[], (types.Location | vscode.LocationLink)[] | undefined>('A promise that resolves to an array of Location or LocationLink instances.', mapLocationOrLocationLink)\n\t),\n\tnew ApiCommand(\n\t\t'vscode.executeImplementationProvider', '_executeImplementationProvider', 'Execute all implementation providers.',\n\t\t[ApiCommandArgument.Uri, ApiCommandArgument.Position],\n\t\tnew ApiCommandResult<(modes.Location | modes.LocationLink)[], (types.Location | vscode.LocationLink)[] | undefined>('A promise that resolves to an array of Location or LocationLink instances.', mapLocationOrLocationLink)\n\t),\n\tnew ApiCommand(\n\t\t'vscode.executeReferenceProvider', '_executeReferenceProvider', 'Execute all reference providers.',\n\t\t[ApiCommandArgument.Uri, ApiCommandArgument.Position],\n\t\tnew ApiCommandResult<modes.Location[], types.Location[] | undefined>('A promise that resolves to an array of Location-instances.', tryMapWith(typeConverters.location.to))\n\t),\n\t// -- hover\n\tnew ApiCommand(\n\t\t'vscode.executeHoverProvider', '_executeHoverProvider', 'Execute all hover providers.',\n\t\t[ApiCommandArgument.Uri, ApiCommandArgument.Position],\n\t\tnew ApiCommandResult<modes.Hover[], types.Hover[] | undefined>('A promise that resolves to an array of Hover-instances.', tryMapWith(typeConverters.Hover.to))\n\t),\n\t// -- selection range\n\tnew ApiCommand(\n\t\t'vscode.executeSelectionRangeProvider', '_executeSelectionRangeProvider', 'Execute selection range provider.',\n\t\t[ApiCommandArgument.Uri, new ApiCommandArgument<types.Position[], IPosition[]>('position', 'A positions in a text document', v => Array.isArray(v) && v.every(v => types.Position.isPosition(v)), v => v.map(typeConverters.Position.from))],\n\t\tnew ApiCommandResult<IRange[][], types.SelectionRange[]>('A promise that resolves to an array of ranges.', result => {\n\t\t\treturn result.map(ranges => {\n\t\t\t\tlet node: types.SelectionRange | undefined;\n\t\t\t\tfor (const range of ranges.reverse()) {\n\t\t\t\t\tnode = new types.SelectionRange(typeConverters.Range.to(range), node);\n\t\t\t\t}\n\t\t\t\treturn node!;\n\t\t\t});\n\t\t})\n\t),\n\t// -- symbol search\n\tnew ApiCommand(\n\t\t'vscode.executeWorkspaceSymbolProvider', '_executeWorkspaceSymbolProvider', 'Execute all workspace symbol providers.',\n\t\t[ApiCommandArgument.String.with('query', 'Search string')],\n\t\tnew ApiCommandResult<[search.IWorkspaceSymbolProvider, search.IWorkspaceSymbol[]][], types.SymbolInformation[]>('A promise that resolves to an array of SymbolInformation-instances.', value => {\n\t\t\tconst result: types.SymbolInformation[] = [];\n\t\t\tif (Array.isArray(value)) {\n\t\t\t\tfor (let tuple of value) {\n\t\t\t\t\tresult.push(...tuple[1].map(typeConverters.WorkspaceSymbol.to));\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result;\n\t\t})\n\t),\n\t// --- call hierarchy\n\tnew ApiCommand(\n\t\t'vscode.prepareCallHierarchy', '_executePrepareCallHierarchy', 'Prepare call hierarchy at a position inside a document',\n\t\t[ApiCommandArgument.Uri, ApiCommandArgument.Position],\n\t\tnew ApiCommandResult<ICallHierarchyItemDto[], types.CallHierarchyItem[]>('A CallHierarchyItem or undefined', v => v.map(typeConverters.CallHierarchyItem.to))\n\t),\n\tnew ApiCommand(\n\t\t'vscode.provideIncomingCalls', '_executeProvideIncomingCalls', 'Compute incoming calls for an item',\n\t\t[ApiCommandArgument.CallHierarchyItem],\n\t\tnew ApiCommandResult<IIncomingCallDto[], types.CallHierarchyIncomingCall[]>('A CallHierarchyItem or undefined', v => v.map(typeConverters.CallHierarchyIncomingCall.to))\n\t),\n\tnew ApiCommand(\n\t\t'vscode.provideOutgoingCalls', '_executeProvideOutgoingCalls', 'Compute outgoing calls for an item',\n\t\t[ApiCommandArgument.CallHierarchyItem],\n\t\tnew ApiCommandResult<IOutgoingCallDto[], types.CallHierarchyOutgoingCall[]>('A CallHierarchyItem or undefined', v => v.map(typeConverters.CallHierarchyOutgoingCall.to))\n\t),\n\t// --- rename\n\tnew ApiCommand(\n\t\t'vscode.executeDocumentRenameProvider', '_executeDocumentRenameProvider', 'Execute rename provider.',\n\t\t[ApiCommandArgument.Uri, ApiCommandArgument.Position, ApiCommandArgument.String.with('newName', 'The new symbol name')],\n\t\tnew ApiCommandResult<IWorkspaceEditDto, types.WorkspaceEdit | undefined>('A promise that resolves to a WorkspaceEdit.', value => {\n\t\t\tif (!value) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tif (value.rejectReason) {\n\t\t\t\tthrow new Error(value.rejectReason);\n\t\t\t}\n\t\t\treturn typeConverters.WorkspaceEdit.to(value);\n\t\t})\n\t),\n\t// --- links\n\tnew ApiCommand(\n\t\t'vscode.executeLinkProvider', '_executeLinkProvider', 'Execute document link provider.',\n\t\t[ApiCommandArgument.Uri, ApiCommandArgument.Number.with('linkResolveCount', 'Number of links that should be resolved, only when links are unresolved.').optional()],\n\t\tnew ApiCommandResult<modes.ILink[], vscode.DocumentLink[]>('A promise that resolves to an array of DocumentLink-instances.', value => value.map(typeConverters.DocumentLink.to))\n\t),\n\t// --- semantic tokens\n\tnew ApiCommand(\n\t\t'vscode.provideDocumentSemanticTokensLegend', '_provideDocumentSemanticTokensLegend', 'Provide semantic tokens legend for a document',\n\t\t[ApiCommandArgument.Uri],\n\t\tnew ApiCommandResult<modes.SemanticTokensLegend, types.SemanticTokensLegend | undefined>('A promise that resolves to SemanticTokensLegend.', value => {\n\t\t\tif (!value) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\treturn new types.SemanticTokensLegend(value.tokenTypes, value.tokenModifiers);\n\t\t})\n\t),\n\tnew ApiCommand(\n\t\t'vscode.provideDocumentSemanticTokens', '_provideDocumentSemanticTokens', 'Provide semantic tokens for a document',\n\t\t[ApiCommandArgument.Uri],\n\t\tnew ApiCommandResult<VSBuffer, types.SemanticTokens | undefined>('A promise that resolves to SemanticTokens.', value => {\n\t\t\tif (!value) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tconst semanticTokensDto = decodeSemanticTokensDto(value);\n\t\t\tif (semanticTokensDto.type !== 'full') {\n\t\t\t\t// only accepting full semantic tokens from provideDocumentSemanticTokens\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\treturn new types.SemanticTokens(semanticTokensDto.data, undefined);\n\t\t})\n\t),\n\tnew ApiCommand(\n\t\t'vscode.provideDocumentRangeSemanticTokensLegend', '_provideDocumentRangeSemanticTokensLegend', 'Provide semantic tokens legend for a document range',\n\t\t[ApiCommandArgument.Uri],\n\t\tnew ApiCommandResult<modes.SemanticTokensLegend, types.SemanticTokensLegend | undefined>('A promise that resolves to SemanticTokensLegend.', value => {\n\t\t\tif (!value) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\treturn new types.SemanticTokensLegend(value.tokenTypes, value.tokenModifiers);\n\t\t})\n\t),\n\tnew ApiCommand(\n\t\t'vscode.provideDocumentRangeSemanticTokens', '_provideDocumentRangeSemanticTokens', 'Provide semantic tokens for a document range',\n\t\t[ApiCommandArgument.Uri, ApiCommandArgument.Range],\n\t\tnew ApiCommandResult<VSBuffer, types.SemanticTokens | undefined>('A promise that resolves to SemanticTokens.', value => {\n\t\t\tif (!value) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tconst semanticTokensDto = decodeSemanticTokensDto(value);\n\t\t\tif (semanticTokensDto.type !== 'full') {\n\t\t\t\t// only accepting full semantic tokens from provideDocumentRangeSemanticTokens\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\treturn new types.SemanticTokens(semanticTokensDto.data, undefined);\n\t\t})\n\t),\n\t// --- completions\n\tnew ApiCommand(\n\t\t'vscode.executeCompletionItemProvider', '_executeCompletionItemProvider', 'Execute completion item provider.',\n\t\t[\n\t\t\tApiCommandArgument.Uri,\n\t\t\tApiCommandArgument.Position,\n\t\t\tApiCommandArgument.String.with('triggerCharacter', 'Trigger completion when the user types the character, like `,` or `(`').optional(),\n\t\t\tApiCommandArgument.Number.with('itemResolveCount', 'Number of completions to resolve (too large numbers slow down completions)').optional()\n\t\t],\n\t\tnew ApiCommandResult<modes.CompletionList, vscode.CompletionList>('A promise that resolves to a CompletionList-instance.', (value, _args, converter) => {\n\t\t\tif (!value) {\n\t\t\t\treturn new types.CompletionList([]);\n\t\t\t}\n\t\t\tconst items = value.suggestions.map(suggestion => typeConverters.CompletionItem.to(suggestion, converter));\n\t\t\treturn new types.CompletionList(items, value.incomplete);\n\t\t})\n\t),\n\t// --- signature help\n\tnew ApiCommand(\n\t\t'vscode.executeSignatureHelpProvider', '_executeSignatureHelpProvider', 'Execute signature help provider.',\n\t\t[ApiCommandArgument.Uri, ApiCommandArgument.Position, ApiCommandArgument.String.with('triggerCharacter', 'Trigger signature help when the user types the character, like `,` or `(`').optional()],\n\t\tnew ApiCommandResult<modes.SignatureHelp, vscode.SignatureHelp | undefined>('A promise that resolves to SignatureHelp.', value => {\n\t\t\tif (value) {\n\t\t\t\treturn typeConverters.SignatureHelp.to(value);\n\t\t\t}\n\t\t\treturn undefined;\n\t\t})\n\t),\n\t// --- code lens\n\tnew ApiCommand(\n\t\t'vscode.executeCodeLensProvider', '_executeCodeLensProvider', 'Execute code lens provider.',\n\t\t[ApiCommandArgument.Uri, ApiCommandArgument.Number.with('itemResolveCount', 'Number of lenses that should be resolved and returned. Will only return resolved lenses, will impact performance)').optional()],\n\t\tnew ApiCommandResult<modes.CodeLens[], vscode.CodeLens[] | undefined>('A promise that resolves to an array of CodeLens-instances.', (value, _args, converter) => {\n\t\t\treturn tryMapWith<modes.CodeLens, vscode.CodeLens>(item => {\n\t\t\t\treturn new types.CodeLens(typeConverters.Range.to(item.range), item.command && converter.fromInternal(item.command));\n\t\t\t})(value);\n\t\t})\n\t),\n\t// --- code actions\n\tnew ApiCommand(\n\t\t'vscode.executeCodeActionProvider', '_executeCodeActionProvider', 'Execute code action provider.',\n\t\t[\n\t\t\tApiCommandArgument.Uri,\n\t\t\tnew ApiCommandArgument('rangeOrSelection', 'Range in a text document. Some refactoring provider requires Selection object.', v => types.Range.isRange(v), v => types.Selection.isSelection(v) ? typeConverters.Selection.from(v) : typeConverters.Range.from(v)),\n\t\t\tApiCommandArgument.String.with('kind', 'Code action kind to return code actions for').optional(),\n\t\t\tApiCommandArgument.Number.with('itemResolveCount', 'Number of code actions to resolve (too large numbers slow down code actions)').optional()\n\t\t],\n\t\tnew ApiCommandResult<CustomCodeAction[], (vscode.CodeAction | vscode.Command | undefined)[] | undefined>('A promise that resolves to an array of Command-instances.', (value, _args, converter) => {\n\t\t\treturn tryMapWith<CustomCodeAction, vscode.CodeAction | vscode.Command | undefined>((codeAction) => {\n\t\t\t\tif (codeAction._isSynthetic) {\n\t\t\t\t\tif (!codeAction.command) {\n\t\t\t\t\t\tthrow new Error('Synthetic code actions must have a command');\n\t\t\t\t\t}\n\t\t\t\t\treturn converter.fromInternal(codeAction.command);\n\t\t\t\t} else {\n\t\t\t\t\tconst ret = new types.CodeAction(\n\t\t\t\t\t\tcodeAction.title,\n\t\t\t\t\t\tcodeAction.kind ? new types.CodeActionKind(codeAction.kind) : undefined\n\t\t\t\t\t);\n\t\t\t\t\tif (codeAction.edit) {\n\t\t\t\t\t\tret.edit = typeConverters.WorkspaceEdit.to(codeAction.edit);\n\t\t\t\t\t}\n\t\t\t\t\tif (codeAction.command) {\n\t\t\t\t\t\tret.command = converter.fromInternal(codeAction.command);\n\t\t\t\t\t}\n\t\t\t\t\tret.isPreferred = codeAction.isPreferred;\n\t\t\t\t\treturn ret;\n\t\t\t\t}\n\t\t\t})(value);\n\t\t})\n\t),\n\t// --- colors\n\tnew ApiCommand(\n\t\t'vscode.executeDocumentColorProvider', '_executeDocumentColorProvider', 'Execute document color provider.',\n\t\t[ApiCommandArgument.Uri],\n\t\tnew ApiCommandResult<IRawColorInfo[], vscode.ColorInformation[]>('A promise that resolves to an array of ColorInformation objects.', result => {\n\t\t\tif (result) {\n\t\t\t\treturn result.map(ci => new types.ColorInformation(typeConverters.Range.to(ci.range), typeConverters.Color.to(ci.color)));\n\t\t\t}\n\t\t\treturn [];\n\t\t})\n\t),\n\tnew ApiCommand(\n\t\t'vscode.executeColorPresentationProvider', '_executeColorPresentationProvider', 'Execute color presentation provider.',\n\t\t[\n\t\t\tnew ApiCommandArgument<types.Color, [number, number, number, number]>('color', 'The color to show and insert', v => v instanceof types.Color, typeConverters.Color.from),\n\t\t\tnew ApiCommandArgument<{ uri: URI, range: types.Range; }, { uri: URI, range: IRange; }>('context', 'Context object with uri and range', _v => true, v => ({ uri: v.uri, range: typeConverters.Range.from(v.range) })),\n\t\t],\n\t\tnew ApiCommandResult<modes.IColorPresentation[], types.ColorPresentation[]>('A promise that resolves to an array of ColorPresentation objects.', result => {\n\t\t\tif (result) {\n\t\t\t\treturn result.map(typeConverters.ColorPresentation.to);\n\t\t\t}\n\t\t\treturn [];\n\t\t})\n\t),\n\t// --- inline hints\n\tnew ApiCommand(\n\t\t'vscode.executeInlineHintProvider', '_executeInlineHintProvider', 'Execute inline hints provider',\n\t\t[ApiCommandArgument.Uri, ApiCommandArgument.Range],\n\t\tnew ApiCommandResult<modes.InlineHint[], vscode.InlineHint[]>('A promise that resolves to an array of InlineHint objects', result => {\n\t\t\treturn result.map(typeConverters.InlineHint.to);\n\t\t})\n\t),\n\t// --- notebooks\n\tnew ApiCommand(\n\t\t'vscode.resolveNotebookContentProviders', '_resolveNotebookContentProvider', 'Resolve Notebook Content Providers',\n\t\t[\n\t\t\t// new ApiCommandArgument<string, string>('viewType', '', v => typeof v === 'string', v => v),\n\t\t\t// new ApiCommandArgument<string, string>('displayName', '', v => typeof v === 'string', v => v),\n\t\t\t// new ApiCommandArgument<object, object>('options', '', v => typeof v === 'object', v => v),\n\t\t],\n\t\tnew ApiCommandResult<{\n\t\t\tviewType: string;\n\t\t\tdisplayName: string;\n\t\t\toptions: { transientOutputs: boolean; transientMetadata: TransientMetadata };\n\t\t\tfilenamePattern: (string | types.RelativePattern | { include: string | types.RelativePattern, exclude: string | types.RelativePattern })[]\n\t\t}[], {\n\t\t\tviewType: string;\n\t\t\tdisplayName: string;\n\t\t\tfilenamePattern: vscode.NotebookFilenamePattern[];\n\t\t\toptions: vscode.NotebookDocumentContentOptions;\n\t\t}[] | undefined>('A promise that resolves to an array of NotebookContentProvider static info objects.', tryMapWith(item => {\n\t\t\treturn {\n\t\t\t\tviewType: item.viewType,\n\t\t\t\tdisplayName: item.displayName,\n\t\t\t\toptions: { transientOutputs: item.options.transientOutputs, transientMetadata: item.options.transientMetadata },\n\t\t\t\tfilenamePattern: item.filenamePattern.map(pattern => typeConverters.NotebookExclusiveDocumentPattern.to(pattern))\n\t\t\t};\n\t\t}))\n\t),\n\t// --- open'ish commands\n\tnew ApiCommand(\n\t\t'vscode.open', '_workbench.open', 'Opens the provided resource in the editor. Can be a text or binary file, or a http(s) url. If you need more control over the options for opening a text file, use vscode.window.showTextDocument instead.',\n\t\t[\n\t\t\tApiCommandArgument.Uri,\n\t\t\tnew ApiCommandArgument<vscode.ViewColumn | typeConverters.TextEditorOpenOptions | undefined, [number?, ITextEditorOptions?] | undefined>('columnOrOptions', 'Either the column in which to open or editor options, see vscode.TextDocumentShowOptions',\n\t\t\t\tv => v === undefined || typeof v === 'number' || typeof v === 'object',\n\t\t\t\tv => !v ? v : typeof v === 'number' ? [v, undefined] : [typeConverters.ViewColumn.from(v.viewColumn), typeConverters.TextEditorOpenOptions.from(v)]\n\t\t\t).optional(),\n\t\t\tApiCommandArgument.String.with('label', '').optional()\n\t\t],\n\t\tApiCommandResult.Void\n\t),\n\tnew ApiCommand(\n\t\t'vscode.openWith', '_workbench.openWith', 'Opens the provided resource with a specific editor.',\n\t\t[\n\t\t\tApiCommandArgument.Uri.with('resource', 'Resource to open'),\n\t\t\tApiCommandArgument.String.with('viewId', 'Custom editor view id or \\'default\\' to use VS Code\\'s default editor'),\n\t\t\tnew ApiCommandArgument<vscode.ViewColumn | typeConverters.TextEditorOpenOptions | undefined, [number?, ITextEditorOptions?] | undefined>('columnOrOptions', 'Either the column in which to open or editor options, see vscode.TextDocumentShowOptions',\n\t\t\t\tv => v === undefined || typeof v === 'number' || typeof v === 'object',\n\t\t\t\tv => !v ? v : typeof v === 'number' ? [v, undefined] : [typeConverters.ViewColumn.from(v.viewColumn), typeConverters.TextEditorOpenOptions.from(v)],\n\t\t\t).optional()\n\t\t],\n\t\tApiCommandResult.Void\n\t),\n\tnew ApiCommand(\n\t\t'vscode.diff', '_workbench.diff', 'Opens the provided resources in the diff editor to compare their contents.',\n\t\t[\n\t\t\tApiCommandArgument.Uri.with('left', 'Left-hand side resource of the diff editor'),\n\t\t\tApiCommandArgument.Uri.with('right', 'Rigth-hand side resource of the diff editor'),\n\t\t\tApiCommandArgument.String.with('title', 'Human readable title for the diff editor').optional(),\n\t\t\tnew ApiCommandArgument<typeConverters.TextEditorOpenOptions | undefined, [number?, ITextEditorOptions?] | undefined>('columnOrOptions', 'Either the column in which to open or editor options, see vscode.TextDocumentShowOptions',\n\t\t\t\tv => v === undefined || typeof v === 'object',\n\t\t\t\tv => v && [typeConverters.ViewColumn.from(v.viewColumn), typeConverters.TextEditorOpenOptions.from(v)]\n\t\t\t).optional(),\n\t\t],\n\t\tApiCommandResult.Void\n\t),\n];\n\n//#endregion\n\n\n//#region OLD world\n\nexport class ExtHostApiCommands {\n\n\tstatic register(commands: ExtHostCommands) {\n\t\tnewCommands.forEach(commands.registerApiCommand, commands);\n\t\treturn new ExtHostApiCommands(commands).registerCommands();\n\t}\n\n\tprivate _commands: ExtHostCommands;\n\tprivate readonly _disposables = new DisposableStore();\n\n\tprivate constructor(commands: ExtHostCommands) {\n\t\tthis._commands = commands;\n\t}\n\n\tregisterCommands() {\n\n\n\n\n\n\t\t// -----------------------------------------------------------------\n\t\t// The following commands are registered on both sides separately.\n\t\t//\n\t\t// We are trying to maintain backwards compatibility for cases where\n\t\t// API commands are encoded as markdown links, for example.\n\t\t// -----------------------------------------------------------------\n\n\t\ttype ICommandHandler = (...args: any[]) => any;\n\t\tconst adjustHandler = (handler: (executor: ICommandsExecutor, ...args: any[]) => any): ICommandHandler => {\n\t\t\treturn (...args: any[]) => {\n\t\t\t\treturn handler(this._commands, ...args);\n\t\t\t};\n\t\t};\n\n\t\tthis._register(RemoveFromRecentlyOpenedAPICommand.ID, adjustHandler(RemoveFromRecentlyOpenedAPICommand.execute), {\n\t\t\tdescription: 'Removes an entry with the given path from the recently opened list.',\n\t\t\targs: [\n\t\t\t\t{ name: 'path', description: 'Path to remove from recently opened.', constraint: (value: any) => typeof value === 'string' }\n\t\t\t]\n\t\t});\n\n\t\tthis._register(OpenIssueReporter.ID, adjustHandler(OpenIssueReporter.execute), {\n\t\t\tdescription: 'Opens the issue reporter with the provided extension id as the selected source',\n\t\t\targs: [\n\t\t\t\t{ name: 'extensionId', description: 'extensionId to report an issue on', constraint: (value: unknown) => typeof value === 'string' || (typeof value === 'object' && typeof (value as OpenIssueReporterArgs).extensionId === 'string') }\n\t\t\t]\n\t\t});\n\t}\n\n\t// --- command impl\n\n\t/**\n\t * @deprecated use the ApiCommand instead\n\t */\n\tprivate _register(id: string, handler: (...args: any[]) => any, description?: ICommandHandlerDescription): void {\n\t\tconst disposable = this._commands.registerCommand(false, id, handler, this, description);\n\t\tthis._disposables.add(disposable);\n\t}\n\n\n\n}\n\nfunction tryMapWith<T, R>(f: (x: T) => R) {\n\treturn (value: T[]) => {\n\t\tif (Array.isArray(value)) {\n\t\t\treturn value.map(f);\n\t\t}\n\t\treturn undefined;\n\t};\n}\n\nfunction mapLocationOrLocationLink(values: (modes.Location | modes.LocationLink)[]): (types.Location | vscode.LocationLink)[] | undefined {\n\tif (!Array.isArray(values)) {\n\t\treturn undefined;\n\t}\n\tconst result: (types.Location | vscode.LocationLink)[] = [];\n\tfor (const item of values) {\n\t\tif (modes.isLocationLink(item)) {\n\t\t\tresult.push(typeConverters.DefinitionLink.to(item));\n\t\t} else {\n\t\t\tresult.push(typeConverters.location.to(item));\n\t\t}\n\t}\n\treturn result;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { asPromise } from 'vs/base/common/async';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { debounce } from 'vs/base/common/decorators';\nimport { Emitter } from 'vs/base/common/event';\nimport { DisposableStore, IDisposable, MutableDisposable } from 'vs/base/common/lifecycle';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { IRange } from 'vs/editor/common/core/range';\nimport * as modes from 'vs/editor/common/modes';\nimport { ExtensionIdentifier, IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { ExtHostDocuments } from 'vs/workbench/api/common/extHostDocuments';\nimport * as extHostTypeConverter from 'vs/workbench/api/common/extHostTypeConverters';\nimport * as types from 'vs/workbench/api/common/extHostTypes';\nimport type * as vscode from 'vscode';\nimport { ExtHostCommentsShape, IMainContext, MainContext, MainThreadCommentsShape, CommentThreadChanges } from './extHost.protocol';\nimport { ExtHostCommands } from './extHostCommands';\n\ntype ProviderHandle = number;\n\nexport class ExtHostComments implements ExtHostCommentsShape, IDisposable {\n\n\tprivate static handlePool = 0;\n\n\tprivate _proxy: MainThreadCommentsShape;\n\n\tprivate _commentControllers: Map<ProviderHandle, ExtHostCommentController> = new Map<ProviderHandle, ExtHostCommentController>();\n\n\tprivate _commentControllersByExtension: Map<string, ExtHostCommentController[]> = new Map<string, ExtHostCommentController[]>();\n\n\n\tconstructor(\n\t\tmainContext: IMainContext,\n\t\tcommands: ExtHostCommands,\n\t\tprivate readonly _documents: ExtHostDocuments,\n\t) {\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadComments);\n\n\t\tcommands.registerArgumentProcessor({\n\t\t\tprocessArgument: arg => {\n\t\t\t\tif (arg && arg.$mid === 6) {\n\t\t\t\t\tconst commentController = this._commentControllers.get(arg.handle);\n\n\t\t\t\t\tif (!commentController) {\n\t\t\t\t\t\treturn arg;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn commentController;\n\t\t\t\t} else if (arg && arg.$mid === 7) {\n\t\t\t\t\tconst commentController = this._commentControllers.get(arg.commentControlHandle);\n\n\t\t\t\t\tif (!commentController) {\n\t\t\t\t\t\treturn arg;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst commentThread = commentController.getCommentThread(arg.commentThreadHandle);\n\n\t\t\t\t\tif (!commentThread) {\n\t\t\t\t\t\treturn arg;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn commentThread;\n\t\t\t\t} else if (arg && arg.$mid === 8) {\n\t\t\t\t\tconst commentController = this._commentControllers.get(arg.thread.commentControlHandle);\n\n\t\t\t\t\tif (!commentController) {\n\t\t\t\t\t\treturn arg;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst commentThread = commentController.getCommentThread(arg.thread.commentThreadHandle);\n\n\t\t\t\t\tif (!commentThread) {\n\t\t\t\t\t\treturn arg;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tthread: commentThread,\n\t\t\t\t\t\ttext: arg.text\n\t\t\t\t\t};\n\t\t\t\t} else if (arg && arg.$mid === 9) {\n\t\t\t\t\tconst commentController = this._commentControllers.get(arg.thread.commentControlHandle);\n\n\t\t\t\t\tif (!commentController) {\n\t\t\t\t\t\treturn arg;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst commentThread = commentController.getCommentThread(arg.thread.commentThreadHandle);\n\n\t\t\t\t\tif (!commentThread) {\n\t\t\t\t\t\treturn arg;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet commentUniqueId = arg.commentUniqueId;\n\n\t\t\t\t\tlet comment = commentThread.getCommentByUniqueId(commentUniqueId);\n\n\t\t\t\t\tif (!comment) {\n\t\t\t\t\t\treturn arg;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn comment;\n\n\t\t\t\t} else if (arg && arg.$mid === 10) {\n\t\t\t\t\tconst commentController = this._commentControllers.get(arg.thread.commentControlHandle);\n\n\t\t\t\t\tif (!commentController) {\n\t\t\t\t\t\treturn arg;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst commentThread = commentController.getCommentThread(arg.thread.commentThreadHandle);\n\n\t\t\t\t\tif (!commentThread) {\n\t\t\t\t\t\treturn arg;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet body = arg.text;\n\t\t\t\t\tlet commentUniqueId = arg.commentUniqueId;\n\n\t\t\t\t\tlet comment = commentThread.getCommentByUniqueId(commentUniqueId);\n\n\t\t\t\t\tif (!comment) {\n\t\t\t\t\t\treturn arg;\n\t\t\t\t\t}\n\n\t\t\t\t\tcomment.body = body;\n\t\t\t\t\treturn comment;\n\t\t\t\t}\n\n\t\t\t\treturn arg;\n\t\t\t}\n\t\t});\n\t}\n\n\tcreateCommentController(extension: IExtensionDescription, id: string, label: string): vscode.CommentController {\n\t\tconst handle = ExtHostComments.handlePool++;\n\t\tconst commentController = new ExtHostCommentController(extension, handle, this._proxy, id, label);\n\t\tthis._commentControllers.set(commentController.handle, commentController);\n\n\t\tconst commentControllers = this._commentControllersByExtension.get(ExtensionIdentifier.toKey(extension.identifier)) || [];\n\t\tcommentControllers.push(commentController);\n\t\tthis._commentControllersByExtension.set(ExtensionIdentifier.toKey(extension.identifier), commentControllers);\n\n\t\treturn commentController;\n\t}\n\n\t$createCommentThreadTemplate(commentControllerHandle: number, uriComponents: UriComponents, range: IRange): void {\n\t\tconst commentController = this._commentControllers.get(commentControllerHandle);\n\n\t\tif (!commentController) {\n\t\t\treturn;\n\t\t}\n\n\t\tcommentController.$createCommentThreadTemplate(uriComponents, range);\n\t}\n\n\tasync $updateCommentThreadTemplate(commentControllerHandle: number, threadHandle: number, range: IRange) {\n\t\tconst commentController = this._commentControllers.get(commentControllerHandle);\n\n\t\tif (!commentController) {\n\t\t\treturn;\n\t\t}\n\n\t\tcommentController.$updateCommentThreadTemplate(threadHandle, range);\n\t}\n\n\t$deleteCommentThread(commentControllerHandle: number, commentThreadHandle: number) {\n\t\tconst commentController = this._commentControllers.get(commentControllerHandle);\n\n\t\tif (commentController) {\n\t\t\tcommentController.$deleteCommentThread(commentThreadHandle);\n\t\t}\n\t}\n\n\t$provideCommentingRanges(commentControllerHandle: number, uriComponents: UriComponents, token: CancellationToken): Promise<IRange[] | undefined> {\n\t\tconst commentController = this._commentControllers.get(commentControllerHandle);\n\n\t\tif (!commentController || !commentController.commentingRangeProvider) {\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\n\t\tconst document = this._documents.getDocument(URI.revive(uriComponents));\n\t\treturn asPromise(() => {\n\t\t\treturn commentController.commentingRangeProvider!.provideCommentingRanges(document, token);\n\t\t}).then(ranges => ranges ? ranges.map(x => extHostTypeConverter.Range.from(x)) : undefined);\n\t}\n\n\t$toggleReaction(commentControllerHandle: number, threadHandle: number, uri: UriComponents, comment: modes.Comment, reaction: modes.CommentReaction): Promise<void> {\n\t\tconst commentController = this._commentControllers.get(commentControllerHandle);\n\n\t\tif (!commentController || !commentController.reactionHandler) {\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\n\t\treturn asPromise(() => {\n\t\t\tconst commentThread = commentController.getCommentThread(threadHandle);\n\t\t\tif (commentThread) {\n\t\t\t\tconst vscodeComment = commentThread.getCommentByUniqueId(comment.uniqueIdInThread);\n\n\t\t\t\tif (commentController !== undefined && vscodeComment) {\n\t\t\t\t\tif (commentController.reactionHandler) {\n\t\t\t\t\t\treturn commentController.reactionHandler(vscodeComment, convertFromReaction(reaction));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn Promise.resolve(undefined);\n\t\t});\n\t}\n\tdispose() {\n\n\t}\n}\ntype CommentThreadModification = Partial<{\n\trange: vscode.Range,\n\tlabel: string | undefined,\n\tcontextValue: string | undefined,\n\tcomments: vscode.Comment[],\n\tcollapsibleState: vscode.CommentThreadCollapsibleState\n\tcanReply: boolean;\n}>;\n\nexport class ExtHostCommentThread implements vscode.CommentThread {\n\tprivate static _handlePool: number = 0;\n\treadonly handle = ExtHostCommentThread._handlePool++;\n\tpublic commentHandle: number = 0;\n\n\tprivate modifications: CommentThreadModification = Object.create(null);\n\n\tset threadId(id: string) {\n\t\tthis._id = id;\n\t}\n\n\tget threadId(): string {\n\t\treturn this._id!;\n\t}\n\n\tget id(): string {\n\t\treturn this._id!;\n\t}\n\n\tget resource(): vscode.Uri {\n\t\treturn this._uri;\n\t}\n\n\tget uri(): vscode.Uri {\n\t\treturn this._uri;\n\t}\n\n\tprivate readonly _onDidUpdateCommentThread = new Emitter<void>();\n\treadonly onDidUpdateCommentThread = this._onDidUpdateCommentThread.event;\n\n\tset range(range: vscode.Range) {\n\t\tif (!range.isEqual(this._range)) {\n\t\t\tthis._range = range;\n\t\t\tthis.modifications.range = range;\n\t\t\tthis._onDidUpdateCommentThread.fire();\n\t\t}\n\t}\n\n\tget range(): vscode.Range {\n\t\treturn this._range;\n\t}\n\n\tprivate _canReply: boolean = true;\n\n\tset canReply(state: boolean) {\n\t\tif (this._canReply !== state) {\n\t\t\tthis._canReply = state;\n\t\t\tthis.modifications.canReply = state;\n\t\t\tthis._onDidUpdateCommentThread.fire();\n\t\t}\n\t}\n\tget canReply() {\n\t\treturn this._canReply;\n\t}\n\n\tprivate _label: string | undefined;\n\n\tget label(): string | undefined {\n\t\treturn this._label;\n\t}\n\n\tset label(label: string | undefined) {\n\t\tthis._label = label;\n\t\tthis.modifications.label = label;\n\t\tthis._onDidUpdateCommentThread.fire();\n\t}\n\n\tprivate _contextValue: string | undefined;\n\n\tget contextValue(): string | undefined {\n\t\treturn this._contextValue;\n\t}\n\n\tset contextValue(context: string | undefined) {\n\t\tthis._contextValue = context;\n\t\tthis.modifications.contextValue = context;\n\t\tthis._onDidUpdateCommentThread.fire();\n\t}\n\n\tget comments(): vscode.Comment[] {\n\t\treturn this._comments;\n\t}\n\n\tset comments(newComments: vscode.Comment[]) {\n\t\tthis._comments = newComments;\n\t\tthis.modifications.comments = newComments;\n\t\tthis._onDidUpdateCommentThread.fire();\n\t}\n\n\tprivate _collapseState?: vscode.CommentThreadCollapsibleState;\n\n\tget collapsibleState(): vscode.CommentThreadCollapsibleState {\n\t\treturn this._collapseState!;\n\t}\n\n\tset collapsibleState(newState: vscode.CommentThreadCollapsibleState) {\n\t\tthis._collapseState = newState;\n\t\tthis.modifications.collapsibleState = newState;\n\t\tthis._onDidUpdateCommentThread.fire();\n\t}\n\n\tprivate _localDisposables: types.Disposable[];\n\n\tprivate _isDiposed: boolean;\n\n\tpublic get isDisposed(): boolean {\n\t\treturn this._isDiposed;\n\t}\n\n\tprivate _commentsMap: Map<vscode.Comment, number> = new Map<vscode.Comment, number>();\n\n\tprivate _acceptInputDisposables = new MutableDisposable<DisposableStore>();\n\n\tconstructor(\n\t\tprivate _proxy: MainThreadCommentsShape,\n\t\tprivate _commentController: ExtHostCommentController,\n\t\tprivate _id: string | undefined,\n\t\tprivate _uri: vscode.Uri,\n\t\tprivate _range: vscode.Range,\n\t\tprivate _comments: vscode.Comment[],\n\t\textensionId: ExtensionIdentifier\n\t) {\n\t\tthis._acceptInputDisposables.value = new DisposableStore();\n\n\t\tif (this._id === undefined) {\n\t\t\tthis._id = `${_commentController.id}.${this.handle}`;\n\t\t}\n\n\t\tthis._proxy.$createCommentThread(\n\t\t\tthis._commentController.handle,\n\t\t\tthis.handle,\n\t\t\tthis._id,\n\t\t\tthis._uri,\n\t\t\textHostTypeConverter.Range.from(this._range),\n\t\t\textensionId\n\t\t);\n\n\t\tthis._localDisposables = [];\n\t\tthis._isDiposed = false;\n\n\t\tthis._localDisposables.push(this.onDidUpdateCommentThread(() => {\n\t\t\tthis.eventuallyUpdateCommentThread();\n\t\t}));\n\n\t\t// set up comments after ctor to batch update events.\n\t\tthis.comments = _comments;\n\t}\n\n\n\t@debounce(100)\n\teventuallyUpdateCommentThread(): void {\n\t\tif (this._isDiposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._acceptInputDisposables.value) {\n\t\t\tthis._acceptInputDisposables.value = new DisposableStore();\n\t\t}\n\n\t\tconst modified = (value: keyof CommentThreadModification): boolean =>\n\t\t\tObject.prototype.hasOwnProperty.call(this.modifications, value);\n\n\t\tconst formattedModifications: CommentThreadChanges = {};\n\t\tif (modified('range')) {\n\t\t\tformattedModifications.range = extHostTypeConverter.Range.from(this._range);\n\t\t}\n\t\tif (modified('label')) {\n\t\t\tformattedModifications.label = this.label;\n\t\t}\n\t\tif (modified('contextValue')) {\n\t\t\tformattedModifications.contextValue = this.contextValue;\n\t\t}\n\t\tif (modified('comments')) {\n\t\t\tformattedModifications.comments =\n\t\t\t\tthis._comments.map(cmt => convertToModeComment(this, this._commentController, cmt, this._commentsMap));\n\t\t}\n\t\tif (modified('collapsibleState')) {\n\t\t\tformattedModifications.collapseState = convertToCollapsibleState(this._collapseState);\n\t\t}\n\t\tif (modified('canReply')) {\n\t\t\tformattedModifications.canReply = this.canReply;\n\t\t}\n\t\tthis.modifications = {};\n\n\t\tthis._proxy.$updateCommentThread(\n\t\t\tthis._commentController.handle,\n\t\t\tthis.handle,\n\t\t\tthis._id!,\n\t\t\tthis._uri,\n\t\t\tformattedModifications\n\t\t);\n\t}\n\n\tgetCommentByUniqueId(uniqueId: number): vscode.Comment | undefined {\n\t\tfor (let key of this._commentsMap) {\n\t\t\tlet comment = key[0];\n\t\t\tlet id = key[1];\n\t\t\tif (uniqueId === id) {\n\t\t\t\treturn comment;\n\t\t\t}\n\t\t}\n\n\t\treturn;\n\t}\n\n\tdispose() {\n\t\tthis._isDiposed = true;\n\t\tthis._acceptInputDisposables.dispose();\n\t\tthis._localDisposables.forEach(disposable => disposable.dispose());\n\t\tthis._proxy.$deleteCommentThread(\n\t\t\tthis._commentController.handle,\n\t\t\tthis.handle\n\t\t);\n\t}\n}\n\ntype ReactionHandler = (comment: vscode.Comment, reaction: vscode.CommentReaction) => Promise<void>;\n\nclass ExtHostCommentController implements vscode.CommentController {\n\tget id(): string {\n\t\treturn this._id;\n\t}\n\n\tget label(): string {\n\t\treturn this._label;\n\t}\n\n\tpublic get handle(): number {\n\t\treturn this._handle;\n\t}\n\n\tprivate _threads: Map<number, ExtHostCommentThread> = new Map<number, ExtHostCommentThread>();\n\tcommentingRangeProvider?: vscode.CommentingRangeProvider;\n\n\tprivate _reactionHandler?: ReactionHandler;\n\n\tget reactionHandler(): ReactionHandler | undefined {\n\t\treturn this._reactionHandler;\n\t}\n\n\tset reactionHandler(handler: ReactionHandler | undefined) {\n\t\tthis._reactionHandler = handler;\n\n\t\tthis._proxy.$updateCommentControllerFeatures(this.handle, { reactionHandler: !!handler });\n\t}\n\n\tprivate _options: modes.CommentOptions | undefined;\n\n\tget options() {\n\t\treturn this._options;\n\t}\n\n\tset options(options: modes.CommentOptions | undefined) {\n\t\tthis._options = options;\n\n\t\tthis._proxy.$updateCommentControllerFeatures(this.handle, { options: this._options });\n\t}\n\n\tconstructor(\n\t\tprivate _extension: IExtensionDescription,\n\t\tprivate _handle: number,\n\t\tprivate _proxy: MainThreadCommentsShape,\n\t\tprivate _id: string,\n\t\tprivate _label: string\n\t) {\n\t\tthis._proxy.$registerCommentController(this.handle, _id, _label);\n\t}\n\n\tcreateCommentThread(resource: vscode.Uri, range: vscode.Range, comments: vscode.Comment[]): vscode.CommentThread;\n\tcreateCommentThread(arg0: vscode.Uri | string, arg1: vscode.Uri | vscode.Range, arg2: vscode.Range | vscode.Comment[], arg3?: vscode.Comment[]): vscode.CommentThread {\n\t\tif (typeof arg0 === 'string') {\n\t\t\tconst commentThread = new ExtHostCommentThread(this._proxy, this, arg0, arg1 as vscode.Uri, arg2 as vscode.Range, arg3 as vscode.Comment[], this._extension.identifier);\n\t\t\tthis._threads.set(commentThread.handle, commentThread);\n\t\t\treturn commentThread;\n\t\t} else {\n\t\t\tconst commentThread = new ExtHostCommentThread(this._proxy, this, undefined, arg0 as vscode.Uri, arg1 as vscode.Range, arg2 as vscode.Comment[], this._extension.identifier);\n\t\t\tthis._threads.set(commentThread.handle, commentThread);\n\t\t\treturn commentThread;\n\t\t}\n\t}\n\n\t$createCommentThreadTemplate(uriComponents: UriComponents, range: IRange): ExtHostCommentThread {\n\t\tconst commentThread = new ExtHostCommentThread(this._proxy, this, undefined, URI.revive(uriComponents), extHostTypeConverter.Range.to(range), [], this._extension.identifier);\n\t\tcommentThread.collapsibleState = modes.CommentThreadCollapsibleState.Expanded;\n\t\tthis._threads.set(commentThread.handle, commentThread);\n\t\treturn commentThread;\n\t}\n\n\t$updateCommentThreadTemplate(threadHandle: number, range: IRange): void {\n\t\tlet thread = this._threads.get(threadHandle);\n\t\tif (thread) {\n\t\t\tthread.range = extHostTypeConverter.Range.to(range);\n\t\t}\n\t}\n\n\t$deleteCommentThread(threadHandle: number): void {\n\t\tlet thread = this._threads.get(threadHandle);\n\n\t\tif (thread) {\n\t\t\tthread.dispose();\n\t\t}\n\n\t\tthis._threads.delete(threadHandle);\n\t}\n\n\tgetCommentThread(handle: number): ExtHostCommentThread | undefined {\n\t\treturn this._threads.get(handle);\n\t}\n\n\tdispose(): void {\n\t\tthis._threads.forEach(value => {\n\t\t\tvalue.dispose();\n\t\t});\n\n\t\tthis._proxy.$unregisterCommentController(this.handle);\n\t}\n}\n\nfunction convertToModeComment(thread: ExtHostCommentThread, commentController: ExtHostCommentController, vscodeComment: vscode.Comment, commentsMap: Map<vscode.Comment, number>): modes.Comment {\n\tlet commentUniqueId = commentsMap.get(vscodeComment)!;\n\tif (!commentUniqueId) {\n\t\tcommentUniqueId = ++thread.commentHandle;\n\t\tcommentsMap.set(vscodeComment, commentUniqueId);\n\t}\n\n\tconst iconPath = vscodeComment.author && vscodeComment.author.iconPath ? vscodeComment.author.iconPath.toString() : undefined;\n\n\treturn {\n\t\tmode: vscodeComment.mode,\n\t\tcontextValue: vscodeComment.contextValue,\n\t\tuniqueIdInThread: commentUniqueId,\n\t\tbody: extHostTypeConverter.MarkdownString.from(vscodeComment.body),\n\t\tuserName: vscodeComment.author.name,\n\t\tuserIconPath: iconPath,\n\t\tlabel: vscodeComment.label,\n\t\tcommentReactions: vscodeComment.reactions ? vscodeComment.reactions.map(reaction => convertToReaction(reaction)) : undefined\n\t};\n}\n\nfunction convertToReaction(reaction: vscode.CommentReaction): modes.CommentReaction {\n\treturn {\n\t\tlabel: reaction.label,\n\t\ticonPath: reaction.iconPath ? extHostTypeConverter.pathOrURIToURI(reaction.iconPath) : undefined,\n\t\tcount: reaction.count,\n\t\thasReacted: reaction.authorHasReacted,\n\t};\n}\n\nfunction convertFromReaction(reaction: modes.CommentReaction): vscode.CommentReaction {\n\treturn {\n\t\tlabel: reaction.label || '',\n\t\tcount: reaction.count || 0,\n\t\ticonPath: reaction.iconPath ? URI.revive(reaction.iconPath) : '',\n\t\tauthorHasReacted: reaction.hasReacted || false\n\t};\n}\n\nfunction convertToCollapsibleState(kind: vscode.CommentThreadCollapsibleState | undefined): modes.CommentThreadCollapsibleState {\n\tif (kind !== undefined) {\n\t\tswitch (kind) {\n\t\t\tcase types.CommentThreadCollapsibleState.Expanded:\n\t\t\t\treturn modes.CommentThreadCollapsibleState.Expanded;\n\t\t\tcase types.CommentThreadCollapsibleState.Collapsed:\n\t\t\t\treturn modes.CommentThreadCollapsibleState.Collapsed;\n\t\t}\n\t}\n\treturn modes.CommentThreadCollapsibleState.Collapsed;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type * as vscode from 'vscode';\nimport { URI } from 'vs/base/common/uri';\nimport { MainContext, ExtHostDecorationsShape, MainThreadDecorationsShape, DecorationData, DecorationRequest, DecorationReply } from 'vs/workbench/api/common/extHost.protocol';\nimport { Disposable, FileDecoration } from 'vs/workbench/api/common/extHostTypes';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { ExtensionIdentifier } from 'vs/platform/extensions/common/extensions';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { IExtHostRpcService } from 'vs/workbench/api/common/extHostRpcService';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { asArray, groupBy } from 'vs/base/common/arrays';\nimport { compare, count } from 'vs/base/common/strings';\nimport { dirname } from 'vs/base/common/path';\n\ninterface ProviderData {\n\tprovider: vscode.FileDecorationProvider;\n\textensionId: ExtensionIdentifier;\n}\n\nexport class ExtHostDecorations implements ExtHostDecorationsShape {\n\n\tprivate static _handlePool = 0;\n\tprivate static _maxEventSize = 250;\n\n\treadonly _serviceBrand: undefined;\n\tprivate readonly _provider = new Map<number, ProviderData>();\n\tprivate readonly _proxy: MainThreadDecorationsShape;\n\n\tconstructor(\n\t\t@IExtHostRpcService extHostRpc: IExtHostRpcService,\n\t\t@ILogService private readonly _logService: ILogService,\n\t) {\n\t\tthis._proxy = extHostRpc.getProxy(MainContext.MainThreadDecorations);\n\t}\n\n\tregisterFileDecorationProvider(provider: vscode.FileDecorationProvider, extensionId: ExtensionIdentifier): vscode.Disposable {\n\t\tconst handle = ExtHostDecorations._handlePool++;\n\t\tthis._provider.set(handle, { provider, extensionId });\n\t\tthis._proxy.$registerDecorationProvider(handle, extensionId.value);\n\n\t\tconst listener = provider.onDidChangeFileDecorations && provider.onDidChangeFileDecorations(e => {\n\t\t\tif (!e) {\n\t\t\t\tthis._proxy.$onDidChange(handle, null);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet array = asArray(e);\n\t\t\tif (array.length <= ExtHostDecorations._maxEventSize) {\n\t\t\t\tthis._proxy.$onDidChange(handle, array);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// too many resources per event. pick one resource per folder, starting\n\t\t\t// with parent folders\n\t\t\tthis._logService.warn('[Decorations] CAPPING events from decorations provider', extensionId.value, array.length);\n\t\t\tconst mapped = array.map(uri => ({ uri, rank: count(uri.path, '/') }));\n\t\t\tconst groups = groupBy(mapped, (a, b) => a.rank - b.rank || compare(a.uri.path, b.uri.path));\n\t\t\tlet picked: URI[] = [];\n\t\t\touter: for (let uris of groups) {\n\t\t\t\tlet lastDirname: string | undefined;\n\t\t\t\tfor (let obj of uris) {\n\t\t\t\t\tlet myDirname = dirname(obj.uri.path);\n\t\t\t\t\tif (lastDirname !== myDirname) {\n\t\t\t\t\t\tlastDirname = myDirname;\n\t\t\t\t\t\tif (picked.push(obj.uri) >= ExtHostDecorations._maxEventSize) {\n\t\t\t\t\t\t\tbreak outer;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._proxy.$onDidChange(handle, picked);\n\t\t});\n\n\t\treturn new Disposable(() => {\n\t\t\tlistener?.dispose();\n\t\t\tthis._proxy.$unregisterDecorationProvider(handle);\n\t\t\tthis._provider.delete(handle);\n\t\t});\n\t}\n\n\tasync $provideDecorations(handle: number, requests: DecorationRequest[], token: CancellationToken): Promise<DecorationReply> {\n\n\t\tif (!this._provider.has(handle)) {\n\t\t\t// might have been unregistered in the meantime\n\t\t\treturn Object.create(null);\n\t\t}\n\n\t\tconst result: DecorationReply = Object.create(null);\n\t\tconst { provider, extensionId } = this._provider.get(handle)!;\n\n\t\tawait Promise.all(requests.map(async request => {\n\t\t\ttry {\n\t\t\t\tconst { uri, id } = request;\n\t\t\t\tconst data = await Promise.resolve(provider.provideFileDecoration(URI.revive(uri), token));\n\t\t\t\tif (!data) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\ttry {\n\t\t\t\t\tFileDecoration.validate(data);\n\t\t\t\t\tresult[id] = <DecorationData>[data.propagate, data.tooltip, data.badge, data.color];\n\t\t\t\t} catch (e) {\n\t\t\t\t\tthis._logService.warn(`INVALID decoration from extension '${extensionId.value}': ${e}`);\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tthis._logService.error(err);\n\t\t\t}\n\t\t}));\n\n\t\treturn result;\n\t}\n}\n\nexport const IExtHostDecorations = createDecorator<IExtHostDecorations>('IExtHostDecorations');\nexport interface IExtHostDecorations extends ExtHostDecorations { }\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from 'vs/nls';\nimport { IMarkerData, MarkerSeverity } from 'vs/platform/markers/common/markers';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport type * as vscode from 'vscode';\nimport { MainContext, MainThreadDiagnosticsShape, ExtHostDiagnosticsShape, IMainContext } from './extHost.protocol';\nimport { DiagnosticSeverity } from './extHostTypes';\nimport * as converter from './extHostTypeConverters';\nimport { mergeSort } from 'vs/base/common/arrays';\nimport { Event, Emitter } from 'vs/base/common/event';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { ResourceMap } from 'vs/base/common/map';\nimport { ExtensionIdentifier } from 'vs/platform/extensions/common/extensions';\n\nexport class DiagnosticCollection implements vscode.DiagnosticCollection {\n\n\tprivate _isDisposed = false;\n\tprivate _data = new ResourceMap<vscode.Diagnostic[]>();\n\n\tconstructor(\n\t\tprivate readonly _name: string,\n\t\tprivate readonly _owner: string,\n\t\tprivate readonly _maxDiagnosticsPerFile: number,\n\t\tprivate readonly _proxy: MainThreadDiagnosticsShape | undefined,\n\t\tprivate readonly _onDidChangeDiagnostics: Emitter<vscode.Uri[]>\n\t) { }\n\n\tdispose(): void {\n\t\tif (!this._isDisposed) {\n\t\t\tthis._onDidChangeDiagnostics.fire([...this._data.keys()]);\n\t\t\tif (this._proxy) {\n\t\t\t\tthis._proxy.$clear(this._owner);\n\t\t\t}\n\t\t\tthis._data = undefined!;\n\t\t\tthis._isDisposed = true;\n\t\t}\n\t}\n\n\tget name(): string {\n\t\tthis._checkDisposed();\n\t\treturn this._name;\n\t}\n\n\tset(uri: vscode.Uri, diagnostics: ReadonlyArray<vscode.Diagnostic>): void;\n\tset(entries: ReadonlyArray<[vscode.Uri, ReadonlyArray<vscode.Diagnostic>]>): void;\n\tset(first: vscode.Uri | ReadonlyArray<[vscode.Uri, ReadonlyArray<vscode.Diagnostic>]>, diagnostics?: ReadonlyArray<vscode.Diagnostic>) {\n\n\t\tif (!first) {\n\t\t\t// this set-call is a clear-call\n\t\t\tthis.clear();\n\t\t\treturn;\n\t\t}\n\n\t\t// the actual implementation for #set\n\n\t\tthis._checkDisposed();\n\t\tlet toSync: vscode.Uri[] = [];\n\n\t\tif (URI.isUri(first)) {\n\n\t\t\tif (!diagnostics) {\n\t\t\t\t// remove this entry\n\t\t\t\tthis.delete(first);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// update single row\n\t\t\tthis._data.set(first, diagnostics.slice());\n\t\t\ttoSync = [first];\n\n\t\t} else if (Array.isArray(first)) {\n\t\t\t// update many rows\n\t\t\ttoSync = [];\n\t\t\tlet lastUri: vscode.Uri | undefined;\n\n\t\t\t// ensure stable-sort\n\t\t\tfirst = mergeSort([...first], DiagnosticCollection._compareIndexedTuplesByUri);\n\n\t\t\tfor (const tuple of first) {\n\t\t\t\tconst [uri, diagnostics] = tuple;\n\t\t\t\tif (!lastUri || uri.toString() !== lastUri.toString()) {\n\t\t\t\t\tif (lastUri && this._data.get(lastUri)!.length === 0) {\n\t\t\t\t\t\tthis._data.delete(lastUri);\n\t\t\t\t\t}\n\t\t\t\t\tlastUri = uri;\n\t\t\t\t\ttoSync.push(uri);\n\t\t\t\t\tthis._data.set(uri, []);\n\t\t\t\t}\n\n\t\t\t\tif (!diagnostics) {\n\t\t\t\t\t// [Uri, undefined] means clear this\n\t\t\t\t\tconst currentDiagnostics = this._data.get(uri);\n\t\t\t\t\tif (currentDiagnostics) {\n\t\t\t\t\t\tcurrentDiagnostics.length = 0;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconst currentDiagnostics = this._data.get(uri);\n\t\t\t\t\tif (currentDiagnostics) {\n\t\t\t\t\t\tcurrentDiagnostics.push(...diagnostics);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// send event for extensions\n\t\tthis._onDidChangeDiagnostics.fire(toSync);\n\n\t\t// compute change and send to main side\n\t\tif (!this._proxy) {\n\t\t\treturn;\n\t\t}\n\t\tconst entries: [URI, IMarkerData[]][] = [];\n\t\tfor (let uri of toSync) {\n\t\t\tlet marker: IMarkerData[] = [];\n\t\t\tconst diagnostics = this._data.get(uri);\n\t\t\tif (diagnostics) {\n\n\t\t\t\t// no more than N diagnostics per file\n\t\t\t\tif (diagnostics.length > this._maxDiagnosticsPerFile) {\n\t\t\t\t\tmarker = [];\n\t\t\t\t\tconst order = [DiagnosticSeverity.Error, DiagnosticSeverity.Warning, DiagnosticSeverity.Information, DiagnosticSeverity.Hint];\n\t\t\t\t\torderLoop: for (let i = 0; i < 4; i++) {\n\t\t\t\t\t\tfor (let diagnostic of diagnostics) {\n\t\t\t\t\t\t\tif (diagnostic.severity === order[i]) {\n\t\t\t\t\t\t\t\tconst len = marker.push(converter.Diagnostic.from(diagnostic));\n\t\t\t\t\t\t\t\tif (len === this._maxDiagnosticsPerFile) {\n\t\t\t\t\t\t\t\t\tbreak orderLoop;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// add 'signal' marker for showing omitted errors/warnings\n\t\t\t\t\tmarker.push({\n\t\t\t\t\t\tseverity: MarkerSeverity.Info,\n\t\t\t\t\t\tmessage: localize({ key: 'limitHit', comment: ['amount of errors/warning skipped due to limits'] }, \"Not showing {0} further errors and warnings.\", diagnostics.length - this._maxDiagnosticsPerFile),\n\t\t\t\t\t\tstartLineNumber: marker[marker.length - 1].startLineNumber,\n\t\t\t\t\t\tstartColumn: marker[marker.length - 1].startColumn,\n\t\t\t\t\t\tendLineNumber: marker[marker.length - 1].endLineNumber,\n\t\t\t\t\t\tendColumn: marker[marker.length - 1].endColumn\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tmarker = diagnostics.map(diag => converter.Diagnostic.from(diag));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tentries.push([uri, marker]);\n\t\t}\n\t\tthis._proxy.$changeMany(this._owner, entries);\n\t}\n\n\tdelete(uri: vscode.Uri): void {\n\t\tthis._checkDisposed();\n\t\tthis._onDidChangeDiagnostics.fire([uri]);\n\t\tthis._data.delete(uri);\n\t\tif (this._proxy) {\n\t\t\tthis._proxy.$changeMany(this._owner, [[uri, undefined]]);\n\t\t}\n\t}\n\n\tclear(): void {\n\t\tthis._checkDisposed();\n\t\tthis._onDidChangeDiagnostics.fire([...this._data.keys()]);\n\t\tthis._data.clear();\n\t\tif (this._proxy) {\n\t\t\tthis._proxy.$clear(this._owner);\n\t\t}\n\t}\n\n\tforEach(callback: (uri: URI, diagnostics: ReadonlyArray<vscode.Diagnostic>, collection: DiagnosticCollection) => any, thisArg?: any): void {\n\t\tthis._checkDisposed();\n\t\tfor (let uri of this._data.keys()) {\n\t\t\tcallback.apply(thisArg, [uri, this.get(uri), this]);\n\t\t}\n\t}\n\n\tget(uri: URI): ReadonlyArray<vscode.Diagnostic> {\n\t\tthis._checkDisposed();\n\t\tconst result = this._data.get(uri);\n\t\tif (Array.isArray(result)) {\n\t\t\treturn <ReadonlyArray<vscode.Diagnostic>>Object.freeze(result.slice(0));\n\t\t}\n\t\treturn [];\n\t}\n\n\thas(uri: URI): boolean {\n\t\tthis._checkDisposed();\n\t\treturn Array.isArray(this._data.get(uri));\n\t}\n\n\tprivate _checkDisposed() {\n\t\tif (this._isDisposed) {\n\t\t\tthrow new Error('illegal state - object is disposed');\n\t\t}\n\t}\n\n\tprivate static _compareIndexedTuplesByUri(a: [vscode.Uri, readonly vscode.Diagnostic[]], b: [vscode.Uri, readonly vscode.Diagnostic[]]): number {\n\t\tif (a[0].toString() < b[0].toString()) {\n\t\t\treturn -1;\n\t\t} else if (a[0].toString() > b[0].toString()) {\n\t\t\treturn 1;\n\t\t} else {\n\t\t\treturn 0;\n\t\t}\n\t}\n}\n\nexport class ExtHostDiagnostics implements ExtHostDiagnosticsShape {\n\n\tprivate static _idPool: number = 0;\n\tprivate static readonly _maxDiagnosticsPerFile: number = 1000;\n\n\tprivate readonly _proxy: MainThreadDiagnosticsShape;\n\tprivate readonly _collections = new Map<string, DiagnosticCollection>();\n\tprivate readonly _onDidChangeDiagnostics = new Emitter<vscode.Uri[]>();\n\n\tstatic _debouncer(last: (vscode.Uri | string)[] | undefined, current: (vscode.Uri | string)[]): (vscode.Uri | string)[] {\n\t\tif (!last) {\n\t\t\treturn current;\n\t\t} else {\n\t\t\treturn last.concat(current);\n\t\t}\n\t}\n\n\tstatic _mapper(last: (vscode.Uri | string)[]): { uris: vscode.Uri[] } {\n\t\tconst uris: vscode.Uri[] = [];\n\t\tconst map = new Set<string>();\n\t\tfor (const uri of last) {\n\t\t\tif (typeof uri === 'string') {\n\t\t\t\tif (!map.has(uri)) {\n\t\t\t\t\tmap.add(uri);\n\t\t\t\t\turis.push(URI.parse(uri));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (!map.has(uri.toString())) {\n\t\t\t\t\tmap.add(uri.toString());\n\t\t\t\t\turis.push(uri);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tObject.freeze(uris);\n\t\treturn { uris };\n\t}\n\n\treadonly onDidChangeDiagnostics: Event<vscode.DiagnosticChangeEvent> = Event.map(Event.debounce(this._onDidChangeDiagnostics.event, ExtHostDiagnostics._debouncer, 50), ExtHostDiagnostics._mapper);\n\n\tconstructor(mainContext: IMainContext, @ILogService private readonly _logService: ILogService) {\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadDiagnostics);\n\t}\n\n\tcreateDiagnosticCollection(extensionId: ExtensionIdentifier, name?: string): vscode.DiagnosticCollection {\n\n\t\tconst { _collections, _proxy, _onDidChangeDiagnostics, _logService } = this;\n\n\t\tconst loggingProxy = new class implements MainThreadDiagnosticsShape {\n\t\t\t$changeMany(owner: string, entries: [UriComponents, IMarkerData[] | undefined][]): void {\n\t\t\t\t_proxy.$changeMany(owner, entries);\n\t\t\t\t_logService.trace('[DiagnosticCollection] change many (extension, owner, uris)', extensionId.value, owner, entries.length === 0 ? 'CLEARING' : entries);\n\t\t\t}\n\t\t\t$clear(owner: string): void {\n\t\t\t\t_proxy.$clear(owner);\n\t\t\t\t_logService.trace('[DiagnosticCollection] remove all (extension, owner)', extensionId.value, owner);\n\t\t\t}\n\t\t\tdispose(): void {\n\t\t\t\t_proxy.dispose();\n\t\t\t}\n\t\t};\n\n\n\t\tlet owner: string;\n\t\tif (!name) {\n\t\t\tname = '_generated_diagnostic_collection_name_#' + ExtHostDiagnostics._idPool++;\n\t\t\towner = name;\n\t\t} else if (!_collections.has(name)) {\n\t\t\towner = name;\n\t\t} else {\n\t\t\tthis._logService.warn(`DiagnosticCollection with name '${name}' does already exist.`);\n\t\t\tdo {\n\t\t\t\towner = name + ExtHostDiagnostics._idPool++;\n\t\t\t} while (_collections.has(owner));\n\t\t}\n\n\t\tconst result = new class extends DiagnosticCollection {\n\t\t\tconstructor() {\n\t\t\t\tsuper(name!, owner, ExtHostDiagnostics._maxDiagnosticsPerFile, loggingProxy, _onDidChangeDiagnostics);\n\t\t\t\t_collections.set(owner, this);\n\t\t\t}\n\t\t\tdispose() {\n\t\t\t\tsuper.dispose();\n\t\t\t\t_collections.delete(owner);\n\t\t\t}\n\t\t};\n\n\t\treturn result;\n\t}\n\n\tgetDiagnostics(resource: vscode.Uri): ReadonlyArray<vscode.Diagnostic>;\n\tgetDiagnostics(): ReadonlyArray<[vscode.Uri, ReadonlyArray<vscode.Diagnostic>]>;\n\tgetDiagnostics(resource?: vscode.Uri): ReadonlyArray<vscode.Diagnostic> | ReadonlyArray<[vscode.Uri, ReadonlyArray<vscode.Diagnostic>]>;\n\tgetDiagnostics(resource?: vscode.Uri): ReadonlyArray<vscode.Diagnostic> | ReadonlyArray<[vscode.Uri, ReadonlyArray<vscode.Diagnostic>]> {\n\t\tif (resource) {\n\t\t\treturn this._getDiagnostics(resource);\n\t\t} else {\n\t\t\tconst index = new Map<string, number>();\n\t\t\tconst res: [vscode.Uri, vscode.Diagnostic[]][] = [];\n\t\t\tfor (const collection of this._collections.values()) {\n\t\t\t\tcollection.forEach((uri, diagnostics) => {\n\t\t\t\t\tlet idx = index.get(uri.toString());\n\t\t\t\t\tif (typeof idx === 'undefined') {\n\t\t\t\t\t\tidx = res.length;\n\t\t\t\t\t\tindex.set(uri.toString(), idx);\n\t\t\t\t\t\tres.push([uri, []]);\n\t\t\t\t\t}\n\t\t\t\t\tres[idx][1] = res[idx][1].concat(...diagnostics);\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn res;\n\t\t}\n\t}\n\n\tprivate _getDiagnostics(resource: vscode.Uri): ReadonlyArray<vscode.Diagnostic> {\n\t\tlet res: vscode.Diagnostic[] = [];\n\t\tfor (let collection of this._collections.values()) {\n\t\t\tif (collection.has(resource)) {\n\t\t\t\tres = res.concat(collection.get(resource));\n\t\t\t}\n\t\t}\n\t\treturn res;\n\t}\n\n\tprivate _mirrorCollection: vscode.DiagnosticCollection | undefined;\n\n\t$acceptMarkersChange(data: [UriComponents, IMarkerData[]][]): void {\n\n\t\tif (!this._mirrorCollection) {\n\t\t\tconst name = '_generated_mirror';\n\t\t\tconst collection = new DiagnosticCollection(name, name, ExtHostDiagnostics._maxDiagnosticsPerFile, undefined, this._onDidChangeDiagnostics);\n\t\t\tthis._collections.set(name, collection);\n\t\t\tthis._mirrorCollection = collection;\n\t\t}\n\n\t\tfor (const [uri, markers] of data) {\n\t\t\tthis._mirrorCollection.set(URI.revive(uri), markers.map(converter.Diagnostic.to));\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type * as vscode from 'vscode';\nimport { URI } from 'vs/base/common/uri';\nimport { MainContext, MainThreadDiaglogsShape, IMainContext } from 'vs/workbench/api/common/extHost.protocol';\n\nexport class ExtHostDialogs {\n\n\tprivate readonly _proxy: MainThreadDiaglogsShape;\n\n\tconstructor(mainContext: IMainContext) {\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadDialogs);\n\t}\n\n\tshowOpenDialog(options?: vscode.OpenDialogOptions): Promise<URI[] | undefined> {\n\t\treturn this._proxy.$showOpenDialog(options).then(filepaths => {\n\t\t\treturn filepaths ? filepaths.map(p => URI.revive(p)) : undefined;\n\t\t});\n\t}\n\n\tshowSaveDialog(options?: vscode.SaveDialogOptions): Promise<URI | undefined> {\n\t\treturn this._proxy.$showSaveDialog(options).then(filepath => {\n\t\t\treturn filepath ? URI.revive(filepath) : undefined;\n\t\t});\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { onUnexpectedError } from 'vs/base/common/errors';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { IDisposable } from 'vs/base/common/lifecycle';\nimport { Disposable } from 'vs/workbench/api/common/extHostTypes';\nimport type * as vscode from 'vscode';\nimport { MainContext, ExtHostDocumentContentProvidersShape, MainThreadDocumentContentProvidersShape, IMainContext } from './extHost.protocol';\nimport { ExtHostDocumentsAndEditors } from './extHostDocumentsAndEditors';\nimport { Schemas } from 'vs/base/common/network';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { splitLines } from 'vs/base/common/strings';\n\nexport class ExtHostDocumentContentProvider implements ExtHostDocumentContentProvidersShape {\n\n\tprivate static _handlePool = 0;\n\n\tprivate readonly _documentContentProviders = new Map<number, vscode.TextDocumentContentProvider>();\n\tprivate readonly _proxy: MainThreadDocumentContentProvidersShape;\n\n\tconstructor(\n\t\tmainContext: IMainContext,\n\t\tprivate readonly _documentsAndEditors: ExtHostDocumentsAndEditors,\n\t\tprivate readonly _logService: ILogService,\n\t) {\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadDocumentContentProviders);\n\t}\n\n\tregisterTextDocumentContentProvider(scheme: string, provider: vscode.TextDocumentContentProvider): vscode.Disposable {\n\t\t// todo@remote\n\t\t// check with scheme from fs-providers!\n\t\tif (Object.keys(Schemas).indexOf(scheme) >= 0) {\n\t\t\tthrow new Error(`scheme '${scheme}' already registered`);\n\t\t}\n\n\t\tconst handle = ExtHostDocumentContentProvider._handlePool++;\n\n\t\tthis._documentContentProviders.set(handle, provider);\n\t\tthis._proxy.$registerTextContentProvider(handle, scheme);\n\n\t\tlet subscription: IDisposable | undefined;\n\t\tif (typeof provider.onDidChange === 'function') {\n\t\t\tsubscription = provider.onDidChange(uri => {\n\t\t\t\tif (uri.scheme !== scheme) {\n\t\t\t\t\tthis._logService.warn(`Provider for scheme '${scheme}' is firing event for schema '${uri.scheme}' which will be IGNORED`);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (this._documentsAndEditors.getDocument(uri)) {\n\t\t\t\t\tthis.$provideTextDocumentContent(handle, uri).then(value => {\n\t\t\t\t\t\tif (!value && typeof value !== 'string') {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst document = this._documentsAndEditors.getDocument(uri);\n\t\t\t\t\t\tif (!document) {\n\t\t\t\t\t\t\t// disposed in the meantime\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// create lines and compare\n\t\t\t\t\t\tconst lines = splitLines(value);\n\n\t\t\t\t\t\t// broadcast event when content changed\n\t\t\t\t\t\tif (!document.equalLines(lines)) {\n\t\t\t\t\t\t\treturn this._proxy.$onVirtualDocumentChange(uri, value);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, onUnexpectedError);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn new Disposable(() => {\n\t\t\tif (this._documentContentProviders.delete(handle)) {\n\t\t\t\tthis._proxy.$unregisterTextContentProvider(handle);\n\t\t\t}\n\t\t\tif (subscription) {\n\t\t\t\tsubscription.dispose();\n\t\t\t\tsubscription = undefined;\n\t\t\t}\n\t\t});\n\t}\n\n\t$provideTextDocumentContent(handle: number, uri: UriComponents): Promise<string | null | undefined> {\n\t\tconst provider = this._documentContentProviders.get(handle);\n\t\tif (!provider) {\n\t\t\treturn Promise.reject(new Error(`unsupported uri-scheme: ${uri.scheme}`));\n\t\t}\n\t\treturn Promise.resolve(provider.provideTextDocumentContent(URI.revive(uri), CancellationToken.None));\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { DisposableStore } from 'vs/base/common/lifecycle';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { IModelChangedEvent } from 'vs/editor/common/model/mirrorTextModel';\nimport { ExtHostDocumentsShape, IMainContext, MainContext, MainThreadDocumentsShape } from 'vs/workbench/api/common/extHost.protocol';\nimport { ExtHostDocumentData, setWordDefinitionFor } from 'vs/workbench/api/common/extHostDocumentData';\nimport { ExtHostDocumentsAndEditors } from 'vs/workbench/api/common/extHostDocumentsAndEditors';\nimport * as TypeConverters from 'vs/workbench/api/common/extHostTypeConverters';\nimport type * as vscode from 'vscode';\nimport { assertIsDefined } from 'vs/base/common/types';\nimport { deepFreeze } from 'vs/base/common/objects';\n\nexport class ExtHostDocuments implements ExtHostDocumentsShape {\n\n\tprivate readonly _onDidAddDocument = new Emitter<vscode.TextDocument>();\n\tprivate readonly _onDidRemoveDocument = new Emitter<vscode.TextDocument>();\n\tprivate readonly _onDidChangeDocument = new Emitter<vscode.TextDocumentChangeEvent>();\n\tprivate readonly _onDidSaveDocument = new Emitter<vscode.TextDocument>();\n\n\treadonly onDidAddDocument: Event<vscode.TextDocument> = this._onDidAddDocument.event;\n\treadonly onDidRemoveDocument: Event<vscode.TextDocument> = this._onDidRemoveDocument.event;\n\treadonly onDidChangeDocument: Event<vscode.TextDocumentChangeEvent> = this._onDidChangeDocument.event;\n\treadonly onDidSaveDocument: Event<vscode.TextDocument> = this._onDidSaveDocument.event;\n\n\tprivate readonly _toDispose = new DisposableStore();\n\tprivate _proxy: MainThreadDocumentsShape;\n\tprivate _documentsAndEditors: ExtHostDocumentsAndEditors;\n\tprivate _documentLoader = new Map<string, Promise<ExtHostDocumentData>>();\n\n\tconstructor(mainContext: IMainContext, documentsAndEditors: ExtHostDocumentsAndEditors) {\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadDocuments);\n\t\tthis._documentsAndEditors = documentsAndEditors;\n\n\t\tthis._documentsAndEditors.onDidRemoveDocuments(documents => {\n\t\t\tfor (const data of documents) {\n\t\t\t\tthis._onDidRemoveDocument.fire(data.document);\n\t\t\t}\n\t\t}, undefined, this._toDispose);\n\t\tthis._documentsAndEditors.onDidAddDocuments(documents => {\n\t\t\tfor (const data of documents) {\n\t\t\t\tthis._onDidAddDocument.fire(data.document);\n\t\t\t}\n\t\t}, undefined, this._toDispose);\n\t}\n\n\tpublic dispose(): void {\n\t\tthis._toDispose.dispose();\n\t}\n\n\tpublic getAllDocumentData(): ExtHostDocumentData[] {\n\t\treturn [...this._documentsAndEditors.allDocuments()];\n\t}\n\n\tpublic getDocumentData(resource: vscode.Uri): ExtHostDocumentData | undefined {\n\t\tif (!resource) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst data = this._documentsAndEditors.getDocument(resource);\n\t\tif (data) {\n\t\t\treturn data;\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tpublic getDocument(resource: vscode.Uri): vscode.TextDocument {\n\t\tconst data = this.getDocumentData(resource);\n\t\tif (!data?.document) {\n\t\t\tthrow new Error(`Unable to retrieve document from URI '${resource}'`);\n\t\t}\n\t\treturn data.document;\n\t}\n\n\tpublic ensureDocumentData(uri: URI): Promise<ExtHostDocumentData> {\n\n\t\tconst cached = this._documentsAndEditors.getDocument(uri);\n\t\tif (cached) {\n\t\t\treturn Promise.resolve(cached);\n\t\t}\n\n\t\tlet promise = this._documentLoader.get(uri.toString());\n\t\tif (!promise) {\n\t\t\tpromise = this._proxy.$tryOpenDocument(uri).then(uriData => {\n\t\t\t\tthis._documentLoader.delete(uri.toString());\n\t\t\t\tconst canonicalUri = URI.revive(uriData);\n\t\t\t\treturn assertIsDefined(this._documentsAndEditors.getDocument(canonicalUri));\n\t\t\t}, err => {\n\t\t\t\tthis._documentLoader.delete(uri.toString());\n\t\t\t\treturn Promise.reject(err);\n\t\t\t});\n\t\t\tthis._documentLoader.set(uri.toString(), promise);\n\t\t}\n\n\t\treturn promise;\n\t}\n\n\tpublic createDocumentData(options?: { language?: string; content?: string }): Promise<URI> {\n\t\treturn this._proxy.$tryCreateDocument(options).then(data => URI.revive(data));\n\t}\n\n\tpublic $acceptModelModeChanged(uriComponents: UriComponents, oldModeId: string, newModeId: string): void {\n\t\tconst uri = URI.revive(uriComponents);\n\t\tconst data = this._documentsAndEditors.getDocument(uri);\n\t\tif (!data) {\n\t\t\tthrow new Error('unknown document');\n\t\t}\n\t\t// Treat a mode change as a remove + add\n\n\t\tthis._onDidRemoveDocument.fire(data.document);\n\t\tdata._acceptLanguageId(newModeId);\n\t\tthis._onDidAddDocument.fire(data.document);\n\t}\n\n\tpublic $acceptModelSaved(uriComponents: UriComponents): void {\n\t\tconst uri = URI.revive(uriComponents);\n\t\tconst data = this._documentsAndEditors.getDocument(uri);\n\t\tif (!data) {\n\t\t\tthrow new Error('unknown document');\n\t\t}\n\t\tthis.$acceptDirtyStateChanged(uriComponents, false);\n\t\tthis._onDidSaveDocument.fire(data.document);\n\t}\n\n\tpublic $acceptDirtyStateChanged(uriComponents: UriComponents, isDirty: boolean): void {\n\t\tconst uri = URI.revive(uriComponents);\n\t\tconst data = this._documentsAndEditors.getDocument(uri);\n\t\tif (!data) {\n\t\t\tthrow new Error('unknown document');\n\t\t}\n\t\tdata._acceptIsDirty(isDirty);\n\t\tthis._onDidChangeDocument.fire({\n\t\t\tdocument: data.document,\n\t\t\tcontentChanges: []\n\t\t});\n\t}\n\n\tpublic $acceptModelChanged(uriComponents: UriComponents, events: IModelChangedEvent, isDirty: boolean): void {\n\t\tconst uri = URI.revive(uriComponents);\n\t\tconst data = this._documentsAndEditors.getDocument(uri);\n\t\tif (!data) {\n\t\t\tthrow new Error('unknown document');\n\t\t}\n\t\tdata._acceptIsDirty(isDirty);\n\t\tdata.onEvents(events);\n\t\tthis._onDidChangeDocument.fire(deepFreeze({\n\t\t\tdocument: data.document,\n\t\t\tcontentChanges: events.changes.map((change) => {\n\t\t\t\treturn {\n\t\t\t\t\trange: TypeConverters.Range.to(change.range),\n\t\t\t\t\trangeOffset: change.rangeOffset,\n\t\t\t\t\trangeLength: change.rangeLength,\n\t\t\t\t\ttext: change.text\n\t\t\t\t};\n\t\t\t})\n\t\t}));\n\t}\n\n\tpublic setWordDefinitionFor(modeId: string, wordDefinition: RegExp | undefined): void {\n\t\tsetWordDefinitionFor(modeId, wordDefinition);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as assert from 'vs/base/common/assert';\nimport * as vscode from 'vscode';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { dispose } from 'vs/base/common/lifecycle';\nimport { URI } from 'vs/base/common/uri';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { ExtHostDocumentsAndEditorsShape, IDocumentsAndEditorsDelta, IModelAddedData, MainContext } from 'vs/workbench/api/common/extHost.protocol';\nimport { ExtHostDocumentData } from 'vs/workbench/api/common/extHostDocumentData';\nimport { IExtHostRpcService } from 'vs/workbench/api/common/extHostRpcService';\nimport { ExtHostTextEditor } from 'vs/workbench/api/common/extHostTextEditor';\nimport * as typeConverters from 'vs/workbench/api/common/extHostTypeConverters';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { ResourceMap } from 'vs/base/common/map';\nimport { Schemas } from 'vs/base/common/network';\nimport { Iterable } from 'vs/base/common/iterator';\n\nclass Reference<T> {\n\tprivate _count = 0;\n\tconstructor(readonly value: T) { }\n\tref() {\n\t\tthis._count++;\n\t}\n\tunref() {\n\t\treturn --this._count === 0;\n\t}\n}\n\nexport interface IExtHostModelAddedData extends IModelAddedData {\n\tnotebook?: vscode.NotebookDocument;\n}\n\nexport interface IExtHostDocumentsAndEditorsDelta extends IDocumentsAndEditorsDelta {\n\taddedDocuments?: IExtHostModelAddedData[];\n}\n\nexport class ExtHostDocumentsAndEditors implements ExtHostDocumentsAndEditorsShape {\n\n\treadonly _serviceBrand: undefined;\n\n\tprivate _activeEditorId: string | null = null;\n\n\tprivate readonly _editors = new Map<string, ExtHostTextEditor>();\n\tprivate readonly _documents = new ResourceMap<Reference<ExtHostDocumentData>>();\n\n\tprivate readonly _onDidAddDocuments = new Emitter<ExtHostDocumentData[]>();\n\tprivate readonly _onDidRemoveDocuments = new Emitter<ExtHostDocumentData[]>();\n\tprivate readonly _onDidChangeVisibleTextEditors = new Emitter<ExtHostTextEditor[]>();\n\tprivate readonly _onDidChangeActiveTextEditor = new Emitter<ExtHostTextEditor | undefined>();\n\n\treadonly onDidAddDocuments: Event<ExtHostDocumentData[]> = this._onDidAddDocuments.event;\n\treadonly onDidRemoveDocuments: Event<ExtHostDocumentData[]> = this._onDidRemoveDocuments.event;\n\treadonly onDidChangeVisibleTextEditors: Event<ExtHostTextEditor[]> = this._onDidChangeVisibleTextEditors.event;\n\treadonly onDidChangeActiveTextEditor: Event<ExtHostTextEditor | undefined> = this._onDidChangeActiveTextEditor.event;\n\n\tconstructor(\n\t\t@IExtHostRpcService private readonly _extHostRpc: IExtHostRpcService,\n\t\t@ILogService private readonly _logService: ILogService\n\t) { }\n\n\t$acceptDocumentsAndEditorsDelta(delta: IDocumentsAndEditorsDelta): void {\n\t\tthis.acceptDocumentsAndEditorsDelta(delta);\n\t}\n\n\tacceptDocumentsAndEditorsDelta(delta: IExtHostDocumentsAndEditorsDelta): void {\n\n\t\tconst removedDocuments: ExtHostDocumentData[] = [];\n\t\tconst addedDocuments: ExtHostDocumentData[] = [];\n\t\tconst removedEditors: ExtHostTextEditor[] = [];\n\n\t\tif (delta.removedDocuments) {\n\t\t\tfor (const uriComponent of delta.removedDocuments) {\n\t\t\t\tconst uri = URI.revive(uriComponent);\n\t\t\t\tconst data = this._documents.get(uri);\n\t\t\t\tif (data?.unref()) {\n\t\t\t\t\tthis._documents.delete(uri);\n\t\t\t\t\tremovedDocuments.push(data.value);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (delta.addedDocuments) {\n\t\t\tfor (const data of delta.addedDocuments) {\n\t\t\t\tconst resource = URI.revive(data.uri);\n\t\t\t\tlet ref = this._documents.get(resource);\n\n\t\t\t\t// double check -> only notebook cell documents should be\n\t\t\t\t// referenced/opened more than once...\n\t\t\t\tif (ref) {\n\t\t\t\t\tif (resource.scheme !== Schemas.vscodeNotebookCell) {\n\t\t\t\t\t\tthrow new Error(`document '${resource} already exists!'`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!ref) {\n\t\t\t\t\tref = new Reference(new ExtHostDocumentData(\n\t\t\t\t\t\tthis._extHostRpc.getProxy(MainContext.MainThreadDocuments),\n\t\t\t\t\t\tresource,\n\t\t\t\t\t\tdata.lines,\n\t\t\t\t\t\tdata.EOL,\n\t\t\t\t\t\tdata.versionId,\n\t\t\t\t\t\tdata.modeId,\n\t\t\t\t\t\tdata.isDirty,\n\t\t\t\t\t\tdata.notebook\n\t\t\t\t\t));\n\t\t\t\t\tthis._documents.set(resource, ref);\n\t\t\t\t\taddedDocuments.push(ref.value);\n\t\t\t\t}\n\n\t\t\t\tref.ref();\n\t\t\t}\n\t\t}\n\n\t\tif (delta.removedEditors) {\n\t\t\tfor (const id of delta.removedEditors) {\n\t\t\t\tconst editor = this._editors.get(id);\n\t\t\t\tthis._editors.delete(id);\n\t\t\t\tif (editor) {\n\t\t\t\t\tremovedEditors.push(editor);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (delta.addedEditors) {\n\t\t\tfor (const data of delta.addedEditors) {\n\t\t\t\tconst resource = URI.revive(data.documentUri);\n\t\t\t\tassert.ok(this._documents.has(resource), `document '${resource}' does not exist`);\n\t\t\t\tassert.ok(!this._editors.has(data.id), `editor '${data.id}' already exists!`);\n\n\t\t\t\tconst documentData = this._documents.get(resource)!.value;\n\t\t\t\tconst editor = new ExtHostTextEditor(\n\t\t\t\t\tdata.id,\n\t\t\t\t\tthis._extHostRpc.getProxy(MainContext.MainThreadTextEditors),\n\t\t\t\t\tthis._logService,\n\t\t\t\t\tdocumentData,\n\t\t\t\t\tdata.selections.map(typeConverters.Selection.to),\n\t\t\t\t\tdata.options,\n\t\t\t\t\tdata.visibleRanges.map(range => typeConverters.Range.to(range)),\n\t\t\t\t\ttypeof data.editorPosition === 'number' ? typeConverters.ViewColumn.to(data.editorPosition) : undefined\n\t\t\t\t);\n\t\t\t\tthis._editors.set(data.id, editor);\n\t\t\t}\n\t\t}\n\n\t\tif (delta.newActiveEditor !== undefined) {\n\t\t\tassert.ok(delta.newActiveEditor === null || this._editors.has(delta.newActiveEditor), `active editor '${delta.newActiveEditor}' does not exist`);\n\t\t\tthis._activeEditorId = delta.newActiveEditor;\n\t\t}\n\n\t\tdispose(removedDocuments);\n\t\tdispose(removedEditors);\n\n\t\t// now that the internal state is complete, fire events\n\t\tif (delta.removedDocuments) {\n\t\t\tthis._onDidRemoveDocuments.fire(removedDocuments);\n\t\t}\n\t\tif (delta.addedDocuments) {\n\t\t\tthis._onDidAddDocuments.fire(addedDocuments);\n\t\t}\n\n\t\tif (delta.removedEditors || delta.addedEditors) {\n\t\t\tthis._onDidChangeVisibleTextEditors.fire(this.allEditors());\n\t\t}\n\t\tif (delta.newActiveEditor !== undefined) {\n\t\t\tthis._onDidChangeActiveTextEditor.fire(this.activeEditor());\n\t\t}\n\t}\n\n\tgetDocument(uri: URI): ExtHostDocumentData | undefined {\n\t\treturn this._documents.get(uri)?.value;\n\t}\n\n\tallDocuments(): Iterable<ExtHostDocumentData> {\n\t\treturn Iterable.map(this._documents.values(), ref => ref.value);\n\t}\n\n\tgetEditor(id: string): ExtHostTextEditor | undefined {\n\t\treturn this._editors.get(id);\n\t}\n\n\tactiveEditor(): ExtHostTextEditor | undefined {\n\t\tif (!this._activeEditorId) {\n\t\t\treturn undefined;\n\t\t} else {\n\t\t\treturn this._editors.get(this._activeEditorId);\n\t\t}\n\t}\n\n\tallEditors(): ExtHostTextEditor[] {\n\t\treturn [...this._editors.values()];\n\t}\n}\n\nexport interface IExtHostDocumentsAndEditors extends ExtHostDocumentsAndEditors { }\nexport const IExtHostDocumentsAndEditors = createDecorator<IExtHostDocumentsAndEditors>('IExtHostDocumentsAndEditors');\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { MainContext, IMainContext, ExtHostFileSystemShape, MainThreadFileSystemShape, IFileChangeDto } from './extHost.protocol';\nimport type * as vscode from 'vscode';\nimport * as files from 'vs/platform/files/common/files';\nimport { IDisposable, toDisposable } from 'vs/base/common/lifecycle';\nimport { FileChangeType } from 'vs/workbench/api/common/extHostTypes';\nimport * as typeConverter from 'vs/workbench/api/common/extHostTypeConverters';\nimport { ExtHostLanguageFeatures } from 'vs/workbench/api/common/extHostLanguageFeatures';\nimport { State, StateMachine, LinkComputer, Edge } from 'vs/editor/common/modes/linkComputer';\nimport { commonPrefixLength } from 'vs/base/common/strings';\nimport { CharCode } from 'vs/base/common/charCode';\nimport { VSBuffer } from 'vs/base/common/buffer';\nimport { ExtensionIdentifier } from 'vs/platform/extensions/common/extensions';\n\nclass FsLinkProvider {\n\n\tprivate _schemes: string[] = [];\n\tprivate _stateMachine?: StateMachine;\n\n\tadd(scheme: string): void {\n\t\tthis._stateMachine = undefined;\n\t\tthis._schemes.push(scheme);\n\t}\n\n\tdelete(scheme: string): void {\n\t\tconst idx = this._schemes.indexOf(scheme);\n\t\tif (idx >= 0) {\n\t\t\tthis._schemes.splice(idx, 1);\n\t\t\tthis._stateMachine = undefined;\n\t\t}\n\t}\n\n\tprivate _initStateMachine(): void {\n\t\tif (!this._stateMachine) {\n\n\t\t\t// sort and compute common prefix with previous scheme\n\t\t\t// then build state transitions based on the data\n\t\t\tconst schemes = this._schemes.sort();\n\t\t\tconst edges: Edge[] = [];\n\t\t\tlet prevScheme: string | undefined;\n\t\t\tlet prevState: State;\n\t\t\tlet lastState = State.LastKnownState;\n\t\t\tlet nextState = State.LastKnownState;\n\t\t\tfor (const scheme of schemes) {\n\n\t\t\t\t// skip the common prefix of the prev scheme\n\t\t\t\t// and continue with its last state\n\t\t\t\tlet pos = !prevScheme ? 0 : commonPrefixLength(prevScheme, scheme);\n\t\t\t\tif (pos === 0) {\n\t\t\t\t\tprevState = State.Start;\n\t\t\t\t} else {\n\t\t\t\t\tprevState = nextState;\n\t\t\t\t}\n\n\t\t\t\tfor (; pos < scheme.length; pos++) {\n\t\t\t\t\t// keep creating new (next) states until the\n\t\t\t\t\t// end (and the BeforeColon-state) is reached\n\t\t\t\t\tif (pos + 1 === scheme.length) {\n\t\t\t\t\t\t// Save the last state here, because we need to continue for the next scheme\n\t\t\t\t\t\tlastState = nextState;\n\t\t\t\t\t\tnextState = State.BeforeColon;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnextState += 1;\n\t\t\t\t\t}\n\t\t\t\t\tedges.push([prevState, scheme.toUpperCase().charCodeAt(pos), nextState]);\n\t\t\t\t\tedges.push([prevState, scheme.toLowerCase().charCodeAt(pos), nextState]);\n\t\t\t\t\tprevState = nextState;\n\t\t\t\t}\n\n\t\t\t\tprevScheme = scheme;\n\t\t\t\t// Restore the last state\n\t\t\t\tnextState = lastState;\n\t\t\t}\n\n\t\t\t// all link must match this pattern `<scheme>:/<more>`\n\t\t\tedges.push([State.BeforeColon, CharCode.Colon, State.AfterColon]);\n\t\t\tedges.push([State.AfterColon, CharCode.Slash, State.End]);\n\n\t\t\tthis._stateMachine = new StateMachine(edges);\n\t\t}\n\t}\n\n\tprovideDocumentLinks(document: vscode.TextDocument): vscode.ProviderResult<vscode.DocumentLink[]> {\n\t\tthis._initStateMachine();\n\n\t\tconst result: vscode.DocumentLink[] = [];\n\t\tconst links = LinkComputer.computeLinks({\n\t\t\tgetLineContent(lineNumber: number): string {\n\t\t\t\treturn document.lineAt(lineNumber - 1).text;\n\t\t\t},\n\t\t\tgetLineCount(): number {\n\t\t\t\treturn document.lineCount;\n\t\t\t}\n\t\t}, this._stateMachine);\n\n\t\tfor (const link of links) {\n\t\t\tconst docLink = typeConverter.DocumentLink.to(link);\n\t\t\tif (docLink.target) {\n\t\t\t\tresult.push(docLink);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n}\n\nexport class ExtHostFileSystem implements ExtHostFileSystemShape {\n\n\tprivate readonly _proxy: MainThreadFileSystemShape;\n\tprivate readonly _linkProvider = new FsLinkProvider();\n\tprivate readonly _fsProvider = new Map<number, vscode.FileSystemProvider>();\n\tprivate readonly _registeredSchemes = new Set<string>();\n\tprivate readonly _watches = new Map<number, IDisposable>();\n\n\tprivate _linkProviderRegistration?: IDisposable;\n\tprivate _handlePool: number = 0;\n\n\tconstructor(mainContext: IMainContext, private _extHostLanguageFeatures: ExtHostLanguageFeatures) {\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadFileSystem);\n\t}\n\n\tdispose(): void {\n\t\tthis._linkProviderRegistration?.dispose();\n\t}\n\n\tprivate _registerLinkProviderIfNotYetRegistered(): void {\n\t\tif (!this._linkProviderRegistration) {\n\t\t\tthis._linkProviderRegistration = this._extHostLanguageFeatures.registerDocumentLinkProvider(undefined, '*', this._linkProvider);\n\t\t}\n\t}\n\n\tregisterFileSystemProvider(extension: ExtensionIdentifier, scheme: string, provider: vscode.FileSystemProvider, options: { isCaseSensitive?: boolean, isReadonly?: boolean } = {}) {\n\n\t\tif (this._registeredSchemes.has(scheme)) {\n\t\t\tthrow new Error(`a provider for the scheme '${scheme}' is already registered`);\n\t\t}\n\n\t\t//\n\t\tthis._registerLinkProviderIfNotYetRegistered();\n\n\t\tconst handle = this._handlePool++;\n\t\tthis._linkProvider.add(scheme);\n\t\tthis._registeredSchemes.add(scheme);\n\t\tthis._fsProvider.set(handle, provider);\n\n\t\tlet capabilities = files.FileSystemProviderCapabilities.FileReadWrite;\n\t\tif (options.isCaseSensitive) {\n\t\t\tcapabilities += files.FileSystemProviderCapabilities.PathCaseSensitive;\n\t\t}\n\t\tif (options.isReadonly) {\n\t\t\tcapabilities += files.FileSystemProviderCapabilities.Readonly;\n\t\t}\n\t\tif (typeof provider.copy === 'function') {\n\t\t\tcapabilities += files.FileSystemProviderCapabilities.FileFolderCopy;\n\t\t}\n\t\tif (typeof provider.open === 'function' && typeof provider.close === 'function'\n\t\t\t&& typeof provider.read === 'function' && typeof provider.write === 'function'\n\t\t) {\n\t\t\tcapabilities += files.FileSystemProviderCapabilities.FileOpenReadWriteClose;\n\t\t}\n\n\t\tthis._proxy.$registerFileSystemProvider(handle, scheme, capabilities).catch(err => {\n\t\t\tconsole.error(`FAILED to register filesystem provider of ${extension.value}-extension for the scheme ${scheme}`);\n\t\t\tconsole.error(err);\n\t\t});\n\n\t\tconst subscription = provider.onDidChangeFile(event => {\n\t\t\tconst mapped: IFileChangeDto[] = [];\n\t\t\tfor (const e of event) {\n\t\t\t\tlet { uri: resource, type } = e;\n\t\t\t\tif (resource.scheme !== scheme) {\n\t\t\t\t\t// dropping events for wrong scheme\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tlet newType: files.FileChangeType | undefined;\n\t\t\t\tswitch (type) {\n\t\t\t\t\tcase FileChangeType.Changed:\n\t\t\t\t\t\tnewType = files.FileChangeType.UPDATED;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase FileChangeType.Created:\n\t\t\t\t\t\tnewType = files.FileChangeType.ADDED;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase FileChangeType.Deleted:\n\t\t\t\t\t\tnewType = files.FileChangeType.DELETED;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tthrow new Error('Unknown FileChangeType');\n\t\t\t\t}\n\t\t\t\tmapped.push({ resource, type: newType });\n\t\t\t}\n\t\t\tthis._proxy.$onFileSystemChange(handle, mapped);\n\t\t});\n\n\t\treturn toDisposable(() => {\n\t\t\tsubscription.dispose();\n\t\t\tthis._linkProvider.delete(scheme);\n\t\t\tthis._registeredSchemes.delete(scheme);\n\t\t\tthis._fsProvider.delete(handle);\n\t\t\tthis._proxy.$unregisterProvider(handle);\n\t\t});\n\t}\n\n\tprivate static _asIStat(stat: vscode.FileStat): files.IStat {\n\t\tconst { type, ctime, mtime, size } = stat;\n\t\treturn { type, ctime, mtime, size };\n\t}\n\n\t$stat(handle: number, resource: UriComponents): Promise<files.IStat> {\n\t\treturn Promise.resolve(this._getFsProvider(handle).stat(URI.revive(resource))).then(ExtHostFileSystem._asIStat);\n\t}\n\n\t$readdir(handle: number, resource: UriComponents): Promise<[string, files.FileType][]> {\n\t\treturn Promise.resolve(this._getFsProvider(handle).readDirectory(URI.revive(resource)));\n\t}\n\n\t$readFile(handle: number, resource: UriComponents): Promise<VSBuffer> {\n\t\treturn Promise.resolve(this._getFsProvider(handle).readFile(URI.revive(resource))).then(data => VSBuffer.wrap(data));\n\t}\n\n\t$writeFile(handle: number, resource: UriComponents, content: VSBuffer, opts: files.FileWriteOptions): Promise<void> {\n\t\treturn Promise.resolve(this._getFsProvider(handle).writeFile(URI.revive(resource), content.buffer, opts));\n\t}\n\n\t$delete(handle: number, resource: UriComponents, opts: files.FileDeleteOptions): Promise<void> {\n\t\treturn Promise.resolve(this._getFsProvider(handle).delete(URI.revive(resource), opts));\n\t}\n\n\t$rename(handle: number, oldUri: UriComponents, newUri: UriComponents, opts: files.FileOverwriteOptions): Promise<void> {\n\t\treturn Promise.resolve(this._getFsProvider(handle).rename(URI.revive(oldUri), URI.revive(newUri), opts));\n\t}\n\n\t$copy(handle: number, oldUri: UriComponents, newUri: UriComponents, opts: files.FileOverwriteOptions): Promise<void> {\n\t\tconst provider = this._getFsProvider(handle);\n\t\tif (!provider.copy) {\n\t\t\tthrow new Error('FileSystemProvider does not implement \"copy\"');\n\t\t}\n\t\treturn Promise.resolve(provider.copy(URI.revive(oldUri), URI.revive(newUri), opts));\n\t}\n\n\t$mkdir(handle: number, resource: UriComponents): Promise<void> {\n\t\treturn Promise.resolve(this._getFsProvider(handle).createDirectory(URI.revive(resource)));\n\t}\n\n\t$watch(handle: number, session: number, resource: UriComponents, opts: files.IWatchOptions): void {\n\t\tconst subscription = this._getFsProvider(handle).watch(URI.revive(resource), opts);\n\t\tthis._watches.set(session, subscription);\n\t}\n\n\t$unwatch(_handle: number, session: number): void {\n\t\tconst subscription = this._watches.get(session);\n\t\tif (subscription) {\n\t\t\tsubscription.dispose();\n\t\t\tthis._watches.delete(session);\n\t\t}\n\t}\n\n\t$open(handle: number, resource: UriComponents, opts: files.FileOpenOptions): Promise<number> {\n\t\tconst provider = this._getFsProvider(handle);\n\t\tif (!provider.open) {\n\t\t\tthrow new Error('FileSystemProvider does not implement \"open\"');\n\t\t}\n\t\treturn Promise.resolve(provider.open(URI.revive(resource), opts));\n\t}\n\n\t$close(handle: number, fd: number): Promise<void> {\n\t\tconst provider = this._getFsProvider(handle);\n\t\tif (!provider.close) {\n\t\t\tthrow new Error('FileSystemProvider does not implement \"close\"');\n\t\t}\n\t\treturn Promise.resolve(provider.close(fd));\n\t}\n\n\t$read(handle: number, fd: number, pos: number, length: number): Promise<VSBuffer> {\n\t\tconst provider = this._getFsProvider(handle);\n\t\tif (!provider.read) {\n\t\t\tthrow new Error('FileSystemProvider does not implement \"read\"');\n\t\t}\n\t\tconst data = VSBuffer.alloc(length);\n\t\treturn Promise.resolve(provider.read(fd, pos, data.buffer, 0, length)).then(read => {\n\t\t\treturn data.slice(0, read); // don't send zeros\n\t\t});\n\t}\n\n\t$write(handle: number, fd: number, pos: number, data: VSBuffer): Promise<number> {\n\t\tconst provider = this._getFsProvider(handle);\n\t\tif (!provider.write) {\n\t\t\tthrow new Error('FileSystemProvider does not implement \"write\"');\n\t\t}\n\t\treturn Promise.resolve(provider.write(fd, pos, data.buffer, 0, data.byteLength));\n\t}\n\n\tprivate _getFsProvider(handle: number): vscode.FileSystemProvider {\n\t\tconst provider = this._fsProvider.get(handle);\n\t\tif (!provider) {\n\t\t\tconst err = new Error();\n\t\t\terr.name = 'ENOPRO';\n\t\t\terr.message = `no provider`;\n\t\t\tthrow err;\n\t\t}\n\t\treturn provider;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { MainThreadFileSystemShape, MainContext } from './extHost.protocol';\nimport * as vscode from 'vscode';\nimport * as files from 'vs/platform/files/common/files';\nimport { FileSystemError } from 'vs/workbench/api/common/extHostTypes';\nimport { VSBuffer } from 'vs/base/common/buffer';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { IExtHostRpcService } from 'vs/workbench/api/common/extHostRpcService';\nimport { IExtHostFileSystemInfo } from 'vs/workbench/api/common/extHostFileSystemInfo';\n\nexport class ExtHostConsumerFileSystem implements vscode.FileSystem {\n\n\treadonly _serviceBrand: undefined;\n\n\tprivate readonly _proxy: MainThreadFileSystemShape;\n\n\tconstructor(\n\t\t@IExtHostRpcService extHostRpc: IExtHostRpcService,\n\t\t@IExtHostFileSystemInfo private readonly _fileSystemInfo: IExtHostFileSystemInfo,\n\t) {\n\t\tthis._proxy = extHostRpc.getProxy(MainContext.MainThreadFileSystem);\n\t}\n\n\tstat(uri: vscode.Uri): Promise<vscode.FileStat> {\n\t\treturn this._proxy.$stat(uri).catch(ExtHostConsumerFileSystem._handleError);\n\t}\n\treadDirectory(uri: vscode.Uri): Promise<[string, vscode.FileType][]> {\n\t\treturn this._proxy.$readdir(uri).catch(ExtHostConsumerFileSystem._handleError);\n\t}\n\tcreateDirectory(uri: vscode.Uri): Promise<void> {\n\t\treturn this._proxy.$mkdir(uri).catch(ExtHostConsumerFileSystem._handleError);\n\t}\n\tasync readFile(uri: vscode.Uri): Promise<Uint8Array> {\n\t\treturn this._proxy.$readFile(uri).then(buff => buff.buffer).catch(ExtHostConsumerFileSystem._handleError);\n\t}\n\twriteFile(uri: vscode.Uri, content: Uint8Array): Promise<void> {\n\t\treturn this._proxy.$writeFile(uri, VSBuffer.wrap(content)).catch(ExtHostConsumerFileSystem._handleError);\n\t}\n\tdelete(uri: vscode.Uri, options?: { recursive?: boolean; useTrash?: boolean; }): Promise<void> {\n\t\treturn this._proxy.$delete(uri, { ...{ recursive: false, useTrash: false }, ...options }).catch(ExtHostConsumerFileSystem._handleError);\n\t}\n\trename(oldUri: vscode.Uri, newUri: vscode.Uri, options?: { overwrite?: boolean; }): Promise<void> {\n\t\treturn this._proxy.$rename(oldUri, newUri, { ...{ overwrite: false }, ...options }).catch(ExtHostConsumerFileSystem._handleError);\n\t}\n\tcopy(source: vscode.Uri, destination: vscode.Uri, options?: { overwrite?: boolean; }): Promise<void> {\n\t\treturn this._proxy.$copy(source, destination, { ...{ overwrite: false }, ...options }).catch(ExtHostConsumerFileSystem._handleError);\n\t}\n\tisWritableFileSystem(scheme: string): boolean | undefined {\n\t\tconst capabilities = this._fileSystemInfo.getCapabilities(scheme);\n\t\tif (typeof capabilities === 'number') {\n\t\t\treturn !(capabilities & files.FileSystemProviderCapabilities.Readonly);\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate static _handleError(err: any): never {\n\t\t// generic error\n\t\tif (!(err instanceof Error)) {\n\t\t\tthrow new FileSystemError(String(err));\n\t\t}\n\n\t\t// no provider (unknown scheme) error\n\t\tif (err.name === 'ENOPRO') {\n\t\t\tthrow FileSystemError.Unavailable(err.message);\n\t\t}\n\n\t\t// file system error\n\t\tswitch (err.name) {\n\t\t\tcase files.FileSystemProviderErrorCode.FileExists: throw FileSystemError.FileExists(err.message);\n\t\t\tcase files.FileSystemProviderErrorCode.FileNotFound: throw FileSystemError.FileNotFound(err.message);\n\t\t\tcase files.FileSystemProviderErrorCode.FileNotADirectory: throw FileSystemError.FileNotADirectory(err.message);\n\t\t\tcase files.FileSystemProviderErrorCode.FileIsADirectory: throw FileSystemError.FileIsADirectory(err.message);\n\t\t\tcase files.FileSystemProviderErrorCode.NoPermissions: throw FileSystemError.NoPermissions(err.message);\n\t\t\tcase files.FileSystemProviderErrorCode.Unavailable: throw FileSystemError.Unavailable(err.message);\n\n\t\t\tdefault: throw new FileSystemError(err.message, err.name as files.FileSystemProviderErrorCode);\n\t\t}\n\t}\n}\n\nexport interface IExtHostConsumerFileSystem extends ExtHostConsumerFileSystem { }\nexport const IExtHostConsumerFileSystem = createDecorator<IExtHostConsumerFileSystem>('IExtHostConsumerFileSystem');\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ResourceLabelFormatter } from 'vs/platform/label/common/label';\nimport { IDisposable, toDisposable } from 'vs/base/common/lifecycle';\nimport { MainThreadLabelServiceShape, ExtHostLabelServiceShape, MainContext, IMainContext } from 'vs/workbench/api/common/extHost.protocol';\n\nexport class ExtHostLabelService implements ExtHostLabelServiceShape {\n\n\tprivate readonly _proxy: MainThreadLabelServiceShape;\n\tprivate _handlePool: number = 0;\n\n\tconstructor(mainContext: IMainContext) {\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadLabelService);\n\t}\n\n\t$registerResourceLabelFormatter(formatter: ResourceLabelFormatter): IDisposable {\n\t\tconst handle = this._handlePool++;\n\t\tthis._proxy.$registerResourceLabelFormatter(handle, formatter);\n\n\t\treturn toDisposable(() => {\n\t\t\tthis._proxy.$unregisterResourceLabelFormatter(handle);\n\t\t});\n\t}\n}","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { mixin } from 'vs/base/common/objects';\nimport type * as vscode from 'vscode';\nimport * as typeConvert from 'vs/workbench/api/common/extHostTypeConverters';\nimport { Range, Disposable, CompletionList, SnippetString, CodeActionKind, SymbolInformation, DocumentSymbol, SemanticTokensEdits, SemanticTokens, SemanticTokensEdit } from 'vs/workbench/api/common/extHostTypes';\nimport { ISingleEditOperation } from 'vs/editor/common/model';\nimport * as modes from 'vs/editor/common/modes';\nimport { ExtHostDocuments } from 'vs/workbench/api/common/extHostDocuments';\nimport { ExtHostCommands, CommandsConverter } from 'vs/workbench/api/common/extHostCommands';\nimport { ExtHostDiagnostics } from 'vs/workbench/api/common/extHostDiagnostics';\nimport { asPromise } from 'vs/base/common/async';\nimport * as extHostProtocol from './extHost.protocol';\nimport { regExpLeadsToEndlessLoop, regExpFlags } from 'vs/base/common/strings';\nimport { IPosition } from 'vs/editor/common/core/position';\nimport { IRange, Range as EditorRange } from 'vs/editor/common/core/range';\nimport { isFalsyOrEmpty, isNonEmptyArray, coalesce, asArray } from 'vs/base/common/arrays';\nimport { isObject } from 'vs/base/common/types';\nimport { ISelection, Selection } from 'vs/editor/common/core/selection';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { ExtensionIdentifier, IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { IURITransformer } from 'vs/base/common/uriIpc';\nimport { DisposableStore } from 'vs/base/common/lifecycle';\nimport { VSBuffer } from 'vs/base/common/buffer';\nimport { encodeSemanticTokensDto } from 'vs/editor/common/services/semanticTokensDto';\nimport { IdGenerator } from 'vs/base/common/idGenerator';\nimport { IExtHostApiDeprecationService } from 'vs/workbench/api/common/extHostApiDeprecationService';\nimport { Cache } from './cache';\nimport { StopWatch } from 'vs/base/common/stopwatch';\nimport { CancellationError } from 'vs/base/common/errors';\n\n// --- adapter\n\nclass DocumentSymbolAdapter {\n\n\tprivate _documents: ExtHostDocuments;\n\tprivate _provider: vscode.DocumentSymbolProvider;\n\n\tconstructor(documents: ExtHostDocuments, provider: vscode.DocumentSymbolProvider) {\n\t\tthis._documents = documents;\n\t\tthis._provider = provider;\n\t}\n\n\tprovideDocumentSymbols(resource: URI, token: CancellationToken): Promise<modes.DocumentSymbol[] | undefined> {\n\t\tconst doc = this._documents.getDocument(resource);\n\t\treturn asPromise(() => this._provider.provideDocumentSymbols(doc, token)).then(value => {\n\t\t\tif (isFalsyOrEmpty(value)) {\n\t\t\t\treturn undefined;\n\t\t\t} else if (value![0] instanceof DocumentSymbol) {\n\t\t\t\treturn (<DocumentSymbol[]>value).map(typeConvert.DocumentSymbol.from);\n\t\t\t} else {\n\t\t\t\treturn DocumentSymbolAdapter._asDocumentSymbolTree(<SymbolInformation[]>value);\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate static _asDocumentSymbolTree(infos: SymbolInformation[]): modes.DocumentSymbol[] {\n\t\t// first sort by start (and end) and then loop over all elements\n\t\t// and build a tree based on containment.\n\t\tinfos = infos.slice(0).sort((a, b) => {\n\t\t\tlet res = a.location.range.start.compareTo(b.location.range.start);\n\t\t\tif (res === 0) {\n\t\t\t\tres = b.location.range.end.compareTo(a.location.range.end);\n\t\t\t}\n\t\t\treturn res;\n\t\t});\n\t\tconst res: modes.DocumentSymbol[] = [];\n\t\tconst parentStack: modes.DocumentSymbol[] = [];\n\t\tfor (const info of infos) {\n\t\t\tconst element: modes.DocumentSymbol = {\n\t\t\t\tname: info.name || '!!MISSING: name!!',\n\t\t\t\tkind: typeConvert.SymbolKind.from(info.kind),\n\t\t\t\ttags: info.tags?.map(typeConvert.SymbolTag.from) || [],\n\t\t\t\tdetail: '',\n\t\t\t\tcontainerName: info.containerName,\n\t\t\t\trange: typeConvert.Range.from(info.location.range),\n\t\t\t\tselectionRange: typeConvert.Range.from(info.location.range),\n\t\t\t\tchildren: []\n\t\t\t};\n\n\t\t\twhile (true) {\n\t\t\t\tif (parentStack.length === 0) {\n\t\t\t\t\tparentStack.push(element);\n\t\t\t\t\tres.push(element);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tconst parent = parentStack[parentStack.length - 1];\n\t\t\t\tif (EditorRange.containsRange(parent.range, element.range) && !EditorRange.equalsRange(parent.range, element.range)) {\n\t\t\t\t\tif (parent.children) {\n\t\t\t\t\t\tparent.children.push(element);\n\t\t\t\t\t}\n\t\t\t\t\tparentStack.push(element);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tparentStack.pop();\n\t\t\t}\n\t\t}\n\t\treturn res;\n\t}\n}\n\nclass CodeLensAdapter {\n\n\tprivate static _badCmd: vscode.Command = { command: 'missing', title: '!!MISSING: command!!' };\n\n\tprivate readonly _cache = new Cache<vscode.CodeLens>('CodeLens');\n\tprivate readonly _disposables = new Map<number, DisposableStore>();\n\n\tconstructor(\n\t\tprivate readonly _documents: ExtHostDocuments,\n\t\tprivate readonly _commands: CommandsConverter,\n\t\tprivate readonly _provider: vscode.CodeLensProvider\n\t) { }\n\n\tasync provideCodeLenses(resource: URI, token: CancellationToken): Promise<extHostProtocol.ICodeLensListDto | undefined> {\n\t\tconst doc = this._documents.getDocument(resource);\n\n\t\tconst lenses = await this._provider.provideCodeLenses(doc, token);\n\t\tif (!lenses || token.isCancellationRequested) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst cacheId = this._cache.add(lenses);\n\t\tconst disposables = new DisposableStore();\n\t\tthis._disposables.set(cacheId, disposables);\n\t\tconst result: extHostProtocol.ICodeLensListDto = {\n\t\t\tcacheId,\n\t\t\tlenses: [],\n\t\t};\n\t\tfor (let i = 0; i < lenses.length; i++) {\n\t\t\tresult.lenses.push({\n\t\t\t\tcacheId: [cacheId, i],\n\t\t\t\trange: typeConvert.Range.from(lenses[i].range),\n\t\t\t\tcommand: this._commands.toInternal(lenses[i].command, disposables)\n\t\t\t});\n\t\t}\n\t\treturn result;\n\t}\n\n\tasync resolveCodeLens(symbol: extHostProtocol.ICodeLensDto, token: CancellationToken): Promise<extHostProtocol.ICodeLensDto | undefined> {\n\n\t\tconst lens = symbol.cacheId && this._cache.get(...symbol.cacheId);\n\t\tif (!lens) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tlet resolvedLens: vscode.CodeLens | undefined | null;\n\t\tif (typeof this._provider.resolveCodeLens !== 'function' || lens.isResolved) {\n\t\t\tresolvedLens = lens;\n\t\t} else {\n\t\t\tresolvedLens = await this._provider.resolveCodeLens(lens, token);\n\t\t}\n\t\tif (!resolvedLens) {\n\t\t\tresolvedLens = lens;\n\t\t}\n\n\t\tif (token.isCancellationRequested) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst disposables = symbol.cacheId && this._disposables.get(symbol.cacheId[0]);\n\t\tif (!disposables) {\n\t\t\t// disposed in the meantime\n\t\t\treturn undefined;\n\t\t}\n\t\tsymbol.command = this._commands.toInternal(resolvedLens.command ?? CodeLensAdapter._badCmd, disposables);\n\t\treturn symbol;\n\t}\n\n\treleaseCodeLenses(cachedId: number): void {\n\t\tthis._disposables.get(cachedId)?.dispose();\n\t\tthis._disposables.delete(cachedId);\n\t\tthis._cache.delete(cachedId);\n\t}\n}\n\nfunction convertToLocationLinks(value: vscode.Location | vscode.Location[] | vscode.LocationLink[] | undefined | null): modes.LocationLink[] {\n\tif (Array.isArray(value)) {\n\t\treturn (<any>value).map(typeConvert.DefinitionLink.from);\n\t} else if (value) {\n\t\treturn [typeConvert.DefinitionLink.from(value)];\n\t}\n\treturn [];\n}\n\nclass DefinitionAdapter {\n\n\tconstructor(\n\t\tprivate readonly _documents: ExtHostDocuments,\n\t\tprivate readonly _provider: vscode.DefinitionProvider\n\t) { }\n\n\tprovideDefinition(resource: URI, position: IPosition, token: CancellationToken): Promise<modes.LocationLink[]> {\n\t\tconst doc = this._documents.getDocument(resource);\n\t\tconst pos = typeConvert.Position.to(position);\n\t\treturn asPromise(() => this._provider.provideDefinition(doc, pos, token)).then(convertToLocationLinks);\n\t}\n}\n\nclass DeclarationAdapter {\n\n\tconstructor(\n\t\tprivate readonly _documents: ExtHostDocuments,\n\t\tprivate readonly _provider: vscode.DeclarationProvider\n\t) { }\n\n\tprovideDeclaration(resource: URI, position: IPosition, token: CancellationToken): Promise<modes.LocationLink[]> {\n\t\tconst doc = this._documents.getDocument(resource);\n\t\tconst pos = typeConvert.Position.to(position);\n\t\treturn asPromise(() => this._provider.provideDeclaration(doc, pos, token)).then(convertToLocationLinks);\n\t}\n}\n\nclass ImplementationAdapter {\n\n\tconstructor(\n\t\tprivate readonly _documents: ExtHostDocuments,\n\t\tprivate readonly _provider: vscode.ImplementationProvider\n\t) { }\n\n\tprovideImplementation(resource: URI, position: IPosition, token: CancellationToken): Promise<modes.LocationLink[]> {\n\t\tconst doc = this._documents.getDocument(resource);\n\t\tconst pos = typeConvert.Position.to(position);\n\t\treturn asPromise(() => this._provider.provideImplementation(doc, pos, token)).then(convertToLocationLinks);\n\t}\n}\n\nclass TypeDefinitionAdapter {\n\n\tconstructor(\n\t\tprivate readonly _documents: ExtHostDocuments,\n\t\tprivate readonly _provider: vscode.TypeDefinitionProvider\n\t) { }\n\n\tprovideTypeDefinition(resource: URI, position: IPosition, token: CancellationToken): Promise<modes.LocationLink[]> {\n\t\tconst doc = this._documents.getDocument(resource);\n\t\tconst pos = typeConvert.Position.to(position);\n\t\treturn asPromise(() => this._provider.provideTypeDefinition(doc, pos, token)).then(convertToLocationLinks);\n\t}\n}\n\nclass HoverAdapter {\n\n\tconstructor(\n\t\tprivate readonly _documents: ExtHostDocuments,\n\t\tprivate readonly _provider: vscode.HoverProvider,\n\t) { }\n\n\tpublic provideHover(resource: URI, position: IPosition, token: CancellationToken): Promise<modes.Hover | undefined> {\n\n\t\tconst doc = this._documents.getDocument(resource);\n\t\tconst pos = typeConvert.Position.to(position);\n\n\t\treturn asPromise(() => this._provider.provideHover(doc, pos, token)).then(value => {\n\t\t\tif (!value || isFalsyOrEmpty(value.contents)) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tif (!value.range) {\n\t\t\t\tvalue.range = doc.getWordRangeAtPosition(pos);\n\t\t\t}\n\t\t\tif (!value.range) {\n\t\t\t\tvalue.range = new Range(pos, pos);\n\t\t\t}\n\n\t\t\treturn typeConvert.Hover.from(value);\n\t\t});\n\t}\n}\n\nclass EvaluatableExpressionAdapter {\n\n\tconstructor(\n\t\tprivate readonly _documents: ExtHostDocuments,\n\t\tprivate readonly _provider: vscode.EvaluatableExpressionProvider,\n\t) { }\n\n\tpublic provideEvaluatableExpression(resource: URI, position: IPosition, token: CancellationToken): Promise<modes.EvaluatableExpression | undefined> {\n\n\t\tconst doc = this._documents.getDocument(resource);\n\t\tconst pos = typeConvert.Position.to(position);\n\n\t\treturn asPromise(() => this._provider.provideEvaluatableExpression(doc, pos, token)).then(value => {\n\t\t\tif (value) {\n\t\t\t\treturn typeConvert.EvaluatableExpression.from(value);\n\t\t\t}\n\t\t\treturn undefined;\n\t\t});\n\t}\n}\n\nclass DocumentHighlightAdapter {\n\n\tconstructor(\n\t\tprivate readonly _documents: ExtHostDocuments,\n\t\tprivate readonly _provider: vscode.DocumentHighlightProvider\n\t) { }\n\n\tprovideDocumentHighlights(resource: URI, position: IPosition, token: CancellationToken): Promise<modes.DocumentHighlight[] | undefined> {\n\n\t\tconst doc = this._documents.getDocument(resource);\n\t\tconst pos = typeConvert.Position.to(position);\n\n\t\treturn asPromise(() => this._provider.provideDocumentHighlights(doc, pos, token)).then(value => {\n\t\t\tif (Array.isArray(value)) {\n\t\t\t\treturn value.map(typeConvert.DocumentHighlight.from);\n\t\t\t}\n\t\t\treturn undefined;\n\t\t});\n\t}\n}\n\nclass LinkedEditingRangeAdapter {\n\tconstructor(\n\t\tprivate readonly _documents: ExtHostDocuments,\n\t\tprivate readonly _provider: vscode.LinkedEditingRangeProvider\n\t) { }\n\n\tprovideLinkedEditingRanges(resource: URI, position: IPosition, token: CancellationToken): Promise<modes.LinkedEditingRanges | undefined> {\n\n\t\tconst doc = this._documents.getDocument(resource);\n\t\tconst pos = typeConvert.Position.to(position);\n\n\t\treturn asPromise(() => this._provider.provideLinkedEditingRanges(doc, pos, token)).then(value => {\n\t\t\tif (value && Array.isArray(value.ranges)) {\n\t\t\t\treturn {\n\t\t\t\t\tranges: coalesce(value.ranges.map(typeConvert.Range.from)),\n\t\t\t\t\twordPattern: value.wordPattern\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn undefined;\n\t\t});\n\t}\n}\n\nclass ReferenceAdapter {\n\n\tconstructor(\n\t\tprivate readonly _documents: ExtHostDocuments,\n\t\tprivate readonly _provider: vscode.ReferenceProvider\n\t) { }\n\n\tprovideReferences(resource: URI, position: IPosition, context: modes.ReferenceContext, token: CancellationToken): Promise<modes.Location[] | undefined> {\n\t\tconst doc = this._documents.getDocument(resource);\n\t\tconst pos = typeConvert.Position.to(position);\n\n\t\treturn asPromise(() => this._provider.provideReferences(doc, pos, context, token)).then(value => {\n\t\t\tif (Array.isArray(value)) {\n\t\t\t\treturn value.map(typeConvert.location.from);\n\t\t\t}\n\t\t\treturn undefined;\n\t\t});\n\t}\n}\n\nexport interface CustomCodeAction extends extHostProtocol.ICodeActionDto {\n\t_isSynthetic?: boolean;\n}\n\nclass CodeActionAdapter {\n\tprivate static readonly _maxCodeActionsPerFile: number = 1000;\n\n\tprivate readonly _cache = new Cache<vscode.CodeAction | vscode.Command>('CodeAction');\n\tprivate readonly _disposables = new Map<number, DisposableStore>();\n\n\tconstructor(\n\t\tprivate readonly _documents: ExtHostDocuments,\n\t\tprivate readonly _commands: CommandsConverter,\n\t\tprivate readonly _diagnostics: ExtHostDiagnostics,\n\t\tprivate readonly _provider: vscode.CodeActionProvider,\n\t\tprivate readonly _logService: ILogService,\n\t\tprivate readonly _extension: IExtensionDescription,\n\t\tprivate readonly _apiDeprecation: IExtHostApiDeprecationService,\n\t) { }\n\n\tprovideCodeActions(resource: URI, rangeOrSelection: IRange | ISelection, context: modes.CodeActionContext, token: CancellationToken): Promise<extHostProtocol.ICodeActionListDto | undefined> {\n\n\t\tconst doc = this._documents.getDocument(resource);\n\t\tconst ran = Selection.isISelection(rangeOrSelection)\n\t\t\t? <vscode.Selection>typeConvert.Selection.to(rangeOrSelection)\n\t\t\t: <vscode.Range>typeConvert.Range.to(rangeOrSelection);\n\t\tconst allDiagnostics: vscode.Diagnostic[] = [];\n\n\t\tfor (const diagnostic of this._diagnostics.getDiagnostics(resource)) {\n\t\t\tif (ran.intersection(diagnostic.range)) {\n\t\t\t\tconst newLen = allDiagnostics.push(diagnostic);\n\t\t\t\tif (newLen > CodeActionAdapter._maxCodeActionsPerFile) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst codeActionContext: vscode.CodeActionContext = {\n\t\t\tdiagnostics: allDiagnostics,\n\t\t\tonly: context.only ? new CodeActionKind(context.only) : undefined\n\t\t};\n\n\t\treturn asPromise(() => this._provider.provideCodeActions(doc, ran, codeActionContext, token)).then((commandsOrActions): extHostProtocol.ICodeActionListDto | undefined => {\n\t\t\tif (!isNonEmptyArray(commandsOrActions) || token.isCancellationRequested) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\tconst cacheId = this._cache.add(commandsOrActions);\n\t\t\tconst disposables = new DisposableStore();\n\t\t\tthis._disposables.set(cacheId, disposables);\n\n\t\t\tconst actions: CustomCodeAction[] = [];\n\t\t\tfor (let i = 0; i < commandsOrActions.length; i++) {\n\t\t\t\tconst candidate = commandsOrActions[i];\n\t\t\t\tif (!candidate) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (CodeActionAdapter._isCommand(candidate)) {\n\t\t\t\t\t// old school: synthetic code action\n\n\t\t\t\t\tthis._apiDeprecation.report('CodeActionProvider.provideCodeActions - return commands', this._extension,\n\t\t\t\t\t\t`Return 'CodeAction' instances instead.`);\n\n\t\t\t\t\tactions.push({\n\t\t\t\t\t\t_isSynthetic: true,\n\t\t\t\t\t\ttitle: candidate.title,\n\t\t\t\t\t\tcommand: this._commands.toInternal(candidate, disposables),\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tif (codeActionContext.only) {\n\t\t\t\t\t\tif (!candidate.kind) {\n\t\t\t\t\t\t\tthis._logService.warn(`${this._extension.identifier.value} - Code actions of kind '${codeActionContext.only.value} 'requested but returned code action does not have a 'kind'. Code action will be dropped. Please set 'CodeAction.kind'.`);\n\t\t\t\t\t\t} else if (!codeActionContext.only.contains(candidate.kind)) {\n\t\t\t\t\t\t\tthis._logService.warn(`${this._extension.identifier.value} - Code actions of kind '${codeActionContext.only.value} 'requested but returned code action is of kind '${candidate.kind.value}'. Code action will be dropped. Please check 'CodeActionContext.only' to only return requested code actions.`);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// new school: convert code action\n\t\t\t\t\tactions.push({\n\t\t\t\t\t\tcacheId: [cacheId, i],\n\t\t\t\t\t\ttitle: candidate.title,\n\t\t\t\t\t\tcommand: candidate.command && this._commands.toInternal(candidate.command, disposables),\n\t\t\t\t\t\tdiagnostics: candidate.diagnostics && candidate.diagnostics.map(typeConvert.Diagnostic.from),\n\t\t\t\t\t\tedit: candidate.edit && typeConvert.WorkspaceEdit.from(candidate.edit),\n\t\t\t\t\t\tkind: candidate.kind && candidate.kind.value,\n\t\t\t\t\t\tisPreferred: candidate.isPreferred,\n\t\t\t\t\t\tdisabled: candidate.disabled?.reason\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn { cacheId, actions };\n\t\t});\n\t}\n\n\tpublic async resolveCodeAction(id: extHostProtocol.ChainedCacheId, token: CancellationToken): Promise<extHostProtocol.IWorkspaceEditDto | undefined> {\n\t\tconst [sessionId, itemId] = id;\n\t\tconst item = this._cache.get(sessionId, itemId);\n\t\tif (!item || CodeActionAdapter._isCommand(item)) {\n\t\t\treturn undefined; // code actions only!\n\t\t}\n\t\tif (!this._provider.resolveCodeAction) {\n\t\t\treturn; // this should not happen...\n\t\t}\n\t\tconst resolvedItem = (await this._provider.resolveCodeAction(item, token)) ?? item;\n\t\treturn resolvedItem?.edit\n\t\t\t? typeConvert.WorkspaceEdit.from(resolvedItem.edit)\n\t\t\t: undefined;\n\t}\n\n\tpublic releaseCodeActions(cachedId: number): void {\n\t\tthis._disposables.get(cachedId)?.dispose();\n\t\tthis._disposables.delete(cachedId);\n\t\tthis._cache.delete(cachedId);\n\t}\n\n\tprivate static _isCommand(thing: any): thing is vscode.Command {\n\t\treturn typeof (<vscode.Command>thing).command === 'string' && typeof (<vscode.Command>thing).title === 'string';\n\t}\n}\n\nclass DocumentFormattingAdapter {\n\n\tconstructor(\n\t\tprivate readonly _documents: ExtHostDocuments,\n\t\tprivate readonly _provider: vscode.DocumentFormattingEditProvider\n\t) { }\n\n\tprovideDocumentFormattingEdits(resource: URI, options: modes.FormattingOptions, token: CancellationToken): Promise<ISingleEditOperation[] | undefined> {\n\n\t\tconst document = this._documents.getDocument(resource);\n\n\t\treturn asPromise(() => this._provider.provideDocumentFormattingEdits(document, <any>options, token)).then(value => {\n\t\t\tif (Array.isArray(value)) {\n\t\t\t\treturn value.map(typeConvert.TextEdit.from);\n\t\t\t}\n\t\t\treturn undefined;\n\t\t});\n\t}\n}\n\nclass RangeFormattingAdapter {\n\n\tconstructor(\n\t\tprivate readonly _documents: ExtHostDocuments,\n\t\tprivate readonly _provider: vscode.DocumentRangeFormattingEditProvider\n\t) { }\n\n\tprovideDocumentRangeFormattingEdits(resource: URI, range: IRange, options: modes.FormattingOptions, token: CancellationToken): Promise<ISingleEditOperation[] | undefined> {\n\n\t\tconst document = this._documents.getDocument(resource);\n\t\tconst ran = typeConvert.Range.to(range);\n\n\t\treturn asPromise(() => this._provider.provideDocumentRangeFormattingEdits(document, ran, <any>options, token)).then(value => {\n\t\t\tif (Array.isArray(value)) {\n\t\t\t\treturn value.map(typeConvert.TextEdit.from);\n\t\t\t}\n\t\t\treturn undefined;\n\t\t});\n\t}\n}\n\nclass OnTypeFormattingAdapter {\n\n\tconstructor(\n\t\tprivate readonly _documents: ExtHostDocuments,\n\t\tprivate readonly _provider: vscode.OnTypeFormattingEditProvider\n\t) { }\n\n\tautoFormatTriggerCharacters: string[] = []; // not here\n\n\tprovideOnTypeFormattingEdits(resource: URI, position: IPosition, ch: string, options: modes.FormattingOptions, token: CancellationToken): Promise<ISingleEditOperation[] | undefined> {\n\n\t\tconst document = this._documents.getDocument(resource);\n\t\tconst pos = typeConvert.Position.to(position);\n\n\t\treturn asPromise(() => this._provider.provideOnTypeFormattingEdits(document, pos, ch, <any>options, token)).then(value => {\n\t\t\tif (Array.isArray(value)) {\n\t\t\t\treturn value.map(typeConvert.TextEdit.from);\n\t\t\t}\n\t\t\treturn undefined;\n\t\t});\n\t}\n}\n\nclass NavigateTypeAdapter {\n\n\tprivate readonly _symbolCache = new Map<number, vscode.SymbolInformation>();\n\tprivate readonly _resultCache = new Map<number, [number, number]>();\n\n\tconstructor(\n\t\tprivate readonly _provider: vscode.WorkspaceSymbolProvider,\n\t\tprivate readonly _logService: ILogService\n\t) { }\n\n\tprovideWorkspaceSymbols(search: string, token: CancellationToken): Promise<extHostProtocol.IWorkspaceSymbolsDto> {\n\t\tconst result: extHostProtocol.IWorkspaceSymbolsDto = extHostProtocol.IdObject.mixin({ symbols: [] });\n\t\treturn asPromise(() => this._provider.provideWorkspaceSymbols(search, token)).then(value => {\n\t\t\tif (isNonEmptyArray(value)) {\n\t\t\t\tfor (const item of value) {\n\t\t\t\t\tif (!item) {\n\t\t\t\t\t\t// drop\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tif (!item.name) {\n\t\t\t\t\t\tthis._logService.warn('INVALID SymbolInformation, lacks name', item);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tconst symbol = extHostProtocol.IdObject.mixin(typeConvert.WorkspaceSymbol.from(item));\n\t\t\t\t\tthis._symbolCache.set(symbol._id!, item);\n\t\t\t\t\tresult.symbols.push(symbol);\n\t\t\t\t}\n\t\t\t}\n\t\t}).then(() => {\n\t\t\tif (result.symbols.length > 0) {\n\t\t\t\tthis._resultCache.set(result._id!, [result.symbols[0]._id!, result.symbols[result.symbols.length - 1]._id!]);\n\t\t\t}\n\t\t\treturn result;\n\t\t});\n\t}\n\n\tasync resolveWorkspaceSymbol(symbol: extHostProtocol.IWorkspaceSymbolDto, token: CancellationToken): Promise<extHostProtocol.IWorkspaceSymbolDto | undefined> {\n\t\tif (typeof this._provider.resolveWorkspaceSymbol !== 'function') {\n\t\t\treturn symbol;\n\t\t}\n\n\t\tconst item = this._symbolCache.get(symbol._id!);\n\t\tif (item) {\n\t\t\tconst value = await asPromise(() => this._provider.resolveWorkspaceSymbol!(item, token));\n\t\t\treturn value && mixin(symbol, typeConvert.WorkspaceSymbol.from(value), true);\n\t\t}\n\t\treturn undefined;\n\t}\n\n\treleaseWorkspaceSymbols(id: number): any {\n\t\tconst range = this._resultCache.get(id);\n\t\tif (range) {\n\t\t\tfor (let [from, to] = range; from <= to; from++) {\n\t\t\t\tthis._symbolCache.delete(from);\n\t\t\t}\n\t\t\tthis._resultCache.delete(id);\n\t\t}\n\t}\n}\n\nclass RenameAdapter {\n\n\tstatic supportsResolving(provider: vscode.RenameProvider): boolean {\n\t\treturn typeof provider.prepareRename === 'function';\n\t}\n\n\tconstructor(\n\t\tprivate readonly _documents: ExtHostDocuments,\n\t\tprivate readonly _provider: vscode.RenameProvider,\n\t\tprivate readonly _logService: ILogService\n\t) { }\n\n\tprovideRenameEdits(resource: URI, position: IPosition, newName: string, token: CancellationToken): Promise<extHostProtocol.IWorkspaceEditDto | undefined> {\n\n\t\tconst doc = this._documents.getDocument(resource);\n\t\tconst pos = typeConvert.Position.to(position);\n\n\t\treturn asPromise(() => this._provider.provideRenameEdits(doc, pos, newName, token)).then(value => {\n\t\t\tif (!value) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\treturn typeConvert.WorkspaceEdit.from(value);\n\t\t}, err => {\n\t\t\tconst rejectReason = RenameAdapter._asMessage(err);\n\t\t\tif (rejectReason) {\n\t\t\t\treturn <extHostProtocol.IWorkspaceEditDto>{ rejectReason, edits: undefined! };\n\t\t\t} else {\n\t\t\t\t// generic error\n\t\t\t\treturn Promise.reject<extHostProtocol.IWorkspaceEditDto>(err);\n\t\t\t}\n\t\t});\n\t}\n\n\tresolveRenameLocation(resource: URI, position: IPosition, token: CancellationToken): Promise<(modes.RenameLocation & modes.Rejection) | undefined> {\n\t\tif (typeof this._provider.prepareRename !== 'function') {\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\n\t\tconst doc = this._documents.getDocument(resource);\n\t\tconst pos = typeConvert.Position.to(position);\n\n\t\treturn asPromise(() => this._provider.prepareRename!(doc, pos, token)).then(rangeOrLocation => {\n\n\t\t\tlet range: vscode.Range | undefined;\n\t\t\tlet text: string | undefined;\n\t\t\tif (Range.isRange(rangeOrLocation)) {\n\t\t\t\trange = rangeOrLocation;\n\t\t\t\ttext = doc.getText(rangeOrLocation);\n\n\t\t\t} else if (isObject(rangeOrLocation)) {\n\t\t\t\trange = rangeOrLocation.range;\n\t\t\t\ttext = rangeOrLocation.placeholder;\n\t\t\t}\n\n\t\t\tif (!range) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tif (range.start.line > pos.line || range.end.line < pos.line) {\n\t\t\t\tthis._logService.warn('INVALID rename location: position line must be within range start/end lines');\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\treturn { range: typeConvert.Range.from(range), text };\n\t\t}, err => {\n\t\t\tconst rejectReason = RenameAdapter._asMessage(err);\n\t\t\tif (rejectReason) {\n\t\t\t\treturn <modes.RenameLocation & modes.Rejection>{ rejectReason, range: undefined!, text: undefined! };\n\t\t\t} else {\n\t\t\t\treturn Promise.reject<any>(err);\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate static _asMessage(err: any): string | undefined {\n\t\tif (typeof err === 'string') {\n\t\t\treturn err;\n\t\t} else if (err instanceof Error && typeof err.message === 'string') {\n\t\t\treturn err.message;\n\t\t} else {\n\t\t\treturn undefined;\n\t\t}\n\t}\n}\n\nclass SemanticTokensPreviousResult {\n\tconstructor(\n\t\tpublic readonly resultId: string | undefined,\n\t\tpublic readonly tokens?: Uint32Array,\n\t) { }\n}\n\ntype RelaxedSemanticTokens = { readonly resultId?: string; readonly data: number[]; };\ntype RelaxedSemanticTokensEdit = { readonly start: number; readonly deleteCount: number; readonly data?: number[]; };\ntype RelaxedSemanticTokensEdits = { readonly resultId?: string; readonly edits: RelaxedSemanticTokensEdit[]; };\n\ntype ProvidedSemanticTokens = vscode.SemanticTokens | RelaxedSemanticTokens;\ntype ProvidedSemanticTokensEdits = vscode.SemanticTokensEdits | RelaxedSemanticTokensEdits;\n\nexport class DocumentSemanticTokensAdapter {\n\n\tprivate readonly _previousResults: Map<number, SemanticTokensPreviousResult>;\n\tprivate _nextResultId = 1;\n\n\tconstructor(\n\t\tprivate readonly _documents: ExtHostDocuments,\n\t\tprivate readonly _provider: vscode.DocumentSemanticTokensProvider,\n\t) {\n\t\tthis._previousResults = new Map<number, SemanticTokensPreviousResult>();\n\t}\n\n\tprovideDocumentSemanticTokens(resource: URI, previousResultId: number, token: CancellationToken): Promise<VSBuffer | null> {\n\t\tconst doc = this._documents.getDocument(resource);\n\t\tconst previousResult = (previousResultId !== 0 ? this._previousResults.get(previousResultId) : null);\n\t\treturn asPromise(() => {\n\t\t\tif (previousResult && typeof previousResult.resultId === 'string' && typeof this._provider.provideDocumentSemanticTokensEdits === 'function') {\n\t\t\t\treturn this._provider.provideDocumentSemanticTokensEdits(doc, previousResult.resultId, token);\n\t\t\t}\n\t\t\treturn this._provider.provideDocumentSemanticTokens(doc, token);\n\t\t}).then((value: ProvidedSemanticTokens | ProvidedSemanticTokensEdits | null | undefined) => {\n\t\t\tif (previousResult) {\n\t\t\t\tthis._previousResults.delete(previousResultId);\n\t\t\t}\n\t\t\tif (!value) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tvalue = DocumentSemanticTokensAdapter._fixProvidedSemanticTokens(value);\n\t\t\treturn this._send(DocumentSemanticTokensAdapter._convertToEdits(previousResult, value), value);\n\t\t});\n\t}\n\n\tasync releaseDocumentSemanticColoring(semanticColoringResultId: number): Promise<void> {\n\t\tthis._previousResults.delete(semanticColoringResultId);\n\t}\n\n\tprivate static _fixProvidedSemanticTokens(v: ProvidedSemanticTokens | ProvidedSemanticTokensEdits): vscode.SemanticTokens | vscode.SemanticTokensEdits {\n\t\tif (DocumentSemanticTokensAdapter._isSemanticTokens(v)) {\n\t\t\tif (DocumentSemanticTokensAdapter._isCorrectSemanticTokens(v)) {\n\t\t\t\treturn v;\n\t\t\t}\n\t\t\treturn new SemanticTokens(new Uint32Array(v.data), v.resultId);\n\t\t} else if (DocumentSemanticTokensAdapter._isSemanticTokensEdits(v)) {\n\t\t\tif (DocumentSemanticTokensAdapter._isCorrectSemanticTokensEdits(v)) {\n\t\t\t\treturn v;\n\t\t\t}\n\t\t\treturn new SemanticTokensEdits(v.edits.map(edit => new SemanticTokensEdit(edit.start, edit.deleteCount, edit.data ? new Uint32Array(edit.data) : edit.data)), v.resultId);\n\t\t}\n\t\treturn v;\n\t}\n\n\tprivate static _isSemanticTokens(v: ProvidedSemanticTokens | ProvidedSemanticTokensEdits): v is ProvidedSemanticTokens {\n\t\treturn v && !!((v as ProvidedSemanticTokens).data);\n\t}\n\n\tprivate static _isCorrectSemanticTokens(v: ProvidedSemanticTokens): v is vscode.SemanticTokens {\n\t\treturn (v.data instanceof Uint32Array);\n\t}\n\n\tprivate static _isSemanticTokensEdits(v: ProvidedSemanticTokens | ProvidedSemanticTokensEdits): v is ProvidedSemanticTokensEdits {\n\t\treturn v && Array.isArray((v as ProvidedSemanticTokensEdits).edits);\n\t}\n\n\tprivate static _isCorrectSemanticTokensEdits(v: ProvidedSemanticTokensEdits): v is vscode.SemanticTokensEdits {\n\t\tfor (const edit of v.edits) {\n\t\t\tif (!(edit.data instanceof Uint32Array)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\tprivate static _convertToEdits(previousResult: SemanticTokensPreviousResult | null | undefined, newResult: vscode.SemanticTokens | vscode.SemanticTokensEdits): vscode.SemanticTokens | vscode.SemanticTokensEdits {\n\t\tif (!DocumentSemanticTokensAdapter._isSemanticTokens(newResult)) {\n\t\t\treturn newResult;\n\t\t}\n\t\tif (!previousResult || !previousResult.tokens) {\n\t\t\treturn newResult;\n\t\t}\n\t\tconst oldData = previousResult.tokens;\n\t\tconst oldLength = oldData.length;\n\t\tconst newData = newResult.data;\n\t\tconst newLength = newData.length;\n\n\t\tlet commonPrefixLength = 0;\n\t\tconst maxCommonPrefixLength = Math.min(oldLength, newLength);\n\t\twhile (commonPrefixLength < maxCommonPrefixLength && oldData[commonPrefixLength] === newData[commonPrefixLength]) {\n\t\t\tcommonPrefixLength++;\n\t\t}\n\n\t\tif (commonPrefixLength === oldLength && commonPrefixLength === newLength) {\n\t\t\t// complete overlap!\n\t\t\treturn new SemanticTokensEdits([], newResult.resultId);\n\t\t}\n\n\t\tlet commonSuffixLength = 0;\n\t\tconst maxCommonSuffixLength = maxCommonPrefixLength - commonPrefixLength;\n\t\twhile (commonSuffixLength < maxCommonSuffixLength && oldData[oldLength - commonSuffixLength - 1] === newData[newLength - commonSuffixLength - 1]) {\n\t\t\tcommonSuffixLength++;\n\t\t}\n\n\t\treturn new SemanticTokensEdits([{\n\t\t\tstart: commonPrefixLength,\n\t\t\tdeleteCount: (oldLength - commonPrefixLength - commonSuffixLength),\n\t\t\tdata: newData.subarray(commonPrefixLength, newLength - commonSuffixLength)\n\t\t}], newResult.resultId);\n\t}\n\n\tprivate _send(value: vscode.SemanticTokens | vscode.SemanticTokensEdits, original: vscode.SemanticTokens | vscode.SemanticTokensEdits): VSBuffer | null {\n\t\tif (DocumentSemanticTokensAdapter._isSemanticTokens(value)) {\n\t\t\tconst myId = this._nextResultId++;\n\t\t\tthis._previousResults.set(myId, new SemanticTokensPreviousResult(value.resultId, value.data));\n\t\t\treturn encodeSemanticTokensDto({\n\t\t\t\tid: myId,\n\t\t\t\ttype: 'full',\n\t\t\t\tdata: value.data\n\t\t\t});\n\t\t}\n\n\t\tif (DocumentSemanticTokensAdapter._isSemanticTokensEdits(value)) {\n\t\t\tconst myId = this._nextResultId++;\n\t\t\tif (DocumentSemanticTokensAdapter._isSemanticTokens(original)) {\n\t\t\t\t// store the original\n\t\t\t\tthis._previousResults.set(myId, new SemanticTokensPreviousResult(original.resultId, original.data));\n\t\t\t} else {\n\t\t\t\tthis._previousResults.set(myId, new SemanticTokensPreviousResult(value.resultId));\n\t\t\t}\n\t\t\treturn encodeSemanticTokensDto({\n\t\t\t\tid: myId,\n\t\t\t\ttype: 'delta',\n\t\t\t\tdeltas: (value.edits || []).map(edit => ({ start: edit.start, deleteCount: edit.deleteCount, data: edit.data }))\n\t\t\t});\n\t\t}\n\n\t\treturn null;\n\t}\n}\n\nexport class DocumentRangeSemanticTokensAdapter {\n\n\tconstructor(\n\t\tprivate readonly _documents: ExtHostDocuments,\n\t\tprivate readonly _provider: vscode.DocumentRangeSemanticTokensProvider,\n\t) {\n\t}\n\n\tprovideDocumentRangeSemanticTokens(resource: URI, range: IRange, token: CancellationToken): Promise<VSBuffer | null> {\n\t\tconst doc = this._documents.getDocument(resource);\n\t\treturn asPromise(() => this._provider.provideDocumentRangeSemanticTokens(doc, typeConvert.Range.to(range), token)).then(value => {\n\t\t\tif (!value) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\treturn this._send(value);\n\t\t});\n\t}\n\n\tprivate _send(value: vscode.SemanticTokens): VSBuffer | null {\n\t\treturn encodeSemanticTokensDto({\n\t\t\tid: 0,\n\t\t\ttype: 'full',\n\t\t\tdata: value.data\n\t\t});\n\t}\n}\n\nclass SuggestAdapter {\n\n\tstatic supportsResolving(provider: vscode.CompletionItemProvider): boolean {\n\t\treturn typeof provider.resolveCompletionItem === 'function';\n\t}\n\n\tprivate _cache = new Cache<vscode.CompletionItem>('CompletionItem');\n\tprivate _disposables = new Map<number, DisposableStore>();\n\n\tconstructor(\n\t\tprivate readonly _documents: ExtHostDocuments,\n\t\tprivate readonly _commands: CommandsConverter,\n\t\tprivate readonly _provider: vscode.CompletionItemProvider,\n\t\tprivate readonly _apiDeprecation: IExtHostApiDeprecationService,\n\t\tprivate readonly _extension: IExtensionDescription,\n\t) { }\n\n\tasync provideCompletionItems(resource: URI, position: IPosition, context: modes.CompletionContext, token: CancellationToken): Promise<extHostProtocol.ISuggestResultDto | undefined> {\n\n\t\tconst doc = this._documents.getDocument(resource);\n\t\tconst pos = typeConvert.Position.to(position);\n\n\t\t// The default insert/replace ranges. It's important to compute them\n\t\t// before asynchronously asking the provider for its results. See\n\t\t// https://github.com/microsoft/vscode/issues/83400#issuecomment-546851421\n\t\tconst replaceRange = doc.getWordRangeAtPosition(pos) || new Range(pos, pos);\n\t\tconst insertRange = replaceRange.with({ end: pos });\n\n\t\tconst sw = new StopWatch(true);\n\t\tconst itemsOrList = await asPromise(() => this._provider.provideCompletionItems(doc, pos, token, typeConvert.CompletionContext.to(context)));\n\n\t\tif (!itemsOrList) {\n\t\t\t// undefined and null are valid results\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (token.isCancellationRequested) {\n\t\t\t// cancelled -> return without further ado, esp no caching\n\t\t\t// of results as they will leak\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst list = Array.isArray(itemsOrList) ? new CompletionList(itemsOrList) : itemsOrList;\n\n\t\t// keep result for providers that support resolving\n\t\tconst pid: number = SuggestAdapter.supportsResolving(this._provider) ? this._cache.add(list.items) : this._cache.add([]);\n\t\tconst disposables = new DisposableStore();\n\t\tthis._disposables.set(pid, disposables);\n\n\t\tconst completions: extHostProtocol.ISuggestDataDto[] = [];\n\t\tconst result: extHostProtocol.ISuggestResultDto = {\n\t\t\tx: pid,\n\t\t\t[extHostProtocol.ISuggestResultDtoField.completions]: completions,\n\t\t\t[extHostProtocol.ISuggestResultDtoField.defaultRanges]: { replace: typeConvert.Range.from(replaceRange), insert: typeConvert.Range.from(insertRange) },\n\t\t\t[extHostProtocol.ISuggestResultDtoField.isIncomplete]: list.isIncomplete || undefined,\n\t\t\t[extHostProtocol.ISuggestResultDtoField.duration]: sw.elapsed()\n\t\t};\n\n\t\tfor (let i = 0; i < list.items.length; i++) {\n\t\t\tconst item = list.items[i];\n\t\t\t// check for bad completion item first\n\t\t\tconst dto = this._convertCompletionItem(item, [pid, i], insertRange, replaceRange);\n\t\t\tcompletions.push(dto);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tasync resolveCompletionItem(id: extHostProtocol.ChainedCacheId, token: CancellationToken): Promise<extHostProtocol.ISuggestDataDto | undefined> {\n\n\t\tif (typeof this._provider.resolveCompletionItem !== 'function') {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst item = this._cache.get(...id);\n\t\tif (!item) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst resolvedItem = await asPromise(() => this._provider.resolveCompletionItem!(item, token));\n\n\t\tif (!resolvedItem) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn this._convertCompletionItem(resolvedItem, id);\n\t}\n\n\treleaseCompletionItems(id: number): any {\n\t\tthis._disposables.get(id)?.dispose();\n\t\tthis._disposables.delete(id);\n\t\tthis._cache.delete(id);\n\t}\n\n\tprivate _convertCompletionItem(item: vscode.CompletionItem, id: extHostProtocol.ChainedCacheId, defaultInsertRange?: vscode.Range, defaultReplaceRange?: vscode.Range): extHostProtocol.ISuggestDataDto {\n\n\t\tconst disposables = this._disposables.get(id[0]);\n\t\tif (!disposables) {\n\t\t\tthrow Error('DisposableStore is missing...');\n\t\t}\n\n\t\tconst result: extHostProtocol.ISuggestDataDto = {\n\t\t\t//\n\t\t\tx: id,\n\t\t\t//\n\t\t\t[extHostProtocol.ISuggestDataDtoField.label]: item.label ?? '',\n\t\t\t[extHostProtocol.ISuggestDataDtoField.label2]: item.label2,\n\t\t\t[extHostProtocol.ISuggestDataDtoField.kind]: item.kind !== undefined ? typeConvert.CompletionItemKind.from(item.kind) : undefined,\n\t\t\t[extHostProtocol.ISuggestDataDtoField.kindModifier]: item.tags && item.tags.map(typeConvert.CompletionItemTag.from),\n\t\t\t[extHostProtocol.ISuggestDataDtoField.detail]: item.detail,\n\t\t\t[extHostProtocol.ISuggestDataDtoField.documentation]: typeof item.documentation === 'undefined' ? undefined : typeConvert.MarkdownString.fromStrict(item.documentation),\n\t\t\t[extHostProtocol.ISuggestDataDtoField.sortText]: item.sortText !== item.label ? item.sortText : undefined,\n\t\t\t[extHostProtocol.ISuggestDataDtoField.filterText]: item.filterText !== item.label ? item.filterText : undefined,\n\t\t\t[extHostProtocol.ISuggestDataDtoField.preselect]: item.preselect || undefined,\n\t\t\t[extHostProtocol.ISuggestDataDtoField.insertTextRules]: item.keepWhitespace ? modes.CompletionItemInsertTextRule.KeepWhitespace : 0,\n\t\t\t[extHostProtocol.ISuggestDataDtoField.commitCharacters]: item.commitCharacters,\n\t\t\t[extHostProtocol.ISuggestDataDtoField.additionalTextEdits]: item.additionalTextEdits && item.additionalTextEdits.map(typeConvert.TextEdit.from),\n\t\t\t[extHostProtocol.ISuggestDataDtoField.command]: this._commands.toInternal(item.command, disposables),\n\t\t};\n\n\t\t// 'insertText'-logic\n\t\tif (item.textEdit) {\n\t\t\tthis._apiDeprecation.report('CompletionItem.textEdit', this._extension, `Use 'CompletionItem.insertText' and 'CompletionItem.range' instead.`);\n\t\t\tresult[extHostProtocol.ISuggestDataDtoField.insertText] = item.textEdit.newText;\n\n\t\t} else if (typeof item.insertText === 'string') {\n\t\t\tresult[extHostProtocol.ISuggestDataDtoField.insertText] = item.insertText;\n\n\t\t} else if (item.insertText instanceof SnippetString) {\n\t\t\tresult[extHostProtocol.ISuggestDataDtoField.insertText] = item.insertText.value;\n\t\t\tresult[extHostProtocol.ISuggestDataDtoField.insertTextRules]! |= modes.CompletionItemInsertTextRule.InsertAsSnippet;\n\t\t}\n\n\t\t// 'overwrite[Before|After]'-logic\n\t\tlet range: vscode.Range | { inserting: vscode.Range, replacing: vscode.Range; } | undefined;\n\t\tif (item.textEdit) {\n\t\t\trange = item.textEdit.range;\n\t\t} else if (item.range) {\n\t\t\trange = item.range;\n\t\t}\n\n\t\tif (Range.isRange(range)) {\n\t\t\t// \"old\" range\n\t\t\tresult[extHostProtocol.ISuggestDataDtoField.range] = typeConvert.Range.from(range);\n\n\t\t} else if (range && (!defaultInsertRange?.isEqual(range.inserting) || !defaultReplaceRange?.isEqual(range.replacing))) {\n\t\t\t// ONLY send range when it's different from the default ranges (safe bandwidth)\n\t\t\tresult[extHostProtocol.ISuggestDataDtoField.range] = {\n\t\t\t\tinsert: typeConvert.Range.from(range.inserting),\n\t\t\t\treplace: typeConvert.Range.from(range.replacing)\n\t\t\t};\n\t\t}\n\n\t\treturn result;\n\t}\n}\n\nclass SignatureHelpAdapter {\n\n\tprivate readonly _cache = new Cache<vscode.SignatureHelp>('SignatureHelp');\n\n\tconstructor(\n\t\tprivate readonly _documents: ExtHostDocuments,\n\t\tprivate readonly _provider: vscode.SignatureHelpProvider,\n\t) { }\n\n\tprovideSignatureHelp(resource: URI, position: IPosition, context: extHostProtocol.ISignatureHelpContextDto, token: CancellationToken): Promise<extHostProtocol.ISignatureHelpDto | undefined> {\n\t\tconst doc = this._documents.getDocument(resource);\n\t\tconst pos = typeConvert.Position.to(position);\n\t\tconst vscodeContext = this.reviveContext(context);\n\n\t\treturn asPromise(() => this._provider.provideSignatureHelp(doc, pos, token, vscodeContext)).then(value => {\n\t\t\tif (value) {\n\t\t\t\tconst id = this._cache.add([value]);\n\t\t\t\treturn { ...typeConvert.SignatureHelp.from(value), id };\n\t\t\t}\n\t\t\treturn undefined;\n\t\t});\n\t}\n\n\tprivate reviveContext(context: extHostProtocol.ISignatureHelpContextDto): vscode.SignatureHelpContext {\n\t\tlet activeSignatureHelp: vscode.SignatureHelp | undefined = undefined;\n\t\tif (context.activeSignatureHelp) {\n\t\t\tconst revivedSignatureHelp = typeConvert.SignatureHelp.to(context.activeSignatureHelp);\n\t\t\tconst saved = this._cache.get(context.activeSignatureHelp.id, 0);\n\t\t\tif (saved) {\n\t\t\t\tactiveSignatureHelp = saved;\n\t\t\t\tactiveSignatureHelp.activeSignature = revivedSignatureHelp.activeSignature;\n\t\t\t\tactiveSignatureHelp.activeParameter = revivedSignatureHelp.activeParameter;\n\t\t\t} else {\n\t\t\t\tactiveSignatureHelp = revivedSignatureHelp;\n\t\t\t}\n\t\t}\n\t\treturn { ...context, activeSignatureHelp };\n\t}\n\n\treleaseSignatureHelp(id: number): any {\n\t\tthis._cache.delete(id);\n\t}\n}\n\nclass InlineHintsAdapter {\n\tconstructor(\n\t\tprivate readonly _documents: ExtHostDocuments,\n\t\tprivate readonly _provider: vscode.InlineHintsProvider,\n\t) { }\n\n\tprovideInlineHints(resource: URI, range: IRange, token: CancellationToken): Promise<extHostProtocol.IInlineHintsDto | undefined> {\n\t\tconst doc = this._documents.getDocument(resource);\n\t\treturn asPromise(() => this._provider.provideInlineHints(doc, typeConvert.Range.to(range), token)).then(value => {\n\t\t\treturn value ? { hints: value.map(typeConvert.InlineHint.from) } : undefined;\n\t\t});\n\t}\n}\n\nclass LinkProviderAdapter {\n\n\tprivate _cache = new Cache<vscode.DocumentLink>('DocumentLink');\n\n\tconstructor(\n\t\tprivate readonly _documents: ExtHostDocuments,\n\t\tprivate readonly _provider: vscode.DocumentLinkProvider\n\t) { }\n\n\tprovideLinks(resource: URI, token: CancellationToken): Promise<extHostProtocol.ILinksListDto | undefined> {\n\t\tconst doc = this._documents.getDocument(resource);\n\n\t\treturn asPromise(() => this._provider.provideDocumentLinks(doc, token)).then(links => {\n\t\t\tif (!Array.isArray(links) || links.length === 0) {\n\t\t\t\t// bad result\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t// cancelled -> return without further ado, esp no caching\n\t\t\t\t// of results as they will leak\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\tif (typeof this._provider.resolveDocumentLink !== 'function') {\n\t\t\t\t// no resolve -> no caching\n\t\t\t\treturn { links: links.map(typeConvert.DocumentLink.from) };\n\n\t\t\t} else {\n\t\t\t\t// cache links for future resolving\n\t\t\t\tconst pid = this._cache.add(links);\n\t\t\t\tconst result: extHostProtocol.ILinksListDto = { links: [], id: pid };\n\t\t\t\tfor (let i = 0; i < links.length; i++) {\n\t\t\t\t\tconst dto: extHostProtocol.ILinkDto = typeConvert.DocumentLink.from(links[i]);\n\t\t\t\t\tdto.cacheId = [pid, i];\n\t\t\t\t\tresult.links.push(dto);\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t}\n\t\t});\n\t}\n\n\tresolveLink(id: extHostProtocol.ChainedCacheId, token: CancellationToken): Promise<extHostProtocol.ILinkDto | undefined> {\n\t\tif (typeof this._provider.resolveDocumentLink !== 'function') {\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\t\tconst item = this._cache.get(...id);\n\t\tif (!item) {\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\t\treturn asPromise(() => this._provider.resolveDocumentLink!(item, token)).then(value => {\n\t\t\treturn value && typeConvert.DocumentLink.from(value) || undefined;\n\t\t});\n\t}\n\n\treleaseLinks(id: number): any {\n\t\tthis._cache.delete(id);\n\t}\n}\n\nclass ColorProviderAdapter {\n\n\tconstructor(\n\t\tprivate _documents: ExtHostDocuments,\n\t\tprivate _provider: vscode.DocumentColorProvider\n\t) { }\n\n\tprovideColors(resource: URI, token: CancellationToken): Promise<extHostProtocol.IRawColorInfo[]> {\n\t\tconst doc = this._documents.getDocument(resource);\n\t\treturn asPromise(() => this._provider.provideDocumentColors(doc, token)).then(colors => {\n\t\t\tif (!Array.isArray(colors)) {\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tconst colorInfos: extHostProtocol.IRawColorInfo[] = colors.map(ci => {\n\t\t\t\treturn {\n\t\t\t\t\tcolor: typeConvert.Color.from(ci.color),\n\t\t\t\t\trange: typeConvert.Range.from(ci.range)\n\t\t\t\t};\n\t\t\t});\n\n\t\t\treturn colorInfos;\n\t\t});\n\t}\n\n\tprovideColorPresentations(resource: URI, raw: extHostProtocol.IRawColorInfo, token: CancellationToken): Promise<modes.IColorPresentation[] | undefined> {\n\t\tconst document = this._documents.getDocument(resource);\n\t\tconst range = typeConvert.Range.to(raw.range);\n\t\tconst color = typeConvert.Color.to(raw.color);\n\t\treturn asPromise(() => this._provider.provideColorPresentations(color, { document, range }, token)).then(value => {\n\t\t\tif (!Array.isArray(value)) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\treturn value.map(typeConvert.ColorPresentation.from);\n\t\t});\n\t}\n}\n\nclass FoldingProviderAdapter {\n\n\tconstructor(\n\t\tprivate _documents: ExtHostDocuments,\n\t\tprivate _provider: vscode.FoldingRangeProvider\n\t) { }\n\n\tprovideFoldingRanges(resource: URI, context: modes.FoldingContext, token: CancellationToken): Promise<modes.FoldingRange[] | undefined> {\n\t\tconst doc = this._documents.getDocument(resource);\n\t\treturn asPromise(() => this._provider.provideFoldingRanges(doc, context, token)).then(ranges => {\n\t\t\tif (!Array.isArray(ranges)) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\treturn ranges.map(typeConvert.FoldingRange.from);\n\t\t});\n\t}\n}\n\nclass SelectionRangeAdapter {\n\n\tconstructor(\n\t\tprivate readonly _documents: ExtHostDocuments,\n\t\tprivate readonly _provider: vscode.SelectionRangeProvider,\n\t\tprivate readonly _logService: ILogService\n\t) { }\n\n\tprovideSelectionRanges(resource: URI, pos: IPosition[], token: CancellationToken): Promise<modes.SelectionRange[][]> {\n\t\tconst document = this._documents.getDocument(resource);\n\t\tconst positions = pos.map(typeConvert.Position.to);\n\n\t\treturn asPromise(() => this._provider.provideSelectionRanges(document, positions, token)).then(allProviderRanges => {\n\t\t\tif (!isNonEmptyArray(allProviderRanges)) {\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\tif (allProviderRanges.length !== positions.length) {\n\t\t\t\tthis._logService.warn('BAD selection ranges, provider must return ranges for each position');\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tconst allResults: modes.SelectionRange[][] = [];\n\t\t\tfor (let i = 0; i < positions.length; i++) {\n\t\t\t\tconst oneResult: modes.SelectionRange[] = [];\n\t\t\t\tallResults.push(oneResult);\n\n\t\t\t\tlet last: vscode.Position | vscode.Range = positions[i];\n\t\t\t\tlet selectionRange = allProviderRanges[i];\n\n\t\t\t\twhile (true) {\n\t\t\t\t\tif (!selectionRange.range.contains(last)) {\n\t\t\t\t\t\tthrow new Error('INVALID selection range, must contain the previous range');\n\t\t\t\t\t}\n\t\t\t\t\toneResult.push(typeConvert.SelectionRange.from(selectionRange));\n\t\t\t\t\tif (!selectionRange.parent) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tlast = selectionRange.range;\n\t\t\t\t\tselectionRange = selectionRange.parent;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn allResults;\n\t\t});\n\t}\n}\n\nclass CallHierarchyAdapter {\n\n\tprivate readonly _idPool = new IdGenerator('');\n\tprivate readonly _cache = new Map<string, Map<string, vscode.CallHierarchyItem>>();\n\n\tconstructor(\n\t\tprivate readonly _documents: ExtHostDocuments,\n\t\tprivate readonly _provider: vscode.CallHierarchyProvider\n\t) { }\n\n\tasync prepareSession(uri: URI, position: IPosition, token: CancellationToken): Promise<extHostProtocol.ICallHierarchyItemDto[] | undefined> {\n\t\tconst doc = this._documents.getDocument(uri);\n\t\tconst pos = typeConvert.Position.to(position);\n\n\t\tconst items = await this._provider.prepareCallHierarchy(doc, pos, token);\n\t\tif (!items) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst sessionId = this._idPool.nextId();\n\t\tthis._cache.set(sessionId, new Map());\n\n\t\tif (Array.isArray(items)) {\n\t\t\treturn items.map(item => this._cacheAndConvertItem(sessionId, item));\n\t\t} else {\n\t\t\treturn [this._cacheAndConvertItem(sessionId, items)];\n\t\t}\n\t}\n\n\tasync provideCallsTo(sessionId: string, itemId: string, token: CancellationToken): Promise<extHostProtocol.IIncomingCallDto[] | undefined> {\n\t\tconst item = this._itemFromCache(sessionId, itemId);\n\t\tif (!item) {\n\t\t\tthrow new Error('missing call hierarchy item');\n\t\t}\n\t\tconst calls = await this._provider.provideCallHierarchyIncomingCalls(item, token);\n\t\tif (!calls) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn calls.map(call => {\n\t\t\treturn {\n\t\t\t\tfrom: this._cacheAndConvertItem(sessionId, call.from),\n\t\t\t\tfromRanges: call.fromRanges.map(r => typeConvert.Range.from(r))\n\t\t\t};\n\t\t});\n\t}\n\n\tasync provideCallsFrom(sessionId: string, itemId: string, token: CancellationToken): Promise<extHostProtocol.IOutgoingCallDto[] | undefined> {\n\t\tconst item = this._itemFromCache(sessionId, itemId);\n\t\tif (!item) {\n\t\t\tthrow new Error('missing call hierarchy item');\n\t\t}\n\t\tconst calls = await this._provider.provideCallHierarchyOutgoingCalls(item, token);\n\t\tif (!calls) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn calls.map(call => {\n\t\t\treturn {\n\t\t\t\tto: this._cacheAndConvertItem(sessionId, call.to),\n\t\t\t\tfromRanges: call.fromRanges.map(r => typeConvert.Range.from(r))\n\t\t\t};\n\t\t});\n\t}\n\n\treleaseSession(sessionId: string): void {\n\t\tthis._cache.delete(sessionId);\n\t}\n\n\tprivate _cacheAndConvertItem(sessionId: string, item: vscode.CallHierarchyItem): extHostProtocol.ICallHierarchyItemDto {\n\t\tconst map = this._cache.get(sessionId)!;\n\t\tconst dto: extHostProtocol.ICallHierarchyItemDto = {\n\t\t\t_sessionId: sessionId,\n\t\t\t_itemId: map.size.toString(36),\n\t\t\tname: item.name,\n\t\t\tdetail: item.detail,\n\t\t\tkind: typeConvert.SymbolKind.from(item.kind),\n\t\t\turi: item.uri,\n\t\t\trange: typeConvert.Range.from(item.range),\n\t\t\tselectionRange: typeConvert.Range.from(item.selectionRange),\n\t\t\ttags: item.tags?.map(typeConvert.SymbolTag.from)\n\t\t};\n\t\tmap.set(dto._itemId, item);\n\t\treturn dto;\n\t}\n\n\tprivate _itemFromCache(sessionId: string, itemId: string): vscode.CallHierarchyItem | undefined {\n\t\tconst map = this._cache.get(sessionId);\n\t\treturn map?.get(itemId);\n\t}\n}\n\ntype Adapter = DocumentSymbolAdapter | CodeLensAdapter | DefinitionAdapter | HoverAdapter\n\t| DocumentHighlightAdapter | ReferenceAdapter | CodeActionAdapter | DocumentFormattingAdapter\n\t| RangeFormattingAdapter | OnTypeFormattingAdapter | NavigateTypeAdapter | RenameAdapter\n\t| SuggestAdapter | SignatureHelpAdapter | LinkProviderAdapter | ImplementationAdapter\n\t| TypeDefinitionAdapter | ColorProviderAdapter | FoldingProviderAdapter | DeclarationAdapter\n\t| SelectionRangeAdapter | CallHierarchyAdapter | DocumentSemanticTokensAdapter | DocumentRangeSemanticTokensAdapter | EvaluatableExpressionAdapter\n\t| LinkedEditingRangeAdapter | InlineHintsAdapter;\n\nclass AdapterData {\n\tconstructor(\n\t\treadonly adapter: Adapter,\n\t\treadonly extension: IExtensionDescription | undefined\n\t) { }\n}\n\nexport class ExtHostLanguageFeatures implements extHostProtocol.ExtHostLanguageFeaturesShape {\n\n\tprivate static _handlePool: number = 0;\n\n\tprivate readonly _uriTransformer: IURITransformer | null;\n\tprivate readonly _proxy: extHostProtocol.MainThreadLanguageFeaturesShape;\n\tprivate _documents: ExtHostDocuments;\n\tprivate _commands: ExtHostCommands;\n\tprivate _diagnostics: ExtHostDiagnostics;\n\tprivate _adapter = new Map<number, AdapterData>();\n\tprivate readonly _logService: ILogService;\n\tprivate readonly _apiDeprecation: IExtHostApiDeprecationService;\n\n\tconstructor(\n\t\tmainContext: extHostProtocol.IMainContext,\n\t\turiTransformer: IURITransformer | null,\n\t\tdocuments: ExtHostDocuments,\n\t\tcommands: ExtHostCommands,\n\t\tdiagnostics: ExtHostDiagnostics,\n\t\tlogService: ILogService,\n\t\tapiDeprecationService: IExtHostApiDeprecationService,\n\t) {\n\t\tthis._uriTransformer = uriTransformer;\n\t\tthis._proxy = mainContext.getProxy(extHostProtocol.MainContext.MainThreadLanguageFeatures);\n\t\tthis._documents = documents;\n\t\tthis._commands = commands;\n\t\tthis._diagnostics = diagnostics;\n\t\tthis._logService = logService;\n\t\tthis._apiDeprecation = apiDeprecationService;\n\t}\n\n\tprivate _transformDocumentSelector(selector: vscode.DocumentSelector): Array<extHostProtocol.IDocumentFilterDto> {\n\t\treturn coalesce(asArray(selector).map(sel => this._doTransformDocumentSelector(sel)));\n\t}\n\n\tprivate _doTransformDocumentSelector(selector: string | vscode.DocumentFilter): extHostProtocol.IDocumentFilterDto | undefined {\n\t\tif (typeof selector === 'string') {\n\t\t\treturn {\n\t\t\t\t$serialized: true,\n\t\t\t\tlanguage: selector\n\t\t\t};\n\t\t}\n\n\t\tif (selector) {\n\t\t\treturn {\n\t\t\t\t$serialized: true,\n\t\t\t\tlanguage: selector.language,\n\t\t\t\tscheme: this._transformScheme(selector.scheme),\n\t\t\t\tpattern: typeof selector.pattern === 'undefined' ? undefined : typeConvert.GlobPattern.from(selector.pattern),\n\t\t\t\texclusive: selector.exclusive\n\t\t\t};\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate _transformScheme(scheme: string | undefined): string | undefined {\n\t\tif (this._uriTransformer && typeof scheme === 'string') {\n\t\t\treturn this._uriTransformer.transformOutgoingScheme(scheme);\n\t\t}\n\t\treturn scheme;\n\t}\n\n\tprivate _createDisposable(handle: number): Disposable {\n\t\treturn new Disposable(() => {\n\t\t\tthis._adapter.delete(handle);\n\t\t\tthis._proxy.$unregister(handle);\n\t\t});\n\t}\n\n\tprivate _nextHandle(): number {\n\t\treturn ExtHostLanguageFeatures._handlePool++;\n\t}\n\n\tprivate _withAdapter<A, R>(handle: number, ctor: { new(...args: any[]): A; }, callback: (adapter: A, extension: IExtensionDescription | undefined) => Promise<R>, fallbackValue: R, allowCancellationError: boolean = false): Promise<R> {\n\t\tconst data = this._adapter.get(handle);\n\t\tif (!data) {\n\t\t\treturn Promise.resolve(fallbackValue);\n\t\t}\n\n\t\tif (data.adapter instanceof ctor) {\n\t\t\tlet t1: number;\n\t\t\tif (data.extension) {\n\t\t\t\tt1 = Date.now();\n\t\t\t\tthis._logService.trace(`[${data.extension.identifier.value}] INVOKE provider '${(ctor as any).name}'`);\n\t\t\t}\n\t\t\tconst p = callback(data.adapter, data.extension);\n\t\t\tconst extension = data.extension;\n\t\t\tif (extension) {\n\t\t\t\tPromise.resolve(p).then(\n\t\t\t\t\t() => this._logService.trace(`[${extension.identifier.value}] provider DONE after ${Date.now() - t1}ms`),\n\t\t\t\t\terr => {\n\t\t\t\t\t\tconst isExpectedError = allowCancellationError && (err instanceof CancellationError);\n\t\t\t\t\t\tif (!isExpectedError) {\n\t\t\t\t\t\t\tthis._logService.error(`[${extension.identifier.value}] provider FAILED`);\n\t\t\t\t\t\t\tthis._logService.error(err);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn p;\n\t\t}\n\t\treturn Promise.reject(new Error('no adapter found'));\n\t}\n\n\tprivate _addNewAdapter(adapter: Adapter, extension: IExtensionDescription | undefined): number {\n\t\tconst handle = this._nextHandle();\n\t\tthis._adapter.set(handle, new AdapterData(adapter, extension));\n\t\treturn handle;\n\t}\n\n\tprivate static _extLabel(ext: IExtensionDescription): string {\n\t\treturn ext.displayName || ext.name;\n\t}\n\n\t// --- outline\n\n\tregisterDocumentSymbolProvider(extension: IExtensionDescription, selector: vscode.DocumentSelector, provider: vscode.DocumentSymbolProvider, metadata?: vscode.DocumentSymbolProviderMetadata): vscode.Disposable {\n\t\tconst handle = this._addNewAdapter(new DocumentSymbolAdapter(this._documents, provider), extension);\n\t\tconst displayName = (metadata && metadata.label) || ExtHostLanguageFeatures._extLabel(extension);\n\t\tthis._proxy.$registerDocumentSymbolProvider(handle, this._transformDocumentSelector(selector), displayName);\n\t\treturn this._createDisposable(handle);\n\t}\n\n\t$provideDocumentSymbols(handle: number, resource: UriComponents, token: CancellationToken): Promise<modes.DocumentSymbol[] | undefined> {\n\t\treturn this._withAdapter(handle, DocumentSymbolAdapter, adapter => adapter.provideDocumentSymbols(URI.revive(resource), token), undefined);\n\t}\n\n\t// --- code lens\n\n\tregisterCodeLensProvider(extension: IExtensionDescription, selector: vscode.DocumentSelector, provider: vscode.CodeLensProvider): vscode.Disposable {\n\t\tconst handle = this._nextHandle();\n\t\tconst eventHandle = typeof provider.onDidChangeCodeLenses === 'function' ? this._nextHandle() : undefined;\n\n\t\tthis._adapter.set(handle, new AdapterData(new CodeLensAdapter(this._documents, this._commands.converter, provider), extension));\n\t\tthis._proxy.$registerCodeLensSupport(handle, this._transformDocumentSelector(selector), eventHandle);\n\t\tlet result = this._createDisposable(handle);\n\n\t\tif (eventHandle !== undefined) {\n\t\t\tconst subscription = provider.onDidChangeCodeLenses!(_ => this._proxy.$emitCodeLensEvent(eventHandle));\n\t\t\tresult = Disposable.from(result, subscription);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t$provideCodeLenses(handle: number, resource: UriComponents, token: CancellationToken): Promise<extHostProtocol.ICodeLensListDto | undefined> {\n\t\treturn this._withAdapter(handle, CodeLensAdapter, adapter => adapter.provideCodeLenses(URI.revive(resource), token), undefined);\n\t}\n\n\t$resolveCodeLens(handle: number, symbol: extHostProtocol.ICodeLensDto, token: CancellationToken): Promise<extHostProtocol.ICodeLensDto | undefined> {\n\t\treturn this._withAdapter(handle, CodeLensAdapter, adapter => adapter.resolveCodeLens(symbol, token), undefined);\n\t}\n\n\t$releaseCodeLenses(handle: number, cacheId: number): void {\n\t\tthis._withAdapter(handle, CodeLensAdapter, adapter => Promise.resolve(adapter.releaseCodeLenses(cacheId)), undefined);\n\t}\n\n\t// --- declaration\n\n\tregisterDefinitionProvider(extension: IExtensionDescription, selector: vscode.DocumentSelector, provider: vscode.DefinitionProvider): vscode.Disposable {\n\t\tconst handle = this._addNewAdapter(new DefinitionAdapter(this._documents, provider), extension);\n\t\tthis._proxy.$registerDefinitionSupport(handle, this._transformDocumentSelector(selector));\n\t\treturn this._createDisposable(handle);\n\t}\n\n\t$provideDefinition(handle: number, resource: UriComponents, position: IPosition, token: CancellationToken): Promise<modes.LocationLink[]> {\n\t\treturn this._withAdapter(handle, DefinitionAdapter, adapter => adapter.provideDefinition(URI.revive(resource), position, token), []);\n\t}\n\n\tregisterDeclarationProvider(extension: IExtensionDescription, selector: vscode.DocumentSelector, provider: vscode.DeclarationProvider): vscode.Disposable {\n\t\tconst handle = this._addNewAdapter(new DeclarationAdapter(this._documents, provider), extension);\n\t\tthis._proxy.$registerDeclarationSupport(handle, this._transformDocumentSelector(selector));\n\t\treturn this._createDisposable(handle);\n\t}\n\n\t$provideDeclaration(handle: number, resource: UriComponents, position: IPosition, token: CancellationToken): Promise<modes.LocationLink[]> {\n\t\treturn this._withAdapter(handle, DeclarationAdapter, adapter => adapter.provideDeclaration(URI.revive(resource), position, token), []);\n\t}\n\n\tregisterImplementationProvider(extension: IExtensionDescription, selector: vscode.DocumentSelector, provider: vscode.ImplementationProvider): vscode.Disposable {\n\t\tconst handle = this._addNewAdapter(new ImplementationAdapter(this._documents, provider), extension);\n\t\tthis._proxy.$registerImplementationSupport(handle, this._transformDocumentSelector(selector));\n\t\treturn this._createDisposable(handle);\n\t}\n\n\t$provideImplementation(handle: number, resource: UriComponents, position: IPosition, token: CancellationToken): Promise<modes.LocationLink[]> {\n\t\treturn this._withAdapter(handle, ImplementationAdapter, adapter => adapter.provideImplementation(URI.revive(resource), position, token), []);\n\t}\n\n\tregisterTypeDefinitionProvider(extension: IExtensionDescription, selector: vscode.DocumentSelector, provider: vscode.TypeDefinitionProvider): vscode.Disposable {\n\t\tconst handle = this._addNewAdapter(new TypeDefinitionAdapter(this._documents, provider), extension);\n\t\tthis._proxy.$registerTypeDefinitionSupport(handle, this._transformDocumentSelector(selector));\n\t\treturn this._createDisposable(handle);\n\t}\n\n\t$provideTypeDefinition(handle: number, resource: UriComponents, position: IPosition, token: CancellationToken): Promise<modes.LocationLink[]> {\n\t\treturn this._withAdapter(handle, TypeDefinitionAdapter, adapter => adapter.provideTypeDefinition(URI.revive(resource), position, token), []);\n\t}\n\n\t// --- extra info\n\n\tregisterHoverProvider(extension: IExtensionDescription, selector: vscode.DocumentSelector, provider: vscode.HoverProvider, extensionId?: ExtensionIdentifier): vscode.Disposable {\n\t\tconst handle = this._addNewAdapter(new HoverAdapter(this._documents, provider), extension);\n\t\tthis._proxy.$registerHoverProvider(handle, this._transformDocumentSelector(selector));\n\t\treturn this._createDisposable(handle);\n\t}\n\n\t$provideHover(handle: number, resource: UriComponents, position: IPosition, token: CancellationToken): Promise<modes.Hover | undefined> {\n\t\treturn this._withAdapter(handle, HoverAdapter, adapter => adapter.provideHover(URI.revive(resource), position, token), undefined);\n\t}\n\n\t// --- debug hover\n\n\tregisterEvaluatableExpressionProvider(extension: IExtensionDescription, selector: vscode.DocumentSelector, provider: vscode.EvaluatableExpressionProvider, extensionId?: ExtensionIdentifier): vscode.Disposable {\n\t\tconst handle = this._addNewAdapter(new EvaluatableExpressionAdapter(this._documents, provider), extension);\n\t\tthis._proxy.$registerEvaluatableExpressionProvider(handle, this._transformDocumentSelector(selector));\n\t\treturn this._createDisposable(handle);\n\t}\n\n\t$provideEvaluatableExpression(handle: number, resource: UriComponents, position: IPosition, token: CancellationToken): Promise<modes.EvaluatableExpression | undefined> {\n\t\treturn this._withAdapter(handle, EvaluatableExpressionAdapter, adapter => adapter.provideEvaluatableExpression(URI.revive(resource), position, token), undefined);\n\t}\n\n\t// --- occurrences\n\n\tregisterDocumentHighlightProvider(extension: IExtensionDescription, selector: vscode.DocumentSelector, provider: vscode.DocumentHighlightProvider): vscode.Disposable {\n\t\tconst handle = this._addNewAdapter(new DocumentHighlightAdapter(this._documents, provider), extension);\n\t\tthis._proxy.$registerDocumentHighlightProvider(handle, this._transformDocumentSelector(selector));\n\t\treturn this._createDisposable(handle);\n\t}\n\n\t$provideDocumentHighlights(handle: number, resource: UriComponents, position: IPosition, token: CancellationToken): Promise<modes.DocumentHighlight[] | undefined> {\n\t\treturn this._withAdapter(handle, DocumentHighlightAdapter, adapter => adapter.provideDocumentHighlights(URI.revive(resource), position, token), undefined);\n\t}\n\n\t// --- linked editing\n\n\tregisterLinkedEditingRangeProvider(extension: IExtensionDescription, selector: vscode.DocumentSelector, provider: vscode.LinkedEditingRangeProvider): vscode.Disposable {\n\t\tconst handle = this._addNewAdapter(new LinkedEditingRangeAdapter(this._documents, provider), extension);\n\t\tthis._proxy.$registerLinkedEditingRangeProvider(handle, this._transformDocumentSelector(selector));\n\t\treturn this._createDisposable(handle);\n\t}\n\n\t$provideLinkedEditingRanges(handle: number, resource: UriComponents, position: IPosition, token: CancellationToken): Promise<extHostProtocol.ILinkedEditingRangesDto | undefined> {\n\t\treturn this._withAdapter(handle, LinkedEditingRangeAdapter, async adapter => {\n\t\t\tconst res = await adapter.provideLinkedEditingRanges(URI.revive(resource), position, token);\n\t\t\tif (res) {\n\t\t\t\treturn {\n\t\t\t\t\tranges: res.ranges,\n\t\t\t\t\twordPattern: res.wordPattern ? ExtHostLanguageFeatures._serializeRegExp(res.wordPattern) : undefined\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn undefined;\n\t\t}, undefined);\n\t}\n\n\t// --- references\n\n\tregisterReferenceProvider(extension: IExtensionDescription, selector: vscode.DocumentSelector, provider: vscode.ReferenceProvider): vscode.Disposable {\n\t\tconst handle = this._addNewAdapter(new ReferenceAdapter(this._documents, provider), extension);\n\t\tthis._proxy.$registerReferenceSupport(handle, this._transformDocumentSelector(selector));\n\t\treturn this._createDisposable(handle);\n\t}\n\n\t$provideReferences(handle: number, resource: UriComponents, position: IPosition, context: modes.ReferenceContext, token: CancellationToken): Promise<modes.Location[] | undefined> {\n\t\treturn this._withAdapter(handle, ReferenceAdapter, adapter => adapter.provideReferences(URI.revive(resource), position, context, token), undefined);\n\t}\n\n\t// --- quick fix\n\n\tregisterCodeActionProvider(extension: IExtensionDescription, selector: vscode.DocumentSelector, provider: vscode.CodeActionProvider, metadata?: vscode.CodeActionProviderMetadata): vscode.Disposable {\n\t\tconst store = new DisposableStore();\n\t\tconst handle = this._addNewAdapter(new CodeActionAdapter(this._documents, this._commands.converter, this._diagnostics, provider, this._logService, extension, this._apiDeprecation), extension);\n\t\tthis._proxy.$registerQuickFixSupport(handle, this._transformDocumentSelector(selector), {\n\t\t\tprovidedKinds: metadata?.providedCodeActionKinds?.map(kind => kind.value),\n\t\t\tdocumentation: metadata?.documentation?.map(x => ({\n\t\t\t\tkind: x.kind.value,\n\t\t\t\tcommand: this._commands.converter.toInternal(x.command, store),\n\t\t\t}))\n\t\t}, ExtHostLanguageFeatures._extLabel(extension), Boolean(provider.resolveCodeAction));\n\t\tstore.add(this._createDisposable(handle));\n\t\treturn store;\n\t}\n\n\n\t$provideCodeActions(handle: number, resource: UriComponents, rangeOrSelection: IRange | ISelection, context: modes.CodeActionContext, token: CancellationToken): Promise<extHostProtocol.ICodeActionListDto | undefined> {\n\t\treturn this._withAdapter(handle, CodeActionAdapter, adapter => adapter.provideCodeActions(URI.revive(resource), rangeOrSelection, context, token), undefined);\n\t}\n\n\t$resolveCodeAction(handle: number, id: extHostProtocol.ChainedCacheId, token: CancellationToken): Promise<extHostProtocol.IWorkspaceEditDto | undefined> {\n\t\treturn this._withAdapter(handle, CodeActionAdapter, adapter => adapter.resolveCodeAction(id, token), undefined);\n\t}\n\n\t$releaseCodeActions(handle: number, cacheId: number): void {\n\t\tthis._withAdapter(handle, CodeActionAdapter, adapter => Promise.resolve(adapter.releaseCodeActions(cacheId)), undefined);\n\t}\n\n\t// --- formatting\n\n\tregisterDocumentFormattingEditProvider(extension: IExtensionDescription, selector: vscode.DocumentSelector, provider: vscode.DocumentFormattingEditProvider): vscode.Disposable {\n\t\tconst handle = this._addNewAdapter(new DocumentFormattingAdapter(this._documents, provider), extension);\n\t\tthis._proxy.$registerDocumentFormattingSupport(handle, this._transformDocumentSelector(selector), extension.identifier, extension.displayName || extension.name);\n\t\treturn this._createDisposable(handle);\n\t}\n\n\t$provideDocumentFormattingEdits(handle: number, resource: UriComponents, options: modes.FormattingOptions, token: CancellationToken): Promise<ISingleEditOperation[] | undefined> {\n\t\treturn this._withAdapter(handle, DocumentFormattingAdapter, adapter => adapter.provideDocumentFormattingEdits(URI.revive(resource), options, token), undefined);\n\t}\n\n\tregisterDocumentRangeFormattingEditProvider(extension: IExtensionDescription, selector: vscode.DocumentSelector, provider: vscode.DocumentRangeFormattingEditProvider): vscode.Disposable {\n\t\tconst handle = this._addNewAdapter(new RangeFormattingAdapter(this._documents, provider), extension);\n\t\tthis._proxy.$registerRangeFormattingSupport(handle, this._transformDocumentSelector(selector), extension.identifier, extension.displayName || extension.name);\n\t\treturn this._createDisposable(handle);\n\t}\n\n\t$provideDocumentRangeFormattingEdits(handle: number, resource: UriComponents, range: IRange, options: modes.FormattingOptions, token: CancellationToken): Promise<ISingleEditOperation[] | undefined> {\n\t\treturn this._withAdapter(handle, RangeFormattingAdapter, adapter => adapter.provideDocumentRangeFormattingEdits(URI.revive(resource), range, options, token), undefined);\n\t}\n\n\tregisterOnTypeFormattingEditProvider(extension: IExtensionDescription, selector: vscode.DocumentSelector, provider: vscode.OnTypeFormattingEditProvider, triggerCharacters: string[]): vscode.Disposable {\n\t\tconst handle = this._addNewAdapter(new OnTypeFormattingAdapter(this._documents, provider), extension);\n\t\tthis._proxy.$registerOnTypeFormattingSupport(handle, this._transformDocumentSelector(selector), triggerCharacters, extension.identifier);\n\t\treturn this._createDisposable(handle);\n\t}\n\n\t$provideOnTypeFormattingEdits(handle: number, resource: UriComponents, position: IPosition, ch: string, options: modes.FormattingOptions, token: CancellationToken): Promise<ISingleEditOperation[] | undefined> {\n\t\treturn this._withAdapter(handle, OnTypeFormattingAdapter, adapter => adapter.provideOnTypeFormattingEdits(URI.revive(resource), position, ch, options, token), undefined);\n\t}\n\n\t// --- navigate types\n\n\tregisterWorkspaceSymbolProvider(extension: IExtensionDescription, provider: vscode.WorkspaceSymbolProvider): vscode.Disposable {\n\t\tconst handle = this._addNewAdapter(new NavigateTypeAdapter(provider, this._logService), extension);\n\t\tthis._proxy.$registerNavigateTypeSupport(handle);\n\t\treturn this._createDisposable(handle);\n\t}\n\n\t$provideWorkspaceSymbols(handle: number, search: string, token: CancellationToken): Promise<extHostProtocol.IWorkspaceSymbolsDto> {\n\t\treturn this._withAdapter(handle, NavigateTypeAdapter, adapter => adapter.provideWorkspaceSymbols(search, token), { symbols: [] });\n\t}\n\n\t$resolveWorkspaceSymbol(handle: number, symbol: extHostProtocol.IWorkspaceSymbolDto, token: CancellationToken): Promise<extHostProtocol.IWorkspaceSymbolDto | undefined> {\n\t\treturn this._withAdapter(handle, NavigateTypeAdapter, adapter => adapter.resolveWorkspaceSymbol(symbol, token), undefined);\n\t}\n\n\t$releaseWorkspaceSymbols(handle: number, id: number): void {\n\t\tthis._withAdapter(handle, NavigateTypeAdapter, adapter => adapter.releaseWorkspaceSymbols(id), undefined);\n\t}\n\n\t// --- rename\n\n\tregisterRenameProvider(extension: IExtensionDescription, selector: vscode.DocumentSelector, provider: vscode.RenameProvider): vscode.Disposable {\n\t\tconst handle = this._addNewAdapter(new RenameAdapter(this._documents, provider, this._logService), extension);\n\t\tthis._proxy.$registerRenameSupport(handle, this._transformDocumentSelector(selector), RenameAdapter.supportsResolving(provider));\n\t\treturn this._createDisposable(handle);\n\t}\n\n\t$provideRenameEdits(handle: number, resource: UriComponents, position: IPosition, newName: string, token: CancellationToken): Promise<extHostProtocol.IWorkspaceEditDto | undefined> {\n\t\treturn this._withAdapter(handle, RenameAdapter, adapter => adapter.provideRenameEdits(URI.revive(resource), position, newName, token), undefined);\n\t}\n\n\t$resolveRenameLocation(handle: number, resource: URI, position: IPosition, token: CancellationToken): Promise<modes.RenameLocation | undefined> {\n\t\treturn this._withAdapter(handle, RenameAdapter, adapter => adapter.resolveRenameLocation(URI.revive(resource), position, token), undefined);\n\t}\n\n\t//#region semantic coloring\n\n\tregisterDocumentSemanticTokensProvider(extension: IExtensionDescription, selector: vscode.DocumentSelector, provider: vscode.DocumentSemanticTokensProvider, legend: vscode.SemanticTokensLegend): vscode.Disposable {\n\t\tconst handle = this._nextHandle();\n\t\tconst eventHandle = (typeof provider.onDidChangeSemanticTokens === 'function' ? this._nextHandle() : undefined);\n\n\t\tthis._adapter.set(handle, new AdapterData(new DocumentSemanticTokensAdapter(this._documents, provider), extension));\n\t\tthis._proxy.$registerDocumentSemanticTokensProvider(handle, this._transformDocumentSelector(selector), legend, eventHandle);\n\t\tlet result = this._createDisposable(handle);\n\n\t\tif (eventHandle) {\n\t\t\tconst subscription = provider.onDidChangeSemanticTokens!(_ => this._proxy.$emitDocumentSemanticTokensEvent(eventHandle));\n\t\t\tresult = Disposable.from(result, subscription);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t$provideDocumentSemanticTokens(handle: number, resource: UriComponents, previousResultId: number, token: CancellationToken): Promise<VSBuffer | null> {\n\t\treturn this._withAdapter(handle, DocumentSemanticTokensAdapter, adapter => adapter.provideDocumentSemanticTokens(URI.revive(resource), previousResultId, token), null, true);\n\t}\n\n\t$releaseDocumentSemanticTokens(handle: number, semanticColoringResultId: number): void {\n\t\tthis._withAdapter(handle, DocumentSemanticTokensAdapter, adapter => adapter.releaseDocumentSemanticColoring(semanticColoringResultId), undefined);\n\t}\n\n\tregisterDocumentRangeSemanticTokensProvider(extension: IExtensionDescription, selector: vscode.DocumentSelector, provider: vscode.DocumentRangeSemanticTokensProvider, legend: vscode.SemanticTokensLegend): vscode.Disposable {\n\t\tconst handle = this._addNewAdapter(new DocumentRangeSemanticTokensAdapter(this._documents, provider), extension);\n\t\tthis._proxy.$registerDocumentRangeSemanticTokensProvider(handle, this._transformDocumentSelector(selector), legend);\n\t\treturn this._createDisposable(handle);\n\t}\n\n\t$provideDocumentRangeSemanticTokens(handle: number, resource: UriComponents, range: IRange, token: CancellationToken): Promise<VSBuffer | null> {\n\t\treturn this._withAdapter(handle, DocumentRangeSemanticTokensAdapter, adapter => adapter.provideDocumentRangeSemanticTokens(URI.revive(resource), range, token), null, true);\n\t}\n\n\t//#endregion\n\n\t// --- suggestion\n\n\tregisterCompletionItemProvider(extension: IExtensionDescription, selector: vscode.DocumentSelector, provider: vscode.CompletionItemProvider, triggerCharacters: string[]): vscode.Disposable {\n\t\tconst handle = this._addNewAdapter(new SuggestAdapter(this._documents, this._commands.converter, provider, this._apiDeprecation, extension), extension);\n\t\tthis._proxy.$registerSuggestSupport(handle, this._transformDocumentSelector(selector), triggerCharacters, SuggestAdapter.supportsResolving(provider), `${extension.identifier.value}(${triggerCharacters.join('')})`);\n\t\treturn this._createDisposable(handle);\n\t}\n\n\t$provideCompletionItems(handle: number, resource: UriComponents, position: IPosition, context: modes.CompletionContext, token: CancellationToken): Promise<extHostProtocol.ISuggestResultDto | undefined> {\n\t\treturn this._withAdapter(handle, SuggestAdapter, adapter => adapter.provideCompletionItems(URI.revive(resource), position, context, token), undefined);\n\t}\n\n\t$resolveCompletionItem(handle: number, id: extHostProtocol.ChainedCacheId, token: CancellationToken): Promise<extHostProtocol.ISuggestDataDto | undefined> {\n\t\treturn this._withAdapter(handle, SuggestAdapter, adapter => adapter.resolveCompletionItem(id, token), undefined);\n\t}\n\n\t$releaseCompletionItems(handle: number, id: number): void {\n\t\tthis._withAdapter(handle, SuggestAdapter, adapter => adapter.releaseCompletionItems(id), undefined);\n\t}\n\n\t// --- parameter hints\n\n\tregisterSignatureHelpProvider(extension: IExtensionDescription, selector: vscode.DocumentSelector, provider: vscode.SignatureHelpProvider, metadataOrTriggerChars: string[] | vscode.SignatureHelpProviderMetadata): vscode.Disposable {\n\t\tconst metadata: extHostProtocol.ISignatureHelpProviderMetadataDto | undefined = Array.isArray(metadataOrTriggerChars)\n\t\t\t? { triggerCharacters: metadataOrTriggerChars, retriggerCharacters: [] }\n\t\t\t: metadataOrTriggerChars;\n\n\t\tconst handle = this._addNewAdapter(new SignatureHelpAdapter(this._documents, provider), extension);\n\t\tthis._proxy.$registerSignatureHelpProvider(handle, this._transformDocumentSelector(selector), metadata);\n\t\treturn this._createDisposable(handle);\n\t}\n\n\t$provideSignatureHelp(handle: number, resource: UriComponents, position: IPosition, context: extHostProtocol.ISignatureHelpContextDto, token: CancellationToken): Promise<extHostProtocol.ISignatureHelpDto | undefined> {\n\t\treturn this._withAdapter(handle, SignatureHelpAdapter, adapter => adapter.provideSignatureHelp(URI.revive(resource), position, context, token), undefined);\n\t}\n\n\t$releaseSignatureHelp(handle: number, id: number): void {\n\t\tthis._withAdapter(handle, SignatureHelpAdapter, adapter => adapter.releaseSignatureHelp(id), undefined);\n\t}\n\n\t// --- inline hints\n\n\tregisterInlineHintsProvider(extension: IExtensionDescription, selector: vscode.DocumentSelector, provider: vscode.InlineHintsProvider): vscode.Disposable {\n\n\t\tconst eventHandle = typeof provider.onDidChangeInlineHints === 'function' ? this._nextHandle() : undefined;\n\t\tconst handle = this._addNewAdapter(new InlineHintsAdapter(this._documents, provider), extension);\n\n\t\tthis._proxy.$registerInlineHintsProvider(handle, this._transformDocumentSelector(selector), eventHandle);\n\t\tlet result = this._createDisposable(handle);\n\n\t\tif (eventHandle !== undefined) {\n\t\t\tconst subscription = provider.onDidChangeInlineHints!(_ => this._proxy.$emitInlineHintsEvent(eventHandle));\n\t\t\tresult = Disposable.from(result, subscription);\n\t\t}\n\t\treturn result;\n\t}\n\n\t$provideInlineHints(handle: number, resource: UriComponents, range: IRange, token: CancellationToken): Promise<extHostProtocol.IInlineHintsDto | undefined> {\n\t\treturn this._withAdapter(handle, InlineHintsAdapter, adapter => adapter.provideInlineHints(URI.revive(resource), range, token), undefined);\n\t}\n\n\t// --- links\n\n\tregisterDocumentLinkProvider(extension: IExtensionDescription | undefined, selector: vscode.DocumentSelector, provider: vscode.DocumentLinkProvider): vscode.Disposable {\n\t\tconst handle = this._addNewAdapter(new LinkProviderAdapter(this._documents, provider), extension);\n\t\tthis._proxy.$registerDocumentLinkProvider(handle, this._transformDocumentSelector(selector), typeof provider.resolveDocumentLink === 'function');\n\t\treturn this._createDisposable(handle);\n\t}\n\n\t$provideDocumentLinks(handle: number, resource: UriComponents, token: CancellationToken): Promise<extHostProtocol.ILinksListDto | undefined> {\n\t\treturn this._withAdapter(handle, LinkProviderAdapter, adapter => adapter.provideLinks(URI.revive(resource), token), undefined);\n\t}\n\n\t$resolveDocumentLink(handle: number, id: extHostProtocol.ChainedCacheId, token: CancellationToken): Promise<extHostProtocol.ILinkDto | undefined> {\n\t\treturn this._withAdapter(handle, LinkProviderAdapter, adapter => adapter.resolveLink(id, token), undefined);\n\t}\n\n\t$releaseDocumentLinks(handle: number, id: number): void {\n\t\tthis._withAdapter(handle, LinkProviderAdapter, adapter => adapter.releaseLinks(id), undefined);\n\t}\n\n\tregisterColorProvider(extension: IExtensionDescription, selector: vscode.DocumentSelector, provider: vscode.DocumentColorProvider): vscode.Disposable {\n\t\tconst handle = this._addNewAdapter(new ColorProviderAdapter(this._documents, provider), extension);\n\t\tthis._proxy.$registerDocumentColorProvider(handle, this._transformDocumentSelector(selector));\n\t\treturn this._createDisposable(handle);\n\t}\n\n\t$provideDocumentColors(handle: number, resource: UriComponents, token: CancellationToken): Promise<extHostProtocol.IRawColorInfo[]> {\n\t\treturn this._withAdapter(handle, ColorProviderAdapter, adapter => adapter.provideColors(URI.revive(resource), token), []);\n\t}\n\n\t$provideColorPresentations(handle: number, resource: UriComponents, colorInfo: extHostProtocol.IRawColorInfo, token: CancellationToken): Promise<modes.IColorPresentation[] | undefined> {\n\t\treturn this._withAdapter(handle, ColorProviderAdapter, adapter => adapter.provideColorPresentations(URI.revive(resource), colorInfo, token), undefined);\n\t}\n\n\tregisterFoldingRangeProvider(extension: IExtensionDescription, selector: vscode.DocumentSelector, provider: vscode.FoldingRangeProvider): vscode.Disposable {\n\t\tconst handle = this._nextHandle();\n\t\tconst eventHandle = typeof provider.onDidChangeFoldingRanges === 'function' ? this._nextHandle() : undefined;\n\n\t\tthis._adapter.set(handle, new AdapterData(new FoldingProviderAdapter(this._documents, provider), extension));\n\t\tthis._proxy.$registerFoldingRangeProvider(handle, this._transformDocumentSelector(selector), eventHandle);\n\t\tlet result = this._createDisposable(handle);\n\n\t\tif (eventHandle !== undefined) {\n\t\t\tconst subscription = provider.onDidChangeFoldingRanges!(() => this._proxy.$emitFoldingRangeEvent(eventHandle));\n\t\t\tresult = Disposable.from(result, subscription);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t$provideFoldingRanges(handle: number, resource: UriComponents, context: vscode.FoldingContext, token: CancellationToken): Promise<modes.FoldingRange[] | undefined> {\n\t\treturn this._withAdapter(handle, FoldingProviderAdapter, adapter => adapter.provideFoldingRanges(URI.revive(resource), context, token), undefined);\n\t}\n\n\t// --- smart select\n\n\tregisterSelectionRangeProvider(extension: IExtensionDescription, selector: vscode.DocumentSelector, provider: vscode.SelectionRangeProvider): vscode.Disposable {\n\t\tconst handle = this._addNewAdapter(new SelectionRangeAdapter(this._documents, provider, this._logService), extension);\n\t\tthis._proxy.$registerSelectionRangeProvider(handle, this._transformDocumentSelector(selector));\n\t\treturn this._createDisposable(handle);\n\t}\n\n\t$provideSelectionRanges(handle: number, resource: UriComponents, positions: IPosition[], token: CancellationToken): Promise<modes.SelectionRange[][]> {\n\t\treturn this._withAdapter(handle, SelectionRangeAdapter, adapter => adapter.provideSelectionRanges(URI.revive(resource), positions, token), []);\n\t}\n\n\t// --- call hierarchy\n\n\tregisterCallHierarchyProvider(extension: IExtensionDescription, selector: vscode.DocumentSelector, provider: vscode.CallHierarchyProvider): vscode.Disposable {\n\t\tconst handle = this._addNewAdapter(new CallHierarchyAdapter(this._documents, provider), extension);\n\t\tthis._proxy.$registerCallHierarchyProvider(handle, this._transformDocumentSelector(selector));\n\t\treturn this._createDisposable(handle);\n\t}\n\n\t$prepareCallHierarchy(handle: number, resource: UriComponents, position: IPosition, token: CancellationToken): Promise<extHostProtocol.ICallHierarchyItemDto[] | undefined> {\n\t\treturn this._withAdapter(handle, CallHierarchyAdapter, adapter => Promise.resolve(adapter.prepareSession(URI.revive(resource), position, token)), undefined);\n\t}\n\n\t$provideCallHierarchyIncomingCalls(handle: number, sessionId: string, itemId: string, token: CancellationToken): Promise<extHostProtocol.IIncomingCallDto[] | undefined> {\n\t\treturn this._withAdapter(handle, CallHierarchyAdapter, adapter => adapter.provideCallsTo(sessionId, itemId, token), undefined);\n\t}\n\n\t$provideCallHierarchyOutgoingCalls(handle: number, sessionId: string, itemId: string, token: CancellationToken): Promise<extHostProtocol.IOutgoingCallDto[] | undefined> {\n\t\treturn this._withAdapter(handle, CallHierarchyAdapter, adapter => adapter.provideCallsFrom(sessionId, itemId, token), undefined);\n\t}\n\n\t$releaseCallHierarchy(handle: number, sessionId: string): void {\n\t\tthis._withAdapter(handle, CallHierarchyAdapter, adapter => Promise.resolve(adapter.releaseSession(sessionId)), undefined);\n\t}\n\n\t// --- configuration\n\n\tprivate static _serializeRegExp(regExp: RegExp): extHostProtocol.IRegExpDto {\n\t\treturn {\n\t\t\tpattern: regExp.source,\n\t\t\tflags: regExpFlags(regExp),\n\t\t};\n\t}\n\n\tprivate static _serializeIndentationRule(indentationRule: vscode.IndentationRule): extHostProtocol.IIndentationRuleDto {\n\t\treturn {\n\t\t\tdecreaseIndentPattern: ExtHostLanguageFeatures._serializeRegExp(indentationRule.decreaseIndentPattern),\n\t\t\tincreaseIndentPattern: ExtHostLanguageFeatures._serializeRegExp(indentationRule.increaseIndentPattern),\n\t\t\tindentNextLinePattern: indentationRule.indentNextLinePattern ? ExtHostLanguageFeatures._serializeRegExp(indentationRule.indentNextLinePattern) : undefined,\n\t\t\tunIndentedLinePattern: indentationRule.unIndentedLinePattern ? ExtHostLanguageFeatures._serializeRegExp(indentationRule.unIndentedLinePattern) : undefined,\n\t\t};\n\t}\n\n\tprivate static _serializeOnEnterRule(onEnterRule: vscode.OnEnterRule): extHostProtocol.IOnEnterRuleDto {\n\t\treturn {\n\t\t\tbeforeText: ExtHostLanguageFeatures._serializeRegExp(onEnterRule.beforeText),\n\t\t\tafterText: onEnterRule.afterText ? ExtHostLanguageFeatures._serializeRegExp(onEnterRule.afterText) : undefined,\n\t\t\tpreviousLineText: onEnterRule.previousLineText ? ExtHostLanguageFeatures._serializeRegExp(onEnterRule.previousLineText) : undefined,\n\t\t\taction: onEnterRule.action\n\t\t};\n\t}\n\n\tprivate static _serializeOnEnterRules(onEnterRules: vscode.OnEnterRule[]): extHostProtocol.IOnEnterRuleDto[] {\n\t\treturn onEnterRules.map(ExtHostLanguageFeatures._serializeOnEnterRule);\n\t}\n\n\tsetLanguageConfiguration(extension: IExtensionDescription, languageId: string, configuration: vscode.LanguageConfiguration): vscode.Disposable {\n\t\tlet { wordPattern } = configuration;\n\n\t\t// check for a valid word pattern\n\t\tif (wordPattern && regExpLeadsToEndlessLoop(wordPattern)) {\n\t\t\tthrow new Error(`Invalid language configuration: wordPattern '${wordPattern}' is not allowed to match the empty string.`);\n\t\t}\n\n\t\t// word definition\n\t\tif (wordPattern) {\n\t\t\tthis._documents.setWordDefinitionFor(languageId, wordPattern);\n\t\t} else {\n\t\t\tthis._documents.setWordDefinitionFor(languageId, undefined);\n\t\t}\n\n\t\tif (configuration.__electricCharacterSupport) {\n\t\t\tthis._apiDeprecation.report('LanguageConfiguration.__electricCharacterSupport', extension,\n\t\t\t\t`Do not use.`);\n\t\t}\n\n\t\tif (configuration.__characterPairSupport) {\n\t\t\tthis._apiDeprecation.report('LanguageConfiguration.__characterPairSupport', extension,\n\t\t\t\t`Do not use.`);\n\t\t}\n\n\t\tconst handle = this._nextHandle();\n\t\tconst serializedConfiguration: extHostProtocol.ILanguageConfigurationDto = {\n\t\t\tcomments: configuration.comments,\n\t\t\tbrackets: configuration.brackets,\n\t\t\twordPattern: configuration.wordPattern ? ExtHostLanguageFeatures._serializeRegExp(configuration.wordPattern) : undefined,\n\t\t\tindentationRules: configuration.indentationRules ? ExtHostLanguageFeatures._serializeIndentationRule(configuration.indentationRules) : undefined,\n\t\t\tonEnterRules: configuration.onEnterRules ? ExtHostLanguageFeatures._serializeOnEnterRules(configuration.onEnterRules) : undefined,\n\t\t\t__electricCharacterSupport: configuration.__electricCharacterSupport,\n\t\t\t__characterPairSupport: configuration.__characterPairSupport,\n\t\t};\n\t\tthis._proxy.$setLanguageConfiguration(handle, languageId, serializedConfiguration);\n\t\treturn this._createDisposable(handle);\n\t}\n\n\t$setWordDefinitions(wordDefinitions: extHostProtocol.ILanguageWordDefinitionDto[]): void {\n\t\tfor (const wordDefinition of wordDefinitions) {\n\t\t\tthis._documents.setWordDefinitionFor(wordDefinition.languageId, new RegExp(wordDefinition.regexSource, wordDefinition.regexFlags));\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { MainContext, MainThreadLanguagesShape, IMainContext } from './extHost.protocol';\nimport type * as vscode from 'vscode';\nimport { ExtHostDocuments } from 'vs/workbench/api/common/extHostDocuments';\nimport * as typeConvert from 'vs/workbench/api/common/extHostTypeConverters';\nimport { StandardTokenType, Range, Position } from 'vs/workbench/api/common/extHostTypes';\n\nexport class ExtHostLanguages {\n\n\tprivate readonly _proxy: MainThreadLanguagesShape;\n\tprivate readonly _documents: ExtHostDocuments;\n\n\tconstructor(\n\t\tmainContext: IMainContext,\n\t\tdocuments: ExtHostDocuments\n\t) {\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadLanguages);\n\t\tthis._documents = documents;\n\t}\n\n\tgetLanguages(): Promise<string[]> {\n\t\treturn this._proxy.$getLanguages();\n\t}\n\n\tasync changeLanguage(uri: vscode.Uri, languageId: string): Promise<vscode.TextDocument> {\n\t\tawait this._proxy.$changeLanguage(uri, languageId);\n\t\tconst data = this._documents.getDocumentData(uri);\n\t\tif (!data) {\n\t\t\tthrow new Error(`document '${uri.toString}' NOT found`);\n\t\t}\n\t\treturn data.document;\n\t}\n\n\tasync tokenAtPosition(document: vscode.TextDocument, position: vscode.Position): Promise<vscode.TokenInformation> {\n\t\tconst versionNow = document.version;\n\t\tconst pos = typeConvert.Position.from(position);\n\t\tconst info = await this._proxy.$tokensAtPosition(document.uri, pos);\n\t\tconst defaultRange = {\n\t\t\ttype: StandardTokenType.Other,\n\t\t\trange: document.getWordRangeAtPosition(position) ?? new Range(position.line, position.character, position.line, position.character)\n\t\t};\n\t\tif (!info) {\n\t\t\t// no result\n\t\t\treturn defaultRange;\n\t\t}\n\t\tconst result = {\n\t\t\trange: typeConvert.Range.to(info.range),\n\t\t\ttype: typeConvert.TokenType.to(info.type)\n\t\t};\n\t\tif (!result.range.contains(<Position>position)) {\n\t\t\t// bogous result\n\t\t\treturn defaultRange;\n\t\t}\n\t\tif (versionNow !== document.version) {\n\t\t\t// concurrent change\n\t\t\treturn defaultRange;\n\t\t}\n\t\treturn result;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport Severity from 'vs/base/common/severity';\nimport type * as vscode from 'vscode';\nimport { MainContext, MainThreadMessageServiceShape, MainThreadMessageOptions, IMainContext } from './extHost.protocol';\nimport { IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { checkProposedApiEnabled } from 'vs/workbench/services/extensions/common/extensions';\n\nfunction isMessageItem(item: any): item is vscode.MessageItem {\n\treturn item && item.title;\n}\n\nexport class ExtHostMessageService {\n\n\tprivate _proxy: MainThreadMessageServiceShape;\n\n\tconstructor(\n\t\tmainContext: IMainContext,\n\t\t@ILogService private readonly _logService: ILogService\n\t) {\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadMessageService);\n\t}\n\n\n\tshowMessage(extension: IExtensionDescription, severity: Severity, message: string, optionsOrFirstItem: vscode.MessageOptions | string | undefined, rest: string[]): Promise<string | undefined>;\n\tshowMessage(extension: IExtensionDescription, severity: Severity, message: string, optionsOrFirstItem: vscode.MessageOptions | vscode.MessageItem | undefined, rest: vscode.MessageItem[]): Promise<vscode.MessageItem | undefined>;\n\tshowMessage(extension: IExtensionDescription, severity: Severity, message: string, optionsOrFirstItem: vscode.MessageOptions | vscode.MessageItem | string | undefined, rest: Array<vscode.MessageItem | string>): Promise<string | vscode.MessageItem | undefined>;\n\tshowMessage(extension: IExtensionDescription, severity: Severity, message: string, optionsOrFirstItem: vscode.MessageOptions | string | vscode.MessageItem | undefined, rest: Array<string | vscode.MessageItem>): Promise<string | vscode.MessageItem | undefined> {\n\n\t\tconst options: MainThreadMessageOptions = { extension };\n\t\tlet items: (string | vscode.MessageItem)[];\n\n\t\tif (typeof optionsOrFirstItem === 'string' || isMessageItem(optionsOrFirstItem)) {\n\t\t\titems = [optionsOrFirstItem, ...rest];\n\t\t} else {\n\t\t\toptions.modal = optionsOrFirstItem && optionsOrFirstItem.modal;\n\t\t\toptions.useCustom = optionsOrFirstItem && optionsOrFirstItem.useCustom;\n\t\t\titems = rest;\n\t\t}\n\n\t\tif (options.useCustom) {\n\t\t\tcheckProposedApiEnabled(extension);\n\t\t}\n\n\t\tconst commands: { title: string; isCloseAffordance: boolean; handle: number; }[] = [];\n\n\t\tfor (let handle = 0; handle < items.length; handle++) {\n\t\t\tconst command = items[handle];\n\t\t\tif (typeof command === 'string') {\n\t\t\t\tcommands.push({ title: command, handle, isCloseAffordance: false });\n\t\t\t} else if (typeof command === 'object') {\n\t\t\t\tlet { title, isCloseAffordance } = command;\n\t\t\t\tcommands.push({ title, isCloseAffordance: !!isCloseAffordance, handle });\n\t\t\t} else {\n\t\t\t\tthis._logService.warn('Invalid message item:', command);\n\t\t\t}\n\t\t}\n\n\t\treturn this._proxy.$showMessage(severity, message, options, commands).then(handle => {\n\t\t\tif (typeof handle === 'number') {\n\t\t\t\treturn items[handle];\n\t\t\t}\n\t\t\treturn undefined;\n\t\t});\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken, CancellationTokenSource } from 'vs/base/common/cancellation';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { Disposable, DisposableStore } from 'vs/base/common/lifecycle';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport * as UUID from 'vs/base/common/uuid';\nimport { IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { ExtHostNotebookShape, ICommandDto, IMainContext, IModelAddedData, INotebookDocumentPropertiesChangeData, INotebookDocumentsAndEditorsDelta, INotebookDocumentShowOptions, INotebookEditorPropertiesChangeData, MainContext, MainThreadBulkEditsShape, MainThreadNotebookShape } from 'vs/workbench/api/common/extHost.protocol';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { CommandsConverter, ExtHostCommands } from 'vs/workbench/api/common/extHostCommands';\nimport { ExtHostDocumentsAndEditors } from 'vs/workbench/api/common/extHostDocumentsAndEditors';\nimport { IExtensionStoragePaths } from 'vs/workbench/api/common/extHostStoragePaths';\nimport * as typeConverters from 'vs/workbench/api/common/extHostTypeConverters';\nimport * as extHostTypes from 'vs/workbench/api/common/extHostTypes';\nimport { asWebviewUri, WebviewInitData } from 'vs/workbench/api/common/shared/webview';\nimport { addIdToOutput, CellStatusbarAlignment, CellUri, INotebookCellStatusBarEntry, INotebookDisplayOrder, INotebookExclusiveDocumentFilter, INotebookKernelInfoDto2, NotebookCellMetadata, NotebookCellsChangedEventDto, NotebookCellsChangeType, NotebookDataDto, notebookDocumentMetadataDefaults } from 'vs/workbench/contrib/notebook/common/notebookCommon';\nimport * as vscode from 'vscode';\nimport { ResourceMap } from 'vs/base/common/map';\nimport { ExtHostCell, ExtHostNotebookDocument } from './extHostNotebookDocument';\nimport { ExtHostNotebookEditor } from './extHostNotebookEditor';\nimport { IdGenerator } from 'vs/base/common/idGenerator';\nimport { IRelativePattern } from 'vs/base/common/glob';\nimport { assertIsDefined } from 'vs/base/common/types';\n\nclass ExtHostWebviewCommWrapper extends Disposable {\n\tprivate readonly _onDidReceiveDocumentMessage = new Emitter<any>();\n\tprivate readonly _rendererIdToEmitters = new Map<string, Emitter<any>>();\n\n\tconstructor(\n\t\tprivate _editorId: string,\n\t\tpublic uri: URI,\n\t\tprivate _proxy: MainThreadNotebookShape,\n\t\tprivate _webviewInitData: WebviewInitData,\n\t\tpublic document: ExtHostNotebookDocument,\n\t) {\n\t\tsuper();\n\t}\n\n\tpublic onDidReceiveMessage(forRendererId: string | undefined, message: any) {\n\t\tthis._onDidReceiveDocumentMessage.fire(message);\n\t\tif (forRendererId !== undefined) {\n\t\t\tthis._rendererIdToEmitters.get(forRendererId)?.fire(message);\n\t\t}\n\t}\n\n\tpublic readonly contentProviderComm: vscode.NotebookCommunication = {\n\t\teditorId: this._editorId,\n\t\tonDidReceiveMessage: this._onDidReceiveDocumentMessage.event,\n\t\tpostMessage: (message: any) => this._proxy.$postMessage(this._editorId, undefined, message),\n\t\tasWebviewUri: (uri: vscode.Uri) => this._asWebviewUri(uri),\n\t};\n\n\tpublic getRendererComm(rendererId: string): vscode.NotebookCommunication {\n\t\tconst emitter = new Emitter<any>();\n\t\tthis._rendererIdToEmitters.set(rendererId, emitter);\n\t\treturn {\n\t\t\teditorId: this._editorId,\n\t\t\tonDidReceiveMessage: emitter.event,\n\t\t\tpostMessage: (message: any) => this._proxy.$postMessage(this._editorId, rendererId, message),\n\t\t\tasWebviewUri: (uri: vscode.Uri) => this._asWebviewUri(uri),\n\t\t};\n\t}\n\n\n\tprivate _asWebviewUri(localResource: vscode.Uri): vscode.Uri {\n\t\treturn asWebviewUri(this._webviewInitData, this._editorId, localResource);\n\t}\n}\n\n\n\nexport interface ExtHostNotebookOutputRenderingHandler {\n\toutputDisplayOrder: INotebookDisplayOrder | undefined;\n}\n\nexport class ExtHostNotebookKernelProviderAdapter extends Disposable {\n\tprivate _kernelToFriendlyId = new Map<vscode.NotebookKernel, string>();\n\tprivate _friendlyIdToKernel = new Map<string, vscode.NotebookKernel>();\n\tconstructor(\n\t\tprivate readonly _proxy: MainThreadNotebookShape,\n\t\tprivate readonly _handle: number,\n\t\tprivate readonly _extension: IExtensionDescription,\n\t\tprivate readonly _provider: vscode.NotebookKernelProvider\n\t) {\n\t\tsuper();\n\n\t\tif (this._provider.onDidChangeKernels) {\n\t\t\tthis._register(this._provider.onDidChangeKernels((e: vscode.NotebookDocument | undefined) => {\n\t\t\t\tconst uri = e?.uri;\n\t\t\t\tthis._proxy.$onNotebookKernelChange(this._handle, uri);\n\t\t\t}));\n\t\t}\n\t}\n\n\tasync provideKernels(document: ExtHostNotebookDocument, token: vscode.CancellationToken): Promise<INotebookKernelInfoDto2[]> {\n\t\tconst data = await this._provider.provideKernels(document.notebookDocument, token) || [];\n\n\t\tconst newMap = new Map<vscode.NotebookKernel, string>();\n\t\tlet kernel_unique_pool = 0;\n\t\tconst kernelFriendlyIdCache = new Set<string>();\n\n\t\tconst transformedData: INotebookKernelInfoDto2[] = data.map(kernel => {\n\t\t\tlet friendlyId = this._kernelToFriendlyId.get(kernel);\n\t\t\tif (friendlyId === undefined) {\n\t\t\t\tif (kernel.id && kernelFriendlyIdCache.has(kernel.id)) {\n\t\t\t\t\tfriendlyId = `${this._extension.identifier.value}_${kernel.id}_${kernel_unique_pool++}`;\n\t\t\t\t} else {\n\t\t\t\t\tfriendlyId = `${this._extension.identifier.value}_${kernel.id || UUID.generateUuid()}`;\n\t\t\t\t}\n\n\t\t\t\tthis._kernelToFriendlyId.set(kernel, friendlyId);\n\t\t\t}\n\n\t\t\tnewMap.set(kernel, friendlyId);\n\n\t\t\treturn {\n\t\t\t\tid: kernel.id,\n\t\t\t\tfriendlyId: friendlyId,\n\t\t\t\tlabel: kernel.label,\n\t\t\t\textension: this._extension.identifier,\n\t\t\t\textensionLocation: this._extension.extensionLocation,\n\t\t\t\tdescription: kernel.description,\n\t\t\t\tdetail: kernel.detail,\n\t\t\t\tisPreferred: kernel.isPreferred,\n\t\t\t\tpreloads: kernel.preloads\n\t\t\t};\n\t\t});\n\n\t\tthis._kernelToFriendlyId = newMap;\n\n\t\tthis._friendlyIdToKernel.clear();\n\t\tthis._kernelToFriendlyId.forEach((value, key) => {\n\t\t\tthis._friendlyIdToKernel.set(value, key);\n\t\t});\n\n\t\treturn transformedData;\n\t}\n\n\tgetKernelByFriendlyId(kernelId: string) {\n\t\treturn this._friendlyIdToKernel.get(kernelId);\n\t}\n\n\tasync resolveNotebook(kernelId: string, document: ExtHostNotebookDocument, webview: vscode.NotebookCommunication, token: CancellationToken) {\n\t\tconst kernel = this._friendlyIdToKernel.get(kernelId);\n\n\t\tif (kernel && this._provider.resolveKernel) {\n\t\t\treturn this._provider.resolveKernel(kernel, document.notebookDocument, webview, token);\n\t\t}\n\t}\n\n\tasync executeNotebook(kernelId: string, document: ExtHostNotebookDocument, cell: ExtHostCell | undefined) {\n\t\tconst kernel = this._friendlyIdToKernel.get(kernelId);\n\n\t\tif (!kernel) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (cell) {\n\t\t\treturn withToken(token => (kernel.executeCell as any)(document.notebookDocument, cell.cell, token));\n\t\t} else {\n\t\t\treturn withToken(token => (kernel.executeAllCells as any)(document.notebookDocument, token));\n\t\t}\n\t}\n\n\tasync cancelNotebook(kernelId: string, document: ExtHostNotebookDocument, cell: ExtHostCell | undefined) {\n\t\tconst kernel = this._friendlyIdToKernel.get(kernelId);\n\n\t\tif (!kernel) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (cell) {\n\t\t\treturn kernel.cancelCellExecution(document.notebookDocument, cell.cell);\n\t\t} else {\n\t\t\treturn kernel.cancelAllCellsExecution(document.notebookDocument);\n\t\t}\n\t}\n}\n\n// TODO@roblou remove 'token' passed to all execute APIs once extensions are updated\nasync function withToken(cb: (token: CancellationToken) => any) {\n\tconst source = new CancellationTokenSource();\n\ttry {\n\t\tawait cb(source.token);\n\t} finally {\n\t\tsource.dispose();\n\t}\n}\n\nexport class NotebookEditorDecorationType implements vscode.NotebookEditorDecorationType {\n\n\tprivate static readonly _Keys = new IdGenerator('NotebookEditorDecorationType');\n\n\tprivate _proxy: MainThreadNotebookShape;\n\tpublic key: string;\n\n\tconstructor(proxy: MainThreadNotebookShape, options: vscode.NotebookDecorationRenderOptions) {\n\t\tthis.key = NotebookEditorDecorationType._Keys.nextId();\n\t\tthis._proxy = proxy;\n\t\tthis._proxy.$registerNotebookEditorDecorationType(this.key, typeConverters.NotebookDecorationRenderOptions.from(options));\n\t}\n\n\tpublic dispose(): void {\n\t\tthis._proxy.$removeNotebookEditorDecorationType(this.key);\n\t}\n}\n\nexport class ExtHostNotebookController implements ExtHostNotebookShape, ExtHostNotebookOutputRenderingHandler {\n\tprivate static _notebookKernelProviderHandlePool: number = 0;\n\n\tprivate readonly _proxy: MainThreadNotebookShape;\n\tprivate readonly _mainThreadBulkEdits: MainThreadBulkEditsShape;\n\tprivate readonly _notebookContentProviders = new Map<string, { readonly provider: vscode.NotebookContentProvider, readonly extension: IExtensionDescription; }>();\n\tprivate readonly _notebookKernelProviders = new Map<number, ExtHostNotebookKernelProviderAdapter>();\n\tprivate readonly _documents = new ResourceMap<ExtHostNotebookDocument>();\n\tprivate readonly _editors = new Map<string, { editor: ExtHostNotebookEditor; }>();\n\tprivate readonly _webviewComm = new Map<string, ExtHostWebviewCommWrapper>();\n\tprivate readonly _commandsConverter: CommandsConverter;\n\tprivate readonly _onDidChangeNotebookEditorSelection = new Emitter<vscode.NotebookEditorSelectionChangeEvent>();\n\treadonly onDidChangeNotebookEditorSelection = this._onDidChangeNotebookEditorSelection.event;\n\tprivate readonly _onDidChangeNotebookEditorVisibleRanges = new Emitter<vscode.NotebookEditorVisibleRangesChangeEvent>();\n\treadonly onDidChangeNotebookEditorVisibleRanges = this._onDidChangeNotebookEditorVisibleRanges.event;\n\tprivate readonly _onDidChangeNotebookDocumentMetadata = new Emitter<vscode.NotebookDocumentMetadataChangeEvent>();\n\treadonly onDidChangeNotebookDocumentMetadata = this._onDidChangeNotebookDocumentMetadata.event;\n\tprivate readonly _onDidChangeNotebookCells = new Emitter<vscode.NotebookCellsChangeEvent>();\n\treadonly onDidChangeNotebookCells = this._onDidChangeNotebookCells.event;\n\tprivate readonly _onDidChangeCellOutputs = new Emitter<vscode.NotebookCellOutputsChangeEvent>();\n\treadonly onDidChangeCellOutputs = this._onDidChangeCellOutputs.event;\n\tprivate readonly _onDidChangeCellLanguage = new Emitter<vscode.NotebookCellLanguageChangeEvent>();\n\treadonly onDidChangeCellLanguage = this._onDidChangeCellLanguage.event;\n\tprivate readonly _onDidChangeCellMetadata = new Emitter<vscode.NotebookCellMetadataChangeEvent>();\n\treadonly onDidChangeCellMetadata = this._onDidChangeCellMetadata.event;\n\tprivate readonly _onDidChangeActiveNotebookEditor = new Emitter<vscode.NotebookEditor | undefined>();\n\treadonly onDidChangeActiveNotebookEditor = this._onDidChangeActiveNotebookEditor.event;\n\n\tprivate _outputDisplayOrder: INotebookDisplayOrder | undefined;\n\n\tget outputDisplayOrder(): INotebookDisplayOrder | undefined {\n\t\treturn this._outputDisplayOrder;\n\t}\n\n\tprivate _activeNotebookEditor: ExtHostNotebookEditor | undefined;\n\n\tget activeNotebookEditor() {\n\t\treturn this._activeNotebookEditor;\n\t}\n\n\tprivate _onDidOpenNotebookDocument = new Emitter<vscode.NotebookDocument>();\n\tonDidOpenNotebookDocument: Event<vscode.NotebookDocument> = this._onDidOpenNotebookDocument.event;\n\tprivate _onDidCloseNotebookDocument = new Emitter<vscode.NotebookDocument>();\n\tonDidCloseNotebookDocument: Event<vscode.NotebookDocument> = this._onDidCloseNotebookDocument.event;\n\tprivate _onDidSaveNotebookDocument = new Emitter<vscode.NotebookDocument>();\n\tonDidSaveNotebookDocument: Event<vscode.NotebookDocument> = this._onDidCloseNotebookDocument.event;\n\tvisibleNotebookEditors: ExtHostNotebookEditor[] = [];\n\tprivate _onDidChangeActiveNotebookKernel = new Emitter<{ document: vscode.NotebookDocument, kernel: vscode.NotebookKernel | undefined; }>();\n\tonDidChangeActiveNotebookKernel = this._onDidChangeActiveNotebookKernel.event;\n\tprivate _onDidChangeVisibleNotebookEditors = new Emitter<vscode.NotebookEditor[]>();\n\tonDidChangeVisibleNotebookEditors = this._onDidChangeVisibleNotebookEditors.event;\n\n\tconstructor(\n\t\tmainContext: IMainContext,\n\t\tcommands: ExtHostCommands,\n\t\tprivate _documentsAndEditors: ExtHostDocumentsAndEditors,\n\t\tprivate readonly _webviewInitData: WebviewInitData,\n\t\tprivate readonly logService: ILogService,\n\t\tprivate readonly _extensionStoragePaths: IExtensionStoragePaths,\n\t) {\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadNotebook);\n\t\tthis._mainThreadBulkEdits = mainContext.getProxy(MainContext.MainThreadBulkEdits);\n\t\tthis._commandsConverter = commands.converter;\n\n\t\tcommands.registerArgumentProcessor({\n\t\t\t// Serialized INotebookCellActionContext\n\t\t\tprocessArgument: (arg) => {\n\t\t\t\tif (arg && arg.$mid === 12) {\n\t\t\t\t\tconst notebookUri = arg.notebookEditor?.notebookUri;\n\t\t\t\t\tconst cellHandle = arg.cell.handle;\n\n\t\t\t\t\tconst data = this._documents.get(notebookUri);\n\t\t\t\t\tconst cell = data?.getCell(cellHandle);\n\t\t\t\t\tif (cell) {\n\t\t\t\t\t\treturn cell.cell;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn arg;\n\t\t\t}\n\t\t});\n\t}\n\n\tget notebookDocuments() {\n\t\treturn [...this._documents.values()];\n\t}\n\n\tlookupNotebookDocument(uri: URI): ExtHostNotebookDocument | undefined {\n\t\treturn this._documents.get(uri);\n\t}\n\n\tregisterNotebookContentProvider(\n\t\textension: IExtensionDescription,\n\t\tviewType: string,\n\t\tprovider: vscode.NotebookContentProvider,\n\t\toptions?: {\n\t\t\ttransientOutputs: boolean;\n\t\t\ttransientMetadata: { [K in keyof NotebookCellMetadata]?: boolean };\n\t\t\tviewOptions?: {\n\t\t\t\tdisplayName: string;\n\t\t\t\tfilenamePattern: (vscode.GlobPattern | { include: vscode.GlobPattern; exclude: vscode.GlobPattern })[];\n\t\t\t\texclusive?: boolean;\n\t\t\t};\n\t\t}\n\t): vscode.Disposable {\n\n\t\tif (this._notebookContentProviders.has(viewType)) {\n\t\t\tthrow new Error(`Notebook provider for '${viewType}' already registered`);\n\t\t}\n\n\t\tthis._notebookContentProviders.set(viewType, { extension, provider });\n\t\tconst listeners: vscode.Disposable[] = [];\n\n\t\tlisteners.push(provider.onDidChangeNotebook\n\t\t\t? provider.onDidChangeNotebook(e => {\n\t\t\t\tconst document = this._documents.get(URI.revive(e.document.uri));\n\n\t\t\t\tif (!document) {\n\t\t\t\t\tthrow new Error(`Notebook document ${e.document.uri.toString()} not found`);\n\t\t\t\t}\n\n\t\t\t\tif (isEditEvent(e)) {\n\t\t\t\t\tconst editId = document.addEdit(e);\n\t\t\t\t\tthis._proxy.$onUndoableContentChange(e.document.uri, viewType, editId, e.label);\n\t\t\t\t} else {\n\t\t\t\t\tthis._proxy.$onContentChange(e.document.uri, viewType);\n\t\t\t\t}\n\t\t\t})\n\t\t\t: Disposable.None);\n\n\t\tlisteners.push(provider.onDidChangeNotebookContentOptions\n\t\t\t? provider.onDidChangeNotebookContentOptions(() => {\n\t\t\t\tthis._proxy.$updateNotebookProviderOptions(viewType, provider.options);\n\t\t\t})\n\t\t\t: Disposable.None);\n\n\t\tconst supportBackup = !!provider.backupNotebook;\n\n\t\tconst viewOptionsFilenamePattern = options?.viewOptions?.filenamePattern\n\t\t\t.map(pattern => typeConverters.NotebookExclusiveDocumentPattern.from(pattern))\n\t\t\t.filter(pattern => pattern !== undefined) as (string | IRelativePattern | INotebookExclusiveDocumentFilter)[];\n\n\t\tif (options?.viewOptions?.filenamePattern && !viewOptionsFilenamePattern) {\n\t\t\tconsole.warn(`Notebook content provider view options file name pattern is invalid ${options?.viewOptions?.filenamePattern}`);\n\t\t}\n\n\t\tthis._proxy.$registerNotebookProvider({ id: extension.identifier, location: extension.extensionLocation, description: extension.description }, viewType, supportBackup, {\n\t\t\ttransientOutputs: options?.transientOutputs || false,\n\t\t\ttransientMetadata: options?.transientMetadata || {},\n\t\t\tviewOptions: options?.viewOptions && viewOptionsFilenamePattern ? { displayName: options.viewOptions.displayName, filenamePattern: viewOptionsFilenamePattern, exclusive: options.viewOptions.exclusive || false } : undefined\n\t\t});\n\n\t\treturn new extHostTypes.Disposable(() => {\n\t\t\tlisteners.forEach(d => d.dispose());\n\t\t\tthis._notebookContentProviders.delete(viewType);\n\t\t\tthis._proxy.$unregisterNotebookProvider(viewType);\n\t\t});\n\t}\n\n\tregisterNotebookKernelProvider(extension: IExtensionDescription, selector: vscode.NotebookDocumentFilter, provider: vscode.NotebookKernelProvider) {\n\t\tconst handle = ExtHostNotebookController._notebookKernelProviderHandlePool++;\n\t\tconst adapter = new ExtHostNotebookKernelProviderAdapter(this._proxy, handle, extension, provider);\n\t\tthis._notebookKernelProviders.set(handle, adapter);\n\t\tthis._proxy.$registerNotebookKernelProvider({ id: extension.identifier, location: extension.extensionLocation, description: extension.description }, handle, {\n\t\t\tviewType: selector.viewType,\n\t\t\tfilenamePattern: selector.filenamePattern ? typeConverters.NotebookExclusiveDocumentPattern.from(selector.filenamePattern) : undefined\n\t\t});\n\n\t\treturn new extHostTypes.Disposable(() => {\n\t\t\tadapter.dispose();\n\t\t\tthis._notebookKernelProviders.delete(handle);\n\t\t\tthis._proxy.$unregisterNotebookKernelProvider(handle);\n\t\t});\n\t}\n\n\tcreateNotebookEditorDecorationType(options: vscode.NotebookDecorationRenderOptions): vscode.NotebookEditorDecorationType {\n\t\treturn new NotebookEditorDecorationType(this._proxy, options);\n\t}\n\n\tasync openNotebookDocument(uriComponents: UriComponents, viewType?: string): Promise<vscode.NotebookDocument> {\n\t\tconst cached = this._documents.get(URI.revive(uriComponents));\n\t\tif (cached) {\n\t\t\treturn Promise.resolve(cached.notebookDocument);\n\t\t}\n\n\t\tawait this._proxy.$tryOpenDocument(uriComponents, viewType);\n\t\tconst document = this._documents.get(URI.revive(uriComponents));\n\t\treturn assertIsDefined(document?.notebookDocument);\n\t}\n\n\tprivate _withAdapter<T>(handle: number, uri: UriComponents, callback: (adapter: ExtHostNotebookKernelProviderAdapter, document: ExtHostNotebookDocument) => Promise<T>) {\n\t\tconst document = this._documents.get(URI.revive(uri));\n\n\t\tif (!document) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst provider = this._notebookKernelProviders.get(handle);\n\n\t\tif (!provider) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn callback(provider, document);\n\t}\n\n\tasync showNotebookDocument(notebookDocument: vscode.NotebookDocument, options?: vscode.NotebookDocumentShowOptions): Promise<vscode.NotebookEditor> {\n\t\tlet resolvedOptions: INotebookDocumentShowOptions;\n\t\tif (typeof options === 'object') {\n\t\t\tresolvedOptions = {\n\t\t\t\tposition: typeConverters.ViewColumn.from(options.viewColumn),\n\t\t\t\tpreserveFocus: options.preserveFocus,\n\t\t\t\tselection: options.selection,\n\t\t\t\tpinned: typeof options.preview === 'boolean' ? !options.preview : undefined\n\t\t\t};\n\t\t} else {\n\t\t\tresolvedOptions = {\n\t\t\t\tpreserveFocus: false\n\t\t\t};\n\t\t}\n\n\t\tconst editorId = await this._proxy.$tryShowNotebookDocument(notebookDocument.uri, notebookDocument.viewType, resolvedOptions);\n\t\tconst editor = editorId && this._editors.get(editorId)?.editor;\n\n\t\tif (editor) {\n\t\t\treturn editor;\n\t\t}\n\n\t\tif (editorId) {\n\t\t\tthrow new Error(`Could NOT open editor for \"${notebookDocument.toString()}\" because another editor opened in the meantime.`);\n\t\t} else {\n\t\t\tthrow new Error(`Could NOT open editor for \"${notebookDocument.toString()}\".`);\n\t\t}\n\t}\n\n\tasync $provideNotebookKernels(handle: number, uri: UriComponents, token: CancellationToken): Promise<INotebookKernelInfoDto2[]> {\n\t\treturn this._withAdapter<INotebookKernelInfoDto2[]>(handle, uri, (adapter, document) => {\n\t\t\treturn adapter.provideKernels(document, token);\n\t\t});\n\t}\n\n\tasync $resolveNotebookKernel(handle: number, editorId: string, uri: UriComponents, kernelId: string, token: CancellationToken): Promise<void> {\n\t\tawait this._withAdapter<void>(handle, uri, async (adapter, document) => {\n\t\t\tconst webComm = this._webviewComm.get(editorId);\n\n\t\t\tif (webComm) {\n\t\t\t\tawait adapter.resolveNotebook(kernelId, document, webComm.contentProviderComm, token);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync $resolveNotebookData(viewType: string, uri: UriComponents, backupId?: string): Promise<NotebookDataDto> {\n\t\tconst provider = this._notebookContentProviders.get(viewType);\n\t\tif (!provider) {\n\t\t\tthrow new Error(`NO provider for '${viewType}'`);\n\t\t}\n\n\t\tconst data = await provider.provider.openNotebook(URI.revive(uri), { backupId });\n\t\treturn {\n\t\t\tmetadata: {\n\t\t\t\t...notebookDocumentMetadataDefaults,\n\t\t\t\t...data.metadata\n\t\t\t},\n\t\t\tlanguages: data.languages,\n\t\t\tcells: data.cells.map(cell => ({\n\t\t\t\t...cell,\n\t\t\t\toutputs: cell.outputs.map(o => addIdToOutput(o))\n\t\t\t})),\n\t\t};\n\t}\n\n\tasync $resolveNotebookEditor(viewType: string, uri: UriComponents, editorId: string): Promise<void> {\n\t\tconst provider = this._notebookContentProviders.get(viewType);\n\t\tconst revivedUri = URI.revive(uri);\n\t\tconst document = this._documents.get(revivedUri);\n\t\tif (!document || !provider) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet webComm = this._webviewComm.get(editorId);\n\t\tif (!webComm) {\n\t\t\twebComm = new ExtHostWebviewCommWrapper(editorId, revivedUri, this._proxy, this._webviewInitData, document);\n\t\t\tthis._webviewComm.set(editorId, webComm);\n\t\t}\n\n\t\tif (!provider.provider.resolveNotebook) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait provider.provider.resolveNotebook(document.notebookDocument, webComm.contentProviderComm);\n\t}\n\n\tasync $executeNotebookKernelFromProvider(handle: number, uri: UriComponents, kernelId: string, cellHandle: number | undefined): Promise<void> {\n\t\tawait this._withAdapter(handle, uri, async (adapter, document) => {\n\t\t\tconst cell = cellHandle !== undefined ? document.getCell(cellHandle) : undefined;\n\n\t\t\treturn adapter.executeNotebook(kernelId, document, cell);\n\t\t});\n\t}\n\n\tasync $cancelNotebookKernelFromProvider(handle: number, uri: UriComponents, kernelId: string, cellHandle: number | undefined): Promise<void> {\n\t\tawait this._withAdapter(handle, uri, async (adapter, document) => {\n\t\t\tconst cell = cellHandle !== undefined ? document.getCell(cellHandle) : undefined;\n\n\t\t\treturn adapter.cancelNotebook(kernelId, document, cell);\n\t\t});\n\t}\n\n\tasync $saveNotebook(viewType: string, uri: UriComponents, token: CancellationToken): Promise<boolean> {\n\t\tconst document = this._documents.get(URI.revive(uri));\n\t\tif (!document) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this._notebookContentProviders.has(viewType)) {\n\t\t\tawait this._notebookContentProviders.get(viewType)!.provider.saveNotebook(document.notebookDocument, token);\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tasync $saveNotebookAs(viewType: string, uri: UriComponents, target: UriComponents, token: CancellationToken): Promise<boolean> {\n\t\tconst document = this._documents.get(URI.revive(uri));\n\t\tif (!document) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this._notebookContentProviders.has(viewType)) {\n\t\t\tawait this._notebookContentProviders.get(viewType)!.provider.saveNotebookAs(URI.revive(target), document.notebookDocument, token);\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tasync $undoNotebook(viewType: string, uri: UriComponents, editId: number, isDirty: boolean): Promise<void> {\n\t\tconst document = this._documents.get(URI.revive(uri));\n\t\tif (!document) {\n\t\t\treturn;\n\t\t}\n\n\t\tdocument.undo(editId, isDirty);\n\n\t}\n\n\tasync $redoNotebook(viewType: string, uri: UriComponents, editId: number, isDirty: boolean): Promise<void> {\n\t\tconst document = this._documents.get(URI.revive(uri));\n\t\tif (!document) {\n\t\t\treturn;\n\t\t}\n\n\t\tdocument.redo(editId, isDirty);\n\t}\n\n\n\tasync $backup(viewType: string, uri: UriComponents, cancellation: CancellationToken): Promise<string | undefined> {\n\t\tconst document = this._documents.get(URI.revive(uri));\n\t\tconst provider = this._notebookContentProviders.get(viewType);\n\n\t\tif (document && provider && provider.provider.backupNotebook) {\n\t\t\tconst backup = await provider.provider.backupNotebook(document.notebookDocument, { destination: document.getNewBackupUri() }, cancellation);\n\t\t\tdocument.updateBackup(backup);\n\t\t\treturn backup.id;\n\t\t}\n\n\t\treturn;\n\t}\n\n\t$acceptDisplayOrder(displayOrder: INotebookDisplayOrder): void {\n\t\tthis._outputDisplayOrder = displayOrder;\n\t}\n\n\t$acceptNotebookActiveKernelChange(event: { uri: UriComponents, providerHandle: number | undefined, kernelFriendlyId: string | undefined; }) {\n\t\tif (event.providerHandle !== undefined) {\n\t\t\tthis._withAdapter(event.providerHandle, event.uri, async (adapter, document) => {\n\t\t\t\tconst kernel = event.kernelFriendlyId ? adapter.getKernelByFriendlyId(event.kernelFriendlyId) : undefined;\n\t\t\t\tthis._editors.forEach(editor => {\n\t\t\t\t\tif (editor.editor.notebookData === document) {\n\t\t\t\t\t\teditor.editor._acceptKernel(kernel);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis._onDidChangeActiveNotebookKernel.fire({ document: document.notebookDocument, kernel });\n\t\t\t});\n\t\t}\n\t}\n\n\t// TODO@rebornix: remove document - editor one on one mapping\n\tprivate _getEditorFromURI(uriComponents: UriComponents) {\n\t\tconst uriStr = URI.revive(uriComponents).toString();\n\t\tlet editor: { editor: ExtHostNotebookEditor; } | undefined;\n\t\tthis._editors.forEach(e => {\n\t\t\tif (e.editor.document.uri.toString() === uriStr) {\n\t\t\t\teditor = e;\n\t\t\t}\n\t\t});\n\n\t\treturn editor;\n\t}\n\n\t$onDidReceiveMessage(editorId: string, forRendererType: string | undefined, message: any): void {\n\t\tthis._webviewComm.get(editorId)?.onDidReceiveMessage(forRendererType, message);\n\t}\n\n\t$acceptModelChanged(uriComponents: UriComponents, event: NotebookCellsChangedEventDto, isDirty: boolean): void {\n\t\tconst document = this._documents.get(URI.revive(uriComponents));\n\t\tif (document) {\n\t\t\tdocument.acceptModelChanged(event, isDirty);\n\t\t}\n\t}\n\n\tpublic $acceptModelSaved(uriComponents: UriComponents): void {\n\t\tconst document = this._documents.get(URI.revive(uriComponents));\n\t\tif (document) {\n\t\t\t// this.$acceptDirtyStateChanged(uriComponents, false);\n\t\t\tthis._onDidSaveNotebookDocument.fire(document.notebookDocument);\n\t\t}\n\t}\n\n\t$acceptEditorPropertiesChanged(id: string, data: INotebookEditorPropertiesChangeData): void {\n\t\tthis.logService.debug('ExtHostNotebook#$acceptEditorPropertiesChanged', id, data);\n\n\t\tlet editor: { editor: ExtHostNotebookEditor; } | undefined;\n\t\tthis._editors.forEach(e => {\n\t\t\tif (e.editor.id === id) {\n\t\t\t\teditor = e;\n\t\t\t}\n\t\t});\n\n\t\tif (!editor) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (data.visibleRanges) {\n\t\t\teditor.editor._acceptVisibleRanges(data.visibleRanges.ranges);\n\t\t\tthis._onDidChangeNotebookEditorVisibleRanges.fire({\n\t\t\t\tnotebookEditor: editor.editor,\n\t\t\t\tvisibleRanges: editor.editor.visibleRanges\n\t\t\t});\n\t\t}\n\n\t\tif (data.selections) {\n\t\t\tif (data.selections.selections.length) {\n\t\t\t\tconst firstCell = data.selections.selections[0];\n\t\t\t\teditor.editor.selection = editor.editor.notebookData.getCell(firstCell)?.cell;\n\t\t\t} else {\n\t\t\t\teditor.editor.selection = undefined;\n\t\t\t}\n\n\t\t\tthis._onDidChangeNotebookEditorSelection.fire({\n\t\t\t\tnotebookEditor: editor.editor,\n\t\t\t\tselection: editor.editor.selection\n\t\t\t});\n\t\t}\n\t}\n\n\t$acceptDocumentPropertiesChanged(uriComponents: UriComponents, data: INotebookDocumentPropertiesChangeData): void {\n\t\tthis.logService.debug('ExtHostNotebook#$acceptDocumentPropertiesChanged', uriComponents.path, data);\n\t\tconst editor = this._getEditorFromURI(uriComponents);\n\n\t\tif (!editor) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (data.metadata) {\n\t\t\teditor.editor.notebookData.acceptDocumentPropertiesChanged(data);\n\t\t}\n\t}\n\n\tprivate _createExtHostEditor(document: ExtHostNotebookDocument, editorId: string, selections: number[], visibleRanges: vscode.NotebookCellRange[]) {\n\t\tconst revivedUri = document.uri;\n\t\tlet webComm = this._webviewComm.get(editorId);\n\n\t\tif (!webComm) {\n\t\t\twebComm = new ExtHostWebviewCommWrapper(editorId, revivedUri, this._proxy, this._webviewInitData, document);\n\t\t\tthis._webviewComm.set(editorId, webComm);\n\t\t}\n\n\t\tconst editor = new ExtHostNotebookEditor(\n\t\t\teditorId,\n\t\t\tdocument.notebookDocument.viewType,\n\t\t\tthis._proxy,\n\t\t\twebComm.contentProviderComm,\n\t\t\tdocument\n\t\t);\n\n\t\tif (selections.length) {\n\t\t\tconst firstCell = selections[0];\n\t\t\teditor.selection = editor.notebookData.getCell(firstCell)?.cell;\n\t\t} else {\n\t\t\teditor.selection = undefined;\n\t\t}\n\n\t\teditor._acceptVisibleRanges(visibleRanges);\n\n\t\tthis._editors.get(editorId)?.editor.dispose();\n\t\tthis._editors.set(editorId, { editor });\n\t}\n\n\t$acceptDocumentAndEditorsDelta(delta: INotebookDocumentsAndEditorsDelta): void {\n\t\tlet editorChanged = false;\n\n\t\tif (delta.removedDocuments) {\n\t\t\tfor (const uri of delta.removedDocuments) {\n\t\t\t\tconst revivedUri = URI.revive(uri);\n\t\t\t\tconst document = this._documents.get(revivedUri);\n\n\t\t\t\tif (document) {\n\t\t\t\t\tdocument.dispose();\n\t\t\t\t\tthis._documents.delete(revivedUri);\n\t\t\t\t\tthis._documentsAndEditors.$acceptDocumentsAndEditorsDelta({ removedDocuments: document.notebookDocument.cells.map(cell => cell.uri) });\n\t\t\t\t\tthis._onDidCloseNotebookDocument.fire(document.notebookDocument);\n\t\t\t\t}\n\n\t\t\t\tfor (const e of this._editors.values()) {\n\t\t\t\t\tif (e.editor.document.uri.toString() === revivedUri.toString()) {\n\t\t\t\t\t\te.editor.dispose();\n\t\t\t\t\t\tthis._editors.delete(e.editor.id);\n\t\t\t\t\t\teditorChanged = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (delta.addedDocuments) {\n\n\t\t\tconst addedCellDocuments: IModelAddedData[] = [];\n\n\t\t\tfor (const modelData of delta.addedDocuments) {\n\t\t\t\tconst uri = URI.revive(modelData.uri);\n\t\t\t\tconst viewType = modelData.viewType;\n\t\t\t\tconst entry = this._notebookContentProviders.get(viewType);\n\t\t\t\tconst storageRoot = entry && (this._extensionStoragePaths.workspaceValue(entry.extension) ?? this._extensionStoragePaths.globalValue(entry.extension));\n\n\t\t\t\tif (this._documents.has(uri)) {\n\t\t\t\t\tthrow new Error(`adding EXISTING notebook ${uri}`);\n\t\t\t\t}\n\t\t\t\tconst that = this;\n\n\t\t\t\tconst document = new ExtHostNotebookDocument(this._proxy, this._documentsAndEditors, this._mainThreadBulkEdits, {\n\t\t\t\t\temitModelChange(event: vscode.NotebookCellsChangeEvent): void {\n\t\t\t\t\t\tthat._onDidChangeNotebookCells.fire(event);\n\t\t\t\t\t},\n\t\t\t\t\temitCellOutputsChange(event: vscode.NotebookCellOutputsChangeEvent): void {\n\t\t\t\t\t\tthat._onDidChangeCellOutputs.fire(event);\n\t\t\t\t\t},\n\t\t\t\t\temitCellLanguageChange(event: vscode.NotebookCellLanguageChangeEvent): void {\n\t\t\t\t\t\tthat._onDidChangeCellLanguage.fire(event);\n\t\t\t\t\t},\n\t\t\t\t\temitCellMetadataChange(event: vscode.NotebookCellMetadataChangeEvent): void {\n\t\t\t\t\t\tthat._onDidChangeCellMetadata.fire(event);\n\t\t\t\t\t},\n\t\t\t\t\temitDocumentMetadataChange(event: vscode.NotebookDocumentMetadataChangeEvent): void {\n\t\t\t\t\t\tthat._onDidChangeNotebookDocumentMetadata.fire(event);\n\t\t\t\t\t}\n\t\t\t\t}, viewType, modelData.contentOptions, { ...notebookDocumentMetadataDefaults, ...modelData.metadata }, uri, storageRoot);\n\n\t\t\t\tdocument.acceptModelChanged({\n\t\t\t\t\tversionId: modelData.versionId,\n\t\t\t\t\trawEvents: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tkind: NotebookCellsChangeType.Initialize,\n\t\t\t\t\t\t\tchanges: [[\n\t\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\t\tmodelData.cells\n\t\t\t\t\t\t\t]]\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}, false);\n\n\t\t\t\t// add cell document as vscode.TextDocument\n\t\t\t\taddedCellDocuments.push(...modelData.cells.map(cell => ExtHostCell.asModelAddData(document.notebookDocument, cell)));\n\n\t\t\t\tthis._documents.get(uri)?.dispose();\n\t\t\t\tthis._documents.set(uri, document);\n\n\t\t\t\t// create editor if populated\n\t\t\t\tif (modelData.attachedEditor) {\n\t\t\t\t\tthis._createExtHostEditor(document, modelData.attachedEditor.id, modelData.attachedEditor.selections, modelData.attachedEditor.visibleRanges);\n\t\t\t\t\teditorChanged = true;\n\t\t\t\t}\n\n\t\t\t\tthis._documentsAndEditors.$acceptDocumentsAndEditorsDelta({ addedDocuments: addedCellDocuments });\n\n\t\t\t\tthis._onDidOpenNotebookDocument.fire(document.notebookDocument);\n\t\t\t}\n\t\t}\n\n\t\tif (delta.addedEditors) {\n\t\t\tfor (const editorModelData of delta.addedEditors) {\n\t\t\t\tif (this._editors.has(editorModelData.id)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst revivedUri = URI.revive(editorModelData.documentUri);\n\t\t\t\tconst document = this._documents.get(revivedUri);\n\n\t\t\t\tif (document) {\n\t\t\t\t\tthis._createExtHostEditor(document, editorModelData.id, editorModelData.selections, editorModelData.visibleRanges);\n\t\t\t\t\teditorChanged = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst removedEditors: { editor: ExtHostNotebookEditor; }[] = [];\n\n\t\tif (delta.removedEditors) {\n\t\t\tfor (const editorid of delta.removedEditors) {\n\t\t\t\tconst editor = this._editors.get(editorid);\n\n\t\t\t\tif (editor) {\n\t\t\t\t\teditorChanged = true;\n\t\t\t\t\tthis._editors.delete(editorid);\n\n\t\t\t\t\tif (this.activeNotebookEditor?.id === editor.editor.id) {\n\t\t\t\t\t\tthis._activeNotebookEditor = undefined;\n\t\t\t\t\t}\n\n\t\t\t\t\tremovedEditors.push(editor);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (editorChanged) {\n\t\t\tremovedEditors.forEach(e => {\n\t\t\t\te.editor.dispose();\n\t\t\t});\n\t\t}\n\n\t\tif (delta.visibleEditors) {\n\t\t\tthis.visibleNotebookEditors = delta.visibleEditors.map(id => this._editors.get(id)!.editor).filter(editor => !!editor) as ExtHostNotebookEditor[];\n\t\t\tconst visibleEditorsSet = new Set<string>();\n\t\t\tthis.visibleNotebookEditors.forEach(editor => visibleEditorsSet.add(editor.id));\n\n\t\t\tfor (const e of this._editors.values()) {\n\t\t\t\tconst newValue = visibleEditorsSet.has(e.editor.id);\n\t\t\t\te.editor._acceptVisibility(newValue);\n\t\t\t}\n\n\t\t\tthis.visibleNotebookEditors = [...this._editors.values()].map(e => e.editor).filter(e => e.visible);\n\t\t\tthis._onDidChangeVisibleNotebookEditors.fire(this.visibleNotebookEditors);\n\t\t}\n\n\t\tif (delta.newActiveEditor !== undefined) {\n\t\t\tif (delta.newActiveEditor) {\n\t\t\t\tthis._activeNotebookEditor = this._editors.get(delta.newActiveEditor)?.editor;\n\t\t\t\tthis._activeNotebookEditor?._acceptActive(true);\n\t\t\t\tfor (const e of this._editors.values()) {\n\t\t\t\t\tif (e.editor !== this.activeNotebookEditor) {\n\t\t\t\t\t\te.editor._acceptActive(false);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// clear active notebook as current active editor is non-notebook editor\n\t\t\t\tthis._activeNotebookEditor = undefined;\n\t\t\t\tfor (const e of this._editors.values()) {\n\t\t\t\t\te.editor._acceptActive(false);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._onDidChangeActiveNotebookEditor.fire(this._activeNotebookEditor);\n\t\t}\n\t}\n\n\tcreateNotebookCellStatusBarItemInternal(cell: vscode.NotebookCell, alignment: extHostTypes.NotebookCellStatusBarAlignment | undefined, priority: number | undefined) {\n\t\tconst statusBarItem = new NotebookCellStatusBarItemInternal(this._proxy, this._commandsConverter, cell, alignment, priority);\n\n\t\t// Look up the ExtHostCell for this NotebookCell URI, bind to its disposable lifecycle\n\t\tconst parsedUri = CellUri.parse(cell.uri);\n\t\tif (parsedUri) {\n\t\t\tconst document = this._documents.get(parsedUri.notebook);\n\t\t\tif (document) {\n\t\t\t\tconst cell = document.getCell(parsedUri.handle);\n\t\t\t\tif (cell) {\n\t\t\t\t\tEvent.once(cell.onDidDispose)(() => statusBarItem.dispose());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn statusBarItem;\n\t}\n}\n\nfunction isEditEvent(e: vscode.NotebookDocumentEditEvent | vscode.NotebookDocumentContentChangeEvent): e is vscode.NotebookDocumentEditEvent {\n\treturn typeof (e as vscode.NotebookDocumentEditEvent).undo === 'function'\n\t\t&& typeof (e as vscode.NotebookDocumentEditEvent).redo === 'function';\n}\n\nexport class NotebookCellStatusBarItemInternal extends Disposable {\n\tprivate static NEXT_ID = 0;\n\n\tprivate readonly _id = NotebookCellStatusBarItemInternal.NEXT_ID++;\n\tprivate readonly _internalCommandRegistration: DisposableStore;\n\n\tprivate _isDisposed = false;\n\tprivate _alignment: extHostTypes.NotebookCellStatusBarAlignment;\n\n\tconstructor(\n\t\tprivate readonly _proxy: MainThreadNotebookShape,\n\t\tprivate readonly _commands: CommandsConverter,\n\t\tprivate readonly _cell: vscode.NotebookCell,\n\t\talignment: extHostTypes.NotebookCellStatusBarAlignment | undefined,\n\t\tprivate _priority: number | undefined) {\n\t\tsuper();\n\t\tthis._internalCommandRegistration = this._register(new DisposableStore());\n\t\tthis._alignment = alignment ?? extHostTypes.NotebookCellStatusBarAlignment.Left;\n\t}\n\n\tprivate _apiItem: vscode.NotebookCellStatusBarItem | undefined;\n\tget apiItem(): vscode.NotebookCellStatusBarItem {\n\t\tif (!this._apiItem) {\n\t\t\tthis._apiItem = createNotebookCellStatusBarApiItem(this);\n\t\t}\n\n\t\treturn this._apiItem;\n\t}\n\n\tget cell(): vscode.NotebookCell {\n\t\treturn this._cell;\n\t}\n\n\tget alignment(): extHostTypes.NotebookCellStatusBarAlignment {\n\t\treturn this._alignment;\n\t}\n\n\tset alignment(v: extHostTypes.NotebookCellStatusBarAlignment) {\n\t\tthis._alignment = v;\n\t\tthis.update();\n\t}\n\n\tget priority(): number | undefined {\n\t\treturn this._priority;\n\t}\n\n\tset priority(v: number | undefined) {\n\t\tthis._priority = v;\n\t\tthis.update();\n\t}\n\n\tprivate _text: string = '';\n\tget text(): string {\n\t\treturn this._text;\n\t}\n\n\tset text(v: string) {\n\t\tthis._text = v;\n\t\tthis.update();\n\t}\n\n\tprivate _tooltip: string | undefined;\n\tget tooltip(): string | undefined {\n\t\treturn this._tooltip;\n\t}\n\n\tset tooltip(v: string | undefined) {\n\t\tthis._tooltip = v;\n\t\tthis.update();\n\t}\n\n\tprivate _command?: {\n\t\treadonly fromApi: string | vscode.Command,\n\t\treadonly internal: ICommandDto,\n\t};\n\tget command(): string | vscode.Command | undefined {\n\t\treturn this._command?.fromApi;\n\t}\n\n\tset command(command: string | vscode.Command | undefined) {\n\t\tif (this._command?.fromApi === command) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._internalCommandRegistration.clear();\n\t\tif (typeof command === 'string') {\n\t\t\tthis._command = {\n\t\t\t\tfromApi: command,\n\t\t\t\tinternal: this._commands.toInternal({ title: '', command }, this._internalCommandRegistration),\n\t\t\t};\n\t\t} else if (command) {\n\t\t\tthis._command = {\n\t\t\t\tfromApi: command,\n\t\t\t\tinternal: this._commands.toInternal(command, this._internalCommandRegistration),\n\t\t\t};\n\t\t} else {\n\t\t\tthis._command = undefined;\n\t\t}\n\t\tthis.update();\n\t}\n\n\tprivate _accessibilityInformation: vscode.AccessibilityInformation | undefined;\n\tget accessibilityInformation(): vscode.AccessibilityInformation | undefined {\n\t\treturn this._accessibilityInformation;\n\t}\n\n\tset accessibilityInformation(v: vscode.AccessibilityInformation | undefined) {\n\t\tthis._accessibilityInformation = v;\n\t\tthis.update();\n\t}\n\n\tprivate _visible: boolean = false;\n\tshow(): void {\n\t\tthis._visible = true;\n\t\tthis.update();\n\t}\n\n\thide(): void {\n\t\tthis._visible = false;\n\t\tthis.update();\n\t}\n\n\tdispose(): void {\n\t\tthis.hide();\n\t\tthis._isDisposed = true;\n\t\tthis._internalCommandRegistration.dispose();\n\t}\n\n\tprivate update(): void {\n\t\tif (this._isDisposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst entry: INotebookCellStatusBarEntry = {\n\t\t\talignment: this.alignment === extHostTypes.NotebookCellStatusBarAlignment.Left ? CellStatusbarAlignment.LEFT : CellStatusbarAlignment.RIGHT,\n\t\t\tcellResource: this.cell.uri,\n\t\t\tcommand: this._command?.internal,\n\t\t\ttext: this.text,\n\t\t\ttooltip: this.tooltip,\n\t\t\taccessibilityInformation: this.accessibilityInformation,\n\t\t\tpriority: this.priority,\n\t\t\tvisible: this._visible\n\t\t};\n\n\t\tthis._proxy.$setStatusBarEntry(this._id, entry);\n\t}\n}\n\nfunction createNotebookCellStatusBarApiItem(internalItem: NotebookCellStatusBarItemInternal): vscode.NotebookCellStatusBarItem {\n\treturn Object.freeze({\n\t\tcell: internalItem.cell,\n\t\tget alignment() { return internalItem.alignment; },\n\t\tset alignment(v: NotebookCellStatusBarItemInternal['alignment']) { internalItem.alignment = v; },\n\n\t\tget priority() { return internalItem.priority; },\n\t\tset priority(v: NotebookCellStatusBarItemInternal['priority']) { internalItem.priority = v; },\n\n\t\tget text() { return internalItem.text; },\n\t\tset text(v: NotebookCellStatusBarItemInternal['text']) { internalItem.text = v; },\n\n\t\tget tooltip() { return internalItem.tooltip; },\n\t\tset tooltip(v: NotebookCellStatusBarItemInternal['tooltip']) { internalItem.tooltip = v; },\n\n\t\tget command() { return internalItem.command; },\n\t\tset command(v: NotebookCellStatusBarItemInternal['command']) { internalItem.command = v; },\n\n\t\tget accessibilityInformation() { return internalItem.accessibilityInformation; },\n\t\tset accessibilityInformation(v: NotebookCellStatusBarItemInternal['accessibilityInformation']) { internalItem.accessibilityInformation = v; },\n\n\t\tshow() { internalItem.show(); },\n\t\thide() { internalItem.hide(); },\n\t\tdispose() { internalItem.dispose(); }\n\t});\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { MainContext, MainThreadOutputServiceShape, ExtHostOutputServiceShape } from './extHost.protocol';\nimport type * as vscode from 'vscode';\nimport { URI } from 'vs/base/common/uri';\nimport { Event, Emitter } from 'vs/base/common/event';\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport { VSBuffer } from 'vs/base/common/buffer';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { IExtHostRpcService } from 'vs/workbench/api/common/extHostRpcService';\n\nexport abstract class AbstractExtHostOutputChannel extends Disposable implements vscode.OutputChannel {\n\n\treadonly _id: Promise<string>;\n\tprivate readonly _name: string;\n\tprotected readonly _proxy: MainThreadOutputServiceShape;\n\tprivate _disposed: boolean;\n\tprivate _offset: number;\n\n\tprotected readonly _onDidAppend: Emitter<void> = this._register(new Emitter<void>());\n\treadonly onDidAppend: Event<void> = this._onDidAppend.event;\n\n\tconstructor(name: string, log: boolean, file: URI | undefined, proxy: MainThreadOutputServiceShape) {\n\t\tsuper();\n\n\t\tthis._name = name;\n\t\tthis._proxy = proxy;\n\t\tthis._id = proxy.$register(this.name, log, file);\n\t\tthis._disposed = false;\n\t\tthis._offset = 0;\n\t}\n\n\tget name(): string {\n\t\treturn this._name;\n\t}\n\n\tappend(value: string): void {\n\t\tthis.validate();\n\t\tthis._offset += value ? VSBuffer.fromString(value).byteLength : 0;\n\t}\n\n\tupdate(): void {\n\t\tthis._id.then(id => this._proxy.$update(id));\n\t}\n\n\tappendLine(value: string): void {\n\t\tthis.validate();\n\t\tthis.append(value + '\\n');\n\t}\n\n\tclear(): void {\n\t\tthis.validate();\n\t\tconst till = this._offset;\n\t\tthis._id.then(id => this._proxy.$clear(id, till));\n\t}\n\n\tshow(columnOrPreserveFocus?: vscode.ViewColumn | boolean, preserveFocus?: boolean): void {\n\t\tthis.validate();\n\t\tthis._id.then(id => this._proxy.$reveal(id, !!(typeof columnOrPreserveFocus === 'boolean' ? columnOrPreserveFocus : preserveFocus)));\n\t}\n\n\thide(): void {\n\t\tthis.validate();\n\t\tthis._id.then(id => this._proxy.$close(id));\n\t}\n\n\tprotected validate(): void {\n\t\tif (this._disposed) {\n\t\t\tthrow new Error('Channel has been closed');\n\t\t}\n\t}\n\n\tdispose(): void {\n\t\tsuper.dispose();\n\n\t\tif (!this._disposed) {\n\t\t\tthis._id\n\t\t\t\t.then(id => this._proxy.$dispose(id))\n\t\t\t\t.then(() => this._disposed = true);\n\t\t}\n\t}\n}\n\nexport class ExtHostPushOutputChannel extends AbstractExtHostOutputChannel {\n\n\tconstructor(name: string, proxy: MainThreadOutputServiceShape) {\n\t\tsuper(name, false, undefined, proxy);\n\t}\n\n\tappend(value: string): void {\n\t\tsuper.append(value);\n\t\tthis._id.then(id => this._proxy.$append(id, value));\n\t\tthis._onDidAppend.fire();\n\t}\n}\n\nclass ExtHostLogFileOutputChannel extends AbstractExtHostOutputChannel {\n\n\tconstructor(name: string, file: URI, proxy: MainThreadOutputServiceShape) {\n\t\tsuper(name, true, file, proxy);\n\t}\n\n\tappend(value: string): void {\n\t\tthrow new Error('Not supported');\n\t}\n}\n\nexport class LazyOutputChannel implements vscode.OutputChannel {\n\n\tconstructor(\n\t\treadonly name: string,\n\t\tprivate readonly _channel: Promise<AbstractExtHostOutputChannel>\n\t) { }\n\n\tappend(value: string): void {\n\t\tthis._channel.then(channel => channel.append(value));\n\t}\n\tappendLine(value: string): void {\n\t\tthis._channel.then(channel => channel.appendLine(value));\n\t}\n\tclear(): void {\n\t\tthis._channel.then(channel => channel.clear());\n\t}\n\tshow(columnOrPreserveFocus?: vscode.ViewColumn | boolean, preserveFocus?: boolean): void {\n\t\tthis._channel.then(channel => channel.show(columnOrPreserveFocus, preserveFocus));\n\t}\n\thide(): void {\n\t\tthis._channel.then(channel => channel.hide());\n\t}\n\tdispose(): void {\n\t\tthis._channel.then(channel => channel.dispose());\n\t}\n}\n\nexport class ExtHostOutputService implements ExtHostOutputServiceShape {\n\n\treadonly _serviceBrand: undefined;\n\n\tprotected readonly _proxy: MainThreadOutputServiceShape;\n\n\tconstructor(@IExtHostRpcService extHostRpc: IExtHostRpcService) {\n\t\tthis._proxy = extHostRpc.getProxy(MainContext.MainThreadOutputService);\n\t}\n\n\t$setVisibleChannel(channelId: string): void {\n\t}\n\n\tcreateOutputChannel(name: string): vscode.OutputChannel {\n\t\tname = name.trim();\n\t\tif (!name) {\n\t\t\tthrow new Error('illegal argument `name`. must not be falsy');\n\t\t}\n\t\treturn new ExtHostPushOutputChannel(name, this._proxy);\n\t}\n\n\tcreateOutputChannelFromLogFile(name: string, file: URI): vscode.OutputChannel {\n\t\tname = name.trim();\n\t\tif (!name) {\n\t\t\tthrow new Error('illegal argument `name`. must not be falsy');\n\t\t}\n\t\tif (!file) {\n\t\t\tthrow new Error('illegal argument `file`. must not be falsy');\n\t\t}\n\t\treturn new ExtHostLogFileOutputChannel(name, file, this._proxy);\n\t}\n}\n\nexport interface IExtHostOutputService extends ExtHostOutputService { }\nexport const IExtHostOutputService = createDecorator<IExtHostOutputService>('IExtHostOutputService');\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { asPromise } from 'vs/base/common/async';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { Emitter } from 'vs/base/common/event';\nimport { dispose, IDisposable } from 'vs/base/common/lifecycle';\nimport { ExtHostCommands } from 'vs/workbench/api/common/extHostCommands';\nimport { IExtHostWorkspaceProvider } from 'vs/workbench/api/common/extHostWorkspace';\nimport { InputBox, InputBoxOptions, QuickInput, QuickInputButton, QuickPick, QuickPickItem, QuickPickOptions, WorkspaceFolder, WorkspaceFolderPickOptions } from 'vscode';\nimport { ExtHostQuickOpenShape, IMainContext, MainContext, MainThreadQuickOpenShape, TransferQuickPickItems, TransferQuickInput, TransferQuickInputButton } from './extHost.protocol';\nimport { URI } from 'vs/base/common/uri';\nimport { ThemeIcon, QuickInputButtons } from 'vs/workbench/api/common/extHostTypes';\nimport { isPromiseCanceledError } from 'vs/base/common/errors';\nimport { ExtensionIdentifier } from 'vs/platform/extensions/common/extensions';\nimport { coalesce } from 'vs/base/common/arrays';\n\nexport type Item = string | QuickPickItem;\n\nexport class ExtHostQuickOpen implements ExtHostQuickOpenShape {\n\n\tprivate _proxy: MainThreadQuickOpenShape;\n\tprivate _workspace: IExtHostWorkspaceProvider;\n\tprivate _commands: ExtHostCommands;\n\n\tprivate _onDidSelectItem?: (handle: number) => void;\n\tprivate _validateInput?: (input: string) => string | undefined | null | Thenable<string | undefined | null>;\n\n\tprivate _sessions = new Map<number, ExtHostQuickInput>();\n\n\tprivate _instances = 0;\n\n\tconstructor(mainContext: IMainContext, workspace: IExtHostWorkspaceProvider, commands: ExtHostCommands) {\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadQuickOpen);\n\t\tthis._workspace = workspace;\n\t\tthis._commands = commands;\n\t}\n\n\tshowQuickPick(itemsOrItemsPromise: QuickPickItem[] | Promise<QuickPickItem[]>, enableProposedApi: boolean, options: QuickPickOptions & { canPickMany: true; }, token?: CancellationToken): Promise<QuickPickItem[] | undefined>;\n\tshowQuickPick(itemsOrItemsPromise: string[] | Promise<string[]>, enableProposedApi: boolean, options?: QuickPickOptions, token?: CancellationToken): Promise<string | undefined>;\n\tshowQuickPick(itemsOrItemsPromise: QuickPickItem[] | Promise<QuickPickItem[]>, enableProposedApi: boolean, options?: QuickPickOptions, token?: CancellationToken): Promise<QuickPickItem | undefined>;\n\tshowQuickPick(itemsOrItemsPromise: Item[] | Promise<Item[]>, enableProposedApi: boolean, options?: QuickPickOptions, token: CancellationToken = CancellationToken.None): Promise<Item | Item[] | undefined> {\n\n\t\t// clear state from last invocation\n\t\tthis._onDidSelectItem = undefined;\n\n\t\tconst itemsPromise = <Promise<Item[]>>Promise.resolve(itemsOrItemsPromise);\n\n\t\tconst instance = ++this._instances;\n\n\t\tconst quickPickWidget = this._proxy.$show(instance, {\n\t\t\tplaceHolder: options && options.placeHolder,\n\t\t\tmatchOnDescription: options && options.matchOnDescription,\n\t\t\tmatchOnDetail: options && options.matchOnDetail,\n\t\t\tignoreFocusLost: options && options.ignoreFocusOut,\n\t\t\tcanPickMany: options && options.canPickMany\n\t\t}, token);\n\n\t\tconst widgetClosedMarker = {};\n\t\tconst widgetClosedPromise = quickPickWidget.then(() => widgetClosedMarker);\n\n\t\treturn Promise.race([widgetClosedPromise, itemsPromise]).then(result => {\n\t\t\tif (result === widgetClosedMarker) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\treturn itemsPromise.then(items => {\n\n\t\t\t\tconst pickItems: TransferQuickPickItems[] = [];\n\t\t\t\tfor (let handle = 0; handle < items.length; handle++) {\n\n\t\t\t\t\tconst item = items[handle];\n\t\t\t\t\tlet label: string;\n\t\t\t\t\tlet description: string | undefined;\n\t\t\t\t\tlet detail: string | undefined;\n\t\t\t\t\tlet picked: boolean | undefined;\n\t\t\t\t\tlet alwaysShow: boolean | undefined;\n\n\t\t\t\t\tif (typeof item === 'string') {\n\t\t\t\t\t\tlabel = item;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlabel = item.label;\n\t\t\t\t\t\tdescription = item.description;\n\t\t\t\t\t\tdetail = item.detail;\n\t\t\t\t\t\tpicked = item.picked;\n\t\t\t\t\t\talwaysShow = item.alwaysShow;\n\t\t\t\t\t}\n\t\t\t\t\tpickItems.push({\n\t\t\t\t\t\tlabel,\n\t\t\t\t\t\tdescription,\n\t\t\t\t\t\thandle,\n\t\t\t\t\t\tdetail,\n\t\t\t\t\t\tpicked,\n\t\t\t\t\t\talwaysShow\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// handle selection changes\n\t\t\t\tif (options && typeof options.onDidSelectItem === 'function') {\n\t\t\t\t\tthis._onDidSelectItem = (handle) => {\n\t\t\t\t\t\toptions.onDidSelectItem!(items[handle]);\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// show items\n\t\t\t\tthis._proxy.$setItems(instance, pickItems);\n\n\t\t\t\treturn quickPickWidget.then(handle => {\n\t\t\t\t\tif (typeof handle === 'number') {\n\t\t\t\t\t\treturn items[handle];\n\t\t\t\t\t} else if (Array.isArray(handle)) {\n\t\t\t\t\t\treturn handle.map(h => items[h]);\n\t\t\t\t\t}\n\t\t\t\t\treturn undefined;\n\t\t\t\t});\n\t\t\t});\n\t\t}).then(undefined, err => {\n\t\t\tif (isPromiseCanceledError(err)) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\n\t\t\tthis._proxy.$setError(instance, err);\n\n\t\t\treturn Promise.reject(err);\n\t\t});\n\t}\n\n\t$onItemSelected(handle: number): void {\n\t\tif (this._onDidSelectItem) {\n\t\t\tthis._onDidSelectItem(handle);\n\t\t}\n\t}\n\n\t// ---- input\n\n\tshowInput(options?: InputBoxOptions, token: CancellationToken = CancellationToken.None): Promise<string | undefined> {\n\n\t\t// global validate fn used in callback below\n\t\tthis._validateInput = options ? options.validateInput : undefined;\n\n\t\treturn this._proxy.$input(options, typeof this._validateInput === 'function', token)\n\t\t\t.then(undefined, err => {\n\t\t\t\tif (isPromiseCanceledError(err)) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\treturn Promise.reject(err);\n\t\t\t});\n\t}\n\n\t$validateInput(input: string): Promise<string | null | undefined> {\n\t\tif (this._validateInput) {\n\t\t\treturn asPromise(() => this._validateInput!(input));\n\t\t}\n\t\treturn Promise.resolve(undefined);\n\t}\n\n\t// ---- workspace folder picker\n\n\tasync showWorkspaceFolderPick(options?: WorkspaceFolderPickOptions, token = CancellationToken.None): Promise<WorkspaceFolder | undefined> {\n\t\tconst selectedFolder = await this._commands.executeCommand<WorkspaceFolder>('_workbench.pickWorkspaceFolder', [options]);\n\t\tif (!selectedFolder) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst workspaceFolders = await this._workspace.getWorkspaceFolders2();\n\t\tif (!workspaceFolders) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn workspaceFolders.find(folder => folder.uri.toString() === selectedFolder.uri.toString());\n\t}\n\n\t// ---- QuickInput\n\n\tcreateQuickPick<T extends QuickPickItem>(extensionId: ExtensionIdentifier, enableProposedApi: boolean): QuickPick<T> {\n\t\tconst session: ExtHostQuickPick<T> = new ExtHostQuickPick(this._proxy, extensionId, enableProposedApi, () => this._sessions.delete(session._id));\n\t\tthis._sessions.set(session._id, session);\n\t\treturn session;\n\t}\n\n\tcreateInputBox(extensionId: ExtensionIdentifier): InputBox {\n\t\tconst session: ExtHostInputBox = new ExtHostInputBox(this._proxy, extensionId, () => this._sessions.delete(session._id));\n\t\tthis._sessions.set(session._id, session);\n\t\treturn session;\n\t}\n\n\t$onDidChangeValue(sessionId: number, value: string): void {\n\t\tconst session = this._sessions.get(sessionId);\n\t\tif (session) {\n\t\t\tsession._fireDidChangeValue(value);\n\t\t}\n\t}\n\n\t$onDidAccept(sessionId: number): void {\n\t\tconst session = this._sessions.get(sessionId);\n\t\tif (session) {\n\t\t\tsession._fireDidAccept();\n\t\t}\n\t}\n\n\t$onDidChangeActive(sessionId: number, handles: number[]): void {\n\t\tconst session = this._sessions.get(sessionId);\n\t\tif (session instanceof ExtHostQuickPick) {\n\t\t\tsession._fireDidChangeActive(handles);\n\t\t}\n\t}\n\n\t$onDidChangeSelection(sessionId: number, handles: number[]): void {\n\t\tconst session = this._sessions.get(sessionId);\n\t\tif (session instanceof ExtHostQuickPick) {\n\t\t\tsession._fireDidChangeSelection(handles);\n\t\t}\n\t}\n\n\t$onDidTriggerButton(sessionId: number, handle: number): void {\n\t\tconst session = this._sessions.get(sessionId);\n\t\tif (session) {\n\t\t\tsession._fireDidTriggerButton(handle);\n\t\t}\n\t}\n\n\t$onDidHide(sessionId: number): void {\n\t\tconst session = this._sessions.get(sessionId);\n\t\tif (session) {\n\t\t\tsession._fireDidHide();\n\t\t}\n\t}\n}\n\nclass ExtHostQuickInput implements QuickInput {\n\n\tprivate static _nextId = 1;\n\t_id = ExtHostQuickPick._nextId++;\n\n\tprivate _title: string | undefined;\n\tprivate _steps: number | undefined;\n\tprivate _totalSteps: number | undefined;\n\tprivate _visible = false;\n\tprivate _expectingHide = false;\n\tprivate _enabled = true;\n\tprivate _busy = false;\n\tprivate _ignoreFocusOut = true;\n\tprivate _value = '';\n\tprivate _placeholder: string | undefined;\n\tprivate _buttons: QuickInputButton[] = [];\n\tprivate _handlesToButtons = new Map<number, QuickInputButton>();\n\tprivate readonly _onDidAcceptEmitter = new Emitter<void>();\n\tprivate readonly _onDidChangeValueEmitter = new Emitter<string>();\n\tprivate readonly _onDidTriggerButtonEmitter = new Emitter<QuickInputButton>();\n\tprivate readonly _onDidHideEmitter = new Emitter<void>();\n\tprivate _updateTimeout: any;\n\tprivate _pendingUpdate: TransferQuickInput = { id: this._id };\n\n\tprivate _disposed = false;\n\tprotected _disposables: IDisposable[] = [\n\t\tthis._onDidTriggerButtonEmitter,\n\t\tthis._onDidHideEmitter,\n\t\tthis._onDidAcceptEmitter,\n\t\tthis._onDidChangeValueEmitter\n\t];\n\n\tconstructor(protected _proxy: MainThreadQuickOpenShape, protected _extensionId: ExtensionIdentifier, private _onDidDispose: () => void) {\n\t}\n\n\tget title() {\n\t\treturn this._title;\n\t}\n\n\tset title(title: string | undefined) {\n\t\tthis._title = title;\n\t\tthis.update({ title });\n\t}\n\n\tget step() {\n\t\treturn this._steps;\n\t}\n\n\tset step(step: number | undefined) {\n\t\tthis._steps = step;\n\t\tthis.update({ step });\n\t}\n\n\tget totalSteps() {\n\t\treturn this._totalSteps;\n\t}\n\n\tset totalSteps(totalSteps: number | undefined) {\n\t\tthis._totalSteps = totalSteps;\n\t\tthis.update({ totalSteps });\n\t}\n\n\tget enabled() {\n\t\treturn this._enabled;\n\t}\n\n\tset enabled(enabled: boolean) {\n\t\tthis._enabled = enabled;\n\t\tthis.update({ enabled });\n\t}\n\n\tget busy() {\n\t\treturn this._busy;\n\t}\n\n\tset busy(busy: boolean) {\n\t\tthis._busy = busy;\n\t\tthis.update({ busy });\n\t}\n\n\tget ignoreFocusOut() {\n\t\treturn this._ignoreFocusOut;\n\t}\n\n\tset ignoreFocusOut(ignoreFocusOut: boolean) {\n\t\tthis._ignoreFocusOut = ignoreFocusOut;\n\t\tthis.update({ ignoreFocusOut });\n\t}\n\n\tget value() {\n\t\treturn this._value;\n\t}\n\n\tset value(value: string) {\n\t\tthis._value = value;\n\t\tthis.update({ value });\n\t}\n\n\tget placeholder() {\n\t\treturn this._placeholder;\n\t}\n\n\tset placeholder(placeholder: string | undefined) {\n\t\tthis._placeholder = placeholder;\n\t\tthis.update({ placeholder });\n\t}\n\n\tonDidChangeValue = this._onDidChangeValueEmitter.event;\n\n\tonDidAccept = this._onDidAcceptEmitter.event;\n\n\tget buttons() {\n\t\treturn this._buttons;\n\t}\n\n\tset buttons(buttons: QuickInputButton[]) {\n\t\tthis._buttons = buttons.slice();\n\t\tthis._handlesToButtons.clear();\n\t\tbuttons.forEach((button, i) => {\n\t\t\tconst handle = button === QuickInputButtons.Back ? -1 : i;\n\t\t\tthis._handlesToButtons.set(handle, button);\n\t\t});\n\t\tthis.update({\n\t\t\tbuttons: buttons.map<TransferQuickInputButton>((button, i) => ({\n\t\t\t\ticonPath: getIconUris(button.iconPath),\n\t\t\t\ttooltip: button.tooltip,\n\t\t\t\thandle: button === QuickInputButtons.Back ? -1 : i,\n\t\t\t}))\n\t\t});\n\t}\n\n\tonDidTriggerButton = this._onDidTriggerButtonEmitter.event;\n\n\tshow(): void {\n\t\tthis._visible = true;\n\t\tthis._expectingHide = true;\n\t\tthis.update({ visible: true });\n\t}\n\n\thide(): void {\n\t\tthis._visible = false;\n\t\tthis.update({ visible: false });\n\t}\n\n\tonDidHide = this._onDidHideEmitter.event;\n\n\t_fireDidAccept() {\n\t\tthis._onDidAcceptEmitter.fire();\n\t}\n\n\t_fireDidChangeValue(value: string) {\n\t\tthis._value = value;\n\t\tthis._onDidChangeValueEmitter.fire(value);\n\t}\n\n\t_fireDidTriggerButton(handle: number) {\n\t\tconst button = this._handlesToButtons.get(handle);\n\t\tif (button) {\n\t\t\tthis._onDidTriggerButtonEmitter.fire(button);\n\t\t}\n\t}\n\n\t_fireDidHide() {\n\t\tif (this._expectingHide) {\n\t\t\tthis._expectingHide = false;\n\t\t\tthis._onDidHideEmitter.fire();\n\t\t}\n\t}\n\n\tdispose(): void {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\t\tthis._disposed = true;\n\t\tthis._fireDidHide();\n\t\tthis._disposables = dispose(this._disposables);\n\t\tif (this._updateTimeout) {\n\t\t\tclearTimeout(this._updateTimeout);\n\t\t\tthis._updateTimeout = undefined;\n\t\t}\n\t\tthis._onDidDispose();\n\t\tthis._proxy.$dispose(this._id);\n\t}\n\n\tprotected update(properties: Record<string, any>): void {\n\t\tif (this._disposed) {\n\t\t\treturn;\n\t\t}\n\t\tfor (const key of Object.keys(properties)) {\n\t\t\tconst value = properties[key];\n\t\t\tthis._pendingUpdate[key] = value === undefined ? null : value;\n\t\t}\n\n\t\tif ('visible' in this._pendingUpdate) {\n\t\t\tif (this._updateTimeout) {\n\t\t\t\tclearTimeout(this._updateTimeout);\n\t\t\t\tthis._updateTimeout = undefined;\n\t\t\t}\n\t\t\tthis.dispatchUpdate();\n\t\t} else if (this._visible && !this._updateTimeout) {\n\t\t\t// Defer the update so that multiple changes to setters dont cause a redraw each\n\t\t\tthis._updateTimeout = setTimeout(() => {\n\t\t\t\tthis._updateTimeout = undefined;\n\t\t\t\tthis.dispatchUpdate();\n\t\t\t}, 0);\n\t\t}\n\t}\n\n\tprivate dispatchUpdate() {\n\t\tthis._proxy.$createOrUpdate(this._pendingUpdate);\n\t\tthis._pendingUpdate = { id: this._id };\n\t}\n}\n\nfunction getIconUris(iconPath: QuickInputButton['iconPath']): { dark: URI, light?: URI } | { id: string } {\n\tif (iconPath instanceof ThemeIcon) {\n\t\treturn { id: iconPath.id };\n\t}\n\tconst dark = getDarkIconUri(iconPath as URI | { light: URI; dark: URI; });\n\tconst light = getLightIconUri(iconPath as URI | { light: URI; dark: URI; });\n\t// Tolerate strings: https://github.com/microsoft/vscode/issues/110432#issuecomment-726144556\n\treturn {\n\t\tdark: typeof dark === 'string' ? URI.file(dark) : dark,\n\t\tlight: typeof light === 'string' ? URI.file(light) : light\n\t};\n}\n\nfunction getLightIconUri(iconPath: URI | { light: URI; dark: URI; }) {\n\treturn typeof iconPath === 'object' && 'light' in iconPath ? iconPath.light : iconPath;\n}\n\nfunction getDarkIconUri(iconPath: URI | { light: URI; dark: URI; }) {\n\treturn typeof iconPath === 'object' && 'dark' in iconPath ? iconPath.dark : iconPath;\n}\n\nclass ExtHostQuickPick<T extends QuickPickItem> extends ExtHostQuickInput implements QuickPick<T> {\n\n\tprivate _items: T[] = [];\n\tprivate _handlesToItems = new Map<number, T>();\n\tprivate _itemsToHandles = new Map<T, number>();\n\tprivate _canSelectMany = false;\n\tprivate _matchOnDescription = true;\n\tprivate _matchOnDetail = true;\n\tprivate _sortByLabel = true;\n\tprivate _activeItems: T[] = [];\n\tprivate readonly _onDidChangeActiveEmitter = new Emitter<T[]>();\n\tprivate _selectedItems: T[] = [];\n\tprivate readonly _onDidChangeSelectionEmitter = new Emitter<T[]>();\n\n\tconstructor(proxy: MainThreadQuickOpenShape, extensionId: ExtensionIdentifier, enableProposedApi: boolean, onDispose: () => void) {\n\t\tsuper(proxy, extensionId, onDispose);\n\t\tthis._disposables.push(\n\t\t\tthis._onDidChangeActiveEmitter,\n\t\t\tthis._onDidChangeSelectionEmitter,\n\t\t);\n\t\tthis.update({ type: 'quickPick' });\n\t}\n\n\tget items() {\n\t\treturn this._items;\n\t}\n\n\tset items(items: T[]) {\n\t\tthis._items = items.slice();\n\t\tthis._handlesToItems.clear();\n\t\tthis._itemsToHandles.clear();\n\t\titems.forEach((item, i) => {\n\t\t\tthis._handlesToItems.set(i, item);\n\t\t\tthis._itemsToHandles.set(item, i);\n\t\t});\n\t\tthis.update({\n\t\t\titems: items.map((item, i) => ({\n\t\t\t\tlabel: item.label,\n\t\t\t\tdescription: item.description,\n\t\t\t\thandle: i,\n\t\t\t\tdetail: item.detail,\n\t\t\t\tpicked: item.picked,\n\t\t\t\talwaysShow: item.alwaysShow\n\t\t\t}))\n\t\t});\n\t}\n\n\tget canSelectMany() {\n\t\treturn this._canSelectMany;\n\t}\n\n\tset canSelectMany(canSelectMany: boolean) {\n\t\tthis._canSelectMany = canSelectMany;\n\t\tthis.update({ canSelectMany });\n\t}\n\n\tget matchOnDescription() {\n\t\treturn this._matchOnDescription;\n\t}\n\n\tset matchOnDescription(matchOnDescription: boolean) {\n\t\tthis._matchOnDescription = matchOnDescription;\n\t\tthis.update({ matchOnDescription });\n\t}\n\n\tget matchOnDetail() {\n\t\treturn this._matchOnDetail;\n\t}\n\n\tset matchOnDetail(matchOnDetail: boolean) {\n\t\tthis._matchOnDetail = matchOnDetail;\n\t\tthis.update({ matchOnDetail });\n\t}\n\n\tget sortByLabel() {\n\t\treturn this._sortByLabel;\n\t}\n\n\tset sortByLabel(sortByLabel: boolean) {\n\t\tthis._sortByLabel = sortByLabel;\n\t\tthis.update({ sortByLabel });\n\t}\n\n\tget activeItems() {\n\t\treturn this._activeItems;\n\t}\n\n\tset activeItems(activeItems: T[]) {\n\t\tthis._activeItems = activeItems.filter(item => this._itemsToHandles.has(item));\n\t\tthis.update({ activeItems: this._activeItems.map(item => this._itemsToHandles.get(item)) });\n\t}\n\n\tonDidChangeActive = this._onDidChangeActiveEmitter.event;\n\n\tget selectedItems() {\n\t\treturn this._selectedItems;\n\t}\n\n\tset selectedItems(selectedItems: T[]) {\n\t\tthis._selectedItems = selectedItems.filter(item => this._itemsToHandles.has(item));\n\t\tthis.update({ selectedItems: this._selectedItems.map(item => this._itemsToHandles.get(item)) });\n\t}\n\n\tonDidChangeSelection = this._onDidChangeSelectionEmitter.event;\n\n\t_fireDidChangeActive(handles: number[]) {\n\t\tconst items = coalesce(handles.map(handle => this._handlesToItems.get(handle)));\n\t\tthis._activeItems = items;\n\t\tthis._onDidChangeActiveEmitter.fire(items);\n\t}\n\n\t_fireDidChangeSelection(handles: number[]) {\n\t\tconst items = coalesce(handles.map(handle => this._handlesToItems.get(handle)));\n\t\tthis._selectedItems = items;\n\t\tthis._onDidChangeSelectionEmitter.fire(items);\n\t}\n}\n\nclass ExtHostInputBox extends ExtHostQuickInput implements InputBox {\n\n\tprivate _password = false;\n\tprivate _prompt: string | undefined;\n\tprivate _validationMessage: string | undefined;\n\n\tconstructor(proxy: MainThreadQuickOpenShape, extensionId: ExtensionIdentifier, onDispose: () => void) {\n\t\tsuper(proxy, extensionId, onDispose);\n\t\tthis.update({ type: 'inputBox' });\n\t}\n\n\tget password() {\n\t\treturn this._password;\n\t}\n\n\tset password(password: boolean) {\n\t\tthis._password = password;\n\t\tthis.update({ password });\n\t}\n\n\tget prompt() {\n\t\treturn this._prompt;\n\t}\n\n\tset prompt(prompt: string | undefined) {\n\t\tthis._prompt = prompt;\n\t\tthis.update({ prompt });\n\t}\n\n\tget validationMessage() {\n\t\treturn this._validationMessage;\n\t}\n\n\tset validationMessage(validationMessage: string | undefined) {\n\t\tthis._validationMessage = validationMessage;\n\t\tthis.update({ validationMessage });\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { Event, Emitter } from 'vs/base/common/event';\nimport { debounce } from 'vs/base/common/decorators';\nimport { DisposableStore, IDisposable, MutableDisposable } from 'vs/base/common/lifecycle';\nimport { asPromise } from 'vs/base/common/async';\nimport { ExtHostCommands } from 'vs/workbench/api/common/extHostCommands';\nimport { MainContext, MainThreadSCMShape, SCMRawResource, SCMRawResourceSplice, SCMRawResourceSplices, IMainContext, ExtHostSCMShape, ICommandDto, MainThreadTelemetryShape, SCMGroupFeatures } from './extHost.protocol';\nimport { sortedDiff, equals } from 'vs/base/common/arrays';\nimport { comparePaths } from 'vs/base/common/comparers';\nimport type * as vscode from 'vscode';\nimport { ISplice } from 'vs/base/common/sequence';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { ExtensionIdentifier, IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { checkProposedApiEnabled } from 'vs/workbench/services/extensions/common/extensions';\n\ntype ProviderHandle = number;\ntype GroupHandle = number;\ntype ResourceStateHandle = number;\n\nfunction getIconResource(decorations?: vscode.SourceControlResourceThemableDecorations): vscode.Uri | undefined {\n\tif (!decorations) {\n\t\treturn undefined;\n\t} else if (typeof decorations.iconPath === 'string') {\n\t\treturn URI.file(decorations.iconPath);\n\t} else {\n\t\treturn decorations.iconPath;\n\t}\n}\n\nfunction compareResourceThemableDecorations(a: vscode.SourceControlResourceThemableDecorations, b: vscode.SourceControlResourceThemableDecorations): number {\n\tif (!a.iconPath && !b.iconPath) {\n\t\treturn 0;\n\t} else if (!a.iconPath) {\n\t\treturn -1;\n\t} else if (!b.iconPath) {\n\t\treturn 1;\n\t}\n\n\tconst aPath = typeof a.iconPath === 'string' ? a.iconPath : a.iconPath.fsPath;\n\tconst bPath = typeof b.iconPath === 'string' ? b.iconPath : b.iconPath.fsPath;\n\treturn comparePaths(aPath, bPath);\n}\n\nfunction compareResourceStatesDecorations(a: vscode.SourceControlResourceDecorations, b: vscode.SourceControlResourceDecorations): number {\n\tlet result = 0;\n\n\tif (a.strikeThrough !== b.strikeThrough) {\n\t\treturn a.strikeThrough ? 1 : -1;\n\t}\n\n\tif (a.faded !== b.faded) {\n\t\treturn a.faded ? 1 : -1;\n\t}\n\n\tif (a.tooltip !== b.tooltip) {\n\t\treturn (a.tooltip || '').localeCompare(b.tooltip || '');\n\t}\n\n\tresult = compareResourceThemableDecorations(a, b);\n\n\tif (result !== 0) {\n\t\treturn result;\n\t}\n\n\tif (a.light && b.light) {\n\t\tresult = compareResourceThemableDecorations(a.light, b.light);\n\t} else if (a.light) {\n\t\treturn 1;\n\t} else if (b.light) {\n\t\treturn -1;\n\t}\n\n\tif (result !== 0) {\n\t\treturn result;\n\t}\n\n\tif (a.dark && b.dark) {\n\t\tresult = compareResourceThemableDecorations(a.dark, b.dark);\n\t} else if (a.dark) {\n\t\treturn 1;\n\t} else if (b.dark) {\n\t\treturn -1;\n\t}\n\n\treturn result;\n}\n\nfunction compareCommands(a: vscode.Command, b: vscode.Command): number {\n\tif (a.command !== b.command) {\n\t\treturn a.command < b.command ? -1 : 1;\n\t}\n\n\tif (a.title !== b.title) {\n\t\treturn a.title < b.title ? -1 : 1;\n\t}\n\n\tif (a.tooltip !== b.tooltip) {\n\t\tif (a.tooltip !== undefined && b.tooltip !== undefined) {\n\t\t\treturn a.tooltip < b.tooltip ? -1 : 1;\n\t\t} else if (a.tooltip !== undefined) {\n\t\t\treturn 1;\n\t\t} else if (b.tooltip !== undefined) {\n\t\t\treturn -1;\n\t\t}\n\t}\n\n\tif (a.arguments === b.arguments) {\n\t\treturn 0;\n\t} else if (!a.arguments) {\n\t\treturn -1;\n\t} else if (!b.arguments) {\n\t\treturn 1;\n\t} else if (a.arguments.length !== b.arguments.length) {\n\t\treturn a.arguments.length - b.arguments.length;\n\t}\n\n\tfor (let i = 0; i < a.arguments.length; i++) {\n\t\tconst aArg = a.arguments[i];\n\t\tconst bArg = b.arguments[i];\n\n\t\tif (aArg === bArg) {\n\t\t\tcontinue;\n\t\t}\n\n\t\treturn aArg < bArg ? -1 : 1;\n\t}\n\n\treturn 0;\n}\n\nfunction compareResourceStates(a: vscode.SourceControlResourceState, b: vscode.SourceControlResourceState): number {\n\tlet result = comparePaths(a.resourceUri.fsPath, b.resourceUri.fsPath, true);\n\n\tif (result !== 0) {\n\t\treturn result;\n\t}\n\n\tif (a.command && b.command) {\n\t\tresult = compareCommands(a.command, b.command);\n\t} else if (a.command) {\n\t\treturn 1;\n\t} else if (b.command) {\n\t\treturn -1;\n\t}\n\n\tif (result !== 0) {\n\t\treturn result;\n\t}\n\n\tif (a.decorations && b.decorations) {\n\t\tresult = compareResourceStatesDecorations(a.decorations, b.decorations);\n\t} else if (a.decorations) {\n\t\treturn 1;\n\t} else if (b.decorations) {\n\t\treturn -1;\n\t}\n\n\treturn result;\n}\n\nfunction compareArgs(a: any[], b: any[]): boolean {\n\tfor (let i = 0; i < a.length; i++) {\n\t\tif (a[i] !== b[i]) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}\n\nfunction commandEquals(a: vscode.Command, b: vscode.Command): boolean {\n\treturn a.command === b.command\n\t\t&& a.title === b.title\n\t\t&& a.tooltip === b.tooltip\n\t\t&& (a.arguments && b.arguments ? compareArgs(a.arguments, b.arguments) : a.arguments === b.arguments);\n}\n\nfunction commandListEquals(a: readonly vscode.Command[], b: readonly vscode.Command[]): boolean {\n\treturn equals(a, b, commandEquals);\n}\n\nexport interface IValidateInput {\n\t(value: string, cursorPosition: number): vscode.ProviderResult<vscode.SourceControlInputBoxValidation | undefined | null>;\n}\n\nexport class ExtHostSCMInputBox implements vscode.SourceControlInputBox {\n\n\tprivate _value: string = '';\n\n\tget value(): string {\n\t\treturn this._value;\n\t}\n\n\tset value(value: string) {\n\t\tthis._proxy.$setInputBoxValue(this._sourceControlHandle, value);\n\t\tthis.updateValue(value);\n\t}\n\n\tprivate readonly _onDidChange = new Emitter<string>();\n\n\tget onDidChange(): Event<string> {\n\t\treturn this._onDidChange.event;\n\t}\n\n\tprivate _placeholder: string = '';\n\n\tget placeholder(): string {\n\t\treturn this._placeholder;\n\t}\n\n\tset placeholder(placeholder: string) {\n\t\tthis._proxy.$setInputBoxPlaceholder(this._sourceControlHandle, placeholder);\n\t\tthis._placeholder = placeholder;\n\t}\n\n\tprivate _validateInput: IValidateInput | undefined;\n\n\tget validateInput(): IValidateInput | undefined {\n\t\tcheckProposedApiEnabled(this._extension);\n\n\t\treturn this._validateInput;\n\t}\n\n\tset validateInput(fn: IValidateInput | undefined) {\n\t\tcheckProposedApiEnabled(this._extension);\n\n\t\tif (fn && typeof fn !== 'function') {\n\t\t\tthrow new Error(`[${this._extension.identifier.value}]: Invalid SCM input box validation function`);\n\t\t}\n\n\t\tthis._validateInput = fn;\n\t\tthis._proxy.$setValidationProviderIsEnabled(this._sourceControlHandle, !!fn);\n\t}\n\n\tprivate _visible: boolean = true;\n\n\tget visible(): boolean {\n\t\treturn this._visible;\n\t}\n\n\tset visible(visible: boolean) {\n\t\tvisible = !!visible;\n\n\t\tif (this._visible === visible) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._visible = visible;\n\t\tthis._proxy.$setInputBoxVisibility(this._sourceControlHandle, visible);\n\t}\n\n\tconstructor(private _extension: IExtensionDescription, private _proxy: MainThreadSCMShape, private _sourceControlHandle: number) {\n\t\t// noop\n\t}\n\n\t$onInputBoxValueChange(value: string): void {\n\t\tthis.updateValue(value);\n\t}\n\n\tprivate updateValue(value: string): void {\n\t\tthis._value = value;\n\t\tthis._onDidChange.fire(value);\n\t}\n}\n\nclass ExtHostSourceControlResourceGroup implements vscode.SourceControlResourceGroup {\n\n\tprivate static _handlePool: number = 0;\n\tprivate _resourceHandlePool: number = 0;\n\tprivate _resourceStates: vscode.SourceControlResourceState[] = [];\n\n\tprivate _resourceStatesMap = new Map<ResourceStateHandle, vscode.SourceControlResourceState>();\n\tprivate _resourceStatesCommandsMap = new Map<ResourceStateHandle, vscode.Command>();\n\tprivate _resourceStatesDisposablesMap = new Map<ResourceStateHandle, IDisposable>();\n\n\tprivate readonly _onDidUpdateResourceStates = new Emitter<void>();\n\treadonly onDidUpdateResourceStates = this._onDidUpdateResourceStates.event;\n\n\tprivate _disposed = false;\n\tget disposed(): boolean { return this._disposed; }\n\tprivate readonly _onDidDispose = new Emitter<void>();\n\treadonly onDidDispose = this._onDidDispose.event;\n\n\tprivate _handlesSnapshot: number[] = [];\n\tprivate _resourceSnapshot: vscode.SourceControlResourceState[] = [];\n\n\tget id(): string { return this._id; }\n\n\tget label(): string { return this._label; }\n\tset label(label: string) {\n\t\tthis._label = label;\n\t\tthis._proxy.$updateGroupLabel(this._sourceControlHandle, this.handle, label);\n\t}\n\n\tprivate _hideWhenEmpty: boolean | undefined = undefined;\n\tget hideWhenEmpty(): boolean | undefined { return this._hideWhenEmpty; }\n\tset hideWhenEmpty(hideWhenEmpty: boolean | undefined) {\n\t\tthis._hideWhenEmpty = hideWhenEmpty;\n\t\tthis._proxy.$updateGroup(this._sourceControlHandle, this.handle, this.features);\n\t}\n\n\tget features(): SCMGroupFeatures {\n\t\treturn {\n\t\t\thideWhenEmpty: this.hideWhenEmpty\n\t\t};\n\t}\n\n\tget resourceStates(): vscode.SourceControlResourceState[] { return [...this._resourceStates]; }\n\tset resourceStates(resources: vscode.SourceControlResourceState[]) {\n\t\tthis._resourceStates = [...resources];\n\t\tthis._onDidUpdateResourceStates.fire();\n\t}\n\n\treadonly handle = ExtHostSourceControlResourceGroup._handlePool++;\n\n\tconstructor(\n\t\tprivate _proxy: MainThreadSCMShape,\n\t\tprivate _commands: ExtHostCommands,\n\t\tprivate _sourceControlHandle: number,\n\t\tprivate _id: string,\n\t\tprivate _label: string,\n\t) { }\n\n\tgetResourceState(handle: number): vscode.SourceControlResourceState | undefined {\n\t\treturn this._resourceStatesMap.get(handle);\n\t}\n\n\t$executeResourceCommand(handle: number, preserveFocus: boolean): Promise<void> {\n\t\tconst command = this._resourceStatesCommandsMap.get(handle);\n\n\t\tif (!command) {\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\n\t\treturn asPromise(() => this._commands.executeCommand(command.command, ...(command.arguments || []), preserveFocus));\n\t}\n\n\t_takeResourceStateSnapshot(): SCMRawResourceSplice[] {\n\t\tconst snapshot = [...this._resourceStates].sort(compareResourceStates);\n\t\tconst diffs = sortedDiff(this._resourceSnapshot, snapshot, compareResourceStates);\n\n\t\tconst splices = diffs.map<ISplice<{ rawResource: SCMRawResource, handle: number }>>(diff => {\n\t\t\tconst toInsert = diff.toInsert.map(r => {\n\t\t\t\tconst handle = this._resourceHandlePool++;\n\t\t\t\tthis._resourceStatesMap.set(handle, r);\n\n\t\t\t\tconst sourceUri = r.resourceUri;\n\t\t\t\tconst iconUri = getIconResource(r.decorations);\n\t\t\t\tconst lightIconUri = r.decorations && getIconResource(r.decorations.light) || iconUri;\n\t\t\t\tconst darkIconUri = r.decorations && getIconResource(r.decorations.dark) || iconUri;\n\t\t\t\tconst icons: UriComponents[] = [];\n\t\t\t\tlet command: ICommandDto | undefined;\n\n\t\t\t\tif (r.command) {\n\t\t\t\t\tif (r.command.command === 'vscode.open' || r.command.command === 'vscode.diff') {\n\t\t\t\t\t\tconst disposables = new DisposableStore();\n\t\t\t\t\t\tcommand = this._commands.converter.toInternal(r.command, disposables);\n\t\t\t\t\t\tthis._resourceStatesDisposablesMap.set(handle, disposables);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._resourceStatesCommandsMap.set(handle, r.command);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (lightIconUri) {\n\t\t\t\t\ticons.push(lightIconUri);\n\t\t\t\t}\n\n\t\t\t\tif (darkIconUri && (darkIconUri.toString() !== lightIconUri?.toString())) {\n\t\t\t\t\ticons.push(darkIconUri);\n\t\t\t\t}\n\n\t\t\t\tconst tooltip = (r.decorations && r.decorations.tooltip) || '';\n\t\t\t\tconst strikeThrough = r.decorations && !!r.decorations.strikeThrough;\n\t\t\t\tconst faded = r.decorations && !!r.decorations.faded;\n\t\t\t\tconst contextValue = r.contextValue || '';\n\n\t\t\t\tconst rawResource = [handle, sourceUri, icons, tooltip, strikeThrough, faded, contextValue, command] as SCMRawResource;\n\n\t\t\t\treturn { rawResource, handle };\n\t\t\t});\n\n\t\t\treturn { start: diff.start, deleteCount: diff.deleteCount, toInsert };\n\t\t});\n\n\t\tconst rawResourceSplices = splices\n\t\t\t.map(({ start, deleteCount, toInsert }) => [start, deleteCount, toInsert.map(i => i.rawResource)] as SCMRawResourceSplice);\n\n\t\tconst reverseSplices = splices.reverse();\n\n\t\tfor (const { start, deleteCount, toInsert } of reverseSplices) {\n\t\t\tconst handles = toInsert.map(i => i.handle);\n\t\t\tconst handlesToDelete = this._handlesSnapshot.splice(start, deleteCount, ...handles);\n\n\t\t\tfor (const handle of handlesToDelete) {\n\t\t\t\tthis._resourceStatesMap.delete(handle);\n\t\t\t\tthis._resourceStatesCommandsMap.delete(handle);\n\t\t\t\tthis._resourceStatesDisposablesMap.get(handle)?.dispose();\n\t\t\t\tthis._resourceStatesDisposablesMap.delete(handle);\n\t\t\t}\n\t\t}\n\n\t\tthis._resourceSnapshot = snapshot;\n\t\treturn rawResourceSplices;\n\t}\n\n\tdispose(): void {\n\t\tthis._disposed = true;\n\t\tthis._onDidDispose.fire();\n\t}\n}\n\nclass ExtHostSourceControl implements vscode.SourceControl {\n\n\tprivate static _handlePool: number = 0;\n\tprivate _groups: Map<GroupHandle, ExtHostSourceControlResourceGroup> = new Map<GroupHandle, ExtHostSourceControlResourceGroup>();\n\n\tget id(): string {\n\t\treturn this._id;\n\t}\n\n\tget label(): string {\n\t\treturn this._label;\n\t}\n\n\tget rootUri(): vscode.Uri | undefined {\n\t\treturn this._rootUri;\n\t}\n\n\tprivate _inputBox: ExtHostSCMInputBox;\n\tget inputBox(): ExtHostSCMInputBox { return this._inputBox; }\n\n\tprivate _count: number | undefined = undefined;\n\n\tget count(): number | undefined {\n\t\treturn this._count;\n\t}\n\n\tset count(count: number | undefined) {\n\t\tif (this._count === count) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._count = count;\n\t\tthis._proxy.$updateSourceControl(this.handle, { count });\n\t}\n\n\tprivate _quickDiffProvider: vscode.QuickDiffProvider | undefined = undefined;\n\n\tget quickDiffProvider(): vscode.QuickDiffProvider | undefined {\n\t\treturn this._quickDiffProvider;\n\t}\n\n\tset quickDiffProvider(quickDiffProvider: vscode.QuickDiffProvider | undefined) {\n\t\tthis._quickDiffProvider = quickDiffProvider;\n\t\tthis._proxy.$updateSourceControl(this.handle, { hasQuickDiffProvider: !!quickDiffProvider });\n\t}\n\n\tprivate _commitTemplate: string | undefined = undefined;\n\n\tget commitTemplate(): string | undefined {\n\t\treturn this._commitTemplate;\n\t}\n\n\tset commitTemplate(commitTemplate: string | undefined) {\n\t\tif (commitTemplate === this._commitTemplate) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._commitTemplate = commitTemplate;\n\t\tthis._proxy.$updateSourceControl(this.handle, { commitTemplate });\n\t}\n\n\tprivate _acceptInputDisposables = new MutableDisposable<DisposableStore>();\n\tprivate _acceptInputCommand: vscode.Command | undefined = undefined;\n\n\tget acceptInputCommand(): vscode.Command | undefined {\n\t\treturn this._acceptInputCommand;\n\t}\n\n\tset acceptInputCommand(acceptInputCommand: vscode.Command | undefined) {\n\t\tthis._acceptInputDisposables.value = new DisposableStore();\n\n\t\tthis._acceptInputCommand = acceptInputCommand;\n\n\t\tconst internal = this._commands.converter.toInternal(acceptInputCommand, this._acceptInputDisposables.value);\n\t\tthis._proxy.$updateSourceControl(this.handle, { acceptInputCommand: internal });\n\t}\n\n\tprivate _statusBarDisposables = new MutableDisposable<DisposableStore>();\n\tprivate _statusBarCommands: vscode.Command[] | undefined = undefined;\n\n\tget statusBarCommands(): vscode.Command[] | undefined {\n\t\treturn this._statusBarCommands;\n\t}\n\n\tset statusBarCommands(statusBarCommands: vscode.Command[] | undefined) {\n\t\tif (this._statusBarCommands && statusBarCommands && commandListEquals(this._statusBarCommands, statusBarCommands)) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._statusBarDisposables.value = new DisposableStore();\n\n\t\tthis._statusBarCommands = statusBarCommands;\n\n\t\tconst internal = (statusBarCommands || []).map(c => this._commands.converter.toInternal(c, this._statusBarDisposables.value!)) as ICommandDto[];\n\t\tthis._proxy.$updateSourceControl(this.handle, { statusBarCommands: internal });\n\t}\n\n\tprivate _selected: boolean = false;\n\n\tget selected(): boolean {\n\t\treturn this._selected;\n\t}\n\n\tprivate readonly _onDidChangeSelection = new Emitter<boolean>();\n\treadonly onDidChangeSelection = this._onDidChangeSelection.event;\n\n\tprivate handle: number = ExtHostSourceControl._handlePool++;\n\n\tconstructor(\n\t\t_extension: IExtensionDescription,\n\t\tprivate _proxy: MainThreadSCMShape,\n\t\tprivate _commands: ExtHostCommands,\n\t\tprivate _id: string,\n\t\tprivate _label: string,\n\t\tprivate _rootUri?: vscode.Uri\n\t) {\n\t\tthis._inputBox = new ExtHostSCMInputBox(_extension, this._proxy, this.handle);\n\t\tthis._proxy.$registerSourceControl(this.handle, _id, _label, _rootUri);\n\t}\n\n\tprivate createdResourceGroups = new Map<ExtHostSourceControlResourceGroup, IDisposable>();\n\tprivate updatedResourceGroups = new Set<ExtHostSourceControlResourceGroup>();\n\n\tcreateResourceGroup(id: string, label: string): ExtHostSourceControlResourceGroup {\n\t\tconst group = new ExtHostSourceControlResourceGroup(this._proxy, this._commands, this.handle, id, label);\n\t\tconst disposable = Event.once(group.onDidDispose)(() => this.createdResourceGroups.delete(group));\n\t\tthis.createdResourceGroups.set(group, disposable);\n\t\tthis.eventuallyAddResourceGroups();\n\t\treturn group;\n\t}\n\n\t@debounce(100)\n\teventuallyAddResourceGroups(): void {\n\t\tconst groups: [number /*handle*/, string /*id*/, string /*label*/, SCMGroupFeatures][] = [];\n\t\tconst splices: SCMRawResourceSplices[] = [];\n\n\t\tfor (const [group, disposable] of this.createdResourceGroups) {\n\t\t\tdisposable.dispose();\n\n\t\t\tconst updateListener = group.onDidUpdateResourceStates(() => {\n\t\t\t\tthis.updatedResourceGroups.add(group);\n\t\t\t\tthis.eventuallyUpdateResourceStates();\n\t\t\t});\n\n\t\t\tEvent.once(group.onDidDispose)(() => {\n\t\t\t\tthis.updatedResourceGroups.delete(group);\n\t\t\t\tupdateListener.dispose();\n\t\t\t\tthis._groups.delete(group.handle);\n\t\t\t\tthis._proxy.$unregisterGroup(this.handle, group.handle);\n\t\t\t});\n\n\t\t\tgroups.push([group.handle, group.id, group.label, group.features]);\n\n\t\t\tconst snapshot = group._takeResourceStateSnapshot();\n\n\t\t\tif (snapshot.length > 0) {\n\t\t\t\tsplices.push([group.handle, snapshot]);\n\t\t\t}\n\n\t\t\tthis._groups.set(group.handle, group);\n\t\t}\n\n\t\tthis._proxy.$registerGroups(this.handle, groups, splices);\n\t\tthis.createdResourceGroups.clear();\n\t}\n\n\t@debounce(100)\n\teventuallyUpdateResourceStates(): void {\n\t\tconst splices: SCMRawResourceSplices[] = [];\n\n\t\tthis.updatedResourceGroups.forEach(group => {\n\t\t\tconst snapshot = group._takeResourceStateSnapshot();\n\n\t\t\tif (snapshot.length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tsplices.push([group.handle, snapshot]);\n\t\t});\n\n\t\tif (splices.length > 0) {\n\t\t\tthis._proxy.$spliceResourceStates(this.handle, splices);\n\t\t}\n\n\t\tthis.updatedResourceGroups.clear();\n\t}\n\n\tgetResourceGroup(handle: GroupHandle): ExtHostSourceControlResourceGroup | undefined {\n\t\treturn this._groups.get(handle);\n\t}\n\n\tsetSelectionState(selected: boolean): void {\n\t\tthis._selected = selected;\n\t\tthis._onDidChangeSelection.fire(selected);\n\t}\n\n\tdispose(): void {\n\t\tthis._acceptInputDisposables.dispose();\n\t\tthis._statusBarDisposables.dispose();\n\n\t\tthis._groups.forEach(group => group.dispose());\n\t\tthis._proxy.$unregisterSourceControl(this.handle);\n\t}\n}\n\nexport class ExtHostSCM implements ExtHostSCMShape {\n\n\tprivate static _handlePool: number = 0;\n\n\tprivate _proxy: MainThreadSCMShape;\n\tprivate readonly _telemetry: MainThreadTelemetryShape;\n\tprivate _sourceControls: Map<ProviderHandle, ExtHostSourceControl> = new Map<ProviderHandle, ExtHostSourceControl>();\n\tprivate _sourceControlsByExtension: Map<string, ExtHostSourceControl[]> = new Map<string, ExtHostSourceControl[]>();\n\n\tprivate readonly _onDidChangeActiveProvider = new Emitter<vscode.SourceControl>();\n\tget onDidChangeActiveProvider(): Event<vscode.SourceControl> { return this._onDidChangeActiveProvider.event; }\n\n\tprivate _selectedSourceControlHandle: number | undefined;\n\n\tconstructor(\n\t\tmainContext: IMainContext,\n\t\tprivate _commands: ExtHostCommands,\n\t\t@ILogService private readonly logService: ILogService\n\t) {\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadSCM);\n\t\tthis._telemetry = mainContext.getProxy(MainContext.MainThreadTelemetry);\n\n\t\t_commands.registerArgumentProcessor({\n\t\t\tprocessArgument: arg => {\n\t\t\t\tif (arg && arg.$mid === 3) {\n\t\t\t\t\tconst sourceControl = this._sourceControls.get(arg.sourceControlHandle);\n\n\t\t\t\t\tif (!sourceControl) {\n\t\t\t\t\t\treturn arg;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst group = sourceControl.getResourceGroup(arg.groupHandle);\n\n\t\t\t\t\tif (!group) {\n\t\t\t\t\t\treturn arg;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn group.getResourceState(arg.handle);\n\t\t\t\t} else if (arg && arg.$mid === 4) {\n\t\t\t\t\tconst sourceControl = this._sourceControls.get(arg.sourceControlHandle);\n\n\t\t\t\t\tif (!sourceControl) {\n\t\t\t\t\t\treturn arg;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn sourceControl.getResourceGroup(arg.groupHandle);\n\t\t\t\t} else if (arg && arg.$mid === 5) {\n\t\t\t\t\tconst sourceControl = this._sourceControls.get(arg.handle);\n\n\t\t\t\t\tif (!sourceControl) {\n\t\t\t\t\t\treturn arg;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn sourceControl;\n\t\t\t\t}\n\n\t\t\t\treturn arg;\n\t\t\t}\n\t\t});\n\t}\n\n\tcreateSourceControl(extension: IExtensionDescription, id: string, label: string, rootUri: vscode.Uri | undefined): vscode.SourceControl {\n\t\tthis.logService.trace('ExtHostSCM#createSourceControl', extension.identifier.value, id, label, rootUri);\n\n\t\ttype TEvent = { extensionId: string; };\n\t\ttype TMeta = { extensionId: { classification: 'SystemMetaData', purpose: 'FeatureInsight' }; };\n\t\tthis._telemetry.$publicLog2<TEvent, TMeta>('api/scm/createSourceControl', {\n\t\t\textensionId: extension.identifier.value,\n\t\t});\n\n\t\tconst handle = ExtHostSCM._handlePool++;\n\t\tconst sourceControl = new ExtHostSourceControl(extension, this._proxy, this._commands, id, label, rootUri);\n\t\tthis._sourceControls.set(handle, sourceControl);\n\n\t\tconst sourceControls = this._sourceControlsByExtension.get(ExtensionIdentifier.toKey(extension.identifier)) || [];\n\t\tsourceControls.push(sourceControl);\n\t\tthis._sourceControlsByExtension.set(ExtensionIdentifier.toKey(extension.identifier), sourceControls);\n\n\t\treturn sourceControl;\n\t}\n\n\t// Deprecated\n\tgetLastInputBox(extension: IExtensionDescription): ExtHostSCMInputBox | undefined {\n\t\tthis.logService.trace('ExtHostSCM#getLastInputBox', extension.identifier.value);\n\n\t\tconst sourceControls = this._sourceControlsByExtension.get(ExtensionIdentifier.toKey(extension.identifier));\n\t\tconst sourceControl = sourceControls && sourceControls[sourceControls.length - 1];\n\t\treturn sourceControl && sourceControl.inputBox;\n\t}\n\n\t$provideOriginalResource(sourceControlHandle: number, uriComponents: UriComponents, token: CancellationToken): Promise<UriComponents | null> {\n\t\tconst uri = URI.revive(uriComponents);\n\t\tthis.logService.trace('ExtHostSCM#$provideOriginalResource', sourceControlHandle, uri.toString());\n\n\t\tconst sourceControl = this._sourceControls.get(sourceControlHandle);\n\n\t\tif (!sourceControl || !sourceControl.quickDiffProvider || !sourceControl.quickDiffProvider.provideOriginalResource) {\n\t\t\treturn Promise.resolve(null);\n\t\t}\n\n\t\treturn asPromise(() => sourceControl.quickDiffProvider!.provideOriginalResource!(uri, token))\n\t\t\t.then<UriComponents | null>(r => r || null);\n\t}\n\n\t$onInputBoxValueChange(sourceControlHandle: number, value: string): Promise<void> {\n\t\tthis.logService.trace('ExtHostSCM#$onInputBoxValueChange', sourceControlHandle);\n\n\t\tconst sourceControl = this._sourceControls.get(sourceControlHandle);\n\n\t\tif (!sourceControl) {\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\n\t\tsourceControl.inputBox.$onInputBoxValueChange(value);\n\t\treturn Promise.resolve(undefined);\n\t}\n\n\t$executeResourceCommand(sourceControlHandle: number, groupHandle: number, handle: number, preserveFocus: boolean): Promise<void> {\n\t\tthis.logService.trace('ExtHostSCM#$executeResourceCommand', sourceControlHandle, groupHandle, handle);\n\n\t\tconst sourceControl = this._sourceControls.get(sourceControlHandle);\n\n\t\tif (!sourceControl) {\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\n\t\tconst group = sourceControl.getResourceGroup(groupHandle);\n\n\t\tif (!group) {\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\n\t\treturn group.$executeResourceCommand(handle, preserveFocus);\n\t}\n\n\t$validateInput(sourceControlHandle: number, value: string, cursorPosition: number): Promise<[string, number] | undefined> {\n\t\tthis.logService.trace('ExtHostSCM#$validateInput', sourceControlHandle);\n\n\t\tconst sourceControl = this._sourceControls.get(sourceControlHandle);\n\n\t\tif (!sourceControl) {\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\n\t\tif (!sourceControl.inputBox.validateInput) {\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\n\t\treturn asPromise(() => sourceControl.inputBox.validateInput!(value, cursorPosition)).then(result => {\n\t\t\tif (!result) {\n\t\t\t\treturn Promise.resolve(undefined);\n\t\t\t}\n\n\t\t\treturn Promise.resolve<[string, number]>([result.message, result.type]);\n\t\t});\n\t}\n\n\t$setSelectedSourceControl(selectedSourceControlHandle: number | undefined): Promise<void> {\n\t\tthis.logService.trace('ExtHostSCM#$setSelectedSourceControl', selectedSourceControlHandle);\n\n\t\tif (selectedSourceControlHandle !== undefined) {\n\t\t\tthis._sourceControls.get(selectedSourceControlHandle)?.setSelectionState(true);\n\t\t}\n\n\t\tif (this._selectedSourceControlHandle !== undefined) {\n\t\t\tthis._sourceControls.get(this._selectedSourceControlHandle)?.setSelectionState(false);\n\t\t}\n\n\t\tthis._selectedSourceControlHandle = selectedSourceControlHandle;\n\t\treturn Promise.resolve(undefined);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { StatusbarAlignment as MainThreadStatusBarAlignment } from 'vs/workbench/services/statusbar/common/statusbar';\nimport { StatusBarAlignment as ExtHostStatusBarAlignment, Disposable, ThemeColor } from './extHostTypes';\nimport type * as vscode from 'vscode';\nimport { MainContext, MainThreadStatusBarShape, IMainContext, ICommandDto } from './extHost.protocol';\nimport { localize } from 'vs/nls';\nimport { CommandsConverter } from 'vs/workbench/api/common/extHostCommands';\nimport { DisposableStore } from 'vs/base/common/lifecycle';\n\nexport class ExtHostStatusBarEntry implements vscode.StatusBarItem {\n\tprivate static ID_GEN = 0;\n\n\tprivate static ALLOWED_BACKGROUND_COLORS = (() => {\n\t\tconst map = new Map<string, ThemeColor>();\n\n\t\t// https://github.com/microsoft/vscode/issues/110214\n\t\tmap.set('statusBarItem.errorBackground', new ThemeColor('statusBarItem.errorForeground'));\n\n\t\treturn map;\n\t})();\n\n\tprivate _id: number;\n\tprivate _alignment: number;\n\tprivate _priority?: number;\n\tprivate _disposed: boolean = false;\n\tprivate _visible: boolean = false;\n\n\tprivate _statusId: string;\n\tprivate _statusName: string;\n\n\tprivate _text: string = '';\n\tprivate _tooltip?: string;\n\tprivate _color?: string | ThemeColor;\n\tprivate _backgroundColor?: ThemeColor;\n\tprivate readonly _internalCommandRegistration = new DisposableStore();\n\tprivate _command?: {\n\t\treadonly fromApi: string | vscode.Command,\n\t\treadonly internal: ICommandDto,\n\t};\n\n\tprivate _timeoutHandle: any;\n\tprivate _proxy: MainThreadStatusBarShape;\n\tprivate _commands: CommandsConverter;\n\tprivate _accessibilityInformation?: vscode.AccessibilityInformation;\n\n\tconstructor(proxy: MainThreadStatusBarShape, commands: CommandsConverter, id: string, name: string, alignment: ExtHostStatusBarAlignment = ExtHostStatusBarAlignment.Left, priority?: number, accessibilityInformation?: vscode.AccessibilityInformation) {\n\t\tthis._id = ExtHostStatusBarEntry.ID_GEN++;\n\t\tthis._proxy = proxy;\n\t\tthis._commands = commands;\n\t\tthis._statusId = id;\n\t\tthis._statusName = name;\n\t\tthis._alignment = alignment;\n\t\tthis._priority = priority;\n\t\tthis._accessibilityInformation = accessibilityInformation;\n\t}\n\n\tpublic get id(): number {\n\t\treturn this._id;\n\t}\n\n\tpublic get alignment(): vscode.StatusBarAlignment {\n\t\treturn this._alignment;\n\t}\n\n\tpublic get priority(): number | undefined {\n\t\treturn this._priority;\n\t}\n\n\tpublic get text(): string {\n\t\treturn this._text;\n\t}\n\n\tpublic get tooltip(): string | undefined {\n\t\treturn this._tooltip;\n\t}\n\n\tpublic get color(): string | ThemeColor | undefined {\n\t\treturn this._color;\n\t}\n\n\tpublic get backgroundColor(): ThemeColor | undefined {\n\t\treturn this._backgroundColor;\n\t}\n\n\tpublic get command(): string | vscode.Command | undefined {\n\t\treturn this._command?.fromApi;\n\t}\n\n\tpublic get accessibilityInformation(): vscode.AccessibilityInformation | undefined {\n\t\treturn this._accessibilityInformation;\n\t}\n\n\tpublic set text(text: string) {\n\t\tthis._text = text;\n\t\tthis.update();\n\t}\n\n\tpublic set tooltip(tooltip: string | undefined) {\n\t\tthis._tooltip = tooltip;\n\t\tthis.update();\n\t}\n\n\tpublic set color(color: string | ThemeColor | undefined) {\n\t\tthis._color = color;\n\t\tthis.update();\n\t}\n\n\tpublic set backgroundColor(color: ThemeColor | undefined) {\n\t\tif (color && !ExtHostStatusBarEntry.ALLOWED_BACKGROUND_COLORS.has(color.id)) {\n\t\t\tcolor = undefined;\n\t\t}\n\n\t\tthis._backgroundColor = color;\n\t\tthis.update();\n\t}\n\n\tpublic set command(command: string | vscode.Command | undefined) {\n\t\tif (this._command?.fromApi === command) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._internalCommandRegistration.clear();\n\t\tif (typeof command === 'string') {\n\t\t\tthis._command = {\n\t\t\t\tfromApi: command,\n\t\t\t\tinternal: this._commands.toInternal({ title: '', command }, this._internalCommandRegistration),\n\t\t\t};\n\t\t} else if (command) {\n\t\t\tthis._command = {\n\t\t\t\tfromApi: command,\n\t\t\t\tinternal: this._commands.toInternal(command, this._internalCommandRegistration),\n\t\t\t};\n\t\t} else {\n\t\t\tthis._command = undefined;\n\t\t}\n\t\tthis.update();\n\t}\n\n\tpublic set accessibilityInformation(accessibilityInformation: vscode.AccessibilityInformation | undefined) {\n\t\tthis._accessibilityInformation = accessibilityInformation;\n\t\tthis.update();\n\t}\n\n\tpublic show(): void {\n\t\tthis._visible = true;\n\t\tthis.update();\n\t}\n\n\tpublic hide(): void {\n\t\tclearTimeout(this._timeoutHandle);\n\t\tthis._visible = false;\n\t\tthis._proxy.$dispose(this.id);\n\t}\n\n\tprivate update(): void {\n\t\tif (this._disposed || !this._visible) {\n\t\t\treturn;\n\t\t}\n\n\t\tclearTimeout(this._timeoutHandle);\n\n\t\t// Defer the update so that multiple changes to setters dont cause a redraw each\n\t\tthis._timeoutHandle = setTimeout(() => {\n\t\t\tthis._timeoutHandle = undefined;\n\n\t\t\t// If a background color is set, the foreground is determined\n\t\t\tlet color = this._color;\n\t\t\tif (this._backgroundColor) {\n\t\t\t\tcolor = ExtHostStatusBarEntry.ALLOWED_BACKGROUND_COLORS.get(this._backgroundColor.id);\n\t\t\t}\n\n\t\t\t// Set to status bar\n\t\t\tthis._proxy.$setEntry(this.id, this._statusId, this._statusName, this._text, this._tooltip, this._command?.internal, color,\n\t\t\t\tthis._backgroundColor, this._alignment === ExtHostStatusBarAlignment.Left ? MainThreadStatusBarAlignment.LEFT : MainThreadStatusBarAlignment.RIGHT,\n\t\t\t\tthis._priority, this._accessibilityInformation);\n\t\t}, 0);\n\t}\n\n\tpublic dispose(): void {\n\t\tthis.hide();\n\t\tthis._disposed = true;\n\t}\n}\n\nclass StatusBarMessage {\n\n\tprivate _item: vscode.StatusBarItem;\n\tprivate _messages: { message: string }[] = [];\n\n\tconstructor(statusBar: ExtHostStatusBar) {\n\t\tthis._item = statusBar.createStatusBarEntry('status.extensionMessage', localize('status.extensionMessage', \"Extension Status\"), ExtHostStatusBarAlignment.Left, Number.MIN_VALUE);\n\t}\n\n\tdispose() {\n\t\tthis._messages.length = 0;\n\t\tthis._item.dispose();\n\t}\n\n\tsetMessage(message: string): Disposable {\n\t\tconst data: { message: string } = { message }; // use object to not confuse equal strings\n\t\tthis._messages.unshift(data);\n\t\tthis._update();\n\n\t\treturn new Disposable(() => {\n\t\t\tconst idx = this._messages.indexOf(data);\n\t\t\tif (idx >= 0) {\n\t\t\t\tthis._messages.splice(idx, 1);\n\t\t\t\tthis._update();\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate _update() {\n\t\tif (this._messages.length > 0) {\n\t\t\tthis._item.text = this._messages[0].message;\n\t\t\tthis._item.show();\n\t\t} else {\n\t\t\tthis._item.hide();\n\t\t}\n\t}\n}\n\nexport class ExtHostStatusBar {\n\n\tprivate readonly _proxy: MainThreadStatusBarShape;\n\tprivate readonly _commands: CommandsConverter;\n\tprivate _statusMessage: StatusBarMessage;\n\n\tconstructor(mainContext: IMainContext, commands: CommandsConverter) {\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadStatusBar);\n\t\tthis._commands = commands;\n\t\tthis._statusMessage = new StatusBarMessage(this);\n\t}\n\n\tcreateStatusBarEntry(id: string, name: string, alignment?: ExtHostStatusBarAlignment, priority?: number, accessibilityInformation?: vscode.AccessibilityInformation): vscode.StatusBarItem {\n\t\treturn new ExtHostStatusBarEntry(this._proxy, this._commands, id, name, alignment, priority, accessibilityInformation);\n\t}\n\n\tsetStatusBarMessage(text: string, timeoutOrThenable?: number | Thenable<any>): Disposable {\n\n\t\tconst d = this._statusMessage.setMessage(text);\n\t\tlet handle: any;\n\n\t\tif (typeof timeoutOrThenable === 'number') {\n\t\t\thandle = setTimeout(() => d.dispose(), timeoutOrThenable);\n\t\t} else if (typeof timeoutOrThenable !== 'undefined') {\n\t\t\ttimeoutOrThenable.then(() => d.dispose(), () => d.dispose());\n\t\t}\n\n\t\treturn new Disposable(() => {\n\t\t\td.dispose();\n\t\t\tclearTimeout(handle);\n\t\t});\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { MainContext, MainThreadStorageShape, ExtHostStorageShape } from './extHost.protocol';\nimport { Emitter } from 'vs/base/common/event';\nimport { IExtHostRpcService } from 'vs/workbench/api/common/extHostRpcService';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { IExtensionIdWithVersion } from 'vs/platform/userDataSync/common/extensionsStorageSync';\n\nexport interface IStorageChangeEvent {\n\tshared: boolean;\n\tkey: string;\n\tvalue: object;\n}\n\nexport class ExtHostStorage implements ExtHostStorageShape {\n\n\treadonly _serviceBrand: undefined;\n\n\tprivate _proxy: MainThreadStorageShape;\n\n\tprivate readonly _onDidChangeStorage = new Emitter<IStorageChangeEvent>();\n\treadonly onDidChangeStorage = this._onDidChangeStorage.event;\n\n\tconstructor(mainContext: IExtHostRpcService) {\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadStorage);\n\t}\n\n\tregisterExtensionStorageKeysToSync(extension: IExtensionIdWithVersion, keys: string[]): void {\n\t\tthis._proxy.$registerExtensionStorageKeysToSync(extension, keys);\n\t}\n\n\tgetValue<T>(shared: boolean, key: string, defaultValue?: T): Promise<T | undefined> {\n\t\treturn this._proxy.$getValue<T>(shared, key).then(value => value || defaultValue);\n\t}\n\n\tsetValue(shared: boolean, key: string, value: object): Promise<void> {\n\t\treturn this._proxy.$setValue(shared, key, value);\n\t}\n\n\t$acceptValue(shared: boolean, key: string, value: object): void {\n\t\tthis._onDidChangeStorage.fire({ shared, key, value });\n\t}\n}\n\nexport interface IExtHostStorage extends ExtHostStorage { }\nexport const IExtHostStorage = createDecorator<IExtHostStorage>('IExtHostStorage');\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { IExtHostInitDataService } from 'vs/workbench/api/common/extHostInitDataService';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { IEnvironment, IStaticWorkspaceData } from 'vs/workbench/api/common/extHost.protocol';\nimport { IExtHostConsumerFileSystem } from 'vs/workbench/api/common/extHostFileSystemConsumer';\nimport { URI } from 'vs/base/common/uri';\n\nexport const IExtensionStoragePaths = createDecorator<IExtensionStoragePaths>('IExtensionStoragePaths');\n\nexport interface IExtensionStoragePaths {\n\treadonly _serviceBrand: undefined;\n\twhenReady: Promise<any>;\n\tworkspaceValue(extension: IExtensionDescription): URI | undefined;\n\tglobalValue(extension: IExtensionDescription): URI;\n}\n\nexport class ExtensionStoragePaths implements IExtensionStoragePaths {\n\n\treadonly _serviceBrand: undefined;\n\n\tprivate readonly _workspace?: IStaticWorkspaceData;\n\tprivate readonly _environment: IEnvironment;\n\n\treadonly whenReady: Promise<URI | undefined>;\n\tprivate _value?: URI;\n\n\tconstructor(\n\t\t@IExtHostInitDataService initData: IExtHostInitDataService,\n\t\t@ILogService private readonly _logService: ILogService,\n\t\t@IExtHostConsumerFileSystem private readonly _extHostFileSystem: IExtHostConsumerFileSystem\n\t) {\n\t\tthis._workspace = initData.workspace ?? undefined;\n\t\tthis._environment = initData.environment;\n\t\tthis.whenReady = this._getOrCreateWorkspaceStoragePath().then(value => this._value = value);\n\t}\n\n\tprivate async _getOrCreateWorkspaceStoragePath(): Promise<URI | undefined> {\n\t\tif (!this._workspace) {\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\t\tconst storageName = this._workspace.id;\n\t\tconst storageUri = URI.joinPath(this._environment.workspaceStorageHome, storageName);\n\n\t\ttry {\n\t\t\tawait this._extHostFileSystem.stat(storageUri);\n\t\t\tthis._logService.trace('[ExtHostStorage] storage dir already exists', storageUri);\n\t\t\treturn storageUri;\n\t\t} catch {\n\t\t\t// doesn't exist, that's OK\n\t\t}\n\n\t\ttry {\n\t\t\tthis._logService.trace('[ExtHostStorage] creating dir and metadata-file', storageUri);\n\t\t\tawait this._extHostFileSystem.createDirectory(storageUri);\n\t\t\tawait this._extHostFileSystem.writeFile(\n\t\t\t\tURI.joinPath(storageUri, 'meta.json'),\n\t\t\t\tnew TextEncoder().encode(JSON.stringify({\n\t\t\t\t\tid: this._workspace.id,\n\t\t\t\t\tconfiguration: URI.revive(this._workspace.configuration)?.toString(),\n\t\t\t\t\tname: this._workspace.name\n\t\t\t\t}, undefined, 2))\n\t\t\t);\n\t\t\treturn storageUri;\n\n\t\t} catch (e) {\n\t\t\tthis._logService.error('[ExtHostStorage]', e);\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tworkspaceValue(extension: IExtensionDescription): URI | undefined {\n\t\tif (this._value) {\n\t\t\treturn URI.joinPath(this._value, extension.identifier.value);\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tglobalValue(extension: IExtensionDescription): URI {\n\t\treturn URI.joinPath(this._environment.globalStorageHome, extension.identifier.value.toLowerCase());\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type * as vscode from 'vscode';\nimport { Event, Emitter } from 'vs/base/common/event';\nimport { ExtHostTerminalServiceShape, MainContext, MainThreadTerminalServiceShape, IShellLaunchConfigDto, IShellDefinitionDto, IShellAndArgsDto, ITerminalDimensionsDto, ITerminalLinkDto, TerminalIdentifier } from 'vs/workbench/api/common/extHost.protocol';\nimport { ExtHostConfigProvider } from 'vs/workbench/api/common/extHostConfiguration';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { ITerminalChildProcess, ITerminalLaunchError, ITerminalDimensionsOverride } from 'vs/workbench/contrib/terminal/common/terminal';\nimport { IExtHostRpcService } from 'vs/workbench/api/common/extHostRpcService';\nimport { TerminalDataBufferer } from 'vs/workbench/contrib/terminal/common/terminalDataBuffering';\nimport { IDisposable, DisposableStore, Disposable } from 'vs/base/common/lifecycle';\nimport { Disposable as VSCodeDisposable, EnvironmentVariableMutatorType } from './extHostTypes';\nimport { IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { ISerializableEnvironmentVariableCollection } from 'vs/workbench/contrib/terminal/common/environmentVariable';\nimport { localize } from 'vs/nls';\nimport { NotSupportedError } from 'vs/base/common/errors';\nimport { serializeEnvironmentVariableCollection } from 'vs/workbench/contrib/terminal/common/environmentVariableShared';\nimport { CancellationTokenSource } from 'vs/base/common/cancellation';\nimport { generateUuid } from 'vs/base/common/uuid';\n\nexport interface IExtHostTerminalService extends ExtHostTerminalServiceShape, IDisposable {\n\n\treadonly _serviceBrand: undefined;\n\n\tactiveTerminal: vscode.Terminal | undefined;\n\tterminals: vscode.Terminal[];\n\n\tonDidCloseTerminal: Event<vscode.Terminal>;\n\tonDidOpenTerminal: Event<vscode.Terminal>;\n\tonDidChangeActiveTerminal: Event<vscode.Terminal | undefined>;\n\tonDidChangeTerminalDimensions: Event<vscode.TerminalDimensionsChangeEvent>;\n\tonDidWriteTerminalData: Event<vscode.TerminalDataWriteEvent>;\n\n\tcreateTerminal(name?: string, shellPath?: string, shellArgs?: string[] | string): vscode.Terminal;\n\tcreateTerminalFromOptions(options: vscode.TerminalOptions, isFeatureTerminal?: boolean): vscode.Terminal;\n\tcreateExtensionTerminal(options: vscode.ExtensionTerminalOptions): vscode.Terminal;\n\tattachPtyToTerminal(id: number, pty: vscode.Pseudoterminal): void;\n\tgetDefaultShell(useAutomationShell: boolean, configProvider: ExtHostConfigProvider): string;\n\tgetDefaultShellArgs(useAutomationShell: boolean, configProvider: ExtHostConfigProvider): string[] | string;\n\tregisterLinkProvider(provider: vscode.TerminalLinkProvider): vscode.Disposable;\n\tgetEnvironmentVariableCollection(extension: IExtensionDescription, persistent?: boolean): vscode.EnvironmentVariableCollection;\n}\n\nexport const IExtHostTerminalService = createDecorator<IExtHostTerminalService>('IExtHostTerminalService');\n\nexport class ExtHostTerminal implements vscode.Terminal {\n\tprivate _disposed: boolean = false;\n\tprivate _pidPromise: Promise<number | undefined>;\n\tprivate _cols: number | undefined;\n\tprivate _pidPromiseComplete: ((value: number | undefined) => any) | undefined;\n\tprivate _rows: number | undefined;\n\tprivate _exitStatus: vscode.TerminalExitStatus | undefined;\n\n\tpublic isOpen: boolean = false;\n\n\tconstructor(\n\t\tprivate _proxy: MainThreadTerminalServiceShape,\n\t\tpublic _id: TerminalIdentifier,\n\t\tprivate readonly _creationOptions: vscode.TerminalOptions | vscode.ExtensionTerminalOptions,\n\t\tprivate _name?: string,\n\t) {\n\t\tthis._creationOptions = Object.freeze(this._creationOptions);\n\t\tthis._pidPromise = new Promise<number | undefined>(c => this._pidPromiseComplete = c);\n\t}\n\n\tpublic async create(\n\t\tshellPath?: string,\n\t\tshellArgs?: string[] | string,\n\t\tcwd?: string | URI,\n\t\tenv?: { [key: string]: string | null },\n\t\twaitOnExit?: boolean,\n\t\tstrictEnv?: boolean,\n\t\thideFromUser?: boolean,\n\t\tisFeatureTerminal?: boolean\n\t): Promise<void> {\n\t\tif (typeof this._id !== 'string') {\n\t\t\tthrow new Error('Terminal has already been created');\n\t\t}\n\t\tawait this._proxy.$createTerminal(this._id, { name: this._name, shellPath, shellArgs, cwd, env, waitOnExit, strictEnv, hideFromUser, isFeatureTerminal });\n\t}\n\n\tpublic async createExtensionTerminal(): Promise<number> {\n\t\tif (typeof this._id !== 'string') {\n\t\t\tthrow new Error('Terminal has already been created');\n\t\t}\n\t\tawait this._proxy.$createTerminal(this._id, { name: this._name, isExtensionTerminal: true });\n\t\t// At this point, the id has been set via `$acceptTerminalOpened`\n\t\tif (typeof this._id === 'string') {\n\t\t\tthrow new Error('Terminal creation failed');\n\t\t}\n\t\treturn this._id;\n\t}\n\n\tpublic dispose(): void {\n\t\tif (!this._disposed) {\n\t\t\tthis._disposed = true;\n\t\t\tthis._proxy.$dispose(this._id);\n\t\t}\n\t}\n\n\tprivate _checkDisposed() {\n\t\tif (this._disposed) {\n\t\t\tthrow new Error('Terminal has already been disposed');\n\t\t}\n\t}\n\n\tpublic get name(): string {\n\t\treturn this._name || '';\n\t}\n\n\tpublic set name(name: string) {\n\t\tthis._name = name;\n\t}\n\n\tpublic get exitStatus(): vscode.TerminalExitStatus | undefined {\n\t\treturn this._exitStatus;\n\t}\n\n\tpublic get dimensions(): vscode.TerminalDimensions | undefined {\n\t\tif (this._cols === undefined || this._rows === undefined) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn {\n\t\t\tcolumns: this._cols,\n\t\t\trows: this._rows\n\t\t};\n\t}\n\n\tpublic setExitCode(code: number | undefined) {\n\t\tthis._exitStatus = Object.freeze({ code });\n\t}\n\n\tpublic setDimensions(cols: number, rows: number): boolean {\n\t\tif (cols === this._cols && rows === this._rows) {\n\t\t\t// Nothing changed\n\t\t\treturn false;\n\t\t}\n\t\tif (cols === 0 || rows === 0) {\n\t\t\treturn false;\n\t\t}\n\t\tthis._cols = cols;\n\t\tthis._rows = rows;\n\t\treturn true;\n\t}\n\n\tpublic get processId(): Promise<number | undefined> {\n\t\treturn this._pidPromise;\n\t}\n\n\tpublic get creationOptions(): Readonly<vscode.TerminalOptions | vscode.ExtensionTerminalOptions> {\n\t\treturn this._creationOptions;\n\t}\n\n\tpublic sendText(text: string, addNewLine: boolean = true): void {\n\t\tthis._checkDisposed();\n\t\tthis._proxy.$sendText(this._id, text, addNewLine);\n\t}\n\n\tpublic show(preserveFocus: boolean): void {\n\t\tthis._checkDisposed();\n\t\tthis._proxy.$show(this._id, preserveFocus);\n\t}\n\n\tpublic hide(): void {\n\t\tthis._checkDisposed();\n\t\tthis._proxy.$hide(this._id);\n\t}\n\n\tpublic _setProcessId(processId: number | undefined): void {\n\t\t// The event may fire 2 times when the panel is restored\n\t\tif (this._pidPromiseComplete) {\n\t\t\tthis._pidPromiseComplete(processId);\n\t\t\tthis._pidPromiseComplete = undefined;\n\t\t} else {\n\t\t\t// Recreate the promise if this is the nth processId set (e.g. reused task terminals)\n\t\t\tthis._pidPromise.then(pid => {\n\t\t\t\tif (pid !== processId) {\n\t\t\t\t\tthis._pidPromise = Promise.resolve(processId);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n}\n\nexport class ExtHostPseudoterminal implements ITerminalChildProcess {\n\tprivate readonly _onProcessData = new Emitter<string>();\n\tpublic readonly onProcessData: Event<string> = this._onProcessData.event;\n\tprivate readonly _onProcessExit = new Emitter<number | undefined>();\n\tpublic readonly onProcessExit: Event<number | undefined> = this._onProcessExit.event;\n\tprivate readonly _onProcessReady = new Emitter<{ pid: number, cwd: string }>();\n\tpublic get onProcessReady(): Event<{ pid: number, cwd: string }> { return this._onProcessReady.event; }\n\tprivate readonly _onProcessTitleChanged = new Emitter<string>();\n\tpublic readonly onProcessTitleChanged: Event<string> = this._onProcessTitleChanged.event;\n\tprivate readonly _onProcessOverrideDimensions = new Emitter<ITerminalDimensionsOverride | undefined>();\n\tpublic get onProcessOverrideDimensions(): Event<ITerminalDimensionsOverride | undefined> { return this._onProcessOverrideDimensions.event; }\n\n\tconstructor(private readonly _pty: vscode.Pseudoterminal) { }\n\n\tasync start(): Promise<undefined> {\n\t\treturn undefined;\n\t}\n\n\tshutdown(): void {\n\t\tthis._pty.close();\n\t}\n\n\tinput(data: string): void {\n\t\tif (this._pty.handleInput) {\n\t\t\tthis._pty.handleInput(data);\n\t\t}\n\t}\n\n\tresize(cols: number, rows: number): void {\n\t\tif (this._pty.setDimensions) {\n\t\t\tthis._pty.setDimensions({ columns: cols, rows });\n\t\t}\n\t}\n\n\tacknowledgeDataEvent(charCount: number): void {\n\t\t// No-op, flow control is not supported in extension owned terminals. If this is ever\n\t\t// implemented it will need new pause and resume VS Code APIs.\n\t}\n\n\tgetInitialCwd(): Promise<string> {\n\t\treturn Promise.resolve('');\n\t}\n\n\tgetCwd(): Promise<string> {\n\t\treturn Promise.resolve('');\n\t}\n\n\tgetLatency(): Promise<number> {\n\t\treturn Promise.resolve(0);\n\t}\n\n\tstartSendingEvents(initialDimensions: ITerminalDimensionsDto | undefined): void {\n\t\t// Attach the listeners\n\t\tthis._pty.onDidWrite(e => this._onProcessData.fire(e));\n\t\tif (this._pty.onDidClose) {\n\t\t\tthis._pty.onDidClose((e: number | void = undefined) => {\n\t\t\t\tthis._onProcessExit.fire(e === void 0 ? undefined : e);\n\t\t\t});\n\t\t}\n\t\tif (this._pty.onDidOverrideDimensions) {\n\t\t\tthis._pty.onDidOverrideDimensions(e => this._onProcessOverrideDimensions.fire(e ? { cols: e.columns, rows: e.rows } : e));\n\t\t}\n\n\t\tthis._pty.open(initialDimensions ? initialDimensions : undefined);\n\n\t\tif (this._pty.setDimensions && initialDimensions) {\n\t\t\tthis._pty.setDimensions(initialDimensions);\n\t\t}\n\n\t\tthis._onProcessReady.fire({ pid: -1, cwd: '' });\n\t}\n}\n\nlet nextLinkId = 1;\n\ninterface ICachedLinkEntry {\n\tprovider: vscode.TerminalLinkProvider;\n\tlink: vscode.TerminalLink;\n}\n\nexport abstract class BaseExtHostTerminalService extends Disposable implements IExtHostTerminalService, ExtHostTerminalServiceShape {\n\n\treadonly _serviceBrand: undefined;\n\n\tprotected _proxy: MainThreadTerminalServiceShape;\n\tprotected _activeTerminal: ExtHostTerminal | undefined;\n\tprotected _terminals: ExtHostTerminal[] = [];\n\tprotected _terminalProcesses: Map<number, ITerminalChildProcess> = new Map();\n\tprotected _terminalProcessDisposables: { [id: number]: IDisposable } = {};\n\tprotected _extensionTerminalAwaitingStart: { [id: number]: { initialDimensions: ITerminalDimensionsDto | undefined } | undefined } = {};\n\tprotected _getTerminalPromises: { [id: number]: Promise<ExtHostTerminal | undefined> } = {};\n\tprotected _environmentVariableCollections: Map<string, EnvironmentVariableCollection> = new Map();\n\n\tprivate readonly _bufferer: TerminalDataBufferer;\n\tprivate readonly _linkProviders: Set<vscode.TerminalLinkProvider> = new Set();\n\tprivate readonly _terminalLinkCache: Map<number, Map<number, ICachedLinkEntry>> = new Map();\n\tprivate readonly _terminalLinkCancellationSource: Map<number, CancellationTokenSource> = new Map();\n\n\tpublic get activeTerminal(): ExtHostTerminal | undefined { return this._activeTerminal; }\n\tpublic get terminals(): ExtHostTerminal[] { return this._terminals; }\n\n\tprotected readonly _onDidCloseTerminal: Emitter<vscode.Terminal> = new Emitter<vscode.Terminal>();\n\tpublic get onDidCloseTerminal(): Event<vscode.Terminal> { return this._onDidCloseTerminal && this._onDidCloseTerminal.event; }\n\tprotected readonly _onDidOpenTerminal: Emitter<vscode.Terminal> = new Emitter<vscode.Terminal>();\n\tpublic get onDidOpenTerminal(): Event<vscode.Terminal> { return this._onDidOpenTerminal && this._onDidOpenTerminal.event; }\n\tprotected readonly _onDidChangeActiveTerminal: Emitter<vscode.Terminal | undefined> = new Emitter<vscode.Terminal | undefined>();\n\tpublic get onDidChangeActiveTerminal(): Event<vscode.Terminal | undefined> { return this._onDidChangeActiveTerminal && this._onDidChangeActiveTerminal.event; }\n\tprotected readonly _onDidChangeTerminalDimensions: Emitter<vscode.TerminalDimensionsChangeEvent> = new Emitter<vscode.TerminalDimensionsChangeEvent>();\n\tpublic get onDidChangeTerminalDimensions(): Event<vscode.TerminalDimensionsChangeEvent> { return this._onDidChangeTerminalDimensions && this._onDidChangeTerminalDimensions.event; }\n\tprotected readonly _onDidWriteTerminalData: Emitter<vscode.TerminalDataWriteEvent>;\n\tpublic get onDidWriteTerminalData(): Event<vscode.TerminalDataWriteEvent> { return this._onDidWriteTerminalData && this._onDidWriteTerminalData.event; }\n\n\tconstructor(\n\t\tsupportsProcesses: boolean,\n\t\t@IExtHostRpcService extHostRpc: IExtHostRpcService\n\t) {\n\t\tsuper();\n\t\tthis._proxy = extHostRpc.getProxy(MainContext.MainThreadTerminalService);\n\t\tthis._bufferer = new TerminalDataBufferer(this._proxy.$sendProcessData);\n\t\tthis._onDidWriteTerminalData = new Emitter<vscode.TerminalDataWriteEvent>({\n\t\t\tonFirstListenerAdd: () => this._proxy.$startSendingDataEvents(),\n\t\t\tonLastListenerRemove: () => this._proxy.$stopSendingDataEvents()\n\t\t});\n\t\tthis._proxy.$registerProcessSupport(supportsProcesses);\n\t\tthis._register({\n\t\t\tdispose: () => {\n\t\t\t\tfor (const [_, terminalProcess] of this._terminalProcesses) {\n\t\t\t\t\tterminalProcess.shutdown(true);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic abstract createTerminal(name?: string, shellPath?: string, shellArgs?: string[] | string): vscode.Terminal;\n\tpublic abstract createTerminalFromOptions(options: vscode.TerminalOptions): vscode.Terminal;\n\tpublic abstract getDefaultShell(useAutomationShell: boolean, configProvider: ExtHostConfigProvider): string;\n\tpublic abstract getDefaultShellArgs(useAutomationShell: boolean, configProvider: ExtHostConfigProvider): string[] | string;\n\tpublic abstract $spawnExtHostProcess(id: number, shellLaunchConfigDto: IShellLaunchConfigDto, activeWorkspaceRootUriComponents: UriComponents, cols: number, rows: number, isWorkspaceShellAllowed: boolean): Promise<ITerminalLaunchError | undefined>;\n\tpublic abstract $getAvailableShells(): Promise<IShellDefinitionDto[]>;\n\tpublic abstract $getDefaultShellAndArgs(useAutomationShell: boolean): Promise<IShellAndArgsDto>;\n\tpublic abstract $acceptWorkspacePermissionsChanged(isAllowed: boolean): void;\n\n\tpublic createExtensionTerminal(options: vscode.ExtensionTerminalOptions): vscode.Terminal {\n\t\tconst terminal = new ExtHostTerminal(this._proxy, generateUuid(), options, options.name);\n\t\tconst p = new ExtHostPseudoterminal(options.pty);\n\t\tterminal.createExtensionTerminal().then(id => {\n\t\t\tconst disposable = this._setupExtHostProcessListeners(id, p);\n\t\t\tthis._terminalProcessDisposables[id] = disposable;\n\t\t});\n\t\tthis._terminals.push(terminal);\n\t\treturn terminal;\n\t}\n\n\tpublic attachPtyToTerminal(id: number, pty: vscode.Pseudoterminal): void {\n\t\tconst terminal = this._getTerminalById(id);\n\t\tif (!terminal) {\n\t\t\tthrow new Error(`Cannot resolve terminal with id ${id} for virtual process`);\n\t\t}\n\t\tconst p = new ExtHostPseudoterminal(pty);\n\t\tconst disposable = this._setupExtHostProcessListeners(id, p);\n\t\tthis._terminalProcessDisposables[id] = disposable;\n\t}\n\n\tpublic async $acceptActiveTerminalChanged(id: number | null): Promise<void> {\n\t\tconst original = this._activeTerminal;\n\t\tif (id === null) {\n\t\t\tthis._activeTerminal = undefined;\n\t\t\tif (original !== this._activeTerminal) {\n\t\t\t\tthis._onDidChangeActiveTerminal.fire(this._activeTerminal);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tconst terminal = this._getTerminalById(id);\n\t\tif (terminal) {\n\t\t\tthis._activeTerminal = terminal;\n\t\t\tif (original !== this._activeTerminal) {\n\t\t\t\tthis._onDidChangeActiveTerminal.fire(this._activeTerminal);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic async $acceptTerminalProcessData(id: number, data: string): Promise<void> {\n\t\tconst terminal = this._getTerminalById(id);\n\t\tif (terminal) {\n\t\t\tthis._onDidWriteTerminalData.fire({ terminal, data });\n\t\t}\n\t}\n\n\tpublic async $acceptTerminalDimensions(id: number, cols: number, rows: number): Promise<void> {\n\t\tconst terminal = this._getTerminalById(id);\n\t\tif (terminal) {\n\t\t\tif (terminal.setDimensions(cols, rows)) {\n\t\t\t\tthis._onDidChangeTerminalDimensions.fire({\n\t\t\t\t\tterminal: terminal,\n\t\t\t\t\tdimensions: terminal.dimensions as vscode.TerminalDimensions\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic async $acceptTerminalMaximumDimensions(id: number, cols: number, rows: number): Promise<void> {\n\t\t// Extension pty terminal only - when virtual process resize fires it means that the\n\t\t// terminal's maximum dimensions changed\n\t\tthis._terminalProcesses.get(id)?.resize(cols, rows);\n\t}\n\n\tpublic async $acceptTerminalTitleChange(id: number, name: string): Promise<void> {\n\t\tconst terminal = this._getTerminalById(id);\n\t\tif (terminal) {\n\t\t\tterminal.name = name;\n\t\t}\n\t}\n\n\tpublic async $acceptTerminalClosed(id: number, exitCode: number | undefined): Promise<void> {\n\t\tconst index = this._getTerminalObjectIndexById(this.terminals, id);\n\t\tif (index !== null) {\n\t\t\tconst terminal = this._terminals.splice(index, 1)[0];\n\t\t\tterminal.setExitCode(exitCode);\n\t\t\tthis._onDidCloseTerminal.fire(terminal);\n\t\t}\n\t}\n\n\tpublic $acceptTerminalOpened(id: number, extHostTerminalId: string | undefined, name: string, shellLaunchConfigDto: IShellLaunchConfigDto): void {\n\t\tif (extHostTerminalId) {\n\t\t\t// Resolve with the renderer generated id\n\t\t\tconst index = this._getTerminalObjectIndexById(this._terminals, extHostTerminalId);\n\t\t\tif (index !== null) {\n\t\t\t\t// The terminal has already been created (via createTerminal*), only fire the event\n\t\t\t\tthis.terminals[index]._id = id;\n\t\t\t\tthis._onDidOpenTerminal.fire(this.terminals[index]);\n\t\t\t\tthis.terminals[index].isOpen = true;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tconst creationOptions: vscode.TerminalOptions = {\n\t\t\tname: shellLaunchConfigDto.name,\n\t\t\tshellPath: shellLaunchConfigDto.executable,\n\t\t\tshellArgs: shellLaunchConfigDto.args,\n\t\t\tcwd: typeof shellLaunchConfigDto.cwd === 'string' ? shellLaunchConfigDto.cwd : URI.revive(shellLaunchConfigDto.cwd),\n\t\t\tenv: shellLaunchConfigDto.env,\n\t\t\thideFromUser: shellLaunchConfigDto.hideFromUser\n\t\t};\n\t\tconst terminal = new ExtHostTerminal(this._proxy, id, creationOptions, name);\n\t\tthis._terminals.push(terminal);\n\t\tthis._onDidOpenTerminal.fire(terminal);\n\t\tterminal.isOpen = true;\n\t}\n\n\tpublic async $acceptTerminalProcessId(id: number, processId: number): Promise<void> {\n\t\tconst terminal = this._getTerminalById(id);\n\t\tif (terminal) {\n\t\t\tterminal._setProcessId(processId);\n\t\t}\n\t}\n\n\tpublic async $startExtensionTerminal(id: number, initialDimensions: ITerminalDimensionsDto | undefined): Promise<ITerminalLaunchError | undefined> {\n\t\t// Make sure the ExtHostTerminal exists so onDidOpenTerminal has fired before we call\n\t\t// Pseudoterminal.start\n\t\tconst terminal = this._getTerminalById(id);\n\t\tif (!terminal) {\n\t\t\treturn { message: localize('launchFail.idMissingOnExtHost', \"Could not find the terminal with id {0} on the extension host\", id) };\n\t\t}\n\n\t\t// Wait for onDidOpenTerminal to fire\n\t\tif (!terminal.isOpen) {\n\t\t\tawait new Promise<void>(r => {\n\t\t\t\t// Ensure open is called after onDidOpenTerminal\n\t\t\t\tconst listener = this.onDidOpenTerminal(async e => {\n\t\t\t\t\tif (e === terminal) {\n\t\t\t\t\t\tlistener.dispose();\n\t\t\t\t\t\tr();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tconst terminalProcess = this._terminalProcesses.get(id);\n\t\tif (terminalProcess) {\n\t\t\t(terminalProcess as ExtHostPseudoterminal).startSendingEvents(initialDimensions);\n\t\t} else {\n\t\t\t// Defer startSendingEvents call to when _setupExtHostProcessListeners is called\n\t\t\tthis._extensionTerminalAwaitingStart[id] = { initialDimensions };\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprotected _setupExtHostProcessListeners(id: number, p: ITerminalChildProcess): IDisposable {\n\t\tconst disposables = new DisposableStore();\n\n\t\tdisposables.add(p.onProcessReady((e: { pid: number, cwd: string }) => this._proxy.$sendProcessReady(id, e.pid, e.cwd)));\n\t\tdisposables.add(p.onProcessTitleChanged(title => this._proxy.$sendProcessTitle(id, title)));\n\n\t\t// Buffer data events to reduce the amount of messages going to the renderer\n\t\tthis._bufferer.startBuffering(id, p.onProcessData);\n\t\tdisposables.add(p.onProcessExit(exitCode => this._onProcessExit(id, exitCode)));\n\n\t\tif (p.onProcessOverrideDimensions) {\n\t\t\tdisposables.add(p.onProcessOverrideDimensions(e => this._proxy.$sendOverrideDimensions(id, e)));\n\t\t}\n\t\tthis._terminalProcesses.set(id, p);\n\n\t\tconst awaitingStart = this._extensionTerminalAwaitingStart[id];\n\t\tif (awaitingStart && p instanceof ExtHostPseudoterminal) {\n\t\t\tp.startSendingEvents(awaitingStart.initialDimensions);\n\t\t\tdelete this._extensionTerminalAwaitingStart[id];\n\t\t}\n\n\t\treturn disposables;\n\t}\n\n\tpublic $acceptProcessAckDataEvent(id: number, charCount: number): void {\n\t\tthis._terminalProcesses.get(id)?.acknowledgeDataEvent(charCount);\n\t}\n\n\tpublic $acceptProcessInput(id: number, data: string): void {\n\t\tthis._terminalProcesses.get(id)?.input(data);\n\t}\n\n\tpublic $acceptProcessResize(id: number, cols: number, rows: number): void {\n\t\ttry {\n\t\t\tthis._terminalProcesses.get(id)?.resize(cols, rows);\n\t\t} catch (error) {\n\t\t\t// We tried to write to a closed pipe / channel.\n\t\t\tif (error.code !== 'EPIPE' && error.code !== 'ERR_IPC_CHANNEL_CLOSED') {\n\t\t\t\tthrow (error);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic $acceptProcessShutdown(id: number, immediate: boolean): void {\n\t\tthis._terminalProcesses.get(id)?.shutdown(immediate);\n\t}\n\n\tpublic $acceptProcessRequestInitialCwd(id: number): void {\n\t\tthis._terminalProcesses.get(id)?.getInitialCwd().then(initialCwd => this._proxy.$sendProcessInitialCwd(id, initialCwd));\n\t}\n\n\tpublic $acceptProcessRequestCwd(id: number): void {\n\t\tthis._terminalProcesses.get(id)?.getCwd().then(cwd => this._proxy.$sendProcessCwd(id, cwd));\n\t}\n\n\tpublic $acceptProcessRequestLatency(id: number): number {\n\t\treturn id;\n\t}\n\n\tpublic registerLinkProvider(provider: vscode.TerminalLinkProvider): vscode.Disposable {\n\t\tthis._linkProviders.add(provider);\n\t\tif (this._linkProviders.size === 1) {\n\t\t\tthis._proxy.$startLinkProvider();\n\t\t}\n\t\treturn new VSCodeDisposable(() => {\n\t\t\tthis._linkProviders.delete(provider);\n\t\t\tif (this._linkProviders.size === 0) {\n\t\t\t\tthis._proxy.$stopLinkProvider();\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic async $provideLinks(terminalId: number, line: string): Promise<ITerminalLinkDto[]> {\n\t\tconst terminal = this._getTerminalById(terminalId);\n\t\tif (!terminal) {\n\t\t\treturn [];\n\t\t}\n\n\t\t// Discard any cached links the terminal has been holding, currently all links are released\n\t\t// when new links are provided.\n\t\tthis._terminalLinkCache.delete(terminalId);\n\n\t\tconst oldToken = this._terminalLinkCancellationSource.get(terminalId);\n\t\tif (oldToken) {\n\t\t\toldToken.dispose(true);\n\t\t}\n\t\tconst cancellationSource = new CancellationTokenSource();\n\t\tthis._terminalLinkCancellationSource.set(terminalId, cancellationSource);\n\n\t\tconst result: ITerminalLinkDto[] = [];\n\t\tconst context: vscode.TerminalLinkContext = { terminal, line };\n\t\tconst promises: vscode.ProviderResult<{ provider: vscode.TerminalLinkProvider, links: vscode.TerminalLink[] }>[] = [];\n\n\t\tfor (const provider of this._linkProviders) {\n\t\t\tpromises.push(new Promise(async r => {\n\t\t\t\tcancellationSource.token.onCancellationRequested(() => r({ provider, links: [] }));\n\t\t\t\tconst links = (await provider.provideTerminalLinks(context, cancellationSource.token)) || [];\n\t\t\t\tif (!cancellationSource.token.isCancellationRequested) {\n\t\t\t\t\tr({ provider, links });\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\n\t\tconst provideResults = await Promise.all(promises);\n\n\t\tif (cancellationSource.token.isCancellationRequested) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst cacheLinkMap = new Map<number, ICachedLinkEntry>();\n\t\tfor (const provideResult of provideResults) {\n\t\t\tif (provideResult && provideResult.links.length > 0) {\n\t\t\t\tresult.push(...provideResult.links.map(providerLink => {\n\t\t\t\t\tconst link = {\n\t\t\t\t\t\tid: nextLinkId++,\n\t\t\t\t\t\tstartIndex: providerLink.startIndex,\n\t\t\t\t\t\tlength: providerLink.length,\n\t\t\t\t\t\tlabel: providerLink.tooltip\n\t\t\t\t\t};\n\t\t\t\t\tcacheLinkMap.set(link.id, {\n\t\t\t\t\t\tprovider: provideResult.provider,\n\t\t\t\t\t\tlink: providerLink\n\t\t\t\t\t});\n\t\t\t\t\treturn link;\n\t\t\t\t}));\n\t\t\t}\n\t\t}\n\n\t\tthis._terminalLinkCache.set(terminalId, cacheLinkMap);\n\n\t\treturn result;\n\t}\n\n\t$activateLink(terminalId: number, linkId: number): void {\n\t\tconst cachedLink = this._terminalLinkCache.get(terminalId)?.get(linkId);\n\t\tif (!cachedLink) {\n\t\t\treturn;\n\t\t}\n\t\tcachedLink.provider.handleTerminalLink(cachedLink.link);\n\t}\n\n\tprivate _onProcessExit(id: number, exitCode: number | undefined): void {\n\t\tthis._bufferer.stopBuffering(id);\n\n\t\t// Remove process reference\n\t\tthis._terminalProcesses.delete(id);\n\t\tdelete this._extensionTerminalAwaitingStart[id];\n\n\t\t// Clean up process disposables\n\t\tconst processDiposable = this._terminalProcessDisposables[id];\n\t\tif (processDiposable) {\n\t\t\tprocessDiposable.dispose();\n\t\t\tdelete this._terminalProcessDisposables[id];\n\t\t}\n\n\t\t// Send exit event to main side\n\t\tthis._proxy.$sendProcessExit(id, exitCode);\n\t}\n\n\tprivate _getTerminalById(id: number): ExtHostTerminal | null {\n\t\treturn this._getTerminalObjectById(this._terminals, id);\n\t}\n\n\tprivate _getTerminalObjectById<T extends ExtHostTerminal>(array: T[], id: number): T | null {\n\t\tconst index = this._getTerminalObjectIndexById(array, id);\n\t\treturn index !== null ? array[index] : null;\n\t}\n\n\tprivate _getTerminalObjectIndexById<T extends ExtHostTerminal>(array: T[], id: TerminalIdentifier): number | null {\n\t\tlet index: number | null = null;\n\t\tarray.some((item, i) => {\n\t\t\tconst thisId = item._id;\n\t\t\tif (thisId === id) {\n\t\t\t\tindex = i;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\t\treturn index;\n\t}\n\n\tpublic getEnvironmentVariableCollection(extension: IExtensionDescription): vscode.EnvironmentVariableCollection {\n\t\tlet collection = this._environmentVariableCollections.get(extension.identifier.value);\n\t\tif (!collection) {\n\t\t\tcollection = new EnvironmentVariableCollection();\n\t\t\tthis._setEnvironmentVariableCollection(extension.identifier.value, collection);\n\t\t}\n\t\treturn collection;\n\t}\n\n\tprivate _syncEnvironmentVariableCollection(extensionIdentifier: string, collection: EnvironmentVariableCollection): void {\n\t\tconst serialized = serializeEnvironmentVariableCollection(collection.map);\n\t\tthis._proxy.$setEnvironmentVariableCollection(extensionIdentifier, collection.persistent, serialized.length === 0 ? undefined : serialized);\n\t}\n\n\tpublic $initEnvironmentVariableCollections(collections: [string, ISerializableEnvironmentVariableCollection][]): void {\n\t\tcollections.forEach(entry => {\n\t\t\tconst extensionIdentifier = entry[0];\n\t\t\tconst collection = new EnvironmentVariableCollection(entry[1]);\n\t\t\tthis._setEnvironmentVariableCollection(extensionIdentifier, collection);\n\t\t});\n\t}\n\n\tprivate _setEnvironmentVariableCollection(extensionIdentifier: string, collection: EnvironmentVariableCollection): void {\n\t\tthis._environmentVariableCollections.set(extensionIdentifier, collection);\n\t\tcollection.onDidChangeCollection(() => {\n\t\t\t// When any collection value changes send this immediately, this is done to ensure\n\t\t\t// following calls to createTerminal will be created with the new environment. It will\n\t\t\t// result in more noise by sending multiple updates when called but collections are\n\t\t\t// expected to be small.\n\t\t\tthis._syncEnvironmentVariableCollection(extensionIdentifier, collection!);\n\t\t});\n\t}\n}\n\nexport class EnvironmentVariableCollection implements vscode.EnvironmentVariableCollection {\n\treadonly map: Map<string, vscode.EnvironmentVariableMutator> = new Map();\n\tprivate _persistent: boolean = true;\n\n\tpublic get persistent(): boolean { return this._persistent; }\n\tpublic set persistent(value: boolean) {\n\t\tthis._persistent = value;\n\t\tthis._onDidChangeCollection.fire();\n\t}\n\n\tprotected readonly _onDidChangeCollection: Emitter<void> = new Emitter<void>();\n\tget onDidChangeCollection(): Event<void> { return this._onDidChangeCollection && this._onDidChangeCollection.event; }\n\n\tconstructor(\n\t\tserialized?: ISerializableEnvironmentVariableCollection\n\t) {\n\t\tthis.map = new Map(serialized);\n\t}\n\n\tget size(): number {\n\t\treturn this.map.size;\n\t}\n\n\treplace(variable: string, value: string): void {\n\t\tthis._setIfDiffers(variable, { value, type: EnvironmentVariableMutatorType.Replace });\n\t}\n\n\tappend(variable: string, value: string): void {\n\t\tthis._setIfDiffers(variable, { value, type: EnvironmentVariableMutatorType.Append });\n\t}\n\n\tprepend(variable: string, value: string): void {\n\t\tthis._setIfDiffers(variable, { value, type: EnvironmentVariableMutatorType.Prepend });\n\t}\n\n\tprivate _setIfDiffers(variable: string, mutator: vscode.EnvironmentVariableMutator): void {\n\t\tconst current = this.map.get(variable);\n\t\tif (!current || current.value !== mutator.value || current.type !== mutator.type) {\n\t\t\tthis.map.set(variable, mutator);\n\t\t\tthis._onDidChangeCollection.fire();\n\t\t}\n\t}\n\n\tget(variable: string): vscode.EnvironmentVariableMutator | undefined {\n\t\treturn this.map.get(variable);\n\t}\n\n\tforEach(callback: (variable: string, mutator: vscode.EnvironmentVariableMutator, collection: vscode.EnvironmentVariableCollection) => any, thisArg?: any): void {\n\t\tthis.map.forEach((value, key) => callback.call(thisArg, key, value, this));\n\t}\n\n\tdelete(variable: string): void {\n\t\tthis.map.delete(variable);\n\t\tthis._onDidChangeCollection.fire();\n\t}\n\n\tclear(): void {\n\t\tthis.map.clear();\n\t\tthis._onDidChangeCollection.fire();\n\t}\n}\n\nexport class WorkerExtHostTerminalService extends BaseExtHostTerminalService {\n\tconstructor(\n\t\t@IExtHostRpcService extHostRpc: IExtHostRpcService\n\t) {\n\t\tsuper(false, extHostRpc);\n\t}\n\n\tpublic createTerminal(name?: string, shellPath?: string, shellArgs?: string[] | string): vscode.Terminal {\n\t\tthrow new NotSupportedError();\n\t}\n\n\tpublic createTerminalFromOptions(options: vscode.TerminalOptions): vscode.Terminal {\n\t\tthrow new NotSupportedError();\n\t}\n\n\tpublic getDefaultShell(useAutomationShell: boolean, configProvider: ExtHostConfigProvider): string {\n\t\t// Return the empty string to avoid throwing\n\t\treturn '';\n\t}\n\n\tpublic getDefaultShellArgs(useAutomationShell: boolean, configProvider: ExtHostConfigProvider): string[] | string {\n\t\tthrow new NotSupportedError();\n\t}\n\n\tpublic $spawnExtHostProcess(id: number, shellLaunchConfigDto: IShellLaunchConfigDto, activeWorkspaceRootUriComponents: UriComponents, cols: number, rows: number, isWorkspaceShellAllowed: boolean): Promise<ITerminalLaunchError | undefined> {\n\t\tthrow new NotSupportedError();\n\t}\n\n\tpublic $getAvailableShells(): Promise<IShellDefinitionDto[]> {\n\t\tthrow new NotSupportedError();\n\t}\n\n\tpublic async $getDefaultShellAndArgs(useAutomationShell: boolean): Promise<IShellAndArgsDto> {\n\t\tthrow new NotSupportedError();\n\t}\n\n\tpublic $acceptWorkspacePermissionsChanged(isAllowed: boolean): void {\n\t\t// No-op for web worker ext host as workspace permissions aren't used\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from 'vs/base/common/event';\nimport * as arrays from 'vs/base/common/arrays';\nimport { ExtHostEditorsShape, IEditorPropertiesChangeData, IMainContext, ITextDocumentShowOptions, ITextEditorPositionData, MainContext, MainThreadTextEditorsShape } from 'vs/workbench/api/common/extHost.protocol';\nimport { ExtHostDocumentsAndEditors } from 'vs/workbench/api/common/extHostDocumentsAndEditors';\nimport { ExtHostTextEditor, TextEditorDecorationType } from 'vs/workbench/api/common/extHostTextEditor';\nimport * as TypeConverters from 'vs/workbench/api/common/extHostTypeConverters';\nimport { TextEditorSelectionChangeKind } from 'vs/workbench/api/common/extHostTypes';\nimport type * as vscode from 'vscode';\n\nexport class ExtHostEditors implements ExtHostEditorsShape {\n\n\tprivate readonly _onDidChangeTextEditorSelection = new Emitter<vscode.TextEditorSelectionChangeEvent>();\n\tprivate readonly _onDidChangeTextEditorOptions = new Emitter<vscode.TextEditorOptionsChangeEvent>();\n\tprivate readonly _onDidChangeTextEditorVisibleRanges = new Emitter<vscode.TextEditorVisibleRangesChangeEvent>();\n\tprivate readonly _onDidChangeTextEditorViewColumn = new Emitter<vscode.TextEditorViewColumnChangeEvent>();\n\tprivate readonly _onDidChangeActiveTextEditor = new Emitter<vscode.TextEditor | undefined>();\n\tprivate readonly _onDidChangeVisibleTextEditors = new Emitter<vscode.TextEditor[]>();\n\n\treadonly onDidChangeTextEditorSelection: Event<vscode.TextEditorSelectionChangeEvent> = this._onDidChangeTextEditorSelection.event;\n\treadonly onDidChangeTextEditorOptions: Event<vscode.TextEditorOptionsChangeEvent> = this._onDidChangeTextEditorOptions.event;\n\treadonly onDidChangeTextEditorVisibleRanges: Event<vscode.TextEditorVisibleRangesChangeEvent> = this._onDidChangeTextEditorVisibleRanges.event;\n\treadonly onDidChangeTextEditorViewColumn: Event<vscode.TextEditorViewColumnChangeEvent> = this._onDidChangeTextEditorViewColumn.event;\n\treadonly onDidChangeActiveTextEditor: Event<vscode.TextEditor | undefined> = this._onDidChangeActiveTextEditor.event;\n\treadonly onDidChangeVisibleTextEditors: Event<vscode.TextEditor[]> = this._onDidChangeVisibleTextEditors.event;\n\n\tprivate readonly _proxy: MainThreadTextEditorsShape;\n\n\tconstructor(\n\t\tmainContext: IMainContext,\n\t\tprivate readonly _extHostDocumentsAndEditors: ExtHostDocumentsAndEditors,\n\t) {\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadTextEditors);\n\n\n\t\tthis._extHostDocumentsAndEditors.onDidChangeVisibleTextEditors(e => this._onDidChangeVisibleTextEditors.fire(e));\n\t\tthis._extHostDocumentsAndEditors.onDidChangeActiveTextEditor(e => this._onDidChangeActiveTextEditor.fire(e));\n\t}\n\n\tgetActiveTextEditor(): ExtHostTextEditor | undefined {\n\t\treturn this._extHostDocumentsAndEditors.activeEditor();\n\t}\n\n\tgetVisibleTextEditors(): vscode.TextEditor[] {\n\t\treturn this._extHostDocumentsAndEditors.allEditors();\n\t}\n\n\tshowTextDocument(document: vscode.TextDocument, column: vscode.ViewColumn, preserveFocus: boolean): Promise<vscode.TextEditor>;\n\tshowTextDocument(document: vscode.TextDocument, options: { column: vscode.ViewColumn, preserveFocus: boolean, pinned: boolean }): Promise<vscode.TextEditor>;\n\tshowTextDocument(document: vscode.TextDocument, columnOrOptions: vscode.ViewColumn | vscode.TextDocumentShowOptions | undefined, preserveFocus?: boolean): Promise<vscode.TextEditor>;\n\tasync showTextDocument(document: vscode.TextDocument, columnOrOptions: vscode.ViewColumn | vscode.TextDocumentShowOptions | undefined, preserveFocus?: boolean): Promise<vscode.TextEditor> {\n\t\tlet options: ITextDocumentShowOptions;\n\t\tif (typeof columnOrOptions === 'number') {\n\t\t\toptions = {\n\t\t\t\tposition: TypeConverters.ViewColumn.from(columnOrOptions),\n\t\t\t\tpreserveFocus\n\t\t\t};\n\t\t} else if (typeof columnOrOptions === 'object') {\n\t\t\toptions = {\n\t\t\t\tposition: TypeConverters.ViewColumn.from(columnOrOptions.viewColumn),\n\t\t\t\tpreserveFocus: columnOrOptions.preserveFocus,\n\t\t\t\tselection: typeof columnOrOptions.selection === 'object' ? TypeConverters.Range.from(columnOrOptions.selection) : undefined,\n\t\t\t\tpinned: typeof columnOrOptions.preview === 'boolean' ? !columnOrOptions.preview : undefined\n\t\t\t};\n\t\t} else {\n\t\t\toptions = {\n\t\t\t\tpreserveFocus: false\n\t\t\t};\n\t\t}\n\n\t\tconst editorId = await this._proxy.$tryShowTextDocument(document.uri, options);\n\t\tconst editor = editorId && this._extHostDocumentsAndEditors.getEditor(editorId);\n\t\tif (editor) {\n\t\t\treturn editor;\n\t\t}\n\t\t// we have no editor... having an id means that we had an editor\n\t\t// on the main side and that it isn't the current editor anymore...\n\t\tif (editorId) {\n\t\t\tthrow new Error(`Could NOT open editor for \"${document.uri.toString()}\" because another editor opened in the meantime.`);\n\t\t} else {\n\t\t\tthrow new Error(`Could NOT open editor for \"${document.uri.toString()}\".`);\n\t\t}\n\t}\n\n\tcreateTextEditorDecorationType(options: vscode.DecorationRenderOptions): vscode.TextEditorDecorationType {\n\t\treturn new TextEditorDecorationType(this._proxy, options);\n\t}\n\n\t// --- called from main thread\n\n\t$acceptEditorPropertiesChanged(id: string, data: IEditorPropertiesChangeData): void {\n\t\tconst textEditor = this._extHostDocumentsAndEditors.getEditor(id);\n\t\tif (!textEditor) {\n\t\t\tthrow new Error('unknown text editor');\n\t\t}\n\n\t\t// (1) set all properties\n\t\tif (data.options) {\n\t\t\ttextEditor._acceptOptions(data.options);\n\t\t}\n\t\tif (data.selections) {\n\t\t\tconst selections = data.selections.selections.map(TypeConverters.Selection.to);\n\t\t\ttextEditor._acceptSelections(selections);\n\t\t}\n\t\tif (data.visibleRanges) {\n\t\t\tconst visibleRanges = arrays.coalesce(data.visibleRanges.map(TypeConverters.Range.to));\n\t\t\ttextEditor._acceptVisibleRanges(visibleRanges);\n\t\t}\n\n\t\t// (2) fire change events\n\t\tif (data.options) {\n\t\t\tthis._onDidChangeTextEditorOptions.fire({\n\t\t\t\ttextEditor: textEditor,\n\t\t\t\toptions: { ...data.options, lineNumbers: TypeConverters.TextEditorLineNumbersStyle.to(data.options.lineNumbers) }\n\t\t\t});\n\t\t}\n\t\tif (data.selections) {\n\t\t\tconst kind = TextEditorSelectionChangeKind.fromValue(data.selections.source);\n\t\t\tconst selections = data.selections.selections.map(TypeConverters.Selection.to);\n\t\t\tthis._onDidChangeTextEditorSelection.fire({\n\t\t\t\ttextEditor,\n\t\t\t\tselections,\n\t\t\t\tkind\n\t\t\t});\n\t\t}\n\t\tif (data.visibleRanges) {\n\t\t\tconst visibleRanges = arrays.coalesce(data.visibleRanges.map(TypeConverters.Range.to));\n\t\t\tthis._onDidChangeTextEditorVisibleRanges.fire({\n\t\t\t\ttextEditor,\n\t\t\t\tvisibleRanges\n\t\t\t});\n\t\t}\n\t}\n\n\t$acceptEditorPositionData(data: ITextEditorPositionData): void {\n\t\tfor (const id in data) {\n\t\t\tconst textEditor = this._extHostDocumentsAndEditors.getEditor(id);\n\t\t\tif (!textEditor) {\n\t\t\t\tthrow new Error('Unknown text editor');\n\t\t\t}\n\t\t\tconst viewColumn = TypeConverters.ViewColumn.to(data[id]);\n\t\t\tif (textEditor.viewColumn !== viewColumn) {\n\t\t\t\ttextEditor._acceptViewColumn(viewColumn);\n\t\t\t\tthis._onDidChangeTextEditorViewColumn.fire({ textEditor, viewColumn });\n\t\t\t}\n\t\t}\n\t}\n\n\tgetDiffInformation(id: string): Promise<vscode.LineChange[]> {\n\t\treturn Promise.resolve(this._proxy.$getDiffInformation(id));\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as vscode from 'vscode';\nimport { UriComponents, URI } from 'vs/base/common/uri';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { ExtHostTimelineShape, MainThreadTimelineShape, IMainContext, MainContext } from 'vs/workbench/api/common/extHost.protocol';\nimport { Timeline, TimelineItem, TimelineOptions, TimelineProvider, InternalTimelineOptions } from 'vs/workbench/contrib/timeline/common/timeline';\nimport { IDisposable, toDisposable, DisposableStore } from 'vs/base/common/lifecycle';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { CommandsConverter, ExtHostCommands } from 'vs/workbench/api/common/extHostCommands';\nimport { ThemeIcon } from 'vs/workbench/api/common/extHostTypes';\nimport { ExtensionIdentifier } from 'vs/platform/extensions/common/extensions';\n\nexport interface IExtHostTimeline extends ExtHostTimelineShape {\n\treadonly _serviceBrand: undefined;\n\t$getTimeline(id: string, uri: UriComponents, options: vscode.TimelineOptions, token: vscode.CancellationToken, internalOptions?: InternalTimelineOptions): Promise<Timeline | undefined>;\n}\n\nexport const IExtHostTimeline = createDecorator<IExtHostTimeline>('IExtHostTimeline');\n\nexport class ExtHostTimeline implements IExtHostTimeline {\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate _proxy: MainThreadTimelineShape;\n\n\tprivate _providers = new Map<string, TimelineProvider>();\n\n\tprivate _itemsBySourceAndUriMap = new Map<string, Map<string | undefined, Map<string, vscode.TimelineItem>>>();\n\n\tconstructor(\n\t\tmainContext: IMainContext,\n\t\tcommands: ExtHostCommands,\n\t) {\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadTimeline);\n\n\t\tcommands.registerArgumentProcessor({\n\t\t\tprocessArgument: arg => {\n\t\t\t\tif (arg && arg.$mid === 11) {\n\t\t\t\t\tconst uri = arg.uri === undefined ? undefined : URI.revive(arg.uri);\n\t\t\t\t\treturn this._itemsBySourceAndUriMap.get(arg.source)?.get(getUriKey(uri))?.get(arg.handle);\n\t\t\t\t}\n\n\t\t\t\treturn arg;\n\t\t\t}\n\t\t});\n\t}\n\n\tasync $getTimeline(id: string, uri: UriComponents, options: vscode.TimelineOptions, token: vscode.CancellationToken, internalOptions?: InternalTimelineOptions): Promise<Timeline | undefined> {\n\t\tconst provider = this._providers.get(id);\n\t\treturn provider?.provideTimeline(URI.revive(uri), options, token, internalOptions);\n\t}\n\n\tregisterTimelineProvider(scheme: string | string[], provider: vscode.TimelineProvider, _extensionId: ExtensionIdentifier, commandConverter: CommandsConverter): IDisposable {\n\t\tconst timelineDisposables = new DisposableStore();\n\n\t\tconst convertTimelineItem = this.convertTimelineItem(provider.id, commandConverter, timelineDisposables).bind(this);\n\n\t\tlet disposable: IDisposable | undefined;\n\t\tif (provider.onDidChange) {\n\t\t\tdisposable = provider.onDidChange(e => this._proxy.$emitTimelineChangeEvent({ uri: undefined, reset: true, ...e, id: provider.id }), this);\n\t\t}\n\n\t\tconst itemsBySourceAndUriMap = this._itemsBySourceAndUriMap;\n\t\treturn this.registerTimelineProviderCore({\n\t\t\t...provider,\n\t\t\tscheme: scheme,\n\t\t\tonDidChange: undefined,\n\t\t\tasync provideTimeline(uri: URI, options: TimelineOptions, token: CancellationToken, internalOptions?: InternalTimelineOptions) {\n\t\t\t\tif (internalOptions?.resetCache) {\n\t\t\t\t\ttimelineDisposables.clear();\n\n\t\t\t\t\t// For now, only allow the caching of a single Uri\n\t\t\t\t\t// itemsBySourceAndUriMap.get(provider.id)?.get(getUriKey(uri))?.clear();\n\t\t\t\t\titemsBySourceAndUriMap.get(provider.id)?.clear();\n\t\t\t\t}\n\n\t\t\t\tconst result = await provider.provideTimeline(uri, options, token);\n\t\t\t\tif (result === undefined || result === null) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\t// TODO: Should we bother converting all the data if we aren't caching? Meaning it is being requested by an extension?\n\n\t\t\t\tconst convertItem = convertTimelineItem(uri, internalOptions);\n\t\t\t\treturn {\n\t\t\t\t\t...result,\n\t\t\t\t\tsource: provider.id,\n\t\t\t\t\titems: result.items.map(convertItem)\n\t\t\t\t};\n\t\t\t},\n\t\t\tdispose() {\n\t\t\t\tfor (const sourceMap of itemsBySourceAndUriMap.values()) {\n\t\t\t\t\tsourceMap.get(provider.id)?.clear();\n\t\t\t\t}\n\n\t\t\t\tdisposable?.dispose();\n\t\t\t\ttimelineDisposables.dispose();\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate convertTimelineItem(source: string, commandConverter: CommandsConverter, disposables: DisposableStore) {\n\t\treturn (uri: URI, options?: InternalTimelineOptions) => {\n\t\t\tlet items: Map<string, vscode.TimelineItem> | undefined;\n\t\t\tif (options?.cacheResults) {\n\t\t\t\tlet itemsByUri = this._itemsBySourceAndUriMap.get(source);\n\t\t\t\tif (itemsByUri === undefined) {\n\t\t\t\t\titemsByUri = new Map();\n\t\t\t\t\tthis._itemsBySourceAndUriMap.set(source, itemsByUri);\n\t\t\t\t}\n\n\t\t\t\tconst uriKey = getUriKey(uri);\n\t\t\t\titems = itemsByUri.get(uriKey);\n\t\t\t\tif (items === undefined) {\n\t\t\t\t\titems = new Map();\n\t\t\t\t\titemsByUri.set(uriKey, items);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn (item: vscode.TimelineItem): TimelineItem => {\n\t\t\t\tconst { iconPath, ...props } = item;\n\n\t\t\t\tconst handle = `${source}|${item.id ?? item.timestamp}`;\n\t\t\t\titems?.set(handle, item);\n\n\t\t\t\tlet icon;\n\t\t\t\tlet iconDark;\n\t\t\t\tlet themeIcon;\n\t\t\t\tif (item.iconPath) {\n\t\t\t\t\tif (iconPath instanceof ThemeIcon) {\n\t\t\t\t\t\tthemeIcon = { id: iconPath.id };\n\t\t\t\t\t}\n\t\t\t\t\telse if (URI.isUri(iconPath)) {\n\t\t\t\t\t\ticon = iconPath;\n\t\t\t\t\t\ticonDark = iconPath;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t({ light: icon, dark: iconDark } = iconPath as { light: URI; dark: URI });\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\t...props,\n\t\t\t\t\tid: props.id ?? undefined,\n\t\t\t\t\thandle: handle,\n\t\t\t\t\tsource: source,\n\t\t\t\t\tcommand: item.command ? commandConverter.toInternal(item.command, disposables) : undefined,\n\t\t\t\t\ticon: icon,\n\t\t\t\t\ticonDark: iconDark,\n\t\t\t\t\tthemeIcon: themeIcon,\n\t\t\t\t\taccessibilityInformation: item.accessibilityInformation\n\t\t\t\t};\n\t\t\t};\n\t\t};\n\t}\n\n\tprivate registerTimelineProviderCore(provider: TimelineProvider): IDisposable {\n\t\t// console.log(`ExtHostTimeline#registerTimelineProvider: id=${provider.id}`);\n\n\t\tconst existing = this._providers.get(provider.id);\n\t\tif (existing) {\n\t\t\tthrow new Error(`Timeline Provider ${provider.id} already exists.`);\n\t\t}\n\n\t\tthis._proxy.$registerTimelineProvider({\n\t\t\tid: provider.id,\n\t\t\tlabel: provider.label,\n\t\t\tscheme: provider.scheme\n\t\t});\n\t\tthis._providers.set(provider.id, provider);\n\n\t\treturn toDisposable(() => {\n\t\t\tfor (const sourceMap of this._itemsBySourceAndUriMap.values()) {\n\t\t\t\tsourceMap.get(provider.id)?.clear();\n\t\t\t}\n\n\t\t\tthis._providers.delete(provider.id);\n\t\t\tthis._proxy.$unregisterTimelineProvider(provider.id);\n\t\t\tprovider.dispose();\n\t\t});\n\t}\n}\n\nfunction getUriKey(uri: URI | undefined): string | undefined {\n\treturn uri?.toString();\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { toDisposable } from 'vs/base/common/lifecycle';\nimport { Schemas } from 'vs/base/common/network';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport * as modes from 'vs/editor/common/modes';\nimport { ExtensionIdentifier } from 'vs/platform/extensions/common/extensions';\nimport type * as vscode from 'vscode';\nimport { ExtHostUriOpenersShape, IMainContext, MainContext, MainThreadUriOpenersShape } from './extHost.protocol';\n\n\nexport class ExtHostUriOpeners implements ExtHostUriOpenersShape {\n\n\tprivate static readonly supportedSchemes = new Set<string>([Schemas.http, Schemas.https]);\n\n\tprivate readonly _proxy: MainThreadUriOpenersShape;\n\n\tprivate readonly _openers = new Map<string, vscode.ExternalUriOpener>();\n\n\tconstructor(\n\t\tmainContext: IMainContext,\n\t) {\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadUriOpeners);\n\t}\n\n\tregisterExternalUriOpener(\n\t\textensionId: ExtensionIdentifier,\n\t\tid: string,\n\t\topener: vscode.ExternalUriOpener,\n\t\tmetadata: vscode.ExternalUriOpenerMetadata,\n\t): vscode.Disposable {\n\t\tif (this._openers.has(id)) {\n\t\t\tthrow new Error(`Opener with id '${id}' already registered`);\n\t\t}\n\n\t\tconst invalidScheme = metadata.schemes.find(scheme => !ExtHostUriOpeners.supportedSchemes.has(scheme));\n\t\tif (invalidScheme) {\n\t\t\tthrow new Error(`Scheme '${invalidScheme}' is not supported. Only http and https are currently supported.`);\n\t\t}\n\n\t\tthis._openers.set(id, opener);\n\t\tthis._proxy.$registerUriOpener(id, metadata.schemes, extensionId, metadata.label);\n\n\t\treturn toDisposable(() => {\n\t\t\tthis._openers.delete(id);\n\t\t\tthis._proxy.$unregisterUriOpener(id);\n\t\t});\n\t}\n\n\tasync $canOpenUri(id: string, uriComponents: UriComponents, token: CancellationToken): Promise<modes.ExternalUriOpenerPriority> {\n\t\tconst opener = this._openers.get(id);\n\t\tif (!opener) {\n\t\t\tthrow new Error(`Unknown opener with id: ${id}`);\n\t\t}\n\n\t\tconst uri = URI.revive(uriComponents);\n\t\treturn opener.canOpenExternalUri(uri, token);\n\t}\n\n\tasync $openUri(id: string, context: { resolvedUri: UriComponents, sourceUri: UriComponents }, token: CancellationToken): Promise<void> {\n\t\tconst opener = this._openers.get(id);\n\t\tif (!opener) {\n\t\t\tthrow new Error(`Unknown opener id: '${id}'`);\n\t\t}\n\n\t\treturn opener.openExternalUri(URI.revive(context.resolvedUri), {\n\t\t\tsourceUri: URI.revive(context.sourceUri)\n\t\t}, token);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type * as vscode from 'vscode';\nimport { MainContext, IMainContext, ExtHostUrlsShape, MainThreadUrlsShape } from './extHost.protocol';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { toDisposable } from 'vs/base/common/lifecycle';\nimport { onUnexpectedError } from 'vs/base/common/errors';\nimport { ExtensionIdentifier } from 'vs/platform/extensions/common/extensions';\n\nexport class ExtHostUrls implements ExtHostUrlsShape {\n\n\tprivate static HandlePool = 0;\n\tprivate readonly _proxy: MainThreadUrlsShape;\n\n\tprivate handles = new Set<string>();\n\tprivate handlers = new Map<number, vscode.UriHandler>();\n\n\tconstructor(\n\t\tmainContext: IMainContext\n\t) {\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadUrls);\n\t}\n\n\tregisterUriHandler(extensionId: ExtensionIdentifier, handler: vscode.UriHandler): vscode.Disposable {\n\t\tif (this.handles.has(ExtensionIdentifier.toKey(extensionId))) {\n\t\t\tthrow new Error(`Protocol handler already registered for extension ${extensionId}`);\n\t\t}\n\n\t\tconst handle = ExtHostUrls.HandlePool++;\n\t\tthis.handles.add(ExtensionIdentifier.toKey(extensionId));\n\t\tthis.handlers.set(handle, handler);\n\t\tthis._proxy.$registerUriHandler(handle, extensionId);\n\n\t\treturn toDisposable(() => {\n\t\t\tthis.handles.delete(ExtensionIdentifier.toKey(extensionId));\n\t\t\tthis.handlers.delete(handle);\n\t\t\tthis._proxy.$unregisterUriHandler(handle);\n\t\t});\n\t}\n\n\t$handleExternalUri(handle: number, uri: UriComponents): Promise<void> {\n\t\tconst handler = this.handlers.get(handle);\n\n\t\tif (!handler) {\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\t\ttry {\n\t\t\thandler.handleUri(URI.revive(uri));\n\t\t} catch (err) {\n\t\t\tonUnexpectedError(err);\n\t\t}\n\n\t\treturn Promise.resolve(undefined);\n\t}\n\n\tasync createAppUri(uri: URI): Promise<vscode.Uri> {\n\t\treturn URI.revive(await this._proxy.$createAppUri(uri));\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { URI } from 'vs/base/common/uri';\nimport * as modes from 'vs/editor/common/modes';\nimport { IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { IExtHostApiDeprecationService } from 'vs/workbench/api/common/extHostApiDeprecationService';\nimport { IExtHostWorkspace } from 'vs/workbench/api/common/extHostWorkspace';\nimport { asWebviewUri, WebviewInitData } from 'vs/workbench/api/common/shared/webview';\nimport type * as vscode from 'vscode';\nimport * as extHostProtocol from './extHost.protocol';\n\nexport class ExtHostWebview implements vscode.Webview {\n\n\treadonly #handle: extHostProtocol.WebviewHandle;\n\treadonly #proxy: extHostProtocol.MainThreadWebviewsShape;\n\treadonly #deprecationService: IExtHostApiDeprecationService;\n\n\treadonly #initData: WebviewInitData;\n\treadonly #workspace: IExtHostWorkspace | undefined;\n\treadonly #extension: IExtensionDescription;\n\n\t#html: string = '';\n\t#options: vscode.WebviewOptions;\n\t#isDisposed: boolean = false;\n\t#hasCalledAsWebviewUri = false;\n\n\tconstructor(\n\t\thandle: extHostProtocol.WebviewHandle,\n\t\tproxy: extHostProtocol.MainThreadWebviewsShape,\n\t\toptions: vscode.WebviewOptions,\n\t\tinitData: WebviewInitData,\n\t\tworkspace: IExtHostWorkspace | undefined,\n\t\textension: IExtensionDescription,\n\t\tdeprecationService: IExtHostApiDeprecationService,\n\t) {\n\t\tthis.#handle = handle;\n\t\tthis.#proxy = proxy;\n\t\tthis.#options = options;\n\t\tthis.#initData = initData;\n\t\tthis.#workspace = workspace;\n\t\tthis.#extension = extension;\n\t\tthis.#deprecationService = deprecationService;\n\t}\n\n\t/* internal */ readonly _onMessageEmitter = new Emitter<any>();\n\tpublic readonly onDidReceiveMessage: Event<any> = this._onMessageEmitter.event;\n\n\treadonly #onDidDisposeEmitter = new Emitter<void>();\n\t/* internal */ readonly _onDidDispose: Event<void> = this.#onDidDisposeEmitter.event;\n\n\tpublic dispose() {\n\t\tthis.#isDisposed = true;\n\n\t\tthis.#onDidDisposeEmitter.fire();\n\n\t\tthis.#onDidDisposeEmitter.dispose();\n\t\tthis._onMessageEmitter.dispose();\n\t}\n\n\tpublic asWebviewUri(resource: vscode.Uri): vscode.Uri {\n\t\tthis.#hasCalledAsWebviewUri = true;\n\t\treturn asWebviewUri(this.#initData, this.#handle, resource);\n\t}\n\n\tpublic get cspSource(): string {\n\t\treturn this.#initData.webviewCspSource\n\t\t\t.replace('{{uuid}}', this.#handle);\n\t}\n\n\tpublic get html(): string {\n\t\tthis.assertNotDisposed();\n\t\treturn this.#html;\n\t}\n\n\tpublic set html(value: string) {\n\t\tthis.assertNotDisposed();\n\t\tif (this.#html !== value) {\n\t\t\tthis.#html = value;\n\t\t\tif (!this.#hasCalledAsWebviewUri && /([\"'])vscode-resource:([^\\s'\"]+?)([\"'])/i.test(value)) {\n\t\t\t\tthis.#hasCalledAsWebviewUri = true;\n\t\t\t\tthis.#deprecationService.report('Webview vscode-resource: uris', this.#extension,\n\t\t\t\t\t`Please migrate to use the 'webview.asWebviewUri' api instead: https://aka.ms/vscode-webview-use-aswebviewuri`);\n\t\t\t}\n\t\t\tthis.#proxy.$setHtml(this.#handle, value);\n\t\t}\n\t}\n\n\tpublic get options(): vscode.WebviewOptions {\n\t\tthis.assertNotDisposed();\n\t\treturn this.#options;\n\t}\n\n\tpublic set options(newOptions: vscode.WebviewOptions) {\n\t\tthis.assertNotDisposed();\n\t\tthis.#proxy.$setOptions(this.#handle, convertWebviewOptions(this.#extension, this.#workspace, newOptions));\n\t\tthis.#options = newOptions;\n\t}\n\n\tpublic async postMessage(message: any): Promise<boolean> {\n\t\tif (this.#isDisposed) {\n\t\t\treturn false;\n\t\t}\n\t\treturn this.#proxy.$postMessage(this.#handle, message);\n\t}\n\n\tprivate assertNotDisposed() {\n\t\tif (this.#isDisposed) {\n\t\t\tthrow new Error('Webview is disposed');\n\t\t}\n\t}\n}\n\nexport class ExtHostWebviews implements extHostProtocol.ExtHostWebviewsShape {\n\n\tprivate readonly _webviewProxy: extHostProtocol.MainThreadWebviewsShape;\n\n\tprivate readonly _webviews = new Map<extHostProtocol.WebviewHandle, ExtHostWebview>();\n\n\tconstructor(\n\t\tmainContext: extHostProtocol.IMainContext,\n\t\tprivate readonly initData: WebviewInitData,\n\t\tprivate readonly workspace: IExtHostWorkspace | undefined,\n\t\tprivate readonly _logService: ILogService,\n\t\tprivate readonly _deprecationService: IExtHostApiDeprecationService,\n\t) {\n\t\tthis._webviewProxy = mainContext.getProxy(extHostProtocol.MainContext.MainThreadWebviews);\n\t}\n\n\tpublic $onMessage(\n\t\thandle: extHostProtocol.WebviewHandle,\n\t\tmessage: any\n\t): void {\n\t\tconst webview = this.getWebview(handle);\n\t\tif (webview) {\n\t\t\twebview._onMessageEmitter.fire(message);\n\t\t}\n\t}\n\n\tpublic $onMissingCsp(\n\t\t_handle: extHostProtocol.WebviewHandle,\n\t\textensionId: string\n\t): void {\n\t\tthis._logService.warn(`${extensionId} created a webview without a content security policy: https://aka.ms/vscode-webview-missing-csp`);\n\t}\n\n\tpublic createNewWebview(handle: string, options: modes.IWebviewOptions & modes.IWebviewPanelOptions, extension: IExtensionDescription): ExtHostWebview {\n\t\tconst webview = new ExtHostWebview(handle, this._webviewProxy, reviveOptions(options), this.initData, this.workspace, extension, this._deprecationService);\n\t\tthis._webviews.set(handle, webview);\n\n\t\twebview._onDidDispose(() => { this._webviews.delete(handle); });\n\n\t\treturn webview;\n\t}\n\n\tpublic deleteWebview(handle: string) {\n\t\tthis._webviews.delete(handle);\n\t}\n\n\tprivate getWebview(handle: extHostProtocol.WebviewHandle): ExtHostWebview | undefined {\n\t\treturn this._webviews.get(handle);\n\t}\n}\n\nexport function toExtensionData(extension: IExtensionDescription): extHostProtocol.WebviewExtensionDescription {\n\treturn { id: extension.identifier, location: extension.extensionLocation };\n}\n\nexport function convertWebviewOptions(\n\textension: IExtensionDescription,\n\tworkspace: IExtHostWorkspace | undefined,\n\toptions: vscode.WebviewPanelOptions & vscode.WebviewOptions,\n): modes.IWebviewOptions {\n\treturn {\n\t\t...options,\n\t\tlocalResourceRoots: options.localResourceRoots || getDefaultLocalResourceRoots(extension, workspace)\n\t};\n}\n\nfunction reviveOptions(\n\toptions: modes.IWebviewOptions & modes.IWebviewPanelOptions\n): vscode.WebviewOptions {\n\treturn {\n\t\t...options,\n\t\tlocalResourceRoots: options.localResourceRoots?.map(components => URI.from(components)),\n\t};\n}\n\nfunction getDefaultLocalResourceRoots(\n\textension: IExtensionDescription,\n\tworkspace: IExtHostWorkspace | undefined,\n): URI[] {\n\treturn [\n\t\t...(workspace?.getWorkspaceFolders() || []).map(x => x.uri),\n\t\textension.extensionLocation,\n\t];\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { hash } from 'vs/base/common/hash';\nimport { DisposableStore } from 'vs/base/common/lifecycle';\nimport { Schemas } from 'vs/base/common/network';\nimport { joinPath } from 'vs/base/common/resources';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport * as modes from 'vs/editor/common/modes';\nimport { IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { ExtHostDocuments } from 'vs/workbench/api/common/extHostDocuments';\nimport { IExtensionStoragePaths } from 'vs/workbench/api/common/extHostStoragePaths';\nimport * as typeConverters from 'vs/workbench/api/common/extHostTypeConverters';\nimport { ExtHostWebviews, toExtensionData } from 'vs/workbench/api/common/extHostWebview';\nimport { ExtHostWebviewPanels } from 'vs/workbench/api/common/extHostWebviewPanels';\nimport { EditorGroupColumn } from 'vs/workbench/common/editor';\nimport type * as vscode from 'vscode';\nimport { Cache } from './cache';\nimport * as extHostProtocol from './extHost.protocol';\nimport * as extHostTypes from './extHostTypes';\n\n\nclass CustomDocumentStoreEntry {\n\n\tprivate _backupCounter = 1;\n\n\tconstructor(\n\t\tpublic readonly document: vscode.CustomDocument,\n\t\tprivate readonly _storagePath: URI | undefined,\n\t) { }\n\n\tprivate readonly _edits = new Cache<vscode.CustomDocumentEditEvent>('custom documents');\n\n\tprivate _backup?: vscode.CustomDocumentBackup;\n\n\taddEdit(item: vscode.CustomDocumentEditEvent): number {\n\t\treturn this._edits.add([item]);\n\t}\n\n\tasync undo(editId: number, isDirty: boolean): Promise<void> {\n\t\tawait this.getEdit(editId).undo();\n\t\tif (!isDirty) {\n\t\t\tthis.disposeBackup();\n\t\t}\n\t}\n\n\tasync redo(editId: number, isDirty: boolean): Promise<void> {\n\t\tawait this.getEdit(editId).redo();\n\t\tif (!isDirty) {\n\t\t\tthis.disposeBackup();\n\t\t}\n\t}\n\n\tdisposeEdits(editIds: number[]): void {\n\t\tfor (const id of editIds) {\n\t\t\tthis._edits.delete(id);\n\t\t}\n\t}\n\n\tgetNewBackupUri(): URI {\n\t\tif (!this._storagePath) {\n\t\t\tthrow new Error('Backup requires a valid storage path');\n\t\t}\n\t\tconst fileName = hashPath(this.document.uri) + (this._backupCounter++);\n\t\treturn joinPath(this._storagePath, fileName);\n\t}\n\n\tupdateBackup(backup: vscode.CustomDocumentBackup): void {\n\t\tthis._backup?.delete();\n\t\tthis._backup = backup;\n\t}\n\n\tdisposeBackup(): void {\n\t\tthis._backup?.delete();\n\t\tthis._backup = undefined;\n\t}\n\n\tprivate getEdit(editId: number): vscode.CustomDocumentEditEvent {\n\t\tconst edit = this._edits.get(editId, 0);\n\t\tif (!edit) {\n\t\t\tthrow new Error('No edit found');\n\t\t}\n\t\treturn edit;\n\t}\n}\n\nclass CustomDocumentStore {\n\tprivate readonly _documents = new Map<string, CustomDocumentStoreEntry>();\n\n\tpublic get(viewType: string, resource: vscode.Uri): CustomDocumentStoreEntry | undefined {\n\t\treturn this._documents.get(this.key(viewType, resource));\n\t}\n\n\tpublic add(viewType: string, document: vscode.CustomDocument, storagePath: URI | undefined): CustomDocumentStoreEntry {\n\t\tconst key = this.key(viewType, document.uri);\n\t\tif (this._documents.has(key)) {\n\t\t\tthrow new Error(`Document already exists for viewType:${viewType} resource:${document.uri}`);\n\t\t}\n\t\tconst entry = new CustomDocumentStoreEntry(document, storagePath);\n\t\tthis._documents.set(key, entry);\n\t\treturn entry;\n\t}\n\n\tpublic delete(viewType: string, document: vscode.CustomDocument) {\n\t\tconst key = this.key(viewType, document.uri);\n\t\tthis._documents.delete(key);\n\t}\n\n\tprivate key(viewType: string, resource: vscode.Uri): string {\n\t\treturn `${viewType}@@@${resource}`;\n\t}\n\n}\n\nconst enum WebviewEditorType {\n\tText,\n\tCustom\n}\n\ntype ProviderEntry = {\n\treadonly extension: IExtensionDescription;\n\treadonly type: WebviewEditorType.Text;\n\treadonly provider: vscode.CustomTextEditorProvider;\n} | {\n\treadonly extension: IExtensionDescription;\n\treadonly type: WebviewEditorType.Custom;\n\treadonly provider: vscode.CustomReadonlyEditorProvider;\n};\n\nclass EditorProviderStore {\n\tprivate readonly _providers = new Map<string, ProviderEntry>();\n\n\tpublic addTextProvider(viewType: string, extension: IExtensionDescription, provider: vscode.CustomTextEditorProvider): vscode.Disposable {\n\t\treturn this.add(WebviewEditorType.Text, viewType, extension, provider);\n\t}\n\n\tpublic addCustomProvider(viewType: string, extension: IExtensionDescription, provider: vscode.CustomReadonlyEditorProvider): vscode.Disposable {\n\t\treturn this.add(WebviewEditorType.Custom, viewType, extension, provider);\n\t}\n\n\tpublic get(viewType: string): ProviderEntry | undefined {\n\t\treturn this._providers.get(viewType);\n\t}\n\n\tprivate add(type: WebviewEditorType, viewType: string, extension: IExtensionDescription, provider: vscode.CustomTextEditorProvider | vscode.CustomReadonlyEditorProvider): vscode.Disposable {\n\t\tif (this._providers.has(viewType)) {\n\t\t\tthrow new Error(`Provider for viewType:${viewType} already registered`);\n\t\t}\n\t\tthis._providers.set(viewType, { type, extension, provider } as ProviderEntry);\n\t\treturn new extHostTypes.Disposable(() => this._providers.delete(viewType));\n\t}\n}\n\nexport class ExtHostCustomEditors implements extHostProtocol.ExtHostCustomEditorsShape {\n\n\tprivate readonly _proxy: extHostProtocol.MainThreadCustomEditorsShape;\n\n\tprivate readonly _editorProviders = new EditorProviderStore();\n\n\tprivate readonly _documents = new CustomDocumentStore();\n\n\tconstructor(\n\t\tmainContext: extHostProtocol.IMainContext,\n\t\tprivate readonly _extHostDocuments: ExtHostDocuments,\n\t\tprivate readonly _extensionStoragePaths: IExtensionStoragePaths | undefined,\n\t\tprivate readonly _extHostWebview: ExtHostWebviews,\n\t\tprivate readonly _extHostWebviewPanels: ExtHostWebviewPanels,\n\t) {\n\t\tthis._proxy = mainContext.getProxy(extHostProtocol.MainContext.MainThreadCustomEditors);\n\t}\n\n\tpublic registerCustomEditorProvider(\n\t\textension: IExtensionDescription,\n\t\tviewType: string,\n\t\tprovider: vscode.CustomReadonlyEditorProvider | vscode.CustomTextEditorProvider,\n\t\toptions: { webviewOptions?: vscode.WebviewPanelOptions, supportsMultipleEditorsPerDocument?: boolean },\n\t): vscode.Disposable {\n\t\tconst disposables = new DisposableStore();\n\t\tif (isCustomTextEditorProvider(provider)) {\n\t\t\tdisposables.add(this._editorProviders.addTextProvider(viewType, extension, provider));\n\t\t\tthis._proxy.$registerTextEditorProvider(toExtensionData(extension), viewType, options.webviewOptions || {}, {\n\t\t\t\tsupportsMove: !!provider.moveCustomTextEditor,\n\t\t\t});\n\t\t} else {\n\t\t\tdisposables.add(this._editorProviders.addCustomProvider(viewType, extension, provider));\n\n\t\t\tif (this.supportEditing(provider)) {\n\t\t\t\tdisposables.add(provider.onDidChangeCustomDocument(e => {\n\t\t\t\t\tconst entry = this.getCustomDocumentEntry(viewType, e.document.uri);\n\t\t\t\t\tif (isEditEvent(e)) {\n\t\t\t\t\t\tconst editId = entry.addEdit(e);\n\t\t\t\t\t\tthis._proxy.$onDidEdit(e.document.uri, viewType, editId, e.label);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._proxy.$onContentChange(e.document.uri, viewType);\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t}\n\n\t\t\tthis._proxy.$registerCustomEditorProvider(toExtensionData(extension), viewType, options.webviewOptions || {}, !!options.supportsMultipleEditorsPerDocument);\n\t\t}\n\n\t\treturn extHostTypes.Disposable.from(\n\t\t\tdisposables,\n\t\t\tnew extHostTypes.Disposable(() => {\n\t\t\t\tthis._proxy.$unregisterEditorProvider(viewType);\n\t\t\t}));\n\t}\n\n\tasync $createCustomDocument(resource: UriComponents, viewType: string, backupId: string | undefined, cancellation: CancellationToken) {\n\t\tconst entry = this._editorProviders.get(viewType);\n\t\tif (!entry) {\n\t\t\tthrow new Error(`No provider found for '${viewType}'`);\n\t\t}\n\n\t\tif (entry.type !== WebviewEditorType.Custom) {\n\t\t\tthrow new Error(`Invalid provide type for '${viewType}'`);\n\t\t}\n\n\t\tconst revivedResource = URI.revive(resource);\n\t\tconst document = await entry.provider.openCustomDocument(revivedResource, { backupId }, cancellation);\n\n\t\tlet storageRoot: URI | undefined;\n\t\tif (this.supportEditing(entry.provider) && this._extensionStoragePaths) {\n\t\t\tstorageRoot = this._extensionStoragePaths.workspaceValue(entry.extension) ?? this._extensionStoragePaths.globalValue(entry.extension);\n\t\t}\n\t\tthis._documents.add(viewType, document, storageRoot);\n\n\t\treturn { editable: this.supportEditing(entry.provider) };\n\t}\n\n\tasync $disposeCustomDocument(resource: UriComponents, viewType: string): Promise<void> {\n\t\tconst entry = this._editorProviders.get(viewType);\n\t\tif (!entry) {\n\t\t\tthrow new Error(`No provider found for '${viewType}'`);\n\t\t}\n\n\t\tif (entry.type !== WebviewEditorType.Custom) {\n\t\t\tthrow new Error(`Invalid provider type for '${viewType}'`);\n\t\t}\n\n\t\tconst revivedResource = URI.revive(resource);\n\t\tconst { document } = this.getCustomDocumentEntry(viewType, revivedResource);\n\t\tthis._documents.delete(viewType, document);\n\t\tdocument.dispose();\n\t}\n\n\tasync $resolveWebviewEditor(\n\t\tresource: UriComponents,\n\t\thandle: extHostProtocol.WebviewHandle,\n\t\tviewType: string,\n\t\ttitle: string,\n\t\tposition: EditorGroupColumn,\n\t\toptions: modes.IWebviewOptions & modes.IWebviewPanelOptions,\n\t\tcancellation: CancellationToken,\n\t): Promise<void> {\n\t\tconst entry = this._editorProviders.get(viewType);\n\t\tif (!entry) {\n\t\t\tthrow new Error(`No provider found for '${viewType}'`);\n\t\t}\n\n\t\tconst viewColumn = typeConverters.ViewColumn.to(position);\n\n\t\tconst webview = this._extHostWebview.createNewWebview(handle, options, entry.extension);\n\t\tconst panel = this._extHostWebviewPanels.createNewWebviewPanel(handle, viewType, title, viewColumn, options, webview);\n\n\t\tconst revivedResource = URI.revive(resource);\n\n\t\tswitch (entry.type) {\n\t\t\tcase WebviewEditorType.Custom:\n\t\t\t\t{\n\t\t\t\t\tconst { document } = this.getCustomDocumentEntry(viewType, revivedResource);\n\t\t\t\t\treturn entry.provider.resolveCustomEditor(document, panel, cancellation);\n\t\t\t\t}\n\t\t\tcase WebviewEditorType.Text:\n\t\t\t\t{\n\t\t\t\t\tconst document = this._extHostDocuments.getDocument(revivedResource);\n\t\t\t\t\treturn entry.provider.resolveCustomTextEditor(document, panel, cancellation);\n\t\t\t\t}\n\t\t\tdefault:\n\t\t\t\t{\n\t\t\t\t\tthrow new Error('Unknown webview provider type');\n\t\t\t\t}\n\t\t}\n\t}\n\n\t$disposeEdits(resourceComponents: UriComponents, viewType: string, editIds: number[]): void {\n\t\tconst document = this.getCustomDocumentEntry(viewType, resourceComponents);\n\t\tdocument.disposeEdits(editIds);\n\t}\n\n\tasync $onMoveCustomEditor(handle: string, newResourceComponents: UriComponents, viewType: string): Promise<void> {\n\t\tconst entry = this._editorProviders.get(viewType);\n\t\tif (!entry) {\n\t\t\tthrow new Error(`No provider found for '${viewType}'`);\n\t\t}\n\n\t\tif (!(entry.provider as vscode.CustomTextEditorProvider).moveCustomTextEditor) {\n\t\t\tthrow new Error(`Provider does not implement move '${viewType}'`);\n\t\t}\n\n\t\tconst webview = this._extHostWebviewPanels.getWebviewPanel(handle);\n\t\tif (!webview) {\n\t\t\tthrow new Error(`No webview found`);\n\t\t}\n\n\t\tconst resource = URI.revive(newResourceComponents);\n\t\tconst document = this._extHostDocuments.getDocument(resource);\n\t\tawait (entry.provider as vscode.CustomTextEditorProvider).moveCustomTextEditor!(document, webview, CancellationToken.None);\n\t}\n\n\tasync $undo(resourceComponents: UriComponents, viewType: string, editId: number, isDirty: boolean): Promise<void> {\n\t\tconst entry = this.getCustomDocumentEntry(viewType, resourceComponents);\n\t\treturn entry.undo(editId, isDirty);\n\t}\n\n\tasync $redo(resourceComponents: UriComponents, viewType: string, editId: number, isDirty: boolean): Promise<void> {\n\t\tconst entry = this.getCustomDocumentEntry(viewType, resourceComponents);\n\t\treturn entry.redo(editId, isDirty);\n\t}\n\n\tasync $revert(resourceComponents: UriComponents, viewType: string, cancellation: CancellationToken): Promise<void> {\n\t\tconst entry = this.getCustomDocumentEntry(viewType, resourceComponents);\n\t\tconst provider = this.getCustomEditorProvider(viewType);\n\t\tawait provider.revertCustomDocument(entry.document, cancellation);\n\t\tentry.disposeBackup();\n\t}\n\n\tasync $onSave(resourceComponents: UriComponents, viewType: string, cancellation: CancellationToken): Promise<void> {\n\t\tconst entry = this.getCustomDocumentEntry(viewType, resourceComponents);\n\t\tconst provider = this.getCustomEditorProvider(viewType);\n\t\tawait provider.saveCustomDocument(entry.document, cancellation);\n\t\tentry.disposeBackup();\n\t}\n\n\tasync $onSaveAs(resourceComponents: UriComponents, viewType: string, targetResource: UriComponents, cancellation: CancellationToken): Promise<void> {\n\t\tconst entry = this.getCustomDocumentEntry(viewType, resourceComponents);\n\t\tconst provider = this.getCustomEditorProvider(viewType);\n\t\treturn provider.saveCustomDocumentAs(entry.document, URI.revive(targetResource), cancellation);\n\t}\n\n\tasync $backup(resourceComponents: UriComponents, viewType: string, cancellation: CancellationToken): Promise<string> {\n\t\tconst entry = this.getCustomDocumentEntry(viewType, resourceComponents);\n\t\tconst provider = this.getCustomEditorProvider(viewType);\n\n\t\tconst backup = await provider.backupCustomDocument(entry.document, {\n\t\t\tdestination: entry.getNewBackupUri(),\n\t\t}, cancellation);\n\t\tentry.updateBackup(backup);\n\t\treturn backup.id;\n\t}\n\n\tprivate getCustomDocumentEntry(viewType: string, resource: UriComponents): CustomDocumentStoreEntry {\n\t\tconst entry = this._documents.get(viewType, URI.revive(resource));\n\t\tif (!entry) {\n\t\t\tthrow new Error('No custom document found');\n\t\t}\n\t\treturn entry;\n\t}\n\n\tprivate getCustomEditorProvider(viewType: string): vscode.CustomEditorProvider {\n\t\tconst entry = this._editorProviders.get(viewType);\n\t\tconst provider = entry?.provider;\n\t\tif (!provider || !this.supportEditing(provider)) {\n\t\t\tthrow new Error('Custom document is not editable');\n\t\t}\n\t\treturn provider;\n\t}\n\n\tprivate supportEditing(\n\t\tprovider: vscode.CustomTextEditorProvider | vscode.CustomEditorProvider | vscode.CustomReadonlyEditorProvider\n\t): provider is vscode.CustomEditorProvider {\n\t\treturn !!(provider as vscode.CustomEditorProvider).onDidChangeCustomDocument;\n\t}\n}\n\nfunction isCustomTextEditorProvider(provider: vscode.CustomReadonlyEditorProvider<vscode.CustomDocument> | vscode.CustomTextEditorProvider): provider is vscode.CustomTextEditorProvider {\n\treturn typeof (provider as vscode.CustomTextEditorProvider).resolveCustomTextEditor === 'function';\n}\n\nfunction isEditEvent(e: vscode.CustomDocumentContentChangeEvent | vscode.CustomDocumentEditEvent): e is vscode.CustomDocumentEditEvent {\n\treturn typeof (e as vscode.CustomDocumentEditEvent).undo === 'function'\n\t\t&& typeof (e as vscode.CustomDocumentEditEvent).redo === 'function';\n}\n\nfunction hashPath(resource: URI): string {\n\tconst str = resource.scheme === Schemas.file || resource.scheme === Schemas.untitled ? resource.fsPath : resource.toString();\n\treturn hash(str) + '';\n}\n\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter } from 'vs/base/common/event';\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport { URI } from 'vs/base/common/uri';\nimport { generateUuid } from 'vs/base/common/uuid';\nimport * as modes from 'vs/editor/common/modes';\nimport { IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport * as typeConverters from 'vs/workbench/api/common/extHostTypeConverters';\nimport { convertWebviewOptions, ExtHostWebview, ExtHostWebviews, toExtensionData } from 'vs/workbench/api/common/extHostWebview';\nimport { IExtHostWorkspace } from 'vs/workbench/api/common/extHostWorkspace';\nimport { EditorGroupColumn } from 'vs/workbench/common/editor';\nimport type * as vscode from 'vscode';\nimport * as extHostProtocol from './extHost.protocol';\nimport * as extHostTypes from './extHostTypes';\n\n\ntype IconPath = URI | { light: URI, dark: URI };\n\nclass ExtHostWebviewPanel extends Disposable implements vscode.WebviewPanel {\n\n\treadonly #handle: extHostProtocol.WebviewHandle;\n\treadonly #proxy: extHostProtocol.MainThreadWebviewPanelsShape;\n\treadonly #viewType: string;\n\n\treadonly #webview: ExtHostWebview;\n\treadonly #options: vscode.WebviewPanelOptions;\n\n\t#title: string;\n\t#iconPath?: IconPath;\n\t#viewColumn: vscode.ViewColumn | undefined = undefined;\n\t#visible: boolean = true;\n\t#active: boolean = true;\n\t#isDisposed: boolean = false;\n\n\treadonly #onDidDispose = this._register(new Emitter<void>());\n\tpublic readonly onDidDispose = this.#onDidDispose.event;\n\n\treadonly #onDidChangeViewState = this._register(new Emitter<vscode.WebviewPanelOnDidChangeViewStateEvent>());\n\tpublic readonly onDidChangeViewState = this.#onDidChangeViewState.event;\n\n\tconstructor(\n\t\thandle: extHostProtocol.WebviewHandle,\n\t\tproxy: extHostProtocol.MainThreadWebviewPanelsShape,\n\t\tviewType: string,\n\t\ttitle: string,\n\t\tviewColumn: vscode.ViewColumn | undefined,\n\t\teditorOptions: vscode.WebviewPanelOptions,\n\t\twebview: ExtHostWebview\n\t) {\n\t\tsuper();\n\t\tthis.#handle = handle;\n\t\tthis.#proxy = proxy;\n\t\tthis.#viewType = viewType;\n\t\tthis.#options = editorOptions;\n\t\tthis.#viewColumn = viewColumn;\n\t\tthis.#title = title;\n\t\tthis.#webview = webview;\n\t}\n\n\tpublic dispose() {\n\t\tif (this.#isDisposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#isDisposed = true;\n\t\tthis.#onDidDispose.fire();\n\n\t\tthis.#proxy.$disposeWebview(this.#handle);\n\t\tthis.#webview.dispose();\n\n\t\tsuper.dispose();\n\t}\n\n\tget webview() {\n\t\tthis.assertNotDisposed();\n\t\treturn this.#webview;\n\t}\n\n\tget viewType(): string {\n\t\tthis.assertNotDisposed();\n\t\treturn this.#viewType;\n\t}\n\n\tget title(): string {\n\t\tthis.assertNotDisposed();\n\t\treturn this.#title;\n\t}\n\n\tset title(value: string) {\n\t\tthis.assertNotDisposed();\n\t\tif (this.#title !== value) {\n\t\t\tthis.#title = value;\n\t\t\tthis.#proxy.$setTitle(this.#handle, value);\n\t\t}\n\t}\n\n\tget iconPath(): IconPath | undefined {\n\t\tthis.assertNotDisposed();\n\t\treturn this.#iconPath;\n\t}\n\n\tset iconPath(value: IconPath | undefined) {\n\t\tthis.assertNotDisposed();\n\t\tif (this.#iconPath !== value) {\n\t\t\tthis.#iconPath = value;\n\n\t\t\tthis.#proxy.$setIconPath(this.#handle, URI.isUri(value) ? { light: value, dark: value } : value);\n\t\t}\n\t}\n\n\tget options() {\n\t\treturn this.#options;\n\t}\n\n\tget viewColumn(): vscode.ViewColumn | undefined {\n\t\tthis.assertNotDisposed();\n\t\tif (typeof this.#viewColumn === 'number' && this.#viewColumn < 0) {\n\t\t\t// We are using a symbolic view column\n\t\t\t// Return undefined instead to indicate that the real view column is currently unknown but will be resolved.\n\t\t\treturn undefined;\n\t\t}\n\t\treturn this.#viewColumn;\n\t}\n\n\tpublic get active(): boolean {\n\t\tthis.assertNotDisposed();\n\t\treturn this.#active;\n\t}\n\n\tpublic get visible(): boolean {\n\t\tthis.assertNotDisposed();\n\t\treturn this.#visible;\n\t}\n\n\t_updateViewState(newState: { active: boolean; visible: boolean; viewColumn: vscode.ViewColumn; }) {\n\t\tif (this.#isDisposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.active !== newState.active || this.visible !== newState.visible || this.viewColumn !== newState.viewColumn) {\n\t\t\tthis.#active = newState.active;\n\t\t\tthis.#visible = newState.visible;\n\t\t\tthis.#viewColumn = newState.viewColumn;\n\t\t\tthis.#onDidChangeViewState.fire({ webviewPanel: this });\n\t\t}\n\t}\n\n\tpublic reveal(viewColumn?: vscode.ViewColumn, preserveFocus?: boolean): void {\n\t\tthis.assertNotDisposed();\n\t\tthis.#proxy.$reveal(this.#handle, {\n\t\t\tviewColumn: viewColumn ? typeConverters.ViewColumn.from(viewColumn) : undefined,\n\t\t\tpreserveFocus: !!preserveFocus\n\t\t});\n\t}\n\n\tprivate assertNotDisposed() {\n\t\tif (this.#isDisposed) {\n\t\t\tthrow new Error('Webview is disposed');\n\t\t}\n\t}\n}\n\nexport class ExtHostWebviewPanels implements extHostProtocol.ExtHostWebviewPanelsShape {\n\n\tprivate static newHandle(): extHostProtocol.WebviewHandle {\n\t\treturn generateUuid();\n\t}\n\n\tprivate readonly _proxy: extHostProtocol.MainThreadWebviewPanelsShape;\n\n\tprivate readonly _webviewPanels = new Map<extHostProtocol.WebviewHandle, ExtHostWebviewPanel>();\n\n\tprivate readonly _serializers = new Map<string, {\n\t\treadonly serializer: vscode.WebviewPanelSerializer;\n\t\treadonly extension: IExtensionDescription;\n\t}>();\n\n\tconstructor(\n\t\tmainContext: extHostProtocol.IMainContext,\n\t\tprivate readonly webviews: ExtHostWebviews,\n\t\tprivate readonly workspace: IExtHostWorkspace | undefined,\n\t) {\n\t\tthis._proxy = mainContext.getProxy(extHostProtocol.MainContext.MainThreadWebviewPanels);\n\t}\n\n\tpublic createWebviewPanel(\n\t\textension: IExtensionDescription,\n\t\tviewType: string,\n\t\ttitle: string,\n\t\tshowOptions: vscode.ViewColumn | { viewColumn: vscode.ViewColumn, preserveFocus?: boolean },\n\t\toptions: (vscode.WebviewPanelOptions & vscode.WebviewOptions) = {},\n\t): vscode.WebviewPanel {\n\t\tconst viewColumn = typeof showOptions === 'object' ? showOptions.viewColumn : showOptions;\n\t\tconst webviewShowOptions = {\n\t\t\tviewColumn: typeConverters.ViewColumn.from(viewColumn),\n\t\t\tpreserveFocus: typeof showOptions === 'object' && !!showOptions.preserveFocus\n\t\t};\n\n\t\tconst handle = ExtHostWebviewPanels.newHandle();\n\t\tthis._proxy.$createWebviewPanel(toExtensionData(extension), handle, viewType, title, webviewShowOptions, convertWebviewOptions(extension, this.workspace, options));\n\n\t\tconst webview = this.webviews.createNewWebview(handle, options, extension);\n\t\tconst panel = this.createNewWebviewPanel(handle, viewType, title, viewColumn, options, webview);\n\n\t\treturn panel;\n\t}\n\n\tpublic $onDidChangeWebviewPanelViewStates(newStates: extHostProtocol.WebviewPanelViewStateData): void {\n\t\tconst handles = Object.keys(newStates);\n\t\t// Notify webviews of state changes in the following order:\n\t\t// - Non-visible\n\t\t// - Visible\n\t\t// - Active\n\t\thandles.sort((a, b) => {\n\t\t\tconst stateA = newStates[a];\n\t\t\tconst stateB = newStates[b];\n\t\t\tif (stateA.active) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tif (stateB.active) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\treturn (+stateA.visible) - (+stateB.visible);\n\t\t});\n\n\t\tfor (const handle of handles) {\n\t\t\tconst panel = this.getWebviewPanel(handle);\n\t\t\tif (!panel) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst newState = newStates[handle];\n\t\t\tpanel._updateViewState({\n\t\t\t\tactive: newState.active,\n\t\t\t\tvisible: newState.visible,\n\t\t\t\tviewColumn: typeConverters.ViewColumn.to(newState.position),\n\t\t\t});\n\t\t}\n\t}\n\n\tasync $onDidDisposeWebviewPanel(handle: extHostProtocol.WebviewHandle): Promise<void> {\n\t\tconst panel = this.getWebviewPanel(handle);\n\t\tpanel?.dispose();\n\n\t\tthis._webviewPanels.delete(handle);\n\t\tthis.webviews.deleteWebview(handle);\n\t}\n\n\tpublic registerWebviewPanelSerializer(\n\t\textension: IExtensionDescription,\n\t\tviewType: string,\n\t\tserializer: vscode.WebviewPanelSerializer\n\t): vscode.Disposable {\n\t\tif (this._serializers.has(viewType)) {\n\t\t\tthrow new Error(`Serializer for '${viewType}' already registered`);\n\t\t}\n\n\t\tthis._serializers.set(viewType, { serializer, extension });\n\t\tthis._proxy.$registerSerializer(viewType);\n\n\t\treturn new extHostTypes.Disposable(() => {\n\t\t\tthis._serializers.delete(viewType);\n\t\t\tthis._proxy.$unregisterSerializer(viewType);\n\t\t});\n\t}\n\n\tasync $deserializeWebviewPanel(\n\t\twebviewHandle: extHostProtocol.WebviewHandle,\n\t\tviewType: string,\n\t\ttitle: string,\n\t\tstate: any,\n\t\tposition: EditorGroupColumn,\n\t\toptions: modes.IWebviewOptions & modes.IWebviewPanelOptions\n\t): Promise<void> {\n\t\tconst entry = this._serializers.get(viewType);\n\t\tif (!entry) {\n\t\t\tthrow new Error(`No serializer found for '${viewType}'`);\n\t\t}\n\t\tconst { serializer, extension } = entry;\n\n\t\tconst webview = this.webviews.createNewWebview(webviewHandle, options, extension);\n\t\tconst revivedPanel = this.createNewWebviewPanel(webviewHandle, viewType, title, position, options, webview);\n\t\tawait serializer.deserializeWebviewPanel(revivedPanel, state);\n\t}\n\n\tpublic createNewWebviewPanel(webviewHandle: string, viewType: string, title: string, position: vscode.ViewColumn, options: modes.IWebviewOptions & modes.IWebviewPanelOptions, webview: ExtHostWebview) {\n\t\tconst panel = new ExtHostWebviewPanel(webviewHandle, this._proxy, viewType, title, position, options, webview);\n\t\tthis._webviewPanels.set(webviewHandle, panel);\n\t\treturn panel;\n\t}\n\n\tpublic getWebviewPanel(handle: extHostProtocol.WebviewHandle): ExtHostWebviewPanel | undefined {\n\t\treturn this._webviewPanels.get(handle);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { Emitter } from 'vs/base/common/event';\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport { IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { ExtHostWebview, ExtHostWebviews, toExtensionData } from 'vs/workbench/api/common/extHostWebview';\nimport type * as vscode from 'vscode';\nimport * as extHostProtocol from './extHost.protocol';\nimport * as extHostTypes from './extHostTypes';\n\nclass ExtHostWebviewView extends Disposable implements vscode.WebviewView {\n\n\treadonly #handle: extHostProtocol.WebviewHandle;\n\treadonly #proxy: extHostProtocol.MainThreadWebviewViewsShape;\n\n\treadonly #viewType: string;\n\treadonly #webview: ExtHostWebview;\n\n\t#isDisposed = false;\n\t#isVisible: boolean;\n\t#title: string | undefined;\n\t#description: string | undefined;\n\n\tconstructor(\n\t\thandle: extHostProtocol.WebviewHandle,\n\t\tproxy: extHostProtocol.MainThreadWebviewViewsShape,\n\t\tviewType: string,\n\t\ttitle: string | undefined,\n\t\twebview: ExtHostWebview,\n\t\tisVisible: boolean,\n\t) {\n\t\tsuper();\n\n\t\tthis.#viewType = viewType;\n\t\tthis.#title = title;\n\t\tthis.#handle = handle;\n\t\tthis.#proxy = proxy;\n\t\tthis.#webview = webview;\n\t\tthis.#isVisible = isVisible;\n\t}\n\n\tpublic dispose() {\n\t\tif (this.#isDisposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#isDisposed = true;\n\t\tthis.#onDidDispose.fire();\n\n\t\tthis.#webview.dispose();\n\n\t\tsuper.dispose();\n\t}\n\n\treadonly #onDidChangeVisibility = this._register(new Emitter<void>());\n\tpublic readonly onDidChangeVisibility = this.#onDidChangeVisibility.event;\n\n\treadonly #onDidDispose = this._register(new Emitter<void>());\n\tpublic readonly onDidDispose = this.#onDidDispose.event;\n\n\tpublic get title(): string | undefined {\n\t\tthis.assertNotDisposed();\n\t\treturn this.#title;\n\t}\n\n\tpublic set title(value: string | undefined) {\n\t\tthis.assertNotDisposed();\n\t\tif (this.#title !== value) {\n\t\t\tthis.#title = value;\n\t\t\tthis.#proxy.$setWebviewViewTitle(this.#handle, value);\n\t\t}\n\t}\n\n\tpublic get description(): string | undefined {\n\t\tthis.assertNotDisposed();\n\t\treturn this.#description;\n\t}\n\n\tpublic set description(value: string | undefined) {\n\t\tthis.assertNotDisposed();\n\t\tif (this.#description !== value) {\n\t\t\tthis.#description = value;\n\t\t\tthis.#proxy.$setWebviewViewDescription(this.#handle, value);\n\t\t}\n\t}\n\n\tpublic get visible(): boolean { return this.#isVisible; }\n\n\tpublic get webview(): vscode.Webview { return this.#webview; }\n\n\tpublic get viewType(): string { return this.#viewType; }\n\n\t/* internal */ _setVisible(visible: boolean) {\n\t\tif (visible === this.#isVisible || this.#isDisposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#isVisible = visible;\n\t\tthis.#onDidChangeVisibility.fire();\n\t}\n\n\tpublic show(preserveFocus?: boolean): void {\n\t\tthis.assertNotDisposed();\n\t\tthis.#proxy.$show(this.#handle, !!preserveFocus);\n\t}\n\n\tprivate assertNotDisposed() {\n\t\tif (this.#isDisposed) {\n\t\t\tthrow new Error('Webview is disposed');\n\t\t}\n\t}\n}\n\nexport class ExtHostWebviewViews implements extHostProtocol.ExtHostWebviewViewsShape {\n\n\tprivate readonly _proxy: extHostProtocol.MainThreadWebviewViewsShape;\n\n\tprivate readonly _viewProviders = new Map<string, {\n\t\treadonly provider: vscode.WebviewViewProvider;\n\t\treadonly extension: IExtensionDescription;\n\t}>();\n\n\tprivate readonly _webviewViews = new Map<extHostProtocol.WebviewHandle, ExtHostWebviewView>();\n\n\tconstructor(\n\t\tmainContext: extHostProtocol.IMainContext,\n\t\tprivate readonly _extHostWebview: ExtHostWebviews,\n\t) {\n\t\tthis._proxy = mainContext.getProxy(extHostProtocol.MainContext.MainThreadWebviewViews);\n\t}\n\n\tpublic registerWebviewViewProvider(\n\t\textension: IExtensionDescription,\n\t\tviewType: string,\n\t\tprovider: vscode.WebviewViewProvider,\n\t\twebviewOptions?: {\n\t\t\tretainContextWhenHidden?: boolean\n\t\t},\n\t): vscode.Disposable {\n\t\tif (this._viewProviders.has(viewType)) {\n\t\t\tthrow new Error(`View provider for '${viewType}' already registered`);\n\t\t}\n\n\t\tthis._viewProviders.set(viewType, { provider, extension });\n\t\tthis._proxy.$registerWebviewViewProvider(toExtensionData(extension), viewType, webviewOptions);\n\n\t\treturn new extHostTypes.Disposable(() => {\n\t\t\tthis._viewProviders.delete(viewType);\n\t\t\tthis._proxy.$unregisterWebviewViewProvider(viewType);\n\t\t});\n\t}\n\n\tasync $resolveWebviewView(\n\t\twebviewHandle: string,\n\t\tviewType: string,\n\t\ttitle: string | undefined,\n\t\tstate: any,\n\t\tcancellation: CancellationToken,\n\t): Promise<void> {\n\t\tconst entry = this._viewProviders.get(viewType);\n\t\tif (!entry) {\n\t\t\tthrow new Error(`No view provider found for '${viewType}'`);\n\t\t}\n\n\t\tconst { provider, extension } = entry;\n\n\t\tconst webview = this._extHostWebview.createNewWebview(webviewHandle, { /* todo */ }, extension);\n\t\tconst revivedView = new ExtHostWebviewView(webviewHandle, this._proxy, viewType, title, webview, true);\n\n\t\tthis._webviewViews.set(webviewHandle, revivedView);\n\n\t\tawait provider.resolveWebviewView(revivedView, { state }, cancellation);\n\t}\n\n\tasync $onDidChangeWebviewViewVisibility(\n\t\twebviewHandle: string,\n\t\tvisible: boolean\n\t) {\n\t\tconst webviewView = this.getWebviewView(webviewHandle);\n\t\twebviewView._setVisible(visible);\n\t}\n\n\tasync $disposeWebviewView(webviewHandle: string) {\n\t\tconst webviewView = this.getWebviewView(webviewHandle);\n\t\tthis._webviewViews.delete(webviewHandle);\n\t\twebviewView.dispose();\n\n\t\tthis._extHostWebview.deleteWebview(webviewHandle);\n\t}\n\n\tprivate getWebviewView(handle: string): ExtHostWebviewView {\n\t\tconst entry = this._webviewViews.get(handle);\n\t\tif (!entry) {\n\t\t\tthrow new Error('No webview found');\n\t\t}\n\t\treturn entry;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Event, Emitter } from 'vs/base/common/event';\nimport { ExtHostWindowShape, MainContext, MainThreadWindowShape, IOpenUriOptions } from './extHost.protocol';\nimport { WindowState } from 'vscode';\nimport { URI } from 'vs/base/common/uri';\nimport { Schemas } from 'vs/base/common/network';\nimport { isFalsyOrWhitespace } from 'vs/base/common/strings';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { IExtHostRpcService } from 'vs/workbench/api/common/extHostRpcService';\n\nexport class ExtHostWindow implements ExtHostWindowShape {\n\n\tprivate static InitialState: WindowState = {\n\t\tfocused: true\n\t};\n\n\tprivate _proxy: MainThreadWindowShape;\n\n\tprivate readonly _onDidChangeWindowState = new Emitter<WindowState>();\n\treadonly onDidChangeWindowState: Event<WindowState> = this._onDidChangeWindowState.event;\n\n\tprivate _state = ExtHostWindow.InitialState;\n\tget state(): WindowState { return this._state; }\n\n\tconstructor(@IExtHostRpcService extHostRpc: IExtHostRpcService) {\n\t\tthis._proxy = extHostRpc.getProxy(MainContext.MainThreadWindow);\n\t\tthis._proxy.$getWindowVisibility().then(isFocused => this.$onDidChangeWindowFocus(isFocused));\n\t}\n\n\t$onDidChangeWindowFocus(focused: boolean): void {\n\t\tif (focused === this._state.focused) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._state = { ...this._state, focused };\n\t\tthis._onDidChangeWindowState.fire(this._state);\n\t}\n\n\topenUri(stringOrUri: string | URI, options: IOpenUriOptions): Promise<boolean> {\n\t\tlet uriAsString: string | undefined;\n\t\tif (typeof stringOrUri === 'string') {\n\t\t\turiAsString = stringOrUri;\n\t\t\ttry {\n\t\t\t\tstringOrUri = URI.parse(stringOrUri);\n\t\t\t} catch (e) {\n\t\t\t\treturn Promise.reject(`Invalid uri - '${stringOrUri}'`);\n\t\t\t}\n\t\t}\n\t\tif (isFalsyOrWhitespace(stringOrUri.scheme)) {\n\t\t\treturn Promise.reject('Invalid scheme - cannot be empty');\n\t\t} else if (stringOrUri.scheme === Schemas.command) {\n\t\t\treturn Promise.reject(`Invalid scheme '${stringOrUri.scheme}'`);\n\t\t}\n\t\treturn this._proxy.$openUri(stringOrUri, uriAsString, options);\n\t}\n\n\tasync asExternalUri(uri: URI, options: IOpenUriOptions): Promise<URI> {\n\t\tif (isFalsyOrWhitespace(uri.scheme)) {\n\t\t\treturn Promise.reject('Invalid scheme - cannot be empty');\n\t\t} else if (!new Set([Schemas.http, Schemas.https]).has(uri.scheme)) {\n\t\t\treturn Promise.reject(`Invalid scheme '${uri.scheme}'`);\n\t\t}\n\n\t\tconst result = await this._proxy.$asExternalUri(uri, options);\n\t\treturn URI.from(result);\n\t}\n}\n\nexport const IExtHostWindow = createDecorator<IExtHostWindow>('IExtHostWindow');\nexport interface IExtHostWindow extends ExtHostWindow, ExtHostWindowShape { }\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { join } from 'vs/base/common/path';\nimport { tmpdir } from 'os';\nimport { generateUuid } from 'vs/base/common/uuid';\nimport { IExtHostCommands } from 'vs/workbench/api/common/extHostCommands';\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport { MainContext } from 'vs/workbench/api/common/extHost.protocol';\nimport { URI } from 'vs/base/common/uri';\nimport { IExtHostRpcService } from 'vs/workbench/api/common/extHostRpcService';\n\nexport class ExtHostDownloadService extends Disposable {\n\n\tconstructor(\n\t\t@IExtHostRpcService extHostRpc: IExtHostRpcService,\n\t\t@IExtHostCommands commands: IExtHostCommands\n\t) {\n\t\tsuper();\n\n\t\tconst proxy = extHostRpc.getProxy(MainContext.MainThreadDownloadService);\n\n\t\tcommands.registerCommand(false, '_workbench.downloadResource', async (resource: URI): Promise<any> => {\n\t\t\tconst location = URI.file(join(tmpdir(), generateUuid()));\n\t\t\tawait proxy.$download(resource, location);\n\t\t\treturn location;\n\t\t});\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { MainThreadTunnelServiceShape, MainContext } from 'vs/workbench/api/common/extHost.protocol';\nimport { IExtHostRpcService } from 'vs/workbench/api/common/extHostRpcService';\nimport type * as vscode from 'vscode';\nimport { Disposable, IDisposable, toDisposable } from 'vs/base/common/lifecycle';\nimport { IExtHostInitDataService } from 'vs/workbench/api/common/extHostInitDataService';\nimport { URI } from 'vs/base/common/uri';\nimport { exec } from 'child_process';\nimport * as resources from 'vs/base/common/resources';\nimport * as fs from 'fs';\nimport * as pfs from 'vs/base/node/pfs';\nimport { isLinux } from 'vs/base/common/platform';\nimport { IExtHostTunnelService, TunnelDto } from 'vs/workbench/api/common/extHostTunnelService';\nimport { Event, Emitter } from 'vs/base/common/event';\nimport { TunnelOptions, TunnelCreationOptions } from 'vs/platform/remote/common/tunnel';\nimport { IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { promisify } from 'util';\nimport { MovingAverage } from 'vs/base/common/numbers';\nimport { CandidatePort } from 'vs/workbench/services/remote/common/remoteExplorerService';\nimport { ILogService } from 'vs/platform/log/common/log';\n\nclass ExtensionTunnel implements vscode.Tunnel {\n\tprivate _onDispose: Emitter<void> = new Emitter();\n\tonDidDispose: Event<void> = this._onDispose.event;\n\n\tconstructor(\n\t\tpublic readonly remoteAddress: { port: number, host: string },\n\t\tpublic readonly localAddress: { port: number, host: string } | string,\n\t\tprivate readonly _dispose: () => Promise<void>) { }\n\n\tdispose(): Promise<void> {\n\t\tthis._onDispose.fire();\n\t\treturn this._dispose();\n\t}\n}\n\nexport function getSockets(stdout: string): { pid: number, socket: number }[] {\n\tconst lines = stdout.trim().split('\\n');\n\tconst mapped: { pid: number, socket: number }[] = [];\n\tlines.forEach(line => {\n\t\tconst match = /\\/proc\\/(\\d+)\\/fd\\/\\d+ -> socket:\\[(\\d+)\\]/.exec(line)!;\n\t\tif (match && match.length >= 3) {\n\t\t\tmapped.push({\n\t\t\t\tpid: parseInt(match[1], 10),\n\t\t\t\tsocket: parseInt(match[2], 10)\n\t\t\t});\n\t\t}\n\t});\n\treturn mapped;\n}\n\nexport function loadListeningPorts(...stdouts: string[]): { socket: number, ip: string, port: number }[] {\n\tconst table = ([] as Record<string, string>[]).concat(...stdouts.map(loadConnectionTable));\n\treturn [\n\t\t...new Map(\n\t\t\ttable.filter(row => row.st === '0A')\n\t\t\t\t.map(row => {\n\t\t\t\t\tconst address = row.local_address.split(':');\n\t\t\t\t\treturn {\n\t\t\t\t\t\tsocket: parseInt(row.inode, 10),\n\t\t\t\t\t\tip: parseIpAddress(address[0]),\n\t\t\t\t\t\tport: parseInt(address[1], 16)\n\t\t\t\t\t};\n\t\t\t\t}).map(port => [port.ip + ':' + port.port, port])\n\t\t).values()\n\t];\n}\n\nexport function parseIpAddress(hex: string): string {\n\tlet result = '';\n\tif (hex.length === 8) {\n\t\tfor (let i = hex.length - 2; i >= 0; i -= 2) {\n\t\t\tresult += parseInt(hex.substr(i, 2), 16);\n\t\t\tif (i !== 0) {\n\t\t\t\tresult += '.';\n\t\t\t}\n\t\t}\n\t} else {\n\t\tfor (let i = hex.length - 4; i >= 0; i -= 4) {\n\t\t\tresult += parseInt(hex.substr(i, 4), 16).toString(16);\n\t\t\tif (i !== 0) {\n\t\t\t\tresult += ':';\n\t\t\t}\n\t\t}\n\t}\n\treturn result;\n}\n\nexport function loadConnectionTable(stdout: string): Record<string, string>[] {\n\tconst lines = stdout.trim().split('\\n');\n\tconst names = lines.shift()!.trim().split(/\\s+/)\n\t\t.filter(name => name !== 'rx_queue' && name !== 'tm->when');\n\tconst table = lines.map(line => line.trim().split(/\\s+/).reduce((obj, value, i) => {\n\t\tobj[names[i] || i] = value;\n\t\treturn obj;\n\t}, {} as Record<string, string>));\n\treturn table;\n}\n\nfunction knownExcludeCmdline(command: string): boolean {\n\treturn !!command.match(/.*\\.vscode-server-[a-zA-Z]+\\/bin.*/)\n\t\t|| (command.indexOf('out/vs/server/main.js') !== -1)\n\t\t|| (command.indexOf('_productName=VSCode') !== -1);\n}\n\nexport async function findPorts(tcp: string, tcp6: string, procSockets: string, processes: { pid: number, cwd: string, cmd: string }[]): Promise<CandidatePort[]> {\n\tconst connections: { socket: number, ip: string, port: number }[] = loadListeningPorts(tcp, tcp6);\n\tconst sockets = getSockets(procSockets);\n\n\tconst socketMap = sockets.reduce((m, socket) => {\n\t\tm[socket.socket] = socket;\n\t\treturn m;\n\t}, {} as Record<string, typeof sockets[0]>);\n\tconst processMap = processes.reduce((m, process) => {\n\t\tm[process.pid] = process;\n\t\treturn m;\n\t}, {} as Record<string, typeof processes[0]>);\n\n\tconst ports: CandidatePort[] = [];\n\tconnections.filter((connection => socketMap[connection.socket])).forEach(({ socket, ip, port }) => {\n\t\tconst command = processMap[socketMap[socket].pid].cmd;\n\t\tif (!knownExcludeCmdline(command)) {\n\t\t\tports.push({ host: ip, port, detail: processMap[socketMap[socket].pid].cmd, pid: socketMap[socket].pid });\n\t\t}\n\t});\n\treturn ports;\n}\n\nexport class ExtHostTunnelService extends Disposable implements IExtHostTunnelService {\n\treadonly _serviceBrand: undefined;\n\tprivate readonly _proxy: MainThreadTunnelServiceShape;\n\tprivate _forwardPortProvider: ((tunnelOptions: TunnelOptions, tunnelCreationOptions: TunnelCreationOptions) => Thenable<vscode.Tunnel> | undefined) | undefined;\n\tprivate _showCandidatePort: (host: string, port: number, detail: string) => Thenable<boolean> = () => { return Promise.resolve(true); };\n\tprivate _extensionTunnels: Map<string, Map<number, { tunnel: vscode.Tunnel, disposeListener: IDisposable }>> = new Map();\n\tprivate _onDidChangeTunnels: Emitter<void> = new Emitter<void>();\n\tonDidChangeTunnels: vscode.Event<void> = this._onDidChangeTunnels.event;\n\tprivate _candidateFindingEnabled: boolean = false;\n\n\tconstructor(\n\t\t@IExtHostRpcService extHostRpc: IExtHostRpcService,\n\t\t@IExtHostInitDataService initData: IExtHostInitDataService,\n\t\t@ILogService private readonly logService: ILogService\n\t) {\n\t\tsuper();\n\t\tthis._proxy = extHostRpc.getProxy(MainContext.MainThreadTunnelService);\n\t\tif (isLinux && initData.remote.isRemote && initData.remote.authority) {\n\t\t\tthis._proxy.$setCandidateFinder();\n\t\t}\n\t}\n\n\tasync openTunnel(extension: IExtensionDescription, forward: TunnelOptions): Promise<vscode.Tunnel | undefined> {\n\t\tconst tunnel = await this._proxy.$openTunnel(forward, extension.displayName);\n\t\tif (tunnel) {\n\t\t\tconst disposableTunnel: vscode.Tunnel = new ExtensionTunnel(tunnel.remoteAddress, tunnel.localAddress, () => {\n\t\t\t\treturn this._proxy.$closeTunnel(tunnel.remoteAddress);\n\t\t\t});\n\t\t\tthis._register(disposableTunnel);\n\t\t\treturn disposableTunnel;\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tasync getTunnels(): Promise<vscode.TunnelDescription[]> {\n\t\treturn this._proxy.$getTunnels();\n\t}\n\n\tprivate calculateDelay(movingAverage: number) {\n\t\t// Some local testing indicated that the moving average might be between 50-100 ms.\n\t\treturn Math.max(movingAverage * 20, 2000);\n\t}\n\n\tasync $registerCandidateFinder(enable: boolean): Promise<void> {\n\t\tif (enable && this._candidateFindingEnabled) {\n\t\t\t// already enabled\n\t\t\treturn;\n\t\t}\n\t\tthis._candidateFindingEnabled = enable;\n\t\t// Regularly scan to see if the candidate ports have changed.\n\t\tlet movingAverage = new MovingAverage();\n\t\tlet oldPorts: { host: string, port: number, detail: string }[] | undefined = undefined;\n\t\twhile (this._candidateFindingEnabled) {\n\t\t\tconst startTime = new Date().getTime();\n\t\t\tconst newPorts = await this.findCandidatePorts();\n\t\t\tconst timeTaken = new Date().getTime() - startTime;\n\t\t\tmovingAverage.update(timeTaken);\n\t\t\tif (!oldPorts || (JSON.stringify(oldPorts) !== JSON.stringify(newPorts))) {\n\t\t\t\toldPorts = newPorts;\n\t\t\t\tawait this._proxy.$onFoundNewCandidates(oldPorts);\n\t\t\t}\n\t\t\tawait (new Promise<void>(resolve => setTimeout(() => resolve(), this.calculateDelay(movingAverage.value))));\n\t\t}\n\t}\n\n\tasync setTunnelExtensionFunctions(provider: vscode.RemoteAuthorityResolver | undefined): Promise<IDisposable> {\n\t\tif (provider) {\n\t\t\tif (provider.showCandidatePort) {\n\t\t\t\tthis._showCandidatePort = provider.showCandidatePort;\n\t\t\t\tawait this._proxy.$setCandidateFilter();\n\t\t\t}\n\t\t\tif (provider.tunnelFactory) {\n\t\t\t\tthis._forwardPortProvider = provider.tunnelFactory;\n\t\t\t\tawait this._proxy.$setTunnelProvider(provider.tunnelFeatures ?? {\n\t\t\t\t\televation: false,\n\t\t\t\t\tpublic: false\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tthis._forwardPortProvider = undefined;\n\t\t}\n\t\treturn toDisposable(() => {\n\t\t\tthis._forwardPortProvider = undefined;\n\t\t});\n\t}\n\n\tasync $closeTunnel(remote: { host: string, port: number }, silent?: boolean): Promise<void> {\n\t\tif (this._extensionTunnels.has(remote.host)) {\n\t\t\tconst hostMap = this._extensionTunnels.get(remote.host)!;\n\t\t\tif (hostMap.has(remote.port)) {\n\t\t\t\tif (silent) {\n\t\t\t\t\thostMap.get(remote.port)!.disposeListener.dispose();\n\t\t\t\t}\n\t\t\t\tawait hostMap.get(remote.port)!.tunnel.dispose();\n\t\t\t\thostMap.delete(remote.port);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync $onDidTunnelsChange(): Promise<void> {\n\t\tthis._onDidChangeTunnels.fire();\n\t}\n\n\tasync $forwardPort(tunnelOptions: TunnelOptions, tunnelCreationOptions: TunnelCreationOptions): Promise<TunnelDto | undefined> {\n\t\tif (this._forwardPortProvider) {\n\t\t\ttry {\n\t\t\t\tthis.logService.trace('$forwardPort: Getting tunnel from provider.');\n\t\t\t\tconst providedPort = this._forwardPortProvider(tunnelOptions, tunnelCreationOptions);\n\t\t\t\tthis.logService.trace('$forwardPort: Got tunnel promise from provider.');\n\t\t\t\tif (providedPort !== undefined) {\n\t\t\t\t\tconst tunnel = await providedPort;\n\t\t\t\t\tthis.logService.trace('$forwardPort: Successfully awaited tunnel from provider.');\n\t\t\t\t\tif (!this._extensionTunnels.has(tunnelOptions.remoteAddress.host)) {\n\t\t\t\t\t\tthis._extensionTunnels.set(tunnelOptions.remoteAddress.host, new Map());\n\t\t\t\t\t}\n\t\t\t\t\tconst disposeListener = this._register(tunnel.onDidDispose(() => this._proxy.$closeTunnel(tunnel.remoteAddress)));\n\t\t\t\t\tthis._extensionTunnels.get(tunnelOptions.remoteAddress.host)!.set(tunnelOptions.remoteAddress.port, { tunnel, disposeListener });\n\t\t\t\t\treturn TunnelDto.fromApiTunnel(tunnel);\n\t\t\t\t} else {\n\t\t\t\t\tthis.logService.trace('$forwardPort: Tunnel is undefined');\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tthis.logService.trace('$forwardPort: tunnel provider error');\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tasync $applyCandidateFilter(candidates: CandidatePort[]): Promise<CandidatePort[]> {\n\t\tconst filter = await Promise.all(candidates.map(candidate => this._showCandidatePort(candidate.host, candidate.port, candidate.detail)));\n\t\treturn candidates.filter((candidate, index) => filter[index]);\n\t}\n\n\tasync findCandidatePorts(): Promise<CandidatePort[]> {\n\t\tlet tcp: string = '';\n\t\tlet tcp6: string = '';\n\t\ttry {\n\t\t\ttcp = await pfs.readFile('/proc/net/tcp', 'utf8');\n\t\t\ttcp6 = await pfs.readFile('/proc/net/tcp6', 'utf8');\n\t\t} catch (e) {\n\t\t\t// File reading error. No additional handling needed.\n\t\t}\n\t\tconst procSockets: string = await (new Promise(resolve => {\n\t\t\texec('ls -l /proc/[0-9]*/fd/[0-9]* | grep socket:', (error, stdout, stderr) => {\n\t\t\t\tresolve(stdout);\n\t\t\t});\n\t\t}));\n\n\t\tconst procChildren = await pfs.readdir('/proc');\n\t\tconst processes: {\n\t\t\tpid: number, cwd: string, cmd: string\n\t\t}[] = [];\n\t\tfor (let childName of procChildren) {\n\t\t\ttry {\n\t\t\t\tconst pid: number = Number(childName);\n\t\t\t\tconst childUri = resources.joinPath(URI.file('/proc'), childName);\n\t\t\t\tconst childStat = await pfs.stat(childUri.fsPath);\n\t\t\t\tif (childStat.isDirectory() && !isNaN(pid)) {\n\t\t\t\t\tconst cwd = await promisify(fs.readlink)(resources.joinPath(childUri, 'cwd').fsPath);\n\t\t\t\t\tconst cmd = await pfs.readFile(resources.joinPath(childUri, 'cmdline').fsPath, 'utf8');\n\t\t\t\t\tprocesses.push({ pid, cwd, cmd });\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\t//\n\t\t\t}\n\t\t}\n\t\treturn findPorts(tcp, tcp6, procSockets, processes);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { RunOnceScheduler } from 'vs/base/common/async';\nimport { CancellationToken, CancellationTokenSource } from 'vs/base/common/cancellation';\nimport { CharCode } from 'vs/base/common/charCode';\nimport * as errors from 'vs/base/common/errors';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport { IURITransformer, transformIncomingURIs } from 'vs/base/common/uriIpc';\nimport { IMessagePassingProtocol } from 'vs/base/parts/ipc/common/ipc';\nimport { LazyPromise } from 'vs/workbench/services/extensions/common/lazyPromise';\nimport { IRPCProtocol, ProxyIdentifier, getStringIdentifierForProxy } from 'vs/workbench/services/extensions/common/proxyIdentifier';\nimport { VSBuffer } from 'vs/base/common/buffer';\n\nexport interface JSONStringifyReplacer {\n\t(key: string, value: any): any;\n}\n\nfunction safeStringify(obj: any, replacer: JSONStringifyReplacer | null): string {\n\ttry {\n\t\treturn JSON.stringify(obj, <(key: string, value: any) => any>replacer);\n\t} catch (err) {\n\t\treturn 'null';\n\t}\n}\n\nfunction stringify(obj: any, replacer: JSONStringifyReplacer | null): string {\n\treturn JSON.stringify(obj, <(key: string, value: any) => any>replacer);\n}\n\nfunction createURIReplacer(transformer: IURITransformer | null): JSONStringifyReplacer | null {\n\tif (!transformer) {\n\t\treturn null;\n\t}\n\treturn (key: string, value: any): any => {\n\t\tif (value && value.$mid === 1) {\n\t\t\treturn transformer.transformOutgoing(value);\n\t\t}\n\t\treturn value;\n\t};\n}\n\nexport const enum RequestInitiator {\n\tLocalSide = 0,\n\tOtherSide = 1\n}\n\nexport const enum ResponsiveState {\n\tResponsive = 0,\n\tUnresponsive = 1\n}\n\nexport interface IRPCProtocolLogger {\n\tlogIncoming(msgLength: number, req: number, initiator: RequestInitiator, str: string, data?: any): void;\n\tlogOutgoing(msgLength: number, req: number, initiator: RequestInitiator, str: string, data?: any): void;\n}\n\nconst noop = () => { };\n\nexport class RPCProtocol extends Disposable implements IRPCProtocol {\n\n\tprivate static readonly UNRESPONSIVE_TIME = 3 * 1000; // 3s\n\n\tprivate readonly _onDidChangeResponsiveState: Emitter<ResponsiveState> = this._register(new Emitter<ResponsiveState>());\n\tpublic readonly onDidChangeResponsiveState: Event<ResponsiveState> = this._onDidChangeResponsiveState.event;\n\n\tprivate readonly _protocol: IMessagePassingProtocol;\n\tprivate readonly _logger: IRPCProtocolLogger | null;\n\tprivate readonly _uriTransformer: IURITransformer | null;\n\tprivate readonly _uriReplacer: JSONStringifyReplacer | null;\n\tprivate _isDisposed: boolean;\n\tprivate readonly _locals: any[];\n\tprivate readonly _proxies: any[];\n\tprivate _lastMessageId: number;\n\tprivate readonly _cancelInvokedHandlers: { [req: string]: () => void; };\n\tprivate readonly _pendingRPCReplies: { [msgId: string]: LazyPromise; };\n\tprivate _responsiveState: ResponsiveState;\n\tprivate _unacknowledgedCount: number;\n\tprivate _unresponsiveTime: number;\n\tprivate _asyncCheckUresponsive: RunOnceScheduler;\n\n\tconstructor(protocol: IMessagePassingProtocol, logger: IRPCProtocolLogger | null = null, transformer: IURITransformer | null = null) {\n\t\tsuper();\n\t\tthis._protocol = protocol;\n\t\tthis._logger = logger;\n\t\tthis._uriTransformer = transformer;\n\t\tthis._uriReplacer = createURIReplacer(this._uriTransformer);\n\t\tthis._isDisposed = false;\n\t\tthis._locals = [];\n\t\tthis._proxies = [];\n\t\tfor (let i = 0, len = ProxyIdentifier.count; i < len; i++) {\n\t\t\tthis._locals[i] = null;\n\t\t\tthis._proxies[i] = null;\n\t\t}\n\t\tthis._lastMessageId = 0;\n\t\tthis._cancelInvokedHandlers = Object.create(null);\n\t\tthis._pendingRPCReplies = {};\n\t\tthis._responsiveState = ResponsiveState.Responsive;\n\t\tthis._unacknowledgedCount = 0;\n\t\tthis._unresponsiveTime = 0;\n\t\tthis._asyncCheckUresponsive = this._register(new RunOnceScheduler(() => this._checkUnresponsive(), 1000));\n\t\tthis._protocol.onMessage((msg) => this._receiveOneMessage(msg));\n\t}\n\n\tpublic dispose(): void {\n\t\tthis._isDisposed = true;\n\n\t\t// Release all outstanding promises with a canceled error\n\t\tObject.keys(this._pendingRPCReplies).forEach((msgId) => {\n\t\t\tconst pending = this._pendingRPCReplies[msgId];\n\t\t\tpending.resolveErr(errors.canceled());\n\t\t});\n\t}\n\n\tpublic drain(): Promise<void> {\n\t\tif (typeof this._protocol.drain === 'function') {\n\t\t\treturn this._protocol.drain();\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\tprivate _onWillSendRequest(req: number): void {\n\t\tif (this._unacknowledgedCount === 0) {\n\t\t\t// Since this is the first request we are sending in a while,\n\t\t\t// mark this moment as the start for the countdown to unresponsive time\n\t\t\tthis._unresponsiveTime = Date.now() + RPCProtocol.UNRESPONSIVE_TIME;\n\t\t}\n\t\tthis._unacknowledgedCount++;\n\t\tif (!this._asyncCheckUresponsive.isScheduled()) {\n\t\t\tthis._asyncCheckUresponsive.schedule();\n\t\t}\n\t}\n\n\tprivate _onDidReceiveAcknowledge(req: number): void {\n\t\t// The next possible unresponsive time is now + delta.\n\t\tthis._unresponsiveTime = Date.now() + RPCProtocol.UNRESPONSIVE_TIME;\n\t\tthis._unacknowledgedCount--;\n\t\tif (this._unacknowledgedCount === 0) {\n\t\t\t// No more need to check for unresponsive\n\t\t\tthis._asyncCheckUresponsive.cancel();\n\t\t}\n\t\t// The ext host is responsive!\n\t\tthis._setResponsiveState(ResponsiveState.Responsive);\n\t}\n\n\tprivate _checkUnresponsive(): void {\n\t\tif (this._unacknowledgedCount === 0) {\n\t\t\t// Not waiting for anything => cannot say if it is responsive or not\n\t\t\treturn;\n\t\t}\n\n\t\tif (Date.now() > this._unresponsiveTime) {\n\t\t\t// Unresponsive!!\n\t\t\tthis._setResponsiveState(ResponsiveState.Unresponsive);\n\t\t} else {\n\t\t\t// Not (yet) unresponsive, be sure to check again soon\n\t\t\tthis._asyncCheckUresponsive.schedule();\n\t\t}\n\t}\n\n\tprivate _setResponsiveState(newResponsiveState: ResponsiveState): void {\n\t\tif (this._responsiveState === newResponsiveState) {\n\t\t\t// no change\n\t\t\treturn;\n\t\t}\n\t\tthis._responsiveState = newResponsiveState;\n\t\tthis._onDidChangeResponsiveState.fire(this._responsiveState);\n\t}\n\n\tpublic get responsiveState(): ResponsiveState {\n\t\treturn this._responsiveState;\n\t}\n\n\tpublic transformIncomingURIs<T>(obj: T): T {\n\t\tif (!this._uriTransformer) {\n\t\t\treturn obj;\n\t\t}\n\t\treturn transformIncomingURIs(obj, this._uriTransformer);\n\t}\n\n\tpublic getProxy<T>(identifier: ProxyIdentifier<T>): T {\n\t\tconst rpcId = identifier.nid;\n\t\tif (!this._proxies[rpcId]) {\n\t\t\tthis._proxies[rpcId] = this._createProxy(rpcId);\n\t\t}\n\t\treturn this._proxies[rpcId];\n\t}\n\n\tprivate _createProxy<T>(rpcId: number): T {\n\t\tlet handler = {\n\t\t\tget: (target: any, name: PropertyKey) => {\n\t\t\t\tif (typeof name === 'string' && !target[name] && name.charCodeAt(0) === CharCode.DollarSign) {\n\t\t\t\t\ttarget[name] = (...myArgs: any[]) => {\n\t\t\t\t\t\treturn this._remoteCall(rpcId, name, myArgs);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn target[name];\n\t\t\t}\n\t\t};\n\t\treturn new Proxy(Object.create(null), handler);\n\t}\n\n\tpublic set<T, R extends T>(identifier: ProxyIdentifier<T>, value: R): R {\n\t\tthis._locals[identifier.nid] = value;\n\t\treturn value;\n\t}\n\n\tpublic assertRegistered(identifiers: ProxyIdentifier<any>[]): void {\n\t\tfor (let i = 0, len = identifiers.length; i < len; i++) {\n\t\t\tconst identifier = identifiers[i];\n\t\t\tif (!this._locals[identifier.nid]) {\n\t\t\t\tthrow new Error(`Missing actor ${identifier.sid} (isMain: ${identifier.isMain})`);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _receiveOneMessage(rawmsg: VSBuffer): void {\n\t\tif (this._isDisposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst msgLength = rawmsg.byteLength;\n\t\tconst buff = MessageBuffer.read(rawmsg, 0);\n\t\tconst messageType = <MessageType>buff.readUInt8();\n\t\tconst req = buff.readUInt32();\n\n\t\tswitch (messageType) {\n\t\t\tcase MessageType.RequestJSONArgs:\n\t\t\tcase MessageType.RequestJSONArgsWithCancellation: {\n\t\t\t\tlet { rpcId, method, args } = MessageIO.deserializeRequestJSONArgs(buff);\n\t\t\t\tif (this._uriTransformer) {\n\t\t\t\t\targs = transformIncomingURIs(args, this._uriTransformer);\n\t\t\t\t}\n\t\t\t\tthis._receiveRequest(msgLength, req, rpcId, method, args, (messageType === MessageType.RequestJSONArgsWithCancellation));\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase MessageType.RequestMixedArgs:\n\t\t\tcase MessageType.RequestMixedArgsWithCancellation: {\n\t\t\t\tlet { rpcId, method, args } = MessageIO.deserializeRequestMixedArgs(buff);\n\t\t\t\tif (this._uriTransformer) {\n\t\t\t\t\targs = transformIncomingURIs(args, this._uriTransformer);\n\t\t\t\t}\n\t\t\t\tthis._receiveRequest(msgLength, req, rpcId, method, args, (messageType === MessageType.RequestMixedArgsWithCancellation));\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase MessageType.Acknowledged: {\n\t\t\t\tif (this._logger) {\n\t\t\t\t\tthis._logger.logIncoming(msgLength, req, RequestInitiator.LocalSide, `ack`);\n\t\t\t\t}\n\t\t\t\tthis._onDidReceiveAcknowledge(req);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase MessageType.Cancel: {\n\t\t\t\tthis._receiveCancel(msgLength, req);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase MessageType.ReplyOKEmpty: {\n\t\t\t\tthis._receiveReply(msgLength, req, undefined);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase MessageType.ReplyOKJSON: {\n\t\t\t\tlet value = MessageIO.deserializeReplyOKJSON(buff);\n\t\t\t\tif (this._uriTransformer) {\n\t\t\t\t\tvalue = transformIncomingURIs(value, this._uriTransformer);\n\t\t\t\t}\n\t\t\t\tthis._receiveReply(msgLength, req, value);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase MessageType.ReplyOKVSBuffer: {\n\t\t\t\tlet value = MessageIO.deserializeReplyOKVSBuffer(buff);\n\t\t\t\tthis._receiveReply(msgLength, req, value);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase MessageType.ReplyErrError: {\n\t\t\t\tlet err = MessageIO.deserializeReplyErrError(buff);\n\t\t\t\tif (this._uriTransformer) {\n\t\t\t\t\terr = transformIncomingURIs(err, this._uriTransformer);\n\t\t\t\t}\n\t\t\t\tthis._receiveReplyErr(msgLength, req, err);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase MessageType.ReplyErrEmpty: {\n\t\t\t\tthis._receiveReplyErr(msgLength, req, undefined);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdefault:\n\t\t\t\tconsole.error(`received unexpected message`);\n\t\t\t\tconsole.error(rawmsg);\n\t\t}\n\t}\n\n\tprivate _receiveRequest(msgLength: number, req: number, rpcId: number, method: string, args: any[], usesCancellationToken: boolean): void {\n\t\tif (this._logger) {\n\t\t\tthis._logger.logIncoming(msgLength, req, RequestInitiator.OtherSide, `receiveRequest ${getStringIdentifierForProxy(rpcId)}.${method}(`, args);\n\t\t}\n\t\tconst callId = String(req);\n\n\t\tlet promise: Promise<any>;\n\t\tlet cancel: () => void;\n\t\tif (usesCancellationToken) {\n\t\t\tconst cancellationTokenSource = new CancellationTokenSource();\n\t\t\targs.push(cancellationTokenSource.token);\n\t\t\tpromise = this._invokeHandler(rpcId, method, args);\n\t\t\tcancel = () => cancellationTokenSource.cancel();\n\t\t} else {\n\t\t\t// cannot be cancelled\n\t\t\tpromise = this._invokeHandler(rpcId, method, args);\n\t\t\tcancel = noop;\n\t\t}\n\n\t\tthis._cancelInvokedHandlers[callId] = cancel;\n\n\t\t// Acknowledge the request\n\t\tconst msg = MessageIO.serializeAcknowledged(req);\n\t\tif (this._logger) {\n\t\t\tthis._logger.logOutgoing(msg.byteLength, req, RequestInitiator.OtherSide, `ack`);\n\t\t}\n\t\tthis._protocol.send(msg);\n\n\t\tpromise.then((r) => {\n\t\t\tdelete this._cancelInvokedHandlers[callId];\n\t\t\tconst msg = MessageIO.serializeReplyOK(req, r, this._uriReplacer);\n\t\t\tif (this._logger) {\n\t\t\t\tthis._logger.logOutgoing(msg.byteLength, req, RequestInitiator.OtherSide, `reply:`, r);\n\t\t\t}\n\t\t\tthis._protocol.send(msg);\n\t\t}, (err) => {\n\t\t\tdelete this._cancelInvokedHandlers[callId];\n\t\t\tconst msg = MessageIO.serializeReplyErr(req, err);\n\t\t\tif (this._logger) {\n\t\t\t\tthis._logger.logOutgoing(msg.byteLength, req, RequestInitiator.OtherSide, `replyErr:`, err);\n\t\t\t}\n\t\t\tthis._protocol.send(msg);\n\t\t});\n\t}\n\n\tprivate _receiveCancel(msgLength: number, req: number): void {\n\t\tif (this._logger) {\n\t\t\tthis._logger.logIncoming(msgLength, req, RequestInitiator.OtherSide, `receiveCancel`);\n\t\t}\n\t\tconst callId = String(req);\n\t\tif (this._cancelInvokedHandlers[callId]) {\n\t\t\tthis._cancelInvokedHandlers[callId]();\n\t\t}\n\t}\n\n\tprivate _receiveReply(msgLength: number, req: number, value: any): void {\n\t\tif (this._logger) {\n\t\t\tthis._logger.logIncoming(msgLength, req, RequestInitiator.LocalSide, `receiveReply:`, value);\n\t\t}\n\t\tconst callId = String(req);\n\t\tif (!this._pendingRPCReplies.hasOwnProperty(callId)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst pendingReply = this._pendingRPCReplies[callId];\n\t\tdelete this._pendingRPCReplies[callId];\n\n\t\tpendingReply.resolveOk(value);\n\t}\n\n\tprivate _receiveReplyErr(msgLength: number, req: number, value: any): void {\n\t\tif (this._logger) {\n\t\t\tthis._logger.logIncoming(msgLength, req, RequestInitiator.LocalSide, `receiveReplyErr:`, value);\n\t\t}\n\n\t\tconst callId = String(req);\n\t\tif (!this._pendingRPCReplies.hasOwnProperty(callId)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst pendingReply = this._pendingRPCReplies[callId];\n\t\tdelete this._pendingRPCReplies[callId];\n\n\t\tlet err: any = undefined;\n\t\tif (value) {\n\t\t\tif (value.$isError) {\n\t\t\t\terr = new Error();\n\t\t\t\terr.name = value.name;\n\t\t\t\terr.message = value.message;\n\t\t\t\terr.stack = value.stack;\n\t\t\t} else {\n\t\t\t\terr = value;\n\t\t\t}\n\t\t}\n\t\tpendingReply.resolveErr(err);\n\t}\n\n\tprivate _invokeHandler(rpcId: number, methodName: string, args: any[]): Promise<any> {\n\t\ttry {\n\t\t\treturn Promise.resolve(this._doInvokeHandler(rpcId, methodName, args));\n\t\t} catch (err) {\n\t\t\treturn Promise.reject(err);\n\t\t}\n\t}\n\n\tprivate _doInvokeHandler(rpcId: number, methodName: string, args: any[]): any {\n\t\tconst actor = this._locals[rpcId];\n\t\tif (!actor) {\n\t\t\tthrow new Error('Unknown actor ' + getStringIdentifierForProxy(rpcId));\n\t\t}\n\t\tlet method = actor[methodName];\n\t\tif (typeof method !== 'function') {\n\t\t\tthrow new Error('Unknown method ' + methodName + ' on actor ' + getStringIdentifierForProxy(rpcId));\n\t\t}\n\t\treturn method.apply(actor, args);\n\t}\n\n\tprivate _remoteCall(rpcId: number, methodName: string, args: any[]): Promise<any> {\n\t\tif (this._isDisposed) {\n\t\t\treturn Promise.reject<any>(errors.canceled());\n\t\t}\n\t\tlet cancellationToken: CancellationToken | null = null;\n\t\tif (args.length > 0 && CancellationToken.isCancellationToken(args[args.length - 1])) {\n\t\t\tcancellationToken = args.pop();\n\t\t}\n\n\t\tif (cancellationToken && cancellationToken.isCancellationRequested) {\n\t\t\t// No need to do anything...\n\t\t\treturn Promise.reject<any>(errors.canceled());\n\t\t}\n\n\t\tconst serializedRequestArguments = MessageIO.serializeRequestArguments(args, this._uriReplacer);\n\n\t\tconst req = ++this._lastMessageId;\n\t\tconst callId = String(req);\n\t\tconst result = new LazyPromise();\n\n\t\tif (cancellationToken) {\n\t\t\tcancellationToken.onCancellationRequested(() => {\n\t\t\t\tconst msg = MessageIO.serializeCancel(req);\n\t\t\t\tif (this._logger) {\n\t\t\t\t\tthis._logger.logOutgoing(msg.byteLength, req, RequestInitiator.LocalSide, `cancel`);\n\t\t\t\t}\n\t\t\t\tthis._protocol.send(MessageIO.serializeCancel(req));\n\t\t\t});\n\t\t}\n\n\t\tthis._pendingRPCReplies[callId] = result;\n\t\tthis._onWillSendRequest(req);\n\t\tconst msg = MessageIO.serializeRequest(req, rpcId, methodName, serializedRequestArguments, !!cancellationToken);\n\t\tif (this._logger) {\n\t\t\tthis._logger.logOutgoing(msg.byteLength, req, RequestInitiator.LocalSide, `request: ${getStringIdentifierForProxy(rpcId)}.${methodName}(`, args);\n\t\t}\n\t\tthis._protocol.send(msg);\n\t\treturn result;\n\t}\n}\n\nclass MessageBuffer {\n\n\tpublic static alloc(type: MessageType, req: number, messageSize: number): MessageBuffer {\n\t\tlet result = new MessageBuffer(VSBuffer.alloc(messageSize + 1 /* type */ + 4 /* req */), 0);\n\t\tresult.writeUInt8(type);\n\t\tresult.writeUInt32(req);\n\t\treturn result;\n\t}\n\n\tpublic static read(buff: VSBuffer, offset: number): MessageBuffer {\n\t\treturn new MessageBuffer(buff, offset);\n\t}\n\n\tprivate _buff: VSBuffer;\n\tprivate _offset: number;\n\n\tpublic get buffer(): VSBuffer {\n\t\treturn this._buff;\n\t}\n\n\tprivate constructor(buff: VSBuffer, offset: number) {\n\t\tthis._buff = buff;\n\t\tthis._offset = offset;\n\t}\n\n\tpublic static sizeUInt8(): number {\n\t\treturn 1;\n\t}\n\n\tpublic writeUInt8(n: number): void {\n\t\tthis._buff.writeUInt8(n, this._offset); this._offset += 1;\n\t}\n\n\tpublic readUInt8(): number {\n\t\tconst n = this._buff.readUInt8(this._offset); this._offset += 1;\n\t\treturn n;\n\t}\n\n\tpublic writeUInt32(n: number): void {\n\t\tthis._buff.writeUInt32BE(n, this._offset); this._offset += 4;\n\t}\n\n\tpublic readUInt32(): number {\n\t\tconst n = this._buff.readUInt32BE(this._offset); this._offset += 4;\n\t\treturn n;\n\t}\n\n\tpublic static sizeShortString(str: VSBuffer): number {\n\t\treturn 1 /* string length */ + str.byteLength /* actual string */;\n\t}\n\n\tpublic writeShortString(str: VSBuffer): void {\n\t\tthis._buff.writeUInt8(str.byteLength, this._offset); this._offset += 1;\n\t\tthis._buff.set(str, this._offset); this._offset += str.byteLength;\n\t}\n\n\tpublic readShortString(): string {\n\t\tconst strByteLength = this._buff.readUInt8(this._offset); this._offset += 1;\n\t\tconst strBuff = this._buff.slice(this._offset, this._offset + strByteLength);\n\t\tconst str = strBuff.toString(); this._offset += strByteLength;\n\t\treturn str;\n\t}\n\n\tpublic static sizeLongString(str: VSBuffer): number {\n\t\treturn 4 /* string length */ + str.byteLength /* actual string */;\n\t}\n\n\tpublic writeLongString(str: VSBuffer): void {\n\t\tthis._buff.writeUInt32BE(str.byteLength, this._offset); this._offset += 4;\n\t\tthis._buff.set(str, this._offset); this._offset += str.byteLength;\n\t}\n\n\tpublic readLongString(): string {\n\t\tconst strByteLength = this._buff.readUInt32BE(this._offset); this._offset += 4;\n\t\tconst strBuff = this._buff.slice(this._offset, this._offset + strByteLength);\n\t\tconst str = strBuff.toString(); this._offset += strByteLength;\n\t\treturn str;\n\t}\n\n\tpublic writeBuffer(buff: VSBuffer): void {\n\t\tthis._buff.writeUInt32BE(buff.byteLength, this._offset); this._offset += 4;\n\t\tthis._buff.set(buff, this._offset); this._offset += buff.byteLength;\n\t}\n\n\tpublic static sizeVSBuffer(buff: VSBuffer): number {\n\t\treturn 4 /* buffer length */ + buff.byteLength /* actual buffer */;\n\t}\n\n\tpublic writeVSBuffer(buff: VSBuffer): void {\n\t\tthis._buff.writeUInt32BE(buff.byteLength, this._offset); this._offset += 4;\n\t\tthis._buff.set(buff, this._offset); this._offset += buff.byteLength;\n\t}\n\n\tpublic readVSBuffer(): VSBuffer {\n\t\tconst buffLength = this._buff.readUInt32BE(this._offset); this._offset += 4;\n\t\tconst buff = this._buff.slice(this._offset, this._offset + buffLength); this._offset += buffLength;\n\t\treturn buff;\n\t}\n\n\tpublic static sizeMixedArray(arr: VSBuffer[], arrType: ArgType[]): number {\n\t\tlet size = 0;\n\t\tsize += 1; // arr length\n\t\tfor (let i = 0, len = arr.length; i < len; i++) {\n\t\t\tconst el = arr[i];\n\t\t\tconst elType = arrType[i];\n\t\t\tsize += 1; // arg type\n\t\t\tswitch (elType) {\n\t\t\t\tcase ArgType.String:\n\t\t\t\t\tsize += this.sizeLongString(el);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ArgType.VSBuffer:\n\t\t\t\t\tsize += this.sizeVSBuffer(el);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ArgType.Undefined:\n\t\t\t\t\t// empty...\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn size;\n\t}\n\n\tpublic writeMixedArray(arr: VSBuffer[], arrType: ArgType[]): void {\n\t\tthis._buff.writeUInt8(arr.length, this._offset); this._offset += 1;\n\t\tfor (let i = 0, len = arr.length; i < len; i++) {\n\t\t\tconst el = arr[i];\n\t\t\tconst elType = arrType[i];\n\t\t\tswitch (elType) {\n\t\t\t\tcase ArgType.String:\n\t\t\t\t\tthis.writeUInt8(ArgType.String);\n\t\t\t\t\tthis.writeLongString(el);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ArgType.VSBuffer:\n\t\t\t\t\tthis.writeUInt8(ArgType.VSBuffer);\n\t\t\t\t\tthis.writeVSBuffer(el);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ArgType.Undefined:\n\t\t\t\t\tthis.writeUInt8(ArgType.Undefined);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic readMixedArray(): Array<string | VSBuffer | undefined> {\n\t\tconst arrLen = this._buff.readUInt8(this._offset); this._offset += 1;\n\t\tlet arr: Array<string | VSBuffer | undefined> = new Array(arrLen);\n\t\tfor (let i = 0; i < arrLen; i++) {\n\t\t\tconst argType = <ArgType>this.readUInt8();\n\t\t\tswitch (argType) {\n\t\t\t\tcase ArgType.String:\n\t\t\t\t\tarr[i] = this.readLongString();\n\t\t\t\t\tbreak;\n\t\t\t\tcase ArgType.VSBuffer:\n\t\t\t\t\tarr[i] = this.readVSBuffer();\n\t\t\t\t\tbreak;\n\t\t\t\tcase ArgType.Undefined:\n\t\t\t\t\tarr[i] = undefined;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn arr;\n\t}\n}\n\ntype SerializedRequestArguments = { type: 'mixed'; args: VSBuffer[]; argsType: ArgType[]; } | { type: 'simple'; args: string; };\n\nclass MessageIO {\n\n\tprivate static _arrayContainsBufferOrUndefined(arr: any[]): boolean {\n\t\tfor (let i = 0, len = arr.length; i < len; i++) {\n\t\t\tif (arr[i] instanceof VSBuffer) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (typeof arr[i] === 'undefined') {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic static serializeRequestArguments(args: any[], replacer: JSONStringifyReplacer | null): SerializedRequestArguments {\n\t\tif (this._arrayContainsBufferOrUndefined(args)) {\n\t\t\tlet massagedArgs: VSBuffer[] = [];\n\t\t\tlet massagedArgsType: ArgType[] = [];\n\t\t\tfor (let i = 0, len = args.length; i < len; i++) {\n\t\t\t\tconst arg = args[i];\n\t\t\t\tif (arg instanceof VSBuffer) {\n\t\t\t\t\tmassagedArgs[i] = arg;\n\t\t\t\t\tmassagedArgsType[i] = ArgType.VSBuffer;\n\t\t\t\t} else if (typeof arg === 'undefined') {\n\t\t\t\t\tmassagedArgs[i] = VSBuffer.alloc(0);\n\t\t\t\t\tmassagedArgsType[i] = ArgType.Undefined;\n\t\t\t\t} else {\n\t\t\t\t\tmassagedArgs[i] = VSBuffer.fromString(stringify(arg, replacer));\n\t\t\t\t\tmassagedArgsType[i] = ArgType.String;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn {\n\t\t\t\ttype: 'mixed',\n\t\t\t\targs: massagedArgs,\n\t\t\t\targsType: massagedArgsType\n\t\t\t};\n\t\t}\n\t\treturn {\n\t\t\ttype: 'simple',\n\t\t\targs: stringify(args, replacer)\n\t\t};\n\t}\n\n\tpublic static serializeRequest(req: number, rpcId: number, method: string, serializedArgs: SerializedRequestArguments, usesCancellationToken: boolean): VSBuffer {\n\t\tif (serializedArgs.type === 'mixed') {\n\t\t\treturn this._requestMixedArgs(req, rpcId, method, serializedArgs.args, serializedArgs.argsType, usesCancellationToken);\n\t\t}\n\t\treturn this._requestJSONArgs(req, rpcId, method, serializedArgs.args, usesCancellationToken);\n\t}\n\n\tprivate static _requestJSONArgs(req: number, rpcId: number, method: string, args: string, usesCancellationToken: boolean): VSBuffer {\n\t\tconst methodBuff = VSBuffer.fromString(method);\n\t\tconst argsBuff = VSBuffer.fromString(args);\n\n\t\tlet len = 0;\n\t\tlen += MessageBuffer.sizeUInt8();\n\t\tlen += MessageBuffer.sizeShortString(methodBuff);\n\t\tlen += MessageBuffer.sizeLongString(argsBuff);\n\n\t\tlet result = MessageBuffer.alloc(usesCancellationToken ? MessageType.RequestJSONArgsWithCancellation : MessageType.RequestJSONArgs, req, len);\n\t\tresult.writeUInt8(rpcId);\n\t\tresult.writeShortString(methodBuff);\n\t\tresult.writeLongString(argsBuff);\n\t\treturn result.buffer;\n\t}\n\n\tpublic static deserializeRequestJSONArgs(buff: MessageBuffer): { rpcId: number; method: string; args: any[]; } {\n\t\tconst rpcId = buff.readUInt8();\n\t\tconst method = buff.readShortString();\n\t\tconst args = buff.readLongString();\n\t\treturn {\n\t\t\trpcId: rpcId,\n\t\t\tmethod: method,\n\t\t\targs: JSON.parse(args)\n\t\t};\n\t}\n\n\tprivate static _requestMixedArgs(req: number, rpcId: number, method: string, args: VSBuffer[], argsType: ArgType[], usesCancellationToken: boolean): VSBuffer {\n\t\tconst methodBuff = VSBuffer.fromString(method);\n\n\t\tlet len = 0;\n\t\tlen += MessageBuffer.sizeUInt8();\n\t\tlen += MessageBuffer.sizeShortString(methodBuff);\n\t\tlen += MessageBuffer.sizeMixedArray(args, argsType);\n\n\t\tlet result = MessageBuffer.alloc(usesCancellationToken ? MessageType.RequestMixedArgsWithCancellation : MessageType.RequestMixedArgs, req, len);\n\t\tresult.writeUInt8(rpcId);\n\t\tresult.writeShortString(methodBuff);\n\t\tresult.writeMixedArray(args, argsType);\n\t\treturn result.buffer;\n\t}\n\n\tpublic static deserializeRequestMixedArgs(buff: MessageBuffer): { rpcId: number; method: string; args: any[]; } {\n\t\tconst rpcId = buff.readUInt8();\n\t\tconst method = buff.readShortString();\n\t\tconst rawargs = buff.readMixedArray();\n\t\tconst args: any[] = new Array(rawargs.length);\n\t\tfor (let i = 0, len = rawargs.length; i < len; i++) {\n\t\t\tconst rawarg = rawargs[i];\n\t\t\tif (typeof rawarg === 'string') {\n\t\t\t\targs[i] = JSON.parse(rawarg);\n\t\t\t} else {\n\t\t\t\targs[i] = rawarg;\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\trpcId: rpcId,\n\t\t\tmethod: method,\n\t\t\targs: args\n\t\t};\n\t}\n\n\tpublic static serializeAcknowledged(req: number): VSBuffer {\n\t\treturn MessageBuffer.alloc(MessageType.Acknowledged, req, 0).buffer;\n\t}\n\n\tpublic static serializeCancel(req: number): VSBuffer {\n\t\treturn MessageBuffer.alloc(MessageType.Cancel, req, 0).buffer;\n\t}\n\n\tpublic static serializeReplyOK(req: number, res: any, replacer: JSONStringifyReplacer | null): VSBuffer {\n\t\tif (typeof res === 'undefined') {\n\t\t\treturn this._serializeReplyOKEmpty(req);\n\t\t}\n\t\tif (res instanceof VSBuffer) {\n\t\t\treturn this._serializeReplyOKVSBuffer(req, res);\n\t\t}\n\t\treturn this._serializeReplyOKJSON(req, safeStringify(res, replacer));\n\t}\n\n\tprivate static _serializeReplyOKEmpty(req: number): VSBuffer {\n\t\treturn MessageBuffer.alloc(MessageType.ReplyOKEmpty, req, 0).buffer;\n\t}\n\n\tprivate static _serializeReplyOKVSBuffer(req: number, res: VSBuffer): VSBuffer {\n\t\tlet len = 0;\n\t\tlen += MessageBuffer.sizeVSBuffer(res);\n\n\t\tlet result = MessageBuffer.alloc(MessageType.ReplyOKVSBuffer, req, len);\n\t\tresult.writeVSBuffer(res);\n\t\treturn result.buffer;\n\t}\n\n\tpublic static deserializeReplyOKVSBuffer(buff: MessageBuffer): VSBuffer {\n\t\treturn buff.readVSBuffer();\n\t}\n\n\tprivate static _serializeReplyOKJSON(req: number, res: string): VSBuffer {\n\t\tconst resBuff = VSBuffer.fromString(res);\n\n\t\tlet len = 0;\n\t\tlen += MessageBuffer.sizeLongString(resBuff);\n\n\t\tlet result = MessageBuffer.alloc(MessageType.ReplyOKJSON, req, len);\n\t\tresult.writeLongString(resBuff);\n\t\treturn result.buffer;\n\t}\n\n\tpublic static deserializeReplyOKJSON(buff: MessageBuffer): any {\n\t\tconst res = buff.readLongString();\n\t\treturn JSON.parse(res);\n\t}\n\n\tpublic static serializeReplyErr(req: number, err: any): VSBuffer {\n\t\tif (err) {\n\t\t\treturn this._serializeReplyErrEror(req, err);\n\t\t}\n\t\treturn this._serializeReplyErrEmpty(req);\n\t}\n\n\tprivate static _serializeReplyErrEror(req: number, _err: Error): VSBuffer {\n\t\tconst errBuff = VSBuffer.fromString(safeStringify(errors.transformErrorForSerialization(_err), null));\n\n\t\tlet len = 0;\n\t\tlen += MessageBuffer.sizeLongString(errBuff);\n\n\t\tlet result = MessageBuffer.alloc(MessageType.ReplyErrError, req, len);\n\t\tresult.writeLongString(errBuff);\n\t\treturn result.buffer;\n\t}\n\n\tpublic static deserializeReplyErrError(buff: MessageBuffer): Error {\n\t\tconst err = buff.readLongString();\n\t\treturn JSON.parse(err);\n\t}\n\n\tprivate static _serializeReplyErrEmpty(req: number): VSBuffer {\n\t\treturn MessageBuffer.alloc(MessageType.ReplyErrEmpty, req, 0).buffer;\n\t}\n}\n\nconst enum MessageType {\n\tRequestJSONArgs = 1,\n\tRequestJSONArgsWithCancellation = 2,\n\tRequestMixedArgs = 3,\n\tRequestMixedArgsWithCancellation = 4,\n\tAcknowledged = 5,\n\tCancel = 6,\n\tReplyOKEmpty = 7,\n\tReplyOKVSBuffer = 8,\n\tReplyOKJSON = 9,\n\tReplyErrError = 10,\n\tReplyErrEmpty = 11,\n}\n\nconst enum ArgType {\n\tString = 1,\n\tVSBuffer = 2,\n\tUndefined = 3\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { createRotatingLogger } from 'vs/platform/log/node/spdlogService';\nimport { RotatingLogger } from 'spdlog';\nimport { ByteSize } from 'vs/platform/files/common/files';\n\nexport class OutputAppender {\n\n\tprivate appender: RotatingLogger;\n\n\tconstructor(name: string, readonly file: string) {\n\t\tthis.appender = createRotatingLogger(name, file, 30 * ByteSize.MB, 1);\n\t\tthis.appender.clearFormatters();\n\t}\n\n\tappend(content: string): void {\n\t\tthis.appender.critical(content);\n\t}\n\n\tflush(): void {\n\t\tthis.appender.flush();\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { MainThreadOutputServiceShape } from '../common/extHost.protocol';\nimport type * as vscode from 'vscode';\nimport { URI } from 'vs/base/common/uri';\nimport { join } from 'vs/base/common/path';\nimport { OutputAppender } from 'vs/workbench/services/output/node/outputAppender';\nimport { toLocalISOString } from 'vs/base/common/date';\nimport { dirExists, mkdirp } from 'vs/base/node/pfs';\nimport { AbstractExtHostOutputChannel, ExtHostPushOutputChannel, ExtHostOutputService, LazyOutputChannel } from 'vs/workbench/api/common/extHostOutput';\nimport { IExtHostInitDataService } from 'vs/workbench/api/common/extHostInitDataService';\nimport { IExtHostRpcService } from 'vs/workbench/api/common/extHostRpcService';\nimport { MutableDisposable } from 'vs/base/common/lifecycle';\nimport { ILogService } from 'vs/platform/log/common/log';\n\nexport class ExtHostOutputChannelBackedByFile extends AbstractExtHostOutputChannel {\n\n\tprivate _appender: OutputAppender;\n\n\tconstructor(name: string, appender: OutputAppender, proxy: MainThreadOutputServiceShape) {\n\t\tsuper(name, false, URI.file(appender.file), proxy);\n\t\tthis._appender = appender;\n\t}\n\n\tappend(value: string): void {\n\t\tsuper.append(value);\n\t\tthis._appender.append(value);\n\t\tthis._onDidAppend.fire();\n\t}\n\n\tupdate(): void {\n\t\tthis._appender.flush();\n\t\tsuper.update();\n\t}\n\n\tshow(columnOrPreserveFocus?: vscode.ViewColumn | boolean, preserveFocus?: boolean): void {\n\t\tthis._appender.flush();\n\t\tsuper.show(columnOrPreserveFocus, preserveFocus);\n\t}\n\n\tclear(): void {\n\t\tthis._appender.flush();\n\t\tsuper.clear();\n\t}\n}\n\nexport class ExtHostOutputService2 extends ExtHostOutputService {\n\n\tprivate _logsLocation: URI;\n\tprivate _namePool: number = 1;\n\tprivate readonly _channels: Map<string, AbstractExtHostOutputChannel> = new Map<string, AbstractExtHostOutputChannel>();\n\tprivate readonly _visibleChannelDisposable = new MutableDisposable();\n\n\tconstructor(\n\t\t@IExtHostRpcService extHostRpc: IExtHostRpcService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IExtHostInitDataService initData: IExtHostInitDataService,\n\t) {\n\t\tsuper(extHostRpc);\n\t\tthis._logsLocation = initData.logsLocation;\n\t}\n\n\t$setVisibleChannel(channelId: string): void {\n\t\tif (channelId) {\n\t\t\tconst channel = this._channels.get(channelId);\n\t\t\tif (channel) {\n\t\t\t\tthis._visibleChannelDisposable.value = channel.onDidAppend(() => channel.update());\n\t\t\t}\n\t\t}\n\t}\n\n\tcreateOutputChannel(name: string): vscode.OutputChannel {\n\t\tname = name.trim();\n\t\tif (!name) {\n\t\t\tthrow new Error('illegal argument `name`. must not be falsy');\n\t\t}\n\t\tconst extHostOutputChannel = this._doCreateOutChannel(name);\n\t\textHostOutputChannel.then(channel => channel._id.then(id => this._channels.set(id, channel)));\n\t\treturn new LazyOutputChannel(name, extHostOutputChannel);\n\t}\n\n\tprivate async _doCreateOutChannel(name: string): Promise<AbstractExtHostOutputChannel> {\n\t\ttry {\n\t\t\tconst outputDirPath = join(this._logsLocation.fsPath, `output_logging_${toLocalISOString(new Date()).replace(/-|:|\\.\\d+Z$/g, '')}`);\n\t\t\tconst exists = await dirExists(outputDirPath);\n\t\t\tif (!exists) {\n\t\t\t\tawait mkdirp(outputDirPath);\n\t\t\t}\n\t\t\tconst fileName = `${this._namePool++}-${name.replace(/[\\\\/:\\*\\?\"<>\\|]/g, '')}`;\n\t\t\tconst file = URI.file(join(outputDirPath, `${fileName}.log`));\n\t\t\tconst appender = new OutputAppender(fileName, file.fsPath);\n\t\t\treturn new ExtHostOutputChannelBackedByFile(name, appender, this._proxy);\n\t\t} catch (error) {\n\t\t\t// Do not crash if logger cannot be created\n\t\t\tthis.logService.error(error);\n\t\t\treturn new ExtHostPushOutputChannel(name, this._proxy);\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { RemoteAgentConnectionContext, IRemoteAgentEnvironment } from 'vs/platform/remote/common/remoteAgentEnvironment';\nimport { IChannel, IServerChannel } from 'vs/base/parts/ipc/common/ipc';\nimport { IDiagnosticInfoOptions, IDiagnosticInfo } from 'vs/platform/diagnostics/common/diagnostics';\nimport { Event } from 'vs/base/common/event';\nimport { PersistentConnectionEvent, ISocketFactory } from 'vs/platform/remote/common/remoteAgentConnection';\nimport { ITelemetryData } from 'vs/platform/telemetry/common/telemetry';\nimport { ExtensionIdentifier, IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { URI } from 'vs/base/common/uri';\n\nexport const RemoteExtensionLogFileName = 'remoteagent';\n\nexport const IRemoteAgentService = createDecorator<IRemoteAgentService>('remoteAgentService');\n\nexport interface IRemoteAgentService {\n\treadonly _serviceBrand: undefined;\n\n\treadonly socketFactory: ISocketFactory;\n\n\tgetConnection(): IRemoteAgentConnection | null;\n\t/**\n\t * Get the remote environment. In case of an error, returns `null`.\n\t */\n\tgetEnvironment(): Promise<IRemoteAgentEnvironment | null>;\n\t/**\n\t * Get the remote environment. Can return an error.\n\t */\n\tgetRawEnvironment(): Promise<IRemoteAgentEnvironment | null>;\n\n\twhenExtensionsReady(): Promise<void>;\n\t/**\n\t * Scan remote extensions.\n\t */\n\tscanExtensions(skipExtensions?: ExtensionIdentifier[]): Promise<IExtensionDescription[]>;\n\t/**\n\t * Scan a single remote extension.\n\t */\n\tscanSingleExtension(extensionLocation: URI, isBuiltin: boolean): Promise<IExtensionDescription | null>;\n\tgetDiagnosticInfo(options: IDiagnosticInfoOptions): Promise<IDiagnosticInfo | undefined>;\n\tdisableTelemetry(): Promise<void>;\n\tlogTelemetry(eventName: string, data?: ITelemetryData): Promise<void>;\n\tflushTelemetry(): Promise<void>;\n}\n\nexport interface IRemoteAgentConnection {\n\treadonly remoteAuthority: string;\n\n\treadonly onReconnecting: Event<void>;\n\treadonly onDidStateChange: Event<PersistentConnectionEvent>;\n\n\tgetChannel<T extends IChannel>(channelName: string): T;\n\twithChannel<T extends IChannel, R>(channelName: string, callback: (channel: T) => Promise<R>): Promise<R>;\n\tregisterChannel<T extends IServerChannel<RemoteAgentConnectionContext>>(channelName: string, channel: T): void;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Schemas } from 'vs/base/common/network';\nimport { IPath, win32, posix } from 'vs/base/common/path';\nimport { OperatingSystem, OS } from 'vs/base/common/platform';\nimport { URI } from 'vs/base/common/uri';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { IRemoteAgentService } from 'vs/workbench/services/remote/common/remoteAgentService';\n\nexport const IPathService = createDecorator<IPathService>('pathService');\n\n/**\n * Provides access to path related properties that will match the\n * environment. If the environment is connected to a remote, the\n * path properties will match that of the remotes operating system.\n */\nexport interface IPathService {\n\n\treadonly _serviceBrand: undefined;\n\n\t/**\n\t * The correct path library to use for the target environment. If\n\t * the environment is connected to a remote, this will be the\n\t * path library of the remote file system. Otherwise it will be\n\t * the local file system's path library depending on the OS.\n\t */\n\treadonly path: Promise<IPath>;\n\n\t/**\n\t * Determines the best default URI scheme for the current workspace.\n\t * It uses information about whether we're running remote, in browser,\n\t * or native combined with information about the current workspace to\n\t * find the best default scheme.\n\t */\n\treadonly defaultUriScheme: string;\n\n\t/**\n\t * Converts the given path to a file URI to use for the target\n\t * environment. If the environment is connected to a remote, it\n\t * will use the path separators according to the remote file\n\t * system. Otherwise it will use the local file system's path\n\t * separators.\n\t */\n\tfileURI(path: string): Promise<URI>;\n\n\t/**\n\t * Resolves the user-home directory for the target environment.\n\t * If the envrionment is connected to a remote, this will be the\n\t * remote's user home directory, otherwise the local one unless\n\t * `preferLocal` is set to `true`.\n\t */\n\tuserHome(options?: { preferLocal: boolean }): Promise<URI>;\n\n\t/**\n\t * @deprecated use `userHome` instead.\n\t */\n\treadonly resolvedUserHome: URI | undefined;\n}\n\nexport abstract class AbstractPathService implements IPathService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate resolveOS: Promise<OperatingSystem>;\n\n\tprivate resolveUserHome: Promise<URI>;\n\tprivate maybeUnresolvedUserHome: URI | undefined;\n\n\tabstract readonly defaultUriScheme: string;\n\n\tconstructor(\n\t\tprivate localUserHome: URI,\n\t\t@IRemoteAgentService private readonly remoteAgentService: IRemoteAgentService\n\t) {\n\n\t\t// OS\n\t\tthis.resolveOS = (async () => {\n\t\t\tconst env = await this.remoteAgentService.getEnvironment();\n\n\t\t\treturn env?.os || OS;\n\t\t})();\n\n\t\t// User Home\n\t\tthis.resolveUserHome = (async () => {\n\t\t\tconst env = await this.remoteAgentService.getEnvironment();\n\t\t\tconst userHome = this.maybeUnresolvedUserHome = env?.userHome || localUserHome;\n\n\n\t\t\treturn userHome;\n\t\t})();\n\t}\n\n\tasync userHome(options?: { preferLocal: boolean }): Promise<URI> {\n\t\treturn options?.preferLocal ? this.localUserHome : this.resolveUserHome;\n\t}\n\n\tget resolvedUserHome(): URI | undefined {\n\t\treturn this.maybeUnresolvedUserHome;\n\t}\n\n\tget path(): Promise<IPath> {\n\t\treturn this.resolveOS.then(os => {\n\t\t\treturn os === OperatingSystem.Windows ?\n\t\t\t\twin32 :\n\t\t\t\tposix;\n\t\t});\n\t}\n\n\tasync fileURI(_path: string): Promise<URI> {\n\t\tlet authority = '';\n\n\t\t// normalize to fwd-slashes on windows,\n\t\t// on other systems bwd-slashes are valid\n\t\t// filename character, eg /f\\oo/ba\\r.txt\n\t\tconst os = await this.resolveOS;\n\t\tif (os === OperatingSystem.Windows) {\n\t\t\t_path = _path.replace(/\\\\/g, '/');\n\t\t}\n\n\t\t// check for authority as used in UNC shares\n\t\t// or use the path as given\n\t\tif (_path[0] === '/' && _path[1] === '/') {\n\t\t\tconst idx = _path.indexOf('/', 2);\n\t\t\tif (idx === -1) {\n\t\t\t\tauthority = _path.substring(2);\n\t\t\t\t_path = '/';\n\t\t\t} else {\n\t\t\t\tauthority = _path.substring(2, idx);\n\t\t\t\t_path = _path.substring(idx) || '/';\n\t\t\t}\n\t\t}\n\n\t\treturn URI.from({\n\t\t\tscheme: Schemas.file,\n\t\t\tauthority,\n\t\t\tpath: _path,\n\t\t\tquery: '',\n\t\t\tfragment: ''\n\t\t});\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { mapArrayOrNot } from 'vs/base/common/arrays';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport * as glob from 'vs/base/common/glob';\nimport { IDisposable } from 'vs/base/common/lifecycle';\nimport * as objects from 'vs/base/common/objects';\nimport * as extpath from 'vs/base/common/extpath';\nimport { fuzzyContains, getNLines } from 'vs/base/common/strings';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { IFilesConfiguration } from 'vs/platform/files/common/files';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { ITelemetryData } from 'vs/platform/telemetry/common/telemetry';\nimport { Event } from 'vs/base/common/event';\nimport * as paths from 'vs/base/common/path';\nimport { isPromiseCanceledError } from 'vs/base/common/errors';\n\nexport const VIEWLET_ID = 'workbench.view.search';\nexport const PANEL_ID = 'workbench.panel.search';\nexport const VIEW_ID = 'workbench.view.search';\n\nexport const SEARCH_EXCLUDE_CONFIG = 'search.exclude';\n\n// Warning: this pattern is used in the search editor to detect offsets. If you\n// change this, also change the search-result built-in extension\nconst SEARCH_ELIDED_PREFIX = '⟪ ';\nconst SEARCH_ELIDED_SUFFIX = ' characters skipped ⟫';\nconst SEARCH_ELIDED_MIN_LEN = (SEARCH_ELIDED_PREFIX.length + SEARCH_ELIDED_SUFFIX.length + 5) * 2;\n\nexport const ISearchService = createDecorator<ISearchService>('searchService');\n\n/**\n * A service that enables to search for files or with in files.\n */\nexport interface ISearchService {\n\treadonly _serviceBrand: undefined;\n\ttextSearch(query: ITextQuery, token?: CancellationToken, onProgress?: (result: ISearchProgressItem) => void): Promise<ISearchComplete>;\n\tfileSearch(query: IFileQuery, token?: CancellationToken): Promise<ISearchComplete>;\n\tclearCache(cacheKey: string): Promise<void>;\n\tregisterSearchResultProvider(scheme: string, type: SearchProviderType, provider: ISearchResultProvider): IDisposable;\n}\n\n/**\n * TODO@roblou - split text from file search entirely, or share code in a more natural way.\n */\nexport const enum SearchProviderType {\n\tfile,\n\ttext\n}\n\nexport interface ISearchResultProvider {\n\ttextSearch(query: ITextQuery, onProgress?: (p: ISearchProgressItem) => void, token?: CancellationToken): Promise<ISearchComplete>;\n\tfileSearch(query: IFileQuery, token?: CancellationToken): Promise<ISearchComplete>;\n\tclearCache(cacheKey: string): Promise<void>;\n}\n\nexport interface IFolderQuery<U extends UriComponents = URI> {\n\tfolder: U;\n\tfolderName?: string;\n\texcludePattern?: glob.IExpression;\n\tincludePattern?: glob.IExpression;\n\tfileEncoding?: string;\n\tdisregardIgnoreFiles?: boolean;\n\tdisregardGlobalIgnoreFiles?: boolean;\n\tignoreSymlinks?: boolean;\n}\n\nexport interface ICommonQueryProps<U extends UriComponents> {\n\t/** For telemetry - indicates what is triggering the source */\n\t_reason?: string;\n\n\tfolderQueries: IFolderQuery<U>[];\n\tincludePattern?: glob.IExpression;\n\texcludePattern?: glob.IExpression;\n\textraFileResources?: U[];\n\n\tonlyOpenEditors?: boolean;\n\n\tmaxResults?: number;\n\tusingSearchPaths?: boolean;\n}\n\nexport interface IFileQueryProps<U extends UriComponents> extends ICommonQueryProps<U> {\n\ttype: QueryType.File;\n\tfilePattern?: string;\n\n\t/**\n\t * If true no results will be returned. Instead `limitHit` will indicate if at least one result exists or not.\n\t * Currently does not work with queries including a 'siblings clause'.\n\t */\n\texists?: boolean;\n\tsortByScore?: boolean;\n\tcacheKey?: string;\n}\n\nexport interface ITextQueryProps<U extends UriComponents> extends ICommonQueryProps<U> {\n\ttype: QueryType.Text;\n\tcontentPattern: IPatternInfo;\n\n\tpreviewOptions?: ITextSearchPreviewOptions;\n\tmaxFileSize?: number;\n\tusePCRE2?: boolean;\n\tafterContext?: number;\n\tbeforeContext?: number;\n\n\tuserDisabledExcludesAndIgnoreFiles?: boolean;\n}\n\nexport type IFileQuery = IFileQueryProps<URI>;\nexport type IRawFileQuery = IFileQueryProps<UriComponents>;\nexport type ITextQuery = ITextQueryProps<URI>;\nexport type IRawTextQuery = ITextQueryProps<UriComponents>;\n\nexport type IRawQuery = IRawTextQuery | IRawFileQuery;\nexport type ISearchQuery = ITextQuery | IFileQuery;\n\nexport const enum QueryType {\n\tFile = 1,\n\tText = 2\n}\n\n/* __GDPR__FRAGMENT__\n\t\"IPatternInfo\" : {\n\t\t\"pattern\" : { \"classification\": \"CustomerContent\", \"purpose\": \"FeatureInsight\" },\n\t\t\"isRegExp\": { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\", \"isMeasurement\": true },\n\t\t\"isWordMatch\": { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\", \"isMeasurement\": true },\n\t\t\"wordSeparators\": { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\" },\n\t\t\"isMultiline\": { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\", \"isMeasurement\": true },\n\t\t\"isCaseSensitive\": { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\", \"isMeasurement\": true },\n\t\t\"isSmartCase\": { \"classification\": \"SystemMetaData\", \"purpose\": \"FeatureInsight\", \"isMeasurement\": true }\n\t}\n*/\nexport interface IPatternInfo {\n\tpattern: string;\n\tisRegExp?: boolean;\n\tisWordMatch?: boolean;\n\twordSeparators?: string;\n\tisMultiline?: boolean;\n\tisUnicode?: boolean;\n\tisCaseSensitive?: boolean;\n}\n\nexport interface IExtendedExtensionSearchOptions {\n\tusePCRE2?: boolean;\n}\n\nexport interface IFileMatch<U extends UriComponents = URI> {\n\tresource: U;\n\tresults?: ITextSearchResult[];\n}\n\nexport type IRawFileMatch2 = IFileMatch<UriComponents>;\n\nexport interface ITextSearchPreviewOptions {\n\tmatchLines: number;\n\tcharsPerLine: number;\n}\n\nexport interface ISearchRange {\n\treadonly startLineNumber: number;\n\treadonly startColumn: number;\n\treadonly endLineNumber: number;\n\treadonly endColumn: number;\n}\n\nexport interface ITextSearchResultPreview {\n\ttext: string;\n\tmatches: ISearchRange | ISearchRange[];\n}\n\nexport interface ITextSearchMatch {\n\turi?: URI;\n\tranges: ISearchRange | ISearchRange[];\n\tpreview: ITextSearchResultPreview;\n}\n\nexport interface ITextSearchContext {\n\turi?: URI;\n\ttext: string;\n\tlineNumber: number;\n}\n\nexport type ITextSearchResult = ITextSearchMatch | ITextSearchContext;\n\nexport function resultIsMatch(result: ITextSearchResult): result is ITextSearchMatch {\n\treturn !!(<ITextSearchMatch>result).preview;\n}\n\nexport interface IProgressMessage {\n\tmessage: string;\n}\n\nexport type ISearchProgressItem = IFileMatch | IProgressMessage;\n\nexport function isFileMatch(p: ISearchProgressItem): p is IFileMatch {\n\treturn !!(<IFileMatch>p).resource;\n}\n\nexport function isProgressMessage(p: ISearchProgressItem | ISerializedSearchProgressItem): p is IProgressMessage {\n\treturn !!(p as IProgressMessage).message;\n}\n\nexport interface ISearchCompleteStats {\n\tlimitHit?: boolean;\n\tstats?: IFileSearchStats | ITextSearchStats;\n}\n\nexport interface ISearchComplete extends ISearchCompleteStats {\n\tresults: IFileMatch[];\n\texit?: SearchCompletionExitCode\n}\n\nexport const enum SearchCompletionExitCode {\n\tNormal,\n\tNewSearchStarted\n}\n\nexport interface ITextSearchStats {\n\ttype: 'textSearchProvider' | 'searchProcess';\n}\n\nexport interface IFileSearchStats {\n\tfromCache: boolean;\n\tdetailStats: ISearchEngineStats | ICachedSearchStats | IFileSearchProviderStats;\n\n\tresultCount: number;\n\ttype: 'fileSearchProvider' | 'searchProcess';\n\tsortingTime?: number;\n}\n\nexport interface ICachedSearchStats {\n\tcacheWasResolved: boolean;\n\tcacheLookupTime: number;\n\tcacheFilterTime: number;\n\tcacheEntryCount: number;\n}\n\nexport interface ISearchEngineStats {\n\tfileWalkTime: number;\n\tdirectoriesWalked: number;\n\tfilesWalked: number;\n\tcmdTime: number;\n\tcmdResultCount?: number;\n}\n\nexport interface IFileSearchProviderStats {\n\tproviderTime: number;\n\tpostProcessTime: number;\n}\n\nexport class FileMatch implements IFileMatch {\n\tresults: ITextSearchResult[] = [];\n\tconstructor(public resource: URI) {\n\t\t// empty\n\t}\n}\n\nexport class TextSearchMatch implements ITextSearchMatch {\n\tranges: ISearchRange | ISearchRange[];\n\tpreview: ITextSearchResultPreview;\n\n\tconstructor(text: string, range: ISearchRange | ISearchRange[], previewOptions?: ITextSearchPreviewOptions) {\n\t\tthis.ranges = range;\n\n\t\t// Trim preview if this is one match and a single-line match with a preview requested.\n\t\t// Otherwise send the full text, like for replace or for showing multiple previews.\n\t\t// TODO this is fishy.\n\t\tconst ranges = Array.isArray(range) ? range : [range];\n\t\tif (previewOptions && previewOptions.matchLines === 1 && isSingleLineRangeList(ranges)) {\n\t\t\t// 1 line preview requested\n\t\t\ttext = getNLines(text, previewOptions.matchLines);\n\n\t\t\tlet result = '';\n\t\t\tlet shift = 0;\n\t\t\tlet lastEnd = 0;\n\t\t\tconst leadingChars = Math.floor(previewOptions.charsPerLine / 5);\n\t\t\tconst matches: ISearchRange[] = [];\n\t\t\tfor (const range of ranges) {\n\t\t\t\tconst previewStart = Math.max(range.startColumn - leadingChars, 0);\n\t\t\t\tconst previewEnd = range.startColumn + previewOptions.charsPerLine;\n\t\t\t\tif (previewStart > lastEnd + leadingChars + SEARCH_ELIDED_MIN_LEN) {\n\t\t\t\t\tconst elision = SEARCH_ELIDED_PREFIX + (previewStart - lastEnd) + SEARCH_ELIDED_SUFFIX;\n\t\t\t\t\tresult += elision + text.slice(previewStart, previewEnd);\n\t\t\t\t\tshift += previewStart - (lastEnd + elision.length);\n\t\t\t\t} else {\n\t\t\t\t\tresult += text.slice(lastEnd, previewEnd);\n\t\t\t\t}\n\n\t\t\t\tmatches.push(new OneLineRange(0, range.startColumn - shift, range.endColumn - shift));\n\t\t\t\tlastEnd = previewEnd;\n\t\t\t}\n\n\t\t\tthis.preview = { text: result, matches: Array.isArray(this.ranges) ? matches : matches[0] };\n\t\t} else {\n\t\t\tconst firstMatchLine = Array.isArray(range) ? range[0].startLineNumber : range.startLineNumber;\n\n\t\t\tthis.preview = {\n\t\t\t\ttext,\n\t\t\t\tmatches: mapArrayOrNot(range, r => new SearchRange(r.startLineNumber - firstMatchLine, r.startColumn, r.endLineNumber - firstMatchLine, r.endColumn))\n\t\t\t};\n\t\t}\n\t}\n}\n\nfunction isSingleLineRangeList(ranges: ISearchRange[]): boolean {\n\tconst line = ranges[0].startLineNumber;\n\tfor (const r of ranges) {\n\t\tif (r.startLineNumber !== line || r.endLineNumber !== line) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}\n\nexport class SearchRange implements ISearchRange {\n\tstartLineNumber: number;\n\tstartColumn: number;\n\tendLineNumber: number;\n\tendColumn: number;\n\n\tconstructor(startLineNumber: number, startColumn: number, endLineNumber: number, endColumn: number) {\n\t\tthis.startLineNumber = startLineNumber;\n\t\tthis.startColumn = startColumn;\n\t\tthis.endLineNumber = endLineNumber;\n\t\tthis.endColumn = endColumn;\n\t}\n}\n\nexport class OneLineRange extends SearchRange {\n\tconstructor(lineNumber: number, startColumn: number, endColumn: number) {\n\t\tsuper(lineNumber, startColumn, lineNumber, endColumn);\n\t}\n}\n\nexport const enum SearchSortOrder {\n\tDefault = 'default',\n\tFileNames = 'fileNames',\n\tType = 'type',\n\tModified = 'modified',\n\tCountDescending = 'countDescending',\n\tCountAscending = 'countAscending'\n}\n\nexport interface ISearchConfigurationProperties {\n\texclude: glob.IExpression;\n\tuseRipgrep: boolean;\n\t/**\n\t * Use ignore file for file search.\n\t */\n\tuseIgnoreFiles: boolean;\n\tuseGlobalIgnoreFiles: boolean;\n\tfollowSymlinks: boolean;\n\tsmartCase: boolean;\n\tglobalFindClipboard: boolean;\n\tlocation: 'sidebar' | 'panel';\n\tuseReplacePreview: boolean;\n\tshowLineNumbers: boolean;\n\tusePCRE2: boolean;\n\tactionsPosition: 'auto' | 'right';\n\tmaintainFileSearchCache: boolean;\n\tcollapseResults: 'auto' | 'alwaysCollapse' | 'alwaysExpand';\n\tsearchOnType: boolean;\n\tseedOnFocus: boolean;\n\tseedWithNearestWord: boolean;\n\tsearchOnTypeDebouncePeriod: number;\n\tmode: 'view' | 'reuseEditor' | 'newEditor';\n\tsearchEditor: {\n\t\tdoubleClickBehaviour: 'selectWord' | 'goToLocation' | 'openLocationToSide',\n\t\treusePriorSearchConfiguration: boolean,\n\t\tdefaultNumberOfContextLines: number | null,\n\t\texperimental: {}\n\t};\n\texperimental: {\n\t\tsearchInOpenEditors: boolean\n\t}\n\tsortOrder: SearchSortOrder;\n}\n\nexport interface ISearchConfiguration extends IFilesConfiguration {\n\tsearch: ISearchConfigurationProperties;\n\teditor: {\n\t\twordSeparators: string;\n\t};\n}\n\nexport function getExcludes(configuration: ISearchConfiguration, includeSearchExcludes = true): glob.IExpression | undefined {\n\tconst fileExcludes = configuration && configuration.files && configuration.files.exclude;\n\tconst searchExcludes = includeSearchExcludes && configuration && configuration.search && configuration.search.exclude;\n\n\tif (!fileExcludes && !searchExcludes) {\n\t\treturn undefined;\n\t}\n\n\tif (!fileExcludes || !searchExcludes) {\n\t\treturn fileExcludes || searchExcludes;\n\t}\n\n\tlet allExcludes: glob.IExpression = Object.create(null);\n\t// clone the config as it could be frozen\n\tallExcludes = objects.mixin(allExcludes, objects.deepClone(fileExcludes));\n\tallExcludes = objects.mixin(allExcludes, objects.deepClone(searchExcludes), true);\n\n\treturn allExcludes;\n}\n\nexport function pathIncludedInQuery(queryProps: ICommonQueryProps<URI>, fsPath: string): boolean {\n\tif (queryProps.excludePattern && glob.match(queryProps.excludePattern, fsPath)) {\n\t\treturn false;\n\t}\n\n\tif (queryProps.includePattern || queryProps.usingSearchPaths) {\n\t\tif (queryProps.includePattern && glob.match(queryProps.includePattern, fsPath)) {\n\t\t\treturn true;\n\t\t}\n\n\t\t// If searchPaths are being used, the extra file must be in a subfolder and match the pattern, if present\n\t\tif (queryProps.usingSearchPaths) {\n\t\t\treturn !!queryProps.folderQueries && queryProps.folderQueries.some(fq => {\n\t\t\t\tconst searchPath = fq.folder.fsPath;\n\t\t\t\tif (extpath.isEqualOrParent(fsPath, searchPath)) {\n\t\t\t\t\tconst relPath = paths.relative(searchPath, fsPath);\n\t\t\t\t\treturn !fq.includePattern || !!glob.match(fq.includePattern, relPath);\n\t\t\t\t} else {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\nexport enum SearchErrorCode {\n\tunknownEncoding = 1,\n\tregexParseError,\n\tglobParseError,\n\tinvalidLiteral,\n\trgProcessError,\n\tother,\n\tcanceled\n}\n\nexport class SearchError extends Error {\n\tconstructor(message: string, readonly code?: SearchErrorCode) {\n\t\tsuper(message);\n\t}\n}\n\nexport function deserializeSearchError(error: Error): SearchError {\n\tconst errorMsg = error.message;\n\n\tif (isPromiseCanceledError(error)) {\n\t\treturn new SearchError(errorMsg, SearchErrorCode.canceled);\n\t}\n\n\ttry {\n\t\tconst details = JSON.parse(errorMsg);\n\t\treturn new SearchError(details.message, details.code);\n\t} catch (e) {\n\t\treturn new SearchError(errorMsg, SearchErrorCode.other);\n\t}\n}\n\nexport function serializeSearchError(searchError: SearchError): Error {\n\tconst details = { message: searchError.message, code: searchError.code };\n\treturn new Error(JSON.stringify(details));\n}\nexport interface ITelemetryEvent {\n\teventName: string;\n\tdata: ITelemetryData;\n}\n\nexport interface IRawSearchService {\n\tfileSearch(search: IRawFileQuery): Event<ISerializedSearchProgressItem | ISerializedSearchComplete>;\n\ttextSearch(search: IRawTextQuery): Event<ISerializedSearchProgressItem | ISerializedSearchComplete>;\n\tclearCache(cacheKey: string): Promise<void>;\n}\n\nexport interface IRawFileMatch {\n\tbase?: string;\n\t/**\n\t * The path of the file relative to the containing `base` folder.\n\t * This path is exactly as it appears on the filesystem.\n\t */\n\trelativePath: string;\n\t/**\n\t * This path is transformed for search purposes. For example, this could be\n\t * the `relativePath` with the workspace folder name prepended. This way the\n\t * search algorithm would also match against the name of the containing folder.\n\t *\n\t * If not given, the search algorithm should use `relativePath`.\n\t */\n\tsearchPath: string | undefined;\n}\n\nexport interface ISearchEngine<T> {\n\tsearch: (onResult: (matches: T) => void, onProgress: (progress: IProgressMessage) => void, done: (error: Error | null, complete: ISearchEngineSuccess) => void) => void;\n\tcancel: () => void;\n}\n\nexport interface ISerializedSearchSuccess {\n\ttype: 'success';\n\tlimitHit: boolean;\n\tstats?: IFileSearchStats | ITextSearchStats;\n}\n\nexport interface ISearchEngineSuccess {\n\tlimitHit: boolean;\n\tstats: ISearchEngineStats;\n}\n\nexport interface ISerializedSearchError {\n\ttype: 'error';\n\terror: {\n\t\tmessage: string,\n\t\tstack: string\n\t};\n}\n\nexport type ISerializedSearchComplete = ISerializedSearchSuccess | ISerializedSearchError;\n\nexport function isSerializedSearchComplete(arg: ISerializedSearchProgressItem | ISerializedSearchComplete): arg is ISerializedSearchComplete {\n\tif ((arg as any).type === 'error') {\n\t\treturn true;\n\t} else if ((arg as any).type === 'success') {\n\t\treturn true;\n\t} else {\n\t\treturn false;\n\t}\n}\n\nexport function isSerializedSearchSuccess(arg: ISerializedSearchComplete): arg is ISerializedSearchSuccess {\n\treturn arg.type === 'success';\n}\n\nexport function isSerializedFileMatch(arg: ISerializedSearchProgressItem): arg is ISerializedFileMatch {\n\treturn !!(<ISerializedFileMatch>arg).path;\n}\n\nexport function isFilePatternMatch(candidate: IRawFileMatch, normalizedFilePatternLowercase: string): boolean {\n\tconst pathToMatch = candidate.searchPath ? candidate.searchPath : candidate.relativePath;\n\treturn fuzzyContains(pathToMatch, normalizedFilePatternLowercase);\n}\n\nexport interface ISerializedFileMatch {\n\tpath: string;\n\tresults?: ITextSearchResult[];\n\tnumMatches?: number;\n}\n\n// Type of the possible values for progress calls from the engine\nexport type ISerializedSearchProgressItem = ISerializedFileMatch | ISerializedFileMatch[] | IProgressMessage;\nexport type IFileSearchProgressItem = IRawFileMatch | IRawFileMatch[] | IProgressMessage;\n\n\nexport class SerializableFileMatch implements ISerializedFileMatch {\n\tpath: string;\n\tresults: ITextSearchMatch[];\n\n\tconstructor(path: string) {\n\t\tthis.path = path;\n\t\tthis.results = [];\n\t}\n\n\taddMatch(match: ITextSearchMatch): void {\n\t\tthis.results.push(match);\n\t}\n\n\tserialize(): ISerializedFileMatch {\n\t\treturn {\n\t\t\tpath: this.path,\n\t\t\tresults: this.results,\n\t\t\tnumMatches: this.results.length\n\t\t};\n\t}\n}\n\n/**\n *  Computes the patterns that the provider handles. Discards sibling clauses and 'false' patterns\n */\nexport function resolvePatternsForProvider(globalPattern: glob.IExpression | undefined, folderPattern: glob.IExpression | undefined): string[] {\n\tconst merged = {\n\t\t...(globalPattern || {}),\n\t\t...(folderPattern || {})\n\t};\n\n\treturn Object.keys(merged)\n\t\t.filter(key => {\n\t\t\tconst value = merged[key];\n\t\t\treturn typeof value === 'boolean' && value;\n\t\t});\n}\n\nexport class QueryGlobTester {\n\n\tprivate _excludeExpression: glob.IExpression;\n\tprivate _parsedExcludeExpression: glob.ParsedExpression;\n\n\tprivate _parsedIncludeExpression: glob.ParsedExpression | null = null;\n\n\tconstructor(config: ISearchQuery, folderQuery: IFolderQuery) {\n\t\tthis._excludeExpression = {\n\t\t\t...(config.excludePattern || {}),\n\t\t\t...(folderQuery.excludePattern || {})\n\t\t};\n\t\tthis._parsedExcludeExpression = glob.parse(this._excludeExpression);\n\n\t\t// Empty includeExpression means include nothing, so no {} shortcuts\n\t\tlet includeExpression: glob.IExpression | undefined = config.includePattern;\n\t\tif (folderQuery.includePattern) {\n\t\t\tif (includeExpression) {\n\t\t\t\tincludeExpression = {\n\t\t\t\t\t...includeExpression,\n\t\t\t\t\t...folderQuery.includePattern\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tincludeExpression = folderQuery.includePattern;\n\t\t\t}\n\t\t}\n\n\t\tif (includeExpression) {\n\t\t\tthis._parsedIncludeExpression = glob.parse(includeExpression);\n\t\t}\n\t}\n\n\t/**\n\t * Guaranteed sync - siblingsFn should not return a promise.\n\t */\n\tincludedInQuerySync(testPath: string, basename?: string, hasSibling?: (name: string) => boolean): boolean {\n\t\tif (this._parsedExcludeExpression && this._parsedExcludeExpression(testPath, basename, hasSibling)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this._parsedIncludeExpression && !this._parsedIncludeExpression(testPath, basename, hasSibling)) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Guaranteed async.\n\t */\n\tincludedInQuery(testPath: string, basename?: string, hasSibling?: (name: string) => boolean | Promise<boolean>): Promise<boolean> {\n\t\tconst excludeP = Promise.resolve(this._parsedExcludeExpression(testPath, basename, hasSibling)).then(result => !!result);\n\n\t\treturn excludeP.then(excluded => {\n\t\t\tif (excluded) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this._parsedIncludeExpression ?\n\t\t\t\tPromise.resolve(this._parsedIncludeExpression(testPath, basename, hasSibling)).then(result => !!result) :\n\t\t\t\tPromise.resolve(true);\n\t\t}).then(included => {\n\t\t\treturn included;\n\t\t});\n\t}\n\n\thasSiblingExcludeClauses(): boolean {\n\t\treturn hasSiblingClauses(this._excludeExpression);\n\t}\n}\n\nfunction hasSiblingClauses(pattern: glob.IExpression): boolean {\n\tfor (const key in pattern) {\n\t\tif (typeof pattern[key] !== 'boolean') {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { delta as arrayDelta, mapArrayOrNot } from 'vs/base/common/arrays';\nimport { Barrier } from 'vs/base/common/async';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { TernarySearchTree } from 'vs/base/common/map';\nimport { Schemas } from 'vs/base/common/network';\nimport { Counter } from 'vs/base/common/numbers';\nimport { basename, basenameOrAuthority, dirname, ExtUri, relativePath } from 'vs/base/common/resources';\nimport { compare } from 'vs/base/common/strings';\nimport { withUndefinedAsNull } from 'vs/base/common/types';\nimport { URI } from 'vs/base/common/uri';\nimport { localize } from 'vs/nls';\nimport { ExtensionIdentifier, IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { FileSystemProviderCapabilities } from 'vs/platform/files/common/files';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { Severity } from 'vs/platform/notification/common/notification';\nimport { Workspace, WorkspaceFolder } from 'vs/platform/workspace/common/workspace';\nimport { IExtHostFileSystemInfo } from 'vs/workbench/api/common/extHostFileSystemInfo';\nimport { IExtHostInitDataService } from 'vs/workbench/api/common/extHostInitDataService';\nimport { IExtHostRpcService } from 'vs/workbench/api/common/extHostRpcService';\nimport { Range, RelativePattern } from 'vs/workbench/api/common/extHostTypes';\nimport { ITextQueryBuilderOptions } from 'vs/workbench/contrib/search/common/queryBuilder';\nimport { IRawFileMatch2, resultIsMatch } from 'vs/workbench/services/search/common/search';\nimport * as vscode from 'vscode';\nimport { ExtHostWorkspaceShape, IWorkspaceData, MainContext, MainThreadMessageServiceShape, MainThreadWorkspaceShape } from './extHost.protocol';\n\nexport interface IExtHostWorkspaceProvider {\n\tgetWorkspaceFolder2(uri: vscode.Uri, resolveParent?: boolean): Promise<vscode.WorkspaceFolder | undefined>;\n\tresolveWorkspaceFolder(uri: vscode.Uri): Promise<vscode.WorkspaceFolder | undefined>;\n\tgetWorkspaceFolders2(): Promise<vscode.WorkspaceFolder[] | undefined>;\n\tresolveProxy(url: string): Promise<string | undefined>;\n}\n\nfunction isFolderEqual(folderA: URI, folderB: URI, extHostFileSystemInfo: IExtHostFileSystemInfo): boolean {\n\treturn new ExtUri(uri => ignorePathCasing(uri, extHostFileSystemInfo)).isEqual(folderA, folderB);\n}\n\nfunction compareWorkspaceFolderByUri(a: vscode.WorkspaceFolder, b: vscode.WorkspaceFolder, extHostFileSystemInfo: IExtHostFileSystemInfo): number {\n\treturn isFolderEqual(a.uri, b.uri, extHostFileSystemInfo) ? 0 : compare(a.uri.toString(), b.uri.toString());\n}\n\nfunction compareWorkspaceFolderByUriAndNameAndIndex(a: vscode.WorkspaceFolder, b: vscode.WorkspaceFolder, extHostFileSystemInfo: IExtHostFileSystemInfo): number {\n\tif (a.index !== b.index) {\n\t\treturn a.index < b.index ? -1 : 1;\n\t}\n\n\treturn isFolderEqual(a.uri, b.uri, extHostFileSystemInfo) ? compare(a.name, b.name) : compare(a.uri.toString(), b.uri.toString());\n}\n\nfunction delta(oldFolders: vscode.WorkspaceFolder[], newFolders: vscode.WorkspaceFolder[], compare: (a: vscode.WorkspaceFolder, b: vscode.WorkspaceFolder, extHostFileSystemInfo: IExtHostFileSystemInfo) => number, extHostFileSystemInfo: IExtHostFileSystemInfo): { removed: vscode.WorkspaceFolder[], added: vscode.WorkspaceFolder[] } {\n\tconst oldSortedFolders = oldFolders.slice(0).sort((a, b) => compare(a, b, extHostFileSystemInfo));\n\tconst newSortedFolders = newFolders.slice(0).sort((a, b) => compare(a, b, extHostFileSystemInfo));\n\n\treturn arrayDelta(oldSortedFolders, newSortedFolders, (a, b) => compare(a, b, extHostFileSystemInfo));\n}\n\nfunction ignorePathCasing(uri: URI, extHostFileSystemInfo: IExtHostFileSystemInfo): boolean {\n\tconst capabilities = extHostFileSystemInfo.getCapabilities(uri.scheme);\n\treturn !(capabilities && (capabilities & FileSystemProviderCapabilities.PathCaseSensitive));\n}\n\ninterface MutableWorkspaceFolder extends vscode.WorkspaceFolder {\n\tname: string;\n\tindex: number;\n}\n\nclass ExtHostWorkspaceImpl extends Workspace {\n\n\tstatic toExtHostWorkspace(data: IWorkspaceData | null, previousConfirmedWorkspace: ExtHostWorkspaceImpl | undefined, previousUnconfirmedWorkspace: ExtHostWorkspaceImpl | undefined, extHostFileSystemInfo: IExtHostFileSystemInfo): { workspace: ExtHostWorkspaceImpl | null, added: vscode.WorkspaceFolder[], removed: vscode.WorkspaceFolder[] } {\n\t\tif (!data) {\n\t\t\treturn { workspace: null, added: [], removed: [] };\n\t\t}\n\n\t\tconst { id, name, folders, configuration, isUntitled } = data;\n\t\tconst newWorkspaceFolders: vscode.WorkspaceFolder[] = [];\n\n\t\t// If we have an existing workspace, we try to find the folders that match our\n\t\t// data and update their properties. It could be that an extension stored them\n\t\t// for later use and we want to keep them \"live\" if they are still present.\n\t\tconst oldWorkspace = previousConfirmedWorkspace;\n\t\tif (previousConfirmedWorkspace) {\n\t\t\tfolders.forEach((folderData, index) => {\n\t\t\t\tconst folderUri = URI.revive(folderData.uri);\n\t\t\t\tconst existingFolder = ExtHostWorkspaceImpl._findFolder(previousUnconfirmedWorkspace || previousConfirmedWorkspace, folderUri, extHostFileSystemInfo);\n\n\t\t\t\tif (existingFolder) {\n\t\t\t\t\texistingFolder.name = folderData.name;\n\t\t\t\t\texistingFolder.index = folderData.index;\n\n\t\t\t\t\tnewWorkspaceFolders.push(existingFolder);\n\t\t\t\t} else {\n\t\t\t\t\tnewWorkspaceFolders.push({ uri: folderUri, name: folderData.name, index });\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tnewWorkspaceFolders.push(...folders.map(({ uri, name, index }) => ({ uri: URI.revive(uri), name, index })));\n\t\t}\n\n\t\t// make sure to restore sort order based on index\n\t\tnewWorkspaceFolders.sort((f1, f2) => f1.index < f2.index ? -1 : 1);\n\n\t\tconst workspace = new ExtHostWorkspaceImpl(id, name, newWorkspaceFolders, configuration ? URI.revive(configuration) : null, !!isUntitled, uri => ignorePathCasing(uri, extHostFileSystemInfo));\n\t\tconst { added, removed } = delta(oldWorkspace ? oldWorkspace.workspaceFolders : [], workspace.workspaceFolders, compareWorkspaceFolderByUri, extHostFileSystemInfo);\n\n\t\treturn { workspace, added, removed };\n\t}\n\n\tprivate static _findFolder(workspace: ExtHostWorkspaceImpl, folderUriToFind: URI, extHostFileSystemInfo: IExtHostFileSystemInfo): MutableWorkspaceFolder | undefined {\n\t\tfor (let i = 0; i < workspace.folders.length; i++) {\n\t\t\tconst folder = workspace.workspaceFolders[i];\n\t\t\tif (isFolderEqual(folder.uri, folderUriToFind, extHostFileSystemInfo)) {\n\t\t\t\treturn folder;\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate readonly _workspaceFolders: vscode.WorkspaceFolder[] = [];\n\tprivate readonly _structure: TernarySearchTree<URI, vscode.WorkspaceFolder>;\n\n\tconstructor(id: string, private _name: string, folders: vscode.WorkspaceFolder[], configuration: URI | null, private _isUntitled: boolean, ignorePathCasing: (key: URI) => boolean) {\n\t\tsuper(id, folders.map(f => new WorkspaceFolder(f)), configuration, ignorePathCasing);\n\t\tthis._structure = TernarySearchTree.forUris<vscode.WorkspaceFolder>(ignorePathCasing);\n\n\t\t// setup the workspace folder data structure\n\t\tfolders.forEach(folder => {\n\t\t\tthis._workspaceFolders.push(folder);\n\t\t\tthis._structure.set(folder.uri, folder);\n\t\t});\n\t}\n\n\tget name(): string {\n\t\treturn this._name;\n\t}\n\n\tget isUntitled(): boolean {\n\t\treturn this._isUntitled;\n\t}\n\n\tget workspaceFolders(): vscode.WorkspaceFolder[] {\n\t\treturn this._workspaceFolders.slice(0);\n\t}\n\n\tgetWorkspaceFolder(uri: URI, resolveParent?: boolean): vscode.WorkspaceFolder | undefined {\n\t\tif (resolveParent && this._structure.get(uri)) {\n\t\t\t// `uri` is a workspace folder so we check for its parent\n\t\t\turi = dirname(uri);\n\t\t}\n\t\treturn this._structure.findSubstr(uri);\n\t}\n\n\tresolveWorkspaceFolder(uri: URI): vscode.WorkspaceFolder | undefined {\n\t\treturn this._structure.get(uri);\n\t}\n}\n\nexport class ExtHostWorkspace implements ExtHostWorkspaceShape, IExtHostWorkspaceProvider {\n\n\treadonly _serviceBrand: undefined;\n\n\tprivate readonly _onDidChangeWorkspace = new Emitter<vscode.WorkspaceFoldersChangeEvent>();\n\treadonly onDidChangeWorkspace: Event<vscode.WorkspaceFoldersChangeEvent> = this._onDidChangeWorkspace.event;\n\n\tprivate readonly _logService: ILogService;\n\tprivate readonly _requestIdProvider: Counter;\n\tprivate readonly _barrier: Barrier;\n\n\tprivate _confirmedWorkspace?: ExtHostWorkspaceImpl;\n\tprivate _unconfirmedWorkspace?: ExtHostWorkspaceImpl;\n\n\tprivate readonly _proxy: MainThreadWorkspaceShape;\n\tprivate readonly _messageService: MainThreadMessageServiceShape;\n\tprivate readonly _extHostFileSystemInfo: IExtHostFileSystemInfo;\n\n\tprivate readonly _activeSearchCallbacks: ((match: IRawFileMatch2) => any)[] = [];\n\n\tconstructor(\n\t\t@IExtHostRpcService extHostRpc: IExtHostRpcService,\n\t\t@IExtHostInitDataService initData: IExtHostInitDataService,\n\t\t@IExtHostFileSystemInfo extHostFileSystemInfo: IExtHostFileSystemInfo,\n\t\t@ILogService logService: ILogService,\n\t) {\n\t\tthis._logService = logService;\n\t\tthis._extHostFileSystemInfo = extHostFileSystemInfo;\n\t\tthis._requestIdProvider = new Counter();\n\t\tthis._barrier = new Barrier();\n\n\t\tthis._proxy = extHostRpc.getProxy(MainContext.MainThreadWorkspace);\n\t\tthis._messageService = extHostRpc.getProxy(MainContext.MainThreadMessageService);\n\t\tconst data = initData.workspace;\n\t\tthis._confirmedWorkspace = data ? new ExtHostWorkspaceImpl(data.id, data.name, [], data.configuration ? URI.revive(data.configuration) : null, !!data.isUntitled, uri => ignorePathCasing(uri, extHostFileSystemInfo)) : undefined;\n\t}\n\n\t$initializeWorkspace(data: IWorkspaceData | null): void {\n\t\tthis.$acceptWorkspaceData(data);\n\t\tthis._barrier.open();\n\t}\n\n\twaitForInitializeCall(): Promise<boolean> {\n\t\treturn this._barrier.wait();\n\t}\n\n\t// --- workspace ---\n\n\tget workspace(): Workspace | undefined {\n\t\treturn this._actualWorkspace;\n\t}\n\n\tget name(): string | undefined {\n\t\treturn this._actualWorkspace ? this._actualWorkspace.name : undefined;\n\t}\n\n\tget workspaceFile(): vscode.Uri | undefined {\n\t\tif (this._actualWorkspace) {\n\t\t\tif (this._actualWorkspace.configuration) {\n\t\t\t\tif (this._actualWorkspace.isUntitled) {\n\t\t\t\t\treturn URI.from({ scheme: Schemas.untitled, path: basename(dirname(this._actualWorkspace.configuration)) }); // Untitled Worspace: return untitled URI\n\t\t\t\t}\n\n\t\t\t\treturn this._actualWorkspace.configuration; // Workspace: return the configuration location\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate get _actualWorkspace(): ExtHostWorkspaceImpl | undefined {\n\t\treturn this._unconfirmedWorkspace || this._confirmedWorkspace;\n\t}\n\n\tgetWorkspaceFolders(): vscode.WorkspaceFolder[] | undefined {\n\t\tif (!this._actualWorkspace) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn this._actualWorkspace.workspaceFolders.slice(0);\n\t}\n\n\tasync getWorkspaceFolders2(): Promise<vscode.WorkspaceFolder[] | undefined> {\n\t\tawait this._barrier.wait();\n\t\tif (!this._actualWorkspace) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn this._actualWorkspace.workspaceFolders.slice(0);\n\t}\n\n\tupdateWorkspaceFolders(extension: IExtensionDescription, index: number, deleteCount: number, ...workspaceFoldersToAdd: { uri: vscode.Uri, name?: string }[]): boolean {\n\t\tconst validatedDistinctWorkspaceFoldersToAdd: { uri: vscode.Uri, name?: string }[] = [];\n\t\tif (Array.isArray(workspaceFoldersToAdd)) {\n\t\t\tworkspaceFoldersToAdd.forEach(folderToAdd => {\n\t\t\t\tif (URI.isUri(folderToAdd.uri) && !validatedDistinctWorkspaceFoldersToAdd.some(f => isFolderEqual(f.uri, folderToAdd.uri, this._extHostFileSystemInfo))) {\n\t\t\t\t\tvalidatedDistinctWorkspaceFoldersToAdd.push({ uri: folderToAdd.uri, name: folderToAdd.name || basenameOrAuthority(folderToAdd.uri) });\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (!!this._unconfirmedWorkspace) {\n\t\t\treturn false; // prevent accumulated calls without a confirmed workspace\n\t\t}\n\n\t\tif ([index, deleteCount].some(i => typeof i !== 'number' || i < 0)) {\n\t\t\treturn false; // validate numbers\n\t\t}\n\n\t\tif (deleteCount === 0 && validatedDistinctWorkspaceFoldersToAdd.length === 0) {\n\t\t\treturn false; // nothing to delete or add\n\t\t}\n\n\t\tconst currentWorkspaceFolders: MutableWorkspaceFolder[] = this._actualWorkspace ? this._actualWorkspace.workspaceFolders : [];\n\t\tif (index + deleteCount > currentWorkspaceFolders.length) {\n\t\t\treturn false; // cannot delete more than we have\n\t\t}\n\n\t\t// Simulate the updateWorkspaceFolders method on our data to do more validation\n\t\tconst newWorkspaceFolders = currentWorkspaceFolders.slice(0);\n\t\tnewWorkspaceFolders.splice(index, deleteCount, ...validatedDistinctWorkspaceFoldersToAdd.map(f => ({ uri: f.uri, name: f.name || basenameOrAuthority(f.uri), index: undefined! /* fixed later */ })));\n\n\t\tfor (let i = 0; i < newWorkspaceFolders.length; i++) {\n\t\t\tconst folder = newWorkspaceFolders[i];\n\t\t\tif (newWorkspaceFolders.some((otherFolder, index) => index !== i && isFolderEqual(folder.uri, otherFolder.uri, this._extHostFileSystemInfo))) {\n\t\t\t\treturn false; // cannot add the same folder multiple times\n\t\t\t}\n\t\t}\n\n\t\tnewWorkspaceFolders.forEach((f, index) => f.index = index); // fix index\n\t\tconst { added, removed } = delta(currentWorkspaceFolders, newWorkspaceFolders, compareWorkspaceFolderByUriAndNameAndIndex, this._extHostFileSystemInfo);\n\t\tif (added.length === 0 && removed.length === 0) {\n\t\t\treturn false; // nothing actually changed\n\t\t}\n\n\t\t// Trigger on main side\n\t\tif (this._proxy) {\n\t\t\tconst extName = extension.displayName || extension.name;\n\t\t\tthis._proxy.$updateWorkspaceFolders(extName, index, deleteCount, validatedDistinctWorkspaceFoldersToAdd).then(undefined, error => {\n\n\t\t\t\t// in case of an error, make sure to clear out the unconfirmed workspace\n\t\t\t\t// because we cannot expect the acknowledgement from the main side for this\n\t\t\t\tthis._unconfirmedWorkspace = undefined;\n\n\t\t\t\t// show error to user\n\t\t\t\tthis._messageService.$showMessage(Severity.Error, localize('updateerror', \"Extension '{0}' failed to update workspace folders: {1}\", extName, error.toString()), { extension }, []);\n\t\t\t});\n\t\t}\n\n\t\t// Try to accept directly\n\t\tthis.trySetWorkspaceFolders(newWorkspaceFolders);\n\n\t\treturn true;\n\t}\n\n\tgetWorkspaceFolder(uri: vscode.Uri, resolveParent?: boolean): vscode.WorkspaceFolder | undefined {\n\t\tif (!this._actualWorkspace) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn this._actualWorkspace.getWorkspaceFolder(uri, resolveParent);\n\t}\n\n\tasync getWorkspaceFolder2(uri: vscode.Uri, resolveParent?: boolean): Promise<vscode.WorkspaceFolder | undefined> {\n\t\tawait this._barrier.wait();\n\t\tif (!this._actualWorkspace) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn this._actualWorkspace.getWorkspaceFolder(uri, resolveParent);\n\t}\n\n\tasync resolveWorkspaceFolder(uri: vscode.Uri): Promise<vscode.WorkspaceFolder | undefined> {\n\t\tawait this._barrier.wait();\n\t\tif (!this._actualWorkspace) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn this._actualWorkspace.resolveWorkspaceFolder(uri);\n\t}\n\n\tgetPath(): string | undefined {\n\n\t\t// this is legacy from the days before having\n\t\t// multi-root and we keep it only alive if there\n\t\t// is just one workspace folder.\n\t\tif (!this._actualWorkspace) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst { folders } = this._actualWorkspace;\n\t\tif (folders.length === 0) {\n\t\t\treturn undefined;\n\t\t}\n\t\t// #54483 @Joh Why are we still using fsPath?\n\t\treturn folders[0].uri.fsPath;\n\t}\n\n\tgetRelativePath(pathOrUri: string | vscode.Uri, includeWorkspace?: boolean): string {\n\n\t\tlet resource: URI | undefined;\n\t\tlet path: string = '';\n\t\tif (typeof pathOrUri === 'string') {\n\t\t\tresource = URI.file(pathOrUri);\n\t\t\tpath = pathOrUri;\n\t\t} else if (typeof pathOrUri !== 'undefined') {\n\t\t\tresource = pathOrUri;\n\t\t\tpath = pathOrUri.fsPath;\n\t\t}\n\n\t\tif (!resource) {\n\t\t\treturn path;\n\t\t}\n\n\t\tconst folder = this.getWorkspaceFolder(\n\t\t\tresource,\n\t\t\ttrue\n\t\t);\n\n\t\tif (!folder) {\n\t\t\treturn path;\n\t\t}\n\n\t\tif (typeof includeWorkspace === 'undefined' && this._actualWorkspace) {\n\t\t\tincludeWorkspace = this._actualWorkspace.folders.length > 1;\n\t\t}\n\n\t\tlet result = relativePath(folder.uri, resource);\n\t\tif (includeWorkspace && folder.name) {\n\t\t\tresult = `${folder.name}/${result}`;\n\t\t}\n\t\treturn result!;\n\t}\n\n\tprivate trySetWorkspaceFolders(folders: vscode.WorkspaceFolder[]): void {\n\n\t\t// Update directly here. The workspace is unconfirmed as long as we did not get an\n\t\t// acknowledgement from the main side (via $acceptWorkspaceData)\n\t\tif (this._actualWorkspace) {\n\t\t\tthis._unconfirmedWorkspace = ExtHostWorkspaceImpl.toExtHostWorkspace({\n\t\t\t\tid: this._actualWorkspace.id,\n\t\t\t\tname: this._actualWorkspace.name,\n\t\t\t\tconfiguration: this._actualWorkspace.configuration,\n\t\t\t\tfolders,\n\t\t\t\tisUntitled: this._actualWorkspace.isUntitled\n\t\t\t} as IWorkspaceData, this._actualWorkspace, undefined, this._extHostFileSystemInfo).workspace || undefined;\n\t\t}\n\t}\n\n\t$acceptWorkspaceData(data: IWorkspaceData | null): void {\n\n\t\tconst { workspace, added, removed } = ExtHostWorkspaceImpl.toExtHostWorkspace(data, this._confirmedWorkspace, this._unconfirmedWorkspace, this._extHostFileSystemInfo);\n\n\t\t// Update our workspace object. We have a confirmed workspace, so we drop our\n\t\t// unconfirmed workspace.\n\t\tthis._confirmedWorkspace = workspace || undefined;\n\t\tthis._unconfirmedWorkspace = undefined;\n\n\t\t// Events\n\t\tthis._onDidChangeWorkspace.fire(Object.freeze({\n\t\t\tadded,\n\t\t\tremoved,\n\t\t}));\n\t}\n\n\t// --- search ---\n\n\t/**\n\t * Note, null/undefined have different and important meanings for \"exclude\"\n\t */\n\tfindFiles(include: string | RelativePattern | undefined, exclude: vscode.GlobPattern | null | undefined, maxResults: number | undefined, extensionId: ExtensionIdentifier, token: vscode.CancellationToken = CancellationToken.None): Promise<vscode.Uri[]> {\n\t\tthis._logService.trace(`extHostWorkspace#findFiles: fileSearch, extension: ${extensionId.value}, entryPoint: findFiles`);\n\n\t\tlet excludePatternOrDisregardExcludes: string | false | undefined = undefined;\n\t\tif (exclude === null) {\n\t\t\texcludePatternOrDisregardExcludes = false;\n\t\t} else if (exclude) {\n\t\t\tif (typeof exclude === 'string') {\n\t\t\t\texcludePatternOrDisregardExcludes = exclude;\n\t\t\t} else {\n\t\t\t\texcludePatternOrDisregardExcludes = exclude.pattern;\n\t\t\t}\n\t\t}\n\n\t\tif (token && token.isCancellationRequested) {\n\t\t\treturn Promise.resolve([]);\n\t\t}\n\n\t\tconst { includePattern, folder } = parseSearchInclude(include);\n\t\treturn this._proxy.$startFileSearch(\n\t\t\twithUndefinedAsNull(includePattern),\n\t\t\twithUndefinedAsNull(folder),\n\t\t\twithUndefinedAsNull(excludePatternOrDisregardExcludes),\n\t\t\twithUndefinedAsNull(maxResults),\n\t\t\ttoken\n\t\t)\n\t\t\t.then(data => Array.isArray(data) ? data.map(d => URI.revive(d)) : []);\n\t}\n\n\tasync findTextInFiles(query: vscode.TextSearchQuery, options: vscode.FindTextInFilesOptions, callback: (result: vscode.TextSearchResult) => void, extensionId: ExtensionIdentifier, token: vscode.CancellationToken = CancellationToken.None): Promise<vscode.TextSearchComplete> {\n\t\tthis._logService.trace(`extHostWorkspace#findTextInFiles: textSearch, extension: ${extensionId.value}, entryPoint: findTextInFiles`);\n\n\t\tconst requestId = this._requestIdProvider.getNext();\n\n\t\tconst previewOptions: vscode.TextSearchPreviewOptions = typeof options.previewOptions === 'undefined' ?\n\t\t\t{\n\t\t\t\tmatchLines: 100,\n\t\t\t\tcharsPerLine: 10000\n\t\t\t} :\n\t\t\toptions.previewOptions;\n\n\t\tconst { includePattern, folder } = parseSearchInclude(options.include);\n\t\tconst excludePattern = (typeof options.exclude === 'string') ? options.exclude :\n\t\t\toptions.exclude ? options.exclude.pattern : undefined;\n\t\tconst queryOptions: ITextQueryBuilderOptions = {\n\t\t\tignoreSymlinks: typeof options.followSymlinks === 'boolean' ? !options.followSymlinks : undefined,\n\t\t\tdisregardIgnoreFiles: typeof options.useIgnoreFiles === 'boolean' ? !options.useIgnoreFiles : undefined,\n\t\t\tdisregardGlobalIgnoreFiles: typeof options.useGlobalIgnoreFiles === 'boolean' ? !options.useGlobalIgnoreFiles : undefined,\n\t\t\tdisregardExcludeSettings: typeof options.useDefaultExcludes === 'boolean' ? !options.useDefaultExcludes : true,\n\t\t\tfileEncoding: options.encoding,\n\t\t\tmaxResults: options.maxResults,\n\t\t\tpreviewOptions,\n\t\t\tafterContext: options.afterContext,\n\t\t\tbeforeContext: options.beforeContext,\n\n\t\t\tincludePattern: includePattern,\n\t\t\texcludePattern: excludePattern\n\t\t};\n\n\t\tconst isCanceled = false;\n\n\t\tthis._activeSearchCallbacks[requestId] = p => {\n\t\t\tif (isCanceled) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst uri = URI.revive(p.resource);\n\t\t\tp.results!.forEach(result => {\n\t\t\t\tif (resultIsMatch(result)) {\n\t\t\t\t\tcallback(<vscode.TextSearchMatch>{\n\t\t\t\t\t\turi,\n\t\t\t\t\t\tpreview: {\n\t\t\t\t\t\t\ttext: result.preview.text,\n\t\t\t\t\t\t\tmatches: mapArrayOrNot(\n\t\t\t\t\t\t\t\tresult.preview.matches,\n\t\t\t\t\t\t\t\tm => new Range(m.startLineNumber, m.startColumn, m.endLineNumber, m.endColumn))\n\t\t\t\t\t\t},\n\t\t\t\t\t\tranges: mapArrayOrNot(\n\t\t\t\t\t\t\tresult.ranges,\n\t\t\t\t\t\t\tr => new Range(r.startLineNumber, r.startColumn, r.endLineNumber, r.endColumn))\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tcallback(<vscode.TextSearchContext>{\n\t\t\t\t\t\turi,\n\t\t\t\t\t\ttext: result.text,\n\t\t\t\t\t\tlineNumber: result.lineNumber\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\tif (token.isCancellationRequested) {\n\t\t\treturn {};\n\t\t}\n\n\t\ttry {\n\t\t\tconst result = await this._proxy.$startTextSearch(\n\t\t\t\tquery,\n\t\t\t\twithUndefinedAsNull(folder),\n\t\t\t\tqueryOptions,\n\t\t\t\trequestId,\n\t\t\t\ttoken);\n\t\t\tdelete this._activeSearchCallbacks[requestId];\n\t\t\treturn result || {};\n\t\t} catch (err) {\n\t\t\tdelete this._activeSearchCallbacks[requestId];\n\t\t\tthrow err;\n\t\t}\n\t}\n\n\t$handleTextSearchResult(result: IRawFileMatch2, requestId: number): void {\n\t\tif (this._activeSearchCallbacks[requestId]) {\n\t\t\tthis._activeSearchCallbacks[requestId](result);\n\t\t}\n\t}\n\n\tsaveAll(includeUntitled?: boolean): Promise<boolean> {\n\t\treturn this._proxy.$saveAll(includeUntitled);\n\t}\n\n\tresolveProxy(url: string): Promise<string | undefined> {\n\t\treturn this._proxy.$resolveProxy(url);\n\t}\n}\n\nexport const IExtHostWorkspace = createDecorator<IExtHostWorkspace>('IExtHostWorkspace');\nexport interface IExtHostWorkspace extends ExtHostWorkspace, ExtHostWorkspaceShape, IExtHostWorkspaceProvider { }\n\nfunction parseSearchInclude(include: RelativePattern | string | undefined): { includePattern?: string, folder?: URI } {\n\tlet includePattern: string | undefined;\n\tlet includeFolder: URI | undefined;\n\tif (include) {\n\t\tif (typeof include === 'string') {\n\t\t\tincludePattern = include;\n\t\t} else {\n\t\t\tincludePattern = include.pattern;\n\t\t\tincludeFolder = include.baseFolder || URI.file(include.base);\n\t\t}\n\t}\n\n\treturn {\n\t\tincludePattern,\n\t\tfolder: includeFolder\n\t};\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { mixin, deepClone } from 'vs/base/common/objects';\nimport { Event, Emitter } from 'vs/base/common/event';\nimport type * as vscode from 'vscode';\nimport { ExtHostWorkspace, IExtHostWorkspace } from 'vs/workbench/api/common/extHostWorkspace';\nimport { ExtHostConfigurationShape, MainThreadConfigurationShape, IConfigurationInitData, MainContext } from './extHost.protocol';\nimport { ConfigurationTarget as ExtHostConfigurationTarget } from './extHostTypes';\nimport { ConfigurationTarget, IConfigurationChange, IConfigurationData, IConfigurationOverrides } from 'vs/platform/configuration/common/configuration';\nimport { Configuration, ConfigurationChangeEvent } from 'vs/platform/configuration/common/configurationModels';\nimport { ConfigurationScope, OVERRIDE_PROPERTY_PATTERN } from 'vs/platform/configuration/common/configurationRegistry';\nimport { isObject } from 'vs/base/common/types';\nimport { ExtensionIdentifier, IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { Barrier } from 'vs/base/common/async';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { IExtHostRpcService } from 'vs/workbench/api/common/extHostRpcService';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { Workspace } from 'vs/platform/workspace/common/workspace';\nimport { URI } from 'vs/base/common/uri';\n\nfunction lookUp(tree: any, key: string) {\n\tif (key) {\n\t\tconst parts = key.split('.');\n\t\tlet node = tree;\n\t\tfor (let i = 0; node && i < parts.length; i++) {\n\t\t\tnode = node[parts[i]];\n\t\t}\n\t\treturn node;\n\t}\n}\n\ntype ConfigurationInspect<T> = {\n\tkey: string;\n\n\tdefaultValue?: T;\n\tglobalValue?: T;\n\tworkspaceValue?: T,\n\tworkspaceFolderValue?: T,\n\n\tdefaultLanguageValue?: T;\n\tglobalLanguageValue?: T;\n\tworkspaceLanguageValue?: T;\n\tworkspaceFolderLanguageValue?: T;\n\n\tlanguageIds?: string[];\n};\n\nfunction isUri(thing: any): thing is vscode.Uri {\n\treturn thing instanceof URI;\n}\n\nfunction isResourceLanguage(thing: any): thing is { uri: URI, languageId: string } {\n\treturn thing\n\t\t&& thing.uri instanceof URI\n\t\t&& (thing.languageId && typeof thing.languageId === 'string');\n}\n\nfunction isLanguage(thing: any): thing is { languageId: string } {\n\treturn thing\n\t\t&& !thing.uri\n\t\t&& (thing.languageId && typeof thing.languageId === 'string');\n}\n\nfunction isWorkspaceFolder(thing: any): thing is vscode.WorkspaceFolder {\n\treturn thing\n\t\t&& thing.uri instanceof URI\n\t\t&& (!thing.name || typeof thing.name === 'string')\n\t\t&& (!thing.index || typeof thing.index === 'number');\n}\n\nfunction scopeToOverrides(scope: vscode.ConfigurationScope | undefined | null): IConfigurationOverrides | undefined {\n\tif (isUri(scope)) {\n\t\treturn { resource: scope };\n\t}\n\tif (isResourceLanguage(scope)) {\n\t\treturn { resource: scope.uri, overrideIdentifier: scope.languageId };\n\t}\n\tif (isLanguage(scope)) {\n\t\treturn { overrideIdentifier: scope.languageId };\n\t}\n\tif (isWorkspaceFolder(scope)) {\n\t\treturn { resource: scope.uri };\n\t}\n\tif (scope === null) {\n\t\treturn { resource: null };\n\t}\n\treturn undefined;\n}\n\nexport class ExtHostConfiguration implements ExtHostConfigurationShape {\n\n\treadonly _serviceBrand: undefined;\n\n\tprivate readonly _proxy: MainThreadConfigurationShape;\n\tprivate readonly _logService: ILogService;\n\tprivate readonly _extHostWorkspace: ExtHostWorkspace;\n\tprivate readonly _barrier: Barrier;\n\tprivate _actual: ExtHostConfigProvider | null;\n\n\tconstructor(\n\t\t@IExtHostRpcService extHostRpc: IExtHostRpcService,\n\t\t@IExtHostWorkspace extHostWorkspace: IExtHostWorkspace,\n\t\t@ILogService logService: ILogService,\n\t) {\n\t\tthis._proxy = extHostRpc.getProxy(MainContext.MainThreadConfiguration);\n\t\tthis._extHostWorkspace = extHostWorkspace;\n\t\tthis._logService = logService;\n\t\tthis._barrier = new Barrier();\n\t\tthis._actual = null;\n\t}\n\n\tpublic getConfigProvider(): Promise<ExtHostConfigProvider> {\n\t\treturn this._barrier.wait().then(_ => this._actual!);\n\t}\n\n\t$initializeConfiguration(data: IConfigurationInitData): void {\n\t\tthis._actual = new ExtHostConfigProvider(this._proxy, this._extHostWorkspace, data, this._logService);\n\t\tthis._barrier.open();\n\t}\n\n\t$acceptConfigurationChanged(data: IConfigurationInitData, change: IConfigurationChange): void {\n\t\tthis.getConfigProvider().then(provider => provider.$acceptConfigurationChanged(data, change));\n\t}\n}\n\nexport class ExtHostConfigProvider {\n\n\tprivate readonly _onDidChangeConfiguration = new Emitter<vscode.ConfigurationChangeEvent>();\n\tprivate readonly _proxy: MainThreadConfigurationShape;\n\tprivate readonly _extHostWorkspace: ExtHostWorkspace;\n\tprivate _configurationScopes: Map<string, ConfigurationScope | undefined>;\n\tprivate _configuration: Configuration;\n\tprivate _logService: ILogService;\n\n\tconstructor(proxy: MainThreadConfigurationShape, extHostWorkspace: ExtHostWorkspace, data: IConfigurationInitData, logService: ILogService) {\n\t\tthis._proxy = proxy;\n\t\tthis._logService = logService;\n\t\tthis._extHostWorkspace = extHostWorkspace;\n\t\tthis._configuration = Configuration.parse(data);\n\t\tthis._configurationScopes = this._toMap(data.configurationScopes);\n\t}\n\n\tget onDidChangeConfiguration(): Event<vscode.ConfigurationChangeEvent> {\n\t\treturn this._onDidChangeConfiguration && this._onDidChangeConfiguration.event;\n\t}\n\n\t$acceptConfigurationChanged(data: IConfigurationInitData, change: IConfigurationChange) {\n\t\tconst previous = { data: this._configuration.toData(), workspace: this._extHostWorkspace.workspace };\n\t\tthis._configuration = Configuration.parse(data);\n\t\tthis._configurationScopes = this._toMap(data.configurationScopes);\n\t\tthis._onDidChangeConfiguration.fire(this._toConfigurationChangeEvent(change, previous));\n\t}\n\n\tgetConfiguration(section?: string, scope?: vscode.ConfigurationScope | null, extensionDescription?: IExtensionDescription): vscode.WorkspaceConfiguration {\n\t\tconst overrides = scopeToOverrides(scope) || {};\n\t\tconst config = this._toReadonlyValue(section\n\t\t\t? lookUp(this._configuration.getValue(undefined, overrides, this._extHostWorkspace.workspace), section)\n\t\t\t: this._configuration.getValue(undefined, overrides, this._extHostWorkspace.workspace));\n\n\t\tif (section) {\n\t\t\tthis._validateConfigurationAccess(section, overrides, extensionDescription?.identifier);\n\t\t}\n\n\t\tfunction parseConfigurationTarget(arg: boolean | ExtHostConfigurationTarget): ConfigurationTarget | null {\n\t\t\tif (arg === undefined || arg === null) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tif (typeof arg === 'boolean') {\n\t\t\t\treturn arg ? ConfigurationTarget.USER : ConfigurationTarget.WORKSPACE;\n\t\t\t}\n\n\t\t\tswitch (arg) {\n\t\t\t\tcase ExtHostConfigurationTarget.Global: return ConfigurationTarget.USER;\n\t\t\t\tcase ExtHostConfigurationTarget.Workspace: return ConfigurationTarget.WORKSPACE;\n\t\t\t\tcase ExtHostConfigurationTarget.WorkspaceFolder: return ConfigurationTarget.WORKSPACE_FOLDER;\n\t\t\t}\n\t\t}\n\n\t\tconst result: vscode.WorkspaceConfiguration = {\n\t\t\thas(key: string): boolean {\n\t\t\t\treturn typeof lookUp(config, key) !== 'undefined';\n\t\t\t},\n\t\t\tget: <T>(key: string, defaultValue?: T) => {\n\t\t\t\tthis._validateConfigurationAccess(section ? `${section}.${key}` : key, overrides, extensionDescription?.identifier);\n\t\t\t\tlet result = lookUp(config, key);\n\t\t\t\tif (typeof result === 'undefined') {\n\t\t\t\t\tresult = defaultValue;\n\t\t\t\t} else {\n\t\t\t\t\tlet clonedConfig: any | undefined = undefined;\n\t\t\t\t\tconst cloneOnWriteProxy = (target: any, accessor: string): any => {\n\t\t\t\t\t\tlet clonedTarget: any | undefined = undefined;\n\t\t\t\t\t\tconst cloneTarget = () => {\n\t\t\t\t\t\t\tclonedConfig = clonedConfig ? clonedConfig : deepClone(config);\n\t\t\t\t\t\t\tclonedTarget = clonedTarget ? clonedTarget : lookUp(clonedConfig, accessor);\n\t\t\t\t\t\t};\n\t\t\t\t\t\treturn isObject(target) ?\n\t\t\t\t\t\t\tnew Proxy(target, {\n\t\t\t\t\t\t\t\tget: (target: any, property: PropertyKey) => {\n\t\t\t\t\t\t\t\t\tif (typeof property === 'string' && property.toLowerCase() === 'tojson') {\n\t\t\t\t\t\t\t\t\t\tcloneTarget();\n\t\t\t\t\t\t\t\t\t\treturn () => clonedTarget;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (clonedConfig) {\n\t\t\t\t\t\t\t\t\t\tclonedTarget = clonedTarget ? clonedTarget : lookUp(clonedConfig, accessor);\n\t\t\t\t\t\t\t\t\t\treturn clonedTarget[property];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tconst result = target[property];\n\t\t\t\t\t\t\t\t\tif (typeof property === 'string') {\n\t\t\t\t\t\t\t\t\t\treturn cloneOnWriteProxy(result, `${accessor}.${property}`);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\treturn result;\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tset: (_target: any, property: PropertyKey, value: any) => {\n\t\t\t\t\t\t\t\t\tcloneTarget();\n\t\t\t\t\t\t\t\t\tif (clonedTarget) {\n\t\t\t\t\t\t\t\t\t\tclonedTarget[property] = value;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tdeleteProperty: (_target: any, property: PropertyKey) => {\n\t\t\t\t\t\t\t\t\tcloneTarget();\n\t\t\t\t\t\t\t\t\tif (clonedTarget) {\n\t\t\t\t\t\t\t\t\t\tdelete clonedTarget[property];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tdefineProperty: (_target: any, property: PropertyKey, descriptor: any) => {\n\t\t\t\t\t\t\t\t\tcloneTarget();\n\t\t\t\t\t\t\t\t\tif (clonedTarget) {\n\t\t\t\t\t\t\t\t\t\tObject.defineProperty(clonedTarget, property, descriptor);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}) : target;\n\t\t\t\t\t};\n\t\t\t\t\tresult = cloneOnWriteProxy(result, key);\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t},\n\t\t\tupdate: (key: string, value: any, extHostConfigurationTarget: ExtHostConfigurationTarget | boolean, scopeToLanguage?: boolean) => {\n\t\t\t\tkey = section ? `${section}.${key}` : key;\n\t\t\t\tconst target = parseConfigurationTarget(extHostConfigurationTarget);\n\t\t\t\tif (value !== undefined) {\n\t\t\t\t\treturn this._proxy.$updateConfigurationOption(target, key, value, overrides, scopeToLanguage);\n\t\t\t\t} else {\n\t\t\t\t\treturn this._proxy.$removeConfigurationOption(target, key, overrides, scopeToLanguage);\n\t\t\t\t}\n\t\t\t},\n\t\t\tinspect: <T>(key: string): ConfigurationInspect<T> | undefined => {\n\t\t\t\tkey = section ? `${section}.${key}` : key;\n\t\t\t\tconst config = deepClone(this._configuration.inspect<T>(key, overrides, this._extHostWorkspace.workspace));\n\t\t\t\tif (config) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tkey,\n\n\t\t\t\t\t\tdefaultValue: config.default?.value,\n\t\t\t\t\t\tglobalValue: config.user?.value,\n\t\t\t\t\t\tworkspaceValue: config.workspace?.value,\n\t\t\t\t\t\tworkspaceFolderValue: config.workspaceFolder?.value,\n\n\t\t\t\t\t\tdefaultLanguageValue: config.default?.override,\n\t\t\t\t\t\tglobalLanguageValue: config.user?.override,\n\t\t\t\t\t\tworkspaceLanguageValue: config.workspace?.override,\n\t\t\t\t\t\tworkspaceFolderLanguageValue: config.workspaceFolder?.override,\n\n\t\t\t\t\t\tlanguageIds: config.overrideIdentifiers\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t};\n\n\t\tif (typeof config === 'object') {\n\t\t\tmixin(result, config, false);\n\t\t}\n\n\t\treturn <vscode.WorkspaceConfiguration>Object.freeze(result);\n\t}\n\n\tprivate _toReadonlyValue(result: any): any {\n\t\tconst readonlyProxy = (target: any): any => {\n\t\t\treturn isObject(target) ?\n\t\t\t\tnew Proxy(target, {\n\t\t\t\t\tget: (target: any, property: PropertyKey) => readonlyProxy(target[property]),\n\t\t\t\t\tset: (_target: any, property: PropertyKey, _value: any) => { throw new Error(`TypeError: Cannot assign to read only property '${String(property)}' of object`); },\n\t\t\t\t\tdeleteProperty: (_target: any, property: PropertyKey) => { throw new Error(`TypeError: Cannot delete read only property '${String(property)}' of object`); },\n\t\t\t\t\tdefineProperty: (_target: any, property: PropertyKey) => { throw new Error(`TypeError: Cannot define property '${String(property)}' for a readonly object`); },\n\t\t\t\t\tsetPrototypeOf: (_target: any) => { throw new Error(`TypeError: Cannot set prototype for a readonly object`); },\n\t\t\t\t\tisExtensible: () => false,\n\t\t\t\t\tpreventExtensions: () => true\n\t\t\t\t}) : target;\n\t\t};\n\t\treturn readonlyProxy(result);\n\t}\n\n\tprivate _validateConfigurationAccess(key: string, overrides?: IConfigurationOverrides, extensionId?: ExtensionIdentifier): void {\n\t\tconst scope = OVERRIDE_PROPERTY_PATTERN.test(key) ? ConfigurationScope.RESOURCE : this._configurationScopes.get(key);\n\t\tconst extensionIdText = extensionId ? `[${extensionId.value}] ` : '';\n\t\tif (ConfigurationScope.RESOURCE === scope) {\n\t\t\tif (typeof overrides?.resource === 'undefined') {\n\t\t\t\tthis._logService.warn(`${extensionIdText}Accessing a resource scoped configuration without providing a resource is not expected. To get the effective value for '${key}', provide the URI of a resource or 'null' for any resource.`);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tif (ConfigurationScope.WINDOW === scope) {\n\t\t\tif (overrides?.resource) {\n\t\t\t\tthis._logService.warn(`${extensionIdText}Accessing a window scoped configuration for a resource is not expected. To associate '${key}' to a resource, define its scope to 'resource' in configuration contributions in 'package.json'.`);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t}\n\n\tprivate _toConfigurationChangeEvent(change: IConfigurationChange, previous: { data: IConfigurationData, workspace: Workspace | undefined }): vscode.ConfigurationChangeEvent {\n\t\tconst event = new ConfigurationChangeEvent(change, previous, this._configuration, this._extHostWorkspace.workspace);\n\t\treturn Object.freeze({\n\t\t\taffectsConfiguration: (section: string, scope?: vscode.ConfigurationScope) => event.affectsConfiguration(section, scopeToOverrides(scope))\n\t\t});\n\t}\n\n\tprivate _toMap(scopes: [string, ConfigurationScope | undefined][]): Map<string, ConfigurationScope | undefined> {\n\t\treturn scopes.reduce((result, scope) => { result.set(scope[0], scope[1]); return result; }, new Map<string, ConfigurationScope | undefined>());\n\t}\n\n}\n\nexport const IExtHostConfiguration = createDecorator<IExtHostConfiguration>('IExtHostConfiguration');\nexport interface IExtHostConfiguration extends ExtHostConfiguration { }\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { asPromise } from 'vs/base/common/async';\nimport { Event, Emitter } from 'vs/base/common/event';\n\nimport { MainContext, MainThreadTaskShape, ExtHostTaskShape } from 'vs/workbench/api/common/extHost.protocol';\n\nimport * as types from 'vs/workbench/api/common/extHostTypes';\nimport { IExtHostWorkspaceProvider, IExtHostWorkspace } from 'vs/workbench/api/common/extHostWorkspace';\nimport type * as vscode from 'vscode';\nimport * as tasks from '../common/shared/tasks';\nimport { IExtHostDocumentsAndEditors } from 'vs/workbench/api/common/extHostDocumentsAndEditors';\nimport { IExtHostConfiguration } from 'vs/workbench/api/common/extHostConfiguration';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { IExtHostTerminalService } from 'vs/workbench/api/common/extHostTerminalService';\nimport { IExtHostRpcService } from 'vs/workbench/api/common/extHostRpcService';\nimport { IExtHostInitDataService } from 'vs/workbench/api/common/extHostInitDataService';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { Schemas } from 'vs/base/common/network';\nimport * as Platform from 'vs/base/common/platform';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { IExtHostApiDeprecationService } from 'vs/workbench/api/common/extHostApiDeprecationService';\nimport { USER_TASKS_GROUP_KEY } from 'vs/workbench/contrib/tasks/common/taskService';\nimport { NotSupportedError } from 'vs/base/common/errors';\n\nexport interface IExtHostTask extends ExtHostTaskShape {\n\n\treadonly _serviceBrand: undefined;\n\n\ttaskExecutions: vscode.TaskExecution[];\n\tonDidStartTask: Event<vscode.TaskStartEvent>;\n\tonDidEndTask: Event<vscode.TaskEndEvent>;\n\tonDidStartTaskProcess: Event<vscode.TaskProcessStartEvent>;\n\tonDidEndTaskProcess: Event<vscode.TaskProcessEndEvent>;\n\n\tregisterTaskProvider(extension: IExtensionDescription, type: string, provider: vscode.TaskProvider): vscode.Disposable;\n\tregisterTaskSystem(scheme: string, info: tasks.TaskSystemInfoDTO): void;\n\tfetchTasks(filter?: vscode.TaskFilter): Promise<vscode.Task[]>;\n\texecuteTask(extension: IExtensionDescription, task: vscode.Task): Promise<vscode.TaskExecution>;\n\tterminateTask(execution: vscode.TaskExecution): Promise<void>;\n}\n\nexport namespace TaskDefinitionDTO {\n\texport function from(value: vscode.TaskDefinition): tasks.TaskDefinitionDTO | undefined {\n\t\tif (value === undefined || value === null) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn value;\n\t}\n\texport function to(value: tasks.TaskDefinitionDTO): vscode.TaskDefinition | undefined {\n\t\tif (value === undefined || value === null) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn value;\n\t}\n}\n\nexport namespace TaskPresentationOptionsDTO {\n\texport function from(value: vscode.TaskPresentationOptions): tasks.TaskPresentationOptionsDTO | undefined {\n\t\tif (value === undefined || value === null) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn value;\n\t}\n\texport function to(value: tasks.TaskPresentationOptionsDTO): vscode.TaskPresentationOptions | undefined {\n\t\tif (value === undefined || value === null) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn value;\n\t}\n}\n\nexport namespace ProcessExecutionOptionsDTO {\n\texport function from(value: vscode.ProcessExecutionOptions): tasks.ProcessExecutionOptionsDTO | undefined {\n\t\tif (value === undefined || value === null) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn value;\n\t}\n\texport function to(value: tasks.ProcessExecutionOptionsDTO): vscode.ProcessExecutionOptions | undefined {\n\t\tif (value === undefined || value === null) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn value;\n\t}\n}\n\nexport namespace ProcessExecutionDTO {\n\texport function is(value: tasks.ShellExecutionDTO | tasks.ProcessExecutionDTO | tasks.CustomExecutionDTO | undefined): value is tasks.ProcessExecutionDTO {\n\t\tif (value) {\n\t\t\tconst candidate = value as tasks.ProcessExecutionDTO;\n\t\t\treturn candidate && !!candidate.process;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\texport function from(value: vscode.ProcessExecution): tasks.ProcessExecutionDTO | undefined {\n\t\tif (value === undefined || value === null) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst result: tasks.ProcessExecutionDTO = {\n\t\t\tprocess: value.process,\n\t\t\targs: value.args\n\t\t};\n\t\tif (value.options) {\n\t\t\tresult.options = ProcessExecutionOptionsDTO.from(value.options);\n\t\t}\n\t\treturn result;\n\t}\n\texport function to(value: tasks.ProcessExecutionDTO): types.ProcessExecution | undefined {\n\t\tif (value === undefined || value === null) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn new types.ProcessExecution(value.process, value.args, value.options);\n\t}\n}\n\nexport namespace ShellExecutionOptionsDTO {\n\texport function from(value: vscode.ShellExecutionOptions): tasks.ShellExecutionOptionsDTO | undefined {\n\t\tif (value === undefined || value === null) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn value;\n\t}\n\texport function to(value: tasks.ShellExecutionOptionsDTO): vscode.ShellExecutionOptions | undefined {\n\t\tif (value === undefined || value === null) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn value;\n\t}\n}\n\nexport namespace ShellExecutionDTO {\n\texport function is(value: tasks.ShellExecutionDTO | tasks.ProcessExecutionDTO | tasks.CustomExecutionDTO | undefined): value is tasks.ShellExecutionDTO {\n\t\tif (value) {\n\t\t\tconst candidate = value as tasks.ShellExecutionDTO;\n\t\t\treturn candidate && (!!candidate.commandLine || !!candidate.command);\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\texport function from(value: vscode.ShellExecution): tasks.ShellExecutionDTO | undefined {\n\t\tif (value === undefined || value === null) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst result: tasks.ShellExecutionDTO = {\n\t\t};\n\t\tif (value.commandLine !== undefined) {\n\t\t\tresult.commandLine = value.commandLine;\n\t\t} else {\n\t\t\tresult.command = value.command;\n\t\t\tresult.args = value.args;\n\t\t}\n\t\tif (value.options) {\n\t\t\tresult.options = ShellExecutionOptionsDTO.from(value.options);\n\t\t}\n\t\treturn result;\n\t}\n\texport function to(value: tasks.ShellExecutionDTO): types.ShellExecution | undefined {\n\t\tif (value === undefined || value === null || (value.command === undefined && value.commandLine === undefined)) {\n\t\t\treturn undefined;\n\t\t}\n\t\tif (value.commandLine) {\n\t\t\treturn new types.ShellExecution(value.commandLine, value.options);\n\t\t} else {\n\t\t\treturn new types.ShellExecution(value.command!, value.args ? value.args : [], value.options);\n\t\t}\n\t}\n}\n\nexport namespace CustomExecutionDTO {\n\texport function is(value: tasks.ShellExecutionDTO | tasks.ProcessExecutionDTO | tasks.CustomExecutionDTO | undefined): value is tasks.CustomExecutionDTO {\n\t\tif (value) {\n\t\t\tlet candidate = value as tasks.CustomExecutionDTO;\n\t\t\treturn candidate && candidate.customExecution === 'customExecution';\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\texport function from(value: vscode.CustomExecution): tasks.CustomExecutionDTO {\n\t\treturn {\n\t\t\tcustomExecution: 'customExecution'\n\t\t};\n\t}\n\n\texport function to(taskId: string, providedCustomExeutions: Map<string, types.CustomExecution>): types.CustomExecution | undefined {\n\t\treturn providedCustomExeutions.get(taskId);\n\t}\n}\n\n\nexport namespace TaskHandleDTO {\n\texport function from(value: types.Task, workspaceService?: IExtHostWorkspace): tasks.TaskHandleDTO {\n\t\tlet folder: UriComponents | string;\n\t\tif (value.scope !== undefined && typeof value.scope !== 'number') {\n\t\t\tfolder = value.scope.uri;\n\t\t} else if (value.scope !== undefined && typeof value.scope === 'number') {\n\t\t\tif ((value.scope === types.TaskScope.Workspace) && workspaceService && workspaceService.workspaceFile) {\n\t\t\t\tfolder = workspaceService.workspaceFile;\n\t\t\t} else {\n\t\t\t\tfolder = USER_TASKS_GROUP_KEY;\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\tid: value._id!,\n\t\t\tworkspaceFolder: folder!\n\t\t};\n\t}\n}\n\nexport namespace TaskDTO {\n\texport function fromMany(tasks: vscode.Task[], extension: IExtensionDescription): tasks.TaskDTO[] {\n\t\tif (tasks === undefined || tasks === null) {\n\t\t\treturn [];\n\t\t}\n\t\tconst result: tasks.TaskDTO[] = [];\n\t\tfor (let task of tasks) {\n\t\t\tconst converted = from(task, extension);\n\t\t\tif (converted) {\n\t\t\t\tresult.push(converted);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\texport function from(value: vscode.Task, extension: IExtensionDescription): tasks.TaskDTO | undefined {\n\t\tif (value === undefined || value === null) {\n\t\t\treturn undefined;\n\t\t}\n\t\tlet execution: tasks.ShellExecutionDTO | tasks.ProcessExecutionDTO | tasks.CustomExecutionDTO | undefined;\n\t\tif (value.execution instanceof types.ProcessExecution) {\n\t\t\texecution = ProcessExecutionDTO.from(value.execution);\n\t\t} else if (value.execution instanceof types.ShellExecution) {\n\t\t\texecution = ShellExecutionDTO.from(value.execution);\n\t\t} else if (value.execution && value.execution instanceof types.CustomExecution) {\n\t\t\texecution = CustomExecutionDTO.from(<types.CustomExecution>value.execution);\n\t\t}\n\n\t\tconst definition: tasks.TaskDefinitionDTO | undefined = TaskDefinitionDTO.from(value.definition);\n\t\tlet scope: number | UriComponents;\n\t\tif (value.scope) {\n\t\t\tif (typeof value.scope === 'number') {\n\t\t\t\tscope = value.scope;\n\t\t\t} else {\n\t\t\t\tscope = value.scope.uri;\n\t\t\t}\n\t\t} else {\n\t\t\t// To continue to support the deprecated task constructor that doesn't take a scope, we must add a scope here:\n\t\t\tscope = types.TaskScope.Workspace;\n\t\t}\n\t\tif (!definition || !scope) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst group = (value.group as types.TaskGroup) ? (value.group as types.TaskGroup).id : undefined;\n\t\tconst result: tasks.TaskDTO = {\n\t\t\t_id: (value as types.Task)._id!,\n\t\t\tdefinition,\n\t\t\tname: value.name,\n\t\t\tsource: {\n\t\t\t\textensionId: extension.identifier.value,\n\t\t\t\tlabel: value.source,\n\t\t\t\tscope: scope\n\t\t\t},\n\t\t\texecution: execution!,\n\t\t\tisBackground: value.isBackground,\n\t\t\tgroup: group,\n\t\t\tpresentationOptions: TaskPresentationOptionsDTO.from(value.presentationOptions),\n\t\t\tproblemMatchers: value.problemMatchers,\n\t\t\thasDefinedMatchers: (value as types.Task).hasDefinedMatchers,\n\t\t\trunOptions: value.runOptions ? value.runOptions : { reevaluateOnRerun: true },\n\t\t\tdetail: value.detail\n\t\t};\n\t\treturn result;\n\t}\n\texport async function to(value: tasks.TaskDTO | undefined, workspace: IExtHostWorkspaceProvider, providedCustomExeutions: Map<string, types.CustomExecution>): Promise<types.Task | undefined> {\n\t\tif (value === undefined || value === null) {\n\t\t\treturn undefined;\n\t\t}\n\t\tlet execution: types.ShellExecution | types.ProcessExecution | types.CustomExecution | undefined;\n\t\tif (ProcessExecutionDTO.is(value.execution)) {\n\t\t\texecution = ProcessExecutionDTO.to(value.execution);\n\t\t} else if (ShellExecutionDTO.is(value.execution)) {\n\t\t\texecution = ShellExecutionDTO.to(value.execution);\n\t\t} else if (CustomExecutionDTO.is(value.execution)) {\n\t\t\texecution = CustomExecutionDTO.to(value._id, providedCustomExeutions);\n\t\t}\n\t\tconst definition: vscode.TaskDefinition | undefined = TaskDefinitionDTO.to(value.definition);\n\t\tlet scope: vscode.TaskScope.Global | vscode.TaskScope.Workspace | vscode.WorkspaceFolder | undefined;\n\t\tif (value.source) {\n\t\t\tif (value.source.scope !== undefined) {\n\t\t\t\tif (typeof value.source.scope === 'number') {\n\t\t\t\t\tscope = value.source.scope;\n\t\t\t\t} else {\n\t\t\t\t\tscope = await workspace.resolveWorkspaceFolder(URI.revive(value.source.scope));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tscope = types.TaskScope.Workspace;\n\t\t\t}\n\t\t}\n\t\tif (!definition || !scope) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst result = new types.Task(definition, scope, value.name!, value.source.label, execution, value.problemMatchers);\n\t\tif (value.isBackground !== undefined) {\n\t\t\tresult.isBackground = value.isBackground;\n\t\t}\n\t\tif (value.group !== undefined) {\n\t\t\tresult.group = types.TaskGroup.from(value.group);\n\t\t}\n\t\tif (value.presentationOptions) {\n\t\t\tresult.presentationOptions = TaskPresentationOptionsDTO.to(value.presentationOptions)!;\n\t\t}\n\t\tif (value._id) {\n\t\t\tresult._id = value._id;\n\t\t}\n\t\tif (value.detail) {\n\t\t\tresult.detail = value.detail;\n\t\t}\n\t\treturn result;\n\t}\n}\n\nexport namespace TaskFilterDTO {\n\texport function from(value: vscode.TaskFilter | undefined): tasks.TaskFilterDTO | undefined {\n\t\treturn value;\n\t}\n\n\texport function to(value: tasks.TaskFilterDTO): vscode.TaskFilter | undefined {\n\t\tif (!value) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn Object.assign(Object.create(null), value);\n\t}\n}\n\nclass TaskExecutionImpl implements vscode.TaskExecution {\n\n\tconstructor(private readonly _tasks: ExtHostTaskBase, readonly _id: string, private readonly _task: vscode.Task) {\n\t}\n\n\tpublic get task(): vscode.Task {\n\t\treturn this._task;\n\t}\n\n\tpublic terminate(): void {\n\t\tthis._tasks.terminateTask(this);\n\t}\n\n\tpublic fireDidStartProcess(value: tasks.TaskProcessStartedDTO): void {\n\t}\n\n\tpublic fireDidEndProcess(value: tasks.TaskProcessEndedDTO): void {\n\t}\n}\n\nexport namespace TaskExecutionDTO {\n\texport function from(value: vscode.TaskExecution): tasks.TaskExecutionDTO {\n\t\treturn {\n\t\t\tid: (value as TaskExecutionImpl)._id,\n\t\t\ttask: undefined\n\t\t};\n\t}\n}\n\nexport interface HandlerData {\n\ttype: string;\n\tprovider: vscode.TaskProvider;\n\textension: IExtensionDescription;\n}\n\nexport abstract class ExtHostTaskBase implements ExtHostTaskShape, IExtHostTask {\n\treadonly _serviceBrand: undefined;\n\n\tprotected readonly _proxy: MainThreadTaskShape;\n\tprotected readonly _workspaceProvider: IExtHostWorkspaceProvider;\n\tprotected readonly _editorService: IExtHostDocumentsAndEditors;\n\tprotected readonly _configurationService: IExtHostConfiguration;\n\tprotected readonly _terminalService: IExtHostTerminalService;\n\tprotected readonly _logService: ILogService;\n\tprotected readonly _deprecationService: IExtHostApiDeprecationService;\n\tprotected _handleCounter: number;\n\tprotected _handlers: Map<number, HandlerData>;\n\tprotected _taskExecutions: Map<string, TaskExecutionImpl>;\n\tprotected _taskExecutionPromises: Map<string, Promise<TaskExecutionImpl>>;\n\tprotected _providedCustomExecutions2: Map<string, types.CustomExecution>;\n\tprivate _notProvidedCustomExecutions: Set<string>; // Used for custom executions tasks that are created and run through executeTask.\n\tprotected _activeCustomExecutions2: Map<string, types.CustomExecution>;\n\tprivate _lastStartedTask: string | undefined;\n\tprotected readonly _onDidExecuteTask: Emitter<vscode.TaskStartEvent> = new Emitter<vscode.TaskStartEvent>();\n\tprotected readonly _onDidTerminateTask: Emitter<vscode.TaskEndEvent> = new Emitter<vscode.TaskEndEvent>();\n\n\tprotected readonly _onDidTaskProcessStarted: Emitter<vscode.TaskProcessStartEvent> = new Emitter<vscode.TaskProcessStartEvent>();\n\tprotected readonly _onDidTaskProcessEnded: Emitter<vscode.TaskProcessEndEvent> = new Emitter<vscode.TaskProcessEndEvent>();\n\n\tconstructor(\n\t\t@IExtHostRpcService extHostRpc: IExtHostRpcService,\n\t\t@IExtHostInitDataService initData: IExtHostInitDataService,\n\t\t@IExtHostWorkspace workspaceService: IExtHostWorkspace,\n\t\t@IExtHostDocumentsAndEditors editorService: IExtHostDocumentsAndEditors,\n\t\t@IExtHostConfiguration configurationService: IExtHostConfiguration,\n\t\t@IExtHostTerminalService extHostTerminalService: IExtHostTerminalService,\n\t\t@ILogService logService: ILogService,\n\t\t@IExtHostApiDeprecationService deprecationService: IExtHostApiDeprecationService\n\t) {\n\t\tthis._proxy = extHostRpc.getProxy(MainContext.MainThreadTask);\n\t\tthis._workspaceProvider = workspaceService;\n\t\tthis._editorService = editorService;\n\t\tthis._configurationService = configurationService;\n\t\tthis._terminalService = extHostTerminalService;\n\t\tthis._handleCounter = 0;\n\t\tthis._handlers = new Map<number, HandlerData>();\n\t\tthis._taskExecutions = new Map<string, TaskExecutionImpl>();\n\t\tthis._taskExecutionPromises = new Map<string, Promise<TaskExecutionImpl>>();\n\t\tthis._providedCustomExecutions2 = new Map<string, types.CustomExecution>();\n\t\tthis._notProvidedCustomExecutions = new Set<string>();\n\t\tthis._activeCustomExecutions2 = new Map<string, types.CustomExecution>();\n\t\tthis._logService = logService;\n\t\tthis._deprecationService = deprecationService;\n\t\tthis._proxy.$registerSupportedExecutions(true);\n\t}\n\n\tpublic registerTaskProvider(extension: IExtensionDescription, type: string, provider: vscode.TaskProvider): vscode.Disposable {\n\t\tif (!provider) {\n\t\t\treturn new types.Disposable(() => { });\n\t\t}\n\t\tconst handle = this.nextHandle();\n\t\tthis._handlers.set(handle, { type, provider, extension });\n\t\tthis._proxy.$registerTaskProvider(handle, type);\n\t\treturn new types.Disposable(() => {\n\t\t\tthis._handlers.delete(handle);\n\t\t\tthis._proxy.$unregisterTaskProvider(handle);\n\t\t});\n\t}\n\n\tpublic registerTaskSystem(scheme: string, info: tasks.TaskSystemInfoDTO): void {\n\t\tthis._proxy.$registerTaskSystem(scheme, info);\n\t}\n\n\tpublic fetchTasks(filter?: vscode.TaskFilter): Promise<vscode.Task[]> {\n\t\treturn this._proxy.$fetchTasks(TaskFilterDTO.from(filter)).then(async (values) => {\n\t\t\tconst result: vscode.Task[] = [];\n\t\t\tfor (let value of values) {\n\t\t\t\tconst task = await TaskDTO.to(value, this._workspaceProvider, this._providedCustomExecutions2);\n\t\t\t\tif (task) {\n\t\t\t\t\tresult.push(task);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result;\n\t\t});\n\t}\n\n\tpublic abstract executeTask(extension: IExtensionDescription, task: vscode.Task): Promise<vscode.TaskExecution>;\n\n\tpublic get taskExecutions(): vscode.TaskExecution[] {\n\t\tconst result: vscode.TaskExecution[] = [];\n\t\tthis._taskExecutions.forEach(value => result.push(value));\n\t\treturn result;\n\t}\n\n\tpublic terminateTask(execution: vscode.TaskExecution): Promise<void> {\n\t\tif (!(execution instanceof TaskExecutionImpl)) {\n\t\t\tthrow new Error('No valid task execution provided');\n\t\t}\n\t\treturn this._proxy.$terminateTask((execution as TaskExecutionImpl)._id);\n\t}\n\n\tpublic get onDidStartTask(): Event<vscode.TaskStartEvent> {\n\t\treturn this._onDidExecuteTask.event;\n\t}\n\n\tpublic async $onDidStartTask(execution: tasks.TaskExecutionDTO, terminalId: number, resolvedDefinition: tasks.TaskDefinitionDTO): Promise<void> {\n\t\tconst customExecution: types.CustomExecution | undefined = this._providedCustomExecutions2.get(execution.id);\n\t\tif (customExecution) {\n\t\t\tif (this._activeCustomExecutions2.get(execution.id) !== undefined) {\n\t\t\t\tthrow new Error('We should not be trying to start the same custom task executions twice.');\n\t\t\t}\n\n\t\t\t// Clone the custom execution to keep the original untouched. This is important for multiple runs of the same task.\n\t\t\tthis._activeCustomExecutions2.set(execution.id, customExecution);\n\t\t\tthis._terminalService.attachPtyToTerminal(terminalId, await customExecution.callback(resolvedDefinition));\n\t\t}\n\t\tthis._lastStartedTask = execution.id;\n\n\t\tthis._onDidExecuteTask.fire({\n\t\t\texecution: await this.getTaskExecution(execution)\n\t\t});\n\t}\n\n\tpublic get onDidEndTask(): Event<vscode.TaskEndEvent> {\n\t\treturn this._onDidTerminateTask.event;\n\t}\n\n\tpublic async $OnDidEndTask(execution: tasks.TaskExecutionDTO): Promise<void> {\n\t\tconst _execution = await this.getTaskExecution(execution);\n\t\tthis._taskExecutionPromises.delete(execution.id);\n\t\tthis._taskExecutions.delete(execution.id);\n\t\tthis.customExecutionComplete(execution);\n\t\tthis._onDidTerminateTask.fire({\n\t\t\texecution: _execution\n\t\t});\n\t}\n\n\tpublic get onDidStartTaskProcess(): Event<vscode.TaskProcessStartEvent> {\n\t\treturn this._onDidTaskProcessStarted.event;\n\t}\n\n\tpublic async $onDidStartTaskProcess(value: tasks.TaskProcessStartedDTO): Promise<void> {\n\t\tconst execution = await this.getTaskExecution(value.id);\n\t\tthis._onDidTaskProcessStarted.fire({\n\t\t\texecution: execution,\n\t\t\tprocessId: value.processId\n\t\t});\n\t}\n\n\tpublic get onDidEndTaskProcess(): Event<vscode.TaskProcessEndEvent> {\n\t\treturn this._onDidTaskProcessEnded.event;\n\t}\n\n\tpublic async $onDidEndTaskProcess(value: tasks.TaskProcessEndedDTO): Promise<void> {\n\t\tconst execution = await this.getTaskExecution(value.id);\n\t\tthis._onDidTaskProcessEnded.fire({\n\t\t\texecution: execution,\n\t\t\texitCode: value.exitCode\n\t\t});\n\t}\n\n\tprotected abstract provideTasksInternal(validTypes: { [key: string]: boolean; }, taskIdPromises: Promise<void>[], handler: HandlerData, value: vscode.Task[] | null | undefined): { tasks: tasks.TaskDTO[], extension: IExtensionDescription };\n\n\tpublic $provideTasks(handle: number, validTypes: { [key: string]: boolean; }): Thenable<tasks.TaskSetDTO> {\n\t\tconst handler = this._handlers.get(handle);\n\t\tif (!handler) {\n\t\t\treturn Promise.reject(new Error('no handler found'));\n\t\t}\n\n\t\t// Set up a list of task ID promises that we can wait on\n\t\t// before returning the provided tasks. The ensures that\n\t\t// our task IDs are calculated for any custom execution tasks.\n\t\t// Knowing this ID ahead of time is needed because when a task\n\t\t// start event is fired this is when the custom execution is called.\n\t\t// The task start event is also the first time we see the ID from the main\n\t\t// thread, which is too late for us because we need to save an map\n\t\t// from an ID to the custom execution function. (Kind of a cart before the horse problem).\n\t\tconst taskIdPromises: Promise<void>[] = [];\n\t\tconst fetchPromise = asPromise(() => handler.provider.provideTasks(CancellationToken.None)).then(value => {\n\t\t\treturn this.provideTasksInternal(validTypes, taskIdPromises, handler, value);\n\t\t});\n\n\t\treturn new Promise((resolve) => {\n\t\t\tfetchPromise.then((result) => {\n\t\t\t\tPromise.all(taskIdPromises).then(() => {\n\t\t\t\t\tresolve(result);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tprotected abstract resolveTaskInternal(resolvedTaskDTO: tasks.TaskDTO): Promise<tasks.TaskDTO | undefined>;\n\n\tpublic async $resolveTask(handle: number, taskDTO: tasks.TaskDTO): Promise<tasks.TaskDTO | undefined> {\n\t\tconst handler = this._handlers.get(handle);\n\t\tif (!handler) {\n\t\t\treturn Promise.reject(new Error('no handler found'));\n\t\t}\n\n\t\tif (taskDTO.definition.type !== handler.type) {\n\t\t\tthrow new Error(`Unexpected: Task of type [${taskDTO.definition.type}] cannot be resolved by provider of type [${handler.type}].`);\n\t\t}\n\n\t\tconst task = await TaskDTO.to(taskDTO, this._workspaceProvider, this._providedCustomExecutions2);\n\t\tif (!task) {\n\t\t\tthrow new Error('Unexpected: Task cannot be resolved.');\n\t\t}\n\n\t\tconst resolvedTask = await handler.provider.resolveTask(task, CancellationToken.None);\n\t\tif (!resolvedTask) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.checkDeprecation(resolvedTask, handler);\n\n\t\tconst resolvedTaskDTO: tasks.TaskDTO | undefined = TaskDTO.from(resolvedTask, handler.extension);\n\t\tif (!resolvedTaskDTO) {\n\t\t\tthrow new Error('Unexpected: Task cannot be resolved.');\n\t\t}\n\n\t\tif (resolvedTask.definition !== task.definition) {\n\t\t\tthrow new Error('Unexpected: The resolved task definition must be the same object as the original task definition. The task definition cannot be changed.');\n\t\t}\n\n\t\tif (CustomExecutionDTO.is(resolvedTaskDTO.execution)) {\n\t\t\tawait this.addCustomExecution(resolvedTaskDTO, resolvedTask, true);\n\t\t}\n\n\t\treturn await this.resolveTaskInternal(resolvedTaskDTO);\n\t}\n\n\tpublic abstract $resolveVariables(uriComponents: UriComponents, toResolve: { process?: { name: string; cwd?: string; path?: string }, variables: string[] }): Promise<{ process?: string, variables: { [key: string]: string; } }>;\n\n\tpublic abstract $getDefaultShellAndArgs(): Promise<{ shell: string, args: string[] | string | undefined }>;\n\n\tprivate nextHandle(): number {\n\t\treturn this._handleCounter++;\n\t}\n\n\tprotected async addCustomExecution(taskDTO: tasks.TaskDTO, task: vscode.Task, isProvided: boolean): Promise<void> {\n\t\tconst taskId = await this._proxy.$createTaskId(taskDTO);\n\t\tif (!isProvided && !this._providedCustomExecutions2.has(taskId)) {\n\t\t\tthis._notProvidedCustomExecutions.add(taskId);\n\t\t}\n\t\tthis._providedCustomExecutions2.set(taskId, <types.CustomExecution>task.execution);\n\t}\n\n\tprotected async getTaskExecution(execution: tasks.TaskExecutionDTO | string, task?: vscode.Task): Promise<TaskExecutionImpl> {\n\t\tif (typeof execution === 'string') {\n\t\t\tconst taskExecution = this._taskExecutionPromises.get(execution);\n\t\t\tif (!taskExecution) {\n\t\t\t\tthrow new Error('Unexpected: The specified task is missing an execution');\n\t\t\t}\n\t\t\treturn taskExecution;\n\t\t}\n\n\t\tlet result: Promise<TaskExecutionImpl> | undefined = this._taskExecutionPromises.get(execution.id);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\tconst createdResult: Promise<TaskExecutionImpl> = new Promise(async (resolve, reject) => {\n\t\t\tconst taskToCreate = task ? task : await TaskDTO.to(execution.task, this._workspaceProvider, this._providedCustomExecutions2);\n\t\t\tif (!taskToCreate) {\n\t\t\t\treject('Unexpected: Task does not exist.');\n\t\t\t} else {\n\t\t\t\tresolve(new TaskExecutionImpl(this, execution.id, taskToCreate));\n\t\t\t}\n\t\t});\n\n\t\tthis._taskExecutionPromises.set(execution.id, createdResult);\n\t\treturn createdResult.then(executionCreatedResult => {\n\t\t\tthis._taskExecutions.set(execution.id, executionCreatedResult);\n\t\t\treturn executionCreatedResult;\n\t\t}, rejected => {\n\t\t\treturn Promise.reject(rejected);\n\t\t});\n\t}\n\n\tprotected checkDeprecation(task: vscode.Task, handler: HandlerData) {\n\t\tconst tTask = (task as types.Task);\n\t\tif (tTask._deprecated) {\n\t\t\tthis._deprecationService.report('Task.constructor', handler.extension, 'Use the Task constructor that takes a `scope` instead.');\n\t\t}\n\t}\n\n\tprivate customExecutionComplete(execution: tasks.TaskExecutionDTO): void {\n\t\tconst extensionCallback2: vscode.CustomExecution | undefined = this._activeCustomExecutions2.get(execution.id);\n\t\tif (extensionCallback2) {\n\t\t\tthis._activeCustomExecutions2.delete(execution.id);\n\t\t}\n\n\t\t// Technically we don't really need to do this, however, if an extension\n\t\t// is executing a task through \"executeTask\" over and over again\n\t\t// with different properties in the task definition, then the map of executions\n\t\t// could grow indefinitely, something we don't want.\n\t\tif (this._notProvidedCustomExecutions.has(execution.id) && (this._lastStartedTask !== execution.id)) {\n\t\t\tthis._providedCustomExecutions2.delete(execution.id);\n\t\t\tthis._notProvidedCustomExecutions.delete(execution.id);\n\t\t}\n\t\tlet iterator = this._notProvidedCustomExecutions.values();\n\t\tlet iteratorResult = iterator.next();\n\t\twhile (!iteratorResult.done) {\n\t\t\tif (!this._activeCustomExecutions2.has(iteratorResult.value) && (this._lastStartedTask !== iteratorResult.value)) {\n\t\t\t\tthis._providedCustomExecutions2.delete(iteratorResult.value);\n\t\t\t\tthis._notProvidedCustomExecutions.delete(iteratorResult.value);\n\t\t\t}\n\t\t\titeratorResult = iterator.next();\n\t\t}\n\t}\n\n\tpublic abstract $jsonTasksSupported(): Promise<boolean>;\n\n\tpublic abstract $findExecutable(command: string, cwd?: string | undefined, paths?: string[] | undefined): Promise<string | undefined>;\n}\n\nexport class WorkerExtHostTask extends ExtHostTaskBase {\n\tconstructor(\n\t\t@IExtHostRpcService extHostRpc: IExtHostRpcService,\n\t\t@IExtHostInitDataService initData: IExtHostInitDataService,\n\t\t@IExtHostWorkspace workspaceService: IExtHostWorkspace,\n\t\t@IExtHostDocumentsAndEditors editorService: IExtHostDocumentsAndEditors,\n\t\t@IExtHostConfiguration configurationService: IExtHostConfiguration,\n\t\t@IExtHostTerminalService extHostTerminalService: IExtHostTerminalService,\n\t\t@ILogService logService: ILogService,\n\t\t@IExtHostApiDeprecationService deprecationService: IExtHostApiDeprecationService\n\t) {\n\t\tsuper(extHostRpc, initData, workspaceService, editorService, configurationService, extHostTerminalService, logService, deprecationService);\n\t\tthis.registerTaskSystem(Schemas.vscodeRemote, {\n\t\t\tscheme: Schemas.vscodeRemote,\n\t\t\tauthority: '',\n\t\t\tplatform: Platform.PlatformToString(Platform.Platform.Web)\n\t\t});\n\t}\n\n\tpublic async executeTask(extension: IExtensionDescription, task: vscode.Task): Promise<vscode.TaskExecution> {\n\t\tif (!task.execution) {\n\t\t\tthrow new Error('Tasks to execute must include an execution');\n\t\t}\n\n\t\tconst dto = TaskDTO.from(task, extension);\n\t\tif (dto === undefined) {\n\t\t\tthrow new Error('Task is not valid');\n\t\t}\n\n\t\t// If this task is a custom execution, then we need to save it away\n\t\t// in the provided custom execution map that is cleaned up after the\n\t\t// task is executed.\n\t\tif (CustomExecutionDTO.is(dto.execution)) {\n\t\t\tawait this.addCustomExecution(dto, task, false);\n\t\t} else {\n\t\t\tthrow new NotSupportedError();\n\t\t}\n\n\t\t// Always get the task execution first to prevent timing issues when retrieving it later\n\t\tconst execution = await this.getTaskExecution(await this._proxy.$getTaskExecution(dto), task);\n\t\tthis._proxy.$executeTask(dto).catch(error => { throw new Error(error); });\n\t\treturn execution;\n\t}\n\n\tprotected provideTasksInternal(validTypes: { [key: string]: boolean; }, taskIdPromises: Promise<void>[], handler: HandlerData, value: vscode.Task[] | null | undefined): { tasks: tasks.TaskDTO[], extension: IExtensionDescription } {\n\t\tconst taskDTOs: tasks.TaskDTO[] = [];\n\t\tif (value) {\n\t\t\tfor (let task of value) {\n\t\t\t\tthis.checkDeprecation(task, handler);\n\t\t\t\tif (!task.definition || !validTypes[task.definition.type]) {\n\t\t\t\t\tthis._logService.warn(`The task [${task.source}, ${task.name}] uses an undefined task type. The task will be ignored in the future.`);\n\t\t\t\t}\n\n\t\t\t\tconst taskDTO: tasks.TaskDTO | undefined = TaskDTO.from(task, handler.extension);\n\t\t\t\tif (taskDTO && CustomExecutionDTO.is(taskDTO.execution)) {\n\t\t\t\t\ttaskDTOs.push(taskDTO);\n\t\t\t\t\t// The ID is calculated on the main thread task side, so, let's call into it here.\n\t\t\t\t\t// We need the task id's pre-computed for custom task executions because when OnDidStartTask\n\t\t\t\t\t// is invoked, we have to be able to map it back to our data.\n\t\t\t\t\ttaskIdPromises.push(this.addCustomExecution(taskDTO, task, true));\n\t\t\t\t} else {\n\t\t\t\t\tthis._logService.warn('Only custom execution tasks supported.');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\ttasks: taskDTOs,\n\t\t\textension: handler.extension\n\t\t};\n\t}\n\n\tprotected async resolveTaskInternal(resolvedTaskDTO: tasks.TaskDTO): Promise<tasks.TaskDTO | undefined> {\n\t\tif (CustomExecutionDTO.is(resolvedTaskDTO.execution)) {\n\t\t\treturn resolvedTaskDTO;\n\t\t} else {\n\t\t\tthis._logService.warn('Only custom execution tasks supported.');\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tpublic async $resolveVariables(uriComponents: UriComponents, toResolve: { process?: { name: string; cwd?: string; path?: string }, variables: string[] }): Promise<{ process?: string, variables: { [key: string]: string; } }> {\n\t\tconst result = {\n\t\t\tprocess: <unknown>undefined as string,\n\t\t\tvariables: Object.create(null)\n\t\t};\n\t\treturn result;\n\t}\n\n\tpublic $getDefaultShellAndArgs(): Promise<{ shell: string, args: string[] | string | undefined }> {\n\t\tthrow new Error('Not implemented');\n\t}\n\n\tpublic async $jsonTasksSupported(): Promise<boolean> {\n\t\treturn false;\n\t}\n\n\tpublic async $findExecutable(command: string, cwd?: string | undefined, paths?: string[] | undefined): Promise<string | undefined> {\n\t\treturn undefined;\n\t}\n}\n\nexport const IExtHostTask = createDecorator<IExtHostTask>('IExtHostTask');\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { mapFind } from 'vs/base/common/arrays';\nimport { disposableTimeout } from 'vs/base/common/async';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { Emitter } from 'vs/base/common/event';\nimport { once } from 'vs/base/common/functional';\nimport { DisposableStore, IDisposable } from 'vs/base/common/lifecycle';\nimport { isDefined } from 'vs/base/common/types';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { generateUuid } from 'vs/base/common/uuid';\nimport { ExtHostTestingResource, ExtHostTestingShape, MainContext, MainThreadTestingShape } from 'vs/workbench/api/common/extHost.protocol';\nimport { ExtHostDocumentData } from 'vs/workbench/api/common/extHostDocumentData';\nimport { IExtHostDocumentsAndEditors } from 'vs/workbench/api/common/extHostDocumentsAndEditors';\nimport { IExtHostRpcService } from 'vs/workbench/api/common/extHostRpcService';\nimport { TestItem } from 'vs/workbench/api/common/extHostTypeConverters';\nimport { Disposable } from 'vs/workbench/api/common/extHostTypes';\nimport { IExtHostWorkspace } from 'vs/workbench/api/common/extHostWorkspace';\nimport { OwnedTestCollection, SingleUseTestCollection } from 'vs/workbench/contrib/testing/common/ownedTestCollection';\nimport { AbstractIncrementalTestCollection, EMPTY_TEST_RESULT, IncrementalChangeCollector, IncrementalTestCollectionItem, InternalTestItem, InternalTestItemWithChildren, InternalTestResults, RunTestForProviderRequest, RunTestsResult, TestDiffOpType, TestIdWithProvider, TestsDiff } from 'vs/workbench/contrib/testing/common/testCollection';\nimport type * as vscode from 'vscode';\n\nconst getTestSubscriptionKey = (resource: ExtHostTestingResource, uri: URI) => `${resource}:${uri.toString()}`;\n\nexport class ExtHostTesting implements ExtHostTestingShape {\n\tprivate readonly resultsChangedEmitter = new Emitter<void>();\n\tprivate readonly providers = new Map<string, vscode.TestProvider>();\n\tprivate readonly proxy: MainThreadTestingShape;\n\tprivate readonly ownedTests = new OwnedTestCollection();\n\tprivate readonly testSubscriptions = new Map<string, {\n\t\tcollection: SingleUseTestCollection;\n\t\tstore: IDisposable;\n\t\tsubscribeFn: (id: string, provider: vscode.TestProvider) => void;\n\t}>();\n\n\tprivate workspaceObservers: WorkspaceFolderTestObserverFactory;\n\tprivate textDocumentObservers: TextDocumentTestObserverFactory;\n\n\tpublic onLastResultsChanged = this.resultsChangedEmitter.event;\n\tpublic lastResults?: vscode.TestResults;\n\n\tconstructor(@IExtHostRpcService rpc: IExtHostRpcService, @IExtHostDocumentsAndEditors private readonly documents: IExtHostDocumentsAndEditors, @IExtHostWorkspace private readonly workspace: IExtHostWorkspace) {\n\t\tthis.proxy = rpc.getProxy(MainContext.MainThreadTesting);\n\t\tthis.workspaceObservers = new WorkspaceFolderTestObserverFactory(this.proxy);\n\t\tthis.textDocumentObservers = new TextDocumentTestObserverFactory(this.proxy, documents);\n\t}\n\n\t/**\n\t * Implements vscode.test.registerTestProvider\n\t */\n\tpublic registerTestProvider<T extends vscode.TestItem>(provider: vscode.TestProvider<T>): vscode.Disposable {\n\t\tconst providerId = generateUuid();\n\t\tthis.providers.set(providerId, provider);\n\t\tthis.proxy.$registerTestProvider(providerId);\n\n\t\t// give the ext a moment to register things rather than synchronously invoking within activate()\n\t\tconst toSubscribe = [...this.testSubscriptions.keys()];\n\t\tsetTimeout(() => {\n\t\t\tfor (const subscription of toSubscribe) {\n\t\t\t\tthis.testSubscriptions.get(subscription)?.subscribeFn(providerId, provider);\n\t\t\t}\n\t\t}, 0);\n\n\t\treturn new Disposable(() => {\n\t\t\tthis.providers.delete(providerId);\n\t\t\tthis.proxy.$unregisterTestProvider(providerId);\n\t\t});\n\t}\n\n\t/**\n\t * Implements vscode.test.createTextDocumentTestObserver\n\t */\n\tpublic createTextDocumentTestObserver(document: vscode.TextDocument) {\n\t\treturn this.textDocumentObservers.checkout(document.uri);\n\t}\n\n\t/**\n\t * Implements vscode.test.createWorkspaceTestObserver\n\t */\n\tpublic createWorkspaceTestObserver(workspaceFolder: vscode.WorkspaceFolder) {\n\t\treturn this.workspaceObservers.checkout(workspaceFolder.uri);\n\t}\n\n\t/**\n\t * Implements vscode.test.runTests\n\t */\n\tpublic async runTests(req: vscode.TestRunOptions<vscode.TestItem>, token = CancellationToken.None) {\n\t\tawait this.proxy.$runTests({\n\t\t\ttests: req.tests\n\t\t\t\t// Find workspace items first, then owned tests, then document tests.\n\t\t\t\t// If a test instance exists in both the workspace and document, prefer\n\t\t\t\t// the workspace because it's less ephemeral.\n\t\t\t\t.map(test => this.workspaceObservers.getMirroredTestDataByReference(test)\n\t\t\t\t\t?? mapFind(this.testSubscriptions.values(), c => c.collection.getTestByReference(test))\n\t\t\t\t\t?? this.textDocumentObservers.getMirroredTestDataByReference(test))\n\t\t\t\t.filter(isDefined)\n\t\t\t\t.map(item => ({ providerId: item.providerId, testId: item.id })),\n\t\t\tdebug: req.debug\n\t\t}, token);\n\t}\n\n\n\t/**\n\t * Updates test results shown to extensions.\n\t * @override\n\t */\n\tpublic $publishTestResults(results: InternalTestResults): void {\n\t\tconst convert = (item: InternalTestItemWithChildren): vscode.RequiredTestItem =>\n\t\t\t({ ...TestItem.toShallow(item.item), children: item.children.map(convert) });\n\n\t\tthis.lastResults = { tests: results.tests.map(convert) };\n\t\tthis.resultsChangedEmitter.fire();\n\t}\n\n\t/**\n\t * Handles a request to read tests for a file, or workspace.\n\t * @override\n\t */\n\tpublic async $subscribeToTests(resource: ExtHostTestingResource, uriComponents: UriComponents) {\n\t\tconst uri = URI.revive(uriComponents);\n\t\tconst subscriptionKey = getTestSubscriptionKey(resource, uri);\n\t\tif (this.testSubscriptions.has(subscriptionKey)) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet method: undefined | ((p: vscode.TestProvider) => vscode.TestHierarchy<vscode.TestItem> | undefined);\n\t\tif (resource === ExtHostTestingResource.TextDocument) {\n\t\t\tlet document = this.documents.getDocument(uri);\n\n\t\t\t// we can ask to subscribe to tests before the documents are populated in\n\t\t\t// the extension host. Try to wait.\n\t\t\tif (!document) {\n\t\t\t\tconst store = new DisposableStore();\n\t\t\t\tdocument = await new Promise<ExtHostDocumentData | undefined>(resolve => {\n\t\t\t\t\tstore.add(disposableTimeout(() => resolve(undefined), 5000));\n\t\t\t\t\tstore.add(this.documents.onDidAddDocuments(e => {\n\t\t\t\t\t\tconst data = e.find(data => data.document.uri.toString() === uri.toString());\n\t\t\t\t\t\tif (data) { resolve(data); }\n\t\t\t\t\t}));\n\t\t\t\t}).finally(() => store.dispose());\n\t\t\t}\n\n\t\t\tif (document) {\n\t\t\t\tconst folder = await this.workspace.getWorkspaceFolder2(uri, false);\n\t\t\t\tmethod = p => p.createDocumentTestHierarchy\n\t\t\t\t\t? p.createDocumentTestHierarchy(document!.document)\n\t\t\t\t\t: this.createDefaultDocumentTestHierarchy(p, document!.document, folder);\n\t\t\t}\n\t\t} else {\n\t\t\tconst folder = await this.workspace.getWorkspaceFolder2(uri, false);\n\t\t\tif (folder) {\n\t\t\t\tmethod = p => p.createWorkspaceTestHierarchy?.(folder);\n\t\t\t}\n\t\t}\n\n\t\tif (!method) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst subscribeFn = (id: string, provider: vscode.TestProvider) => {\n\t\t\ttry {\n\t\t\t\tconst hierarchy = method!(provider);\n\t\t\t\tif (!hierarchy) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tcollection.pushDiff([TestDiffOpType.DeltaDiscoverComplete, 1]);\n\t\t\t\tdisposable.add(hierarchy);\n\t\t\t\tcollection.addRoot(hierarchy.root, id);\n\t\t\t\tPromise.resolve(hierarchy.discoveredInitialTests).then(() => collection.pushDiff([TestDiffOpType.DeltaDiscoverComplete, -1]));\n\t\t\t\thierarchy.onDidChangeTest(e => collection.onItemChange(e, id));\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(e);\n\t\t\t}\n\t\t};\n\n\t\tconst disposable = new DisposableStore();\n\t\tconst collection = disposable.add(this.ownedTests.createForHierarchy(diff => this.proxy.$publishDiff(resource, uriComponents, diff)));\n\t\tfor (const [id, provider] of this.providers) {\n\t\t\tsubscribeFn(id, provider);\n\t\t}\n\n\t\t// note: we don't increment the root count initially -- this is done by the\n\t\t// main thread, incrementing once per extension host. We just push the\n\t\t// diff to signal that roots have been discovered.\n\t\tcollection.pushDiff([TestDiffOpType.DeltaRootsComplete, -1]);\n\t\tthis.testSubscriptions.set(subscriptionKey, { store: disposable, collection, subscribeFn });\n\t}\n\n\t/**\n\t * Disposes of a previous subscription to tests.\n\t * @override\n\t */\n\tpublic $unsubscribeFromTests(resource: ExtHostTestingResource, uriComponents: UriComponents) {\n\t\tconst uri = URI.revive(uriComponents);\n\t\tconst subscriptionKey = getTestSubscriptionKey(resource, uri);\n\t\tthis.testSubscriptions.get(subscriptionKey)?.store.dispose();\n\t\tthis.testSubscriptions.delete(subscriptionKey);\n\t}\n\n\t/**\n\t * Receives a test update from the main thread. Called (eventually) whenever\n\t * tests change.\n\t * @override\n\t */\n\tpublic $acceptDiff(resource: ExtHostTestingResource, uri: UriComponents, diff: TestsDiff): void {\n\t\tif (resource === ExtHostTestingResource.TextDocument) {\n\t\t\tthis.textDocumentObservers.acceptDiff(URI.revive(uri), diff);\n\t\t} else {\n\t\t\tthis.workspaceObservers.acceptDiff(URI.revive(uri), diff);\n\t\t}\n\t}\n\n\t/**\n\t * Runs tests with the given set of IDs. Allows for test from multiple\n\t * providers to be run.\n\t * @override\n\t */\n\tpublic async $runTestsForProvider(req: RunTestForProviderRequest, cancellation: CancellationToken): Promise<RunTestsResult> {\n\t\tconst provider = this.providers.get(req.providerId);\n\t\tif (!provider || !provider.runTests) {\n\t\t\treturn EMPTY_TEST_RESULT;\n\t\t}\n\n\t\tconst tests = req.ids.map(id => this.ownedTests.getTestById(id)?.actual)\n\t\t\t.filter(isDefined)\n\t\t\t// Only send the actual TestItem's to the user to run.\n\t\t\t.map(t => t instanceof TestItemFilteredWrapper ? t.actual : t);\n\t\tif (!tests.length) {\n\t\t\treturn EMPTY_TEST_RESULT;\n\t\t}\n\n\t\ttry {\n\t\t\tawait provider.runTests({ tests, debug: req.debug }, cancellation);\n\t\t\tfor (const { collection } of this.testSubscriptions.values()) {\n\t\t\t\tcollection.flushDiff(); // ensure all states are updated\n\t\t\t}\n\n\t\t\treturn EMPTY_TEST_RESULT;\n\t\t} catch (e) {\n\t\t\tconsole.error(e); // so it appears to attached debuggers\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\tpublic $lookupTest(req: TestIdWithProvider): Promise<InternalTestItem | undefined> {\n\t\tconst owned = this.ownedTests.getTestById(req.testId);\n\t\tif (!owned) {\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\n\t\tconst { actual, previousChildren, previousEquals, ...item } = owned;\n\t\treturn Promise.resolve(item);\n\t}\n\n\tprivate createDefaultDocumentTestHierarchy(provider: vscode.TestProvider, document: vscode.TextDocument, folder: vscode.WorkspaceFolder | undefined): vscode.TestHierarchy<vscode.TestItem> | undefined {\n\t\tif (!folder) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst workspaceHierarchy = provider.createWorkspaceTestHierarchy?.(folder);\n\t\tif (!workspaceHierarchy) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst onDidChangeTest = new Emitter<vscode.TestItem>();\n\t\tworkspaceHierarchy.onDidChangeTest(node => {\n\t\t\tconst wrapper = TestItemFilteredWrapper.getWrapperForTestItem(node, document);\n\t\t\tconst previouslySeen = wrapper.hasNodeMatchingFilter;\n\n\t\t\tif (previouslySeen) {\n\t\t\t\t// reset cache and get whether you can currently see the TestItem.\n\t\t\t\twrapper.reset();\n\t\t\t\tconst currentlySeen = wrapper.hasNodeMatchingFilter;\n\n\t\t\t\tif (currentlySeen) {\n\t\t\t\t\tonDidChangeTest.fire(wrapper);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Fire the event to say that the current visible parent has changed.\n\t\t\t\tonDidChangeTest.fire(wrapper.visibleParent);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst previousParent = wrapper.visibleParent;\n\t\t\twrapper.reset();\n\t\t\tconst currentlySeen = wrapper.hasNodeMatchingFilter;\n\n\t\t\t// It wasn't previously seen and isn't currently seen so\n\t\t\t// nothing has actually changed.\n\t\t\tif (!currentlySeen) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// The test is now visible so we need to refresh the cache\n\t\t\t// of the previous visible parent and fire that it has changed.\n\t\t\tpreviousParent.reset();\n\t\t\tonDidChangeTest.fire(previousParent);\n\t\t});\n\n\t\treturn {\n\t\t\troot: TestItemFilteredWrapper.getWrapperForTestItem(workspaceHierarchy.root, document),\n\t\t\tdispose: () => {\n\t\t\t\tonDidChangeTest.dispose();\n\t\t\t\tTestItemFilteredWrapper.removeFilter(document);\n\t\t\t},\n\t\t\tonDidChangeTest: onDidChangeTest.event\n\t\t};\n\t}\n}\n\n/*\n * A class which wraps a vscode.TestItem that provides the ability to filter a TestItem's children\n * to only the children that are located in a certain vscode.Uri.\n */\nexport class TestItemFilteredWrapper implements vscode.TestItem {\n\tprivate static wrapperMap = new WeakMap<vscode.TextDocument, WeakMap<vscode.TestItem, TestItemFilteredWrapper>>();\n\tpublic static removeFilter(document: vscode.TextDocument): void {\n\t\tthis.wrapperMap.delete(document);\n\t}\n\n\t// Wraps the TestItem specified in a TestItemFilteredWrapper and pulls from a cache if it already exists.\n\tpublic static getWrapperForTestItem(item: vscode.TestItem, filterDocument: vscode.TextDocument, parent?: TestItemFilteredWrapper): TestItemFilteredWrapper {\n\t\tlet innerMap = this.wrapperMap.get(filterDocument);\n\t\tif (innerMap?.has(item)) {\n\t\t\treturn innerMap.get(item)!;\n\t\t}\n\n\t\tif (!innerMap) {\n\t\t\tinnerMap = new WeakMap<vscode.TestItem, TestItemFilteredWrapper>();\n\t\t\tthis.wrapperMap.set(filterDocument, innerMap);\n\n\t\t}\n\n\t\tconst w = new TestItemFilteredWrapper(item, filterDocument, parent);\n\t\tinnerMap.set(item, w);\n\t\treturn w;\n\t}\n\n\tpublic get label() {\n\t\treturn this.actual.label;\n\t}\n\n\tpublic get debuggable() {\n\t\treturn this.actual.debuggable;\n\t}\n\n\tpublic get description() {\n\t\treturn this.actual.description;\n\t}\n\n\tpublic get location() {\n\t\treturn this.actual.location;\n\t}\n\n\tpublic get runnable() {\n\t\treturn this.actual.runnable;\n\t}\n\n\tpublic get state() {\n\t\treturn this.actual.state;\n\t}\n\n\tpublic get children() {\n\t\t// We only want children that match the filter.\n\t\treturn this.getWrappedChildren().filter(child => child.hasNodeMatchingFilter);\n\t}\n\n\tpublic get visibleParent(): TestItemFilteredWrapper {\n\t\treturn this.hasNodeMatchingFilter ? this : this.parent!.visibleParent;\n\t}\n\n\tprivate matchesFilter: boolean | undefined;\n\n\t// Determines if the TestItem matches the filter. This would be true if:\n\t// 1. We don't have a parent (because the root is the workspace root node)\n\t// 2. The URI of the current node matches the filter URI\n\t// 3. Some child of the current node matches the filter URI\n\tpublic get hasNodeMatchingFilter(): boolean {\n\t\tif (this.matchesFilter === undefined) {\n\t\t\tthis.matchesFilter = !this.parent\n\t\t\t\t|| this.actual.location?.uri.toString() === this.filterDocument.uri.toString()\n\t\t\t\t|| this.getWrappedChildren().some(child => child.hasNodeMatchingFilter);\n\t\t}\n\n\t\treturn this.matchesFilter;\n\t}\n\n\t// Reset the cache of whether or not you can see a node from a particular node\n\t// up to it's visible parent.\n\tpublic reset(): void {\n\t\tif (this !== this.visibleParent) {\n\t\t\tthis.parent?.reset();\n\t\t}\n\t\tthis.matchesFilter = undefined;\n\t}\n\n\n\tprivate constructor(public readonly actual: vscode.TestItem, private filterDocument: vscode.TextDocument, private readonly parent?: TestItemFilteredWrapper) {\n\t\tthis.getWrappedChildren();\n\t}\n\n\tprivate getWrappedChildren() {\n\t\treturn this.actual.children?.map(t => TestItemFilteredWrapper.getWrapperForTestItem(t, this.filterDocument, this)) || [];\n\t}\n}\n\n/**\n * @private\n */\ninterface MirroredCollectionTestItem extends IncrementalTestCollectionItem {\n\trevived: vscode.TestItem;\n\tdepth: number;\n\twrapped?: vscode.RequiredTestItem;\n}\n\nclass MirroredChangeCollector extends IncrementalChangeCollector<MirroredCollectionTestItem> {\n\tprivate readonly added = new Set<MirroredCollectionTestItem>();\n\tprivate readonly updated = new Set<MirroredCollectionTestItem>();\n\tprivate readonly removed = new Set<MirroredCollectionTestItem>();\n\n\tprivate readonly alreadyRemoved = new Set<string>();\n\n\tpublic get isEmpty() {\n\t\treturn this.added.size === 0 && this.removed.size === 0 && this.updated.size === 0;\n\t}\n\n\tconstructor(private readonly collection: MirroredTestCollection, private readonly emitter: Emitter<vscode.TestChangeEvent>) {\n\t\tsuper();\n\t}\n\n\t/**\n\t * @override\n\t */\n\tpublic add(node: MirroredCollectionTestItem): void {\n\t\tthis.added.add(node);\n\t}\n\n\t/**\n\t * @override\n\t */\n\tpublic update(node: MirroredCollectionTestItem): void {\n\t\tObject.assign(node.revived, TestItem.toShallow(node.item));\n\t\tif (!this.added.has(node)) {\n\t\t\tthis.updated.add(node);\n\t\t}\n\t}\n\n\t/**\n\t * @override\n\t */\n\tpublic remove(node: MirroredCollectionTestItem): void {\n\t\tif (this.added.has(node)) {\n\t\t\tthis.added.delete(node);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updated.delete(node);\n\n\t\tif (node.parent && this.alreadyRemoved.has(node.parent)) {\n\t\t\tthis.alreadyRemoved.add(node.id);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.removed.add(node);\n\t}\n\n\t/**\n\t * @override\n\t */\n\tpublic getChangeEvent(): vscode.TestChangeEvent {\n\t\tconst { collection, added, updated, removed } = this;\n\t\treturn {\n\t\t\tget added() { return [...added].map(collection.getPublicTestItem, collection); },\n\t\t\tget updated() { return [...updated].map(collection.getPublicTestItem, collection); },\n\t\t\tget removed() { return [...removed].map(collection.getPublicTestItem, collection); },\n\t\t\tget commonChangeAncestor() {\n\t\t\t\tlet ancestorPath: MirroredCollectionTestItem[] | undefined;\n\t\t\t\tconst buildAncestorPath = (node: MirroredCollectionTestItem | undefined) => {\n\t\t\t\t\tif (!node) {\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\n\t\t\t\t\t// add the node and all its parents to the list of ancestors. If\n\t\t\t\t\t// the node is detached, do not return a path (its parent will\n\t\t\t\t\t// also have been passed to remove() and be present)\n\t\t\t\t\tconst path: MirroredCollectionTestItem[] = new Array(node.depth + 1);\n\t\t\t\t\tfor (let i = node.depth; i >= 0; i--) {\n\t\t\t\t\t\tif (!node) {\n\t\t\t\t\t\t\treturn undefined; // detached child\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tpath[node.depth] = node;\n\t\t\t\t\t\tnode = node.parent ? collection.getMirroredTestDataById(node.parent) : undefined;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn path;\n\t\t\t\t};\n\n\t\t\t\tconst addAncestorPath = (node: MirroredCollectionTestItem) => {\n\t\t\t\t\t// fast path: if the common ancestor is already the root, no more work to do\n\t\t\t\t\tif (ancestorPath && ancestorPath.length === 0) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst thisPath = buildAncestorPath(node);\n\t\t\t\t\tif (!thisPath) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!ancestorPath) {\n\t\t\t\t\t\tancestorPath = thisPath;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// removes node from the path to the ancestor that don't match\n\t\t\t\t\t// the corresponding node in *this* path.\n\t\t\t\t\tfor (let i = ancestorPath.length - 1; i >= 0; i--) {\n\t\t\t\t\t\tif (ancestorPath[i] !== thisPath[i]) {\n\t\t\t\t\t\t\tancestorPath.pop();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tconst addParentAncestor = (node: MirroredCollectionTestItem) => {\n\t\t\t\t\tif (ancestorPath && ancestorPath.length === 0) {\n\t\t\t\t\t\t// no-op\n\t\t\t\t\t} else if (node.parent === null) {\n\t\t\t\t\t\tancestorPath = [];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst parent = collection.getMirroredTestDataById(node.parent);\n\t\t\t\t\t\tif (parent) {\n\t\t\t\t\t\t\taddAncestorPath(parent);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tfor (const node of added) { addParentAncestor(node); }\n\t\t\t\tfor (const node of updated) { addAncestorPath(node); }\n\t\t\t\tfor (const node of removed) { addParentAncestor(node); }\n\n\t\t\t\tconst ancestor = ancestorPath && ancestorPath[ancestorPath.length - 1];\n\t\t\t\treturn ancestor ? collection.getPublicTestItem(ancestor) : null;\n\t\t\t},\n\t\t};\n\t}\n\n\tpublic complete() {\n\t\tif (!this.isEmpty) {\n\t\t\tthis.emitter.fire(this.getChangeEvent());\n\t\t}\n\t}\n}\n\n/**\n * Maintains tests in this extension host sent from the main thread.\n * @private\n */\nexport class MirroredTestCollection extends AbstractIncrementalTestCollection<MirroredCollectionTestItem> {\n\tprivate changeEmitter = new Emitter<vscode.TestChangeEvent>();\n\n\t/**\n\t * Change emitter that fires with the same sematics as `TestObserver.onDidChangeTests`.\n\t */\n\tpublic readonly onDidChangeTests = this.changeEmitter.event;\n\n\t/**\n\t * Gets a list of root test items.\n\t */\n\tpublic get rootTestItems() {\n\t\treturn this.getAllAsTestItem([...this.roots]);\n\t}\n\n\t/**\n\t * Translates the item IDs to TestItems for exposure to extensions.\n\t */\n\tpublic getAllAsTestItem(itemIds: Iterable<string>): vscode.RequiredTestItem[] {\n\t\tlet output: vscode.RequiredTestItem[] = [];\n\t\tfor (const itemId of itemIds) {\n\t\t\tconst item = this.items.get(itemId);\n\t\t\tif (item) {\n\t\t\t\toutput.push(this.getPublicTestItem(item));\n\t\t\t}\n\t\t}\n\n\t\treturn output;\n\t}\n\n\t/**\n\t *\n\t * If the test ID exists, returns its underlying ID.\n\t */\n\tpublic getMirroredTestDataById(itemId: string) {\n\t\treturn this.items.get(itemId);\n\t}\n\n\t/**\n\t * If the test item is a mirrored test item, returns its underlying ID.\n\t */\n\tpublic getMirroredTestDataByReference(item: vscode.TestItem) {\n\t\tconst id = getMirroredItemId(item);\n\t\treturn id ? this.items.get(id) : undefined;\n\t}\n\n\t/**\n\t * @override\n\t */\n\tprotected createItem(item: InternalTestItem, parent?: MirroredCollectionTestItem): MirroredCollectionTestItem {\n\t\treturn { ...item, revived: TestItem.toShallow(item.item), depth: parent ? parent.depth + 1 : 0, children: new Set() };\n\t}\n\n\t/**\n\t * @override\n\t */\n\tprotected createChangeCollector() {\n\t\treturn new MirroredChangeCollector(this, this.changeEmitter);\n\t}\n\n\t/**\n\t * Gets the public test item instance for the given mirrored record.\n\t */\n\tpublic getPublicTestItem(item: MirroredCollectionTestItem): vscode.RequiredTestItem {\n\t\tif (!item.wrapped) {\n\t\t\titem.wrapped = new TestItemFromMirror(item, this);\n\t\t}\n\n\t\treturn item.wrapped;\n\t}\n}\n\nconst getMirroredItemId = (item: vscode.TestItem) => {\n\treturn (item as any)[MirroredItemId] as string | undefined;\n};\n\nconst MirroredItemId = Symbol('MirroredItemId');\n\nclass TestItemFromMirror implements vscode.RequiredTestItem {\n\treadonly #internal: MirroredCollectionTestItem;\n\treadonly #collection: MirroredTestCollection;\n\n\tpublic get id() { return this.#internal.revived.id!; }\n\tpublic get label() { return this.#internal.revived.label; }\n\tpublic get description() { return this.#internal.revived.description; }\n\tpublic get state() { return this.#internal.revived.state; }\n\tpublic get location() { return this.#internal.revived.location; }\n\tpublic get runnable() { return this.#internal.revived.runnable ?? true; }\n\tpublic get debuggable() { return this.#internal.revived.debuggable ?? false; }\n\tpublic get children() {\n\t\treturn this.#collection.getAllAsTestItem(this.#internal.children);\n\t}\n\n\tget [MirroredItemId]() { return this.#internal.id; }\n\n\tconstructor(internal: MirroredCollectionTestItem, collection: MirroredTestCollection) {\n\t\tthis.#internal = internal;\n\t\tthis.#collection = collection;\n\t}\n\n\tpublic toJSON() {\n\t\tconst serialized: vscode.RequiredTestItem & TestIdWithProvider = {\n\t\t\tid: this.id,\n\t\t\tlabel: this.label,\n\t\t\tdescription: this.description,\n\t\t\tstate: this.state,\n\t\t\tlocation: this.location,\n\t\t\trunnable: this.runnable,\n\t\t\tdebuggable: this.debuggable,\n\t\t\tchildren: this.children.map(c => (c as TestItemFromMirror).toJSON()),\n\n\t\t\tproviderId: this.#internal.providerId,\n\t\t\ttestId: this.#internal.id,\n\t\t};\n\n\t\treturn serialized;\n\t}\n}\n\ninterface IObserverData {\n\tobservers: number;\n\ttests: MirroredTestCollection;\n\tlistener: IDisposable;\n\tpendingDeletion?: IDisposable;\n}\n\nabstract class AbstractTestObserverFactory {\n\tprivate readonly resources = new Map<string /* uri */, IObserverData>();\n\n\tpublic checkout(resourceUri: URI): vscode.TestObserver {\n\t\tconst resourceKey = resourceUri.toString();\n\t\tconst resource = this.resources.get(resourceKey) ?? this.createObserverData(resourceUri);\n\n\t\tresource.pendingDeletion?.dispose();\n\t\tresource.observers++;\n\n\t\treturn {\n\t\t\tonDidChangeTest: resource.tests.onDidChangeTests,\n\t\t\tonDidDiscoverInitialTests: new Emitter<void>().event, // todo@connor4312\n\t\t\tget tests() {\n\t\t\t\treturn resource.tests.rootTestItems;\n\t\t\t},\n\t\t\tdispose: once(() => {\n\t\t\t\tif (!--resource.observers) {\n\t\t\t\t\tresource.pendingDeletion = this.eventuallyDispose(resourceUri);\n\t\t\t\t}\n\t\t\t}),\n\t\t};\n\t}\n\n\t/**\n\t * Gets the internal test data by its reference, in any observer.\n\t */\n\tpublic getMirroredTestDataByReference(ref: vscode.TestItem) {\n\t\tfor (const { tests } of this.resources.values()) {\n\t\t\tconst v = tests.getMirroredTestDataByReference(ref);\n\t\t\tif (v) {\n\t\t\t\treturn v;\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\t/**\n\t * Called when no observers are listening for the resource any more. Should\n\t * defer unlistening on the resource, and return a disposiable\n\t * to halt the process in case new listeners come in.\n\t */\n\tprotected eventuallyDispose(resourceUri: URI) {\n\t\treturn disposableTimeout(() => this.unlisten(resourceUri), 10 * 1000);\n\t}\n\n\t/**\n\t * Starts listening to test information for the given resource.\n\t */\n\tprotected abstract listen(resourceUri: URI, onDiff: (diff: TestsDiff) => void): Disposable;\n\n\tprivate createObserverData(resourceUri: URI): IObserverData {\n\t\tconst tests = new MirroredTestCollection();\n\t\tconst listener = this.listen(resourceUri, diff => tests.apply(diff));\n\t\tconst data: IObserverData = { observers: 0, tests, listener };\n\t\tthis.resources.set(resourceUri.toString(), data);\n\t\treturn data;\n\t}\n\n\t/**\n\t * Called when a resource is no longer in use.\n\t */\n\tprotected unlisten(resourceUri: URI) {\n\t\tconst key = resourceUri.toString();\n\t\tconst resource = this.resources.get(key);\n\t\tif (resource) {\n\t\t\tresource.observers = -1;\n\t\t\tresource.pendingDeletion?.dispose();\n\t\t\tresource.listener.dispose();\n\t\t\tthis.resources.delete(key);\n\t\t}\n\t}\n}\n\nclass WorkspaceFolderTestObserverFactory extends AbstractTestObserverFactory {\n\tprivate diffListeners = new Map<string, (diff: TestsDiff) => void>();\n\n\tconstructor(private readonly proxy: MainThreadTestingShape) {\n\t\tsuper();\n\t}\n\n\t/**\n\t * Publishees the diff for the workspace folder with the given uri.\n\t */\n\tpublic acceptDiff(resourceUri: URI, diff: TestsDiff) {\n\t\tthis.diffListeners.get(resourceUri.toString())?.(diff);\n\t}\n\n\t/**\n\t * @override\n\t */\n\tpublic listen(resourceUri: URI, onDiff: (diff: TestsDiff) => void) {\n\t\tthis.proxy.$subscribeToDiffs(ExtHostTestingResource.Workspace, resourceUri);\n\n\t\tconst uriString = resourceUri.toString();\n\t\tthis.diffListeners.set(uriString, onDiff);\n\n\t\treturn new Disposable(() => {\n\t\t\tthis.proxy.$unsubscribeFromDiffs(ExtHostTestingResource.Workspace, resourceUri);\n\t\t\tthis.diffListeners.delete(uriString);\n\t\t});\n\t}\n}\n\nclass TextDocumentTestObserverFactory extends AbstractTestObserverFactory {\n\tprivate diffListeners = new Map<string, (diff: TestsDiff) => void>();\n\n\tconstructor(private readonly proxy: MainThreadTestingShape, private documents: IExtHostDocumentsAndEditors) {\n\t\tsuper();\n\t}\n\n\t/**\n\t * Publishees the diff for the document with the given uri.\n\t */\n\tpublic acceptDiff(resourceUri: URI, diff: TestsDiff) {\n\t\tthis.diffListeners.get(resourceUri.toString())?.(diff);\n\t}\n\n\t/**\n\t * @override\n\t */\n\tpublic listen(resourceUri: URI, onDiff: (diff: TestsDiff) => void) {\n\t\tconst document = this.documents.getDocument(resourceUri);\n\t\tif (!document) {\n\t\t\treturn new Disposable(() => undefined);\n\t\t}\n\n\t\tconst uriString = resourceUri.toString();\n\t\tthis.diffListeners.set(uriString, onDiff);\n\n\t\tthis.proxy.$subscribeToDiffs(ExtHostTestingResource.TextDocument, resourceUri);\n\t\treturn new Disposable(() => {\n\t\t\tthis.proxy.$unsubscribeFromDiffs(ExtHostTestingResource.TextDocument, resourceUri);\n\t\t\tthis.diffListeners.delete(uriString);\n\t\t});\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as arrays from 'vs/base/common/arrays';\nimport * as collections from 'vs/base/common/collections';\nimport * as glob from 'vs/base/common/glob';\nimport { untildify } from 'vs/base/common/labels';\nimport { ResourceMap } from 'vs/base/common/map';\nimport { Schemas } from 'vs/base/common/network';\nimport * as path from 'vs/base/common/path';\nimport { isEqual, basename, relativePath, isAbsolutePath } from 'vs/base/common/resources';\nimport * as strings from 'vs/base/common/strings';\nimport { assertIsDefined } from 'vs/base/common/types';\nimport { URI, URI as uri } from 'vs/base/common/uri';\nimport { isMultilineRegexSource } from 'vs/editor/common/model/textModelSearch';\nimport * as nls from 'vs/nls';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { IWorkspaceContextService, IWorkspaceFolderData, toWorkspaceFolder, WorkbenchState } from 'vs/platform/workspace/common/workspace';\nimport { IEditorGroupsService } from 'vs/workbench/services/editor/common/editorGroupsService';\nimport { IPathService } from 'vs/workbench/services/path/common/pathService';\nimport { getExcludes, ICommonQueryProps, IFileQuery, IFolderQuery, IPatternInfo, ISearchConfiguration, ITextQuery, ITextSearchPreviewOptions, pathIncludedInQuery, QueryType } from 'vs/workbench/services/search/common/search';\n\n/**\n * One folder to search and a glob expression that should be applied.\n */\nexport interface IOneSearchPathPattern {\n\tsearchPath: uri;\n\tpattern?: string;\n}\n\n/**\n * One folder to search and a set of glob expressions that should be applied.\n */\nexport interface ISearchPathPattern {\n\tsearchPath: uri;\n\tpattern?: glob.IExpression;\n}\n\n/**\n * A set of search paths and a set of glob expressions that should be applied.\n */\nexport interface ISearchPathsInfo {\n\tsearchPaths?: ISearchPathPattern[];\n\tpattern?: glob.IExpression;\n}\n\nexport interface ICommonQueryBuilderOptions {\n\t_reason?: string;\n\texcludePattern?: string | string[];\n\tincludePattern?: string | string[];\n\textraFileResources?: uri[];\n\n\t/** Parse the special ./ syntax supported by the searchview, and expand foo to ** /foo */\n\texpandPatterns?: boolean;\n\n\tmaxResults?: number;\n\tmaxFileSize?: number;\n\tdisregardIgnoreFiles?: boolean;\n\tdisregardGlobalIgnoreFiles?: boolean;\n\tdisregardExcludeSettings?: boolean;\n\tdisregardSearchExcludeSettings?: boolean;\n\tignoreSymlinks?: boolean;\n\tonlyOpenEditors?: boolean;\n}\n\nexport interface IFileQueryBuilderOptions extends ICommonQueryBuilderOptions {\n\tfilePattern?: string;\n\texists?: boolean;\n\tsortByScore?: boolean;\n\tcacheKey?: string;\n}\n\nexport interface ITextQueryBuilderOptions extends ICommonQueryBuilderOptions {\n\tpreviewOptions?: ITextSearchPreviewOptions;\n\tfileEncoding?: string;\n\tbeforeContext?: number;\n\tafterContext?: number;\n\tisSmartCase?: boolean;\n}\n\nexport class QueryBuilder {\n\n\tconstructor(\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IWorkspaceContextService private readonly workspaceContextService: IWorkspaceContextService,\n\t\t@IEditorGroupsService private readonly editorGroupsService: IEditorGroupsService,\n\t\t@IPathService private readonly pathService: IPathService\n\t) {\n\t}\n\n\ttext(contentPattern: IPatternInfo, folderResources?: uri[], options: ITextQueryBuilderOptions = {}): ITextQuery {\n\t\tcontentPattern = this.getContentPattern(contentPattern, options);\n\t\tconst searchConfig = this.configurationService.getValue<ISearchConfiguration>();\n\n\t\tconst fallbackToPCRE = folderResources && folderResources.some(folder => {\n\t\t\tconst folderConfig = this.configurationService.getValue<ISearchConfiguration>({ resource: folder });\n\t\t\treturn !folderConfig.search.useRipgrep;\n\t\t});\n\n\t\tconst commonQuery = this.commonQuery(folderResources?.map(toWorkspaceFolder), options);\n\t\treturn <ITextQuery>{\n\t\t\t...commonQuery,\n\t\t\ttype: QueryType.Text,\n\t\t\tcontentPattern,\n\t\t\tpreviewOptions: options.previewOptions,\n\t\t\tmaxFileSize: options.maxFileSize,\n\t\t\tusePCRE2: searchConfig.search.usePCRE2 || fallbackToPCRE || false,\n\t\t\tbeforeContext: options.beforeContext,\n\t\t\tafterContext: options.afterContext,\n\t\t\tuserDisabledExcludesAndIgnoreFiles: options.disregardExcludeSettings && options.disregardIgnoreFiles\n\t\t};\n\t}\n\n\t/**\n\t * Adjusts input pattern for config\n\t */\n\tprivate getContentPattern(inputPattern: IPatternInfo, options: ITextQueryBuilderOptions): IPatternInfo {\n\t\tconst searchConfig = this.configurationService.getValue<ISearchConfiguration>();\n\n\t\tif (inputPattern.isRegExp) {\n\t\t\tinputPattern.pattern = inputPattern.pattern.replace(/\\r?\\n/g, '\\\\n');\n\t\t}\n\n\t\tconst newPattern = {\n\t\t\t...inputPattern,\n\t\t\twordSeparators: searchConfig.editor.wordSeparators\n\t\t};\n\n\t\tif (this.isCaseSensitive(inputPattern, options)) {\n\t\t\tnewPattern.isCaseSensitive = true;\n\t\t}\n\n\t\tif (this.isMultiline(inputPattern)) {\n\t\t\tnewPattern.isMultiline = true;\n\t\t}\n\n\t\treturn newPattern;\n\t}\n\n\tfile(folders: (IWorkspaceFolderData | URI)[], options: IFileQueryBuilderOptions = {}): IFileQuery {\n\t\tconst commonQuery = this.commonQuery(folders, options);\n\t\treturn <IFileQuery>{\n\t\t\t...commonQuery,\n\t\t\ttype: QueryType.File,\n\t\t\tfilePattern: options.filePattern\n\t\t\t\t? options.filePattern.trim()\n\t\t\t\t: options.filePattern,\n\t\t\texists: options.exists,\n\t\t\tsortByScore: options.sortByScore,\n\t\t\tcacheKey: options.cacheKey,\n\t\t};\n\t}\n\n\tprivate handleIncludeExclude(pattern: string | string[] | undefined, expandPatterns: boolean | undefined): ISearchPathsInfo {\n\t\tif (!pattern) {\n\t\t\treturn {};\n\t\t}\n\n\t\tpattern = Array.isArray(pattern) ? pattern.map(normalizeSlashes) : normalizeSlashes(pattern);\n\t\treturn expandPatterns\n\t\t\t? this.parseSearchPaths(pattern)\n\t\t\t: { pattern: patternListToIExpression(...(Array.isArray(pattern) ? pattern : [pattern])) };\n\t}\n\n\tprivate commonQuery(folderResources: (IWorkspaceFolderData | URI)[] = [], options: ICommonQueryBuilderOptions = {}): ICommonQueryProps<uri> {\n\t\tconst includeSearchPathsInfo: ISearchPathsInfo = this.handleIncludeExclude(options.includePattern, options.expandPatterns);\n\t\tconst excludeSearchPathsInfo: ISearchPathsInfo = this.handleIncludeExclude(options.excludePattern, options.expandPatterns);\n\n\t\t// Build folderQueries from searchPaths, if given, otherwise folderResources\n\t\tconst includeFolderName = folderResources.length > 1;\n\t\tconst folderQueries = (includeSearchPathsInfo.searchPaths && includeSearchPathsInfo.searchPaths.length ?\n\t\t\tincludeSearchPathsInfo.searchPaths.map(searchPath => this.getFolderQueryForSearchPath(searchPath, options, excludeSearchPathsInfo)) :\n\t\t\tfolderResources.map(folder => this.getFolderQueryForRoot(folder, options, excludeSearchPathsInfo, includeFolderName)))\n\t\t\t.filter(query => !!query) as IFolderQuery[];\n\n\t\tconst queryProps: ICommonQueryProps<uri> = {\n\t\t\t_reason: options._reason,\n\t\t\tfolderQueries,\n\t\t\tusingSearchPaths: !!(includeSearchPathsInfo.searchPaths && includeSearchPathsInfo.searchPaths.length),\n\t\t\textraFileResources: options.extraFileResources,\n\n\t\t\texcludePattern: excludeSearchPathsInfo.pattern,\n\t\t\tincludePattern: includeSearchPathsInfo.pattern,\n\t\t\tonlyOpenEditors: options.onlyOpenEditors,\n\t\t\tmaxResults: options.maxResults\n\t\t};\n\n\t\tif (options.onlyOpenEditors) {\n\t\t\tconst openEditors = arrays.coalesce(arrays.flatten(this.editorGroupsService.groups.map(group => group.editors.map(editor => editor.resource))));\n\t\t\tconst openEditorsInQuery = openEditors.filter(editor => pathIncludedInQuery(queryProps, editor.fsPath));\n\t\t\tconst openEditorsQueryProps = this.commonQueryFromFileList(openEditorsInQuery);\n\t\t\treturn { ...queryProps, ...openEditorsQueryProps };\n\t\t}\n\n\t\t// Filter extraFileResources against global include/exclude patterns - they are already expected to not belong to a workspace\n\t\tconst extraFileResources = options.extraFileResources && options.extraFileResources.filter(extraFile => pathIncludedInQuery(queryProps, extraFile.fsPath));\n\t\tqueryProps.extraFileResources = extraFileResources && extraFileResources.length ? extraFileResources : undefined;\n\n\t\treturn queryProps;\n\t}\n\n\tprivate commonQueryFromFileList(files: URI[]): ICommonQueryProps<URI> {\n\t\tconst folderQueries: IFolderQuery[] = [];\n\t\tconst foldersToSearch: ResourceMap<IFolderQuery> = new ResourceMap();\n\t\tconst includePattern: glob.IExpression = {};\n\t\tlet hasIncludedFile = false;\n\t\tfiles.forEach(file => {\n\t\t\tif (file.scheme === Schemas.walkThrough) { return; }\n\n\t\t\tconst providerExists = isAbsolutePath(file);\n\t\t\t// Special case userdata as we don't have a search provider for it, but it can be searched.\n\t\t\tconst isUserdata = file.scheme === Schemas.userData;\n\t\t\tif (providerExists && !isUserdata) {\n\t\t\t\tconst searchRoot = this.workspaceContextService.getWorkspaceFolder(file)?.uri ?? file.with({ path: path.dirname(file.fsPath) });\n\n\t\t\t\tlet folderQuery = foldersToSearch.get(searchRoot);\n\t\t\t\tif (!folderQuery) {\n\t\t\t\t\thasIncludedFile = true;\n\t\t\t\t\tfolderQuery = { folder: searchRoot, includePattern: {} };\n\t\t\t\t\tfolderQueries.push(folderQuery);\n\t\t\t\t\tfoldersToSearch.set(searchRoot, folderQuery);\n\t\t\t\t}\n\n\t\t\t\tconst relPath = path.relative(searchRoot.fsPath, file.fsPath);\n\t\t\t\tassertIsDefined(folderQuery.includePattern)[relPath.replace(/\\\\/g, '/')] = true;\n\t\t\t} else {\n\t\t\t\tif (file.fsPath) {\n\t\t\t\t\thasIncludedFile = true;\n\t\t\t\t\tincludePattern[file.fsPath] = true;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\tfolderQueries,\n\t\t\tincludePattern,\n\t\t\tusingSearchPaths: true,\n\t\t\texcludePattern: hasIncludedFile ? undefined : { '**/*': true }\n\t\t};\n\t}\n\n\t/**\n\t * Resolve isCaseSensitive flag based on the query and the isSmartCase flag, for search providers that don't support smart case natively.\n\t */\n\tprivate isCaseSensitive(contentPattern: IPatternInfo, options: ITextQueryBuilderOptions): boolean {\n\t\tif (options.isSmartCase) {\n\t\t\tif (contentPattern.isRegExp) {\n\t\t\t\t// Consider it case sensitive if it contains an unescaped capital letter\n\t\t\t\tif (strings.containsUppercaseCharacter(contentPattern.pattern, true)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t} else if (strings.containsUppercaseCharacter(contentPattern.pattern)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn !!contentPattern.isCaseSensitive;\n\t}\n\n\tprivate isMultiline(contentPattern: IPatternInfo): boolean {\n\t\tif (contentPattern.isMultiline) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (contentPattern.isRegExp && isMultilineRegexSource(contentPattern.pattern)) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (contentPattern.pattern.indexOf('\\n') >= 0) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn !!contentPattern.isMultiline;\n\t}\n\n\t/**\n\t * Take the includePattern as seen in the search viewlet, and split into components that look like searchPaths, and\n\t * glob patterns. Glob patterns are expanded from 'foo/bar' to '{foo/bar/**, **\\/foo/bar}.\n\t *\n\t * Public for test.\n\t */\n\tparseSearchPaths(pattern: string | string[]): ISearchPathsInfo {\n\t\tconst isSearchPath = (segment: string) => {\n\t\t\t// A segment is a search path if it is an absolute path or starts with ./, ../, .\\, or ..\\\n\t\t\treturn path.isAbsolute(segment) || /^\\.\\.?([\\/\\\\]|$)/.test(segment);\n\t\t};\n\n\t\tconst patterns = Array.isArray(pattern) ? pattern : splitGlobPattern(pattern);\n\t\tconst segments = patterns\n\t\t\t.map(segment => {\n\t\t\t\tconst userHome = this.pathService.resolvedUserHome;\n\t\t\t\tif (userHome) {\n\t\t\t\t\treturn untildify(segment, userHome.scheme === Schemas.file ? userHome.fsPath : userHome.path);\n\t\t\t\t}\n\n\t\t\t\treturn segment;\n\t\t\t});\n\t\tconst groups = collections.groupBy(segments,\n\t\t\tsegment => isSearchPath(segment) ? 'searchPaths' : 'exprSegments');\n\n\t\tconst expandedExprSegments = (groups.exprSegments || [])\n\t\t\t.map(s => strings.rtrim(s, '/'))\n\t\t\t.map(s => strings.rtrim(s, '\\\\'))\n\t\t\t.map(p => {\n\t\t\t\tif (p[0] === '.') {\n\t\t\t\t\tp = '*' + p; // convert \".js\" to \"*.js\"\n\t\t\t\t}\n\n\t\t\t\treturn expandGlobalGlob(p);\n\t\t\t});\n\n\t\tconst result: ISearchPathsInfo = {};\n\t\tconst searchPaths = this.expandSearchPathPatterns(groups.searchPaths || []);\n\t\tif (searchPaths && searchPaths.length) {\n\t\t\tresult.searchPaths = searchPaths;\n\t\t}\n\n\t\tconst exprSegments = arrays.flatten(expandedExprSegments);\n\t\tconst includePattern = patternListToIExpression(...exprSegments);\n\t\tif (includePattern) {\n\t\t\tresult.pattern = includePattern;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate getExcludesForFolder(folderConfig: ISearchConfiguration, options: ICommonQueryBuilderOptions): glob.IExpression | undefined {\n\t\treturn options.disregardExcludeSettings ?\n\t\t\tundefined :\n\t\t\tgetExcludes(folderConfig, !options.disregardSearchExcludeSettings);\n\t}\n\n\t/**\n\t * Split search paths (./ or ../ or absolute paths in the includePatterns) into absolute paths and globs applied to those paths\n\t */\n\tprivate expandSearchPathPatterns(searchPaths: string[]): ISearchPathPattern[] {\n\t\tif (!searchPaths || !searchPaths.length) {\n\t\t\t// No workspace => ignore search paths\n\t\t\treturn [];\n\t\t}\n\n\t\tconst expandedSearchPaths = arrays.flatten(\n\t\t\tsearchPaths.map(searchPath => {\n\t\t\t\t// 1 open folder => just resolve the search paths to absolute paths\n\t\t\t\tlet { pathPortion, globPortion } = splitGlobFromPath(searchPath);\n\n\t\t\t\tif (globPortion) {\n\t\t\t\t\tglobPortion = normalizeGlobPattern(globPortion);\n\t\t\t\t}\n\n\t\t\t\t// One pathPortion to multiple expanded search paths (e.g. duplicate matching workspace folders)\n\t\t\t\tconst oneExpanded = this.expandOneSearchPath(pathPortion);\n\n\t\t\t\t// Expanded search paths to multiple resolved patterns (with ** and without)\n\t\t\t\treturn arrays.flatten(\n\t\t\t\t\toneExpanded.map(oneExpandedResult => this.resolveOneSearchPathPattern(oneExpandedResult, globPortion)));\n\t\t\t}));\n\n\t\tconst searchPathPatternMap = new Map<string, ISearchPathPattern>();\n\t\texpandedSearchPaths.forEach(oneSearchPathPattern => {\n\t\t\tconst key = oneSearchPathPattern.searchPath.toString();\n\t\t\tconst existing = searchPathPatternMap.get(key);\n\t\t\tif (existing) {\n\t\t\t\tif (oneSearchPathPattern.pattern) {\n\t\t\t\t\texisting.pattern = existing.pattern || {};\n\t\t\t\t\texisting.pattern[oneSearchPathPattern.pattern] = true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tsearchPathPatternMap.set(key, {\n\t\t\t\t\tsearchPath: oneSearchPathPattern.searchPath,\n\t\t\t\t\tpattern: oneSearchPathPattern.pattern ? patternListToIExpression(oneSearchPathPattern.pattern) : undefined\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn Array.from(searchPathPatternMap.values());\n\t}\n\n\t/**\n\t * Takes a searchPath like `./a/foo` or `../a/foo` and expands it to absolute paths for all the workspaces it matches.\n\t */\n\tprivate expandOneSearchPath(searchPath: string): IOneSearchPathPattern[] {\n\t\tif (path.isAbsolute(searchPath)) {\n\t\t\tconst workspaceFolders = this.workspaceContextService.getWorkspace().folders;\n\t\t\tif (workspaceFolders[0] && workspaceFolders[0].uri.scheme !== Schemas.file) {\n\t\t\t\treturn [{\n\t\t\t\t\tsearchPath: workspaceFolders[0].uri.with({ path: searchPath })\n\t\t\t\t}];\n\t\t\t}\n\n\t\t\t// Currently only local resources can be searched for with absolute search paths.\n\t\t\t// TODO convert this to a workspace folder + pattern, so excludes will be resolved properly for an absolute path inside a workspace folder\n\t\t\treturn [{\n\t\t\t\tsearchPath: uri.file(path.normalize(searchPath))\n\t\t\t}];\n\t\t}\n\n\t\tif (this.workspaceContextService.getWorkbenchState() === WorkbenchState.FOLDER) {\n\t\t\tconst workspaceUri = this.workspaceContextService.getWorkspace().folders[0].uri;\n\n\t\t\tsearchPath = normalizeSlashes(searchPath);\n\t\t\tif (searchPath.startsWith('../') || searchPath === '..') {\n\t\t\t\tconst resolvedPath = path.posix.resolve(workspaceUri.path, searchPath);\n\t\t\t\treturn [{\n\t\t\t\t\tsearchPath: workspaceUri.with({ path: resolvedPath })\n\t\t\t\t}];\n\t\t\t}\n\n\t\t\tconst cleanedPattern = normalizeGlobPattern(searchPath);\n\t\t\treturn [{\n\t\t\t\tsearchPath: workspaceUri,\n\t\t\t\tpattern: cleanedPattern\n\t\t\t}];\n\t\t} else if (searchPath === './' || searchPath === '.\\\\') {\n\t\t\treturn []; // ./ or ./**/foo makes sense for single-folder but not multi-folder workspaces\n\t\t} else {\n\t\t\tconst relativeSearchPathMatch = searchPath.match(/\\.[\\/\\\\]([^\\/\\\\]+)(?:[\\/\\\\](.+))?/);\n\t\t\tif (relativeSearchPathMatch) {\n\t\t\t\tconst searchPathRoot = relativeSearchPathMatch[1];\n\t\t\t\tconst matchingRoots = this.workspaceContextService.getWorkspace().folders.filter(folder => folder.name === searchPathRoot);\n\t\t\t\tif (matchingRoots.length) {\n\t\t\t\t\treturn matchingRoots.map(root => {\n\t\t\t\t\t\tconst patternMatch = relativeSearchPathMatch[2];\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tsearchPath: root.uri,\n\t\t\t\t\t\t\tpattern: patternMatch && normalizeGlobPattern(patternMatch)\n\t\t\t\t\t\t};\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t// No root folder with name\n\t\t\t\t\tconst searchPathNotFoundError = nls.localize('search.noWorkspaceWithName', \"Workspace folder does not exist: {0}\", searchPathRoot);\n\t\t\t\t\tthrow new Error(searchPathNotFoundError);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Malformed ./ search path, ignore\n\t\t\t}\n\t\t}\n\n\t\treturn [];\n\t}\n\n\tprivate resolveOneSearchPathPattern(oneExpandedResult: IOneSearchPathPattern, globPortion?: string): IOneSearchPathPattern[] {\n\t\tconst pattern = oneExpandedResult.pattern && globPortion ?\n\t\t\t`${oneExpandedResult.pattern}/${globPortion}` :\n\t\t\toneExpandedResult.pattern || globPortion;\n\n\t\tconst results = [\n\t\t\t{\n\t\t\t\tsearchPath: oneExpandedResult.searchPath,\n\t\t\t\tpattern\n\t\t\t}];\n\n\t\tif (pattern && !pattern.endsWith('**')) {\n\t\t\tresults.push({\n\t\t\t\tsearchPath: oneExpandedResult.searchPath,\n\t\t\t\tpattern: pattern + '/**'\n\t\t\t});\n\t\t}\n\n\t\treturn results;\n\t}\n\n\tprivate getFolderQueryForSearchPath(searchPath: ISearchPathPattern, options: ICommonQueryBuilderOptions, searchPathExcludes: ISearchPathsInfo): IFolderQuery | null {\n\t\tconst rootConfig = this.getFolderQueryForRoot(toWorkspaceFolder(searchPath.searchPath), options, searchPathExcludes, false);\n\t\tif (!rootConfig) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\t...rootConfig,\n\t\t\t...{\n\t\t\t\tincludePattern: searchPath.pattern\n\t\t\t}\n\t\t};\n\t}\n\n\tprivate getFolderQueryForRoot(folder: (IWorkspaceFolderData | URI), options: ICommonQueryBuilderOptions, searchPathExcludes: ISearchPathsInfo, includeFolderName: boolean): IFolderQuery | null {\n\t\tlet thisFolderExcludeSearchPathPattern: glob.IExpression | undefined;\n\t\tconst folderUri = URI.isUri(folder) ? folder : folder.uri;\n\t\tif (searchPathExcludes.searchPaths) {\n\t\t\tconst thisFolderExcludeSearchPath = searchPathExcludes.searchPaths.filter(sp => isEqual(sp.searchPath, folderUri))[0];\n\t\t\tif (thisFolderExcludeSearchPath && !thisFolderExcludeSearchPath.pattern) {\n\t\t\t\t// entire folder is excluded\n\t\t\t\treturn null;\n\t\t\t} else if (thisFolderExcludeSearchPath) {\n\t\t\t\tthisFolderExcludeSearchPathPattern = thisFolderExcludeSearchPath.pattern;\n\t\t\t}\n\t\t}\n\n\t\tconst folderConfig = this.configurationService.getValue<ISearchConfiguration>({ resource: folderUri });\n\t\tconst settingExcludes = this.getExcludesForFolder(folderConfig, options);\n\t\tconst excludePattern: glob.IExpression = {\n\t\t\t...(settingExcludes || {}),\n\t\t\t...(thisFolderExcludeSearchPathPattern || {})\n\t\t};\n\n\t\tconst folderName = URI.isUri(folder) ? basename(folder) : folder.name;\n\t\treturn <IFolderQuery>{\n\t\t\tfolder: folderUri,\n\t\t\tfolderName: includeFolderName ? folderName : undefined,\n\t\t\texcludePattern: Object.keys(excludePattern).length > 0 ? excludePattern : undefined,\n\t\t\tfileEncoding: folderConfig.files && folderConfig.files.encoding,\n\t\t\tdisregardIgnoreFiles: typeof options.disregardIgnoreFiles === 'boolean' ? options.disregardIgnoreFiles : !folderConfig.search.useIgnoreFiles,\n\t\t\tdisregardGlobalIgnoreFiles: typeof options.disregardGlobalIgnoreFiles === 'boolean' ? options.disregardGlobalIgnoreFiles : !folderConfig.search.useGlobalIgnoreFiles,\n\t\t\tignoreSymlinks: typeof options.ignoreSymlinks === 'boolean' ? options.ignoreSymlinks : !folderConfig.search.followSymlinks,\n\t\t};\n\t}\n}\n\nfunction splitGlobFromPath(searchPath: string): { pathPortion: string, globPortion?: string } {\n\tconst globCharMatch = searchPath.match(/[\\*\\{\\}\\(\\)\\[\\]\\?]/);\n\tif (globCharMatch) {\n\t\tconst globCharIdx = globCharMatch.index;\n\t\tconst lastSlashMatch = searchPath.substr(0, globCharIdx).match(/[/|\\\\][^/\\\\]*$/);\n\t\tif (lastSlashMatch) {\n\t\t\tlet pathPortion = searchPath.substr(0, lastSlashMatch.index);\n\t\t\tif (!pathPortion.match(/[/\\\\]/)) {\n\t\t\t\t// If the last slash was the only slash, then we now have '' or 'C:' or '.'. Append a slash.\n\t\t\t\tpathPortion += '/';\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tpathPortion,\n\t\t\t\tglobPortion: searchPath.substr((lastSlashMatch.index || 0) + 1)\n\t\t\t};\n\t\t}\n\t}\n\n\t// No glob char, or malformed\n\treturn {\n\t\tpathPortion: searchPath\n\t};\n}\n\nfunction patternListToIExpression(...patterns: string[]): glob.IExpression {\n\treturn patterns.length ?\n\t\tpatterns.reduce((glob, cur) => { glob[cur] = true; return glob; }, Object.create(null)) :\n\t\tundefined;\n}\n\nfunction splitGlobPattern(pattern: string): string[] {\n\treturn glob.splitGlobAware(pattern, ',')\n\t\t.map(s => s.trim())\n\t\t.filter(s => !!s.length);\n}\n\n/**\n * Note - we used {} here previously but ripgrep can't handle nested {} patterns. See https://github.com/microsoft/vscode/issues/32761\n */\nfunction expandGlobalGlob(pattern: string): string[] {\n\tconst patterns = [\n\t\t`**/${pattern}/**`,\n\t\t`**/${pattern}`\n\t];\n\n\treturn patterns.map(p => p.replace(/\\*\\*\\/\\*\\*/g, '**'));\n}\n\nfunction normalizeSlashes(pattern: string): string {\n\treturn pattern.replace(/\\\\/g, '/');\n}\n\n/**\n * Normalize slashes, remove `./` and trailing slashes\n */\nfunction normalizeGlobPattern(pattern: string): string {\n\treturn normalizeSlashes(pattern)\n\t\t.replace(/^\\.\\//, '')\n\t\t.replace(/\\/+$/g, '');\n}\n\n/**\n * Construct an include pattern from a list of folders uris to search in.\n */\nexport function resolveResourcesForSearchIncludes(resources: URI[], contextService: IWorkspaceContextService): string[] {\n\tresources = arrays.distinct(resources, resource => resource.toString());\n\n\tconst folderPaths: string[] = [];\n\tconst workspace = contextService.getWorkspace();\n\n\tif (resources) {\n\t\tresources.forEach(resource => {\n\t\t\tlet folderPath: string | undefined;\n\t\t\tif (contextService.getWorkbenchState() === WorkbenchState.FOLDER) {\n\t\t\t\t// Show relative path from the root for single-root mode\n\t\t\t\tfolderPath = relativePath(workspace.folders[0].uri, resource); // always uses forward slashes\n\t\t\t\tif (folderPath && folderPath !== '.') {\n\t\t\t\t\tfolderPath = './' + folderPath;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst owningFolder = contextService.getWorkspaceFolder(resource);\n\t\t\t\tif (owningFolder) {\n\t\t\t\t\tconst owningRootName = owningFolder.name;\n\t\t\t\t\t// If this root is the only one with its basename, use a relative ./ path. If there is another, use an absolute path\n\t\t\t\t\tconst isUniqueFolder = workspace.folders.filter(folder => folder.name === owningRootName).length === 1;\n\t\t\t\t\tif (isUniqueFolder) {\n\t\t\t\t\t\tconst relPath = relativePath(owningFolder.uri, resource); // always uses forward slashes\n\t\t\t\t\t\tif (relPath === '') {\n\t\t\t\t\t\t\tfolderPath = `./${owningFolder.name}`;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfolderPath = `./${owningFolder.name}/${relPath}`;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfolderPath = resource.fsPath; // TODO rob: handle non-file URIs\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (folderPath) {\n\t\t\t\tfolderPaths.push(folderPath);\n\t\t\t}\n\t\t});\n\t}\n\treturn folderPaths;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as resources from 'vs/base/common/resources';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { CancellationTokenSource, CancellationToken } from 'vs/base/common/cancellation';\nimport * as errors from 'vs/base/common/errors';\nimport { ExtensionIdentifier, IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { IInstantiationService, ServicesAccessor } from 'vs/platform/instantiation/common/instantiation';\nimport { QueryBuilder } from 'vs/workbench/contrib/search/common/queryBuilder';\nimport { ISearchService } from 'vs/workbench/services/search/common/search';\nimport { toWorkspaceFolder } from 'vs/platform/workspace/common/workspace';\n\nconst WORKSPACE_CONTAINS_TIMEOUT = 7000;\n\nexport interface IExtensionActivationHost {\n\treadonly folders: readonly UriComponents[];\n\treadonly forceUsingSearch: boolean;\n\n\texists(uri: URI): Promise<boolean>;\n\tcheckExists(folders: readonly UriComponents[], includes: string[], token: CancellationToken): Promise<boolean>;\n}\n\nexport interface IExtensionActivationResult {\n\tactivationEvent: string;\n}\n\nexport function checkActivateWorkspaceContainsExtension(host: IExtensionActivationHost, desc: IExtensionDescription): Promise<IExtensionActivationResult | undefined> {\n\tconst activationEvents = desc.activationEvents;\n\tif (!activationEvents) {\n\t\treturn Promise.resolve(undefined);\n\t}\n\n\tconst fileNames: string[] = [];\n\tconst globPatterns: string[] = [];\n\n\tfor (const activationEvent of activationEvents) {\n\t\tif (/^workspaceContains:/.test(activationEvent)) {\n\t\t\tconst fileNameOrGlob = activationEvent.substr('workspaceContains:'.length);\n\t\t\tif (fileNameOrGlob.indexOf('*') >= 0 || fileNameOrGlob.indexOf('?') >= 0 || host.forceUsingSearch) {\n\t\t\t\tglobPatterns.push(fileNameOrGlob);\n\t\t\t} else {\n\t\t\t\tfileNames.push(fileNameOrGlob);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (fileNames.length === 0 && globPatterns.length === 0) {\n\t\treturn Promise.resolve(undefined);\n\t}\n\n\tlet resolveResult: (value: IExtensionActivationResult | undefined) => void;\n\tconst result = new Promise<IExtensionActivationResult | undefined>((resolve, reject) => { resolveResult = resolve; });\n\tconst activate = (activationEvent: string) => resolveResult({ activationEvent });\n\n\tconst fileNamePromise = Promise.all(fileNames.map((fileName) => _activateIfFileName(host, fileName, activate))).then(() => { });\n\tconst globPatternPromise = _activateIfGlobPatterns(host, desc.identifier, globPatterns, activate);\n\n\tPromise.all([fileNamePromise, globPatternPromise]).then(() => {\n\t\t// when all are done, resolve with undefined (relevant only if it was not activated so far)\n\t\tresolveResult(undefined);\n\t});\n\n\treturn result;\n}\n\nasync function _activateIfFileName(host: IExtensionActivationHost, fileName: string, activate: (activationEvent: string) => void): Promise<void> {\n\t// find exact path\n\tfor (const uri of host.folders) {\n\t\tif (await host.exists(resources.joinPath(URI.revive(uri), fileName))) {\n\t\t\t// the file was found\n\t\t\tactivate(`workspaceContains:${fileName}`);\n\t\t\treturn;\n\t\t}\n\t}\n}\n\nasync function _activateIfGlobPatterns(host: IExtensionActivationHost, extensionId: ExtensionIdentifier, globPatterns: string[], activate: (activationEvent: string) => void): Promise<void> {\n\tif (globPatterns.length === 0) {\n\t\treturn Promise.resolve(undefined);\n\t}\n\n\tconst tokenSource = new CancellationTokenSource();\n\tconst searchP = host.checkExists(host.folders, globPatterns, tokenSource.token);\n\n\tconst timer = setTimeout(async () => {\n\t\ttokenSource.cancel();\n\t\tactivate(`workspaceContainsTimeout:${globPatterns.join(',')}`);\n\t}, WORKSPACE_CONTAINS_TIMEOUT);\n\n\tlet exists: boolean = false;\n\ttry {\n\t\texists = await searchP;\n\t} catch (err) {\n\t\tif (!errors.isPromiseCanceledError(err)) {\n\t\t\terrors.onUnexpectedError(err);\n\t\t}\n\t}\n\n\ttokenSource.dispose();\n\tclearTimeout(timer);\n\n\tif (exists) {\n\t\t// a file was found matching one of the glob patterns\n\t\tactivate(`workspaceContains:${globPatterns.join(',')}`);\n\t}\n}\n\nexport function checkGlobFileExists(\n\taccessor: ServicesAccessor,\n\tfolders: readonly UriComponents[],\n\tincludes: string[],\n\ttoken: CancellationToken,\n): Promise<boolean> {\n\tconst instantiationService = accessor.get(IInstantiationService);\n\tconst searchService = accessor.get(ISearchService);\n\tconst queryBuilder = instantiationService.createInstance(QueryBuilder);\n\tconst query = queryBuilder.file(folders.map(folder => toWorkspaceFolder(URI.revive(folder))), {\n\t\t_reason: 'checkExists',\n\t\tincludePattern: includes,\n\t\texists: true\n\t});\n\n\treturn searchService.fileSearch(query, token).then(\n\t\tresult => {\n\t\t\treturn !!result.limitHit;\n\t\t},\n\t\terr => {\n\t\t\tif (!errors.isPromiseCanceledError(err)) {\n\t\t\t\treturn Promise.reject(err);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t});\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as nls from 'vs/nls';\nimport * as path from 'vs/base/common/path';\nimport * as performance from 'vs/base/common/performance';\nimport { originalFSPath, joinPath } from 'vs/base/common/resources';\nimport { Barrier, timeout } from 'vs/base/common/async';\nimport { dispose, toDisposable, DisposableStore, Disposable } from 'vs/base/common/lifecycle';\nimport { TernarySearchTree } from 'vs/base/common/map';\nimport { URI } from 'vs/base/common/uri';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { ExtHostExtensionServiceShape, IInitData, MainContext, MainThreadExtensionServiceShape, MainThreadTelemetryShape, MainThreadWorkspaceShape, IResolveAuthorityResult } from 'vs/workbench/api/common/extHost.protocol';\nimport { ExtHostConfiguration, IExtHostConfiguration } from 'vs/workbench/api/common/extHostConfiguration';\nimport { ActivatedExtension, EmptyExtension, ExtensionActivationReason, ExtensionActivationTimes, ExtensionActivationTimesBuilder, ExtensionsActivator, IExtensionAPI, IExtensionModule, HostExtension, ExtensionActivationTimesFragment } from 'vs/workbench/api/common/extHostExtensionActivator';\nimport { ExtHostStorage, IExtHostStorage } from 'vs/workbench/api/common/extHostStorage';\nimport { ExtHostWorkspace, IExtHostWorkspace } from 'vs/workbench/api/common/extHostWorkspace';\nimport { ExtensionActivationError, checkProposedApiEnabled, ActivationKind } from 'vs/workbench/services/extensions/common/extensions';\nimport { ExtensionDescriptionRegistry } from 'vs/workbench/services/extensions/common/extensionDescriptionRegistry';\nimport * as errors from 'vs/base/common/errors';\nimport type * as vscode from 'vscode';\nimport { ExtensionIdentifier, IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { Schemas } from 'vs/base/common/network';\nimport { VSBuffer } from 'vs/base/common/buffer';\nimport { ExtensionGlobalMemento, ExtensionMemento } from 'vs/workbench/api/common/extHostMemento';\nimport { RemoteAuthorityResolverError, ExtensionMode, ExtensionRuntime } from 'vs/workbench/api/common/extHostTypes';\nimport { ResolvedAuthority, ResolvedOptions, RemoteAuthorityResolverErrorCode, IRemoteConnectionData } from 'vs/platform/remote/common/remoteAuthorityResolver';\nimport { IInstantiationService, createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { IExtHostInitDataService } from 'vs/workbench/api/common/extHostInitDataService';\nimport { IExtensionStoragePaths } from 'vs/workbench/api/common/extHostStoragePaths';\nimport { IExtHostRpcService } from 'vs/workbench/api/common/extHostRpcService';\nimport { ServiceCollection } from 'vs/platform/instantiation/common/serviceCollection';\nimport { IExtHostTunnelService } from 'vs/workbench/api/common/extHostTunnelService';\nimport { IExtHostTerminalService } from 'vs/workbench/api/common/extHostTerminalService';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { IExtensionActivationHost, checkActivateWorkspaceContainsExtension } from 'vs/workbench/api/common/shared/workspaceContains';\nimport { ExtHostSecretState, IExtHostSecretState } from 'vs/workbench/api/common/exHostSecretState';\nimport { ExtensionSecrets } from 'vs/workbench/api/common/extHostSecrets';\n\ninterface ITestRunner {\n\t/** Old test runner API, as exported from `vscode/lib/testrunner` */\n\trun(testsRoot: string, clb: (error: Error, failures?: number) => void): void;\n}\n\ninterface INewTestRunner {\n\t/** New test runner API, as explained in the extension test doc */\n\trun(): Promise<void>;\n}\n\nexport const IHostUtils = createDecorator<IHostUtils>('IHostUtils');\n\nexport interface IHostUtils {\n\treadonly _serviceBrand: undefined;\n\texit(code: number): void;\n\texists(path: string): Promise<boolean>;\n\trealpath(path: string): Promise<string>;\n}\n\ntype TelemetryActivationEventFragment = {\n\tid: { classification: 'PublicNonPersonalData', purpose: 'FeatureInsight' };\n\tname: { classification: 'PublicNonPersonalData', purpose: 'FeatureInsight' };\n\textensionVersion: { classification: 'PublicNonPersonalData', purpose: 'FeatureInsight' };\n\tpublisherDisplayName: { classification: 'SystemMetaData', purpose: 'FeatureInsight' };\n\tactivationEvents: { classification: 'SystemMetaData', purpose: 'FeatureInsight' };\n\tisBuiltin: { classification: 'SystemMetaData', purpose: 'FeatureInsight', isMeasurement: true };\n\treason: { classification: 'SystemMetaData', purpose: 'FeatureInsight' };\n\treasonId: { classification: 'PublicNonPersonalData', purpose: 'FeatureInsight' };\n};\n\nexport abstract class AbstractExtHostExtensionService extends Disposable implements ExtHostExtensionServiceShape {\n\n\treadonly _serviceBrand: undefined;\n\n\tabstract readonly extensionRuntime: ExtensionRuntime;\n\n\tprivate readonly _onDidChangeRemoteConnectionData = this._register(new Emitter<void>());\n\tpublic readonly onDidChangeRemoteConnectionData = this._onDidChangeRemoteConnectionData.event;\n\n\tprotected readonly _hostUtils: IHostUtils;\n\tprotected readonly _initData: IInitData;\n\tprotected readonly _extHostContext: IExtHostRpcService;\n\tprotected readonly _instaService: IInstantiationService;\n\tprotected readonly _extHostWorkspace: ExtHostWorkspace;\n\tprotected readonly _extHostConfiguration: ExtHostConfiguration;\n\tprotected readonly _logService: ILogService;\n\tprotected readonly _extHostTunnelService: IExtHostTunnelService;\n\tprotected readonly _extHostTerminalService: IExtHostTerminalService;\n\n\tprotected readonly _mainThreadWorkspaceProxy: MainThreadWorkspaceShape;\n\tprotected readonly _mainThreadTelemetryProxy: MainThreadTelemetryShape;\n\tprotected readonly _mainThreadExtensionsProxy: MainThreadExtensionServiceShape;\n\n\tprivate readonly _almostReadyToRunExtensions: Barrier;\n\tprivate readonly _readyToStartExtensionHost: Barrier;\n\tprivate readonly _readyToRunExtensions: Barrier;\n\tprotected readonly _registry: ExtensionDescriptionRegistry;\n\tprivate readonly _storage: ExtHostStorage;\n\tprivate readonly _secretState: ExtHostSecretState;\n\tprivate readonly _storagePath: IExtensionStoragePaths;\n\tprivate readonly _activator: ExtensionsActivator;\n\tprivate _extensionPathIndex: Promise<TernarySearchTree<string, IExtensionDescription>> | null;\n\n\tprivate readonly _resolvers: { [authorityPrefix: string]: vscode.RemoteAuthorityResolver; };\n\n\tprivate _started: boolean;\n\tprivate _remoteConnectionData: IRemoteConnectionData | null;\n\n\tprivate readonly _disposables: DisposableStore;\n\n\tconstructor(\n\t\t@IInstantiationService instaService: IInstantiationService,\n\t\t@IHostUtils hostUtils: IHostUtils,\n\t\t@IExtHostRpcService extHostContext: IExtHostRpcService,\n\t\t@IExtHostWorkspace extHostWorkspace: IExtHostWorkspace,\n\t\t@IExtHostConfiguration extHostConfiguration: IExtHostConfiguration,\n\t\t@ILogService logService: ILogService,\n\t\t@IExtHostInitDataService initData: IExtHostInitDataService,\n\t\t@IExtensionStoragePaths storagePath: IExtensionStoragePaths,\n\t\t@IExtHostTunnelService extHostTunnelService: IExtHostTunnelService,\n\t\t@IExtHostTerminalService extHostTerminalService: IExtHostTerminalService,\n\t) {\n\t\tsuper();\n\t\tthis._hostUtils = hostUtils;\n\t\tthis._extHostContext = extHostContext;\n\t\tthis._initData = initData;\n\n\t\tthis._extHostWorkspace = extHostWorkspace;\n\t\tthis._extHostConfiguration = extHostConfiguration;\n\t\tthis._logService = logService;\n\t\tthis._extHostTunnelService = extHostTunnelService;\n\t\tthis._extHostTerminalService = extHostTerminalService;\n\t\tthis._disposables = new DisposableStore();\n\n\t\tthis._mainThreadWorkspaceProxy = this._extHostContext.getProxy(MainContext.MainThreadWorkspace);\n\t\tthis._mainThreadTelemetryProxy = this._extHostContext.getProxy(MainContext.MainThreadTelemetry);\n\t\tthis._mainThreadExtensionsProxy = this._extHostContext.getProxy(MainContext.MainThreadExtensionService);\n\n\t\tthis._almostReadyToRunExtensions = new Barrier();\n\t\tthis._readyToStartExtensionHost = new Barrier();\n\t\tthis._readyToRunExtensions = new Barrier();\n\t\tthis._registry = new ExtensionDescriptionRegistry(this._initData.extensions);\n\t\tthis._storage = new ExtHostStorage(this._extHostContext);\n\t\tthis._secretState = new ExtHostSecretState(this._extHostContext);\n\t\tthis._storagePath = storagePath;\n\n\t\tthis._instaService = instaService.createChild(new ServiceCollection(\n\t\t\t[IExtHostStorage, this._storage],\n\t\t\t[IExtHostSecretState, this._secretState]\n\t\t));\n\n\t\tconst hostExtensions = new Set<string>();\n\t\tthis._initData.hostExtensions.forEach((extensionId) => hostExtensions.add(ExtensionIdentifier.toKey(extensionId)));\n\n\t\tthis._activator = new ExtensionsActivator(\n\t\t\tthis._registry,\n\t\t\tthis._initData.resolvedExtensions,\n\t\t\tthis._initData.hostExtensions,\n\t\t\t{\n\t\t\t\tonExtensionActivationError: (extensionId: ExtensionIdentifier, error: ExtensionActivationError): void => {\n\t\t\t\t\tthis._mainThreadExtensionsProxy.$onExtensionActivationError(extensionId, error);\n\t\t\t\t},\n\n\t\t\t\tactualActivateExtension: async (extensionId: ExtensionIdentifier, reason: ExtensionActivationReason): Promise<ActivatedExtension> => {\n\t\t\t\t\tif (hostExtensions.has(ExtensionIdentifier.toKey(extensionId))) {\n\t\t\t\t\t\tawait this._mainThreadExtensionsProxy.$activateExtension(extensionId, reason);\n\t\t\t\t\t\treturn new HostExtension();\n\t\t\t\t\t}\n\t\t\t\t\tconst extensionDescription = this._registry.getExtensionDescription(extensionId)!;\n\t\t\t\t\treturn this._activateExtension(extensionDescription, reason);\n\t\t\t\t}\n\t\t\t},\n\t\t\tthis._logService\n\t\t);\n\t\tthis._extensionPathIndex = null;\n\t\tthis._resolvers = Object.create(null);\n\t\tthis._started = false;\n\t\tthis._remoteConnectionData = this._initData.remote.connectionData;\n\t}\n\n\tpublic getRemoteConnectionData(): IRemoteConnectionData | null {\n\t\treturn this._remoteConnectionData;\n\t}\n\n\tpublic async initialize(): Promise<void> {\n\t\ttry {\n\n\t\t\tawait this._beforeAlmostReadyToRunExtensions();\n\t\t\tthis._almostReadyToRunExtensions.open();\n\n\t\t\tawait this._extHostWorkspace.waitForInitializeCall();\n\t\t\tperformance.mark('code/extHost/ready');\n\t\t\tthis._readyToStartExtensionHost.open();\n\n\t\t\tif (this._initData.autoStart) {\n\t\t\t\tthis._startExtensionHost();\n\t\t\t}\n\t\t} catch (err) {\n\t\t\terrors.onUnexpectedError(err);\n\t\t}\n\t}\n\n\tpublic async deactivateAll(): Promise<void> {\n\t\tlet allPromises: Promise<void>[] = [];\n\t\ttry {\n\t\t\tconst allExtensions = this._registry.getAllExtensionDescriptions();\n\t\t\tconst allExtensionsIds = allExtensions.map(ext => ext.identifier);\n\t\t\tconst activatedExtensions = allExtensionsIds.filter(id => this.isActivated(id));\n\n\t\t\tallPromises = activatedExtensions.map((extensionId) => {\n\t\t\t\treturn this._deactivate(extensionId);\n\t\t\t});\n\t\t} catch (err) {\n\t\t\t// TODO: write to log once we have one\n\t\t}\n\t\tawait Promise.all(allPromises);\n\t}\n\n\tpublic isActivated(extensionId: ExtensionIdentifier): boolean {\n\t\tif (this._readyToRunExtensions.isOpen()) {\n\t\t\treturn this._activator.isActivated(extensionId);\n\t\t}\n\t\treturn false;\n\t}\n\n\tprivate _activateByEvent(activationEvent: string, startup: boolean): Promise<void> {\n\t\treturn this._activator.activateByEvent(activationEvent, startup);\n\t}\n\n\tprivate _activateById(extensionId: ExtensionIdentifier, reason: ExtensionActivationReason): Promise<void> {\n\t\treturn this._activator.activateById(extensionId, reason);\n\t}\n\n\tpublic activateByIdWithErrors(extensionId: ExtensionIdentifier, reason: ExtensionActivationReason): Promise<void> {\n\t\treturn this._activateById(extensionId, reason).then(() => {\n\t\t\tconst extension = this._activator.getActivatedExtension(extensionId);\n\t\t\tif (extension.activationFailed) {\n\t\t\t\t// activation failed => bubble up the error as the promise result\n\t\t\t\treturn Promise.reject(extension.activationFailedError);\n\t\t\t}\n\t\t\treturn undefined;\n\t\t});\n\t}\n\n\tpublic getExtensionRegistry(): Promise<ExtensionDescriptionRegistry> {\n\t\treturn this._readyToRunExtensions.wait().then(_ => this._registry);\n\t}\n\n\tpublic getExtensionExports(extensionId: ExtensionIdentifier): IExtensionAPI | null | undefined {\n\t\tif (this._readyToRunExtensions.isOpen()) {\n\t\t\treturn this._activator.getActivatedExtension(extensionId).exports;\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t// create trie to enable fast 'filename -> extension id' look up\n\tpublic getExtensionPathIndex(): Promise<TernarySearchTree<string, IExtensionDescription>> {\n\t\tif (!this._extensionPathIndex) {\n\t\t\tconst tree = TernarySearchTree.forPaths<IExtensionDescription>();\n\t\t\tconst extensions = this._registry.getAllExtensionDescriptions().map(ext => {\n\t\t\t\tif (!this._getEntryPoint(ext)) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\treturn this._hostUtils.realpath(ext.extensionLocation.fsPath).then(value => tree.set(URI.file(value).fsPath, ext));\n\t\t\t});\n\t\t\tthis._extensionPathIndex = Promise.all(extensions).then(() => tree);\n\t\t}\n\t\treturn this._extensionPathIndex;\n\t}\n\n\tprivate _deactivate(extensionId: ExtensionIdentifier): Promise<void> {\n\t\tlet result = Promise.resolve(undefined);\n\n\t\tif (!this._readyToRunExtensions.isOpen()) {\n\t\t\treturn result;\n\t\t}\n\n\t\tif (!this._activator.isActivated(extensionId)) {\n\t\t\treturn result;\n\t\t}\n\n\t\tconst extension = this._activator.getActivatedExtension(extensionId);\n\t\tif (!extension) {\n\t\t\treturn result;\n\t\t}\n\n\t\t// call deactivate if available\n\t\ttry {\n\t\t\tif (typeof extension.module.deactivate === 'function') {\n\t\t\t\tresult = Promise.resolve(extension.module.deactivate()).then(undefined, (err) => {\n\t\t\t\t\t// TODO: Do something with err if this is not the shutdown case\n\t\t\t\t\treturn Promise.resolve(undefined);\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (err) {\n\t\t\t// TODO: Do something with err if this is not the shutdown case\n\t\t}\n\n\t\t// clean up subscriptions\n\t\ttry {\n\t\t\tdispose(extension.subscriptions);\n\t\t} catch (err) {\n\t\t\t// TODO: Do something with err if this is not the shutdown case\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t// --- impl\n\n\tprivate async _activateExtension(extensionDescription: IExtensionDescription, reason: ExtensionActivationReason): Promise<ActivatedExtension> {\n\t\tif (!this._initData.remote.isRemote) {\n\t\t\t// local extension host process\n\t\t\tawait this._mainThreadExtensionsProxy.$onWillActivateExtension(extensionDescription.identifier);\n\t\t} else {\n\t\t\t// remote extension host process\n\t\t\t// do not wait for renderer confirmation\n\t\t\tthis._mainThreadExtensionsProxy.$onWillActivateExtension(extensionDescription.identifier);\n\t\t}\n\t\treturn this._doActivateExtension(extensionDescription, reason).then((activatedExtension) => {\n\t\t\tconst activationTimes = activatedExtension.activationTimes;\n\t\t\tthis._mainThreadExtensionsProxy.$onDidActivateExtension(extensionDescription.identifier, activationTimes.codeLoadingTime, activationTimes.activateCallTime, activationTimes.activateResolvedTime, reason);\n\t\t\tthis._logExtensionActivationTimes(extensionDescription, reason, 'success', activationTimes);\n\t\t\treturn activatedExtension;\n\t\t}, (err) => {\n\t\t\tthis._logExtensionActivationTimes(extensionDescription, reason, 'failure');\n\t\t\tthrow err;\n\t\t});\n\t}\n\n\tprivate _logExtensionActivationTimes(extensionDescription: IExtensionDescription, reason: ExtensionActivationReason, outcome: string, activationTimes?: ExtensionActivationTimes) {\n\t\tconst event = getTelemetryActivationEvent(extensionDescription, reason);\n\t\ttype ExtensionActivationTimesClassification = {\n\t\t\toutcome: { classification: 'SystemMetaData', purpose: 'FeatureInsight' };\n\t\t} & TelemetryActivationEventFragment & ExtensionActivationTimesFragment;\n\n\t\ttype ExtensionActivationTimesEvent = {\n\t\t\toutcome: string\n\t\t} & ActivationTimesEvent & TelemetryActivationEvent;\n\n\t\ttype ActivationTimesEvent = {\n\t\t\tstartup?: boolean;\n\t\t\tcodeLoadingTime?: number;\n\t\t\tactivateCallTime?: number;\n\t\t\tactivateResolvedTime?: number;\n\t\t};\n\n\t\tthis._mainThreadTelemetryProxy.$publicLog2<ExtensionActivationTimesEvent, ExtensionActivationTimesClassification>('extensionActivationTimes', {\n\t\t\t...event,\n\t\t\t...(activationTimes || {}),\n\t\t\toutcome\n\t\t});\n\t}\n\n\tprivate _doActivateExtension(extensionDescription: IExtensionDescription, reason: ExtensionActivationReason): Promise<ActivatedExtension> {\n\t\tconst event = getTelemetryActivationEvent(extensionDescription, reason);\n\t\ttype ActivatePluginClassification = {} & TelemetryActivationEventFragment;\n\t\tthis._mainThreadTelemetryProxy.$publicLog2<TelemetryActivationEvent, ActivatePluginClassification>('activatePlugin', event);\n\t\tconst entryPoint = this._getEntryPoint(extensionDescription);\n\t\tif (!entryPoint) {\n\t\t\t// Treat the extension as being empty => NOT AN ERROR CASE\n\t\t\treturn Promise.resolve(new EmptyExtension(ExtensionActivationTimes.NONE));\n\t\t}\n\n\t\tthis._logService.info(`ExtensionService#_doActivateExtension ${extensionDescription.identifier.value} ${JSON.stringify(reason)}`);\n\t\tthis._logService.flush();\n\n\t\tconst activationTimesBuilder = new ExtensionActivationTimesBuilder(reason.startup);\n\t\treturn Promise.all([\n\t\t\tthis._loadCommonJSModule<IExtensionModule>(extensionDescription.identifier, joinPath(extensionDescription.extensionLocation, entryPoint), activationTimesBuilder),\n\t\t\tthis._loadExtensionContext(extensionDescription)\n\t\t]).then(values => {\n\t\t\tperformance.mark(`code/extHost/willActivateExtension/${extensionDescription.identifier.value}`);\n\t\t\treturn AbstractExtHostExtensionService._callActivate(this._logService, extensionDescription.identifier, values[0], values[1], activationTimesBuilder);\n\t\t}).then((activatedExtension) => {\n\t\t\tperformance.mark(`code/extHost/didActivateExtension/${extensionDescription.identifier.value}`);\n\t\t\treturn activatedExtension;\n\t\t});\n\t}\n\n\tprivate _loadExtensionContext(extensionDescription: IExtensionDescription): Promise<vscode.ExtensionContext> {\n\n\t\tconst globalState = new ExtensionGlobalMemento(extensionDescription, this._storage);\n\t\tconst workspaceState = new ExtensionMemento(extensionDescription.identifier.value, false, this._storage);\n\t\tconst secrets = new ExtensionSecrets(extensionDescription, this._secretState);\n\t\tconst extensionMode = extensionDescription.isUnderDevelopment\n\t\t\t? (this._initData.environment.extensionTestsLocationURI ? ExtensionMode.Test : ExtensionMode.Development)\n\t\t\t: ExtensionMode.Production;\n\n\t\tthis._logService.trace(`ExtensionService#loadExtensionContext ${extensionDescription.identifier.value}`);\n\n\t\treturn Promise.all([\n\t\t\tglobalState.whenReady,\n\t\t\tworkspaceState.whenReady,\n\t\t\tthis._storagePath.whenReady\n\t\t]).then(() => {\n\t\t\tconst that = this;\n\t\t\treturn Object.freeze<vscode.ExtensionContext>({\n\t\t\t\tglobalState,\n\t\t\t\tworkspaceState,\n\t\t\t\tsecrets,\n\t\t\t\tsubscriptions: [],\n\t\t\t\tget extensionUri() { return extensionDescription.extensionLocation; },\n\t\t\t\tget extensionPath() { return extensionDescription.extensionLocation.fsPath; },\n\t\t\t\tasAbsolutePath(relativePath: string) { return path.join(extensionDescription.extensionLocation.fsPath, relativePath); },\n\t\t\t\tget storagePath() { return that._storagePath.workspaceValue(extensionDescription)?.fsPath; },\n\t\t\t\tget globalStoragePath() { return that._storagePath.globalValue(extensionDescription).fsPath; },\n\t\t\t\tget logPath() { return path.join(that._initData.logsLocation.fsPath, extensionDescription.identifier.value); },\n\t\t\t\tget logUri() { return URI.joinPath(that._initData.logsLocation, extensionDescription.identifier.value); },\n\t\t\t\tget storageUri() { return that._storagePath.workspaceValue(extensionDescription); },\n\t\t\t\tget globalStorageUri() { return that._storagePath.globalValue(extensionDescription); },\n\t\t\t\tget extensionMode() { return extensionMode; },\n\t\t\t\tget extensionRuntime() {\n\t\t\t\t\tcheckProposedApiEnabled(extensionDescription);\n\t\t\t\t\treturn that.extensionRuntime;\n\t\t\t\t},\n\t\t\t\tget environmentVariableCollection() { return that._extHostTerminalService.getEnvironmentVariableCollection(extensionDescription); }\n\t\t\t});\n\t\t});\n\t}\n\n\tprivate static _callActivate(logService: ILogService, extensionId: ExtensionIdentifier, extensionModule: IExtensionModule, context: vscode.ExtensionContext, activationTimesBuilder: ExtensionActivationTimesBuilder): Promise<ActivatedExtension> {\n\t\t// Make sure the extension's surface is not undefined\n\t\textensionModule = extensionModule || {\n\t\t\tactivate: undefined,\n\t\t\tdeactivate: undefined\n\t\t};\n\n\t\treturn this._callActivateOptional(logService, extensionId, extensionModule, context, activationTimesBuilder).then((extensionExports) => {\n\t\t\treturn new ActivatedExtension(false, null, activationTimesBuilder.build(), extensionModule, extensionExports, context.subscriptions);\n\t\t});\n\t}\n\n\tprivate static _callActivateOptional(logService: ILogService, extensionId: ExtensionIdentifier, extensionModule: IExtensionModule, context: vscode.ExtensionContext, activationTimesBuilder: ExtensionActivationTimesBuilder): Promise<IExtensionAPI> {\n\t\tif (typeof extensionModule.activate === 'function') {\n\t\t\ttry {\n\t\t\t\tactivationTimesBuilder.activateCallStart();\n\t\t\t\tlogService.trace(`ExtensionService#_callActivateOptional ${extensionId.value}`);\n\t\t\t\tconst scope = typeof global === 'object' ? global : self; // `global` is nodejs while `self` is for workers\n\t\t\t\tconst activateResult: Promise<IExtensionAPI> = extensionModule.activate.apply(scope, [context]);\n\t\t\t\tactivationTimesBuilder.activateCallStop();\n\n\t\t\t\tactivationTimesBuilder.activateResolveStart();\n\t\t\t\treturn Promise.resolve(activateResult).then((value) => {\n\t\t\t\t\tactivationTimesBuilder.activateResolveStop();\n\t\t\t\t\treturn value;\n\t\t\t\t});\n\t\t\t} catch (err) {\n\t\t\t\treturn Promise.reject(err);\n\t\t\t}\n\t\t} else {\n\t\t\t// No activate found => the module is the extension's exports\n\t\t\treturn Promise.resolve<IExtensionAPI>(extensionModule);\n\t\t}\n\t}\n\n\t// -- eager activation\n\n\tprivate _activateOneStartupFinished(desc: IExtensionDescription, activationEvent: string): void {\n\t\tthis._activateById(desc.identifier, {\n\t\t\tstartup: false,\n\t\t\textensionId: desc.identifier,\n\t\t\tactivationEvent: activationEvent\n\t\t}).then(undefined, (err) => {\n\t\t\tthis._logService.error(err);\n\t\t});\n\t}\n\n\tprivate _activateAllStartupFinished(): void {\n\t\t// startup is considered finished\n\t\tthis._mainThreadExtensionsProxy.$setPerformanceMarks(performance.getMarks());\n\n\t\tfor (const desc of this._registry.getAllExtensionDescriptions()) {\n\t\t\tif (desc.activationEvents) {\n\t\t\t\tfor (const activationEvent of desc.activationEvents) {\n\t\t\t\t\tif (activationEvent === 'onStartupFinished') {\n\t\t\t\t\t\tthis._activateOneStartupFinished(desc, activationEvent);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Handle \"eager\" activation extensions\n\tprivate _handleEagerExtensions(): Promise<void> {\n\t\tconst starActivation = this._activateByEvent('*', true).then(undefined, (err) => {\n\t\t\tthis._logService.error(err);\n\t\t});\n\n\t\tthis._disposables.add(this._extHostWorkspace.onDidChangeWorkspace((e) => this._handleWorkspaceContainsEagerExtensions(e.added)));\n\t\tconst folders = this._extHostWorkspace.workspace ? this._extHostWorkspace.workspace.folders : [];\n\t\tconst workspaceContainsActivation = this._handleWorkspaceContainsEagerExtensions(folders);\n\t\tconst eagerExtensionsActivation = Promise.all([starActivation, workspaceContainsActivation]).then(() => { });\n\n\t\tPromise.race([eagerExtensionsActivation, timeout(10000)]).then(() => {\n\t\t\tthis._activateAllStartupFinished();\n\t\t});\n\n\t\treturn eagerExtensionsActivation;\n\t}\n\n\tprivate _handleWorkspaceContainsEagerExtensions(folders: ReadonlyArray<vscode.WorkspaceFolder>): Promise<void> {\n\t\tif (folders.length === 0) {\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\n\t\treturn Promise.all(\n\t\t\tthis._registry.getAllExtensionDescriptions().map((desc) => {\n\t\t\t\treturn this._handleWorkspaceContainsEagerExtension(folders, desc);\n\t\t\t})\n\t\t).then(() => { });\n\t}\n\n\tprivate async _handleWorkspaceContainsEagerExtension(folders: ReadonlyArray<vscode.WorkspaceFolder>, desc: IExtensionDescription): Promise<void> {\n\t\tif (this.isActivated(desc.identifier)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst localWithRemote = !this._initData.remote.isRemote && !!this._initData.remote.authority;\n\t\tconst host: IExtensionActivationHost = {\n\t\t\tfolders: folders.map(folder => folder.uri),\n\t\t\tforceUsingSearch: localWithRemote,\n\t\t\texists: (uri) => this._hostUtils.exists(uri.fsPath),\n\t\t\tcheckExists: (folders, includes, token) => this._mainThreadWorkspaceProxy.$checkExists(folders, includes, token)\n\t\t};\n\n\t\tconst result = await checkActivateWorkspaceContainsExtension(host, desc);\n\t\tif (!result) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn (\n\t\t\tthis._activateById(desc.identifier, { startup: true, extensionId: desc.identifier, activationEvent: result.activationEvent })\n\t\t\t\t.then(undefined, err => this._logService.error(err))\n\t\t);\n\t}\n\n\tprivate _handleExtensionTests(): Promise<void> {\n\t\treturn this._doHandleExtensionTests().then(undefined, error => {\n\t\t\tconsole.error(error); // ensure any error message makes it onto the console\n\n\t\t\treturn Promise.reject(error);\n\t\t});\n\t}\n\n\tprivate async _doHandleExtensionTests(): Promise<void> {\n\t\tconst { extensionDevelopmentLocationURI, extensionTestsLocationURI } = this._initData.environment;\n\t\tif (!(extensionDevelopmentLocationURI && extensionTestsLocationURI && extensionTestsLocationURI.scheme === Schemas.file)) {\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\n\t\tconst extensionTestsPath = originalFSPath(extensionTestsLocationURI);\n\n\t\t// Require the test runner via node require from the provided path\n\t\tlet testRunner: ITestRunner | INewTestRunner | undefined;\n\t\tlet requireError: Error | undefined;\n\t\ttry {\n\t\t\ttestRunner = await this._loadCommonJSModule(null, URI.file(extensionTestsPath), new ExtensionActivationTimesBuilder(false));\n\t\t} catch (error) {\n\t\t\trequireError = error;\n\t\t}\n\n\t\t// Execute the runner if it follows the old `run` spec\n\t\tif (testRunner && typeof testRunner.run === 'function') {\n\t\t\treturn new Promise<void>((c, e) => {\n\t\t\t\tconst oldTestRunnerCallback = (error: Error, failures: number | undefined) => {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\te(error.toString());\n\t\t\t\t\t} else {\n\t\t\t\t\t\tc(undefined);\n\t\t\t\t\t}\n\n\t\t\t\t\t// after tests have run, we shutdown the host\n\t\t\t\t\tthis._testRunnerExit(error || (typeof failures === 'number' && failures > 0) ? 1 /* ERROR */ : 0 /* OK */);\n\t\t\t\t};\n\n\t\t\t\tconst runResult = testRunner!.run(extensionTestsPath, oldTestRunnerCallback);\n\n\t\t\t\t// Using the new API `run(): Promise<void>`\n\t\t\t\tif (runResult && runResult.then) {\n\t\t\t\t\trunResult\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\tc();\n\t\t\t\t\t\t\tthis._testRunnerExit(0);\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((err: Error) => {\n\t\t\t\t\t\t\te(err.toString());\n\t\t\t\t\t\t\tthis._testRunnerExit(1);\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// Otherwise make sure to shutdown anyway even in case of an error\n\t\telse {\n\t\t\tthis._testRunnerExit(1 /* ERROR */);\n\t\t}\n\n\t\treturn Promise.reject(new Error(requireError ? requireError.toString() : nls.localize('extensionTestError', \"Path {0} does not point to a valid extension test runner.\", extensionTestsPath)));\n\t}\n\n\tprivate _testRunnerExit(code: number): void {\n\t\tthis._logService.info(`extension host terminating: test runner requested exit with code ${code}`);\n\t\tthis._logService.flush();\n\n\t\t// wait at most 5000ms for the renderer to confirm our exit request and for the renderer socket to drain\n\t\t// (this is to ensure all outstanding messages reach the renderer)\n\t\tconst exitPromise = this._mainThreadExtensionsProxy.$onExtensionHostExit(code);\n\t\tconst drainPromise = this._extHostContext.drain();\n\t\tPromise.race([Promise.all([exitPromise, drainPromise]), timeout(5000)]).then(() => {\n\t\t\tthis._logService.info(`exiting with code ${code}`);\n\t\t\tthis._logService.flush();\n\n\t\t\tthis._hostUtils.exit(code);\n\t\t});\n\t}\n\n\tprivate _startExtensionHost(): Promise<void> {\n\t\tif (this._started) {\n\t\t\tthrow new Error(`Extension host is already started!`);\n\t\t}\n\t\tthis._started = true;\n\n\t\treturn this._readyToStartExtensionHost.wait()\n\t\t\t.then(() => this._readyToRunExtensions.open())\n\t\t\t.then(() => this._handleEagerExtensions())\n\t\t\t.then(() => this._handleExtensionTests())\n\t\t\t.then(() => {\n\t\t\t\tthis._logService.info(`eager extensions activated`);\n\t\t\t});\n\t}\n\n\t// -- called by extensions\n\n\tpublic registerRemoteAuthorityResolver(authorityPrefix: string, resolver: vscode.RemoteAuthorityResolver): vscode.Disposable {\n\t\tthis._resolvers[authorityPrefix] = resolver;\n\t\treturn toDisposable(() => {\n\t\t\tdelete this._resolvers[authorityPrefix];\n\t\t});\n\t}\n\n\t// -- called by main thread\n\n\tpublic async $resolveAuthority(remoteAuthority: string, resolveAttempt: number): Promise<IResolveAuthorityResult> {\n\t\tconst authorityPlusIndex = remoteAuthority.indexOf('+');\n\t\tif (authorityPlusIndex === -1) {\n\t\t\tthrow new Error(`Not an authority that can be resolved!`);\n\t\t}\n\t\tconst authorityPrefix = remoteAuthority.substr(0, authorityPlusIndex);\n\n\t\tawait this._almostReadyToRunExtensions.wait();\n\t\tawait this._activateByEvent(`onResolveRemoteAuthority:${authorityPrefix}`, false);\n\n\t\tconst resolver = this._resolvers[authorityPrefix];\n\t\tif (!resolver) {\n\t\t\treturn {\n\t\t\t\ttype: 'error',\n\t\t\t\terror: {\n\t\t\t\t\tcode: RemoteAuthorityResolverErrorCode.NoResolverFound,\n\t\t\t\t\tmessage: `No remote extension installed to resolve ${authorityPrefix}.`,\n\t\t\t\t\tdetail: undefined\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\ttry {\n\t\t\tperformance.mark(`code/extHost/willResolveAuthority/${authorityPrefix}`);\n\t\t\tconst result = await resolver.resolve(remoteAuthority, { resolveAttempt });\n\t\t\tperformance.mark(`code/extHost/didResolveAuthorityOK/${authorityPrefix}`);\n\t\t\tthis._disposables.add(await this._extHostTunnelService.setTunnelExtensionFunctions(resolver));\n\n\t\t\t// Split merged API result into separate authority/options\n\t\t\tconst authority: ResolvedAuthority = {\n\t\t\t\tauthority: remoteAuthority,\n\t\t\t\thost: result.host,\n\t\t\t\tport: result.port,\n\t\t\t\tconnectionToken: result.connectionToken\n\t\t\t};\n\t\t\tconst options: ResolvedOptions = {\n\t\t\t\textensionHostEnv: result.extensionHostEnv\n\t\t\t};\n\n\t\t\treturn {\n\t\t\t\ttype: 'ok',\n\t\t\t\tvalue: {\n\t\t\t\t\tauthority,\n\t\t\t\t\toptions,\n\t\t\t\t\ttunnelInformation: { environmentTunnels: result.environmentTunnels }\n\t\t\t\t}\n\t\t\t};\n\t\t} catch (err) {\n\t\t\tperformance.mark(`code/extHost/didResolveAuthorityError/${authorityPrefix}`);\n\t\t\tif (err instanceof RemoteAuthorityResolverError) {\n\t\t\t\treturn {\n\t\t\t\t\ttype: 'error',\n\t\t\t\t\terror: {\n\t\t\t\t\t\tcode: err._code,\n\t\t\t\t\t\tmessage: err._message,\n\t\t\t\t\t\tdetail: err._detail\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t\tthrow err;\n\t\t}\n\t}\n\n\tpublic $startExtensionHost(enabledExtensionIds: ExtensionIdentifier[]): Promise<void> {\n\t\tthis._registry.keepOnly(enabledExtensionIds);\n\t\treturn this._startExtensionHost();\n\t}\n\n\tpublic $activateByEvent(activationEvent: string, activationKind: ActivationKind): Promise<void> {\n\t\tif (activationKind === ActivationKind.Immediate) {\n\t\t\treturn this._activateByEvent(activationEvent, false);\n\t\t}\n\n\t\treturn (\n\t\t\tthis._readyToRunExtensions.wait()\n\t\t\t\t.then(_ => this._activateByEvent(activationEvent, false))\n\t\t);\n\t}\n\n\tpublic async $activate(extensionId: ExtensionIdentifier, reason: ExtensionActivationReason): Promise<boolean> {\n\t\tawait this._readyToRunExtensions.wait();\n\t\tif (!this._registry.getExtensionDescription(extensionId)) {\n\t\t\t// unknown extension => ignore\n\t\t\treturn false;\n\t\t}\n\t\tawait this._activateById(extensionId, reason);\n\t\treturn true;\n\t}\n\n\tpublic async $deltaExtensions(toAdd: IExtensionDescription[], toRemove: ExtensionIdentifier[]): Promise<void> {\n\t\ttoAdd.forEach((extension) => (<any>extension).extensionLocation = URI.revive(extension.extensionLocation));\n\n\t\tconst trie = await this.getExtensionPathIndex();\n\n\t\tawait Promise.all(toRemove.map(async (extensionId) => {\n\t\t\tconst extensionDescription = this._registry.getExtensionDescription(extensionId);\n\t\t\tif (!extensionDescription) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst realpathValue = await this._hostUtils.realpath(extensionDescription.extensionLocation.fsPath);\n\t\t\ttrie.delete(URI.file(realpathValue).fsPath);\n\t\t}));\n\n\t\tawait Promise.all(toAdd.map(async (extensionDescription) => {\n\t\t\tconst realpathValue = await this._hostUtils.realpath(extensionDescription.extensionLocation.fsPath);\n\t\t\ttrie.set(URI.file(realpathValue).fsPath, extensionDescription);\n\t\t}));\n\n\t\tthis._registry.deltaExtensions(toAdd, toRemove);\n\t\treturn Promise.resolve(undefined);\n\t}\n\n\tpublic async $test_latency(n: number): Promise<number> {\n\t\treturn n;\n\t}\n\n\tpublic async $test_up(b: VSBuffer): Promise<number> {\n\t\treturn b.byteLength;\n\t}\n\n\tpublic async $test_down(size: number): Promise<VSBuffer> {\n\t\tlet buff = VSBuffer.alloc(size);\n\t\tlet value = Math.random() % 256;\n\t\tfor (let i = 0; i < size; i++) {\n\t\t\tbuff.writeUInt8(value, i);\n\t\t}\n\t\treturn buff;\n\t}\n\n\tpublic async $updateRemoteConnectionData(connectionData: IRemoteConnectionData): Promise<void> {\n\t\tthis._remoteConnectionData = connectionData;\n\t\tthis._onDidChangeRemoteConnectionData.fire();\n\t}\n\n\tprotected abstract _beforeAlmostReadyToRunExtensions(): Promise<void>;\n\tprotected abstract _getEntryPoint(extensionDescription: IExtensionDescription): string | undefined;\n\tprotected abstract _loadCommonJSModule<T>(extensionId: ExtensionIdentifier | null, module: URI, activationTimesBuilder: ExtensionActivationTimesBuilder): Promise<T>;\n\tpublic abstract $setRemoteEnvironment(env: { [key: string]: string | null }): Promise<void>;\n}\n\n\ntype TelemetryActivationEvent = {\n\tid: string;\n\tname: string;\n\textensionVersion: string;\n\tpublisherDisplayName: string;\n\tactivationEvents: string | null;\n\tisBuiltin: boolean;\n\treason: string;\n\treasonId: string;\n};\n\nfunction getTelemetryActivationEvent(extensionDescription: IExtensionDescription, reason: ExtensionActivationReason): TelemetryActivationEvent {\n\tconst event = {\n\t\tid: extensionDescription.identifier.value,\n\t\tname: extensionDescription.name,\n\t\textensionVersion: extensionDescription.version,\n\t\tpublisherDisplayName: extensionDescription.publisher,\n\t\tactivationEvents: extensionDescription.activationEvents ? extensionDescription.activationEvents.join(',') : null,\n\t\tisBuiltin: extensionDescription.isBuiltin,\n\t\treason: reason.activationEvent,\n\t\treasonId: reason.extensionId.value,\n\t};\n\n\treturn event;\n}\n\n\nexport const IExtHostExtensionService = createDecorator<IExtHostExtensionService>('IExtHostExtensionService');\n\nexport interface IExtHostExtensionService extends AbstractExtHostExtensionService {\n\treadonly _serviceBrand: undefined;\n\tinitialize(): Promise<void>;\n\tisActivated(extensionId: ExtensionIdentifier): boolean;\n\tactivateByIdWithErrors(extensionId: ExtensionIdentifier, reason: ExtensionActivationReason): Promise<void>;\n\tdeactivateAll(): Promise<void>;\n\tgetExtensionExports(extensionId: ExtensionIdentifier): IExtensionAPI | null | undefined;\n\tgetExtensionRegistry(): Promise<ExtensionDescriptionRegistry>;\n\tgetExtensionPathIndex(): Promise<TernarySearchTree<string, IExtensionDescription>>;\n\tregisterRemoteAuthorityResolver(authorityPrefix: string, resolver: vscode.RemoteAuthorityResolver): vscode.Disposable;\n\n\tonDidChangeRemoteConnectionData: Event<void>;\n\tgetRemoteConnectionData(): IRemoteConnectionData | null;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as path from 'vs/base/common/path';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { Event, Emitter } from 'vs/base/common/event';\nimport { asPromise } from 'vs/base/common/async';\nimport {\n\tMainContext, MainThreadDebugServiceShape, ExtHostDebugServiceShape, DebugSessionUUID,\n\tIBreakpointsDeltaDto, ISourceMultiBreakpointDto, IFunctionBreakpointDto, IDebugSessionDto\n} from 'vs/workbench/api/common/extHost.protocol';\nimport { Disposable, Position, Location, SourceBreakpoint, FunctionBreakpoint, DebugAdapterServer, DebugAdapterExecutable, DataBreakpoint, DebugConsoleMode, DebugAdapterInlineImplementation, DebugAdapterNamedPipeServer } from 'vs/workbench/api/common/extHostTypes';\nimport { AbstractDebugAdapter } from 'vs/workbench/contrib/debug/common/abstractDebugAdapter';\nimport { IExtHostWorkspace } from 'vs/workbench/api/common/extHostWorkspace';\nimport { IExtHostExtensionService } from 'vs/workbench/api/common/extHostExtensionService';\nimport { ExtHostDocumentsAndEditors, IExtHostDocumentsAndEditors } from 'vs/workbench/api/common/extHostDocumentsAndEditors';\nimport { IDebuggerContribution, IConfig, IDebugAdapter, IDebugAdapterServer, IDebugAdapterExecutable, IAdapterDescriptor, IDebugAdapterImpl, IDebugAdapterNamedPipeServer } from 'vs/workbench/contrib/debug/common/debug';\nimport { IWorkspaceFolder } from 'vs/platform/workspace/common/workspace';\nimport { AbstractVariableResolverService } from 'vs/workbench/services/configurationResolver/common/variableResolver';\nimport { ExtHostConfigProvider, IExtHostConfiguration } from '../common/extHostConfiguration';\nimport { convertToVSCPaths, convertToDAPaths, isDebuggerMainContribution } from 'vs/workbench/contrib/debug/common/debugUtils';\nimport { IConfigurationResolverService } from 'vs/workbench/services/configurationResolver/common/configurationResolver';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { ExtensionDescriptionRegistry } from 'vs/workbench/services/extensions/common/extensionDescriptionRegistry';\nimport { ISignService } from 'vs/platform/sign/common/sign';\nimport { IExtHostRpcService } from 'vs/workbench/api/common/extHostRpcService';\nimport type * as vscode from 'vscode';\nimport { IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { withNullAsUndefined } from 'vs/base/common/types';\nimport { IProcessEnvironment } from 'vs/base/common/platform';\n\nexport const IExtHostDebugService = createDecorator<IExtHostDebugService>('IExtHostDebugService');\n\nexport interface IExtHostDebugService extends ExtHostDebugServiceShape {\n\n\treadonly _serviceBrand: undefined;\n\n\tonDidStartDebugSession: Event<vscode.DebugSession>;\n\tonDidTerminateDebugSession: Event<vscode.DebugSession>;\n\tonDidChangeActiveDebugSession: Event<vscode.DebugSession | undefined>;\n\tactiveDebugSession: vscode.DebugSession | undefined;\n\tactiveDebugConsole: vscode.DebugConsole;\n\tonDidReceiveDebugSessionCustomEvent: Event<vscode.DebugSessionCustomEvent>;\n\tonDidChangeBreakpoints: Event<vscode.BreakpointsChangeEvent>;\n\tbreakpoints: vscode.Breakpoint[];\n\n\taddBreakpoints(breakpoints0: vscode.Breakpoint[]): Promise<void>;\n\tremoveBreakpoints(breakpoints0: vscode.Breakpoint[]): Promise<void>;\n\tstartDebugging(folder: vscode.WorkspaceFolder | undefined, nameOrConfig: string | vscode.DebugConfiguration, options: vscode.DebugSessionOptions): Promise<boolean>;\n\tstopDebugging(session?: vscode.DebugSession): Promise<void>;\n\tregisterDebugConfigurationProvider(type: string, provider: vscode.DebugConfigurationProvider, trigger: vscode.DebugConfigurationProviderTriggerKind): vscode.Disposable;\n\tregisterDebugAdapterDescriptorFactory(extension: IExtensionDescription, type: string, factory: vscode.DebugAdapterDescriptorFactory): vscode.Disposable;\n\tregisterDebugAdapterTrackerFactory(type: string, factory: vscode.DebugAdapterTrackerFactory): vscode.Disposable;\n\tasDebugSourceUri(source: vscode.DebugProtocolSource, session?: vscode.DebugSession): vscode.Uri;\n}\n\nexport abstract class ExtHostDebugServiceBase implements IExtHostDebugService, ExtHostDebugServiceShape {\n\n\treadonly _serviceBrand: undefined;\n\n\tprivate _configProviderHandleCounter: number;\n\tprivate _configProviders: ConfigProviderTuple[];\n\n\tprivate _adapterFactoryHandleCounter: number;\n\tprivate _adapterFactories: DescriptorFactoryTuple[];\n\n\tprivate _trackerFactoryHandleCounter: number;\n\tprivate _trackerFactories: TrackerFactoryTuple[];\n\n\tprivate _debugServiceProxy: MainThreadDebugServiceShape;\n\tprivate _debugSessions: Map<DebugSessionUUID, ExtHostDebugSession> = new Map<DebugSessionUUID, ExtHostDebugSession>();\n\n\tprivate readonly _onDidStartDebugSession: Emitter<vscode.DebugSession>;\n\tget onDidStartDebugSession(): Event<vscode.DebugSession> { return this._onDidStartDebugSession.event; }\n\n\tprivate readonly _onDidTerminateDebugSession: Emitter<vscode.DebugSession>;\n\tget onDidTerminateDebugSession(): Event<vscode.DebugSession> { return this._onDidTerminateDebugSession.event; }\n\n\tprivate readonly _onDidChangeActiveDebugSession: Emitter<vscode.DebugSession | undefined>;\n\tget onDidChangeActiveDebugSession(): Event<vscode.DebugSession | undefined> { return this._onDidChangeActiveDebugSession.event; }\n\n\tprivate _activeDebugSession: ExtHostDebugSession | undefined;\n\tget activeDebugSession(): ExtHostDebugSession | undefined { return this._activeDebugSession; }\n\n\tprivate readonly _onDidReceiveDebugSessionCustomEvent: Emitter<vscode.DebugSessionCustomEvent>;\n\tget onDidReceiveDebugSessionCustomEvent(): Event<vscode.DebugSessionCustomEvent> { return this._onDidReceiveDebugSessionCustomEvent.event; }\n\n\tprivate _activeDebugConsole: ExtHostDebugConsole;\n\tget activeDebugConsole(): ExtHostDebugConsole { return this._activeDebugConsole; }\n\n\tprivate _breakpoints: Map<string, vscode.Breakpoint>;\n\tprivate _breakpointEventsActive: boolean;\n\n\tprivate readonly _onDidChangeBreakpoints: Emitter<vscode.BreakpointsChangeEvent>;\n\n\tprivate _debugAdapters: Map<number, IDebugAdapter>;\n\tprivate _debugAdaptersTrackers: Map<number, vscode.DebugAdapterTracker>;\n\n\tprivate _variableResolver: IConfigurationResolverService | undefined;\n\n\tprivate _signService: ISignService | undefined;\n\n\tconstructor(\n\t\t@IExtHostRpcService extHostRpcService: IExtHostRpcService,\n\t\t@IExtHostWorkspace protected _workspaceService: IExtHostWorkspace,\n\t\t@IExtHostExtensionService private _extensionService: IExtHostExtensionService,\n\t\t@IExtHostDocumentsAndEditors private _editorsService: IExtHostDocumentsAndEditors,\n\t\t@IExtHostConfiguration protected _configurationService: IExtHostConfiguration,\n\t) {\n\t\tthis._configProviderHandleCounter = 0;\n\t\tthis._configProviders = [];\n\n\t\tthis._adapterFactoryHandleCounter = 0;\n\t\tthis._adapterFactories = [];\n\n\t\tthis._trackerFactoryHandleCounter = 0;\n\t\tthis._trackerFactories = [];\n\n\t\tthis._debugAdapters = new Map();\n\t\tthis._debugAdaptersTrackers = new Map();\n\n\t\tthis._onDidStartDebugSession = new Emitter<vscode.DebugSession>();\n\t\tthis._onDidTerminateDebugSession = new Emitter<vscode.DebugSession>();\n\t\tthis._onDidChangeActiveDebugSession = new Emitter<vscode.DebugSession | undefined>();\n\t\tthis._onDidReceiveDebugSessionCustomEvent = new Emitter<vscode.DebugSessionCustomEvent>();\n\n\t\tthis._debugServiceProxy = extHostRpcService.getProxy(MainContext.MainThreadDebugService);\n\n\t\tthis._onDidChangeBreakpoints = new Emitter<vscode.BreakpointsChangeEvent>({\n\t\t\tonFirstListenerAdd: () => {\n\t\t\t\tthis.startBreakpoints();\n\t\t\t}\n\t\t});\n\n\t\tthis._activeDebugConsole = new ExtHostDebugConsole(this._debugServiceProxy);\n\n\t\tthis._breakpoints = new Map<string, vscode.Breakpoint>();\n\t\tthis._breakpointEventsActive = false;\n\n\t\tthis._extensionService.getExtensionRegistry().then((extensionRegistry: ExtensionDescriptionRegistry) => {\n\t\t\textensionRegistry.onDidChange(_ => {\n\t\t\t\tthis.registerAllDebugTypes(extensionRegistry);\n\t\t\t});\n\t\t\tthis.registerAllDebugTypes(extensionRegistry);\n\t\t});\n\t}\n\n\tpublic asDebugSourceUri(src: vscode.DebugProtocolSource, session?: vscode.DebugSession): URI {\n\n\t\tconst source = <any>src;\n\n\t\tif (typeof source.sourceReference === 'number' && source.sourceReference > 0) {\n\t\t\t// src can be retrieved via DAP's \"source\" request\n\n\t\t\tlet debug = `debug:${encodeURIComponent(source.path || '')}`;\n\t\t\tlet sep = '?';\n\n\t\t\tif (session) {\n\t\t\t\tdebug += `${sep}session=${encodeURIComponent(session.id)}`;\n\t\t\t\tsep = '&';\n\t\t\t}\n\n\t\t\tdebug += `${sep}ref=${source.sourceReference}`;\n\n\t\t\treturn URI.parse(debug);\n\t\t} else if (source.path) {\n\t\t\t// src is just a local file path\n\t\t\treturn URI.file(source.path);\n\t\t} else {\n\t\t\tthrow new Error(`cannot create uri from DAP 'source' object; properties 'path' and 'sourceReference' are both missing.`);\n\t\t}\n\t}\n\n\tprivate registerAllDebugTypes(extensionRegistry: ExtensionDescriptionRegistry) {\n\n\t\tconst debugTypes: string[] = [];\n\n\t\tfor (const ed of extensionRegistry.getAllExtensionDescriptions()) {\n\t\t\tif (ed.contributes) {\n\t\t\t\tconst debuggers = <IDebuggerContribution[]>ed.contributes['debuggers'];\n\t\t\t\tif (debuggers && debuggers.length > 0) {\n\t\t\t\t\tfor (const dbg of debuggers) {\n\t\t\t\t\t\tif (isDebuggerMainContribution(dbg)) {\n\t\t\t\t\t\t\tdebugTypes.push(dbg.type);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._debugServiceProxy.$registerDebugTypes(debugTypes);\n\t}\n\n\t// extension debug API\n\n\tget onDidChangeBreakpoints(): Event<vscode.BreakpointsChangeEvent> {\n\t\treturn this._onDidChangeBreakpoints.event;\n\t}\n\n\tget breakpoints(): vscode.Breakpoint[] {\n\n\t\tthis.startBreakpoints();\n\n\t\tconst result: vscode.Breakpoint[] = [];\n\t\tthis._breakpoints.forEach(bp => result.push(bp));\n\t\treturn result;\n\t}\n\n\tpublic addBreakpoints(breakpoints0: vscode.Breakpoint[]): Promise<void> {\n\n\t\tthis.startBreakpoints();\n\n\t\t// filter only new breakpoints\n\t\tconst breakpoints = breakpoints0.filter(bp => {\n\t\t\tconst id = bp.id;\n\t\t\tif (!this._breakpoints.has(id)) {\n\t\t\t\tthis._breakpoints.set(id, bp);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\n\t\t// send notification for added breakpoints\n\t\tthis.fireBreakpointChanges(breakpoints, [], []);\n\n\t\t// convert added breakpoints to DTOs\n\t\tconst dtos: Array<ISourceMultiBreakpointDto | IFunctionBreakpointDto> = [];\n\t\tconst map = new Map<string, ISourceMultiBreakpointDto>();\n\t\tfor (const bp of breakpoints) {\n\t\t\tif (bp instanceof SourceBreakpoint) {\n\t\t\t\tlet dto = map.get(bp.location.uri.toString());\n\t\t\t\tif (!dto) {\n\t\t\t\t\tdto = <ISourceMultiBreakpointDto>{\n\t\t\t\t\t\ttype: 'sourceMulti',\n\t\t\t\t\t\turi: bp.location.uri,\n\t\t\t\t\t\tlines: []\n\t\t\t\t\t};\n\t\t\t\t\tmap.set(bp.location.uri.toString(), dto);\n\t\t\t\t\tdtos.push(dto);\n\t\t\t\t}\n\t\t\t\tdto.lines.push({\n\t\t\t\t\tid: bp.id,\n\t\t\t\t\tenabled: bp.enabled,\n\t\t\t\t\tcondition: bp.condition,\n\t\t\t\t\thitCondition: bp.hitCondition,\n\t\t\t\t\tlogMessage: bp.logMessage,\n\t\t\t\t\tline: bp.location.range.start.line,\n\t\t\t\t\tcharacter: bp.location.range.start.character\n\t\t\t\t});\n\t\t\t} else if (bp instanceof FunctionBreakpoint) {\n\t\t\t\tdtos.push({\n\t\t\t\t\ttype: 'function',\n\t\t\t\t\tid: bp.id,\n\t\t\t\t\tenabled: bp.enabled,\n\t\t\t\t\thitCondition: bp.hitCondition,\n\t\t\t\t\tlogMessage: bp.logMessage,\n\t\t\t\t\tcondition: bp.condition,\n\t\t\t\t\tfunctionName: bp.functionName\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// send DTOs to VS Code\n\t\treturn this._debugServiceProxy.$registerBreakpoints(dtos);\n\t}\n\n\tpublic removeBreakpoints(breakpoints0: vscode.Breakpoint[]): Promise<void> {\n\n\t\tthis.startBreakpoints();\n\n\t\t// remove from array\n\t\tconst breakpoints = breakpoints0.filter(b => this._breakpoints.delete(b.id));\n\n\t\t// send notification\n\t\tthis.fireBreakpointChanges([], breakpoints, []);\n\n\t\t// unregister with VS Code\n\t\tconst ids = breakpoints.filter(bp => bp instanceof SourceBreakpoint).map(bp => bp.id);\n\t\tconst fids = breakpoints.filter(bp => bp instanceof FunctionBreakpoint).map(bp => bp.id);\n\t\tconst dids = breakpoints.filter(bp => bp instanceof DataBreakpoint).map(bp => bp.id);\n\t\treturn this._debugServiceProxy.$unregisterBreakpoints(ids, fids, dids);\n\t}\n\n\tpublic startDebugging(folder: vscode.WorkspaceFolder | undefined, nameOrConfig: string | vscode.DebugConfiguration, options: vscode.DebugSessionOptions): Promise<boolean> {\n\t\treturn this._debugServiceProxy.$startDebugging(folder ? folder.uri : undefined, nameOrConfig, {\n\t\t\tparentSessionID: options.parentSession ? options.parentSession.id : undefined,\n\t\t\trepl: options.consoleMode === DebugConsoleMode.MergeWithParent ? 'mergeWithParent' : 'separate',\n\t\t\tnoDebug: options.noDebug,\n\t\t\tcompact: options.compact\n\t\t});\n\t}\n\n\tpublic stopDebugging(session?: vscode.DebugSession): Promise<void> {\n\t\treturn this._debugServiceProxy.$stopDebugging(session ? session.id : undefined);\n\t}\n\n\tpublic registerDebugConfigurationProvider(type: string, provider: vscode.DebugConfigurationProvider, trigger: vscode.DebugConfigurationProviderTriggerKind): vscode.Disposable {\n\n\t\tif (!provider) {\n\t\t\treturn new Disposable(() => { });\n\t\t}\n\n\t\tconst handle = this._configProviderHandleCounter++;\n\t\tthis._configProviders.push({ type, handle, provider });\n\n\t\tthis._debugServiceProxy.$registerDebugConfigurationProvider(type, trigger,\n\t\t\t!!provider.provideDebugConfigurations,\n\t\t\t!!provider.resolveDebugConfiguration,\n\t\t\t!!provider.resolveDebugConfigurationWithSubstitutedVariables,\n\t\t\thandle);\n\n\t\treturn new Disposable(() => {\n\t\t\tthis._configProviders = this._configProviders.filter(p => p.provider !== provider);\t\t// remove\n\t\t\tthis._debugServiceProxy.$unregisterDebugConfigurationProvider(handle);\n\t\t});\n\t}\n\n\tpublic registerDebugAdapterDescriptorFactory(extension: IExtensionDescription, type: string, factory: vscode.DebugAdapterDescriptorFactory): vscode.Disposable {\n\n\t\tif (!factory) {\n\t\t\treturn new Disposable(() => { });\n\t\t}\n\n\t\t// a DebugAdapterDescriptorFactory can only be registered in the extension that contributes the debugger\n\t\tif (!this.definesDebugType(extension, type)) {\n\t\t\tthrow new Error(`a DebugAdapterDescriptorFactory can only be registered from the extension that defines the '${type}' debugger.`);\n\t\t}\n\n\t\t// make sure that only one factory for this type is registered\n\t\tif (this.getAdapterDescriptorFactoryByType(type)) {\n\t\t\tthrow new Error(`a DebugAdapterDescriptorFactory can only be registered once per a type.`);\n\t\t}\n\n\t\tconst handle = this._adapterFactoryHandleCounter++;\n\t\tthis._adapterFactories.push({ type, handle, factory });\n\n\t\tthis._debugServiceProxy.$registerDebugAdapterDescriptorFactory(type, handle);\n\n\t\treturn new Disposable(() => {\n\t\t\tthis._adapterFactories = this._adapterFactories.filter(p => p.factory !== factory);\t\t// remove\n\t\t\tthis._debugServiceProxy.$unregisterDebugAdapterDescriptorFactory(handle);\n\t\t});\n\t}\n\n\tpublic registerDebugAdapterTrackerFactory(type: string, factory: vscode.DebugAdapterTrackerFactory): vscode.Disposable {\n\n\t\tif (!factory) {\n\t\t\treturn new Disposable(() => { });\n\t\t}\n\n\t\tconst handle = this._trackerFactoryHandleCounter++;\n\t\tthis._trackerFactories.push({ type, handle, factory });\n\n\t\treturn new Disposable(() => {\n\t\t\tthis._trackerFactories = this._trackerFactories.filter(p => p.factory !== factory);\t\t// remove\n\t\t});\n\t}\n\n\t// RPC methods (ExtHostDebugServiceShape)\n\n\tpublic async $runInTerminal(args: DebugProtocol.RunInTerminalRequestArguments): Promise<number | undefined> {\n\t\treturn Promise.resolve(undefined);\n\t}\n\n\tprotected abstract createVariableResolver(folders: vscode.WorkspaceFolder[], editorService: ExtHostDocumentsAndEditors, configurationService: ExtHostConfigProvider): AbstractVariableResolverService;\n\n\tpublic async $substituteVariables(folderUri: UriComponents | undefined, config: IConfig): Promise<IConfig> {\n\t\tif (!this._variableResolver) {\n\t\t\tconst [workspaceFolders, configProvider] = await Promise.all([this._workspaceService.getWorkspaceFolders2(), this._configurationService.getConfigProvider()]);\n\t\t\tthis._variableResolver = this.createVariableResolver(workspaceFolders || [], this._editorsService, configProvider!);\n\t\t}\n\t\tlet ws: IWorkspaceFolder | undefined;\n\t\tconst folder = await this.getFolder(folderUri);\n\t\tif (folder) {\n\t\t\tws = {\n\t\t\t\turi: folder.uri,\n\t\t\t\tname: folder.name,\n\t\t\t\tindex: folder.index,\n\t\t\t\ttoResource: () => {\n\t\t\t\t\tthrow new Error('Not implemented');\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t\treturn this._variableResolver.resolveAny(ws, config);\n\t}\n\n\tprotected createDebugAdapter(adapter: IAdapterDescriptor, session: ExtHostDebugSession): AbstractDebugAdapter | undefined {\n\t\tif (adapter.type === 'implementation') {\n\t\t\treturn new DirectDebugAdapter(adapter.implementation);\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprotected createSignService(): ISignService | undefined {\n\t\treturn undefined;\n\t}\n\n\tpublic async $startDASession(debugAdapterHandle: number, sessionDto: IDebugSessionDto): Promise<void> {\n\t\tconst mythis = this;\n\n\t\tconst session = await this.getSession(sessionDto);\n\n\t\treturn this.getAdapterDescriptor(this.getAdapterDescriptorFactoryByType(session.type), session).then(daDescriptor => {\n\n\t\t\tif (!daDescriptor) {\n\t\t\t\tthrow new Error(`Couldn't find a debug adapter descriptor for debug type '${session.type}' (extension might have failed to activate)`);\n\t\t\t}\n\n\t\t\tconst adapterDescriptor = this.convertToDto(daDescriptor);\n\n\t\t\tconst da = this.createDebugAdapter(adapterDescriptor, session);\n\t\t\tif (!da) {\n\t\t\t\tthrow new Error(`Couldn't create a debug adapter for type '${session.type}'.`);\n\t\t\t}\n\n\t\t\tconst debugAdapter = da;\n\n\t\t\tthis._debugAdapters.set(debugAdapterHandle, debugAdapter);\n\n\t\t\treturn this.getDebugAdapterTrackers(session).then(tracker => {\n\n\t\t\t\tif (tracker) {\n\t\t\t\t\tthis._debugAdaptersTrackers.set(debugAdapterHandle, tracker);\n\t\t\t\t}\n\n\t\t\t\tdebugAdapter.onMessage(async message => {\n\n\t\t\t\t\tif (message.type === 'request' && (<DebugProtocol.Request>message).command === 'handshake') {\n\n\t\t\t\t\t\tconst request = <DebugProtocol.Request>message;\n\n\t\t\t\t\t\tconst response: DebugProtocol.Response = {\n\t\t\t\t\t\t\ttype: 'response',\n\t\t\t\t\t\t\tseq: 0,\n\t\t\t\t\t\t\tcommand: request.command,\n\t\t\t\t\t\t\trequest_seq: request.seq,\n\t\t\t\t\t\t\tsuccess: true\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tif (!this._signService) {\n\t\t\t\t\t\t\tthis._signService = this.createSignService();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (this._signService) {\n\t\t\t\t\t\t\t\tconst signature = await this._signService.sign(request.arguments.value);\n\t\t\t\t\t\t\t\tresponse.body = {\n\t\t\t\t\t\t\t\t\tsignature: signature\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tdebugAdapter.sendResponse(response);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthrow new Error('no signer');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tresponse.success = false;\n\t\t\t\t\t\t\tresponse.message = e.message;\n\t\t\t\t\t\t\tdebugAdapter.sendResponse(response);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (tracker && tracker.onDidSendMessage) {\n\t\t\t\t\t\t\ttracker.onDidSendMessage(message);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// DA -> VS Code\n\t\t\t\t\t\tmessage = convertToVSCPaths(message, true);\n\n\t\t\t\t\t\tmythis._debugServiceProxy.$acceptDAMessage(debugAdapterHandle, message);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tdebugAdapter.onError(err => {\n\t\t\t\t\tif (tracker && tracker.onError) {\n\t\t\t\t\t\ttracker.onError(err);\n\t\t\t\t\t}\n\t\t\t\t\tthis._debugServiceProxy.$acceptDAError(debugAdapterHandle, err.name, err.message, err.stack);\n\t\t\t\t});\n\t\t\t\tdebugAdapter.onExit((code: number | null) => {\n\t\t\t\t\tif (tracker && tracker.onExit) {\n\t\t\t\t\t\ttracker.onExit(withNullAsUndefined(code), undefined);\n\t\t\t\t\t}\n\t\t\t\t\tthis._debugServiceProxy.$acceptDAExit(debugAdapterHandle, withNullAsUndefined(code), undefined);\n\t\t\t\t});\n\n\t\t\t\tif (tracker && tracker.onWillStartSession) {\n\t\t\t\t\ttracker.onWillStartSession();\n\t\t\t\t}\n\n\t\t\t\treturn debugAdapter.startSession();\n\t\t\t});\n\t\t});\n\t}\n\n\tpublic $sendDAMessage(debugAdapterHandle: number, message: DebugProtocol.ProtocolMessage): void {\n\n\t\t// VS Code -> DA\n\t\tmessage = convertToDAPaths(message, false);\n\n\t\tconst tracker = this._debugAdaptersTrackers.get(debugAdapterHandle);\t// TODO@AW: same handle?\n\t\tif (tracker && tracker.onWillReceiveMessage) {\n\t\t\ttracker.onWillReceiveMessage(message);\n\t\t}\n\n\t\tconst da = this._debugAdapters.get(debugAdapterHandle);\n\t\tif (da) {\n\t\t\tda.sendMessage(message);\n\t\t}\n\t}\n\n\tpublic $stopDASession(debugAdapterHandle: number): Promise<void> {\n\n\t\tconst tracker = this._debugAdaptersTrackers.get(debugAdapterHandle);\n\t\tthis._debugAdaptersTrackers.delete(debugAdapterHandle);\n\t\tif (tracker && tracker.onWillStopSession) {\n\t\t\ttracker.onWillStopSession();\n\t\t}\n\n\t\tconst da = this._debugAdapters.get(debugAdapterHandle);\n\t\tthis._debugAdapters.delete(debugAdapterHandle);\n\t\tif (da) {\n\t\t\treturn da.stopSession();\n\t\t} else {\n\t\t\treturn Promise.resolve(void 0);\n\t\t}\n\t}\n\n\tpublic $acceptBreakpointsDelta(delta: IBreakpointsDeltaDto): void {\n\n\t\tconst a: vscode.Breakpoint[] = [];\n\t\tconst r: vscode.Breakpoint[] = [];\n\t\tconst c: vscode.Breakpoint[] = [];\n\n\t\tif (delta.added) {\n\t\t\tfor (const bpd of delta.added) {\n\t\t\t\tconst id = bpd.id;\n\t\t\t\tif (id && !this._breakpoints.has(id)) {\n\t\t\t\t\tlet bp: vscode.Breakpoint;\n\t\t\t\t\tif (bpd.type === 'function') {\n\t\t\t\t\t\tbp = new FunctionBreakpoint(bpd.functionName, bpd.enabled, bpd.condition, bpd.hitCondition, bpd.logMessage);\n\t\t\t\t\t} else if (bpd.type === 'data') {\n\t\t\t\t\t\tbp = new DataBreakpoint(bpd.label, bpd.dataId, bpd.canPersist, bpd.enabled, bpd.hitCondition, bpd.condition, bpd.logMessage);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst uri = URI.revive(bpd.uri);\n\t\t\t\t\t\tbp = new SourceBreakpoint(new Location(uri, new Position(bpd.line, bpd.character)), bpd.enabled, bpd.condition, bpd.hitCondition, bpd.logMessage);\n\t\t\t\t\t}\n\t\t\t\t\t(bp as any)._id = id;\n\t\t\t\t\tthis._breakpoints.set(id, bp);\n\t\t\t\t\ta.push(bp);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (delta.removed) {\n\t\t\tfor (const id of delta.removed) {\n\t\t\t\tconst bp = this._breakpoints.get(id);\n\t\t\t\tif (bp) {\n\t\t\t\t\tthis._breakpoints.delete(id);\n\t\t\t\t\tr.push(bp);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (delta.changed) {\n\t\t\tfor (const bpd of delta.changed) {\n\t\t\t\tif (bpd.id) {\n\t\t\t\t\tconst bp = this._breakpoints.get(bpd.id);\n\t\t\t\t\tif (bp) {\n\t\t\t\t\t\tif (bp instanceof FunctionBreakpoint && bpd.type === 'function') {\n\t\t\t\t\t\t\tconst fbp = <any>bp;\n\t\t\t\t\t\t\tfbp.enabled = bpd.enabled;\n\t\t\t\t\t\t\tfbp.condition = bpd.condition;\n\t\t\t\t\t\t\tfbp.hitCondition = bpd.hitCondition;\n\t\t\t\t\t\t\tfbp.logMessage = bpd.logMessage;\n\t\t\t\t\t\t\tfbp.functionName = bpd.functionName;\n\t\t\t\t\t\t} else if (bp instanceof SourceBreakpoint && bpd.type === 'source') {\n\t\t\t\t\t\t\tconst sbp = <any>bp;\n\t\t\t\t\t\t\tsbp.enabled = bpd.enabled;\n\t\t\t\t\t\t\tsbp.condition = bpd.condition;\n\t\t\t\t\t\t\tsbp.hitCondition = bpd.hitCondition;\n\t\t\t\t\t\t\tsbp.logMessage = bpd.logMessage;\n\t\t\t\t\t\t\tsbp.location = new Location(URI.revive(bpd.uri), new Position(bpd.line, bpd.character));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tc.push(bp);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.fireBreakpointChanges(a, r, c);\n\t}\n\n\tpublic $provideDebugConfigurations(configProviderHandle: number, folderUri: UriComponents | undefined, token: CancellationToken): Promise<vscode.DebugConfiguration[]> {\n\t\treturn asPromise(async () => {\n\t\t\tconst provider = this.getConfigProviderByHandle(configProviderHandle);\n\t\t\tif (!provider) {\n\t\t\t\tthrow new Error('no DebugConfigurationProvider found');\n\t\t\t}\n\t\t\tif (!provider.provideDebugConfigurations) {\n\t\t\t\tthrow new Error('DebugConfigurationProvider has no method provideDebugConfigurations');\n\t\t\t}\n\t\t\tconst folder = await this.getFolder(folderUri);\n\t\t\treturn provider.provideDebugConfigurations(folder, token);\n\t\t}).then(debugConfigurations => {\n\t\t\tif (!debugConfigurations) {\n\t\t\t\tthrow new Error('nothing returned from DebugConfigurationProvider.provideDebugConfigurations');\n\t\t\t}\n\t\t\treturn debugConfigurations;\n\t\t});\n\t}\n\n\tpublic $resolveDebugConfiguration(configProviderHandle: number, folderUri: UriComponents | undefined, debugConfiguration: vscode.DebugConfiguration, token: CancellationToken): Promise<vscode.DebugConfiguration | null | undefined> {\n\t\treturn asPromise(async () => {\n\t\t\tconst provider = this.getConfigProviderByHandle(configProviderHandle);\n\t\t\tif (!provider) {\n\t\t\t\tthrow new Error('no DebugConfigurationProvider found');\n\t\t\t}\n\t\t\tif (!provider.resolveDebugConfiguration) {\n\t\t\t\tthrow new Error('DebugConfigurationProvider has no method resolveDebugConfiguration');\n\t\t\t}\n\t\t\tconst folder = await this.getFolder(folderUri);\n\t\t\treturn provider.resolveDebugConfiguration(folder, debugConfiguration, token);\n\t\t});\n\t}\n\n\tpublic $resolveDebugConfigurationWithSubstitutedVariables(configProviderHandle: number, folderUri: UriComponents | undefined, debugConfiguration: vscode.DebugConfiguration, token: CancellationToken): Promise<vscode.DebugConfiguration | null | undefined> {\n\t\treturn asPromise(async () => {\n\t\t\tconst provider = this.getConfigProviderByHandle(configProviderHandle);\n\t\t\tif (!provider) {\n\t\t\t\tthrow new Error('no DebugConfigurationProvider found');\n\t\t\t}\n\t\t\tif (!provider.resolveDebugConfigurationWithSubstitutedVariables) {\n\t\t\t\tthrow new Error('DebugConfigurationProvider has no method resolveDebugConfigurationWithSubstitutedVariables');\n\t\t\t}\n\t\t\tconst folder = await this.getFolder(folderUri);\n\t\t\treturn provider.resolveDebugConfigurationWithSubstitutedVariables(folder, debugConfiguration, token);\n\t\t});\n\t}\n\n\tpublic async $provideDebugAdapter(adapterFactoryHandle: number, sessionDto: IDebugSessionDto): Promise<IAdapterDescriptor> {\n\t\tconst adapterDescriptorFactory = this.getAdapterDescriptorFactoryByHandle(adapterFactoryHandle);\n\t\tif (!adapterDescriptorFactory) {\n\t\t\treturn Promise.reject(new Error('no adapter descriptor factory found for handle'));\n\t\t}\n\t\tconst session = await this.getSession(sessionDto);\n\t\treturn this.getAdapterDescriptor(adapterDescriptorFactory, session).then(adapterDescriptor => {\n\t\t\tif (!adapterDescriptor) {\n\t\t\t\tthrow new Error(`Couldn't find a debug adapter descriptor for debug type '${session.type}'`);\n\t\t\t}\n\t\t\treturn this.convertToDto(adapterDescriptor);\n\t\t});\n\t}\n\n\tpublic async $acceptDebugSessionStarted(sessionDto: IDebugSessionDto): Promise<void> {\n\t\tconst session = await this.getSession(sessionDto);\n\t\tthis._onDidStartDebugSession.fire(session);\n\t}\n\n\tpublic async $acceptDebugSessionTerminated(sessionDto: IDebugSessionDto): Promise<void> {\n\t\tconst session = await this.getSession(sessionDto);\n\t\tif (session) {\n\t\t\tthis._onDidTerminateDebugSession.fire(session);\n\t\t\tthis._debugSessions.delete(session.id);\n\t\t}\n\t}\n\n\tpublic async $acceptDebugSessionActiveChanged(sessionDto: IDebugSessionDto | undefined): Promise<void> {\n\t\tthis._activeDebugSession = sessionDto ? await this.getSession(sessionDto) : undefined;\n\t\tthis._onDidChangeActiveDebugSession.fire(this._activeDebugSession);\n\t}\n\n\tpublic async $acceptDebugSessionNameChanged(sessionDto: IDebugSessionDto, name: string): Promise<void> {\n\t\tconst session = await this.getSession(sessionDto);\n\t\tif (session) {\n\t\t\tsession._acceptNameChanged(name);\n\t\t}\n\t}\n\n\tpublic async $acceptDebugSessionCustomEvent(sessionDto: IDebugSessionDto, event: any): Promise<void> {\n\t\tconst session = await this.getSession(sessionDto);\n\t\tconst ee: vscode.DebugSessionCustomEvent = {\n\t\t\tsession: session,\n\t\t\tevent: event.event,\n\t\t\tbody: event.body\n\t\t};\n\t\tthis._onDidReceiveDebugSessionCustomEvent.fire(ee);\n\t}\n\n\t// private & dto helpers\n\n\tprivate convertToDto(x: vscode.DebugAdapterDescriptor): IAdapterDescriptor {\n\n\t\tif (x instanceof DebugAdapterExecutable) {\n\t\t\treturn <IDebugAdapterExecutable>{\n\t\t\t\ttype: 'executable',\n\t\t\t\tcommand: x.command,\n\t\t\t\targs: x.args,\n\t\t\t\toptions: x.options\n\t\t\t};\n\t\t} else if (x instanceof DebugAdapterServer) {\n\t\t\treturn <IDebugAdapterServer>{\n\t\t\t\ttype: 'server',\n\t\t\t\tport: x.port,\n\t\t\t\thost: x.host\n\t\t\t};\n\t\t} else if (x instanceof DebugAdapterNamedPipeServer) {\n\t\t\treturn <IDebugAdapterNamedPipeServer>{\n\t\t\t\ttype: 'pipeServer',\n\t\t\t\tpath: x.path\n\t\t\t};\n\t\t} else if (x instanceof DebugAdapterInlineImplementation) {\n\t\t\treturn <IDebugAdapterImpl>{\n\t\t\t\ttype: 'implementation',\n\t\t\t\timplementation: x.implementation\n\t\t\t};\n\t\t} else {\n\t\t\tthrow new Error('convertToDto unexpected type');\n\t\t}\n\t}\n\n\tprivate getAdapterDescriptorFactoryByType(type: string): vscode.DebugAdapterDescriptorFactory | undefined {\n\t\tconst results = this._adapterFactories.filter(p => p.type === type);\n\t\tif (results.length > 0) {\n\t\t\treturn results[0].factory;\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate getAdapterDescriptorFactoryByHandle(handle: number): vscode.DebugAdapterDescriptorFactory | undefined {\n\t\tconst results = this._adapterFactories.filter(p => p.handle === handle);\n\t\tif (results.length > 0) {\n\t\t\treturn results[0].factory;\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate getConfigProviderByHandle(handle: number): vscode.DebugConfigurationProvider | undefined {\n\t\tconst results = this._configProviders.filter(p => p.handle === handle);\n\t\tif (results.length > 0) {\n\t\t\treturn results[0].provider;\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate definesDebugType(ed: IExtensionDescription, type: string) {\n\t\tif (ed.contributes) {\n\t\t\tconst debuggers = <IDebuggerContribution[]>ed.contributes['debuggers'];\n\t\t\tif (debuggers && debuggers.length > 0) {\n\t\t\t\tfor (const dbg of debuggers) {\n\t\t\t\t\t// only debugger contributions with a \"label\" are considered a \"defining\" debugger contribution\n\t\t\t\t\tif (dbg.label && dbg.type) {\n\t\t\t\t\t\tif (dbg.type === type) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tprivate getDebugAdapterTrackers(session: ExtHostDebugSession): Promise<vscode.DebugAdapterTracker | undefined> {\n\n\t\tconst config = session.configuration;\n\t\tconst type = config.type;\n\n\t\tconst promises = this._trackerFactories\n\t\t\t.filter(tuple => tuple.type === type || tuple.type === '*')\n\t\t\t.map(tuple => asPromise<vscode.ProviderResult<vscode.DebugAdapterTracker>>(() => tuple.factory.createDebugAdapterTracker(session)).then(p => p, err => null));\n\n\t\treturn Promise.race([\n\t\t\tPromise.all(promises).then(result => {\n\t\t\t\tconst trackers = <vscode.DebugAdapterTracker[]>result.filter(t => !!t);\t// filter null\n\t\t\t\tif (trackers.length > 0) {\n\t\t\t\t\treturn new MultiTracker(trackers);\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t}),\n\t\t\tnew Promise<never>((resolve, reject) => {\n\t\t\t\tconst timeout = setTimeout(() => {\n\t\t\t\t\tclearTimeout(timeout);\n\t\t\t\t\treject(new Error('timeout'));\n\t\t\t\t}, 1000);\n\t\t\t})\n\t\t]).catch(err => {\n\t\t\t// ignore errors\n\t\t\treturn undefined;\n\t\t});\n\t}\n\n\tprivate async getAdapterDescriptor(adapterDescriptorFactory: vscode.DebugAdapterDescriptorFactory | undefined, session: ExtHostDebugSession): Promise<vscode.DebugAdapterDescriptor | undefined> {\n\n\t\t// a \"debugServer\" attribute in the launch config takes precedence\n\t\tconst serverPort = session.configuration.debugServer;\n\t\tif (typeof serverPort === 'number') {\n\t\t\treturn Promise.resolve(new DebugAdapterServer(serverPort));\n\t\t}\n\n\t\tif (adapterDescriptorFactory) {\n\t\t\tconst extensionRegistry = await this._extensionService.getExtensionRegistry();\n\t\t\treturn asPromise(() => adapterDescriptorFactory.createDebugAdapterDescriptor(session, this.daExecutableFromPackage(session, extensionRegistry))).then(daDescriptor => {\n\t\t\t\tif (daDescriptor) {\n\t\t\t\t\treturn daDescriptor;\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t});\n\t\t}\n\n\t\t// fallback: use executable information from package.json\n\t\tconst extensionRegistry = await this._extensionService.getExtensionRegistry();\n\t\treturn Promise.resolve(this.daExecutableFromPackage(session, extensionRegistry));\n\t}\n\n\tprotected daExecutableFromPackage(session: ExtHostDebugSession, extensionRegistry: ExtensionDescriptionRegistry): DebugAdapterExecutable | undefined {\n\t\treturn undefined;\n\t}\n\n\tprivate startBreakpoints() {\n\t\tif (!this._breakpointEventsActive) {\n\t\t\tthis._breakpointEventsActive = true;\n\t\t\tthis._debugServiceProxy.$startBreakpointEvents();\n\t\t}\n\t}\n\n\tprivate fireBreakpointChanges(added: vscode.Breakpoint[], removed: vscode.Breakpoint[], changed: vscode.Breakpoint[]) {\n\t\tif (added.length > 0 || removed.length > 0 || changed.length > 0) {\n\t\t\tthis._onDidChangeBreakpoints.fire(Object.freeze({\n\t\t\t\tadded,\n\t\t\t\tremoved,\n\t\t\t\tchanged,\n\t\t\t}));\n\t\t}\n\t}\n\n\tprivate async getSession(dto: IDebugSessionDto): Promise<ExtHostDebugSession> {\n\t\tif (dto) {\n\t\t\tif (typeof dto === 'string') {\n\t\t\t\tconst ds = this._debugSessions.get(dto);\n\t\t\t\tif (ds) {\n\t\t\t\t\treturn ds;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlet ds = this._debugSessions.get(dto.id);\n\t\t\t\tif (!ds) {\n\t\t\t\t\tconst folder = await this.getFolder(dto.folderUri);\n\t\t\t\t\tds = new ExtHostDebugSession(this._debugServiceProxy, dto.id, dto.type, dto.name, folder, dto.configuration);\n\t\t\t\t\tthis._debugSessions.set(ds.id, ds);\n\t\t\t\t\tthis._debugServiceProxy.$sessionCached(ds.id);\n\t\t\t\t}\n\t\t\t\treturn ds;\n\t\t\t}\n\t\t}\n\t\tthrow new Error('cannot find session');\n\t}\n\n\tprivate getFolder(_folderUri: UriComponents | undefined): Promise<vscode.WorkspaceFolder | undefined> {\n\t\tif (_folderUri) {\n\t\t\tconst folderURI = URI.revive(_folderUri);\n\t\t\treturn this._workspaceService.resolveWorkspaceFolder(folderURI);\n\t\t}\n\t\treturn Promise.resolve(undefined);\n\t}\n}\n\nexport class ExtHostDebugSession implements vscode.DebugSession {\n\n\tconstructor(\n\t\tprivate _debugServiceProxy: MainThreadDebugServiceShape,\n\t\tprivate _id: DebugSessionUUID,\n\t\tprivate _type: string,\n\t\tprivate _name: string,\n\t\tprivate _workspaceFolder: vscode.WorkspaceFolder | undefined,\n\t\tprivate _configuration: vscode.DebugConfiguration) {\n\t}\n\n\tpublic get id(): string {\n\t\treturn this._id;\n\t}\n\n\tpublic get type(): string {\n\t\treturn this._type;\n\t}\n\n\tpublic get name(): string {\n\t\treturn this._name;\n\t}\n\n\tpublic set name(name: string) {\n\t\tthis._name = name;\n\t\tthis._debugServiceProxy.$setDebugSessionName(this._id, name);\n\t}\n\n\t_acceptNameChanged(name: string) {\n\t\tthis._name = name;\n\t}\n\n\tpublic get workspaceFolder(): vscode.WorkspaceFolder | undefined {\n\t\treturn this._workspaceFolder;\n\t}\n\n\tpublic get configuration(): vscode.DebugConfiguration {\n\t\treturn this._configuration;\n\t}\n\n\tpublic customRequest(command: string, args: any): Promise<any> {\n\t\treturn this._debugServiceProxy.$customDebugAdapterRequest(this._id, command, args);\n\t}\n\n\tpublic getDebugProtocolBreakpoint(breakpoint: vscode.Breakpoint): Promise<vscode.DebugProtocolBreakpoint | undefined> {\n\t\treturn this._debugServiceProxy.$getDebugProtocolBreakpoint(this._id, breakpoint.id);\n\t}\n}\n\nexport class ExtHostDebugConsole implements vscode.DebugConsole {\n\n\tprivate _debugServiceProxy: MainThreadDebugServiceShape;\n\n\tconstructor(proxy: MainThreadDebugServiceShape) {\n\t\tthis._debugServiceProxy = proxy;\n\t}\n\n\tappend(value: string): void {\n\t\tthis._debugServiceProxy.$appendDebugConsole(value);\n\t}\n\n\tappendLine(value: string): void {\n\t\tthis.append(value + '\\n');\n\t}\n}\n\nexport class ExtHostVariableResolverService extends AbstractVariableResolverService {\n\n\tconstructor(folders: vscode.WorkspaceFolder[], editorService: ExtHostDocumentsAndEditors | undefined, configurationService: ExtHostConfigProvider, env?: IProcessEnvironment, workspaceService?: IExtHostWorkspace) {\n\t\tsuper({\n\t\t\tgetFolderUri: (folderName: string): URI | undefined => {\n\t\t\t\tconst found = folders.filter(f => f.name === folderName);\n\t\t\t\tif (found && found.length > 0) {\n\t\t\t\t\treturn found[0].uri;\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t},\n\t\t\tgetWorkspaceFolderCount: (): number => {\n\t\t\t\treturn folders.length;\n\t\t\t},\n\t\t\tgetConfigurationValue: (folderUri: URI | undefined, section: string): string | undefined => {\n\t\t\t\treturn configurationService.getConfiguration(undefined, folderUri).get<string>(section);\n\t\t\t},\n\t\t\tgetExecPath: (): string | undefined => {\n\t\t\t\treturn env ? env['VSCODE_EXEC_PATH'] : undefined;\n\t\t\t},\n\t\t\tgetFilePath: (): string | undefined => {\n\t\t\t\tif (editorService) {\n\t\t\t\t\tconst activeEditor = editorService.activeEditor();\n\t\t\t\t\tif (activeEditor) {\n\t\t\t\t\t\treturn path.normalize(activeEditor.document.uri.fsPath);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t},\n\t\t\tgetWorkspaceFolderPathForFile: (): string | undefined => {\n\t\t\t\tif (editorService && workspaceService) {\n\t\t\t\t\tconst activeEditor = editorService.activeEditor();\n\t\t\t\t\tif (activeEditor) {\n\t\t\t\t\t\tconst ws = workspaceService.getWorkspaceFolder(activeEditor.document.uri);\n\t\t\t\t\t\tif (ws) {\n\t\t\t\t\t\t\treturn path.normalize(ws.uri.fsPath);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t},\n\t\t\tgetSelectedText: (): string | undefined => {\n\t\t\t\tif (editorService) {\n\t\t\t\t\tconst activeEditor = editorService.activeEditor();\n\t\t\t\t\tif (activeEditor && !activeEditor.selection.isEmpty) {\n\t\t\t\t\t\treturn activeEditor.document.getText(activeEditor.selection);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t},\n\t\t\tgetLineNumber: (): string | undefined => {\n\t\t\t\tif (editorService) {\n\t\t\t\t\tconst activeEditor = editorService.activeEditor();\n\t\t\t\t\tif (activeEditor) {\n\t\t\t\t\t\treturn String(activeEditor.selection.end.line + 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t}, undefined, env);\n\t}\n}\n\ninterface ConfigProviderTuple {\n\ttype: string;\n\thandle: number;\n\tprovider: vscode.DebugConfigurationProvider;\n}\n\ninterface DescriptorFactoryTuple {\n\ttype: string;\n\thandle: number;\n\tfactory: vscode.DebugAdapterDescriptorFactory;\n}\n\ninterface TrackerFactoryTuple {\n\ttype: string;\n\thandle: number;\n\tfactory: vscode.DebugAdapterTrackerFactory;\n}\n\nclass MultiTracker implements vscode.DebugAdapterTracker {\n\n\tconstructor(private trackers: vscode.DebugAdapterTracker[]) {\n\t}\n\n\tonWillStartSession(): void {\n\t\tthis.trackers.forEach(t => t.onWillStartSession ? t.onWillStartSession() : undefined);\n\t}\n\n\tonWillReceiveMessage(message: any): void {\n\t\tthis.trackers.forEach(t => t.onWillReceiveMessage ? t.onWillReceiveMessage(message) : undefined);\n\t}\n\n\tonDidSendMessage(message: any): void {\n\t\tthis.trackers.forEach(t => t.onDidSendMessage ? t.onDidSendMessage(message) : undefined);\n\t}\n\n\tonWillStopSession(): void {\n\t\tthis.trackers.forEach(t => t.onWillStopSession ? t.onWillStopSession() : undefined);\n\t}\n\n\tonError(error: Error): void {\n\t\tthis.trackers.forEach(t => t.onError ? t.onError(error) : undefined);\n\t}\n\n\tonExit(code: number, signal: string): void {\n\t\tthis.trackers.forEach(t => t.onExit ? t.onExit(code, signal) : undefined);\n\t}\n}\n\n/*\n * Call directly into a debug adapter implementation\n */\nclass DirectDebugAdapter extends AbstractDebugAdapter {\n\n\tconstructor(private implementation: vscode.DebugAdapter) {\n\t\tsuper();\n\n\t\timplementation.onDidSendMessage((message: vscode.DebugProtocolMessage) => {\n\t\t\tthis.acceptMessage(message as DebugProtocol.ProtocolMessage);\n\t\t});\n\t}\n\n\tstartSession(): Promise<void> {\n\t\treturn Promise.resolve(undefined);\n\t}\n\n\tsendMessage(message: DebugProtocol.ProtocolMessage): void {\n\t\tthis.implementation.handleMessage(message);\n\t}\n\n\tstopSession(): Promise<void> {\n\t\tthis.implementation.dispose();\n\t\treturn Promise.resolve(undefined);\n\t}\n}\n\n\nexport class WorkerExtHostDebugService extends ExtHostDebugServiceBase {\n\tconstructor(\n\t\t@IExtHostRpcService extHostRpcService: IExtHostRpcService,\n\t\t@IExtHostWorkspace workspaceService: IExtHostWorkspace,\n\t\t@IExtHostExtensionService extensionService: IExtHostExtensionService,\n\t\t@IExtHostDocumentsAndEditors editorsService: IExtHostDocumentsAndEditors,\n\t\t@IExtHostConfiguration configurationService: IExtHostConfiguration\n\t) {\n\t\tsuper(extHostRpcService, workspaceService, extensionService, editorsService, configurationService);\n\t}\n\n\tprotected createVariableResolver(folders: vscode.WorkspaceFolder[], editorService: ExtHostDocumentsAndEditors, configurationService: ExtHostConfigProvider): AbstractVariableResolverService {\n\t\treturn new ExtHostVariableResolverService(folders, editorService, configurationService);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as performance from 'vs/base/common/performance';\nimport { TernarySearchTree } from 'vs/base/common/map';\nimport { URI } from 'vs/base/common/uri';\nimport { MainThreadTelemetryShape, MainContext } from 'vs/workbench/api/common/extHost.protocol';\nimport { ExtHostConfigProvider, IExtHostConfiguration } from 'vs/workbench/api/common/extHostConfiguration';\nimport { nullExtensionDescription } from 'vs/workbench/services/extensions/common/extensions';\nimport { ExtensionDescriptionRegistry } from 'vs/workbench/services/extensions/common/extensionDescriptionRegistry';\nimport * as vscode from 'vscode';\nimport { ExtensionIdentifier, IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { IExtensionApiFactory } from 'vs/workbench/api/common/extHost.api.impl';\nimport { IExtHostRpcService } from 'vs/workbench/api/common/extHostRpcService';\nimport { IExtHostInitDataService } from 'vs/workbench/api/common/extHostInitDataService';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { IExtHostExtensionService } from 'vs/workbench/api/common/extHostExtensionService';\nimport { platform } from 'vs/base/common/process';\nimport { ILogService } from 'vs/platform/log/common/log';\n\n\ninterface LoadFunction {\n\t(request: string): any;\n}\n\ninterface INodeModuleFactory {\n\treadonly nodeModuleName: string | string[];\n\tload(request: string, parent: URI, original: LoadFunction): any;\n\talternativeModuleName?(name: string): string | undefined;\n}\n\nexport abstract class RequireInterceptor {\n\n\tprotected readonly _factories: Map<string, INodeModuleFactory>;\n\tprotected readonly _alternatives: ((moduleName: string) => string | undefined)[];\n\n\tconstructor(\n\t\tprivate _apiFactory: IExtensionApiFactory,\n\t\tprivate _extensionRegistry: ExtensionDescriptionRegistry,\n\t\t@IInstantiationService private readonly _instaService: IInstantiationService,\n\t\t@IExtHostConfiguration private readonly _extHostConfiguration: IExtHostConfiguration,\n\t\t@IExtHostExtensionService private readonly _extHostExtensionService: IExtHostExtensionService,\n\t\t@IExtHostInitDataService private readonly _initData: IExtHostInitDataService,\n\t\t@ILogService private readonly _logService: ILogService,\n\t) {\n\t\tthis._factories = new Map<string, INodeModuleFactory>();\n\t\tthis._alternatives = [];\n\t}\n\n\tasync install(): Promise<void> {\n\n\t\tthis._installInterceptor();\n\n\t\tperformance.mark('code/extHost/willWaitForConfig');\n\t\tconst configProvider = await this._extHostConfiguration.getConfigProvider();\n\t\tperformance.mark('code/extHost/didWaitForConfig');\n\t\tconst extensionPaths = await this._extHostExtensionService.getExtensionPathIndex();\n\n\t\tthis.register(new VSCodeNodeModuleFactory(this._apiFactory, extensionPaths, this._extensionRegistry, configProvider, this._logService));\n\t\tthis.register(this._instaService.createInstance(KeytarNodeModuleFactory));\n\t\tif (this._initData.remote.isRemote) {\n\t\t\tthis.register(this._instaService.createInstance(OpenNodeModuleFactory, extensionPaths, this._initData.environment.appUriScheme));\n\t\t}\n\t}\n\n\tprotected abstract _installInterceptor(): void;\n\n\tpublic register(interceptor: INodeModuleFactory): void {\n\t\tif (Array.isArray(interceptor.nodeModuleName)) {\n\t\t\tfor (let moduleName of interceptor.nodeModuleName) {\n\t\t\t\tthis._factories.set(moduleName, interceptor);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._factories.set(interceptor.nodeModuleName, interceptor);\n\t\t}\n\t\tif (typeof interceptor.alternativeModuleName === 'function') {\n\t\t\tthis._alternatives.push((moduleName) => {\n\t\t\t\treturn interceptor.alternativeModuleName!(moduleName);\n\t\t\t});\n\t\t}\n\t}\n}\n\n//#region --- vscode-module\n\nclass VSCodeNodeModuleFactory implements INodeModuleFactory {\n\tpublic readonly nodeModuleName = 'vscode';\n\n\tprivate readonly _extApiImpl = new Map<string, typeof vscode>();\n\tprivate _defaultApiImpl?: typeof vscode;\n\n\tconstructor(\n\t\tprivate readonly _apiFactory: IExtensionApiFactory,\n\t\tprivate readonly _extensionPaths: TernarySearchTree<string, IExtensionDescription>,\n\t\tprivate readonly _extensionRegistry: ExtensionDescriptionRegistry,\n\t\tprivate readonly _configProvider: ExtHostConfigProvider,\n\t\tprivate readonly _logService: ILogService,\n\t) {\n\t}\n\n\tpublic load(_request: string, parent: URI): any {\n\n\t\t// get extension id from filename and api for extension\n\t\tconst ext = this._extensionPaths.findSubstr(parent.fsPath);\n\t\tif (ext) {\n\t\t\tlet apiImpl = this._extApiImpl.get(ExtensionIdentifier.toKey(ext.identifier));\n\t\t\tif (!apiImpl) {\n\t\t\t\tapiImpl = this._apiFactory(ext, this._extensionRegistry, this._configProvider);\n\t\t\t\tthis._extApiImpl.set(ExtensionIdentifier.toKey(ext.identifier), apiImpl);\n\t\t\t}\n\t\t\treturn apiImpl;\n\t\t}\n\n\t\t// fall back to a default implementation\n\t\tif (!this._defaultApiImpl) {\n\t\t\tlet extensionPathsPretty = '';\n\t\t\tthis._extensionPaths.forEach((value, index) => extensionPathsPretty += `\\t${index} -> ${value.identifier.value}\\n`);\n\t\t\tthis._logService.warn(`Could not identify extension for 'vscode' require call from ${parent.fsPath}. These are the extension path mappings: \\n${extensionPathsPretty}`);\n\t\t\tthis._defaultApiImpl = this._apiFactory(nullExtensionDescription, this._extensionRegistry, this._configProvider);\n\t\t}\n\t\treturn this._defaultApiImpl;\n\t}\n}\n\n//#endregion\n\n\n//#region --- keytar-module\n\ninterface IKeytarModule {\n\tgetPassword(service: string, account: string): Promise<string | null>;\n\tsetPassword(service: string, account: string, password: string): Promise<void>;\n\tdeletePassword(service: string, account: string): Promise<boolean>;\n\tfindPassword(service: string): Promise<string | null>;\n\tfindCredentials(service: string): Promise<Array<{ account: string, password: string }>>;\n}\n\nclass KeytarNodeModuleFactory implements INodeModuleFactory {\n\tpublic readonly nodeModuleName: string = 'keytar';\n\n\tprivate alternativeNames: Set<string> | undefined;\n\tprivate _impl: IKeytarModule;\n\n\tconstructor(\n\t\t@IExtHostRpcService rpcService: IExtHostRpcService,\n\t\t@IExtHostInitDataService initData: IExtHostInitDataService,\n\n\t) {\n\t\tconst { environment } = initData;\n\t\tconst mainThreadKeytar = rpcService.getProxy(MainContext.MainThreadKeytar);\n\n\t\tif (environment.appRoot) {\n\t\t\tlet appRoot = environment.appRoot.fsPath;\n\t\t\tif (platform === 'win32') {\n\t\t\t\tappRoot = appRoot.replace(/\\\\/g, '/');\n\t\t\t}\n\t\t\tif (appRoot[appRoot.length - 1] === '/') {\n\t\t\t\tappRoot = appRoot.substr(0, appRoot.length - 1);\n\t\t\t}\n\t\t\tthis.alternativeNames = new Set();\n\t\t\tthis.alternativeNames.add(`${appRoot}/node_modules.asar/keytar`);\n\t\t\tthis.alternativeNames.add(`${appRoot}/node_modules/keytar`);\n\t\t}\n\t\tthis._impl = {\n\t\t\tgetPassword: (service: string, account: string): Promise<string | null> => {\n\t\t\t\treturn mainThreadKeytar.$getPassword(service, account);\n\t\t\t},\n\t\t\tsetPassword: (service: string, account: string, password: string): Promise<void> => {\n\t\t\t\treturn mainThreadKeytar.$setPassword(service, account, password);\n\t\t\t},\n\t\t\tdeletePassword: (service: string, account: string): Promise<boolean> => {\n\t\t\t\treturn mainThreadKeytar.$deletePassword(service, account);\n\t\t\t},\n\t\t\tfindPassword: (service: string): Promise<string | null> => {\n\t\t\t\treturn mainThreadKeytar.$findPassword(service);\n\t\t\t},\n\t\t\tfindCredentials(service: string): Promise<Array<{ account: string, password: string }>> {\n\t\t\t\treturn mainThreadKeytar.$findCredentials(service);\n\t\t\t}\n\t\t};\n\t}\n\n\tpublic load(_request: string, _parent: URI): any {\n\t\treturn this._impl;\n\t}\n\n\tpublic alternativeModuleName(name: string): string | undefined {\n\t\tconst length = name.length;\n\t\t// We need at least something like: `?/keytar` which requires\n\t\t// more than 7 characters.\n\t\tif (length <= 7 || !this.alternativeNames) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst sep = length - 7;\n\t\tif ((name.charAt(sep) === '/' || name.charAt(sep) === '\\\\') && name.endsWith('keytar')) {\n\t\t\tname = name.replace(/\\\\/g, '/');\n\t\t\tif (this.alternativeNames.has(name)) {\n\t\t\t\treturn 'keytar';\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n}\n\n//#endregion\n\n\n//#region --- opn/open-module\n\ninterface OpenOptions {\n\twait: boolean;\n\tapp: string | string[];\n}\n\ninterface IOriginalOpen {\n\t(target: string, options?: OpenOptions): Thenable<any>;\n}\n\ninterface IOpenModule {\n\t(target: string, options?: OpenOptions): Thenable<void>;\n}\n\nclass OpenNodeModuleFactory implements INodeModuleFactory {\n\n\tpublic readonly nodeModuleName: string[] = ['open', 'opn'];\n\n\tprivate _extensionId: string | undefined;\n\tprivate _original?: IOriginalOpen;\n\tprivate _impl: IOpenModule;\n\tprivate _mainThreadTelemetry: MainThreadTelemetryShape;\n\n\tconstructor(\n\t\tprivate readonly _extensionPaths: TernarySearchTree<string, IExtensionDescription>,\n\t\tprivate readonly _appUriScheme: string,\n\t\t@IExtHostRpcService rpcService: IExtHostRpcService,\n\t) {\n\n\t\tthis._mainThreadTelemetry = rpcService.getProxy(MainContext.MainThreadTelemetry);\n\t\tconst mainThreadWindow = rpcService.getProxy(MainContext.MainThreadWindow);\n\n\t\tthis._impl = (target, options) => {\n\t\t\tconst uri: URI = URI.parse(target);\n\t\t\t// If we have options use the original method.\n\t\t\tif (options) {\n\t\t\t\treturn this.callOriginal(target, options);\n\t\t\t}\n\t\t\tif (uri.scheme === 'http' || uri.scheme === 'https') {\n\t\t\t\treturn mainThreadWindow.$openUri(uri, target, { allowTunneling: true });\n\t\t\t} else if (uri.scheme === 'mailto' || uri.scheme === this._appUriScheme) {\n\t\t\t\treturn mainThreadWindow.$openUri(uri, target, {});\n\t\t\t}\n\t\t\treturn this.callOriginal(target, options);\n\t\t};\n\t}\n\n\tpublic load(request: string, parent: URI, original: LoadFunction): any {\n\t\t// get extension id from filename and api for extension\n\t\tconst extension = this._extensionPaths.findSubstr(parent.fsPath);\n\t\tif (extension) {\n\t\t\tthis._extensionId = extension.identifier.value;\n\t\t\tthis.sendShimmingTelemetry();\n\t\t}\n\n\t\tthis._original = original(request);\n\t\treturn this._impl;\n\t}\n\n\tprivate callOriginal(target: string, options: OpenOptions | undefined): Thenable<any> {\n\t\tthis.sendNoForwardTelemetry();\n\t\treturn this._original!(target, options);\n\t}\n\n\tprivate sendShimmingTelemetry(): void {\n\t\tif (!this._extensionId) {\n\t\t\treturn;\n\t\t}\n\t\ttype ShimmingOpenClassification = {\n\t\t\textension: { classification: 'SystemMetaData', purpose: 'FeatureInsight' };\n\t\t};\n\t\tthis._mainThreadTelemetry.$publicLog2<{ extension: string }, ShimmingOpenClassification>('shimming.open', { extension: this._extensionId });\n\t}\n\n\tprivate sendNoForwardTelemetry(): void {\n\t\tif (!this._extensionId) {\n\t\t\treturn;\n\t\t}\n\t\ttype ShimmingOpenCallNoForwardClassification = {\n\t\t\textension: { classification: 'SystemMetaData', purpose: 'FeatureInsight' };\n\t\t};\n\t\tthis._mainThreadTelemetry.$publicLog2<{ extension: string }, ShimmingOpenCallNoForwardClassification>('shimming.open.call.noForward', { extension: this._extensionId });\n\t}\n}\n\n//#endregion\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as nls from 'vs/nls';\nimport type * as vscode from 'vscode';\nimport * as env from 'vs/base/common/platform';\nimport { DebugAdapterExecutable } from 'vs/workbench/api/common/extHostTypes';\nimport { ExecutableDebugAdapter, SocketDebugAdapter, NamedPipeDebugAdapter } from 'vs/workbench/contrib/debug/node/debugAdapter';\nimport { AbstractDebugAdapter } from 'vs/workbench/contrib/debug/common/abstractDebugAdapter';\nimport { IExtHostWorkspace } from 'vs/workbench/api/common/extHostWorkspace';\nimport { IExtHostExtensionService } from 'vs/workbench/api/common/extHostExtensionService';\nimport { IExtHostDocumentsAndEditors, ExtHostDocumentsAndEditors } from 'vs/workbench/api/common/extHostDocumentsAndEditors';\nimport { IAdapterDescriptor } from 'vs/workbench/contrib/debug/common/debug';\nimport { IExtHostConfiguration, ExtHostConfigProvider } from '../common/extHostConfiguration';\nimport { ExtensionDescriptionRegistry } from 'vs/workbench/services/extensions/common/extensionDescriptionRegistry';\nimport { IExtHostTerminalService } from 'vs/workbench/api/common/extHostTerminalService';\nimport { IExtHostRpcService } from 'vs/workbench/api/common/extHostRpcService';\nimport { ExtHostDebugServiceBase, ExtHostDebugSession, ExtHostVariableResolverService } from 'vs/workbench/api/common/extHostDebugService';\nimport { ISignService } from 'vs/platform/sign/common/sign';\nimport { SignService } from 'vs/platform/sign/node/signService';\nimport { hasChildProcesses, prepareCommand, runInExternalTerminal } from 'vs/workbench/contrib/debug/node/terminals';\nimport { IDisposable } from 'vs/base/common/lifecycle';\nimport { AbstractVariableResolverService } from 'vs/workbench/services/configurationResolver/common/variableResolver';\nimport { createCancelablePromise, firstParallel } from 'vs/base/common/async';\n\n\nexport class ExtHostDebugService extends ExtHostDebugServiceBase {\n\n\treadonly _serviceBrand: undefined;\n\n\tprivate _integratedTerminalInstances = new DebugTerminalCollection();\n\tprivate _terminalDisposedListener: IDisposable | undefined;\n\n\tconstructor(\n\t\t@IExtHostRpcService extHostRpcService: IExtHostRpcService,\n\t\t@IExtHostWorkspace workspaceService: IExtHostWorkspace,\n\t\t@IExtHostExtensionService extensionService: IExtHostExtensionService,\n\t\t@IExtHostDocumentsAndEditors editorsService: IExtHostDocumentsAndEditors,\n\t\t@IExtHostConfiguration configurationService: IExtHostConfiguration,\n\t\t@IExtHostTerminalService private _terminalService: IExtHostTerminalService\n\t) {\n\t\tsuper(extHostRpcService, workspaceService, extensionService, editorsService, configurationService);\n\t}\n\n\tprotected createDebugAdapter(adapter: IAdapterDescriptor, session: ExtHostDebugSession): AbstractDebugAdapter | undefined {\n\t\tswitch (adapter.type) {\n\t\t\tcase 'server':\n\t\t\t\treturn new SocketDebugAdapter(adapter);\n\t\t\tcase 'pipeServer':\n\t\t\t\treturn new NamedPipeDebugAdapter(adapter);\n\t\t\tcase 'executable':\n\t\t\t\treturn new ExecutableDebugAdapter(adapter, session.type);\n\t\t}\n\t\treturn super.createDebugAdapter(adapter, session);\n\t}\n\n\tprotected daExecutableFromPackage(session: ExtHostDebugSession, extensionRegistry: ExtensionDescriptionRegistry): DebugAdapterExecutable | undefined {\n\t\tconst dae = ExecutableDebugAdapter.platformAdapterExecutable(extensionRegistry.getAllExtensionDescriptions(), session.type);\n\t\tif (dae) {\n\t\t\treturn new DebugAdapterExecutable(dae.command, dae.args, dae.options);\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprotected createSignService(): ISignService | undefined {\n\t\treturn new SignService();\n\t}\n\n\tpublic async $runInTerminal(args: DebugProtocol.RunInTerminalRequestArguments): Promise<number | undefined> {\n\n\t\tif (args.kind === 'integrated') {\n\n\t\t\tif (!this._terminalDisposedListener) {\n\t\t\t\t// React on terminal disposed and check if that is the debug terminal #12956\n\t\t\t\tthis._terminalDisposedListener = this._terminalService.onDidCloseTerminal(terminal => {\n\t\t\t\t\tthis._integratedTerminalInstances.onTerminalClosed(terminal);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst configProvider = await this._configurationService.getConfigProvider();\n\t\t\tconst shell = this._terminalService.getDefaultShell(true, configProvider);\n\t\t\tconst shellArgs = this._terminalService.getDefaultShellArgs(true, configProvider);\n\n\t\t\tconst shellConfig = JSON.stringify({ shell, shellArgs });\n\t\t\tlet terminal = await this._integratedTerminalInstances.checkout(shellConfig);\n\n\t\t\tlet cwdForPrepareCommand: string | undefined;\n\t\t\tlet giveShellTimeToInitialize = false;\n\n\t\t\tif (!terminal) {\n\t\t\t\tconst options: vscode.TerminalOptions = {\n\t\t\t\t\tshellPath: shell,\n\t\t\t\t\tshellArgs: shellArgs,\n\t\t\t\t\tcwd: args.cwd,\n\t\t\t\t\tname: args.title || nls.localize('debug.terminal.title', \"debuggee\"),\n\t\t\t\t};\n\t\t\t\tgiveShellTimeToInitialize = true;\n\t\t\t\tterminal = this._terminalService.createTerminalFromOptions(options, true);\n\t\t\t\tthis._integratedTerminalInstances.insert(terminal, shellConfig);\n\n\t\t\t} else {\n\t\t\t\tcwdForPrepareCommand = args.cwd;\n\t\t\t}\n\n\t\t\tterminal.show(true);\n\n\t\t\tconst shellProcessId = await terminal.processId;\n\n\t\t\tif (giveShellTimeToInitialize) {\n\t\t\t\t// give a new terminal some time to initialize the shell\n\t\t\t\tawait new Promise(resolve => setTimeout(resolve, 1000));\n\t\t\t}\n\n\t\t\tconst command = prepareCommand(shell, args.args, cwdForPrepareCommand, args.env);\n\t\t\tterminal.sendText(command, true);\n\n\t\t\treturn shellProcessId;\n\n\t\t} else if (args.kind === 'external') {\n\n\t\t\treturn runInExternalTerminal(args, await this._configurationService.getConfigProvider());\n\t\t}\n\t\treturn super.$runInTerminal(args);\n\t}\n\n\tprotected createVariableResolver(folders: vscode.WorkspaceFolder[], editorService: ExtHostDocumentsAndEditors, configurationService: ExtHostConfigProvider): AbstractVariableResolverService {\n\t\treturn new ExtHostVariableResolverService(folders, editorService, configurationService, process.env as env.IProcessEnvironment, this._workspaceService);\n\t}\n}\n\nclass DebugTerminalCollection {\n\t/**\n\t * Delay before a new terminal is a candidate for reuse. See #71850\n\t */\n\tprivate static minUseDelay = 1000;\n\n\tprivate _terminalInstances = new Map<vscode.Terminal, { lastUsedAt: number, config: string }>();\n\n\tpublic async checkout(config: string) {\n\t\tconst entries = [...this._terminalInstances.keys()];\n\t\tconst promises = entries.map((terminal) => createCancelablePromise(async ct => {\n\t\t\tconst pid = await terminal.processId;\n\t\t\tif (await hasChildProcesses(pid)) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// important: date check and map operations must be synchronous\n\t\t\tconst now = Date.now();\n\t\t\tconst termInfo = this._terminalInstances.get(terminal);\n\t\t\tif (!termInfo || termInfo.lastUsedAt + DebugTerminalCollection.minUseDelay > now || ct.isCancellationRequested) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (termInfo.config !== config) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\ttermInfo.lastUsedAt = now;\n\t\t\treturn terminal;\n\t\t}));\n\n\t\treturn await firstParallel(promises, (t): t is vscode.Terminal => !!t);\n\t}\n\n\tpublic insert(terminal: vscode.Terminal, termConfig: string) {\n\t\tthis._terminalInstances.set(terminal, { lastUsedAt: Date.now(), config: termConfig });\n\t}\n\n\tpublic onTerminalClosed(terminal: vscode.Terminal) {\n\t\tthis._terminalInstances.delete(terminal);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as path from 'vs/base/common/path';\n\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { win32 } from 'vs/base/node/processes';\nimport * as types from 'vs/workbench/api/common/extHostTypes';\nimport { IExtHostWorkspace } from 'vs/workbench/api/common/extHostWorkspace';\nimport type * as vscode from 'vscode';\nimport * as tasks from '../common/shared/tasks';\nimport { ExtHostVariableResolverService } from 'vs/workbench/api/common/extHostDebugService';\nimport { IExtHostDocumentsAndEditors } from 'vs/workbench/api/common/extHostDocumentsAndEditors';\nimport { IExtHostConfiguration } from 'vs/workbench/api/common/extHostConfiguration';\nimport { IWorkspaceFolder } from 'vs/platform/workspace/common/workspace';\nimport { IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { IExtHostTerminalService } from 'vs/workbench/api/common/extHostTerminalService';\nimport { IExtHostRpcService } from 'vs/workbench/api/common/extHostRpcService';\nimport { IExtHostInitDataService } from 'vs/workbench/api/common/extHostInitDataService';\nimport { ExtHostTaskBase, TaskHandleDTO, TaskDTO, CustomExecutionDTO, HandlerData } from 'vs/workbench/api/common/extHostTask';\nimport { Schemas } from 'vs/base/common/network';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { IProcessEnvironment } from 'vs/base/common/platform';\nimport { IExtHostApiDeprecationService } from 'vs/workbench/api/common/extHostApiDeprecationService';\n\nexport class ExtHostTask extends ExtHostTaskBase {\n\tprivate _variableResolver: ExtHostVariableResolverService | undefined;\n\n\tconstructor(\n\t\t@IExtHostRpcService extHostRpc: IExtHostRpcService,\n\t\t@IExtHostInitDataService initData: IExtHostInitDataService,\n\t\t@IExtHostWorkspace private readonly workspaceService: IExtHostWorkspace,\n\t\t@IExtHostDocumentsAndEditors editorService: IExtHostDocumentsAndEditors,\n\t\t@IExtHostConfiguration configurationService: IExtHostConfiguration,\n\t\t@IExtHostTerminalService extHostTerminalService: IExtHostTerminalService,\n\t\t@ILogService logService: ILogService,\n\t\t@IExtHostApiDeprecationService deprecationService: IExtHostApiDeprecationService\n\t) {\n\t\tsuper(extHostRpc, initData, workspaceService, editorService, configurationService, extHostTerminalService, logService, deprecationService);\n\t\tif (initData.remote.isRemote && initData.remote.authority) {\n\t\t\tthis.registerTaskSystem(Schemas.vscodeRemote, {\n\t\t\t\tscheme: Schemas.vscodeRemote,\n\t\t\t\tauthority: initData.remote.authority,\n\t\t\t\tplatform: process.platform\n\t\t\t});\n\t\t}\n\t\tthis._proxy.$registerSupportedExecutions(true, true, true);\n\t}\n\n\tpublic async executeTask(extension: IExtensionDescription, task: vscode.Task): Promise<vscode.TaskExecution> {\n\t\tconst tTask = (task as types.Task);\n\n\t\tif (!task.execution && (tTask._id === undefined)) {\n\t\t\tthrow new Error('Tasks to execute must include an execution');\n\t\t}\n\n\t\t// We have a preserved ID. So the task didn't change.\n\t\tif (tTask._id !== undefined) {\n\t\t\t// Always get the task execution first to prevent timing issues when retrieving it later\n\t\t\tconst handleDto = TaskHandleDTO.from(tTask, this.workspaceService);\n\t\t\tconst executionDTO = await this._proxy.$getTaskExecution(handleDto);\n\t\t\tif (executionDTO.task === undefined) {\n\t\t\t\tthrow new Error('Task from execution DTO is undefined');\n\t\t\t}\n\t\t\tconst execution = await this.getTaskExecution(executionDTO, task);\n\t\t\tthis._proxy.$executeTask(handleDto).catch(() => { /* The error here isn't actionable. */ });\n\t\t\treturn execution;\n\t\t} else {\n\t\t\tconst dto = TaskDTO.from(task, extension);\n\t\t\tif (dto === undefined) {\n\t\t\t\treturn Promise.reject(new Error('Task is not valid'));\n\t\t\t}\n\n\t\t\t// If this task is a custom execution, then we need to save it away\n\t\t\t// in the provided custom execution map that is cleaned up after the\n\t\t\t// task is executed.\n\t\t\tif (CustomExecutionDTO.is(dto.execution)) {\n\t\t\t\tawait this.addCustomExecution(dto, task, false);\n\t\t\t}\n\t\t\t// Always get the task execution first to prevent timing issues when retrieving it later\n\t\t\tconst execution = await this.getTaskExecution(await this._proxy.$getTaskExecution(dto), task);\n\t\t\tthis._proxy.$executeTask(dto).catch(() => { /* The error here isn't actionable. */ });\n\t\t\treturn execution;\n\t\t}\n\t}\n\n\tprotected provideTasksInternal(validTypes: { [key: string]: boolean; }, taskIdPromises: Promise<void>[], handler: HandlerData, value: vscode.Task[] | null | undefined): { tasks: tasks.TaskDTO[], extension: IExtensionDescription } {\n\t\tconst taskDTOs: tasks.TaskDTO[] = [];\n\t\tif (value) {\n\t\t\tfor (let task of value) {\n\t\t\t\tthis.checkDeprecation(task, handler);\n\n\t\t\t\tif (!task.definition || !validTypes[task.definition.type]) {\n\t\t\t\t\tthis._logService.warn(`The task [${task.source}, ${task.name}] uses an undefined task type. The task will be ignored in the future.`);\n\t\t\t\t}\n\n\t\t\t\tconst taskDTO: tasks.TaskDTO | undefined = TaskDTO.from(task, handler.extension);\n\t\t\t\tif (taskDTO) {\n\t\t\t\t\ttaskDTOs.push(taskDTO);\n\n\t\t\t\t\tif (CustomExecutionDTO.is(taskDTO.execution)) {\n\t\t\t\t\t\t// The ID is calculated on the main thread task side, so, let's call into it here.\n\t\t\t\t\t\t// We need the task id's pre-computed for custom task executions because when OnDidStartTask\n\t\t\t\t\t\t// is invoked, we have to be able to map it back to our data.\n\t\t\t\t\t\ttaskIdPromises.push(this.addCustomExecution(taskDTO, task, true));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\ttasks: taskDTOs,\n\t\t\textension: handler.extension\n\t\t};\n\t}\n\n\tprotected async resolveTaskInternal(resolvedTaskDTO: tasks.TaskDTO): Promise<tasks.TaskDTO | undefined> {\n\t\treturn resolvedTaskDTO;\n\t}\n\n\tprivate async getVariableResolver(workspaceFolders: vscode.WorkspaceFolder[]): Promise<ExtHostVariableResolverService> {\n\t\tif (this._variableResolver === undefined) {\n\t\t\tconst configProvider = await this._configurationService.getConfigProvider();\n\t\t\tthis._variableResolver = new ExtHostVariableResolverService(workspaceFolders, this._editorService, configProvider, process.env as IProcessEnvironment, this.workspaceService);\n\t\t}\n\t\treturn this._variableResolver;\n\t}\n\n\tpublic async $resolveVariables(uriComponents: UriComponents, toResolve: { process?: { name: string; cwd?: string; path?: string }, variables: string[] }): Promise<{ process?: string, variables: { [key: string]: string; } }> {\n\t\tconst uri: URI = URI.revive(uriComponents);\n\t\tconst result = {\n\t\t\tprocess: <unknown>undefined as string,\n\t\t\tvariables: Object.create(null)\n\t\t};\n\t\tconst workspaceFolder = await this._workspaceProvider.resolveWorkspaceFolder(uri);\n\t\tconst workspaceFolders = await this._workspaceProvider.getWorkspaceFolders2();\n\t\tif (!workspaceFolders || !workspaceFolder) {\n\t\t\tthrow new Error('Unexpected: Tasks can only be run in a workspace folder');\n\t\t}\n\t\tconst resolver = await this.getVariableResolver(workspaceFolders);\n\t\tconst ws: IWorkspaceFolder = {\n\t\t\turi: workspaceFolder.uri,\n\t\t\tname: workspaceFolder.name,\n\t\t\tindex: workspaceFolder.index,\n\t\t\ttoResource: () => {\n\t\t\t\tthrow new Error('Not implemented');\n\t\t\t}\n\t\t};\n\t\tfor (let variable of toResolve.variables) {\n\t\t\tresult.variables[variable] = resolver.resolve(ws, variable);\n\t\t}\n\t\tif (toResolve.process !== undefined) {\n\t\t\tlet paths: string[] | undefined = undefined;\n\t\t\tif (toResolve.process.path !== undefined) {\n\t\t\t\tpaths = toResolve.process.path.split(path.delimiter);\n\t\t\t\tfor (let i = 0; i < paths.length; i++) {\n\t\t\t\t\tpaths[i] = resolver.resolve(ws, paths[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tresult.process = await win32.findExecutable(\n\t\t\t\tresolver.resolve(ws, toResolve.process.name),\n\t\t\t\ttoResolve.process.cwd !== undefined ? resolver.resolve(ws, toResolve.process.cwd) : undefined,\n\t\t\t\tpaths\n\t\t\t);\n\t\t}\n\t\treturn result;\n\t}\n\n\tpublic $getDefaultShellAndArgs(): Promise<{ shell: string, args: string[] | string | undefined }> {\n\t\treturn this._terminalService.$getDefaultShellAndArgs(true);\n\t}\n\n\tpublic async $jsonTasksSupported(): Promise<boolean> {\n\t\treturn true;\n\t}\n\n\tpublic async $findExecutable(command: string, cwd?: string, paths?: string[]): Promise<string> {\n\t\treturn win32.findExecutable(command, cwd, paths);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type * as vscode from 'vscode';\nimport * as os from 'os';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport * as platform from 'vs/base/common/platform';\nimport * as terminalEnvironment from 'vs/workbench/contrib/terminal/common/terminalEnvironment';\nimport { IShellLaunchConfigDto, IShellDefinitionDto, IShellAndArgsDto } from 'vs/workbench/api/common/extHost.protocol';\nimport { ExtHostConfiguration, ExtHostConfigProvider, IExtHostConfiguration } from 'vs/workbench/api/common/extHostConfiguration';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { IShellLaunchConfig, ITerminalEnvironment, ITerminalLaunchError } from 'vs/workbench/contrib/terminal/common/terminal';\nimport { TerminalProcess } from 'vs/workbench/contrib/terminal/node/terminalProcess';\nimport { ExtHostWorkspace, IExtHostWorkspace } from 'vs/workbench/api/common/extHostWorkspace';\nimport { IWorkspaceFolder } from 'vs/platform/workspace/common/workspace';\nimport { ExtHostVariableResolverService } from 'vs/workbench/api/common/extHostDebugService';\nimport { ExtHostDocumentsAndEditors, IExtHostDocumentsAndEditors } from 'vs/workbench/api/common/extHostDocumentsAndEditors';\nimport { detectAvailableShells } from 'vs/workbench/contrib/terminal/node/terminal';\nimport { getMainProcessParentEnv } from 'vs/workbench/contrib/terminal/node/terminalEnvironment';\nimport { BaseExtHostTerminalService, ExtHostTerminal } from 'vs/workbench/api/common/extHostTerminalService';\nimport { IExtHostRpcService } from 'vs/workbench/api/common/extHostRpcService';\nimport { MergedEnvironmentVariableCollection } from 'vs/workbench/contrib/terminal/common/environmentVariableCollection';\nimport { IExtHostInitDataService } from 'vs/workbench/api/common/extHostInitDataService';\nimport { withNullAsUndefined } from 'vs/base/common/types';\nimport { getSystemShell, getSystemShellSync } from 'vs/base/node/shell';\nimport { generateUuid } from 'vs/base/common/uuid';\n\nexport class ExtHostTerminalService extends BaseExtHostTerminalService {\n\n\tprivate _variableResolver: ExtHostVariableResolverService | undefined;\n\tprivate _lastActiveWorkspace: IWorkspaceFolder | undefined;\n\n\t// TODO: Pull this from main side\n\tprivate _isWorkspaceShellAllowed: boolean = false;\n\tprivate _defaultShell: string | undefined;\n\n\tconstructor(\n\t\t@IExtHostRpcService extHostRpc: IExtHostRpcService,\n\t\t@IExtHostConfiguration private _extHostConfiguration: ExtHostConfiguration,\n\t\t@IExtHostWorkspace private _extHostWorkspace: ExtHostWorkspace,\n\t\t@IExtHostDocumentsAndEditors private _extHostDocumentsAndEditors: ExtHostDocumentsAndEditors,\n\t\t@ILogService private _logService: ILogService,\n\t\t@IExtHostInitDataService private _extHostInitDataService: IExtHostInitDataService\n\t) {\n\t\tsuper(true, extHostRpc);\n\n\t\t// Getting the SystemShell is an async operation, however, the ExtHost terminal service is mostly synchronous\n\t\t// and the API `vscode.env.shell` is also synchronous. The default shell _should_ be set when extensions are\n\t\t// starting up but if not, we run getSystemShellSync below which gets a sane default.\n\t\tgetSystemShell(platform.platform).then(s => this._defaultShell = s);\n\n\t\tthis._updateLastActiveWorkspace();\n\t\tthis._updateVariableResolver();\n\t\tthis._registerListeners();\n\t}\n\n\tpublic createTerminal(name?: string, shellPath?: string, shellArgs?: string[] | string): vscode.Terminal {\n\t\tconst terminal = new ExtHostTerminal(this._proxy, generateUuid(), { name, shellPath, shellArgs }, name);\n\t\tthis._terminals.push(terminal);\n\t\tterminal.create(shellPath, shellArgs);\n\t\treturn terminal;\n\t}\n\n\tpublic createTerminalFromOptions(options: vscode.TerminalOptions, isFeatureTerminal?: boolean): vscode.Terminal {\n\t\tconst terminal = new ExtHostTerminal(this._proxy, generateUuid(), options, options.name);\n\t\tthis._terminals.push(terminal);\n\t\tterminal.create(\n\t\t\twithNullAsUndefined(options.shellPath),\n\t\t\twithNullAsUndefined(options.shellArgs),\n\t\t\twithNullAsUndefined(options.cwd),\n\t\t\twithNullAsUndefined(options.env),\n\t\t\t/*options.waitOnExit*/ undefined,\n\t\t\twithNullAsUndefined(options.strictEnv),\n\t\t\twithNullAsUndefined(options.hideFromUser),\n\t\t\twithNullAsUndefined(isFeatureTerminal));\n\t\treturn terminal;\n\t}\n\n\tpublic getDefaultShell(useAutomationShell: boolean, configProvider: ExtHostConfigProvider): string {\n\t\tconst fetchSetting = (key: string): { userValue: string | string[] | undefined, value: string | string[] | undefined, defaultValue: string | string[] | undefined } => {\n\t\t\tconst setting = configProvider\n\t\t\t\t.getConfiguration(key.substr(0, key.lastIndexOf('.')))\n\t\t\t\t.inspect<string | string[]>(key.substr(key.lastIndexOf('.') + 1));\n\t\t\treturn this._apiInspectConfigToPlain<string | string[]>(setting);\n\t\t};\n\n\t\treturn terminalEnvironment.getDefaultShell(\n\t\t\tfetchSetting,\n\t\t\tthis._isWorkspaceShellAllowed,\n\t\t\tthis._defaultShell ?? getSystemShellSync(platform.platform),\n\t\t\tprocess.env.hasOwnProperty('PROCESSOR_ARCHITEW6432'),\n\t\t\tprocess.env.windir,\n\t\t\tterminalEnvironment.createVariableResolver(this._lastActiveWorkspace, this._variableResolver),\n\t\t\tthis._logService,\n\t\t\tuseAutomationShell\n\t\t);\n\t}\n\n\tpublic getDefaultShellArgs(useAutomationShell: boolean, configProvider: ExtHostConfigProvider): string[] | string {\n\t\tconst fetchSetting = (key: string): { userValue: string | string[] | undefined, value: string | string[] | undefined, defaultValue: string | string[] | undefined } => {\n\t\t\tconst setting = configProvider\n\t\t\t\t.getConfiguration(key.substr(0, key.lastIndexOf('.')))\n\t\t\t\t.inspect<string | string[]>(key.substr(key.lastIndexOf('.') + 1));\n\t\t\treturn this._apiInspectConfigToPlain<string | string[]>(setting);\n\t\t};\n\n\t\treturn terminalEnvironment.getDefaultShellArgs(fetchSetting, this._isWorkspaceShellAllowed, useAutomationShell, terminalEnvironment.createVariableResolver(this._lastActiveWorkspace, this._variableResolver), this._logService);\n\t}\n\n\tprivate _apiInspectConfigToPlain<T>(\n\t\tconfig: { key: string; defaultValue?: T; globalValue?: T; workspaceValue?: T, workspaceFolderValue?: T } | undefined\n\t): { userValue: T | undefined, value: T | undefined, defaultValue: T | undefined } {\n\t\treturn {\n\t\t\tuserValue: config ? config.globalValue : undefined,\n\t\t\tvalue: config ? config.workspaceValue : undefined,\n\t\t\tdefaultValue: config ? config.defaultValue : undefined,\n\t\t};\n\t}\n\n\tprivate async _getNonInheritedEnv(): Promise<platform.IProcessEnvironment> {\n\t\tconst env = await getMainProcessParentEnv();\n\t\tenv.VSCODE_IPC_HOOK_CLI = process.env['VSCODE_IPC_HOOK_CLI']!;\n\t\treturn env;\n\t}\n\n\tprivate _registerListeners(): void {\n\t\tthis._extHostDocumentsAndEditors.onDidChangeActiveTextEditor(() => this._updateLastActiveWorkspace());\n\t\tthis._extHostWorkspace.onDidChangeWorkspace(() => this._updateVariableResolver());\n\t}\n\n\tprivate _updateLastActiveWorkspace(): void {\n\t\tconst activeEditor = this._extHostDocumentsAndEditors.activeEditor();\n\t\tif (activeEditor) {\n\t\t\tthis._lastActiveWorkspace = this._extHostWorkspace.getWorkspaceFolder(activeEditor.document.uri) as IWorkspaceFolder;\n\t\t}\n\t}\n\n\tprivate async _updateVariableResolver(): Promise<void> {\n\t\tconst configProvider = await this._extHostConfiguration.getConfigProvider();\n\t\tconst workspaceFolders = await this._extHostWorkspace.getWorkspaceFolders2();\n\t\tthis._variableResolver = new ExtHostVariableResolverService(workspaceFolders || [], this._extHostDocumentsAndEditors, configProvider, process.env as platform.IProcessEnvironment);\n\t}\n\n\tpublic async $spawnExtHostProcess(id: number, shellLaunchConfigDto: IShellLaunchConfigDto, activeWorkspaceRootUriComponents: UriComponents | undefined, cols: number, rows: number, isWorkspaceShellAllowed: boolean): Promise<ITerminalLaunchError | undefined> {\n\t\tconst shellLaunchConfig: IShellLaunchConfig = {\n\t\t\tname: shellLaunchConfigDto.name,\n\t\t\texecutable: shellLaunchConfigDto.executable,\n\t\t\targs: shellLaunchConfigDto.args,\n\t\t\tcwd: typeof shellLaunchConfigDto.cwd === 'string' ? shellLaunchConfigDto.cwd : URI.revive(shellLaunchConfigDto.cwd),\n\t\t\tenv: shellLaunchConfigDto.env,\n\t\t\tflowControl: shellLaunchConfigDto.flowControl\n\t\t};\n\n\t\t// Merge in shell and args from settings\n\t\tconst platformKey = platform.isWindows ? 'windows' : (platform.isMacintosh ? 'osx' : 'linux');\n\t\tconst configProvider = await this._extHostConfiguration.getConfigProvider();\n\t\tif (!shellLaunchConfig.executable) {\n\t\t\tshellLaunchConfig.executable = this.getDefaultShell(false, configProvider);\n\t\t\tshellLaunchConfig.args = this.getDefaultShellArgs(false, configProvider);\n\t\t} else {\n\t\t\tif (this._variableResolver) {\n\t\t\t\tshellLaunchConfig.executable = this._variableResolver.resolve(this._lastActiveWorkspace, shellLaunchConfig.executable);\n\t\t\t\tif (shellLaunchConfig.args) {\n\t\t\t\t\tif (Array.isArray(shellLaunchConfig.args)) {\n\t\t\t\t\t\tconst resolvedArgs: string[] = [];\n\t\t\t\t\t\tfor (const arg of shellLaunchConfig.args) {\n\t\t\t\t\t\t\tresolvedArgs.push(this._variableResolver.resolve(this._lastActiveWorkspace, arg));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tshellLaunchConfig.args = resolvedArgs;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tshellLaunchConfig.args = this._variableResolver.resolve(this._lastActiveWorkspace, shellLaunchConfig.args);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst activeWorkspaceRootUri = URI.revive(activeWorkspaceRootUriComponents);\n\t\tlet lastActiveWorkspace: IWorkspaceFolder | undefined;\n\t\tif (activeWorkspaceRootUriComponents && activeWorkspaceRootUri) {\n\t\t\t// Get the environment\n\t\t\tconst apiLastActiveWorkspace = await this._extHostWorkspace.getWorkspaceFolder(activeWorkspaceRootUri);\n\t\t\tif (apiLastActiveWorkspace) {\n\t\t\t\tlastActiveWorkspace = {\n\t\t\t\t\turi: apiLastActiveWorkspace.uri,\n\t\t\t\t\tname: apiLastActiveWorkspace.name,\n\t\t\t\t\tindex: apiLastActiveWorkspace.index,\n\t\t\t\t\ttoResource: () => {\n\t\t\t\t\t\tthrow new Error('Not implemented');\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\t// Get the initial cwd\n\t\tconst terminalConfig = configProvider.getConfiguration('terminal.integrated');\n\n\t\tconst initialCwd = terminalEnvironment.getCwd(shellLaunchConfig, os.homedir(), terminalEnvironment.createVariableResolver(lastActiveWorkspace, this._variableResolver), activeWorkspaceRootUri, terminalConfig.cwd, this._logService);\n\t\tshellLaunchConfig.cwd = initialCwd;\n\n\t\tconst envFromConfig = this._apiInspectConfigToPlain(configProvider.getConfiguration('terminal.integrated').inspect<ITerminalEnvironment>(`env.${platformKey}`));\n\t\tconst baseEnv = terminalConfig.get<boolean>('inheritEnv', true) ? process.env as platform.IProcessEnvironment : await this._getNonInheritedEnv();\n\t\tconst env = terminalEnvironment.createTerminalEnvironment(\n\t\t\tshellLaunchConfig,\n\t\t\tenvFromConfig,\n\t\t\tterminalEnvironment.createVariableResolver(lastActiveWorkspace, this._variableResolver),\n\t\t\tisWorkspaceShellAllowed,\n\t\t\tthis._extHostInitDataService.version,\n\t\t\tterminalConfig.get<'auto' | 'off' | 'on'>('detectLocale', 'auto'),\n\t\t\tbaseEnv\n\t\t);\n\n\t\t// Apply extension environment variable collections to the environment\n\t\tif (!shellLaunchConfig.strictEnv) {\n\t\t\tconst mergedCollection = new MergedEnvironmentVariableCollection(this._environmentVariableCollections);\n\t\t\tmergedCollection.applyToProcessEnvironment(env);\n\t\t}\n\n\t\tthis._proxy.$sendResolvedLaunchConfig(id, shellLaunchConfig);\n\t\t// Fork the process and listen for messages\n\t\tthis._logService.debug(`Terminal process launching on ext host`, { shellLaunchConfig, initialCwd, cols, rows, env });\n\t\t// TODO: Support conpty on remote, it doesn't seem to work for some reason?\n\t\t// TODO: When conpty is enabled, only enable it when accessibilityMode is off\n\t\tconst enableConpty = false; //terminalConfig.get('windowsEnableConpty') as boolean;\n\n\t\tconst terminalProcess = new TerminalProcess(shellLaunchConfig, initialCwd, cols, rows, env, process.env as platform.IProcessEnvironment, enableConpty, this._logService);\n\t\tthis._setupExtHostProcessListeners(id, terminalProcess);\n\t\tconst error = await terminalProcess.start();\n\t\tif (error) {\n\t\t\t// TODO: Teardown?\n\t\t\treturn error;\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tpublic $getAvailableShells(): Promise<IShellDefinitionDto[]> {\n\t\treturn detectAvailableShells();\n\t}\n\n\tpublic async $getDefaultShellAndArgs(useAutomationShell: boolean): Promise<IShellAndArgsDto> {\n\t\tconst configProvider = await this._extHostConfiguration.getConfigProvider();\n\t\treturn {\n\t\t\tshell: this.getDefaultShell(useAutomationShell, configProvider),\n\t\t\targs: this.getDefaultShellArgs(useAutomationShell, configProvider)\n\t\t};\n\t}\n\n\tpublic $acceptWorkspacePermissionsChanged(isAllowed: boolean): void {\n\t\tthis._isWorkspaceShellAllowed = isAllowed;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { timeout } from 'vs/base/common/async';\nimport * as errors from 'vs/base/common/errors';\nimport * as performance from 'vs/base/common/performance';\nimport { DisposableStore } from 'vs/base/common/lifecycle';\nimport { URI } from 'vs/base/common/uri';\nimport { IURITransformer } from 'vs/base/common/uriIpc';\nimport { IMessagePassingProtocol } from 'vs/base/parts/ipc/common/ipc';\nimport { IInitData, MainContext, MainThreadConsoleShape } from 'vs/workbench/api/common/extHost.protocol';\nimport { RPCProtocol } from 'vs/workbench/services/extensions/common/rpcProtocol';\nimport { IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { getSingletonServiceDescriptors } from 'vs/platform/instantiation/common/extensions';\nimport { ServiceCollection } from 'vs/platform/instantiation/common/serviceCollection';\nimport { IExtHostInitDataService } from 'vs/workbench/api/common/extHostInitDataService';\nimport { InstantiationService } from 'vs/platform/instantiation/common/instantiationService';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { IExtHostRpcService, ExtHostRpcService } from 'vs/workbench/api/common/extHostRpcService';\nimport { IURITransformerService, URITransformerService } from 'vs/workbench/api/common/extHostUriTransformerService';\nimport { IExtHostExtensionService, IHostUtils } from 'vs/workbench/api/common/extHostExtensionService';\nimport { IExtHostTerminalService } from 'vs/workbench/api/common/extHostTerminalService';\n\nexport interface IExitFn {\n\t(code?: number): any;\n}\n\nexport interface IConsolePatchFn {\n\t(mainThreadConsole: MainThreadConsoleShape): any;\n}\n\nexport class ExtensionHostMain {\n\n\tprivate _isTerminating: boolean;\n\tprivate readonly _hostUtils: IHostUtils;\n\tprivate readonly _extensionService: IExtHostExtensionService;\n\tprivate readonly _logService: ILogService;\n\tprivate readonly _disposables = new DisposableStore();\n\n\tconstructor(\n\t\tprotocol: IMessagePassingProtocol,\n\t\tinitData: IInitData,\n\t\thostUtils: IHostUtils,\n\t\turiTransformer: IURITransformer | null\n\t) {\n\t\tthis._isTerminating = false;\n\t\tthis._hostUtils = hostUtils;\n\t\tconst rpcProtocol = new RPCProtocol(protocol, null, uriTransformer);\n\n\t\t// ensure URIs are transformed and revived\n\t\tinitData = ExtensionHostMain._transform(initData, rpcProtocol);\n\n\t\t// bootstrap services\n\t\tconst services = new ServiceCollection(...getSingletonServiceDescriptors());\n\t\tservices.set(IExtHostInitDataService, { _serviceBrand: undefined, ...initData });\n\t\tservices.set(IExtHostRpcService, new ExtHostRpcService(rpcProtocol));\n\t\tservices.set(IURITransformerService, new URITransformerService(uriTransformer));\n\t\tservices.set(IHostUtils, hostUtils);\n\n\t\tconst instaService: IInstantiationService = new InstantiationService(services, true);\n\n\t\t// ugly self - inject\n\t\tconst terminalService = instaService.invokeFunction(accessor => accessor.get(IExtHostTerminalService));\n\t\tthis._disposables.add(terminalService);\n\n\t\tthis._logService = instaService.invokeFunction(accessor => accessor.get(ILogService));\n\n\t\tperformance.mark(`code/extHost/didCreateServices`);\n\t\tthis._logService.info('extension host started');\n\t\tthis._logService.trace('initData', initData);\n\n\t\t// ugly self - inject\n\t\t// must call initialize *after* creating the extension service\n\t\t// because `initialize` itself creates instances that depend on it\n\t\tthis._extensionService = instaService.invokeFunction(accessor => accessor.get(IExtHostExtensionService));\n\t\tthis._extensionService.initialize();\n\n\t\t// error forwarding and stack trace scanning\n\t\tError.stackTraceLimit = 100; // increase number of stack frames (from 10, https://github.com/v8/v8/wiki/Stack-Trace-API)\n\t\tconst extensionErrors = new WeakMap<Error, IExtensionDescription | undefined>();\n\t\tthis._extensionService.getExtensionPathIndex().then(map => {\n\t\t\t(<any>Error).prepareStackTrace = (error: Error, stackTrace: errors.V8CallSite[]) => {\n\t\t\t\tlet stackTraceMessage = '';\n\t\t\t\tlet extension: IExtensionDescription | undefined;\n\t\t\t\tlet fileName: string;\n\t\t\t\tfor (const call of stackTrace) {\n\t\t\t\t\tstackTraceMessage += `\\n\\tat ${call.toString()}`;\n\t\t\t\t\tfileName = call.getFileName();\n\t\t\t\t\tif (!extension && fileName) {\n\t\t\t\t\t\textension = map.findSubstr(fileName);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t\textensionErrors.set(error, extension);\n\t\t\t\treturn `${error.name || 'Error'}: ${error.message || ''}${stackTraceMessage}`;\n\t\t\t};\n\t\t});\n\n\t\tconst mainThreadExtensions = rpcProtocol.getProxy(MainContext.MainThreadExtensionService);\n\t\tconst mainThreadErrors = rpcProtocol.getProxy(MainContext.MainThreadErrors);\n\t\terrors.setUnexpectedErrorHandler(err => {\n\t\t\tconst data = errors.transformErrorForSerialization(err);\n\t\t\tconst extension = extensionErrors.get(err);\n\t\t\tif (extension) {\n\t\t\t\tmainThreadExtensions.$onExtensionRuntimeError(extension.identifier, data);\n\t\t\t} else {\n\t\t\t\tmainThreadErrors.$onUnexpectedError(data);\n\t\t\t}\n\t\t});\n\t}\n\n\tterminate(reason: string): void {\n\t\tif (this._isTerminating) {\n\t\t\t// we are already shutting down...\n\t\t\treturn;\n\t\t}\n\t\tthis._isTerminating = true;\n\t\tthis._logService.info(`extension host terminating: ${reason}`);\n\t\tthis._logService.flush();\n\n\t\tthis._disposables.dispose();\n\n\t\terrors.setUnexpectedErrorHandler((err) => {\n\t\t\t// TODO: write to log once we have one\n\t\t});\n\n\t\tconst extensionsDeactivated = this._extensionService.deactivateAll();\n\n\t\t// Give extensions 1 second to wrap up any async dispose, then exit in at most 4 seconds\n\t\tsetTimeout(() => {\n\t\t\tPromise.race([timeout(4000), extensionsDeactivated]).finally(() => {\n\t\t\t\tthis._logService.info(`exiting with code 0`);\n\t\t\t\tthis._logService.flush();\n\t\t\t\tthis._logService.dispose();\n\t\t\t\tthis._hostUtils.exit(0);\n\t\t\t});\n\t\t}, 1000);\n\t}\n\n\tprivate static _transform(initData: IInitData, rpcProtocol: RPCProtocol): IInitData {\n\t\tinitData.extensions.forEach((ext) => (<any>ext).extensionLocation = URI.revive(rpcProtocol.transformIncomingURIs(ext.extensionLocation)));\n\t\tinitData.environment.appRoot = URI.revive(rpcProtocol.transformIncomingURIs(initData.environment.appRoot));\n\t\tconst extDevLocs = initData.environment.extensionDevelopmentLocationURI;\n\t\tif (extDevLocs) {\n\t\t\tinitData.environment.extensionDevelopmentLocationURI = extDevLocs.map(url => URI.revive(rpcProtocol.transformIncomingURIs(url)));\n\t\t}\n\t\tinitData.environment.extensionTestsLocationURI = URI.revive(rpcProtocol.transformIncomingURIs(initData.environment.extensionTestsLocationURI));\n\t\tinitData.environment.globalStorageHome = URI.revive(rpcProtocol.transformIncomingURIs(initData.environment.globalStorageHome));\n\t\tinitData.environment.workspaceStorageHome = URI.revive(rpcProtocol.transformIncomingURIs(initData.environment.workspaceStorageHome));\n\t\tinitData.logsLocation = URI.revive(rpcProtocol.transformIncomingURIs(initData.logsLocation));\n\t\tinitData.logFile = URI.revive(rpcProtocol.transformIncomingURIs(initData.logFile));\n\t\tinitData.workspace = rpcProtocol.transformIncomingURIs(initData.workspace);\n\t\treturn initData;\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as path from 'vs/base/common/path';\nimport { CancellationToken, CancellationTokenSource } from 'vs/base/common/cancellation';\nimport { toErrorMessage } from 'vs/base/common/errorMessage';\nimport * as glob from 'vs/base/common/glob';\nimport * as resources from 'vs/base/common/resources';\nimport { StopWatch } from 'vs/base/common/stopwatch';\nimport { URI } from 'vs/base/common/uri';\nimport { IFileMatch, IFileSearchProviderStats, IFolderQuery, ISearchCompleteStats, IFileQuery, QueryGlobTester, resolvePatternsForProvider } from 'vs/workbench/services/search/common/search';\nimport { FileSearchProvider, FileSearchOptions } from 'vs/workbench/services/search/common/searchExtTypes';\nimport { nextTick } from 'vs/base/common/process';\n\nexport interface IInternalFileMatch {\n\tbase: URI;\n\toriginal?: URI;\n\trelativePath?: string; // Not present for extraFiles or absolute path matches\n\tbasename: string;\n\tsize?: number;\n}\n\nexport interface IDirectoryEntry {\n\tbase: URI;\n\trelativePath: string;\n\tbasename: string;\n}\n\nexport interface IDirectoryTree {\n\trootEntries: IDirectoryEntry[];\n\tpathToEntries: { [relativePath: string]: IDirectoryEntry[] };\n}\n\nclass FileSearchEngine {\n\tprivate filePattern?: string;\n\tprivate includePattern?: glob.ParsedExpression;\n\tprivate maxResults?: number;\n\tprivate exists?: boolean;\n\tprivate isLimitHit = false;\n\tprivate resultCount = 0;\n\tprivate isCanceled = false;\n\n\tprivate activeCancellationTokens: Set<CancellationTokenSource>;\n\n\tprivate globalExcludePattern?: glob.ParsedExpression;\n\n\tconstructor(private config: IFileQuery, private provider: FileSearchProvider, private sessionToken?: CancellationToken) {\n\t\tthis.filePattern = config.filePattern;\n\t\tthis.includePattern = config.includePattern && glob.parse(config.includePattern);\n\t\tthis.maxResults = config.maxResults || undefined;\n\t\tthis.exists = config.exists;\n\t\tthis.activeCancellationTokens = new Set<CancellationTokenSource>();\n\n\t\tthis.globalExcludePattern = config.excludePattern && glob.parse(config.excludePattern);\n\t}\n\n\tcancel(): void {\n\t\tthis.isCanceled = true;\n\t\tthis.activeCancellationTokens.forEach(t => t.cancel());\n\t\tthis.activeCancellationTokens = new Set();\n\t}\n\n\tsearch(_onResult: (match: IInternalFileMatch) => void): Promise<IInternalSearchComplete> {\n\t\tconst folderQueries = this.config.folderQueries || [];\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst onResult = (match: IInternalFileMatch) => {\n\t\t\t\tthis.resultCount++;\n\t\t\t\t_onResult(match);\n\t\t\t};\n\n\t\t\t// Support that the file pattern is a full path to a file that exists\n\t\t\tif (this.isCanceled) {\n\t\t\t\treturn resolve({ limitHit: this.isLimitHit });\n\t\t\t}\n\n\t\t\t// For each extra file\n\t\t\tif (this.config.extraFileResources) {\n\t\t\t\tthis.config.extraFileResources\n\t\t\t\t\t.forEach(extraFile => {\n\t\t\t\t\t\tconst extraFileStr = extraFile.toString(); // ?\n\t\t\t\t\t\tconst basename = path.basename(extraFileStr);\n\t\t\t\t\t\tif (this.globalExcludePattern && this.globalExcludePattern(extraFileStr, basename)) {\n\t\t\t\t\t\t\treturn; // excluded\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// File: Check for match on file pattern and include pattern\n\t\t\t\t\t\tthis.matchFile(onResult, { base: extraFile, basename });\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t\t// For each root folder\n\t\t\tPromise.all(folderQueries.map(fq => {\n\t\t\t\treturn this.searchInFolder(fq, onResult);\n\t\t\t})).then(stats => {\n\t\t\t\tresolve({\n\t\t\t\t\tlimitHit: this.isLimitHit,\n\t\t\t\t\tstats: stats[0] || undefined // Only looking at single-folder workspace stats...\n\t\t\t\t});\n\t\t\t}, (err: Error) => {\n\t\t\t\treject(new Error(toErrorMessage(err)));\n\t\t\t});\n\t\t});\n\t}\n\n\tprivate searchInFolder(fq: IFolderQuery<URI>, onResult: (match: IInternalFileMatch) => void): Promise<IFileSearchProviderStats | null> {\n\t\tconst cancellation = new CancellationTokenSource();\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst options = this.getSearchOptionsForFolder(fq);\n\t\t\tconst tree = this.initDirectoryTree();\n\n\t\t\tconst queryTester = new QueryGlobTester(this.config, fq);\n\t\t\tconst noSiblingsClauses = !queryTester.hasSiblingExcludeClauses();\n\n\t\t\tlet providerSW: StopWatch;\n\t\t\tnew Promise(_resolve => nextTick(_resolve))\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.activeCancellationTokens.add(cancellation);\n\n\t\t\t\t\tproviderSW = StopWatch.create();\n\t\t\t\t\treturn this.provider.provideFileSearchResults(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpattern: this.config.filePattern || ''\n\t\t\t\t\t\t},\n\t\t\t\t\t\toptions,\n\t\t\t\t\t\tcancellation.token);\n\t\t\t\t})\n\t\t\t\t.then(results => {\n\t\t\t\t\tconst providerTime = providerSW.elapsed();\n\t\t\t\t\tconst postProcessSW = StopWatch.create();\n\n\t\t\t\t\tif (this.isCanceled && !this.isLimitHit) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (results) {\n\t\t\t\t\t\tresults.forEach(result => {\n\t\t\t\t\t\t\tconst relativePath = path.posix.relative(fq.folder.path, result.path);\n\n\t\t\t\t\t\t\tif (noSiblingsClauses) {\n\t\t\t\t\t\t\t\tconst basename = path.basename(result.path);\n\t\t\t\t\t\t\t\tthis.matchFile(onResult, { base: fq.folder, relativePath, basename });\n\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// TODO: Optimize siblings clauses with ripgrep here.\n\t\t\t\t\t\t\tthis.addDirectoryEntries(tree, fq.folder, relativePath, onResult);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.activeCancellationTokens.delete(cancellation);\n\t\t\t\t\tif (this.isCanceled && !this.isLimitHit) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.matchDirectoryTree(tree, queryTester, onResult);\n\t\t\t\t\treturn <IFileSearchProviderStats>{\n\t\t\t\t\t\tproviderTime,\n\t\t\t\t\t\tpostProcessTime: postProcessSW.elapsed()\n\t\t\t\t\t};\n\t\t\t\t}).then(\n\t\t\t\t\tstats => {\n\t\t\t\t\t\tcancellation.dispose();\n\t\t\t\t\t\tresolve(stats);\n\t\t\t\t\t},\n\t\t\t\t\terr => {\n\t\t\t\t\t\tcancellation.dispose();\n\t\t\t\t\t\treject(err);\n\t\t\t\t\t});\n\t\t});\n\t}\n\n\tprivate getSearchOptionsForFolder(fq: IFolderQuery<URI>): FileSearchOptions {\n\t\tconst includes = resolvePatternsForProvider(this.config.includePattern, fq.includePattern);\n\t\tconst excludes = resolvePatternsForProvider(this.config.excludePattern, fq.excludePattern);\n\n\t\treturn {\n\t\t\tfolder: fq.folder,\n\t\t\texcludes,\n\t\t\tincludes,\n\t\t\tuseIgnoreFiles: !fq.disregardIgnoreFiles,\n\t\t\tuseGlobalIgnoreFiles: !fq.disregardGlobalIgnoreFiles,\n\t\t\tfollowSymlinks: !fq.ignoreSymlinks,\n\t\t\tmaxResults: this.config.maxResults,\n\t\t\tsession: this.sessionToken\n\t\t};\n\t}\n\n\tprivate initDirectoryTree(): IDirectoryTree {\n\t\tconst tree: IDirectoryTree = {\n\t\t\trootEntries: [],\n\t\t\tpathToEntries: Object.create(null)\n\t\t};\n\t\ttree.pathToEntries['.'] = tree.rootEntries;\n\t\treturn tree;\n\t}\n\n\tprivate addDirectoryEntries({ pathToEntries }: IDirectoryTree, base: URI, relativeFile: string, onResult: (result: IInternalFileMatch) => void) {\n\t\t// Support relative paths to files from a root resource (ignores excludes)\n\t\tif (relativeFile === this.filePattern) {\n\t\t\tconst basename = path.basename(this.filePattern);\n\t\t\tthis.matchFile(onResult, { base: base, relativePath: this.filePattern, basename });\n\t\t}\n\n\t\tfunction add(relativePath: string) {\n\t\t\tconst basename = path.basename(relativePath);\n\t\t\tconst dirname = path.dirname(relativePath);\n\t\t\tlet entries = pathToEntries[dirname];\n\t\t\tif (!entries) {\n\t\t\t\tentries = pathToEntries[dirname] = [];\n\t\t\t\tadd(dirname);\n\t\t\t}\n\t\t\tentries.push({\n\t\t\t\tbase,\n\t\t\t\trelativePath,\n\t\t\t\tbasename\n\t\t\t});\n\t\t}\n\n\t\tadd(relativeFile);\n\t}\n\n\tprivate matchDirectoryTree({ rootEntries, pathToEntries }: IDirectoryTree, queryTester: QueryGlobTester, onResult: (result: IInternalFileMatch) => void) {\n\t\tconst self = this;\n\t\tconst filePattern = this.filePattern;\n\t\tfunction matchDirectory(entries: IDirectoryEntry[]) {\n\t\t\tconst hasSibling = glob.hasSiblingFn(() => entries.map(entry => entry.basename));\n\t\t\tfor (let i = 0, n = entries.length; i < n; i++) {\n\t\t\t\tconst entry = entries[i];\n\t\t\t\tconst { relativePath, basename } = entry;\n\n\t\t\t\t// Check exclude pattern\n\t\t\t\t// If the user searches for the exact file name, we adjust the glob matching\n\t\t\t\t// to ignore filtering by siblings because the user seems to know what she\n\t\t\t\t// is searching for and we want to include the result in that case anyway\n\t\t\t\tif (!queryTester.includedInQuerySync(relativePath, basename, filePattern !== basename ? hasSibling : undefined)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst sub = pathToEntries[relativePath];\n\t\t\t\tif (sub) {\n\t\t\t\t\tmatchDirectory(sub);\n\t\t\t\t} else {\n\t\t\t\t\tif (relativePath === filePattern) {\n\t\t\t\t\t\tcontinue; // ignore file if its path matches with the file pattern because that is already matched above\n\t\t\t\t\t}\n\n\t\t\t\t\tself.matchFile(onResult, entry);\n\t\t\t\t}\n\n\t\t\t\tif (self.isLimitHit) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tmatchDirectory(rootEntries);\n\t}\n\n\tprivate matchFile(onResult: (result: IInternalFileMatch) => void, candidate: IInternalFileMatch): void {\n\t\tif (!this.includePattern || (candidate.relativePath && this.includePattern(candidate.relativePath, candidate.basename))) {\n\t\t\tif (this.exists || (this.maxResults && this.resultCount >= this.maxResults)) {\n\t\t\t\tthis.isLimitHit = true;\n\t\t\t\tthis.cancel();\n\t\t\t}\n\n\t\t\tif (!this.isLimitHit) {\n\t\t\t\tonResult(candidate);\n\t\t\t}\n\t\t}\n\t}\n}\n\ninterface IInternalSearchComplete {\n\tlimitHit: boolean;\n\tstats?: IFileSearchProviderStats;\n}\n\nexport class FileSearchManager {\n\n\tprivate static readonly BATCH_SIZE = 512;\n\n\tprivate readonly sessions = new Map<string, CancellationTokenSource>();\n\n\tfileSearch(config: IFileQuery, provider: FileSearchProvider, onBatch: (matches: IFileMatch[]) => void, token: CancellationToken): Promise<ISearchCompleteStats> {\n\t\tconst sessionTokenSource = this.getSessionTokenSource(config.cacheKey);\n\t\tconst engine = new FileSearchEngine(config, provider, sessionTokenSource && sessionTokenSource.token);\n\n\t\tlet resultCount = 0;\n\t\tconst onInternalResult = (batch: IInternalFileMatch[]) => {\n\t\t\tresultCount += batch.length;\n\t\t\tonBatch(batch.map(m => this.rawMatchToSearchItem(m)));\n\t\t};\n\n\t\treturn this.doSearch(engine, FileSearchManager.BATCH_SIZE, onInternalResult, token).then(\n\t\t\tresult => {\n\t\t\t\treturn <ISearchCompleteStats>{\n\t\t\t\t\tlimitHit: result.limitHit,\n\t\t\t\t\tstats: {\n\t\t\t\t\t\tfromCache: false,\n\t\t\t\t\t\ttype: 'fileSearchProvider',\n\t\t\t\t\t\tresultCount,\n\t\t\t\t\t\tdetailStats: result.stats\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t});\n\t}\n\n\tclearCache(cacheKey: string): void {\n\t\tconst sessionTokenSource = this.getSessionTokenSource(cacheKey);\n\t\tif (sessionTokenSource) {\n\t\t\tsessionTokenSource.cancel();\n\t\t}\n\t}\n\n\tprivate getSessionTokenSource(cacheKey: string | undefined): CancellationTokenSource | undefined {\n\t\tif (!cacheKey) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (!this.sessions.has(cacheKey)) {\n\t\t\tthis.sessions.set(cacheKey, new CancellationTokenSource());\n\t\t}\n\n\t\treturn this.sessions.get(cacheKey);\n\t}\n\n\tprivate rawMatchToSearchItem(match: IInternalFileMatch): IFileMatch {\n\t\tif (match.relativePath) {\n\t\t\treturn {\n\t\t\t\tresource: resources.joinPath(match.base, match.relativePath)\n\t\t\t};\n\t\t} else {\n\t\t\t// extraFileResources\n\t\t\treturn {\n\t\t\t\tresource: match.base\n\t\t\t};\n\t\t}\n\t}\n\n\tprivate doSearch(engine: FileSearchEngine, batchSize: number, onResultBatch: (matches: IInternalFileMatch[]) => void, token: CancellationToken): Promise<IInternalSearchComplete> {\n\t\ttoken.onCancellationRequested(() => {\n\t\t\tengine.cancel();\n\t\t});\n\n\t\tconst _onResult = (match: IInternalFileMatch) => {\n\t\t\tif (match) {\n\t\t\t\tbatch.push(match);\n\t\t\t\tif (batchSize > 0 && batch.length >= batchSize) {\n\t\t\t\t\tonResultBatch(batch);\n\t\t\t\t\tbatch = [];\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tlet batch: IInternalFileMatch[] = [];\n\t\treturn engine.search(_onResult).then(result => {\n\t\t\tif (batch.length) {\n\t\t\t\tonResultBatch(batch);\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}, error => {\n\t\t\tif (batch.length) {\n\t\t\t\tonResultBatch(batch);\n\t\t\t}\n\n\t\t\treturn Promise.reject(error);\n\t\t});\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { URI } from 'vs/base/common/uri';\nimport { IProgress } from 'vs/platform/progress/common/progress';\n\nexport class Position {\n\tconstructor(readonly line: number, readonly character: number) { }\n\n\tisBefore(other: Position): boolean { return false; }\n\tisBeforeOrEqual(other: Position): boolean { return false; }\n\tisAfter(other: Position): boolean { return false; }\n\tisAfterOrEqual(other: Position): boolean { return false; }\n\tisEqual(other: Position): boolean { return false; }\n\tcompareTo(other: Position): number { return 0; }\n\ttranslate(lineDelta?: number, characterDelta?: number): Position;\n\ttranslate(change: { lineDelta?: number; characterDelta?: number; }): Position;\n\ttranslate(_?: any, _2?: any): Position { return new Position(0, 0); }\n\twith(line?: number, character?: number): Position;\n\twith(change: { line?: number; character?: number; }): Position;\n\twith(_: any): Position { return new Position(0, 0); }\n}\n\nexport class Range {\n\treadonly start: Position;\n\treadonly end: Position;\n\n\tconstructor(startLine: number, startCol: number, endLine: number, endCol: number) {\n\t\tthis.start = new Position(startLine, startCol);\n\t\tthis.end = new Position(endLine, endCol);\n\t}\n\n\tisEmpty = false;\n\tisSingleLine = false;\n\tcontains(positionOrRange: Position | Range): boolean { return false; }\n\tisEqual(other: Range): boolean { return false; }\n\tintersection(range: Range): Range | undefined { return undefined; }\n\tunion(other: Range): Range { return new Range(0, 0, 0, 0); }\n\n\twith(start?: Position, end?: Position): Range;\n\twith(change: { start?: Position, end?: Position }): Range;\n\twith(_: any): Range { return new Range(0, 0, 0, 0); }\n}\n\nexport type ProviderResult<T> = T | undefined | null | Thenable<T | undefined | null>;\n\n/**\n * A relative pattern is a helper to construct glob patterns that are matched\n * relatively to a base path. The base path can either be an absolute file path\n * or a [workspace folder](#WorkspaceFolder).\n */\nexport interface RelativePattern {\n\n\t/**\n\t * A base file path to which this pattern will be matched against relatively.\n\t */\n\tbase: string;\n\n\t/**\n\t * A file glob pattern like `*.{ts,js}` that will be matched on file paths\n\t * relative to the base path.\n\t *\n\t * Example: Given a base of `/home/work/folder` and a file path of `/home/work/folder/index.js`,\n\t * the file glob pattern will match on `index.js`.\n\t */\n\tpattern: string;\n}\n\n/**\n * A file glob pattern to match file paths against. This can either be a glob pattern string\n * (like `**​/*.{ts,js}` or `*.{ts,js}`) or a [relative pattern](#RelativePattern).\n *\n * Glob patterns can have the following syntax:\n * * `*` to match one or more characters in a path segment\n * * `?` to match on one character in a path segment\n * * `**` to match any number of path segments, including none\n * * `{}` to group conditions (e.g. `**​/*.{ts,js}` matches all TypeScript and JavaScript files)\n * * `[]` to declare a range of characters to match in a path segment (e.g., `example.[0-9]` to match on `example.0`, `example.1`, …)\n * * `[!...]` to negate a range of characters to match in a path segment (e.g., `example.[!0-9]` to match on `example.a`, `example.b`, but not `example.0`)\n *\n * Note: a backslash (`\\`) is not valid within a glob pattern. If you have an existing file\n * path to match against, consider to use the [relative pattern](#RelativePattern) support\n * that takes care of converting any backslash into slash. Otherwise, make sure to convert\n * any backslash to slash when creating the glob pattern.\n */\nexport type GlobPattern = string | RelativePattern;\n\n/**\n * The parameters of a query for text search.\n */\nexport interface TextSearchQuery {\n\t/**\n\t * The text pattern to search for.\n\t */\n\tpattern: string;\n\n\t/**\n\t * Whether or not `pattern` should match multiple lines of text.\n\t */\n\tisMultiline?: boolean;\n\n\t/**\n\t * Whether or not `pattern` should be interpreted as a regular expression.\n\t */\n\tisRegExp?: boolean;\n\n\t/**\n\t * Whether or not the search should be case-sensitive.\n\t */\n\tisCaseSensitive?: boolean;\n\n\t/**\n\t * Whether or not to search for whole word matches only.\n\t */\n\tisWordMatch?: boolean;\n}\n\n/**\n * A file glob pattern to match file paths against.\n * TODO@roblou - merge this with the GlobPattern docs/definition in vscode.d.ts.\n * @see [GlobPattern](#GlobPattern)\n */\nexport type GlobString = string;\n\n/**\n * Options common to file and text search\n */\nexport interface SearchOptions {\n\t/**\n\t * The root folder to search within.\n\t */\n\tfolder: URI;\n\n\t/**\n\t * Files that match an `includes` glob pattern should be included in the search.\n\t */\n\tincludes: GlobString[];\n\n\t/**\n\t * Files that match an `excludes` glob pattern should be excluded from the search.\n\t */\n\texcludes: GlobString[];\n\n\t/**\n\t * Whether external files that exclude files, like .gitignore, should be respected.\n\t * See the vscode setting `\"search.useIgnoreFiles\"`.\n\t */\n\tuseIgnoreFiles: boolean;\n\n\t/**\n\t * Whether symlinks should be followed while searching.\n\t * See the vscode setting `\"search.followSymlinks\"`.\n\t */\n\tfollowSymlinks: boolean;\n\n\t/**\n\t * Whether global files that exclude files, like .gitignore, should be respected.\n\t * See the vscode setting `\"search.useGlobalIgnoreFiles\"`.\n\t */\n\tuseGlobalIgnoreFiles: boolean;\n}\n\n/**\n * Options to specify the size of the result text preview.\n * These options don't affect the size of the match itself, just the amount of preview text.\n */\nexport interface TextSearchPreviewOptions {\n\t/**\n\t * The maximum number of lines in the preview.\n\t * Only search providers that support multiline search will ever return more than one line in the match.\n\t */\n\tmatchLines: number;\n\n\t/**\n\t * The maximum number of characters included per line.\n\t */\n\tcharsPerLine: number;\n}\n\n/**\n * Options that apply to text search.\n */\nexport interface TextSearchOptions extends SearchOptions {\n\t/**\n\t * The maximum number of results to be returned.\n\t */\n\tmaxResults: number;\n\n\t/**\n\t * Options to specify the size of the result text preview.\n\t */\n\tpreviewOptions?: TextSearchPreviewOptions;\n\n\t/**\n\t * Exclude files larger than `maxFileSize` in bytes.\n\t */\n\tmaxFileSize?: number;\n\n\t/**\n\t * Interpret files using this encoding.\n\t * See the vscode setting `\"files.encoding\"`\n\t */\n\tencoding?: string;\n\n\t/**\n\t * Number of lines of context to include before each match.\n\t */\n\tbeforeContext?: number;\n\n\t/**\n\t * Number of lines of context to include after each match.\n\t */\n\tafterContext?: number;\n}\n\n/**\n * Information collected when text search is complete.\n */\nexport interface TextSearchComplete {\n\t/**\n\t * Whether the search hit the limit on the maximum number of search results.\n\t * `maxResults` on [`TextSearchOptions`](#TextSearchOptions) specifies the max number of results.\n\t * - If exactly that number of matches exist, this should be false.\n\t * - If `maxResults` matches are returned and more exist, this should be true.\n\t * - If search hits an internal limit which is less than `maxResults`, this should be true.\n\t */\n\tlimitHit?: boolean;\n}\n\n/**\n * The parameters of a query for file search.\n */\nexport interface FileSearchQuery {\n\t/**\n\t * The search pattern to match against file paths.\n\t */\n\tpattern: string;\n}\n\n/**\n * Options that apply to file search.\n */\nexport interface FileSearchOptions extends SearchOptions {\n\t/**\n\t * The maximum number of results to be returned.\n\t */\n\tmaxResults?: number;\n\n\t/**\n\t * A CancellationToken that represents the session for this search query. If the provider chooses to, this object can be used as the key for a cache,\n\t * and searches with the same session object can search the same cache. When the token is cancelled, the session is complete and the cache can be cleared.\n\t */\n\tsession?: CancellationToken;\n}\n\n/**\n * A preview of the text result.\n */\nexport interface TextSearchMatchPreview {\n\t/**\n\t * The matching lines of text, or a portion of the matching line that contains the match.\n\t */\n\ttext: string;\n\n\t/**\n\t * The Range within `text` corresponding to the text of the match.\n\t * The number of matches must match the TextSearchMatch's range property.\n\t */\n\tmatches: Range | Range[];\n}\n\n/**\n * A match from a text search\n */\nexport interface TextSearchMatch {\n\t/**\n\t * The uri for the matching document.\n\t */\n\turi: URI;\n\n\t/**\n\t * The range of the match within the document, or multiple ranges for multiple matches.\n\t */\n\tranges: Range | Range[];\n\n\t/**\n\t * A preview of the text match.\n\t */\n\tpreview: TextSearchMatchPreview;\n}\n\n/**\n * A line of context surrounding a TextSearchMatch.\n */\nexport interface TextSearchContext {\n\t/**\n\t * The uri for the matching document.\n\t */\n\turi: URI;\n\n\t/**\n\t * One line of text.\n\t * previewOptions.charsPerLine applies to this\n\t */\n\ttext: string;\n\n\t/**\n\t * The line number of this line of context.\n\t */\n\tlineNumber: number;\n}\n\nexport type TextSearchResult = TextSearchMatch | TextSearchContext;\n\n/**\n * A FileSearchProvider provides search results for files in the given folder that match a query string. It can be invoked by quickaccess or other extensions.\n *\n * A FileSearchProvider is the more powerful of two ways to implement file search in VS Code. Use a FileSearchProvider if you wish to search within a folder for\n * all files that match the user's query.\n *\n * The FileSearchProvider will be invoked on every keypress in quickaccess. When `workspace.findFiles` is called, it will be invoked with an empty query string,\n * and in that case, every file in the folder should be returned.\n */\nexport interface FileSearchProvider {\n\t/**\n\t * Provide the set of files that match a certain file path pattern.\n\t * @param query The parameters for this query.\n\t * @param options A set of options to consider while searching files.\n\t * @param progress A progress callback that must be invoked for all results.\n\t * @param token A cancellation token.\n\t */\n\tprovideFileSearchResults(query: FileSearchQuery, options: FileSearchOptions, token: CancellationToken): ProviderResult<URI[]>;\n}\n\n/**\n * A TextSearchProvider provides search results for text results inside files in the workspace.\n */\nexport interface TextSearchProvider {\n\t/**\n\t * Provide results that match the given text pattern.\n\t * @param query The parameters for this query.\n\t * @param options A set of options to consider while searching.\n\t * @param progress A progress callback that must be invoked for all results.\n\t * @param token A cancellation token.\n\t */\n\tprovideTextSearchResults(query: TextSearchQuery, options: TextSearchOptions, progress: IProgress<TextSearchResult>, token: CancellationToken): ProviderResult<TextSearchComplete>;\n}\n\n/**\n * Options that can be set on a findTextInFiles search.\n */\nexport interface FindTextInFilesOptions {\n\t/**\n\t * A [glob pattern](#GlobPattern) that defines the files to search for. The glob pattern\n\t * will be matched against the file paths of files relative to their workspace. Use a [relative pattern](#RelativePattern)\n\t * to restrict the search results to a [workspace folder](#WorkspaceFolder).\n\t */\n\tinclude?: GlobPattern;\n\n\t/**\n\t * A [glob pattern](#GlobPattern) that defines files and folders to exclude. The glob pattern\n\t * will be matched against the file paths of resulting matches relative to their workspace. When `undefined` only default excludes will\n\t * apply, when `null` no excludes will apply.\n\t */\n\texclude?: GlobPattern | null;\n\n\t/**\n\t * The maximum number of results to search for\n\t */\n\tmaxResults?: number;\n\n\t/**\n\t * Whether external files that exclude files, like .gitignore, should be respected.\n\t * See the vscode setting `\"search.useIgnoreFiles\"`.\n\t */\n\tuseIgnoreFiles?: boolean;\n\n\t/**\n\t * Whether global files that exclude files, like .gitignore, should be respected.\n\t * See the vscode setting `\"search.useGlobalIgnoreFiles\"`.\n\t */\n\tuseGlobalIgnoreFiles?: boolean;\n\n\t/**\n\t * Whether symlinks should be followed while searching.\n\t * See the vscode setting `\"search.followSymlinks\"`.\n\t */\n\tfollowSymlinks?: boolean;\n\n\t/**\n\t * Interpret files using this encoding.\n\t * See the vscode setting `\"files.encoding\"`\n\t */\n\tencoding?: string;\n\n\t/**\n\t * Options to specify the size of the result text preview.\n\t */\n\tpreviewOptions?: TextSearchPreviewOptions;\n\n\t/**\n\t * Number of lines of context to include before each match.\n\t */\n\tbeforeContext?: number;\n\n\t/**\n\t * Number of lines of context to include after each match.\n\t */\n\tafterContext?: number;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as path from 'vs/base/common/path';\nimport { mapArrayOrNot } from 'vs/base/common/arrays';\nimport { CancellationToken, CancellationTokenSource } from 'vs/base/common/cancellation';\nimport { toErrorMessage } from 'vs/base/common/errorMessage';\nimport * as resources from 'vs/base/common/resources';\nimport * as glob from 'vs/base/common/glob';\nimport { URI } from 'vs/base/common/uri';\nimport { IExtendedExtensionSearchOptions, IFileMatch, IFolderQuery, IPatternInfo, ISearchCompleteStats, ITextQuery, ITextSearchContext, ITextSearchMatch, ITextSearchResult, QueryGlobTester, resolvePatternsForProvider } from 'vs/workbench/services/search/common/search';\nimport { TextSearchProvider, TextSearchResult, TextSearchMatch, TextSearchComplete, Range, TextSearchOptions, TextSearchQuery } from 'vs/workbench/services/search/common/searchExtTypes';\nimport { nextTick } from 'vs/base/common/process';\nimport { Schemas } from 'vs/base/common/network';\n\nexport interface IFileUtils {\n\treaddir: (resource: URI) => Promise<string[]>;\n\ttoCanonicalName: (encoding: string) => string;\n}\n\nexport class TextSearchManager {\n\n\tprivate collector: TextSearchResultsCollector | null = null;\n\n\tprivate isLimitHit = false;\n\tprivate resultCount = 0;\n\n\tconstructor(private query: ITextQuery, private provider: TextSearchProvider, private fileUtils: IFileUtils) { }\n\n\tsearch(onProgress: (matches: IFileMatch[]) => void, token: CancellationToken): Promise<ISearchCompleteStats> {\n\t\tconst folderQueries = this.query.folderQueries || [];\n\t\tconst tokenSource = new CancellationTokenSource();\n\t\ttoken.onCancellationRequested(() => tokenSource.cancel());\n\n\t\treturn new Promise<ISearchCompleteStats>((resolve, reject) => {\n\t\t\tthis.collector = new TextSearchResultsCollector(onProgress);\n\n\t\t\tlet isCanceled = false;\n\t\t\tconst onResult = (result: TextSearchResult, folderIdx: number) => {\n\t\t\t\tif (isCanceled) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!this.isLimitHit) {\n\t\t\t\t\tconst resultSize = this.resultSize(result);\n\t\t\t\t\tif (extensionResultIsMatch(result) && typeof this.query.maxResults === 'number' && this.resultCount + resultSize > this.query.maxResults) {\n\t\t\t\t\t\tthis.isLimitHit = true;\n\t\t\t\t\t\tisCanceled = true;\n\t\t\t\t\t\ttokenSource.cancel();\n\n\t\t\t\t\t\tresult = this.trimResultToSize(result, this.query.maxResults - this.resultCount);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst newResultSize = this.resultSize(result);\n\t\t\t\t\tthis.resultCount += newResultSize;\n\t\t\t\t\tif (newResultSize > 0 || !extensionResultIsMatch(result)) {\n\t\t\t\t\t\tthis.collector!.add(result, folderIdx);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t// For each root folder\n\t\t\tPromise.all(folderQueries.map((fq, i) => {\n\t\t\t\treturn this.searchInFolder(fq, r => onResult(r, i), tokenSource.token);\n\t\t\t})).then(results => {\n\t\t\t\ttokenSource.dispose();\n\t\t\t\tthis.collector!.flush();\n\n\t\t\t\tconst someFolderHitLImit = results.some(result => !!result && !!result.limitHit);\n\t\t\t\tresolve({\n\t\t\t\t\tlimitHit: this.isLimitHit || someFolderHitLImit,\n\t\t\t\t\tstats: {\n\t\t\t\t\t\ttype: 'textSearchProvider'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}, (err: Error) => {\n\t\t\t\ttokenSource.dispose();\n\t\t\t\tconst errMsg = toErrorMessage(err);\n\t\t\t\treject(new Error(errMsg));\n\t\t\t});\n\t\t});\n\t}\n\n\tprivate resultSize(result: TextSearchResult): number {\n\t\tif (extensionResultIsMatch(result)) {\n\t\t\treturn Array.isArray(result.ranges) ?\n\t\t\t\tresult.ranges.length :\n\t\t\t\t1;\n\t\t}\n\t\telse {\n\t\t\t// #104400 context lines shoudn't count towards result count\n\t\t\treturn 0;\n\t\t}\n\t}\n\n\tprivate trimResultToSize(result: TextSearchMatch, size: number): TextSearchMatch {\n\t\tconst rangesArr = Array.isArray(result.ranges) ? result.ranges : [result.ranges];\n\t\tconst matchesArr = Array.isArray(result.preview.matches) ? result.preview.matches : [result.preview.matches];\n\n\t\treturn {\n\t\t\tranges: rangesArr.slice(0, size),\n\t\t\tpreview: {\n\t\t\t\tmatches: matchesArr.slice(0, size),\n\t\t\t\ttext: result.preview.text\n\t\t\t},\n\t\t\turi: result.uri\n\t\t};\n\t}\n\n\tprivate searchInFolder(folderQuery: IFolderQuery<URI>, onResult: (result: TextSearchResult) => void, token: CancellationToken): Promise<TextSearchComplete | null | undefined> {\n\t\tconst queryTester = new QueryGlobTester(this.query, folderQuery);\n\t\tconst testingPs: Promise<void>[] = [];\n\t\tconst progress = {\n\t\t\treport: (result: TextSearchResult) => {\n\t\t\t\tif (!this.validateProviderResult(result)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst hasSibling = folderQuery.folder.scheme === Schemas.file ?\n\t\t\t\t\tglob.hasSiblingPromiseFn(() => {\n\t\t\t\t\t\treturn this.fileUtils.readdir(resources.dirname(result.uri));\n\t\t\t\t\t}) :\n\t\t\t\t\tundefined;\n\n\t\t\t\tconst relativePath = resources.relativePath(folderQuery.folder, result.uri);\n\t\t\t\tif (relativePath) {\n\t\t\t\t\ttestingPs.push(\n\t\t\t\t\t\tqueryTester.includedInQuery(relativePath, path.basename(relativePath), hasSibling)\n\t\t\t\t\t\t\t.then(included => {\n\t\t\t\t\t\t\t\tif (included) {\n\t\t\t\t\t\t\t\t\tonResult(result);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tconst searchOptions = this.getSearchOptionsForFolder(folderQuery);\n\t\treturn new Promise(resolve => nextTick(resolve))\n\t\t\t.then(() => this.provider.provideTextSearchResults(patternInfoToQuery(this.query.contentPattern), searchOptions, progress, token))\n\t\t\t.then(result => {\n\t\t\t\treturn Promise.all(testingPs)\n\t\t\t\t\t.then(() => result);\n\t\t\t});\n\t}\n\n\tprivate validateProviderResult(result: TextSearchResult): boolean {\n\t\tif (extensionResultIsMatch(result)) {\n\t\t\tif (Array.isArray(result.ranges)) {\n\t\t\t\tif (!Array.isArray(result.preview.matches)) {\n\t\t\t\t\tconsole.warn('INVALID - A text search provider match\\'s`ranges` and`matches` properties must have the same type.');\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif ((<Range[]>result.preview.matches).length !== result.ranges.length) {\n\t\t\t\t\tconsole.warn('INVALID - A text search provider match\\'s`ranges` and`matches` properties must have the same length.');\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (Array.isArray(result.preview.matches)) {\n\t\t\t\t\tconsole.warn('INVALID - A text search provider match\\'s`ranges` and`matches` properties must have the same length.');\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprivate getSearchOptionsForFolder(fq: IFolderQuery<URI>): TextSearchOptions {\n\t\tconst includes = resolvePatternsForProvider(this.query.includePattern, fq.includePattern);\n\t\tconst excludes = resolvePatternsForProvider(this.query.excludePattern, fq.excludePattern);\n\n\t\tconst options = <TextSearchOptions>{\n\t\t\tfolder: URI.from(fq.folder),\n\t\t\texcludes,\n\t\t\tincludes,\n\t\t\tuseIgnoreFiles: !fq.disregardIgnoreFiles,\n\t\t\tuseGlobalIgnoreFiles: !fq.disregardGlobalIgnoreFiles,\n\t\t\tfollowSymlinks: !fq.ignoreSymlinks,\n\t\t\tencoding: fq.fileEncoding && this.fileUtils.toCanonicalName(fq.fileEncoding),\n\t\t\tmaxFileSize: this.query.maxFileSize,\n\t\t\tmaxResults: this.query.maxResults,\n\t\t\tpreviewOptions: this.query.previewOptions,\n\t\t\tafterContext: this.query.afterContext,\n\t\t\tbeforeContext: this.query.beforeContext\n\t\t};\n\t\t(<IExtendedExtensionSearchOptions>options).usePCRE2 = this.query.usePCRE2;\n\t\treturn options;\n\t}\n}\n\nfunction patternInfoToQuery(patternInfo: IPatternInfo): TextSearchQuery {\n\treturn <TextSearchQuery>{\n\t\tisCaseSensitive: patternInfo.isCaseSensitive || false,\n\t\tisRegExp: patternInfo.isRegExp || false,\n\t\tisWordMatch: patternInfo.isWordMatch || false,\n\t\tisMultiline: patternInfo.isMultiline || false,\n\t\tpattern: patternInfo.pattern\n\t};\n}\n\nexport class TextSearchResultsCollector {\n\tprivate _batchedCollector: BatchedCollector<IFileMatch>;\n\n\tprivate _currentFolderIdx: number = -1;\n\tprivate _currentUri: URI | undefined;\n\tprivate _currentFileMatch: IFileMatch | null = null;\n\n\tconstructor(private _onResult: (result: IFileMatch[]) => void) {\n\t\tthis._batchedCollector = new BatchedCollector<IFileMatch>(512, items => this.sendItems(items));\n\t}\n\n\tadd(data: TextSearchResult, folderIdx: number): void {\n\t\t// Collects TextSearchResults into IInternalFileMatches and collates using BatchedCollector.\n\t\t// This is efficient for ripgrep which sends results back one file at a time. It wouldn't be efficient for other search\n\t\t// providers that send results in random order. We could do this step afterwards instead.\n\t\tif (this._currentFileMatch && (this._currentFolderIdx !== folderIdx || !resources.isEqual(this._currentUri, data.uri))) {\n\t\t\tthis.pushToCollector();\n\t\t\tthis._currentFileMatch = null;\n\t\t}\n\n\t\tif (!this._currentFileMatch) {\n\t\t\tthis._currentFolderIdx = folderIdx;\n\t\t\tthis._currentFileMatch = {\n\t\t\t\tresource: data.uri,\n\t\t\t\tresults: []\n\t\t\t};\n\t\t}\n\n\t\tthis._currentFileMatch.results!.push(extensionResultToFrontendResult(data));\n\t}\n\n\tprivate pushToCollector(): void {\n\t\tconst size = this._currentFileMatch && this._currentFileMatch.results ?\n\t\t\tthis._currentFileMatch.results.length :\n\t\t\t0;\n\t\tthis._batchedCollector.addItem(this._currentFileMatch!, size);\n\t}\n\n\tflush(): void {\n\t\tthis.pushToCollector();\n\t\tthis._batchedCollector.flush();\n\t}\n\n\tprivate sendItems(items: IFileMatch[]): void {\n\t\tthis._onResult(items);\n\t}\n}\n\nfunction extensionResultToFrontendResult(data: TextSearchResult): ITextSearchResult {\n\t// Warning: result from RipgrepTextSearchEH has fake Range. Don't depend on any other props beyond these...\n\tif (extensionResultIsMatch(data)) {\n\t\treturn <ITextSearchMatch>{\n\t\t\tpreview: {\n\t\t\t\tmatches: mapArrayOrNot(data.preview.matches, m => ({\n\t\t\t\t\tstartLineNumber: m.start.line,\n\t\t\t\t\tstartColumn: m.start.character,\n\t\t\t\t\tendLineNumber: m.end.line,\n\t\t\t\t\tendColumn: m.end.character\n\t\t\t\t})),\n\t\t\t\ttext: data.preview.text\n\t\t\t},\n\t\t\tranges: mapArrayOrNot(data.ranges, r => ({\n\t\t\t\tstartLineNumber: r.start.line,\n\t\t\t\tstartColumn: r.start.character,\n\t\t\t\tendLineNumber: r.end.line,\n\t\t\t\tendColumn: r.end.character\n\t\t\t}))\n\t\t};\n\t} else {\n\t\treturn <ITextSearchContext>{\n\t\t\ttext: data.text,\n\t\t\tlineNumber: data.lineNumber\n\t\t};\n\t}\n}\n\nexport function extensionResultIsMatch(data: TextSearchResult): data is TextSearchMatch {\n\treturn !!(<TextSearchMatch>data).preview;\n}\n\n/**\n * Collects items that have a size - before the cumulative size of collected items reaches START_BATCH_AFTER_COUNT, the callback is called for every\n * set of items collected.\n * But after that point, the callback is called with batches of maxBatchSize.\n * If the batch isn't filled within some time, the callback is also called.\n */\nexport class BatchedCollector<T> {\n\tprivate static readonly TIMEOUT = 4000;\n\n\t// After START_BATCH_AFTER_COUNT items have been collected, stop flushing on timeout\n\tprivate static readonly START_BATCH_AFTER_COUNT = 50;\n\n\tprivate totalNumberCompleted = 0;\n\tprivate batch: T[] = [];\n\tprivate batchSize = 0;\n\tprivate timeoutHandle: any;\n\n\tconstructor(private maxBatchSize: number, private cb: (items: T[]) => void) {\n\t}\n\n\taddItem(item: T, size: number): void {\n\t\tif (!item) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.addItemToBatch(item, size);\n\t}\n\n\taddItems(items: T[], size: number): void {\n\t\tif (!items) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.addItemsToBatch(items, size);\n\t}\n\n\tprivate addItemToBatch(item: T, size: number): void {\n\t\tthis.batch.push(item);\n\t\tthis.batchSize += size;\n\t\tthis.onUpdate();\n\t}\n\n\tprivate addItemsToBatch(item: T[], size: number): void {\n\t\tthis.batch = this.batch.concat(item);\n\t\tthis.batchSize += size;\n\t\tthis.onUpdate();\n\t}\n\n\tprivate onUpdate(): void {\n\t\tif (this.totalNumberCompleted < BatchedCollector.START_BATCH_AFTER_COUNT) {\n\t\t\t// Flush because we aren't batching yet\n\t\t\tthis.flush();\n\t\t} else if (this.batchSize >= this.maxBatchSize) {\n\t\t\t// Flush because the batch is full\n\t\t\tthis.flush();\n\t\t} else if (!this.timeoutHandle) {\n\t\t\t// No timeout running, start a timeout to flush\n\t\t\tthis.timeoutHandle = setTimeout(() => {\n\t\t\t\tthis.flush();\n\t\t\t}, BatchedCollector.TIMEOUT);\n\t\t}\n\t}\n\n\tflush(): void {\n\t\tif (this.batchSize) {\n\t\t\tthis.totalNumberCompleted += this.batchSize;\n\t\t\tthis.cb(this.batch);\n\t\t\tthis.batch = [];\n\t\t\tthis.batchSize = 0;\n\n\t\t\tif (this.timeoutHandle) {\n\t\t\t\tclearTimeout(this.timeoutHandle);\n\t\t\t\tthis.timeoutHandle = 0;\n\t\t\t}\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IDisposable, toDisposable } from 'vs/base/common/lifecycle';\nimport type * as vscode from 'vscode';\nimport { ExtHostSearchShape, MainThreadSearchShape, MainContext } from '../common/extHost.protocol';\nimport { createDecorator } from 'vs/platform/instantiation/common/instantiation';\nimport { FileSearchManager } from 'vs/workbench/services/search/common/fileSearchManager';\nimport { IExtHostRpcService } from 'vs/workbench/api/common/extHostRpcService';\nimport { IURITransformerService } from 'vs/workbench/api/common/extHostUriTransformerService';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { IRawFileQuery, ISearchCompleteStats, IFileQuery, IRawTextQuery, IRawQuery, ITextQuery, IFolderQuery } from 'vs/workbench/services/search/common/search';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { TextSearchManager } from 'vs/workbench/services/search/common/textSearchManager';\n\nexport interface IExtHostSearch extends ExtHostSearchShape {\n\tregisterTextSearchProvider(scheme: string, provider: vscode.TextSearchProvider): IDisposable;\n\tregisterFileSearchProvider(scheme: string, provider: vscode.FileSearchProvider): IDisposable;\n}\n\nexport const IExtHostSearch = createDecorator<IExtHostSearch>('IExtHostSearch');\n\nexport class ExtHostSearch implements ExtHostSearchShape {\n\n\tprotected readonly _proxy: MainThreadSearchShape = this.extHostRpc.getProxy(MainContext.MainThreadSearch);\n\tprotected _handlePool: number = 0;\n\n\tprivate readonly _textSearchProvider = new Map<number, vscode.TextSearchProvider>();\n\tprivate readonly _textSearchUsedSchemes = new Set<string>();\n\tprivate readonly _fileSearchProvider = new Map<number, vscode.FileSearchProvider>();\n\tprivate readonly _fileSearchUsedSchemes = new Set<string>();\n\n\tprivate readonly _fileSearchManager = new FileSearchManager();\n\n\tconstructor(\n\t\t@IExtHostRpcService private extHostRpc: IExtHostRpcService,\n\t\t@IURITransformerService protected _uriTransformer: IURITransformerService,\n\t\t@ILogService protected _logService: ILogService\n\t) { }\n\n\tprotected _transformScheme(scheme: string): string {\n\t\treturn this._uriTransformer.transformOutgoingScheme(scheme);\n\t}\n\n\tregisterTextSearchProvider(scheme: string, provider: vscode.TextSearchProvider): IDisposable {\n\t\tif (this._textSearchUsedSchemes.has(scheme)) {\n\t\t\tthrow new Error(`a text search provider for the scheme '${scheme}' is already registered`);\n\t\t}\n\n\t\tthis._textSearchUsedSchemes.add(scheme);\n\t\tconst handle = this._handlePool++;\n\t\tthis._textSearchProvider.set(handle, provider);\n\t\tthis._proxy.$registerTextSearchProvider(handle, this._transformScheme(scheme));\n\t\treturn toDisposable(() => {\n\t\t\tthis._textSearchUsedSchemes.delete(scheme);\n\t\t\tthis._textSearchProvider.delete(handle);\n\t\t\tthis._proxy.$unregisterProvider(handle);\n\t\t});\n\t}\n\n\tregisterFileSearchProvider(scheme: string, provider: vscode.FileSearchProvider): IDisposable {\n\t\tif (this._fileSearchUsedSchemes.has(scheme)) {\n\t\t\tthrow new Error(`a file search provider for the scheme '${scheme}' is already registered`);\n\t\t}\n\n\t\tthis._fileSearchUsedSchemes.add(scheme);\n\t\tconst handle = this._handlePool++;\n\t\tthis._fileSearchProvider.set(handle, provider);\n\t\tthis._proxy.$registerFileSearchProvider(handle, this._transformScheme(scheme));\n\t\treturn toDisposable(() => {\n\t\t\tthis._fileSearchUsedSchemes.delete(scheme);\n\t\t\tthis._fileSearchProvider.delete(handle);\n\t\t\tthis._proxy.$unregisterProvider(handle);\n\t\t});\n\t}\n\n\t$provideFileSearchResults(handle: number, session: number, rawQuery: IRawFileQuery, token: vscode.CancellationToken): Promise<ISearchCompleteStats> {\n\t\tconst query = reviveQuery(rawQuery);\n\t\tconst provider = this._fileSearchProvider.get(handle);\n\t\tif (provider) {\n\t\t\treturn this._fileSearchManager.fileSearch(query, provider, batch => {\n\t\t\t\tthis._proxy.$handleFileMatch(handle, session, batch.map(p => p.resource));\n\t\t\t}, token);\n\t\t} else {\n\t\t\tthrow new Error('unknown provider: ' + handle);\n\t\t}\n\t}\n\n\t$clearCache(cacheKey: string): Promise<void> {\n\t\tthis._fileSearchManager.clearCache(cacheKey);\n\n\t\treturn Promise.resolve(undefined);\n\t}\n\n\t$provideTextSearchResults(handle: number, session: number, rawQuery: IRawTextQuery, token: vscode.CancellationToken): Promise<ISearchCompleteStats> {\n\t\tconst provider = this._textSearchProvider.get(handle);\n\t\tif (!provider || !provider.provideTextSearchResults) {\n\t\t\tthrow new Error(`Unknown provider ${handle}`);\n\t\t}\n\n\t\tconst query = reviveQuery(rawQuery);\n\t\tconst engine = this.createTextSearchManager(query, provider);\n\t\treturn engine.search(progress => this._proxy.$handleTextMatch(handle, session, progress), token);\n\t}\n\n\tprotected createTextSearchManager(query: ITextQuery, provider: vscode.TextSearchProvider): TextSearchManager {\n\t\treturn new TextSearchManager(query, provider, {\n\t\t\treaddir: resource => Promise.resolve([]), // TODO@rob implement\n\t\t\ttoCanonicalName: encoding => encoding\n\t\t});\n\t}\n}\n\nexport function reviveQuery<U extends IRawQuery>(rawQuery: U): U extends IRawTextQuery ? ITextQuery : IFileQuery {\n\treturn {\n\t\t...<any>rawQuery, // TODO@rob ???\n\t\t...{\n\t\t\tfolderQueries: rawQuery.folderQueries && rawQuery.folderQueries.map(reviveFolderQuery),\n\t\t\textraFileResources: rawQuery.extraFileResources && rawQuery.extraFileResources.map(components => URI.revive(components))\n\t\t}\n\t};\n}\n\nfunction reviveFolderQuery(rawFolderQuery: IFolderQuery<UriComponents>): IFolderQuery<URI> {\n\treturn {\n\t\t...rawFolderQuery,\n\t\tfolder: URI.revive(rawFolderQuery.folder)\n\t};\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as nls from 'vs/nls';\nimport { CancellationTokenSource } from 'vs/base/common/cancellation';\nimport * as errors from 'vs/base/common/errors';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport * as path from 'vs/base/common/path';\nimport Severity from 'vs/base/common/severity';\nimport { URI } from 'vs/base/common/uri';\nimport { TextEditorCursorStyle } from 'vs/editor/common/config/editorOptions';\nimport { OverviewRulerLane } from 'vs/editor/common/model';\nimport * as languageConfiguration from 'vs/editor/common/modes/languageConfiguration';\nimport { score } from 'vs/editor/common/modes/languageSelector';\nimport * as files from 'vs/platform/files/common/files';\nimport { ExtHostContext, MainContext, ExtHostLogServiceShape, UIKind } from 'vs/workbench/api/common/extHost.protocol';\nimport { ExtHostApiCommands } from 'vs/workbench/api/common/extHostApiCommands';\nimport { ExtHostClipboard } from 'vs/workbench/api/common/extHostClipboard';\nimport { IExtHostCommands } from 'vs/workbench/api/common/extHostCommands';\nimport { ExtHostComments } from 'vs/workbench/api/common/extHostComments';\nimport { ExtHostConfigProvider, IExtHostConfiguration } from 'vs/workbench/api/common/extHostConfiguration';\nimport { ExtHostDiagnostics } from 'vs/workbench/api/common/extHostDiagnostics';\nimport { ExtHostDialogs } from 'vs/workbench/api/common/extHostDialogs';\nimport { ExtHostDocumentContentProvider } from 'vs/workbench/api/common/extHostDocumentContentProviders';\nimport { ExtHostDocumentSaveParticipant } from 'vs/workbench/api/common/extHostDocumentSaveParticipant';\nimport { ExtHostDocuments } from 'vs/workbench/api/common/extHostDocuments';\nimport { IExtHostDocumentsAndEditors } from 'vs/workbench/api/common/extHostDocumentsAndEditors';\nimport { IExtHostExtensionService } from 'vs/workbench/api/common/extHostExtensionService';\nimport { ExtHostFileSystem } from 'vs/workbench/api/common/extHostFileSystem';\nimport { ExtHostFileSystemEventService } from 'vs/workbench/api/common/extHostFileSystemEventService';\nimport { ExtHostLanguageFeatures } from 'vs/workbench/api/common/extHostLanguageFeatures';\nimport { ExtHostLanguages } from 'vs/workbench/api/common/extHostLanguages';\nimport { ExtHostMessageService } from 'vs/workbench/api/common/extHostMessageService';\nimport { IExtHostOutputService } from 'vs/workbench/api/common/extHostOutput';\nimport { ExtHostProgress } from 'vs/workbench/api/common/extHostProgress';\nimport { ExtHostQuickOpen } from 'vs/workbench/api/common/extHostQuickOpen';\nimport { ExtHostSCM } from 'vs/workbench/api/common/extHostSCM';\nimport { ExtHostStatusBar } from 'vs/workbench/api/common/extHostStatusBar';\nimport { IExtHostStorage } from 'vs/workbench/api/common/extHostStorage';\nimport { IExtHostTerminalService } from 'vs/workbench/api/common/extHostTerminalService';\nimport { ExtHostEditors } from 'vs/workbench/api/common/extHostTextEditors';\nimport { ExtHostTreeViews } from 'vs/workbench/api/common/extHostTreeViews';\nimport * as typeConverters from 'vs/workbench/api/common/extHostTypeConverters';\nimport * as extHostTypes from 'vs/workbench/api/common/extHostTypes';\nimport { ExtHostUrls } from 'vs/workbench/api/common/extHostUrls';\nimport { ExtHostWebviews } from 'vs/workbench/api/common/extHostWebview';\nimport { IExtHostWindow } from 'vs/workbench/api/common/extHostWindow';\nimport { IExtHostWorkspace } from 'vs/workbench/api/common/extHostWorkspace';\nimport { throwProposedApiError, checkProposedApiEnabled } from 'vs/workbench/services/extensions/common/extensions';\nimport { ProxyIdentifier } from 'vs/workbench/services/extensions/common/proxyIdentifier';\nimport { ExtensionDescriptionRegistry } from 'vs/workbench/services/extensions/common/extensionDescriptionRegistry';\nimport type * as vscode from 'vscode';\nimport { ExtensionIdentifier, IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { originalFSPath } from 'vs/base/common/resources';\nimport { values } from 'vs/base/common/collections';\nimport { ExtHostEditorInsets } from 'vs/workbench/api/common/extHostCodeInsets';\nimport { ExtHostLabelService } from 'vs/workbench/api/common/extHostLabelService';\nimport { getRemoteName } from 'vs/platform/remote/common/remoteHosts';\nimport { ServicesAccessor } from 'vs/platform/instantiation/common/instantiation';\nimport { IExtHostDecorations } from 'vs/workbench/api/common/extHostDecorations';\nimport { IExtHostTask } from 'vs/workbench/api/common/extHostTask';\nimport { IExtHostDebugService } from 'vs/workbench/api/common/extHostDebugService';\nimport { IExtHostSearch } from 'vs/workbench/api/common/extHostSearch';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { IURITransformerService } from 'vs/workbench/api/common/extHostUriTransformerService';\nimport { IExtHostRpcService } from 'vs/workbench/api/common/extHostRpcService';\nimport { IExtHostInitDataService } from 'vs/workbench/api/common/extHostInitDataService';\nimport { ExtHostNotebookController } from 'vs/workbench/api/common/extHostNotebook';\nimport { ExtHostTheming } from 'vs/workbench/api/common/extHostTheming';\nimport { IExtHostTunnelService } from 'vs/workbench/api/common/extHostTunnelService';\nimport { IExtHostApiDeprecationService } from 'vs/workbench/api/common/extHostApiDeprecationService';\nimport { ExtHostAuthentication } from 'vs/workbench/api/common/extHostAuthentication';\nimport { ExtHostTimeline } from 'vs/workbench/api/common/extHostTimeline';\nimport { ExtHostNotebookConcatDocument } from 'vs/workbench/api/common/extHostNotebookConcatDocument';\nimport { IExtensionStoragePaths } from 'vs/workbench/api/common/extHostStoragePaths';\nimport { IExtHostConsumerFileSystem } from 'vs/workbench/api/common/extHostFileSystemConsumer';\nimport { ExtHostWebviewViews } from 'vs/workbench/api/common/extHostWebviewView';\nimport { ExtHostCustomEditors } from 'vs/workbench/api/common/extHostCustomEditors';\nimport { ExtHostWebviewPanels } from 'vs/workbench/api/common/extHostWebviewPanels';\nimport { ExtHostBulkEdits } from 'vs/workbench/api/common/extHostBulkEdits';\nimport { IExtHostFileSystemInfo } from 'vs/workbench/api/common/extHostFileSystemInfo';\nimport { ExtHostTesting } from 'vs/workbench/api/common/extHostTesting';\nimport { ExtHostUriOpeners } from 'vs/workbench/api/common/extHostUriOpener';\nimport { IExtHostSecretState } from 'vs/workbench/api/common/exHostSecretState';\nimport { ExtHostEditorTabs } from 'vs/workbench/api/common/extHostEditorTabs';\n\nexport interface IExtensionApiFactory {\n\t(extension: IExtensionDescription, registry: ExtensionDescriptionRegistry, configProvider: ExtHostConfigProvider): typeof vscode;\n}\n\n/**\n * This method instantiates and returns the extension API surface\n */\nexport function createApiFactoryAndRegisterActors(accessor: ServicesAccessor): IExtensionApiFactory {\n\n\t// services\n\tconst initData = accessor.get(IExtHostInitDataService);\n\tconst extHostFileSystemInfo = accessor.get(IExtHostFileSystemInfo);\n\tconst extHostConsumerFileSystem = accessor.get(IExtHostConsumerFileSystem);\n\tconst extensionService = accessor.get(IExtHostExtensionService);\n\tconst extHostWorkspace = accessor.get(IExtHostWorkspace);\n\tconst extHostConfiguration = accessor.get(IExtHostConfiguration);\n\tconst uriTransformer = accessor.get(IURITransformerService);\n\tconst rpcProtocol = accessor.get(IExtHostRpcService);\n\tconst extHostStorage = accessor.get(IExtHostStorage);\n\tconst extensionStoragePaths = accessor.get(IExtensionStoragePaths);\n\tconst extHostLogService = accessor.get(ILogService);\n\tconst extHostTunnelService = accessor.get(IExtHostTunnelService);\n\tconst extHostApiDeprecation = accessor.get(IExtHostApiDeprecationService);\n\tconst extHostWindow = accessor.get(IExtHostWindow);\n\tconst extHostSecretState = accessor.get(IExtHostSecretState);\n\n\t// register addressable instances\n\trpcProtocol.set(ExtHostContext.ExtHostFileSystemInfo, extHostFileSystemInfo);\n\trpcProtocol.set(ExtHostContext.ExtHostLogService, <ExtHostLogServiceShape><any>extHostLogService);\n\trpcProtocol.set(ExtHostContext.ExtHostWorkspace, extHostWorkspace);\n\trpcProtocol.set(ExtHostContext.ExtHostConfiguration, extHostConfiguration);\n\trpcProtocol.set(ExtHostContext.ExtHostExtensionService, extensionService);\n\trpcProtocol.set(ExtHostContext.ExtHostStorage, extHostStorage);\n\trpcProtocol.set(ExtHostContext.ExtHostTunnelService, extHostTunnelService);\n\trpcProtocol.set(ExtHostContext.ExtHostWindow, extHostWindow);\n\trpcProtocol.set(ExtHostContext.ExtHostSecretState, extHostSecretState);\n\n\t// automatically create and register addressable instances\n\tconst extHostDecorations = rpcProtocol.set(ExtHostContext.ExtHostDecorations, accessor.get(IExtHostDecorations));\n\tconst extHostDocumentsAndEditors = rpcProtocol.set(ExtHostContext.ExtHostDocumentsAndEditors, accessor.get(IExtHostDocumentsAndEditors));\n\tconst extHostCommands = rpcProtocol.set(ExtHostContext.ExtHostCommands, accessor.get(IExtHostCommands));\n\tconst extHostTerminalService = rpcProtocol.set(ExtHostContext.ExtHostTerminalService, accessor.get(IExtHostTerminalService));\n\tconst extHostDebugService = rpcProtocol.set(ExtHostContext.ExtHostDebugService, accessor.get(IExtHostDebugService));\n\tconst extHostSearch = rpcProtocol.set(ExtHostContext.ExtHostSearch, accessor.get(IExtHostSearch));\n\tconst extHostTask = rpcProtocol.set(ExtHostContext.ExtHostTask, accessor.get(IExtHostTask));\n\tconst extHostOutputService = rpcProtocol.set(ExtHostContext.ExtHostOutputService, accessor.get(IExtHostOutputService));\n\n\t// manually create and register addressable instances\n\tconst extHostEditorTabs = rpcProtocol.set(ExtHostContext.ExtHostEditorTabs, new ExtHostEditorTabs());\n\tconst extHostUrls = rpcProtocol.set(ExtHostContext.ExtHostUrls, new ExtHostUrls(rpcProtocol));\n\tconst extHostDocuments = rpcProtocol.set(ExtHostContext.ExtHostDocuments, new ExtHostDocuments(rpcProtocol, extHostDocumentsAndEditors));\n\tconst extHostDocumentContentProviders = rpcProtocol.set(ExtHostContext.ExtHostDocumentContentProviders, new ExtHostDocumentContentProvider(rpcProtocol, extHostDocumentsAndEditors, extHostLogService));\n\tconst extHostDocumentSaveParticipant = rpcProtocol.set(ExtHostContext.ExtHostDocumentSaveParticipant, new ExtHostDocumentSaveParticipant(extHostLogService, extHostDocuments, rpcProtocol.getProxy(MainContext.MainThreadBulkEdits)));\n\tconst extHostNotebook = rpcProtocol.set(ExtHostContext.ExtHostNotebook, new ExtHostNotebookController(rpcProtocol, extHostCommands, extHostDocumentsAndEditors, initData.environment, extHostLogService, extensionStoragePaths));\n\tconst extHostEditors = rpcProtocol.set(ExtHostContext.ExtHostEditors, new ExtHostEditors(rpcProtocol, extHostDocumentsAndEditors));\n\tconst extHostTreeViews = rpcProtocol.set(ExtHostContext.ExtHostTreeViews, new ExtHostTreeViews(rpcProtocol.getProxy(MainContext.MainThreadTreeViews), extHostCommands, extHostLogService));\n\tconst extHostEditorInsets = rpcProtocol.set(ExtHostContext.ExtHostEditorInsets, new ExtHostEditorInsets(rpcProtocol.getProxy(MainContext.MainThreadEditorInsets), extHostEditors, initData.environment));\n\tconst extHostDiagnostics = rpcProtocol.set(ExtHostContext.ExtHostDiagnostics, new ExtHostDiagnostics(rpcProtocol, extHostLogService));\n\tconst extHostLanguageFeatures = rpcProtocol.set(ExtHostContext.ExtHostLanguageFeatures, new ExtHostLanguageFeatures(rpcProtocol, uriTransformer, extHostDocuments, extHostCommands, extHostDiagnostics, extHostLogService, extHostApiDeprecation));\n\tconst extHostFileSystem = rpcProtocol.set(ExtHostContext.ExtHostFileSystem, new ExtHostFileSystem(rpcProtocol, extHostLanguageFeatures));\n\tconst extHostFileSystemEvent = rpcProtocol.set(ExtHostContext.ExtHostFileSystemEventService, new ExtHostFileSystemEventService(rpcProtocol, extHostLogService, extHostDocumentsAndEditors));\n\tconst extHostQuickOpen = rpcProtocol.set(ExtHostContext.ExtHostQuickOpen, new ExtHostQuickOpen(rpcProtocol, extHostWorkspace, extHostCommands));\n\tconst extHostSCM = rpcProtocol.set(ExtHostContext.ExtHostSCM, new ExtHostSCM(rpcProtocol, extHostCommands, extHostLogService));\n\tconst extHostComment = rpcProtocol.set(ExtHostContext.ExtHostComments, new ExtHostComments(rpcProtocol, extHostCommands, extHostDocuments));\n\tconst extHostProgress = rpcProtocol.set(ExtHostContext.ExtHostProgress, new ExtHostProgress(rpcProtocol.getProxy(MainContext.MainThreadProgress)));\n\tconst extHostLabelService = rpcProtocol.set(ExtHostContext.ExtHosLabelService, new ExtHostLabelService(rpcProtocol));\n\tconst extHostTheming = rpcProtocol.set(ExtHostContext.ExtHostTheming, new ExtHostTheming(rpcProtocol));\n\tconst extHostAuthentication = rpcProtocol.set(ExtHostContext.ExtHostAuthentication, new ExtHostAuthentication(rpcProtocol));\n\tconst extHostTimeline = rpcProtocol.set(ExtHostContext.ExtHostTimeline, new ExtHostTimeline(rpcProtocol, extHostCommands));\n\tconst extHostWebviews = rpcProtocol.set(ExtHostContext.ExtHostWebviews, new ExtHostWebviews(rpcProtocol, initData.environment, extHostWorkspace, extHostLogService, extHostApiDeprecation));\n\tconst extHostWebviewPanels = rpcProtocol.set(ExtHostContext.ExtHostWebviewPanels, new ExtHostWebviewPanels(rpcProtocol, extHostWebviews, extHostWorkspace));\n\tconst extHostCustomEditors = rpcProtocol.set(ExtHostContext.ExtHostCustomEditors, new ExtHostCustomEditors(rpcProtocol, extHostDocuments, extensionStoragePaths, extHostWebviews, extHostWebviewPanels));\n\tconst extHostWebviewViews = rpcProtocol.set(ExtHostContext.ExtHostWebviewViews, new ExtHostWebviewViews(rpcProtocol, extHostWebviews));\n\tconst extHostTesting = rpcProtocol.set(ExtHostContext.ExtHostTesting, new ExtHostTesting(rpcProtocol, extHostDocumentsAndEditors, extHostWorkspace));\n\tconst extHostUriOpeners = rpcProtocol.set(ExtHostContext.ExtHostUriOpeners, new ExtHostUriOpeners(rpcProtocol));\n\n\t// Check that no named customers are missing\n\tconst expected: ProxyIdentifier<any>[] = values(ExtHostContext);\n\trpcProtocol.assertRegistered(expected);\n\n\t// Other instances\n\tconst extHostBulkEdits = new ExtHostBulkEdits(rpcProtocol, extHostDocumentsAndEditors, extHostNotebook);\n\tconst extHostClipboard = new ExtHostClipboard(rpcProtocol);\n\tconst extHostMessageService = new ExtHostMessageService(rpcProtocol, extHostLogService);\n\tconst extHostDialogs = new ExtHostDialogs(rpcProtocol);\n\tconst extHostStatusBar = new ExtHostStatusBar(rpcProtocol, extHostCommands.converter);\n\tconst extHostLanguages = new ExtHostLanguages(rpcProtocol, extHostDocuments);\n\n\t// Register API-ish commands\n\tExtHostApiCommands.register(extHostCommands);\n\n\treturn function (extension: IExtensionDescription, extensionRegistry: ExtensionDescriptionRegistry, configProvider: ExtHostConfigProvider): typeof vscode {\n\n\t\t// Check document selectors for being overly generic. Technically this isn't a problem but\n\t\t// in practice many extensions say they support `fooLang` but need fs-access to do so. Those\n\t\t// extension should specify then the `file`-scheme, e.g. `{ scheme: 'fooLang', language: 'fooLang' }`\n\t\t// We only inform once, it is not a warning because we just want to raise awareness and because\n\t\t// we cannot say if the extension is doing it right or wrong...\n\t\tconst checkSelector = (function () {\n\t\t\tlet done = (!extension.isUnderDevelopment);\n\t\t\tfunction informOnce(selector: vscode.DocumentSelector) {\n\t\t\t\tif (!done) {\n\t\t\t\t\textHostLogService.info(`Extension '${extension.identifier.value}' uses a document selector without scheme. Learn more about this: https://go.microsoft.com/fwlink/?linkid=872305`);\n\t\t\t\t\tdone = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn function perform(selector: vscode.DocumentSelector): vscode.DocumentSelector {\n\t\t\t\tif (Array.isArray(selector)) {\n\t\t\t\t\tselector.forEach(perform);\n\t\t\t\t} else if (typeof selector === 'string') {\n\t\t\t\t\tinformOnce(selector);\n\t\t\t\t} else {\n\t\t\t\t\tif (typeof selector.scheme === 'undefined') {\n\t\t\t\t\t\tinformOnce(selector);\n\t\t\t\t\t}\n\t\t\t\t\tif (!extension.enableProposedApi && typeof selector.exclusive === 'boolean') {\n\t\t\t\t\t\tthrowProposedApiError(extension);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn selector;\n\t\t\t};\n\t\t})();\n\n\t\tconst authentication: typeof vscode.authentication = {\n\t\t\tgetSession(providerId: string, scopes: string[], options?: vscode.AuthenticationGetSessionOptions) {\n\t\t\t\treturn extHostAuthentication.getSession(extension, providerId, scopes, options as any);\n\t\t\t},\n\t\t\tget onDidChangeSessions(): Event<vscode.AuthenticationSessionsChangeEvent> {\n\t\t\t\treturn extHostAuthentication.onDidChangeSessions;\n\t\t\t},\n\t\t\tregisterAuthenticationProvider(id: string, label: string, provider: vscode.AuthenticationProvider, options?: vscode.AuthenticationProviderOptions): vscode.Disposable {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostAuthentication.registerAuthenticationProvider(id, label, provider, options);\n\t\t\t},\n\t\t\tget onDidChangeAuthenticationProviders(): Event<vscode.AuthenticationProvidersChangeEvent> {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostAuthentication.onDidChangeAuthenticationProviders;\n\t\t\t},\n\t\t\tget providers(): ReadonlyArray<vscode.AuthenticationProviderInformation> {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostAuthentication.providers;\n\t\t\t},\n\t\t\tlogout(providerId: string, sessionId: string): Thenable<void> {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostAuthentication.logout(providerId, sessionId);\n\t\t\t}\n\t\t};\n\n\t\t// namespace: commands\n\t\tconst commands: typeof vscode.commands = {\n\t\t\tregisterCommand(id: string, command: <T>(...args: any[]) => T | Thenable<T>, thisArgs?: any): vscode.Disposable {\n\t\t\t\treturn extHostCommands.registerCommand(true, id, command, thisArgs);\n\t\t\t},\n\t\t\tregisterTextEditorCommand(id: string, callback: (textEditor: vscode.TextEditor, edit: vscode.TextEditorEdit, ...args: any[]) => void, thisArg?: any): vscode.Disposable {\n\t\t\t\treturn extHostCommands.registerCommand(true, id, (...args: any[]): any => {\n\t\t\t\t\tconst activeTextEditor = extHostEditors.getActiveTextEditor();\n\t\t\t\t\tif (!activeTextEditor) {\n\t\t\t\t\t\textHostLogService.warn('Cannot execute ' + id + ' because there is no active text editor.');\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn activeTextEditor.edit((edit: vscode.TextEditorEdit) => {\n\t\t\t\t\t\tcallback.apply(thisArg, [activeTextEditor, edit, ...args]);\n\n\t\t\t\t\t}).then((result) => {\n\t\t\t\t\t\tif (!result) {\n\t\t\t\t\t\t\textHostLogService.warn('Edits from command ' + id + ' were not applied.');\n\t\t\t\t\t\t}\n\t\t\t\t\t}, (err) => {\n\t\t\t\t\t\textHostLogService.warn('An error occurred while running command ' + id, err);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t},\n\t\t\tregisterDiffInformationCommand: (id: string, callback: (diff: vscode.LineChange[], ...args: any[]) => any, thisArg?: any): vscode.Disposable => {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostCommands.registerCommand(true, id, async (...args: any[]): Promise<any> => {\n\t\t\t\t\tconst activeTextEditor = extHostEditors.getActiveTextEditor();\n\t\t\t\t\tif (!activeTextEditor) {\n\t\t\t\t\t\textHostLogService.warn('Cannot execute ' + id + ' because there is no active text editor.');\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst diff = await extHostEditors.getDiffInformation(activeTextEditor.id);\n\t\t\t\t\tcallback.apply(thisArg, [diff, ...args]);\n\t\t\t\t});\n\t\t\t},\n\t\t\texecuteCommand<T>(id: string, ...args: any[]): Thenable<T> {\n\t\t\t\treturn extHostCommands.executeCommand<T>(id, ...args);\n\t\t\t},\n\t\t\tgetCommands(filterInternal: boolean = false): Thenable<string[]> {\n\t\t\t\treturn extHostCommands.getCommands(filterInternal);\n\t\t\t}\n\t\t};\n\n\t\t// namespace: env\n\t\tconst env: typeof vscode.env = {\n\t\t\tget machineId() { return initData.telemetryInfo.machineId; },\n\t\t\tget sessionId() { return initData.telemetryInfo.sessionId; },\n\t\t\tget language() { return initData.environment.appLanguage; },\n\t\t\tget appName() { return initData.environment.appName; },\n\t\t\tget appRoot() { return initData.environment.appRoot?.fsPath ?? ''; },\n\t\t\tget uriScheme() { return initData.environment.appUriScheme; },\n\t\t\tget clipboard(): vscode.Clipboard {\n\t\t\t\treturn extHostClipboard;\n\t\t\t},\n\t\t\tget shell() {\n\t\t\t\treturn extHostTerminalService.getDefaultShell(false, configProvider);\n\t\t\t},\n\t\t\topenExternal(uri: URI, options?: { allowContributedOpeners?: boolean | string; }) {\n\t\t\t\treturn extHostWindow.openUri(uri, {\n\t\t\t\t\tallowTunneling: !!initData.remote.authority,\n\t\t\t\t\tallowContributedOpeners: options?.allowContributedOpeners,\n\t\t\t\t});\n\t\t\t},\n\t\t\tasExternalUri(uri: URI) {\n\t\t\t\tif (uri.scheme === initData.environment.appUriScheme) {\n\t\t\t\t\treturn extHostUrls.createAppUri(uri);\n\t\t\t\t}\n\n\t\t\t\treturn extHostWindow.asExternalUri(uri, { allowTunneling: !!initData.remote.authority });\n\t\t\t},\n\t\t\tget remoteName() {\n\t\t\t\treturn getRemoteName(initData.remote.authority);\n\t\t\t},\n\t\t\tget uiKind() {\n\t\t\t\treturn initData.uiKind;\n\t\t\t}\n\t\t};\n\t\tif (!initData.environment.extensionTestsLocationURI) {\n\t\t\t// allow to patch env-function when running tests\n\t\t\tObject.freeze(env);\n\t\t}\n\n\t\tconst extensionKind = initData.remote.isRemote\n\t\t\t? extHostTypes.ExtensionKind.Workspace\n\t\t\t: extHostTypes.ExtensionKind.UI;\n\n\t\tconst test: typeof vscode.test = {\n\t\t\tregisterTestProvider(provider) {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostTesting.registerTestProvider(provider);\n\t\t\t},\n\t\t\tcreateDocumentTestObserver(document) {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostTesting.createTextDocumentTestObserver(document);\n\t\t\t},\n\t\t\tcreateWorkspaceTestObserver(workspaceFolder) {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostTesting.createWorkspaceTestObserver(workspaceFolder);\n\t\t\t},\n\t\t\trunTests(provider) {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostTesting.runTests(provider);\n\t\t\t},\n\t\t\tget onDidChangeTestResults() {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostTesting.onLastResultsChanged;\n\t\t\t},\n\t\t\tget testResults() {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostTesting.lastResults;\n\t\t\t},\n\t\t};\n\n\t\t// namespace: extensions\n\t\tconst extensions: typeof vscode.extensions = {\n\t\t\tgetExtension(extensionId: string): Extension<any> | undefined {\n\t\t\t\tconst desc = extensionRegistry.getExtensionDescription(extensionId);\n\t\t\t\tif (desc) {\n\t\t\t\t\treturn new Extension(extensionService, extension.identifier, desc, extensionKind);\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t},\n\t\t\tget all(): Extension<any>[] {\n\t\t\t\treturn extensionRegistry.getAllExtensionDescriptions().map((desc) => new Extension(extensionService, extension.identifier, desc, extensionKind));\n\t\t\t},\n\t\t\tget onDidChange() {\n\t\t\t\treturn extensionRegistry.onDidChange;\n\t\t\t}\n\t\t};\n\n\t\t// namespace: languages\n\t\tconst languages: typeof vscode.languages = {\n\t\t\tcreateDiagnosticCollection(name?: string): vscode.DiagnosticCollection {\n\t\t\t\treturn extHostDiagnostics.createDiagnosticCollection(extension.identifier, name);\n\t\t\t},\n\t\t\tget onDidChangeDiagnostics() {\n\t\t\t\treturn extHostDiagnostics.onDidChangeDiagnostics;\n\t\t\t},\n\t\t\tgetDiagnostics: (resource?: vscode.Uri) => {\n\t\t\t\treturn <any>extHostDiagnostics.getDiagnostics(resource);\n\t\t\t},\n\t\t\tgetLanguages(): Thenable<string[]> {\n\t\t\t\treturn extHostLanguages.getLanguages();\n\t\t\t},\n\t\t\tsetTextDocumentLanguage(document: vscode.TextDocument, languageId: string): Thenable<vscode.TextDocument> {\n\t\t\t\treturn extHostLanguages.changeLanguage(document.uri, languageId);\n\t\t\t},\n\t\t\tmatch(selector: vscode.DocumentSelector, document: vscode.TextDocument): number {\n\t\t\t\treturn score(typeConverters.LanguageSelector.from(selector), document.uri, document.languageId, true);\n\t\t\t},\n\t\t\tregisterCodeActionsProvider(selector: vscode.DocumentSelector, provider: vscode.CodeActionProvider, metadata?: vscode.CodeActionProviderMetadata): vscode.Disposable {\n\t\t\t\treturn extHostLanguageFeatures.registerCodeActionProvider(extension, checkSelector(selector), provider, metadata);\n\t\t\t},\n\t\t\tregisterCodeLensProvider(selector: vscode.DocumentSelector, provider: vscode.CodeLensProvider): vscode.Disposable {\n\t\t\t\treturn extHostLanguageFeatures.registerCodeLensProvider(extension, checkSelector(selector), provider);\n\t\t\t},\n\t\t\tregisterDefinitionProvider(selector: vscode.DocumentSelector, provider: vscode.DefinitionProvider): vscode.Disposable {\n\t\t\t\treturn extHostLanguageFeatures.registerDefinitionProvider(extension, checkSelector(selector), provider);\n\t\t\t},\n\t\t\tregisterDeclarationProvider(selector: vscode.DocumentSelector, provider: vscode.DeclarationProvider): vscode.Disposable {\n\t\t\t\treturn extHostLanguageFeatures.registerDeclarationProvider(extension, checkSelector(selector), provider);\n\t\t\t},\n\t\t\tregisterImplementationProvider(selector: vscode.DocumentSelector, provider: vscode.ImplementationProvider): vscode.Disposable {\n\t\t\t\treturn extHostLanguageFeatures.registerImplementationProvider(extension, checkSelector(selector), provider);\n\t\t\t},\n\t\t\tregisterTypeDefinitionProvider(selector: vscode.DocumentSelector, provider: vscode.TypeDefinitionProvider): vscode.Disposable {\n\t\t\t\treturn extHostLanguageFeatures.registerTypeDefinitionProvider(extension, checkSelector(selector), provider);\n\t\t\t},\n\t\t\tregisterHoverProvider(selector: vscode.DocumentSelector, provider: vscode.HoverProvider): vscode.Disposable {\n\t\t\t\treturn extHostLanguageFeatures.registerHoverProvider(extension, checkSelector(selector), provider, extension.identifier);\n\t\t\t},\n\t\t\tregisterEvaluatableExpressionProvider(selector: vscode.DocumentSelector, provider: vscode.EvaluatableExpressionProvider): vscode.Disposable {\n\t\t\t\treturn extHostLanguageFeatures.registerEvaluatableExpressionProvider(extension, checkSelector(selector), provider, extension.identifier);\n\t\t\t},\n\t\t\tregisterDocumentHighlightProvider(selector: vscode.DocumentSelector, provider: vscode.DocumentHighlightProvider): vscode.Disposable {\n\t\t\t\treturn extHostLanguageFeatures.registerDocumentHighlightProvider(extension, checkSelector(selector), provider);\n\t\t\t},\n\t\t\tregisterLinkedEditingRangeProvider(selector: vscode.DocumentSelector, provider: vscode.LinkedEditingRangeProvider): vscode.Disposable {\n\t\t\t\treturn extHostLanguageFeatures.registerLinkedEditingRangeProvider(extension, checkSelector(selector), provider);\n\t\t\t},\n\t\t\tregisterReferenceProvider(selector: vscode.DocumentSelector, provider: vscode.ReferenceProvider): vscode.Disposable {\n\t\t\t\treturn extHostLanguageFeatures.registerReferenceProvider(extension, checkSelector(selector), provider);\n\t\t\t},\n\t\t\tregisterRenameProvider(selector: vscode.DocumentSelector, provider: vscode.RenameProvider): vscode.Disposable {\n\t\t\t\treturn extHostLanguageFeatures.registerRenameProvider(extension, checkSelector(selector), provider);\n\t\t\t},\n\t\t\tregisterDocumentSymbolProvider(selector: vscode.DocumentSelector, provider: vscode.DocumentSymbolProvider, metadata?: vscode.DocumentSymbolProviderMetadata): vscode.Disposable {\n\t\t\t\treturn extHostLanguageFeatures.registerDocumentSymbolProvider(extension, checkSelector(selector), provider, metadata);\n\t\t\t},\n\t\t\tregisterWorkspaceSymbolProvider(provider: vscode.WorkspaceSymbolProvider): vscode.Disposable {\n\t\t\t\treturn extHostLanguageFeatures.registerWorkspaceSymbolProvider(extension, provider);\n\t\t\t},\n\t\t\tregisterDocumentFormattingEditProvider(selector: vscode.DocumentSelector, provider: vscode.DocumentFormattingEditProvider): vscode.Disposable {\n\t\t\t\treturn extHostLanguageFeatures.registerDocumentFormattingEditProvider(extension, checkSelector(selector), provider);\n\t\t\t},\n\t\t\tregisterDocumentRangeFormattingEditProvider(selector: vscode.DocumentSelector, provider: vscode.DocumentRangeFormattingEditProvider): vscode.Disposable {\n\t\t\t\treturn extHostLanguageFeatures.registerDocumentRangeFormattingEditProvider(extension, checkSelector(selector), provider);\n\t\t\t},\n\t\t\tregisterOnTypeFormattingEditProvider(selector: vscode.DocumentSelector, provider: vscode.OnTypeFormattingEditProvider, firstTriggerCharacter: string, ...moreTriggerCharacters: string[]): vscode.Disposable {\n\t\t\t\treturn extHostLanguageFeatures.registerOnTypeFormattingEditProvider(extension, checkSelector(selector), provider, [firstTriggerCharacter].concat(moreTriggerCharacters));\n\t\t\t},\n\t\t\tregisterDocumentSemanticTokensProvider(selector: vscode.DocumentSelector, provider: vscode.DocumentSemanticTokensProvider, legend: vscode.SemanticTokensLegend): vscode.Disposable {\n\t\t\t\treturn extHostLanguageFeatures.registerDocumentSemanticTokensProvider(extension, checkSelector(selector), provider, legend);\n\t\t\t},\n\t\t\tregisterDocumentRangeSemanticTokensProvider(selector: vscode.DocumentSelector, provider: vscode.DocumentRangeSemanticTokensProvider, legend: vscode.SemanticTokensLegend): vscode.Disposable {\n\t\t\t\treturn extHostLanguageFeatures.registerDocumentRangeSemanticTokensProvider(extension, checkSelector(selector), provider, legend);\n\t\t\t},\n\t\t\tregisterSignatureHelpProvider(selector: vscode.DocumentSelector, provider: vscode.SignatureHelpProvider, firstItem?: string | vscode.SignatureHelpProviderMetadata, ...remaining: string[]): vscode.Disposable {\n\t\t\t\tif (typeof firstItem === 'object') {\n\t\t\t\t\treturn extHostLanguageFeatures.registerSignatureHelpProvider(extension, checkSelector(selector), provider, firstItem);\n\t\t\t\t}\n\t\t\t\treturn extHostLanguageFeatures.registerSignatureHelpProvider(extension, checkSelector(selector), provider, typeof firstItem === 'undefined' ? [] : [firstItem, ...remaining]);\n\t\t\t},\n\t\t\tregisterCompletionItemProvider(selector: vscode.DocumentSelector, provider: vscode.CompletionItemProvider, ...triggerCharacters: string[]): vscode.Disposable {\n\t\t\t\treturn extHostLanguageFeatures.registerCompletionItemProvider(extension, checkSelector(selector), provider, triggerCharacters);\n\t\t\t},\n\t\t\tregisterDocumentLinkProvider(selector: vscode.DocumentSelector, provider: vscode.DocumentLinkProvider): vscode.Disposable {\n\t\t\t\treturn extHostLanguageFeatures.registerDocumentLinkProvider(extension, checkSelector(selector), provider);\n\t\t\t},\n\t\t\tregisterColorProvider(selector: vscode.DocumentSelector, provider: vscode.DocumentColorProvider): vscode.Disposable {\n\t\t\t\treturn extHostLanguageFeatures.registerColorProvider(extension, checkSelector(selector), provider);\n\t\t\t},\n\t\t\tregisterFoldingRangeProvider(selector: vscode.DocumentSelector, provider: vscode.FoldingRangeProvider): vscode.Disposable {\n\t\t\t\treturn extHostLanguageFeatures.registerFoldingRangeProvider(extension, checkSelector(selector), provider);\n\t\t\t},\n\t\t\tregisterSelectionRangeProvider(selector: vscode.DocumentSelector, provider: vscode.SelectionRangeProvider): vscode.Disposable {\n\t\t\t\treturn extHostLanguageFeatures.registerSelectionRangeProvider(extension, selector, provider);\n\t\t\t},\n\t\t\tregisterCallHierarchyProvider(selector: vscode.DocumentSelector, provider: vscode.CallHierarchyProvider): vscode.Disposable {\n\t\t\t\treturn extHostLanguageFeatures.registerCallHierarchyProvider(extension, selector, provider);\n\t\t\t},\n\t\t\tsetLanguageConfiguration: (language: string, configuration: vscode.LanguageConfiguration): vscode.Disposable => {\n\t\t\t\treturn extHostLanguageFeatures.setLanguageConfiguration(extension, language, configuration);\n\t\t\t},\n\t\t\tgetTokenInformationAtPosition(doc: vscode.TextDocument, pos: vscode.Position) {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostLanguages.tokenAtPosition(doc, pos);\n\t\t\t},\n\t\t\tregisterInlineHintsProvider(selector: vscode.DocumentSelector, provider: vscode.InlineHintsProvider): vscode.Disposable {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostLanguageFeatures.registerInlineHintsProvider(extension, selector, provider);\n\t\t\t}\n\t\t};\n\n\t\t// namespace: window\n\t\tconst window: typeof vscode.window = {\n\t\t\tget activeTextEditor() {\n\t\t\t\treturn extHostEditors.getActiveTextEditor();\n\t\t\t},\n\t\t\tget visibleTextEditors() {\n\t\t\t\treturn extHostEditors.getVisibleTextEditors();\n\t\t\t},\n\t\t\tget activeTerminal() {\n\t\t\t\treturn extHostTerminalService.activeTerminal;\n\t\t\t},\n\t\t\tget terminals() {\n\t\t\t\treturn extHostTerminalService.terminals;\n\t\t\t},\n\t\t\tasync showTextDocument(documentOrUri: vscode.TextDocument | vscode.Uri, columnOrOptions?: vscode.ViewColumn | vscode.TextDocumentShowOptions, preserveFocus?: boolean): Promise<vscode.TextEditor> {\n\t\t\t\tconst document = await (URI.isUri(documentOrUri)\n\t\t\t\t\t? Promise.resolve(workspace.openTextDocument(documentOrUri))\n\t\t\t\t\t: Promise.resolve(<vscode.TextDocument>documentOrUri));\n\n\t\t\t\treturn extHostEditors.showTextDocument(document, columnOrOptions, preserveFocus);\n\t\t\t},\n\t\t\tcreateTextEditorDecorationType(options: vscode.DecorationRenderOptions): vscode.TextEditorDecorationType {\n\t\t\t\treturn extHostEditors.createTextEditorDecorationType(options);\n\t\t\t},\n\t\t\tonDidChangeActiveTextEditor(listener, thisArg?, disposables?) {\n\t\t\t\treturn extHostEditors.onDidChangeActiveTextEditor(listener, thisArg, disposables);\n\t\t\t},\n\t\t\tonDidChangeVisibleTextEditors(listener, thisArg, disposables) {\n\t\t\t\treturn extHostEditors.onDidChangeVisibleTextEditors(listener, thisArg, disposables);\n\t\t\t},\n\t\t\tonDidChangeTextEditorSelection(listener: (e: vscode.TextEditorSelectionChangeEvent) => any, thisArgs?: any, disposables?: extHostTypes.Disposable[]) {\n\t\t\t\treturn extHostEditors.onDidChangeTextEditorSelection(listener, thisArgs, disposables);\n\t\t\t},\n\t\t\tonDidChangeTextEditorOptions(listener: (e: vscode.TextEditorOptionsChangeEvent) => any, thisArgs?: any, disposables?: extHostTypes.Disposable[]) {\n\t\t\t\treturn extHostEditors.onDidChangeTextEditorOptions(listener, thisArgs, disposables);\n\t\t\t},\n\t\t\tonDidChangeTextEditorVisibleRanges(listener: (e: vscode.TextEditorVisibleRangesChangeEvent) => any, thisArgs?: any, disposables?: extHostTypes.Disposable[]) {\n\t\t\t\treturn extHostEditors.onDidChangeTextEditorVisibleRanges(listener, thisArgs, disposables);\n\t\t\t},\n\t\t\tonDidChangeTextEditorViewColumn(listener, thisArg?, disposables?) {\n\t\t\t\treturn extHostEditors.onDidChangeTextEditorViewColumn(listener, thisArg, disposables);\n\t\t\t},\n\t\t\tonDidCloseTerminal(listener, thisArg?, disposables?) {\n\t\t\t\treturn extHostTerminalService.onDidCloseTerminal(listener, thisArg, disposables);\n\t\t\t},\n\t\t\tonDidOpenTerminal(listener, thisArg?, disposables?) {\n\t\t\t\treturn extHostTerminalService.onDidOpenTerminal(listener, thisArg, disposables);\n\t\t\t},\n\t\t\tonDidChangeActiveTerminal(listener, thisArg?, disposables?) {\n\t\t\t\treturn extHostTerminalService.onDidChangeActiveTerminal(listener, thisArg, disposables);\n\t\t\t},\n\t\t\tonDidChangeTerminalDimensions(listener, thisArg?, disposables?) {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostTerminalService.onDidChangeTerminalDimensions(listener, thisArg, disposables);\n\t\t\t},\n\t\t\tonDidWriteTerminalData(listener, thisArg?, disposables?) {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostTerminalService.onDidWriteTerminalData(listener, thisArg, disposables);\n\t\t\t},\n\t\t\tget state() {\n\t\t\t\treturn extHostWindow.state;\n\t\t\t},\n\t\t\tonDidChangeWindowState(listener, thisArg?, disposables?) {\n\t\t\t\treturn extHostWindow.onDidChangeWindowState(listener, thisArg, disposables);\n\t\t\t},\n\t\t\tshowInformationMessage(message: string, ...rest: Array<vscode.MessageOptions | string | vscode.MessageItem>) {\n\t\t\t\treturn <Thenable<any>>extHostMessageService.showMessage(extension, Severity.Info, message, rest[0], <Array<string | vscode.MessageItem>>rest.slice(1));\n\t\t\t},\n\t\t\tshowWarningMessage(message: string, ...rest: Array<vscode.MessageOptions | string | vscode.MessageItem>) {\n\t\t\t\treturn <Thenable<any>>extHostMessageService.showMessage(extension, Severity.Warning, message, rest[0], <Array<string | vscode.MessageItem>>rest.slice(1));\n\t\t\t},\n\t\t\tshowErrorMessage(message: string, ...rest: Array<vscode.MessageOptions | string | vscode.MessageItem>) {\n\t\t\t\treturn <Thenable<any>>extHostMessageService.showMessage(extension, Severity.Error, message, rest[0], <Array<string | vscode.MessageItem>>rest.slice(1));\n\t\t\t},\n\t\t\tshowQuickPick(items: any, options?: vscode.QuickPickOptions, token?: vscode.CancellationToken): any {\n\t\t\t\treturn extHostQuickOpen.showQuickPick(items, !!extension.enableProposedApi, options, token);\n\t\t\t},\n\t\t\tshowWorkspaceFolderPick(options?: vscode.WorkspaceFolderPickOptions) {\n\t\t\t\treturn extHostQuickOpen.showWorkspaceFolderPick(options);\n\t\t\t},\n\t\t\tshowInputBox(options?: vscode.InputBoxOptions, token?: vscode.CancellationToken) {\n\t\t\t\treturn extHostQuickOpen.showInput(options, token);\n\t\t\t},\n\t\t\tshowOpenDialog(options) {\n\t\t\t\treturn extHostDialogs.showOpenDialog(options);\n\t\t\t},\n\t\t\tshowSaveDialog(options) {\n\t\t\t\treturn extHostDialogs.showSaveDialog(options);\n\t\t\t},\n\t\t\tcreateStatusBarItem(alignmentOrOptions?: vscode.StatusBarAlignment | vscode.window.StatusBarItemOptions, priority?: number): vscode.StatusBarItem {\n\t\t\t\tlet id: string;\n\t\t\t\tlet name: string;\n\t\t\t\tlet alignment: number | undefined;\n\t\t\t\tlet accessibilityInformation: vscode.AccessibilityInformation | undefined = undefined;\n\n\t\t\t\tif (alignmentOrOptions && typeof alignmentOrOptions !== 'number') {\n\t\t\t\t\tid = alignmentOrOptions.id;\n\t\t\t\t\tname = alignmentOrOptions.name;\n\t\t\t\t\talignment = alignmentOrOptions.alignment;\n\t\t\t\t\tpriority = alignmentOrOptions.priority;\n\t\t\t\t\taccessibilityInformation = alignmentOrOptions.accessibilityInformation;\n\t\t\t\t} else {\n\t\t\t\t\tid = extension.identifier.value;\n\t\t\t\t\tname = nls.localize('extensionLabel', \"{0} (Extension)\", extension.displayName || extension.name);\n\t\t\t\t\talignment = alignmentOrOptions;\n\t\t\t\t}\n\n\t\t\t\treturn extHostStatusBar.createStatusBarEntry(id, name, alignment, priority, accessibilityInformation);\n\t\t\t},\n\t\t\tsetStatusBarMessage(text: string, timeoutOrThenable?: number | Thenable<any>): vscode.Disposable {\n\t\t\t\treturn extHostStatusBar.setStatusBarMessage(text, timeoutOrThenable);\n\t\t\t},\n\t\t\twithScmProgress<R>(task: (progress: vscode.Progress<number>) => Thenable<R>) {\n\t\t\t\textHostApiDeprecation.report('window.withScmProgress', extension,\n\t\t\t\t\t`Use 'withProgress' instead.`);\n\n\t\t\t\treturn extHostProgress.withProgress(extension, { location: extHostTypes.ProgressLocation.SourceControl }, (progress, token) => task({ report(n: number) { /*noop*/ } }));\n\t\t\t},\n\t\t\twithProgress<R>(options: vscode.ProgressOptions, task: (progress: vscode.Progress<{ message?: string; worked?: number }>, token: vscode.CancellationToken) => Thenable<R>) {\n\t\t\t\treturn extHostProgress.withProgress(extension, options, task);\n\t\t\t},\n\t\t\tcreateOutputChannel(name: string): vscode.OutputChannel {\n\t\t\t\treturn extHostOutputService.createOutputChannel(name);\n\t\t\t},\n\t\t\tcreateWebviewPanel(viewType: string, title: string, showOptions: vscode.ViewColumn | { viewColumn: vscode.ViewColumn, preserveFocus?: boolean }, options?: vscode.WebviewPanelOptions & vscode.WebviewOptions): vscode.WebviewPanel {\n\t\t\t\treturn extHostWebviewPanels.createWebviewPanel(extension, viewType, title, showOptions, options);\n\t\t\t},\n\t\t\tcreateWebviewTextEditorInset(editor: vscode.TextEditor, line: number, height: number, options?: vscode.WebviewOptions): vscode.WebviewEditorInset {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostEditorInsets.createWebviewEditorInset(editor, line, height, options, extension);\n\t\t\t},\n\t\t\tcreateTerminal(nameOrOptions?: vscode.TerminalOptions | vscode.ExtensionTerminalOptions | string, shellPath?: string, shellArgs?: string[] | string): vscode.Terminal {\n\t\t\t\tif (typeof nameOrOptions === 'object') {\n\t\t\t\t\tif ('pty' in nameOrOptions) {\n\t\t\t\t\t\treturn extHostTerminalService.createExtensionTerminal(nameOrOptions);\n\t\t\t\t\t}\n\t\t\t\t\treturn extHostTerminalService.createTerminalFromOptions(nameOrOptions);\n\t\t\t\t}\n\t\t\t\treturn extHostTerminalService.createTerminal(nameOrOptions, shellPath, shellArgs);\n\t\t\t},\n\t\t\tregisterTerminalLinkProvider(handler: vscode.TerminalLinkProvider): vscode.Disposable {\n\t\t\t\treturn extHostTerminalService.registerLinkProvider(handler);\n\t\t\t},\n\t\t\tregisterTreeDataProvider(viewId: string, treeDataProvider: vscode.TreeDataProvider<any>): vscode.Disposable {\n\t\t\t\treturn extHostTreeViews.registerTreeDataProvider(viewId, treeDataProvider, extension);\n\t\t\t},\n\t\t\tcreateTreeView(viewId: string, options: { treeDataProvider: vscode.TreeDataProvider<any> }): vscode.TreeView<any> {\n\t\t\t\treturn extHostTreeViews.createTreeView(viewId, options, extension);\n\t\t\t},\n\t\t\tregisterWebviewPanelSerializer: (viewType: string, serializer: vscode.WebviewPanelSerializer) => {\n\t\t\t\treturn extHostWebviewPanels.registerWebviewPanelSerializer(extension, viewType, serializer);\n\t\t\t},\n\t\t\tregisterCustomEditorProvider: (viewType: string, provider: vscode.CustomTextEditorProvider | vscode.CustomReadonlyEditorProvider, options: { webviewOptions?: vscode.WebviewPanelOptions, supportsMultipleEditorsPerDocument?: boolean } = {}) => {\n\t\t\t\treturn extHostCustomEditors.registerCustomEditorProvider(extension, viewType, provider, options);\n\t\t\t},\n\t\t\tregisterFileDecorationProvider(provider: vscode.FileDecorationProvider) {\n\t\t\t\treturn extHostDecorations.registerFileDecorationProvider(provider, extension.identifier);\n\t\t\t},\n\t\t\tregisterUriHandler(handler: vscode.UriHandler) {\n\t\t\t\treturn extHostUrls.registerUriHandler(extension.identifier, handler);\n\t\t\t},\n\t\t\tcreateQuickPick<T extends vscode.QuickPickItem>(): vscode.QuickPick<T> {\n\t\t\t\treturn extHostQuickOpen.createQuickPick(extension.identifier, !!extension.enableProposedApi);\n\t\t\t},\n\t\t\tcreateInputBox(): vscode.InputBox {\n\t\t\t\treturn extHostQuickOpen.createInputBox(extension.identifier);\n\t\t\t},\n\t\t\tget activeColorTheme(): vscode.ColorTheme {\n\t\t\t\treturn extHostTheming.activeColorTheme;\n\t\t\t},\n\t\t\tonDidChangeActiveColorTheme(listener, thisArg?, disposables?) {\n\t\t\t\treturn extHostTheming.onDidChangeActiveColorTheme(listener, thisArg, disposables);\n\t\t\t},\n\t\t\tregisterWebviewViewProvider(viewId: string, provider: vscode.WebviewViewProvider, options?: {\n\t\t\t\twebviewOptions?: {\n\t\t\t\t\tretainContextWhenHidden?: boolean\n\t\t\t\t}\n\t\t\t}) {\n\t\t\t\treturn extHostWebviewViews.registerWebviewViewProvider(extension, viewId, provider, options?.webviewOptions);\n\t\t\t},\n\t\t\tget activeNotebookEditor(): vscode.NotebookEditor | undefined {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostNotebook.activeNotebookEditor;\n\t\t\t},\n\t\t\tonDidChangeActiveNotebookEditor(listener, thisArgs?, disposables?) {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostNotebook.onDidChangeActiveNotebookEditor(listener, thisArgs, disposables);\n\t\t\t},\n\t\t\tget visibleNotebookEditors() {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostNotebook.visibleNotebookEditors;\n\t\t\t},\n\t\t\tget onDidChangeVisibleNotebookEditors() {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostNotebook.onDidChangeVisibleNotebookEditors;\n\t\t\t},\n\t\t\tonDidChangeNotebookEditorSelection(listener, thisArgs?, disposables?) {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostNotebook.onDidChangeNotebookEditorSelection(listener, thisArgs, disposables);\n\t\t\t},\n\t\t\tonDidChangeNotebookEditorVisibleRanges(listener, thisArgs?, disposables?) {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostNotebook.onDidChangeNotebookEditorVisibleRanges(listener, thisArgs, disposables);\n\t\t\t},\n\t\t\tshowNotebookDocument(document, options?) {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostNotebook.showNotebookDocument(document, options);\n\t\t\t},\n\t\t\tregisterExternalUriOpener(id: string, opener: vscode.ExternalUriOpener, metadata: vscode.ExternalUriOpenerMetadata) {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostUriOpeners.registerExternalUriOpener(extension.identifier, id, opener, metadata);\n\t\t\t},\n\t\t\tget openEditors() {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostEditorTabs.tabs;\n\t\t\t},\n\t\t\tget onDidChangeOpenEditors() {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostEditorTabs.onDidChangeTabs;\n\t\t\t}\n\t\t};\n\n\t\t// namespace: workspace\n\n\t\tconst workspace: typeof vscode.workspace = {\n\t\t\tget rootPath() {\n\t\t\t\textHostApiDeprecation.report('workspace.rootPath', extension,\n\t\t\t\t\t`Please use 'workspace.workspaceFolders' instead. More details: https://aka.ms/vscode-eliminating-rootpath`);\n\n\t\t\t\treturn extHostWorkspace.getPath();\n\t\t\t},\n\t\t\tset rootPath(value) {\n\t\t\t\tthrow errors.readonly();\n\t\t\t},\n\t\t\tgetWorkspaceFolder(resource) {\n\t\t\t\treturn extHostWorkspace.getWorkspaceFolder(resource);\n\t\t\t},\n\t\t\tget workspaceFolders() {\n\t\t\t\treturn extHostWorkspace.getWorkspaceFolders();\n\t\t\t},\n\t\t\tget name() {\n\t\t\t\treturn extHostWorkspace.name;\n\t\t\t},\n\t\t\tset name(value) {\n\t\t\t\tthrow errors.readonly();\n\t\t\t},\n\t\t\tget workspaceFile() {\n\t\t\t\treturn extHostWorkspace.workspaceFile;\n\t\t\t},\n\t\t\tset workspaceFile(value) {\n\t\t\t\tthrow errors.readonly();\n\t\t\t},\n\t\t\tupdateWorkspaceFolders: (index, deleteCount, ...workspaceFoldersToAdd) => {\n\t\t\t\treturn extHostWorkspace.updateWorkspaceFolders(extension, index, deleteCount || 0, ...workspaceFoldersToAdd);\n\t\t\t},\n\t\t\tonDidChangeWorkspaceFolders: function (listener, thisArgs?, disposables?) {\n\t\t\t\treturn extHostWorkspace.onDidChangeWorkspace(listener, thisArgs, disposables);\n\t\t\t},\n\t\t\tasRelativePath: (pathOrUri, includeWorkspace?) => {\n\t\t\t\treturn extHostWorkspace.getRelativePath(pathOrUri, includeWorkspace);\n\t\t\t},\n\t\t\tfindFiles: (include, exclude, maxResults?, token?) => {\n\t\t\t\t// Note, undefined/null have different meanings on \"exclude\"\n\t\t\t\treturn extHostWorkspace.findFiles(typeConverters.GlobPattern.from(include), typeConverters.GlobPattern.from(exclude), maxResults, extension.identifier, token);\n\t\t\t},\n\t\t\tfindTextInFiles: (query: vscode.TextSearchQuery, optionsOrCallback: vscode.FindTextInFilesOptions | ((result: vscode.TextSearchResult) => void), callbackOrToken?: vscode.CancellationToken | ((result: vscode.TextSearchResult) => void), token?: vscode.CancellationToken) => {\n\t\t\t\tlet options: vscode.FindTextInFilesOptions;\n\t\t\t\tlet callback: (result: vscode.TextSearchResult) => void;\n\n\t\t\t\tif (typeof optionsOrCallback === 'object') {\n\t\t\t\t\toptions = optionsOrCallback;\n\t\t\t\t\tcallback = callbackOrToken as (result: vscode.TextSearchResult) => void;\n\t\t\t\t} else {\n\t\t\t\t\toptions = {};\n\t\t\t\t\tcallback = optionsOrCallback;\n\t\t\t\t\ttoken = callbackOrToken as vscode.CancellationToken;\n\t\t\t\t}\n\n\t\t\t\treturn extHostWorkspace.findTextInFiles(query, options || {}, callback, extension.identifier, token);\n\t\t\t},\n\t\t\tsaveAll: (includeUntitled?) => {\n\t\t\t\treturn extHostWorkspace.saveAll(includeUntitled);\n\t\t\t},\n\t\t\tapplyEdit(edit: vscode.WorkspaceEdit): Thenable<boolean> {\n\t\t\t\treturn extHostBulkEdits.applyWorkspaceEdit(edit);\n\t\t\t},\n\t\t\tcreateFileSystemWatcher: (pattern, ignoreCreate, ignoreChange, ignoreDelete): vscode.FileSystemWatcher => {\n\t\t\t\treturn extHostFileSystemEvent.createFileSystemWatcher(typeConverters.GlobPattern.from(pattern), ignoreCreate, ignoreChange, ignoreDelete);\n\t\t\t},\n\t\t\tget textDocuments() {\n\t\t\t\treturn extHostDocuments.getAllDocumentData().map(data => data.document);\n\t\t\t},\n\t\t\tset textDocuments(value) {\n\t\t\t\tthrow errors.readonly();\n\t\t\t},\n\t\t\topenTextDocument(uriOrFileNameOrOptions?: vscode.Uri | string | { language?: string; content?: string; }) {\n\t\t\t\tlet uriPromise: Thenable<URI>;\n\n\t\t\t\tconst options = uriOrFileNameOrOptions as { language?: string; content?: string; };\n\t\t\t\tif (typeof uriOrFileNameOrOptions === 'string') {\n\t\t\t\t\turiPromise = Promise.resolve(URI.file(uriOrFileNameOrOptions));\n\t\t\t\t} else if (URI.isUri(uriOrFileNameOrOptions)) {\n\t\t\t\t\turiPromise = Promise.resolve(uriOrFileNameOrOptions);\n\t\t\t\t} else if (!options || typeof options === 'object') {\n\t\t\t\t\turiPromise = extHostDocuments.createDocumentData(options);\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error('illegal argument - uriOrFileNameOrOptions');\n\t\t\t\t}\n\n\t\t\t\treturn uriPromise.then(uri => {\n\t\t\t\t\treturn extHostDocuments.ensureDocumentData(uri).then(documentData => {\n\t\t\t\t\t\treturn documentData.document;\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t},\n\t\t\tonDidOpenTextDocument: (listener, thisArgs?, disposables?) => {\n\t\t\t\treturn extHostDocuments.onDidAddDocument(listener, thisArgs, disposables);\n\t\t\t},\n\t\t\tonDidCloseTextDocument: (listener, thisArgs?, disposables?) => {\n\t\t\t\treturn extHostDocuments.onDidRemoveDocument(listener, thisArgs, disposables);\n\t\t\t},\n\t\t\tonDidChangeTextDocument: (listener, thisArgs?, disposables?) => {\n\t\t\t\treturn extHostDocuments.onDidChangeDocument(listener, thisArgs, disposables);\n\t\t\t},\n\t\t\tonDidSaveTextDocument: (listener, thisArgs?, disposables?) => {\n\t\t\t\treturn extHostDocuments.onDidSaveDocument(listener, thisArgs, disposables);\n\t\t\t},\n\t\t\tonWillSaveTextDocument: (listener, thisArgs?, disposables?) => {\n\t\t\t\treturn extHostDocumentSaveParticipant.getOnWillSaveTextDocumentEvent(extension)(listener, thisArgs, disposables);\n\t\t\t},\n\t\t\tonDidChangeConfiguration: (listener: (_: any) => any, thisArgs?: any, disposables?: extHostTypes.Disposable[]) => {\n\t\t\t\treturn configProvider.onDidChangeConfiguration(listener, thisArgs, disposables);\n\t\t\t},\n\t\t\tgetConfiguration(section?: string, scope?: vscode.ConfigurationScope | null): vscode.WorkspaceConfiguration {\n\t\t\t\tscope = arguments.length === 1 ? undefined : scope;\n\t\t\t\treturn configProvider.getConfiguration(section, scope, extension);\n\t\t\t},\n\t\t\tregisterTextDocumentContentProvider(scheme: string, provider: vscode.TextDocumentContentProvider) {\n\t\t\t\treturn extHostDocumentContentProviders.registerTextDocumentContentProvider(scheme, provider);\n\t\t\t},\n\t\t\tregisterTaskProvider: (type: string, provider: vscode.TaskProvider) => {\n\t\t\t\textHostApiDeprecation.report('window.registerTaskProvider', extension,\n\t\t\t\t\t`Use the corresponding function on the 'tasks' namespace instead`);\n\n\t\t\t\treturn extHostTask.registerTaskProvider(extension, type, provider);\n\t\t\t},\n\t\t\tregisterFileSystemProvider(scheme, provider, options) {\n\t\t\t\treturn extHostFileSystem.registerFileSystemProvider(extension.identifier, scheme, provider, options);\n\t\t\t},\n\t\t\tget fs() {\n\t\t\t\treturn extHostConsumerFileSystem;\n\t\t\t},\n\t\t\tregisterFileSearchProvider: (scheme: string, provider: vscode.FileSearchProvider) => {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostSearch.registerFileSearchProvider(scheme, provider);\n\t\t\t},\n\t\t\tregisterTextSearchProvider: (scheme: string, provider: vscode.TextSearchProvider) => {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostSearch.registerTextSearchProvider(scheme, provider);\n\t\t\t},\n\t\t\tregisterRemoteAuthorityResolver: (authorityPrefix: string, resolver: vscode.RemoteAuthorityResolver) => {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extensionService.registerRemoteAuthorityResolver(authorityPrefix, resolver);\n\t\t\t},\n\t\t\tregisterResourceLabelFormatter: (formatter: vscode.ResourceLabelFormatter) => {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostLabelService.$registerResourceLabelFormatter(formatter);\n\t\t\t},\n\t\t\tonDidCreateFiles: (listener, thisArg, disposables) => {\n\t\t\t\treturn extHostFileSystemEvent.onDidCreateFile(listener, thisArg, disposables);\n\t\t\t},\n\t\t\tonDidDeleteFiles: (listener, thisArg, disposables) => {\n\t\t\t\treturn extHostFileSystemEvent.onDidDeleteFile(listener, thisArg, disposables);\n\t\t\t},\n\t\t\tonDidRenameFiles: (listener, thisArg, disposables) => {\n\t\t\t\treturn extHostFileSystemEvent.onDidRenameFile(listener, thisArg, disposables);\n\t\t\t},\n\t\t\tonWillCreateFiles: (listener: (e: vscode.FileWillCreateEvent) => any, thisArg?: any, disposables?: vscode.Disposable[]) => {\n\t\t\t\treturn extHostFileSystemEvent.getOnWillCreateFileEvent(extension)(listener, thisArg, disposables);\n\t\t\t},\n\t\t\tonWillDeleteFiles: (listener: (e: vscode.FileWillDeleteEvent) => any, thisArg?: any, disposables?: vscode.Disposable[]) => {\n\t\t\t\treturn extHostFileSystemEvent.getOnWillDeleteFileEvent(extension)(listener, thisArg, disposables);\n\t\t\t},\n\t\t\tonWillRenameFiles: (listener: (e: vscode.FileWillRenameEvent) => any, thisArg?: any, disposables?: vscode.Disposable[]) => {\n\t\t\t\treturn extHostFileSystemEvent.getOnWillRenameFileEvent(extension)(listener, thisArg, disposables);\n\t\t\t},\n\t\t\topenTunnel: (forward: vscode.TunnelOptions) => {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostTunnelService.openTunnel(extension, forward).then(value => {\n\t\t\t\t\tif (!value) {\n\t\t\t\t\t\tthrow new Error('cannot open tunnel');\n\t\t\t\t\t}\n\t\t\t\t\treturn value;\n\t\t\t\t});\n\t\t\t},\n\t\t\tget tunnels() {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostTunnelService.getTunnels();\n\t\t\t},\n\t\t\tonDidChangeTunnels: (listener, thisArg?, disposables?) => {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostTunnelService.onDidChangeTunnels(listener, thisArg, disposables);\n\n\t\t\t},\n\t\t\tregisterTimelineProvider: (scheme: string | string[], provider: vscode.TimelineProvider) => {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostTimeline.registerTimelineProvider(scheme, provider, extension.identifier, extHostCommands.converter);\n\t\t\t}\n\t\t};\n\n\t\t// namespace: scm\n\t\tconst scm: typeof vscode.scm = {\n\t\t\tget inputBox() {\n\t\t\t\textHostApiDeprecation.report('scm.inputBox', extension,\n\t\t\t\t\t`Use 'SourceControl.inputBox' instead`);\n\n\t\t\t\treturn extHostSCM.getLastInputBox(extension)!; // Strict null override - Deprecated api\n\t\t\t},\n\t\t\tcreateSourceControl(id: string, label: string, rootUri?: vscode.Uri) {\n\t\t\t\treturn extHostSCM.createSourceControl(extension, id, label, rootUri);\n\t\t\t}\n\t\t};\n\n\t\t// namespace: comments\n\t\tconst comments: typeof vscode.comments = {\n\t\t\tcreateCommentController(id: string, label: string) {\n\t\t\t\treturn extHostComment.createCommentController(extension, id, label);\n\t\t\t}\n\t\t};\n\n\t\t// namespace: debug\n\t\tconst debug: typeof vscode.debug = {\n\t\t\tget activeDebugSession() {\n\t\t\t\treturn extHostDebugService.activeDebugSession;\n\t\t\t},\n\t\t\tget activeDebugConsole() {\n\t\t\t\treturn extHostDebugService.activeDebugConsole;\n\t\t\t},\n\t\t\tget breakpoints() {\n\t\t\t\treturn extHostDebugService.breakpoints;\n\t\t\t},\n\t\t\tonDidStartDebugSession(listener, thisArg?, disposables?) {\n\t\t\t\treturn extHostDebugService.onDidStartDebugSession(listener, thisArg, disposables);\n\t\t\t},\n\t\t\tonDidTerminateDebugSession(listener, thisArg?, disposables?) {\n\t\t\t\treturn extHostDebugService.onDidTerminateDebugSession(listener, thisArg, disposables);\n\t\t\t},\n\t\t\tonDidChangeActiveDebugSession(listener, thisArg?, disposables?) {\n\t\t\t\treturn extHostDebugService.onDidChangeActiveDebugSession(listener, thisArg, disposables);\n\t\t\t},\n\t\t\tonDidReceiveDebugSessionCustomEvent(listener, thisArg?, disposables?) {\n\t\t\t\treturn extHostDebugService.onDidReceiveDebugSessionCustomEvent(listener, thisArg, disposables);\n\t\t\t},\n\t\t\tonDidChangeBreakpoints(listener, thisArgs?, disposables?) {\n\t\t\t\treturn extHostDebugService.onDidChangeBreakpoints(listener, thisArgs, disposables);\n\t\t\t},\n\t\t\tregisterDebugConfigurationProvider(debugType: string, provider: vscode.DebugConfigurationProvider, triggerKind?: vscode.DebugConfigurationProviderTriggerKind) {\n\t\t\t\treturn extHostDebugService.registerDebugConfigurationProvider(debugType, provider, triggerKind || extHostTypes.DebugConfigurationProviderTriggerKind.Initial);\n\t\t\t},\n\t\t\tregisterDebugAdapterDescriptorFactory(debugType: string, factory: vscode.DebugAdapterDescriptorFactory) {\n\t\t\t\treturn extHostDebugService.registerDebugAdapterDescriptorFactory(extension, debugType, factory);\n\t\t\t},\n\t\t\tregisterDebugAdapterTrackerFactory(debugType: string, factory: vscode.DebugAdapterTrackerFactory) {\n\t\t\t\treturn extHostDebugService.registerDebugAdapterTrackerFactory(debugType, factory);\n\t\t\t},\n\t\t\tstartDebugging(folder: vscode.WorkspaceFolder | undefined, nameOrConfig: string | vscode.DebugConfiguration, parentSessionOrOptions?: vscode.DebugSession | vscode.DebugSessionOptions) {\n\t\t\t\tif (!parentSessionOrOptions || (typeof parentSessionOrOptions === 'object' && 'configuration' in parentSessionOrOptions)) {\n\t\t\t\t\treturn extHostDebugService.startDebugging(folder, nameOrConfig, { parentSession: parentSessionOrOptions });\n\t\t\t\t}\n\t\t\t\treturn extHostDebugService.startDebugging(folder, nameOrConfig, parentSessionOrOptions || {});\n\t\t\t},\n\t\t\tstopDebugging(session?: vscode.DebugSession) {\n\t\t\t\treturn extHostDebugService.stopDebugging(session);\n\t\t\t},\n\t\t\taddBreakpoints(breakpoints: vscode.Breakpoint[]) {\n\t\t\t\treturn extHostDebugService.addBreakpoints(breakpoints);\n\t\t\t},\n\t\t\tremoveBreakpoints(breakpoints: vscode.Breakpoint[]) {\n\t\t\t\treturn extHostDebugService.removeBreakpoints(breakpoints);\n\t\t\t},\n\t\t\tasDebugSourceUri(source: vscode.DebugProtocolSource, session?: vscode.DebugSession): vscode.Uri {\n\t\t\t\treturn extHostDebugService.asDebugSourceUri(source, session);\n\t\t\t}\n\t\t};\n\n\t\tconst tasks: typeof vscode.tasks = {\n\t\t\tregisterTaskProvider: (type: string, provider: vscode.TaskProvider) => {\n\t\t\t\treturn extHostTask.registerTaskProvider(extension, type, provider);\n\t\t\t},\n\t\t\tfetchTasks: (filter?: vscode.TaskFilter): Thenable<vscode.Task[]> => {\n\t\t\t\treturn extHostTask.fetchTasks(filter);\n\t\t\t},\n\t\t\texecuteTask: (task: vscode.Task): Thenable<vscode.TaskExecution> => {\n\t\t\t\treturn extHostTask.executeTask(extension, task);\n\t\t\t},\n\t\t\tget taskExecutions(): vscode.TaskExecution[] {\n\t\t\t\treturn extHostTask.taskExecutions;\n\t\t\t},\n\t\t\tonDidStartTask: (listeners, thisArgs?, disposables?) => {\n\t\t\t\treturn extHostTask.onDidStartTask(listeners, thisArgs, disposables);\n\t\t\t},\n\t\t\tonDidEndTask: (listeners, thisArgs?, disposables?) => {\n\t\t\t\treturn extHostTask.onDidEndTask(listeners, thisArgs, disposables);\n\t\t\t},\n\t\t\tonDidStartTaskProcess: (listeners, thisArgs?, disposables?) => {\n\t\t\t\treturn extHostTask.onDidStartTaskProcess(listeners, thisArgs, disposables);\n\t\t\t},\n\t\t\tonDidEndTaskProcess: (listeners, thisArgs?, disposables?) => {\n\t\t\t\treturn extHostTask.onDidEndTaskProcess(listeners, thisArgs, disposables);\n\t\t\t}\n\t\t};\n\n\t\t// namespace: notebook\n\t\tconst notebook: (typeof vscode.notebook & {\n\t\t\t// to ensure that notebook extensions not break before they update APIs.\n\t\t\tvisibleNotebookEditors: vscode.NotebookEditor[];\n\t\t\tonDidChangeVisibleNotebookEditors: Event<vscode.NotebookEditor[]>;\n\t\t\tactiveNotebookEditor: vscode.NotebookEditor | undefined;\n\t\t\tonDidChangeActiveNotebookEditor: Event<vscode.NotebookEditor | undefined>;\n\t\t\tonDidChangeNotebookEditorSelection: Event<vscode.NotebookEditorSelectionChangeEvent>;\n\t\t\tonDidChangeNotebookEditorVisibleRanges: Event<vscode.NotebookEditorVisibleRangesChangeEvent>;\n\t\t}) = {\n\t\t\topenNotebookDocument: (uriComponents, viewType) => {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostNotebook.openNotebookDocument(uriComponents, viewType);\n\t\t\t},\n\t\t\tget onDidOpenNotebookDocument(): Event<vscode.NotebookDocument> {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostNotebook.onDidOpenNotebookDocument;\n\t\t\t},\n\t\t\tget onDidCloseNotebookDocument(): Event<vscode.NotebookDocument> {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostNotebook.onDidCloseNotebookDocument;\n\t\t\t},\n\t\t\tget onDidSaveNotebookDocument(): Event<vscode.NotebookDocument> {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostNotebook.onDidSaveNotebookDocument;\n\t\t\t},\n\t\t\tget notebookDocuments(): vscode.NotebookDocument[] {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostNotebook.notebookDocuments.map(d => d.notebookDocument);\n\t\t\t},\n\t\t\tget visibleNotebookEditors(): vscode.NotebookEditor[] {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostNotebook.visibleNotebookEditors;\n\t\t\t},\n\t\t\tget onDidChangeVisibleNotebookEditors() {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostNotebook.onDidChangeVisibleNotebookEditors;\n\t\t\t},\n\t\t\tget onDidChangeActiveNotebookKernel() {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostNotebook.onDidChangeActiveNotebookKernel;\n\t\t\t},\n\t\t\tregisterNotebookContentProvider: (viewType: string, provider: vscode.NotebookContentProvider, options?: {\n\t\t\t\ttransientOutputs: boolean;\n\t\t\t\ttransientMetadata: { [K in keyof vscode.NotebookCellMetadata]?: boolean }\n\t\t\t}) => {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostNotebook.registerNotebookContentProvider(extension, viewType, provider, options);\n\t\t\t},\n\t\t\tregisterNotebookKernelProvider: (selector: vscode.NotebookDocumentFilter, provider: vscode.NotebookKernelProvider) => {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostNotebook.registerNotebookKernelProvider(extension, selector, provider);\n\t\t\t},\n\t\t\tcreateNotebookEditorDecorationType(options: vscode.NotebookDecorationRenderOptions): vscode.NotebookEditorDecorationType {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostNotebook.createNotebookEditorDecorationType(options);\n\t\t\t},\n\t\t\tget activeNotebookEditor(): vscode.NotebookEditor | undefined {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostNotebook.activeNotebookEditor;\n\t\t\t},\n\t\t\tonDidChangeActiveNotebookEditor(listener, thisArgs?, disposables?) {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostNotebook.onDidChangeActiveNotebookEditor(listener, thisArgs, disposables);\n\t\t\t},\n\t\t\tonDidChangeNotebookDocumentMetadata(listener, thisArgs?, disposables?) {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostNotebook.onDidChangeNotebookDocumentMetadata(listener, thisArgs, disposables);\n\t\t\t},\n\t\t\tonDidChangeNotebookCells(listener, thisArgs?, disposables?) {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostNotebook.onDidChangeNotebookCells(listener, thisArgs, disposables);\n\t\t\t},\n\t\t\tonDidChangeNotebookEditorSelection(listener, thisArgs?, disposables?) {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostNotebook.onDidChangeNotebookEditorSelection(listener, thisArgs, disposables);\n\t\t\t},\n\t\t\tonDidChangeNotebookEditorVisibleRanges(listener, thisArgs?, disposables?) {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostNotebook.onDidChangeNotebookEditorVisibleRanges(listener, thisArgs, disposables);\n\t\t\t},\n\t\t\tonDidChangeCellOutputs(listener, thisArgs?, disposables?) {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostNotebook.onDidChangeCellOutputs(listener, thisArgs, disposables);\n\t\t\t},\n\t\t\tonDidChangeCellLanguage(listener, thisArgs?, disposables?) {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostNotebook.onDidChangeCellLanguage(listener, thisArgs, disposables);\n\t\t\t},\n\t\t\tonDidChangeCellMetadata(listener, thisArgs?, disposables?) {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostNotebook.onDidChangeCellMetadata(listener, thisArgs, disposables);\n\t\t\t},\n\t\t\tcreateConcatTextDocument(notebook, selector) {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn new ExtHostNotebookConcatDocument(extHostNotebook, extHostDocuments, notebook, selector);\n\t\t\t},\n\t\t\tcreateCellStatusBarItem(cell: vscode.NotebookCell, alignment?: vscode.NotebookCellStatusBarAlignment, priority?: number): vscode.NotebookCellStatusBarItem {\n\t\t\t\tcheckProposedApiEnabled(extension);\n\t\t\t\treturn extHostNotebook.createNotebookCellStatusBarItemInternal(cell, alignment, priority);\n\t\t\t}\n\t\t};\n\n\t\treturn <typeof vscode>{\n\t\t\tversion: initData.version,\n\t\t\t// namespaces\n\t\t\tauthentication,\n\t\t\tcommands,\n\t\t\tcomments,\n\t\t\tdebug,\n\t\t\tenv,\n\t\t\textensions,\n\t\t\tlanguages,\n\t\t\tnotebook,\n\t\t\tscm,\n\t\t\ttasks,\n\t\t\ttest,\n\t\t\twindow,\n\t\t\tworkspace,\n\t\t\t// types\n\t\t\tBreakpoint: extHostTypes.Breakpoint,\n\t\t\tCallHierarchyIncomingCall: extHostTypes.CallHierarchyIncomingCall,\n\t\t\tCallHierarchyItem: extHostTypes.CallHierarchyItem,\n\t\t\tCallHierarchyOutgoingCall: extHostTypes.CallHierarchyOutgoingCall,\n\t\t\tCancellationError: errors.CancellationError,\n\t\t\tCancellationTokenSource: CancellationTokenSource,\n\t\t\tCodeAction: extHostTypes.CodeAction,\n\t\t\tCodeActionKind: extHostTypes.CodeActionKind,\n\t\t\tCodeActionTrigger: extHostTypes.CodeActionTrigger,\n\t\t\tCodeLens: extHostTypes.CodeLens,\n\t\t\tColor: extHostTypes.Color,\n\t\t\tColorInformation: extHostTypes.ColorInformation,\n\t\t\tColorPresentation: extHostTypes.ColorPresentation,\n\t\t\tColorThemeKind: extHostTypes.ColorThemeKind,\n\t\t\tCommentMode: extHostTypes.CommentMode,\n\t\t\tCommentThreadCollapsibleState: extHostTypes.CommentThreadCollapsibleState,\n\t\t\tCompletionItem: extHostTypes.CompletionItem,\n\t\t\tCompletionItemKind: extHostTypes.CompletionItemKind,\n\t\t\tCompletionItemTag: extHostTypes.CompletionItemTag,\n\t\t\tCompletionList: extHostTypes.CompletionList,\n\t\t\tCompletionTriggerKind: extHostTypes.CompletionTriggerKind,\n\t\t\tConfigurationTarget: extHostTypes.ConfigurationTarget,\n\t\t\tCustomExecution: extHostTypes.CustomExecution,\n\t\t\tDebugAdapterExecutable: extHostTypes.DebugAdapterExecutable,\n\t\t\tDebugAdapterInlineImplementation: extHostTypes.DebugAdapterInlineImplementation,\n\t\t\tDebugAdapterNamedPipeServer: extHostTypes.DebugAdapterNamedPipeServer,\n\t\t\tDebugAdapterServer: extHostTypes.DebugAdapterServer,\n\t\t\tDebugConfigurationProviderTriggerKind: extHostTypes.DebugConfigurationProviderTriggerKind,\n\t\t\tDebugConsoleMode: extHostTypes.DebugConsoleMode,\n\t\t\tDecorationRangeBehavior: extHostTypes.DecorationRangeBehavior,\n\t\t\tDiagnostic: extHostTypes.Diagnostic,\n\t\t\tDiagnosticRelatedInformation: extHostTypes.DiagnosticRelatedInformation,\n\t\t\tDiagnosticSeverity: extHostTypes.DiagnosticSeverity,\n\t\t\tDiagnosticTag: extHostTypes.DiagnosticTag,\n\t\t\tDisposable: extHostTypes.Disposable,\n\t\t\tDocumentHighlight: extHostTypes.DocumentHighlight,\n\t\t\tDocumentHighlightKind: extHostTypes.DocumentHighlightKind,\n\t\t\tDocumentLink: extHostTypes.DocumentLink,\n\t\t\tDocumentSymbol: extHostTypes.DocumentSymbol,\n\t\t\tEndOfLine: extHostTypes.EndOfLine,\n\t\t\tEnvironmentVariableMutatorType: extHostTypes.EnvironmentVariableMutatorType,\n\t\t\tEvaluatableExpression: extHostTypes.EvaluatableExpression,\n\t\t\tEventEmitter: Emitter,\n\t\t\tExtensionKind: extHostTypes.ExtensionKind,\n\t\t\tExtensionMode: extHostTypes.ExtensionMode,\n\t\t\tExternalUriOpenerPriority: extHostTypes.ExternalUriOpenerPriority,\n\t\t\tFileChangeType: extHostTypes.FileChangeType,\n\t\t\tFileDecoration: extHostTypes.FileDecoration,\n\t\t\tFileSystemError: extHostTypes.FileSystemError,\n\t\t\tFileType: files.FileType,\n\t\t\tFoldingRange: extHostTypes.FoldingRange,\n\t\t\tFoldingRangeKind: extHostTypes.FoldingRangeKind,\n\t\t\tFunctionBreakpoint: extHostTypes.FunctionBreakpoint,\n\t\t\tHover: extHostTypes.Hover,\n\t\t\tIndentAction: languageConfiguration.IndentAction,\n\t\t\tInlineHint: extHostTypes.InlineHint,\n\t\t\tLocation: extHostTypes.Location,\n\t\t\tMarkdownString: extHostTypes.MarkdownString,\n\t\t\tOverviewRulerLane: OverviewRulerLane,\n\t\t\tParameterInformation: extHostTypes.ParameterInformation,\n\t\t\tPosition: extHostTypes.Position,\n\t\t\tProcessExecution: extHostTypes.ProcessExecution,\n\t\t\tProgressLocation: extHostTypes.ProgressLocation,\n\t\t\tQuickInputButtons: extHostTypes.QuickInputButtons,\n\t\t\tRange: extHostTypes.Range,\n\t\t\tRelativePattern: extHostTypes.RelativePattern,\n\t\t\tSelection: extHostTypes.Selection,\n\t\t\tSelectionRange: extHostTypes.SelectionRange,\n\t\t\tSemanticTokens: extHostTypes.SemanticTokens,\n\t\t\tSemanticTokensBuilder: extHostTypes.SemanticTokensBuilder,\n\t\t\tSemanticTokensEdit: extHostTypes.SemanticTokensEdit,\n\t\t\tSemanticTokensEdits: extHostTypes.SemanticTokensEdits,\n\t\t\tSemanticTokensLegend: extHostTypes.SemanticTokensLegend,\n\t\t\tShellExecution: extHostTypes.ShellExecution,\n\t\t\tShellQuoting: extHostTypes.ShellQuoting,\n\t\t\tSignatureHelp: extHostTypes.SignatureHelp,\n\t\t\tSignatureHelpTriggerKind: extHostTypes.SignatureHelpTriggerKind,\n\t\t\tSignatureInformation: extHostTypes.SignatureInformation,\n\t\t\tSnippetString: extHostTypes.SnippetString,\n\t\t\tSourceBreakpoint: extHostTypes.SourceBreakpoint,\n\t\t\tStandardTokenType: extHostTypes.StandardTokenType,\n\t\t\tStatusBarAlignment: extHostTypes.StatusBarAlignment,\n\t\t\tSymbolInformation: extHostTypes.SymbolInformation,\n\t\t\tSymbolKind: extHostTypes.SymbolKind,\n\t\t\tSymbolTag: extHostTypes.SymbolTag,\n\t\t\tTask: extHostTypes.Task,\n\t\t\tTaskGroup: extHostTypes.TaskGroup,\n\t\t\tTaskPanelKind: extHostTypes.TaskPanelKind,\n\t\t\tTaskRevealKind: extHostTypes.TaskRevealKind,\n\t\t\tTaskScope: extHostTypes.TaskScope,\n\t\t\tTextDocumentSaveReason: extHostTypes.TextDocumentSaveReason,\n\t\t\tTextEdit: extHostTypes.TextEdit,\n\t\t\tTextEditorCursorStyle: TextEditorCursorStyle,\n\t\t\tTextEditorLineNumbersStyle: extHostTypes.TextEditorLineNumbersStyle,\n\t\t\tTextEditorRevealType: extHostTypes.TextEditorRevealType,\n\t\t\tTextEditorSelectionChangeKind: extHostTypes.TextEditorSelectionChangeKind,\n\t\t\tThemeColor: extHostTypes.ThemeColor,\n\t\t\tThemeIcon: extHostTypes.ThemeIcon,\n\t\t\tTreeItem: extHostTypes.TreeItem,\n\t\t\tTreeItemCollapsibleState: extHostTypes.TreeItemCollapsibleState,\n\t\t\tUIKind: UIKind,\n\t\t\tUri: URI,\n\t\t\tViewColumn: extHostTypes.ViewColumn,\n\t\t\tWorkspaceEdit: extHostTypes.WorkspaceEdit,\n\t\t\t// proposed api types\n\t\t\tget RemoteAuthorityResolverError() {\n\t\t\t\t// checkProposedApiEnabled(extension);\n\t\t\t\treturn extHostTypes.RemoteAuthorityResolverError;\n\t\t\t},\n\t\t\tget ResolvedAuthority() {\n\t\t\t\t// checkProposedApiEnabled(extension);\n\t\t\t\treturn extHostTypes.ResolvedAuthority;\n\t\t\t},\n\t\t\tget SourceControlInputBoxValidationType() {\n\t\t\t\t// checkProposedApiEnabled(extension);\n\t\t\t\treturn extHostTypes.SourceControlInputBoxValidationType;\n\t\t\t},\n\t\t\tget ExtensionRuntime() {\n\t\t\t\t// checkProposedApiEnabled(extension);\n\t\t\t\treturn extHostTypes.ExtensionRuntime;\n\t\t\t},\n\t\t\tget TimelineItem() {\n\t\t\t\t// checkProposedApiEnabled(extension);\n\t\t\t\treturn extHostTypes.TimelineItem;\n\t\t\t},\n\t\t\tget CellKind() {\n\t\t\t\t// checkProposedApiEnabled(extension);\n\t\t\t\treturn extHostTypes.CellKind;\n\t\t\t},\n\t\t\tget CellOutputKind() {\n\t\t\t\t// checkProposedApiEnabled(extension);\n\t\t\t\treturn extHostTypes.CellOutputKind;\n\t\t\t},\n\t\t\tget NotebookCellRunState() {\n\t\t\t\t// checkProposedApiEnabled(extension);\n\t\t\t\treturn extHostTypes.NotebookCellRunState;\n\t\t\t},\n\t\t\tget NotebookRunState() {\n\t\t\t\t// checkProposedApiEnabled(extension);\n\t\t\t\treturn extHostTypes.NotebookRunState;\n\t\t\t},\n\t\t\tget NotebookCellStatusBarAlignment() {\n\t\t\t\t// checkProposedApiEnabled(extension);\n\t\t\t\treturn extHostTypes.NotebookCellStatusBarAlignment;\n\t\t\t},\n\t\t\tget NotebookEditorRevealType() {\n\t\t\t\t// checkProposedApiEnabled(extension);\n\t\t\t\treturn extHostTypes.NotebookEditorRevealType;\n\t\t\t},\n\t\t\tget NotebookCellOutput() {\n\t\t\t\t// checkProposedApiEnabled(extension);\n\t\t\t\treturn extHostTypes.NotebookCellOutput;\n\t\t\t},\n\t\t\tget NotebookCellOutputItem() {\n\t\t\t\t// checkProposedApiEnabled(extension);\n\t\t\t\treturn extHostTypes.NotebookCellOutputItem;\n\t\t\t},\n\t\t\tget LinkedEditingRanges() {\n\t\t\t\t// checkProposedApiEnabled(extension);\n\t\t\t\treturn extHostTypes.LinkedEditingRanges;\n\t\t\t},\n\t\t\tget TestRunState() {\n\t\t\t\t// checkProposedApiEnabled(extension);\n\t\t\t\treturn extHostTypes.TestRunState;\n\t\t\t},\n\t\t\tget TestMessageSeverity() {\n\t\t\t\t// checkProposedApiEnabled(extension);\n\t\t\t\treturn extHostTypes.TestMessageSeverity;\n\t\t\t},\n\t\t\tget TestState() {\n\t\t\t\t// checkProposedApiEnabled(extension);\n\t\t\t\treturn extHostTypes.TestState;\n\t\t\t},\n\t\t};\n\t};\n}\n\nclass Extension<T> implements vscode.Extension<T> {\n\n\tprivate _extensionService: IExtHostExtensionService;\n\tprivate _originExtensionId: ExtensionIdentifier;\n\tprivate _identifier: ExtensionIdentifier;\n\n\treadonly id: string;\n\treadonly extensionUri: URI;\n\treadonly extensionPath: string;\n\treadonly packageJSON: IExtensionDescription;\n\treadonly extensionKind: vscode.ExtensionKind;\n\n\tconstructor(extensionService: IExtHostExtensionService, originExtensionId: ExtensionIdentifier, description: IExtensionDescription, kind: extHostTypes.ExtensionKind) {\n\t\tthis._extensionService = extensionService;\n\t\tthis._originExtensionId = originExtensionId;\n\t\tthis._identifier = description.identifier;\n\t\tthis.id = description.identifier.value;\n\t\tthis.extensionUri = description.extensionLocation;\n\t\tthis.extensionPath = path.normalize(originalFSPath(description.extensionLocation));\n\t\tthis.packageJSON = description;\n\t\tthis.extensionKind = kind;\n\t}\n\n\tget isActive(): boolean {\n\t\treturn this._extensionService.isActivated(this._identifier);\n\t}\n\n\tget exports(): T {\n\t\tif (this.packageJSON.api === 'none') {\n\t\t\treturn undefined!; // Strict nulloverride - Public api\n\t\t}\n\t\treturn <T>this._extensionService.getExtensionExports(this._identifier);\n\t}\n\n\tactivate(): Thenable<T> {\n\t\treturn this._extensionService.activateByIdWithErrors(this._identifier, { startup: false, extensionId: this._originExtensionId, activationEvent: 'api' }).then(() => this.exports);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { registerSingleton } from 'vs/platform/instantiation/common/extensions';\nimport { IExtHostOutputService, ExtHostOutputService } from 'vs/workbench/api/common/extHostOutput';\nimport { IExtHostWorkspace, ExtHostWorkspace } from 'vs/workbench/api/common/extHostWorkspace';\nimport { IExtHostDecorations, ExtHostDecorations } from 'vs/workbench/api/common/extHostDecorations';\nimport { IExtHostConfiguration, ExtHostConfiguration } from 'vs/workbench/api/common/extHostConfiguration';\nimport { IExtHostCommands, ExtHostCommands } from 'vs/workbench/api/common/extHostCommands';\nimport { IExtHostDocumentsAndEditors, ExtHostDocumentsAndEditors } from 'vs/workbench/api/common/extHostDocumentsAndEditors';\nimport { IExtHostTerminalService, WorkerExtHostTerminalService } from 'vs/workbench/api/common/extHostTerminalService';\nimport { IExtHostTask, WorkerExtHostTask } from 'vs/workbench/api/common/extHostTask';\nimport { IExtHostDebugService, WorkerExtHostDebugService } from 'vs/workbench/api/common/extHostDebugService';\nimport { IExtHostSearch, ExtHostSearch } from 'vs/workbench/api/common/extHostSearch';\nimport { IExtensionStoragePaths, ExtensionStoragePaths } from 'vs/workbench/api/common/extHostStoragePaths';\nimport { IExtHostStorage, ExtHostStorage } from 'vs/workbench/api/common/extHostStorage';\nimport { IExtHostTunnelService, ExtHostTunnelService } from 'vs/workbench/api/common/extHostTunnelService';\nimport { IExtHostApiDeprecationService, ExtHostApiDeprecationService, } from 'vs/workbench/api/common/extHostApiDeprecationService';\nimport { IExtHostWindow, ExtHostWindow } from 'vs/workbench/api/common/extHostWindow';\nimport { IExtHostConsumerFileSystem, ExtHostConsumerFileSystem } from 'vs/workbench/api/common/extHostFileSystemConsumer';\nimport { IExtHostFileSystemInfo, ExtHostFileSystemInfo } from 'vs/workbench/api/common/extHostFileSystemInfo';\nimport { IExtHostSecretState, ExtHostSecretState } from 'vs/workbench/api/common/exHostSecretState';\n\nregisterSingleton(IExtensionStoragePaths, ExtensionStoragePaths);\nregisterSingleton(IExtHostApiDeprecationService, ExtHostApiDeprecationService);\nregisterSingleton(IExtHostCommands, ExtHostCommands);\nregisterSingleton(IExtHostConfiguration, ExtHostConfiguration);\nregisterSingleton(IExtHostConsumerFileSystem, ExtHostConsumerFileSystem);\nregisterSingleton(IExtHostDebugService, WorkerExtHostDebugService);\nregisterSingleton(IExtHostDecorations, ExtHostDecorations);\nregisterSingleton(IExtHostDocumentsAndEditors, ExtHostDocumentsAndEditors);\nregisterSingleton(IExtHostFileSystemInfo, ExtHostFileSystemInfo);\nregisterSingleton(IExtHostOutputService, ExtHostOutputService);\nregisterSingleton(IExtHostSearch, ExtHostSearch);\nregisterSingleton(IExtHostStorage, ExtHostStorage);\nregisterSingleton(IExtHostTask, WorkerExtHostTask);\nregisterSingleton(IExtHostTerminalService, WorkerExtHostTerminalService);\nregisterSingleton(IExtHostTunnelService, ExtHostTunnelService);\nregisterSingleton(IExtHostWindow, ExtHostWindow);\nregisterSingleton(IExtHostWorkspace, ExtHostWorkspace);\nregisterSingleton(IExtHostSecretState, ExtHostSecretState);\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { mapArrayOrNot } from 'vs/base/common/arrays';\nimport { URI } from 'vs/base/common/uri';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { SearchRange, TextSearchMatch } from 'vs/workbench/services/search/common/search';\nimport * as searchExtTypes from 'vs/workbench/services/search/common/searchExtTypes';\n\nexport type Maybe<T> = T | null | undefined;\n\nexport function anchorGlob(glob: string): string {\n\treturn glob.startsWith('**') || glob.startsWith('/') ? glob : `/${glob}`;\n}\n\n/**\n * Create a vscode.TextSearchMatch by using our internal TextSearchMatch type for its previewOptions logic.\n */\nexport function createTextSearchResult(uri: URI, text: string, range: searchExtTypes.Range | searchExtTypes.Range[], previewOptions?: searchExtTypes.TextSearchPreviewOptions): searchExtTypes.TextSearchMatch {\n\tconst searchRange = mapArrayOrNot(range, rangeToSearchRange);\n\n\tconst internalResult = new TextSearchMatch(text, searchRange, previewOptions);\n\tconst internalPreviewRange = internalResult.preview.matches;\n\treturn {\n\t\tranges: mapArrayOrNot(searchRange, searchRangeToRange),\n\t\turi,\n\t\tpreview: {\n\t\t\ttext: internalResult.preview.text,\n\t\t\tmatches: mapArrayOrNot(internalPreviewRange, searchRangeToRange)\n\t\t}\n\t};\n}\n\nfunction rangeToSearchRange(range: searchExtTypes.Range): SearchRange {\n\treturn new SearchRange(range.start.line, range.start.character, range.end.line, range.end.character);\n}\n\nfunction searchRangeToRange(range: SearchRange): searchExtTypes.Range {\n\treturn new searchExtTypes.Range(range.startLineNumber, range.startColumn, range.endLineNumber, range.endColumn);\n}\n\nexport interface IOutputChannel {\n\tappendLine(msg: string): void;\n}\n\nexport class OutputChannel implements IOutputChannel {\n\tconstructor(@ILogService private readonly logService: ILogService) { }\n\n\tappendLine(msg: string): void {\n\t\tthis.logService.debug('RipgrepSearchEH#search', msg);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Readable, ReadableStream, newWriteableStream } from 'vs/base/common/stream';\nimport { VSBuffer, VSBufferReadable, VSBufferReadableStream } from 'vs/base/common/buffer';\n\nexport const UTF8 = 'utf8';\nexport const UTF8_with_bom = 'utf8bom';\nexport const UTF16be = 'utf16be';\nexport const UTF16le = 'utf16le';\n\nexport type UTF_ENCODING = typeof UTF8 | typeof UTF8_with_bom | typeof UTF16be | typeof UTF16le;\n\nexport function isUTFEncoding(encoding: string): encoding is UTF_ENCODING {\n\treturn [UTF8, UTF8_with_bom, UTF16be, UTF16le].some(utfEncoding => utfEncoding === encoding);\n}\n\nexport const UTF16be_BOM = [0xFE, 0xFF];\nexport const UTF16le_BOM = [0xFF, 0xFE];\nexport const UTF8_BOM = [0xEF, 0xBB, 0xBF];\n\nconst ZERO_BYTE_DETECTION_BUFFER_MAX_LEN = 512; \t// number of bytes to look at to decide about a file being binary or not\nconst NO_ENCODING_GUESS_MIN_BYTES = 512; \t\t\t// when not auto guessing the encoding, small number of bytes are enough\nconst AUTO_ENCODING_GUESS_MIN_BYTES = 512 * 8; \t\t// with auto guessing we want a lot more content to be read for guessing\nconst AUTO_ENCODING_GUESS_MAX_BYTES = 512 * 128; \t// set an upper limit for the number of bytes we pass on to jschardet\n\nexport interface IDecodeStreamOptions {\n\tguessEncoding: boolean;\n\tminBytesRequiredForDetection?: number;\n\n\toverwriteEncoding(detectedEncoding: string | null): Promise<string>;\n}\n\nexport interface IDecodeStreamResult {\n\tstream: ReadableStream<string>;\n\tdetected: IDetectedEncodingResult;\n}\n\nexport interface IDecoderStream {\n\twrite(buffer: Uint8Array): string;\n\tend(): string | undefined;\n}\n\nclass DecoderStream implements IDecoderStream {\n\n\t/**\n\t * This stream will only load iconv-lite lazily if the encoding\n\t * is not UTF-8. This ensures that for most common cases we do\n\t * not pay the price of loading the module from disk.\n\t *\n\t * We still need to be careful when converting UTF-8 to a string\n\t * though because we read the file in chunks of Buffer and thus\n\t * need to decode it via TextDecoder helper that is available\n\t * in browser and node.js environments.\n\t */\n\tstatic async create(encoding: string): Promise<DecoderStream> {\n\t\tlet decoder: IDecoderStream | undefined = undefined;\n\t\tif (encoding !== UTF8) {\n\t\t\tconst iconv = await import('iconv-lite-umd');\n\t\t\tdecoder = iconv.getDecoder(toNodeEncoding(encoding));\n\t\t} else {\n\t\t\tconst utf8TextDecoder = new TextDecoder();\n\t\t\tdecoder = {\n\t\t\t\twrite(buffer: Uint8Array): string {\n\t\t\t\t\treturn utf8TextDecoder.decode(buffer, {\n\t\t\t\t\t\t// Signal to TextDecoder that potentially more data is coming\n\t\t\t\t\t\t// and that we are calling `decode` in the end to consume any\n\t\t\t\t\t\t// remainders\n\t\t\t\t\t\tstream: true\n\t\t\t\t\t});\n\t\t\t\t},\n\n\t\t\t\tend(): string | undefined {\n\t\t\t\t\treturn utf8TextDecoder.decode();\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\treturn new DecoderStream(decoder);\n\t}\n\n\tprivate constructor(private iconvLiteDecoder: IDecoderStream) { }\n\n\twrite(buffer: Uint8Array): string {\n\t\treturn this.iconvLiteDecoder.write(buffer);\n\t}\n\n\tend(): string | undefined {\n\t\treturn this.iconvLiteDecoder.end();\n\t}\n}\n\nexport function toDecodeStream(source: VSBufferReadableStream, options: IDecodeStreamOptions): Promise<IDecodeStreamResult> {\n\tconst minBytesRequiredForDetection = options.minBytesRequiredForDetection ?? options.guessEncoding ? AUTO_ENCODING_GUESS_MIN_BYTES : NO_ENCODING_GUESS_MIN_BYTES;\n\n\treturn new Promise<IDecodeStreamResult>((resolve, reject) => {\n\t\tconst target = newWriteableStream<string>(strings => strings.join(''));\n\n\t\tconst bufferedChunks: VSBuffer[] = [];\n\t\tlet bytesBuffered = 0;\n\n\t\tlet decoder: IDecoderStream | undefined = undefined;\n\n\t\tconst createDecoder = async () => {\n\t\t\ttry {\n\n\t\t\t\t// detect encoding from buffer\n\t\t\t\tconst detected = await detectEncodingFromBuffer({\n\t\t\t\t\tbuffer: VSBuffer.concat(bufferedChunks),\n\t\t\t\t\tbytesRead: bytesBuffered\n\t\t\t\t}, options.guessEncoding);\n\n\t\t\t\t// ensure to respect overwrite of encoding\n\t\t\t\tdetected.encoding = await options.overwriteEncoding(detected.encoding);\n\n\t\t\t\t// decode and write buffered content\n\t\t\t\tdecoder = await DecoderStream.create(detected.encoding);\n\t\t\t\tconst decoded = decoder.write(VSBuffer.concat(bufferedChunks).buffer);\n\t\t\t\ttarget.write(decoded);\n\n\t\t\t\tbufferedChunks.length = 0;\n\t\t\t\tbytesBuffered = 0;\n\n\t\t\t\t// signal to the outside our detected encoding and final decoder stream\n\t\t\t\tresolve({\n\t\t\t\t\tstream: target,\n\t\t\t\t\tdetected\n\t\t\t\t});\n\t\t\t} catch (error) {\n\t\t\t\treject(error);\n\t\t\t}\n\t\t};\n\n\t\t// Stream error: forward to target\n\t\tsource.on('error', error => target.error(error));\n\n\t\t// Stream data\n\t\tsource.on('data', async chunk => {\n\n\t\t\t// if the decoder is ready, we just write directly\n\t\t\tif (decoder) {\n\t\t\t\ttarget.write(decoder.write(chunk.buffer));\n\t\t\t}\n\n\t\t\t// otherwise we need to buffer the data until the stream is ready\n\t\t\telse {\n\t\t\t\tbufferedChunks.push(chunk);\n\t\t\t\tbytesBuffered += chunk.byteLength;\n\n\t\t\t\t// buffered enough data for encoding detection, create stream\n\t\t\t\tif (bytesBuffered >= minBytesRequiredForDetection) {\n\n\t\t\t\t\t// pause stream here until the decoder is ready\n\t\t\t\t\tsource.pause();\n\n\t\t\t\t\tawait createDecoder();\n\n\t\t\t\t\t// resume stream now that decoder is ready but\n\t\t\t\t\t// outside of this stack to reduce recursion\n\t\t\t\t\tsetTimeout(() => source.resume());\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Stream end\n\t\tsource.on('end', async () => {\n\n\t\t\t// we were still waiting for data to do the encoding\n\t\t\t// detection. thus, wrap up starting the stream even\n\t\t\t// without all the data to get things going\n\t\t\tif (!decoder) {\n\t\t\t\tawait createDecoder();\n\t\t\t}\n\n\t\t\t// end the target with the remainders of the decoder\n\t\t\ttarget.end(decoder?.end());\n\t\t});\n\t});\n}\n\nexport async function toEncodeReadable(readable: Readable<string>, encoding: string, options?: { addBOM?: boolean }): Promise<VSBufferReadable> {\n\tconst iconv = await import('iconv-lite-umd');\n\tconst encoder = iconv.getEncoder(toNodeEncoding(encoding), options);\n\n\tlet bytesWritten = false;\n\tlet done = false;\n\n\treturn {\n\t\tread() {\n\t\t\tif (done) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst chunk = readable.read();\n\t\t\tif (typeof chunk !== 'string') {\n\t\t\t\tdone = true;\n\n\t\t\t\t// If we are instructed to add a BOM but we detect that no\n\t\t\t\t// bytes have been written, we must ensure to return the BOM\n\t\t\t\t// ourselves so that we comply with the contract.\n\t\t\t\tif (!bytesWritten && options?.addBOM) {\n\t\t\t\t\tswitch (encoding) {\n\t\t\t\t\t\tcase UTF8:\n\t\t\t\t\t\tcase UTF8_with_bom:\n\t\t\t\t\t\t\treturn VSBuffer.wrap(Uint8Array.from(UTF8_BOM));\n\t\t\t\t\t\tcase UTF16be:\n\t\t\t\t\t\t\treturn VSBuffer.wrap(Uint8Array.from(UTF16be_BOM));\n\t\t\t\t\t\tcase UTF16le:\n\t\t\t\t\t\t\treturn VSBuffer.wrap(Uint8Array.from(UTF16le_BOM));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst leftovers = encoder.end();\n\t\t\t\tif (leftovers && leftovers.length > 0) {\n\t\t\t\t\tbytesWritten = true;\n\n\t\t\t\t\treturn VSBuffer.wrap(leftovers);\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tbytesWritten = true;\n\n\t\t\treturn VSBuffer.wrap(encoder.write(chunk));\n\t\t}\n\t};\n}\n\nexport async function encodingExists(encoding: string): Promise<boolean> {\n\tconst iconv = await import('iconv-lite-umd');\n\n\treturn iconv.encodingExists(toNodeEncoding(encoding));\n}\n\nexport function toNodeEncoding(enc: string | null): string {\n\tif (enc === UTF8_with_bom || enc === null) {\n\t\treturn UTF8; // iconv does not distinguish UTF 8 with or without BOM, so we need to help it\n\t}\n\n\treturn enc;\n}\n\nexport function detectEncodingByBOMFromBuffer(buffer: VSBuffer | null, bytesRead: number): typeof UTF8_with_bom | typeof UTF16le | typeof UTF16be | null {\n\tif (!buffer || bytesRead < UTF16be_BOM.length) {\n\t\treturn null;\n\t}\n\n\tconst b0 = buffer.readUInt8(0);\n\tconst b1 = buffer.readUInt8(1);\n\n\t// UTF-16 BE\n\tif (b0 === UTF16be_BOM[0] && b1 === UTF16be_BOM[1]) {\n\t\treturn UTF16be;\n\t}\n\n\t// UTF-16 LE\n\tif (b0 === UTF16le_BOM[0] && b1 === UTF16le_BOM[1]) {\n\t\treturn UTF16le;\n\t}\n\n\tif (bytesRead < UTF8_BOM.length) {\n\t\treturn null;\n\t}\n\n\tconst b2 = buffer.readUInt8(2);\n\n\t// UTF-8\n\tif (b0 === UTF8_BOM[0] && b1 === UTF8_BOM[1] && b2 === UTF8_BOM[2]) {\n\t\treturn UTF8_with_bom;\n\t}\n\n\treturn null;\n}\n\n// we explicitly ignore a specific set of encodings from auto guessing\n// - ASCII: we never want this encoding (most UTF-8 files would happily detect as\n//          ASCII files and then you could not type non-ASCII characters anymore)\n// - UTF-16: we have our own detection logic for UTF-16\n// - UTF-32: we do not support this encoding in VSCode\nconst IGNORE_ENCODINGS = ['ascii', 'utf-16', 'utf-32'];\n\n/**\n * Guesses the encoding from buffer.\n */\nasync function guessEncodingByBuffer(buffer: VSBuffer): Promise<string | null> {\n\tconst jschardet = await import('jschardet');\n\n\t// ensure to limit buffer for guessing due to https://github.com/aadsm/jschardet/issues/53\n\tconst limitedBuffer = buffer.slice(0, AUTO_ENCODING_GUESS_MAX_BYTES);\n\n\t// before guessing jschardet calls toString('binary') on input if it is a Buffer,\n\t// since we are using it inside browser environment as well we do conversion ourselves\n\t// https://github.com/aadsm/jschardet/blob/v2.1.1/src/index.js#L36-L40\n\tconst binaryString = encodeLatin1(limitedBuffer.buffer);\n\n\tconst guessed = jschardet.detect(binaryString);\n\tif (!guessed || !guessed.encoding) {\n\t\treturn null;\n\t}\n\n\tconst enc = guessed.encoding.toLowerCase();\n\tif (0 <= IGNORE_ENCODINGS.indexOf(enc)) {\n\t\treturn null; // see comment above why we ignore some encodings\n\t}\n\n\treturn toIconvLiteEncoding(guessed.encoding);\n}\n\nconst JSCHARDET_TO_ICONV_ENCODINGS: { [name: string]: string } = {\n\t'ibm866': 'cp866',\n\t'big5': 'cp950'\n};\n\nfunction toIconvLiteEncoding(encodingName: string): string {\n\tconst normalizedEncodingName = encodingName.replace(/[^a-zA-Z0-9]/g, '').toLowerCase();\n\tconst mapped = JSCHARDET_TO_ICONV_ENCODINGS[normalizedEncodingName];\n\n\treturn mapped || normalizedEncodingName;\n}\n\nfunction encodeLatin1(buffer: Uint8Array): string {\n\tlet result = '';\n\tfor (let i = 0; i < buffer.length; i++) {\n\t\tresult += String.fromCharCode(buffer[i]);\n\t}\n\n\treturn result;\n}\n\n/**\n * The encodings that are allowed in a settings file don't match the canonical encoding labels specified by WHATWG.\n * See https://encoding.spec.whatwg.org/#names-and-labels\n * Iconv-lite strips all non-alphanumeric characters, but ripgrep doesn't. For backcompat, allow these labels.\n */\nexport function toCanonicalName(enc: string): string {\n\tswitch (enc) {\n\t\tcase 'shiftjis':\n\t\t\treturn 'shift-jis';\n\t\tcase 'utf16le':\n\t\t\treturn 'utf-16le';\n\t\tcase 'utf16be':\n\t\t\treturn 'utf-16be';\n\t\tcase 'big5hkscs':\n\t\t\treturn 'big5-hkscs';\n\t\tcase 'eucjp':\n\t\t\treturn 'euc-jp';\n\t\tcase 'euckr':\n\t\t\treturn 'euc-kr';\n\t\tcase 'koi8r':\n\t\t\treturn 'koi8-r';\n\t\tcase 'koi8u':\n\t\t\treturn 'koi8-u';\n\t\tcase 'macroman':\n\t\t\treturn 'x-mac-roman';\n\t\tcase 'utf8bom':\n\t\t\treturn 'utf8';\n\t\tdefault:\n\t\t\tconst m = enc.match(/windows(\\d+)/);\n\t\t\tif (m) {\n\t\t\t\treturn 'windows-' + m[1];\n\t\t\t}\n\n\t\t\treturn enc;\n\t}\n}\n\nexport interface IDetectedEncodingResult {\n\tencoding: string | null;\n\tseemsBinary: boolean;\n}\n\nexport interface IReadResult {\n\tbuffer: VSBuffer | null;\n\tbytesRead: number;\n}\n\nexport function detectEncodingFromBuffer(readResult: IReadResult, autoGuessEncoding?: false): IDetectedEncodingResult;\nexport function detectEncodingFromBuffer(readResult: IReadResult, autoGuessEncoding?: boolean): Promise<IDetectedEncodingResult>;\nexport function detectEncodingFromBuffer({ buffer, bytesRead }: IReadResult, autoGuessEncoding?: boolean): Promise<IDetectedEncodingResult> | IDetectedEncodingResult {\n\n\t// Always first check for BOM to find out about encoding\n\tlet encoding = detectEncodingByBOMFromBuffer(buffer, bytesRead);\n\n\t// Detect 0 bytes to see if file is binary or UTF-16 LE/BE\n\t// unless we already know that this file has a UTF-16 encoding\n\tlet seemsBinary = false;\n\tif (encoding !== UTF16be && encoding !== UTF16le && buffer) {\n\t\tlet couldBeUTF16LE = true; // e.g. 0xAA 0x00\n\t\tlet couldBeUTF16BE = true; // e.g. 0x00 0xAA\n\t\tlet containsZeroByte = false;\n\n\t\t// This is a simplified guess to detect UTF-16 BE or LE by just checking if\n\t\t// the first 512 bytes have the 0-byte at a specific location. For UTF-16 LE\n\t\t// this would be the odd byte index and for UTF-16 BE the even one.\n\t\t// Note: this can produce false positives (a binary file that uses a 2-byte\n\t\t// encoding of the same format as UTF-16) and false negatives (a UTF-16 file\n\t\t// that is using 4 bytes to encode a character).\n\t\tfor (let i = 0; i < bytesRead && i < ZERO_BYTE_DETECTION_BUFFER_MAX_LEN; i++) {\n\t\t\tconst isEndian = (i % 2 === 1); // assume 2-byte sequences typical for UTF-16\n\t\t\tconst isZeroByte = (buffer.readUInt8(i) === 0);\n\n\t\t\tif (isZeroByte) {\n\t\t\t\tcontainsZeroByte = true;\n\t\t\t}\n\n\t\t\t// UTF-16 LE: expect e.g. 0xAA 0x00\n\t\t\tif (couldBeUTF16LE && (isEndian && !isZeroByte || !isEndian && isZeroByte)) {\n\t\t\t\tcouldBeUTF16LE = false;\n\t\t\t}\n\n\t\t\t// UTF-16 BE: expect e.g. 0x00 0xAA\n\t\t\tif (couldBeUTF16BE && (isEndian && isZeroByte || !isEndian && !isZeroByte)) {\n\t\t\t\tcouldBeUTF16BE = false;\n\t\t\t}\n\n\t\t\t// Return if this is neither UTF16-LE nor UTF16-BE and thus treat as binary\n\t\t\tif (isZeroByte && !couldBeUTF16LE && !couldBeUTF16BE) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t// Handle case of 0-byte included\n\t\tif (containsZeroByte) {\n\t\t\tif (couldBeUTF16LE) {\n\t\t\t\tencoding = UTF16le;\n\t\t\t} else if (couldBeUTF16BE) {\n\t\t\t\tencoding = UTF16be;\n\t\t\t} else {\n\t\t\t\tseemsBinary = true;\n\t\t\t}\n\t\t}\n\t}\n\n\t// Auto guess encoding if configured\n\tif (autoGuessEncoding && !seemsBinary && !encoding && buffer) {\n\t\treturn guessEncodingByBuffer(buffer.slice(0, bytesRead)).then(guessedEncoding => {\n\t\t\treturn {\n\t\t\t\tseemsBinary: false,\n\t\t\t\tencoding: guessedEncoding\n\t\t\t};\n\t\t});\n\t}\n\n\treturn { seemsBinary, encoding };\n}\n\nexport const SUPPORTED_ENCODINGS: { [encoding: string]: { labelLong: string; labelShort: string; order: number; encodeOnly?: boolean; alias?: string } } = {\n\tutf8: {\n\t\tlabelLong: 'UTF-8',\n\t\tlabelShort: 'UTF-8',\n\t\torder: 1,\n\t\talias: 'utf8bom'\n\t},\n\tutf8bom: {\n\t\tlabelLong: 'UTF-8 with BOM',\n\t\tlabelShort: 'UTF-8 with BOM',\n\t\tencodeOnly: true,\n\t\torder: 2,\n\t\talias: 'utf8'\n\t},\n\tutf16le: {\n\t\tlabelLong: 'UTF-16 LE',\n\t\tlabelShort: 'UTF-16 LE',\n\t\torder: 3\n\t},\n\tutf16be: {\n\t\tlabelLong: 'UTF-16 BE',\n\t\tlabelShort: 'UTF-16 BE',\n\t\torder: 4\n\t},\n\twindows1252: {\n\t\tlabelLong: 'Western (Windows 1252)',\n\t\tlabelShort: 'Windows 1252',\n\t\torder: 5\n\t},\n\tiso88591: {\n\t\tlabelLong: 'Western (ISO 8859-1)',\n\t\tlabelShort: 'ISO 8859-1',\n\t\torder: 6\n\t},\n\tiso88593: {\n\t\tlabelLong: 'Western (ISO 8859-3)',\n\t\tlabelShort: 'ISO 8859-3',\n\t\torder: 7\n\t},\n\tiso885915: {\n\t\tlabelLong: 'Western (ISO 8859-15)',\n\t\tlabelShort: 'ISO 8859-15',\n\t\torder: 8\n\t},\n\tmacroman: {\n\t\tlabelLong: 'Western (Mac Roman)',\n\t\tlabelShort: 'Mac Roman',\n\t\torder: 9\n\t},\n\tcp437: {\n\t\tlabelLong: 'DOS (CP 437)',\n\t\tlabelShort: 'CP437',\n\t\torder: 10\n\t},\n\twindows1256: {\n\t\tlabelLong: 'Arabic (Windows 1256)',\n\t\tlabelShort: 'Windows 1256',\n\t\torder: 11\n\t},\n\tiso88596: {\n\t\tlabelLong: 'Arabic (ISO 8859-6)',\n\t\tlabelShort: 'ISO 8859-6',\n\t\torder: 12\n\t},\n\twindows1257: {\n\t\tlabelLong: 'Baltic (Windows 1257)',\n\t\tlabelShort: 'Windows 1257',\n\t\torder: 13\n\t},\n\tiso88594: {\n\t\tlabelLong: 'Baltic (ISO 8859-4)',\n\t\tlabelShort: 'ISO 8859-4',\n\t\torder: 14\n\t},\n\tiso885914: {\n\t\tlabelLong: 'Celtic (ISO 8859-14)',\n\t\tlabelShort: 'ISO 8859-14',\n\t\torder: 15\n\t},\n\twindows1250: {\n\t\tlabelLong: 'Central European (Windows 1250)',\n\t\tlabelShort: 'Windows 1250',\n\t\torder: 16\n\t},\n\tiso88592: {\n\t\tlabelLong: 'Central European (ISO 8859-2)',\n\t\tlabelShort: 'ISO 8859-2',\n\t\torder: 17\n\t},\n\tcp852: {\n\t\tlabelLong: 'Central European (CP 852)',\n\t\tlabelShort: 'CP 852',\n\t\torder: 18\n\t},\n\twindows1251: {\n\t\tlabelLong: 'Cyrillic (Windows 1251)',\n\t\tlabelShort: 'Windows 1251',\n\t\torder: 19\n\t},\n\tcp866: {\n\t\tlabelLong: 'Cyrillic (CP 866)',\n\t\tlabelShort: 'CP 866',\n\t\torder: 20\n\t},\n\tiso88595: {\n\t\tlabelLong: 'Cyrillic (ISO 8859-5)',\n\t\tlabelShort: 'ISO 8859-5',\n\t\torder: 21\n\t},\n\tkoi8r: {\n\t\tlabelLong: 'Cyrillic (KOI8-R)',\n\t\tlabelShort: 'KOI8-R',\n\t\torder: 22\n\t},\n\tkoi8u: {\n\t\tlabelLong: 'Cyrillic (KOI8-U)',\n\t\tlabelShort: 'KOI8-U',\n\t\torder: 23\n\t},\n\tiso885913: {\n\t\tlabelLong: 'Estonian (ISO 8859-13)',\n\t\tlabelShort: 'ISO 8859-13',\n\t\torder: 24\n\t},\n\twindows1253: {\n\t\tlabelLong: 'Greek (Windows 1253)',\n\t\tlabelShort: 'Windows 1253',\n\t\torder: 25\n\t},\n\tiso88597: {\n\t\tlabelLong: 'Greek (ISO 8859-7)',\n\t\tlabelShort: 'ISO 8859-7',\n\t\torder: 26\n\t},\n\twindows1255: {\n\t\tlabelLong: 'Hebrew (Windows 1255)',\n\t\tlabelShort: 'Windows 1255',\n\t\torder: 27\n\t},\n\tiso88598: {\n\t\tlabelLong: 'Hebrew (ISO 8859-8)',\n\t\tlabelShort: 'ISO 8859-8',\n\t\torder: 28\n\t},\n\tiso885910: {\n\t\tlabelLong: 'Nordic (ISO 8859-10)',\n\t\tlabelShort: 'ISO 8859-10',\n\t\torder: 29\n\t},\n\tiso885916: {\n\t\tlabelLong: 'Romanian (ISO 8859-16)',\n\t\tlabelShort: 'ISO 8859-16',\n\t\torder: 30\n\t},\n\twindows1254: {\n\t\tlabelLong: 'Turkish (Windows 1254)',\n\t\tlabelShort: 'Windows 1254',\n\t\torder: 31\n\t},\n\tiso88599: {\n\t\tlabelLong: 'Turkish (ISO 8859-9)',\n\t\tlabelShort: 'ISO 8859-9',\n\t\torder: 32\n\t},\n\twindows1258: {\n\t\tlabelLong: 'Vietnamese (Windows 1258)',\n\t\tlabelShort: 'Windows 1258',\n\t\torder: 33\n\t},\n\tgbk: {\n\t\tlabelLong: 'Simplified Chinese (GBK)',\n\t\tlabelShort: 'GBK',\n\t\torder: 34\n\t},\n\tgb18030: {\n\t\tlabelLong: 'Simplified Chinese (GB18030)',\n\t\tlabelShort: 'GB18030',\n\t\torder: 35\n\t},\n\tcp950: {\n\t\tlabelLong: 'Traditional Chinese (Big5)',\n\t\tlabelShort: 'Big5',\n\t\torder: 36\n\t},\n\tbig5hkscs: {\n\t\tlabelLong: 'Traditional Chinese (Big5-HKSCS)',\n\t\tlabelShort: 'Big5-HKSCS',\n\t\torder: 37\n\t},\n\tshiftjis: {\n\t\tlabelLong: 'Japanese (Shift JIS)',\n\t\tlabelShort: 'Shift JIS',\n\t\torder: 38\n\t},\n\teucjp: {\n\t\tlabelLong: 'Japanese (EUC-JP)',\n\t\tlabelShort: 'EUC-JP',\n\t\torder: 39\n\t},\n\teuckr: {\n\t\tlabelLong: 'Korean (EUC-KR)',\n\t\tlabelShort: 'EUC-KR',\n\t\torder: 40\n\t},\n\twindows874: {\n\t\tlabelLong: 'Thai (Windows 874)',\n\t\tlabelShort: 'Windows 874',\n\t\torder: 41\n\t},\n\tiso885911: {\n\t\tlabelLong: 'Latin/Thai (ISO 8859-11)',\n\t\tlabelShort: 'ISO 8859-11',\n\t\torder: 42\n\t},\n\tkoi8ru: {\n\t\tlabelLong: 'Cyrillic (KOI8-RU)',\n\t\tlabelShort: 'KOI8-RU',\n\t\torder: 43\n\t},\n\tkoi8t: {\n\t\tlabelLong: 'Tajik (KOI8-T)',\n\t\tlabelShort: 'KOI8-T',\n\t\torder: 44\n\t},\n\tgb2312: {\n\t\tlabelLong: 'Simplified Chinese (GB 2312)',\n\t\tlabelShort: 'GB 2312',\n\t\torder: 45\n\t},\n\tcp865: {\n\t\tlabelLong: 'Nordic DOS (CP 865)',\n\t\tlabelShort: 'CP 865',\n\t\torder: 46\n\t},\n\tcp850: {\n\t\tlabelLong: 'Western European DOS (CP 850)',\n\t\tlabelShort: 'CP 850',\n\t\torder: 47\n\t}\n};\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { toCanonicalName } from 'vs/workbench/services/textfile/common/encoding';\nimport * as pfs from 'vs/base/node/pfs';\nimport { ITextQuery } from 'vs/workbench/services/search/common/search';\nimport { TextSearchProvider } from 'vs/workbench/services/search/common/searchExtTypes';\nimport { TextSearchManager } from 'vs/workbench/services/search/common/textSearchManager';\n\nexport class NativeTextSearchManager extends TextSearchManager {\n\n\tconstructor(query: ITextQuery, provider: TextSearchProvider, _pfs: typeof pfs = pfs) {\n\t\tsuper(query, provider, {\n\t\t\treaddir: resource => _pfs.readdir(resource.fsPath),\n\t\t\ttoCanonicalName: name => toCanonicalName(name)\n\t\t});\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as http from 'http';\nimport * as https from 'https';\nimport * as tls from 'tls';\nimport * as nodeurl from 'url';\nimport * as os from 'os';\nimport * as fs from 'fs';\nimport * as cp from 'child_process';\n\nimport { IExtHostWorkspaceProvider } from 'vs/workbench/api/common/extHostWorkspace';\nimport { ExtHostConfigProvider } from 'vs/workbench/api/common/extHostConfiguration';\nimport { ProxyAgent } from 'vscode-proxy-agent';\nimport { MainThreadTelemetryShape, IInitData } from 'vs/workbench/api/common/extHost.protocol';\nimport { toErrorMessage } from 'vs/base/common/errorMessage';\nimport { ExtHostExtensionService } from 'vs/workbench/api/node/extHostExtensionService';\nimport { URI } from 'vs/base/common/uri';\nimport { promisify } from 'util';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { IExtensionDescription } from 'vs/platform/extensions/common/extensions';\n\ninterface ConnectionResult {\n\tproxy: string;\n\tconnection: string;\n\tcode: string;\n\tcount: number;\n}\n\nexport function connectProxyResolver(\n\textHostWorkspace: IExtHostWorkspaceProvider,\n\tconfigProvider: ExtHostConfigProvider,\n\textensionService: ExtHostExtensionService,\n\textHostLogService: ILogService,\n\tmainThreadTelemetry: MainThreadTelemetryShape,\n\tinitData: IInitData,\n) {\n\tconst resolveProxy = setupProxyResolution(extHostWorkspace, configProvider, extHostLogService, mainThreadTelemetry, initData);\n\tconst lookup = createPatchedModules(configProvider, resolveProxy);\n\treturn configureModuleLoading(extensionService, lookup);\n}\n\nconst maxCacheEntries = 5000; // Cache can grow twice that much due to 'oldCache'.\n\nfunction setupProxyResolution(\n\textHostWorkspace: IExtHostWorkspaceProvider,\n\tconfigProvider: ExtHostConfigProvider,\n\textHostLogService: ILogService,\n\tmainThreadTelemetry: MainThreadTelemetryShape,\n\tinitData: IInitData,\n) {\n\tconst env = process.env;\n\n\tlet settingsProxy = proxyFromConfigURL(configProvider.getConfiguration('http')\n\t\t.get<string>('proxy'));\n\tconfigProvider.onDidChangeConfiguration(e => {\n\t\tsettingsProxy = proxyFromConfigURL(configProvider.getConfiguration('http')\n\t\t\t.get<string>('proxy'));\n\t});\n\tlet envProxy = proxyFromConfigURL(env.https_proxy || env.HTTPS_PROXY || env.http_proxy || env.HTTP_PROXY); // Not standardized.\n\n\tlet envNoProxy = noProxyFromEnv(env.no_proxy || env.NO_PROXY); // Not standardized.\n\n\tlet cacheRolls = 0;\n\tlet oldCache = new Map<string, string>();\n\tlet cache = new Map<string, string>();\n\tfunction getCacheKey(url: nodeurl.UrlWithStringQuery) {\n\t\t// Expecting proxies to usually be the same per scheme://host:port. Assuming that for performance.\n\t\treturn nodeurl.format({ ...url, ...{ pathname: undefined, search: undefined, hash: undefined } });\n\t}\n\tfunction getCachedProxy(key: string) {\n\t\tlet proxy = cache.get(key);\n\t\tif (proxy) {\n\t\t\treturn proxy;\n\t\t}\n\t\tproxy = oldCache.get(key);\n\t\tif (proxy) {\n\t\t\toldCache.delete(key);\n\t\t\tcacheProxy(key, proxy);\n\t\t}\n\t\treturn proxy;\n\t}\n\tfunction cacheProxy(key: string, proxy: string) {\n\t\tcache.set(key, proxy);\n\t\tif (cache.size >= maxCacheEntries) {\n\t\t\toldCache = cache;\n\t\t\tcache = new Map();\n\t\t\tcacheRolls++;\n\t\t\textHostLogService.trace('ProxyResolver#cacheProxy cacheRolls', cacheRolls);\n\t\t}\n\t}\n\n\tlet timeout: NodeJS.Timer | undefined;\n\tlet count = 0;\n\tlet duration = 0;\n\tlet errorCount = 0;\n\tlet cacheCount = 0;\n\tlet envCount = 0;\n\tlet settingsCount = 0;\n\tlet localhostCount = 0;\n\tlet envNoProxyCount = 0;\n\tlet results: ConnectionResult[] = [];\n\tfunction logEvent() {\n\t\ttimeout = undefined;\n\t\ttype ResolveProxyClassification = {\n\t\t\tcount: { classification: 'SystemMetaData', purpose: 'PerformanceAndHealth', isMeasurement: true };\n\t\t\tduration: { classification: 'SystemMetaData', purpose: 'PerformanceAndHealth', isMeasurement: true };\n\t\t\terrorCount: { classification: 'SystemMetaData', purpose: 'PerformanceAndHealth', isMeasurement: true };\n\t\t\tcacheCount: { classification: 'SystemMetaData', purpose: 'PerformanceAndHealth', isMeasurement: true };\n\t\t\tcacheSize: { classification: 'SystemMetaData', purpose: 'PerformanceAndHealth', isMeasurement: true };\n\t\t\tcacheRolls: { classification: 'SystemMetaData', purpose: 'PerformanceAndHealth', isMeasurement: true };\n\t\t\tenvCount: { classification: 'SystemMetaData', purpose: 'PerformanceAndHealth', isMeasurement: true };\n\t\t\tsettingsCount: { classification: 'SystemMetaData', purpose: 'PerformanceAndHealth', isMeasurement: true };\n\t\t\tlocalhostCount: { classification: 'SystemMetaData', purpose: 'PerformanceAndHealth', isMeasurement: true };\n\t\t\tenvNoProxyCount: { classification: 'SystemMetaData', purpose: 'PerformanceAndHealth', isMeasurement: true };\n\t\t\tresults: { classification: 'SystemMetaData', purpose: 'PerformanceAndHealth' };\n\t\t};\n\t\ttype ResolveProxyEvent = {\n\t\t\tcount: number;\n\t\t\tduration: number;\n\t\t\terrorCount: number;\n\t\t\tcacheCount: number;\n\t\t\tcacheSize: number;\n\t\t\tcacheRolls: number;\n\t\t\tenvCount: number;\n\t\t\tsettingsCount: number;\n\t\t\tlocalhostCount: number;\n\t\t\tenvNoProxyCount: number;\n\t\t\tresults: ConnectionResult[];\n\t\t};\n\t\tmainThreadTelemetry.$publicLog2<ResolveProxyEvent, ResolveProxyClassification>('resolveProxy', { count, duration, errorCount, cacheCount, cacheSize: cache.size, cacheRolls, envCount, settingsCount, localhostCount, envNoProxyCount, results });\n\t\tcount = duration = errorCount = cacheCount = envCount = settingsCount = localhostCount = envNoProxyCount = 0;\n\t\tresults = [];\n\t}\n\n\tfunction resolveProxy(flags: { useProxySettings: boolean, useSystemCertificates: boolean }, req: http.ClientRequest, opts: http.RequestOptions, url: string, callback: (proxy?: string) => void) {\n\t\tif (!timeout) {\n\t\t\ttimeout = setTimeout(logEvent, 10 * 60 * 1000);\n\t\t}\n\n\t\tconst useHostProxy = initData.environment.useHostProxy;\n\t\tconst doUseHostProxy = typeof useHostProxy === 'boolean' ? useHostProxy : !initData.remote.isRemote;\n\t\tuseSystemCertificates(extHostLogService, flags.useSystemCertificates, opts, () => {\n\t\t\tuseProxySettings(doUseHostProxy, flags.useProxySettings, req, opts, url, callback);\n\t\t});\n\t}\n\n\tfunction useProxySettings(useHostProxy: boolean, useProxySettings: boolean, req: http.ClientRequest, opts: http.RequestOptions, url: string, callback: (proxy?: string) => void) {\n\n\t\tif (!useProxySettings) {\n\t\t\tcallback('DIRECT');\n\t\t\treturn;\n\t\t}\n\n\t\tconst parsedUrl = nodeurl.parse(url); // Coming from Node's URL, sticking with that.\n\n\t\tconst hostname = parsedUrl.hostname;\n\t\tif (hostname === 'localhost' || hostname === '127.0.0.1' || hostname === '::1' || hostname === '::ffff:127.0.0.1') {\n\t\t\tlocalhostCount++;\n\t\t\tcallback('DIRECT');\n\t\t\textHostLogService.trace('ProxyResolver#resolveProxy localhost', url, 'DIRECT');\n\t\t\treturn;\n\t\t}\n\n\t\tif (typeof hostname === 'string' && envNoProxy(hostname, String(parsedUrl.port || (<any>opts.agent).defaultPort))) {\n\t\t\tenvNoProxyCount++;\n\t\t\tcallback('DIRECT');\n\t\t\textHostLogService.trace('ProxyResolver#resolveProxy envNoProxy', url, 'DIRECT');\n\t\t\treturn;\n\t\t}\n\n\t\tif (settingsProxy) {\n\t\t\tsettingsCount++;\n\t\t\tcallback(settingsProxy);\n\t\t\textHostLogService.trace('ProxyResolver#resolveProxy settings', url, settingsProxy);\n\t\t\treturn;\n\t\t}\n\n\t\tif (envProxy) {\n\t\t\tenvCount++;\n\t\t\tcallback(envProxy);\n\t\t\textHostLogService.trace('ProxyResolver#resolveProxy env', url, envProxy);\n\t\t\treturn;\n\t\t}\n\n\t\tconst key = getCacheKey(parsedUrl);\n\t\tconst proxy = getCachedProxy(key);\n\t\tif (proxy) {\n\t\t\tcacheCount++;\n\t\t\tcollectResult(results, proxy, parsedUrl.protocol === 'https:' ? 'HTTPS' : 'HTTP', req);\n\t\t\tcallback(proxy);\n\t\t\textHostLogService.trace('ProxyResolver#resolveProxy cached', url, proxy);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!useHostProxy) {\n\t\t\tcallback('DIRECT');\n\t\t\textHostLogService.trace('ProxyResolver#resolveProxy unconfigured', url, 'DIRECT');\n\t\t\treturn;\n\t\t}\n\n\t\tconst start = Date.now();\n\t\textHostWorkspace.resolveProxy(url) // Use full URL to ensure it is an actually used one.\n\t\t\t.then(proxy => {\n\t\t\t\tif (proxy) {\n\t\t\t\t\tcacheProxy(key, proxy);\n\t\t\t\t\tcollectResult(results, proxy, parsedUrl.protocol === 'https:' ? 'HTTPS' : 'HTTP', req);\n\t\t\t\t}\n\t\t\t\tcallback(proxy);\n\t\t\t\textHostLogService.debug('ProxyResolver#resolveProxy', url, proxy);\n\t\t\t}).then(() => {\n\t\t\t\tcount++;\n\t\t\t\tduration = Date.now() - start + duration;\n\t\t\t}, err => {\n\t\t\t\terrorCount++;\n\t\t\t\tcallback();\n\t\t\t\textHostLogService.error('ProxyResolver#resolveProxy', toErrorMessage(err));\n\t\t\t});\n\t}\n\n\treturn resolveProxy;\n}\n\nfunction collectResult(results: ConnectionResult[], resolveProxy: string, connection: string, req: http.ClientRequest) {\n\tconst proxy = resolveProxy ? String(resolveProxy).trim().split(/\\s+/, 1)[0] : 'EMPTY';\n\treq.on('response', res => {\n\t\tconst code = `HTTP_${res.statusCode}`;\n\t\tconst result = findOrCreateResult(results, proxy, connection, code);\n\t\tresult.count++;\n\t});\n\treq.on('error', err => {\n\t\tconst code = err && typeof (<any>err).code === 'string' && (<any>err).code || 'UNKNOWN_ERROR';\n\t\tconst result = findOrCreateResult(results, proxy, connection, code);\n\t\tresult.count++;\n\t});\n}\n\nfunction findOrCreateResult(results: ConnectionResult[], proxy: string, connection: string, code: string): ConnectionResult {\n\tfor (const result of results) {\n\t\tif (result.proxy === proxy && result.connection === connection && result.code === code) {\n\t\t\treturn result;\n\t\t}\n\t}\n\tconst result = { proxy, connection, code, count: 0 };\n\tresults.push(result);\n\treturn result;\n}\n\nfunction proxyFromConfigURL(configURL: string | undefined) {\n\tconst url = (configURL || '').trim();\n\tconst i = url.indexOf('://');\n\tif (i === -1) {\n\t\treturn undefined;\n\t}\n\tconst scheme = url.substr(0, i).toLowerCase();\n\tconst proxy = url.substr(i + 3);\n\tif (scheme === 'http') {\n\t\treturn 'PROXY ' + proxy;\n\t} else if (scheme === 'https') {\n\t\treturn 'HTTPS ' + proxy;\n\t} else if (scheme === 'socks') {\n\t\treturn 'SOCKS ' + proxy;\n\t}\n\treturn undefined;\n}\n\nfunction noProxyFromEnv(envValue?: string) {\n\tconst value = (envValue || '')\n\t\t.trim()\n\t\t.toLowerCase();\n\n\tif (value === '*') {\n\t\treturn () => true;\n\t}\n\n\tconst filters = value\n\t\t.split(',')\n\t\t.map(s => s.trim().split(':', 2))\n\t\t.map(([name, port]) => ({ name, port }))\n\t\t.filter(filter => !!filter.name)\n\t\t.map(({ name, port }) => {\n\t\t\tconst domain = name[0] === '.' ? name : `.${name}`;\n\t\t\treturn { domain, port };\n\t\t});\n\tif (!filters.length) {\n\t\treturn () => false;\n\t}\n\treturn (hostname: string, port: string) => filters.some(({ domain, port: filterPort }) => {\n\t\treturn `.${hostname.toLowerCase()}`.endsWith(domain) && (!filterPort || port === filterPort);\n\t});\n}\n\nfunction createPatchedModules(configProvider: ExtHostConfigProvider, resolveProxy: ReturnType<typeof setupProxyResolution>) {\n\tconst proxySetting = {\n\t\tconfig: configProvider.getConfiguration('http')\n\t\t\t.get<string>('proxySupport') || 'off'\n\t};\n\tconfigProvider.onDidChangeConfiguration(e => {\n\t\tproxySetting.config = configProvider.getConfiguration('http')\n\t\t\t.get<string>('proxySupport') || 'off';\n\t});\n\tconst certSetting = {\n\t\tconfig: !!configProvider.getConfiguration('http')\n\t\t\t.get<boolean>('systemCertificates')\n\t};\n\tconfigProvider.onDidChangeConfiguration(e => {\n\t\tcertSetting.config = !!configProvider.getConfiguration('http')\n\t\t\t.get<boolean>('systemCertificates');\n\t});\n\n\treturn {\n\t\thttp: {\n\t\t\toff: Object.assign({}, http, patches(http, resolveProxy, { config: 'off' }, certSetting, true)),\n\t\t\ton: Object.assign({}, http, patches(http, resolveProxy, { config: 'on' }, certSetting, true)),\n\t\t\toverride: Object.assign({}, http, patches(http, resolveProxy, { config: 'override' }, certSetting, true)),\n\t\t\tonRequest: Object.assign({}, http, patches(http, resolveProxy, proxySetting, certSetting, true)),\n\t\t\tdefault: Object.assign(http, patches(http, resolveProxy, proxySetting, certSetting, false)) // run last\n\t\t} as Record<string, typeof http>,\n\t\thttps: {\n\t\t\toff: Object.assign({}, https, patches(https, resolveProxy, { config: 'off' }, certSetting, true)),\n\t\t\ton: Object.assign({}, https, patches(https, resolveProxy, { config: 'on' }, certSetting, true)),\n\t\t\toverride: Object.assign({}, https, patches(https, resolveProxy, { config: 'override' }, certSetting, true)),\n\t\t\tonRequest: Object.assign({}, https, patches(https, resolveProxy, proxySetting, certSetting, true)),\n\t\t\tdefault: Object.assign(https, patches(https, resolveProxy, proxySetting, certSetting, false)) // run last\n\t\t} as Record<string, typeof https>,\n\t\ttls: Object.assign(tls, tlsPatches(tls))\n\t};\n}\n\nfunction patches(originals: typeof http | typeof https, resolveProxy: ReturnType<typeof setupProxyResolution>, proxySetting: { config: string }, certSetting: { config: boolean }, onRequest: boolean) {\n\treturn {\n\t\tget: patch(originals.get),\n\t\trequest: patch(originals.request)\n\t};\n\n\tfunction patch(original: typeof http.get) {\n\t\tfunction patched(url?: string | URL | null, options?: http.RequestOptions | null, callback?: (res: http.IncomingMessage) => void): http.ClientRequest {\n\t\t\tif (typeof url !== 'string' && !(url && (<any>url).searchParams)) {\n\t\t\t\tcallback = <any>options;\n\t\t\t\toptions = url;\n\t\t\t\turl = null;\n\t\t\t}\n\t\t\tif (typeof options === 'function') {\n\t\t\t\tcallback = options;\n\t\t\t\toptions = null;\n\t\t\t}\n\t\t\toptions = options || {};\n\n\t\t\tif (options.socketPath) {\n\t\t\t\treturn original.apply(null, arguments as any);\n\t\t\t}\n\n\t\t\tconst originalAgent = options.agent;\n\t\t\tif (originalAgent === true) {\n\t\t\t\tthrow new Error('Unexpected agent option: true');\n\t\t\t}\n\t\t\tconst optionsPatched = originalAgent instanceof ProxyAgent;\n\t\t\tconst config = onRequest && ((<any>options)._vscodeProxySupport || /* LS */ (<any>options)._vscodeSystemProxy) || proxySetting.config;\n\t\t\tconst useProxySettings = !optionsPatched && (config === 'override' || config === 'on' && originalAgent === undefined);\n\t\t\tconst useSystemCertificates = !optionsPatched && certSetting.config && originals === https && !(options as https.RequestOptions).ca;\n\n\t\t\tif (useProxySettings || useSystemCertificates) {\n\t\t\t\tif (url) {\n\t\t\t\t\tconst parsed = typeof url === 'string' ? new nodeurl.URL(url) : url;\n\t\t\t\t\tconst urlOptions = {\n\t\t\t\t\t\tprotocol: parsed.protocol,\n\t\t\t\t\t\thostname: parsed.hostname.lastIndexOf('[', 0) === 0 ? parsed.hostname.slice(1, -1) : parsed.hostname,\n\t\t\t\t\t\tport: parsed.port,\n\t\t\t\t\t\tpath: `${parsed.pathname}${parsed.search}`\n\t\t\t\t\t};\n\t\t\t\t\tif (parsed.username || parsed.password) {\n\t\t\t\t\t\toptions.auth = `${parsed.username}:${parsed.password}`;\n\t\t\t\t\t}\n\t\t\t\t\toptions = { ...urlOptions, ...options };\n\t\t\t\t} else {\n\t\t\t\t\toptions = { ...options };\n\t\t\t\t}\n\t\t\t\toptions.agent = new ProxyAgent({\n\t\t\t\t\tresolveProxy: resolveProxy.bind(undefined, { useProxySettings, useSystemCertificates }),\n\t\t\t\t\tdefaultPort: originals === https ? 443 : 80,\n\t\t\t\t\toriginalAgent\n\t\t\t\t});\n\t\t\t\treturn original(options, callback);\n\t\t\t}\n\n\t\t\treturn original.apply(null, arguments as any);\n\t\t}\n\t\treturn patched;\n\t}\n}\n\nfunction tlsPatches(originals: typeof tls) {\n\treturn {\n\t\tcreateSecureContext: patch(originals.createSecureContext)\n\t};\n\n\tfunction patch(original: typeof tls.createSecureContext): typeof tls.createSecureContext {\n\t\treturn function (details?: tls.SecureContextOptions): ReturnType<typeof tls.createSecureContext> {\n\t\t\tconst context = original.apply(null, arguments as any);\n\t\t\tconst certs = (details as any)._vscodeAdditionalCaCerts;\n\t\t\tif (certs) {\n\t\t\t\tfor (const cert of certs) {\n\t\t\t\t\tcontext.context.addCACert(cert);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn context;\n\t\t};\n\t}\n}\n\nconst modulesCache = new Map<IExtensionDescription | undefined, { http?: typeof http, https?: typeof https }>();\nfunction configureModuleLoading(extensionService: ExtHostExtensionService, lookup: ReturnType<typeof createPatchedModules>): Promise<void> {\n\treturn extensionService.getExtensionPathIndex()\n\t\t.then(extensionPaths => {\n\t\t\tconst node_module = <any>require.__$__nodeRequire('module');\n\t\t\tconst original = node_module._load;\n\t\t\tnode_module._load = function load(request: string, parent: any, isMain: any) {\n\t\t\t\tif (request === 'tls') {\n\t\t\t\t\treturn lookup.tls;\n\t\t\t\t}\n\n\t\t\t\tif (request !== 'http' && request !== 'https') {\n\t\t\t\t\treturn original.apply(this, arguments);\n\t\t\t\t}\n\n\t\t\t\tconst modules = lookup[request];\n\t\t\t\tconst ext = extensionPaths.findSubstr(URI.file(parent.filename).fsPath);\n\t\t\t\tlet cache = modulesCache.get(ext);\n\t\t\t\tif (!cache) {\n\t\t\t\t\tmodulesCache.set(ext, cache = {});\n\t\t\t\t}\n\t\t\t\tif (!cache[request]) {\n\t\t\t\t\tlet mod = modules.default;\n\t\t\t\t\tif (ext && ext.enableProposedApi) {\n\t\t\t\t\t\tmod = (modules as any)[(<any>ext).proxySupport] || modules.onRequest;\n\t\t\t\t\t}\n\t\t\t\t\tcache[request] = <any>{ ...mod }; // Copy to work around #93167.\n\t\t\t\t}\n\t\t\t\treturn cache[request];\n\t\t\t};\n\t\t});\n}\n\nfunction useSystemCertificates(extHostLogService: ILogService, useSystemCertificates: boolean, opts: http.RequestOptions, callback: () => void) {\n\tif (useSystemCertificates) {\n\t\tgetCaCertificates(extHostLogService)\n\t\t\t.then(caCertificates => {\n\t\t\t\tif (caCertificates) {\n\t\t\t\t\tif (caCertificates.append) {\n\t\t\t\t\t\t(opts as any)._vscodeAdditionalCaCerts = caCertificates.certs;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t(opts as https.RequestOptions).ca = caCertificates.certs;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcallback();\n\t\t\t})\n\t\t\t.catch(err => {\n\t\t\t\textHostLogService.error('ProxyResolver#useSystemCertificates', toErrorMessage(err));\n\t\t\t});\n\t} else {\n\t\tcallback();\n\t}\n}\n\nlet _caCertificates: ReturnType<typeof readCaCertificates> | Promise<undefined>;\nasync function getCaCertificates(extHostLogService: ILogService) {\n\tif (!_caCertificates) {\n\t\t_caCertificates = readCaCertificates()\n\t\t\t.then(res => {\n\t\t\t\textHostLogService.debug('ProxyResolver#getCaCertificates count', res && res.certs.length);\n\t\t\t\treturn res && res.certs.length ? res : undefined;\n\t\t\t})\n\t\t\t.catch(err => {\n\t\t\t\textHostLogService.error('ProxyResolver#getCaCertificates error', toErrorMessage(err));\n\t\t\t\treturn undefined;\n\t\t\t});\n\t}\n\treturn _caCertificates;\n}\n\nasync function readCaCertificates() {\n\tif (process.platform === 'win32') {\n\t\treturn readWindowsCaCertificates();\n\t}\n\tif (process.platform === 'darwin') {\n\t\treturn readMacCaCertificates();\n\t}\n\tif (process.platform === 'linux') {\n\t\treturn readLinuxCaCertificates();\n\t}\n\treturn undefined;\n}\n\nasync function readWindowsCaCertificates() {\n\t// @ts-ignore Windows only\n\tconst winCA = await import('vscode-windows-ca-certs');\n\n\tlet ders: any[] = [];\n\tconst store = new winCA.Crypt32();\n\ttry {\n\t\tlet der: any;\n\t\twhile (der = store.next()) {\n\t\t\tders.push(der);\n\t\t}\n\t} finally {\n\t\tstore.done();\n\t}\n\n\tconst certs = new Set(ders.map(derToPem));\n\treturn {\n\t\tcerts: Array.from(certs),\n\t\tappend: true\n\t};\n}\n\nasync function readMacCaCertificates() {\n\tconst stdout = await new Promise<string>((resolve, reject) => {\n\t\tconst child = cp.spawn('/usr/bin/security', ['find-certificate', '-a', '-p']);\n\t\tconst stdout: string[] = [];\n\t\tchild.stdout.setEncoding('utf8');\n\t\tchild.stdout.on('data', str => stdout.push(str));\n\t\tchild.on('error', reject);\n\t\tchild.on('exit', code => code ? reject(code) : resolve(stdout.join('')));\n\t});\n\tconst certs = new Set(stdout.split(/(?=-----BEGIN CERTIFICATE-----)/g)\n\t\t.filter(pem => !!pem.length));\n\treturn {\n\t\tcerts: Array.from(certs),\n\t\tappend: true\n\t};\n}\n\nconst linuxCaCertificatePaths = [\n\t'/etc/ssl/certs/ca-certificates.crt',\n\t'/etc/ssl/certs/ca-bundle.crt',\n];\n\nasync function readLinuxCaCertificates() {\n\tfor (const certPath of linuxCaCertificatePaths) {\n\t\ttry {\n\t\t\tconst content = await promisify(fs.readFile)(certPath, { encoding: 'utf8' });\n\t\t\tconst certs = new Set(content.split(/(?=-----BEGIN CERTIFICATE-----)/g)\n\t\t\t\t.filter(pem => !!pem.length));\n\t\t\treturn {\n\t\t\t\tcerts: Array.from(certs),\n\t\t\t\tappend: false\n\t\t\t};\n\t\t} catch (err) {\n\t\t\tif (err.code !== 'ENOENT') {\n\t\t\t\tthrow err;\n\t\t\t}\n\t\t}\n\t}\n\treturn undefined;\n}\n\nfunction derToPem(blob: Buffer) {\n\tconst lines = ['-----BEGIN CERTIFICATE-----'];\n\tconst der = blob.toString('base64');\n\tfor (let i = 0; i < der.length; i += 64) {\n\t\tlines.push(der.substr(i, 64));\n\t}\n\tlines.push('-----END CERTIFICATE-----', '');\n\treturn lines.join(os.EOL);\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as cp from 'child_process';\nimport * as path from 'vs/base/common/path';\nimport * as glob from 'vs/base/common/glob';\nimport { normalizeNFD } from 'vs/base/common/normalization';\nimport * as extpath from 'vs/base/common/extpath';\nimport { isMacintosh as isMac } from 'vs/base/common/platform';\nimport * as strings from 'vs/base/common/strings';\nimport { IFileQuery, IFolderQuery } from 'vs/workbench/services/search/common/search';\nimport { anchorGlob } from 'vs/workbench/services/search/node/ripgrepSearchUtils';\nimport { rgPath } from 'vscode-ripgrep';\n\n// If vscode-ripgrep is in an .asar file, then the binary is unpacked.\nconst rgDiskPath = rgPath.replace(/\\bnode_modules\\.asar\\b/, 'node_modules.asar.unpacked');\n\nexport function spawnRipgrepCmd(config: IFileQuery, folderQuery: IFolderQuery, includePattern?: glob.IExpression, excludePattern?: glob.IExpression) {\n\tconst rgArgs = getRgArgs(config, folderQuery, includePattern, excludePattern);\n\tconst cwd = folderQuery.folder.fsPath;\n\treturn {\n\t\tcmd: cp.spawn(rgDiskPath, rgArgs.args, { cwd }),\n\t\trgDiskPath,\n\t\tsiblingClauses: rgArgs.siblingClauses,\n\t\trgArgs,\n\t\tcwd\n\t};\n}\n\nfunction getRgArgs(config: IFileQuery, folderQuery: IFolderQuery, includePattern?: glob.IExpression, excludePattern?: glob.IExpression) {\n\tconst args = ['--files', '--hidden', '--case-sensitive'];\n\n\t// includePattern can't have siblingClauses\n\tfoldersToIncludeGlobs([folderQuery], includePattern, false).forEach(globArg => {\n\t\tconst inclusion = anchorGlob(globArg);\n\t\targs.push('-g', inclusion);\n\t\tif (isMac) {\n\t\t\tconst normalized = normalizeNFD(inclusion);\n\t\t\tif (normalized !== inclusion) {\n\t\t\t\targs.push('-g', normalized);\n\t\t\t}\n\t\t}\n\t});\n\n\tconst rgGlobs = foldersToRgExcludeGlobs([folderQuery], excludePattern, undefined, false);\n\trgGlobs.globArgs.forEach(globArg => {\n\t\tconst exclusion = `!${anchorGlob(globArg)}`;\n\t\targs.push('-g', exclusion);\n\t\tif (isMac) {\n\t\t\tconst normalized = normalizeNFD(exclusion);\n\t\t\tif (normalized !== exclusion) {\n\t\t\t\targs.push('-g', normalized);\n\t\t\t}\n\t\t}\n\t});\n\tif (folderQuery.disregardIgnoreFiles !== false) {\n\t\t// Don't use .gitignore or .ignore\n\t\targs.push('--no-ignore');\n\t} else {\n\t\targs.push('--no-ignore-parent');\n\t}\n\n\t// Follow symlinks\n\tif (!folderQuery.ignoreSymlinks) {\n\t\targs.push('--follow');\n\t}\n\n\tif (config.exists) {\n\t\targs.push('--quiet');\n\t}\n\n\targs.push('--no-config');\n\tif (folderQuery.disregardGlobalIgnoreFiles) {\n\t\targs.push('--no-ignore-global');\n\t}\n\n\treturn {\n\t\targs,\n\t\tsiblingClauses: rgGlobs.siblingClauses\n\t};\n}\n\nexport interface IRgGlobResult {\n\tglobArgs: string[];\n\tsiblingClauses: glob.IExpression;\n}\n\nexport function foldersToRgExcludeGlobs(folderQueries: IFolderQuery[], globalExclude?: glob.IExpression, excludesToSkip?: Set<string>, absoluteGlobs = true): IRgGlobResult {\n\tconst globArgs: string[] = [];\n\tlet siblingClauses: glob.IExpression = {};\n\tfolderQueries.forEach(folderQuery => {\n\t\tconst totalExcludePattern = Object.assign({}, folderQuery.excludePattern || {}, globalExclude || {});\n\t\tconst result = globExprsToRgGlobs(totalExcludePattern, absoluteGlobs ? folderQuery.folder.fsPath : undefined, excludesToSkip);\n\t\tglobArgs.push(...result.globArgs);\n\t\tif (result.siblingClauses) {\n\t\t\tsiblingClauses = Object.assign(siblingClauses, result.siblingClauses);\n\t\t}\n\t});\n\n\treturn { globArgs, siblingClauses };\n}\n\nexport function foldersToIncludeGlobs(folderQueries: IFolderQuery[], globalInclude?: glob.IExpression, absoluteGlobs = true): string[] {\n\tconst globArgs: string[] = [];\n\tfolderQueries.forEach(folderQuery => {\n\t\tconst totalIncludePattern = Object.assign({}, globalInclude || {}, folderQuery.includePattern || {});\n\t\tconst result = globExprsToRgGlobs(totalIncludePattern, absoluteGlobs ? folderQuery.folder.fsPath : undefined);\n\t\tglobArgs.push(...result.globArgs);\n\t});\n\n\treturn globArgs;\n}\n\nfunction globExprsToRgGlobs(patterns: glob.IExpression, folder?: string, excludesToSkip?: Set<string>): IRgGlobResult {\n\tconst globArgs: string[] = [];\n\tconst siblingClauses: glob.IExpression = {};\n\tObject.keys(patterns)\n\t\t.forEach(key => {\n\t\t\tif (excludesToSkip && excludesToSkip.has(key)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!key) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst value = patterns[key];\n\t\t\tkey = trimTrailingSlash(folder ? getAbsoluteGlob(folder, key) : key);\n\n\t\t\t// glob.ts requires forward slashes, but a UNC path still must start with \\\\\n\t\t\t// #38165 and #38151\n\t\t\tif (key.startsWith('\\\\\\\\')) {\n\t\t\t\tkey = '\\\\\\\\' + key.substr(2).replace(/\\\\/g, '/');\n\t\t\t} else {\n\t\t\t\tkey = key.replace(/\\\\/g, '/');\n\t\t\t}\n\n\t\t\tif (typeof value === 'boolean' && value) {\n\t\t\t\tif (key.startsWith('\\\\\\\\')) {\n\t\t\t\t\t// Absolute globs UNC paths don't work properly, see #58758\n\t\t\t\t\tkey += '**';\n\t\t\t\t}\n\n\t\t\t\tglobArgs.push(fixDriveC(key));\n\t\t\t} else if (value && value.when) {\n\t\t\t\tsiblingClauses[key] = value;\n\t\t\t}\n\t\t});\n\n\treturn { globArgs, siblingClauses };\n}\n\n/**\n * Resolves a glob like \"node_modules/**\" in \"/foo/bar\" to \"/foo/bar/node_modules/**\".\n * Special cases C:/foo paths to write the glob like /foo instead - see https://github.com/BurntSushi/ripgrep/issues/530.\n *\n * Exported for testing\n */\nexport function getAbsoluteGlob(folder: string, key: string): string {\n\treturn path.isAbsolute(key) ?\n\t\tkey :\n\t\tpath.join(folder, key);\n}\n\nfunction trimTrailingSlash(str: string): string {\n\tstr = strings.rtrim(str, '\\\\');\n\treturn strings.rtrim(str, '/');\n}\n\nexport function fixDriveC(path: string): string {\n\tconst root = extpath.getRoot(path);\n\treturn root.toLowerCase() === 'c:/' ?\n\t\tpath.replace(/^c:[/\\\\]/i, '/') :\n\t\tpath;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as childProcess from 'child_process';\nimport * as fs from 'fs';\nimport * as path from 'vs/base/common/path';\nimport { Readable } from 'stream';\nimport { StringDecoder } from 'string_decoder';\nimport * as arrays from 'vs/base/common/arrays';\nimport { toErrorMessage } from 'vs/base/common/errorMessage';\nimport * as glob from 'vs/base/common/glob';\nimport * as normalization from 'vs/base/common/normalization';\nimport { isEqualOrParent } from 'vs/base/common/extpath';\nimport * as platform from 'vs/base/common/platform';\nimport { StopWatch } from 'vs/base/common/stopwatch';\nimport * as strings from 'vs/base/common/strings';\nimport * as types from 'vs/base/common/types';\nimport { URI } from 'vs/base/common/uri';\nimport { readdir } from 'vs/base/node/pfs';\nimport { IFileQuery, IFolderQuery, IProgressMessage, ISearchEngineStats, IRawFileMatch, ISearchEngine, ISearchEngineSuccess, isFilePatternMatch } from 'vs/workbench/services/search/common/search';\nimport { spawnRipgrepCmd } from './ripgrepFileSearch';\nimport { prepareQuery } from 'vs/base/common/fuzzyScorer';\n\ninterface IDirectoryEntry extends IRawFileMatch {\n\tbase: string;\n\tbasename: string;\n}\n\ninterface IDirectoryTree {\n\trootEntries: IDirectoryEntry[];\n\tpathToEntries: { [relativePath: string]: IDirectoryEntry[] };\n}\n\nconst killCmds = new Set<() => void>();\nprocess.on('exit', () => {\n\tkillCmds.forEach(cmd => cmd());\n});\n\nexport class FileWalker {\n\tprivate config: IFileQuery;\n\tprivate filePattern: string;\n\tprivate normalizedFilePatternLowercase: string | null = null;\n\tprivate includePattern: glob.ParsedExpression | undefined;\n\tprivate maxResults: number | null;\n\tprivate exists: boolean;\n\tprivate maxFilesize: number | null = null;\n\tprivate isLimitHit: boolean;\n\tprivate resultCount: number;\n\tprivate isCanceled = false;\n\tprivate fileWalkSW: StopWatch | null = null;\n\tprivate directoriesWalked: number;\n\tprivate filesWalked: number;\n\tprivate errors: string[];\n\tprivate cmdSW: StopWatch | null = null;\n\tprivate cmdResultCount: number = 0;\n\n\tprivate folderExcludePatterns: Map<string, AbsoluteAndRelativeParsedExpression>;\n\tprivate globalExcludePattern: glob.ParsedExpression | undefined;\n\n\tprivate walkedPaths: { [path: string]: boolean; };\n\n\tconstructor(config: IFileQuery) {\n\t\tthis.config = config;\n\t\tthis.filePattern = config.filePattern || '';\n\t\tthis.includePattern = config.includePattern && glob.parse(config.includePattern);\n\t\tthis.maxResults = config.maxResults || null;\n\t\tthis.exists = !!config.exists;\n\t\tthis.walkedPaths = Object.create(null);\n\t\tthis.resultCount = 0;\n\t\tthis.isLimitHit = false;\n\t\tthis.directoriesWalked = 0;\n\t\tthis.filesWalked = 0;\n\t\tthis.errors = [];\n\n\t\tif (this.filePattern) {\n\t\t\tthis.normalizedFilePatternLowercase = prepareQuery(this.filePattern).normalizedLowercase;\n\t\t}\n\n\t\tthis.globalExcludePattern = config.excludePattern && glob.parse(config.excludePattern);\n\t\tthis.folderExcludePatterns = new Map<string, AbsoluteAndRelativeParsedExpression>();\n\n\t\tconfig.folderQueries.forEach(folderQuery => {\n\t\t\tconst folderExcludeExpression: glob.IExpression = Object.assign({}, folderQuery.excludePattern || {}, this.config.excludePattern || {});\n\n\t\t\t// Add excludes for other root folders\n\t\t\tconst fqPath = folderQuery.folder.fsPath;\n\t\t\tconfig.folderQueries\n\t\t\t\t.map(rootFolderQuery => rootFolderQuery.folder.fsPath)\n\t\t\t\t.filter(rootFolder => rootFolder !== fqPath)\n\t\t\t\t.forEach(otherRootFolder => {\n\t\t\t\t\t// Exclude nested root folders\n\t\t\t\t\tif (isEqualOrParent(otherRootFolder, fqPath)) {\n\t\t\t\t\t\tfolderExcludeExpression[path.relative(fqPath, otherRootFolder)] = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\tthis.folderExcludePatterns.set(fqPath, new AbsoluteAndRelativeParsedExpression(folderExcludeExpression, fqPath));\n\t\t});\n\t}\n\n\tcancel(): void {\n\t\tthis.isCanceled = true;\n\t}\n\n\twalk(folderQueries: IFolderQuery[], extraFiles: URI[], onResult: (result: IRawFileMatch) => void, onMessage: (message: IProgressMessage) => void, done: (error: Error | null, isLimitHit: boolean) => void): void {\n\t\tthis.fileWalkSW = StopWatch.create(false);\n\n\t\t// Support that the file pattern is a full path to a file that exists\n\t\tif (this.isCanceled) {\n\t\t\treturn done(null, this.isLimitHit);\n\t\t}\n\n\t\t// For each extra file\n\t\textraFiles.forEach(extraFilePath => {\n\t\t\tconst basename = path.basename(extraFilePath.fsPath);\n\t\t\tif (this.globalExcludePattern && this.globalExcludePattern(extraFilePath.fsPath, basename)) {\n\t\t\t\treturn; // excluded\n\t\t\t}\n\n\t\t\t// File: Check for match on file pattern and include pattern\n\t\t\tthis.matchFile(onResult, { relativePath: extraFilePath.fsPath /* no workspace relative path */, searchPath: undefined });\n\t\t});\n\n\t\tthis.cmdSW = StopWatch.create(false);\n\n\t\t// For each root folder\n\t\tthis.parallel<IFolderQuery, void>(folderQueries, (folderQuery: IFolderQuery, rootFolderDone: (err: Error | null, result: void) => void) => {\n\t\t\tthis.call(this.cmdTraversal, this, folderQuery, onResult, onMessage, (err?: Error) => {\n\t\t\t\tif (err) {\n\t\t\t\t\tconst errorMessage = toErrorMessage(err);\n\t\t\t\t\tconsole.error(errorMessage);\n\t\t\t\t\tthis.errors.push(errorMessage);\n\t\t\t\t\trootFolderDone(err, undefined);\n\t\t\t\t} else {\n\t\t\t\t\trootFolderDone(null, undefined);\n\t\t\t\t}\n\t\t\t});\n\t\t}, (errors, _result) => {\n\t\t\tthis.fileWalkSW!.stop();\n\t\t\tconst err = errors ? arrays.coalesce(errors)[0] : null;\n\t\t\tdone(err, this.isLimitHit);\n\t\t});\n\t}\n\n\tprivate parallel<T, E>(list: T[], fn: (item: T, callback: (err: Error | null, result: E | null) => void) => void, callback: (err: Array<Error | null> | null, result: E[]) => void): void {\n\t\tconst results = new Array(list.length);\n\t\tconst errors = new Array<Error | null>(list.length);\n\t\tlet didErrorOccur = false;\n\t\tlet doneCount = 0;\n\n\t\tif (list.length === 0) {\n\t\t\treturn callback(null, []);\n\t\t}\n\n\t\tlist.forEach((item, index) => {\n\t\t\tfn(item, (error, result) => {\n\t\t\t\tif (error) {\n\t\t\t\t\tdidErrorOccur = true;\n\t\t\t\t\tresults[index] = null;\n\t\t\t\t\terrors[index] = error;\n\t\t\t\t} else {\n\t\t\t\t\tresults[index] = result;\n\t\t\t\t\terrors[index] = null;\n\t\t\t\t}\n\n\t\t\t\tif (++doneCount === list.length) {\n\t\t\t\t\treturn callback(didErrorOccur ? errors : null, results);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tprivate call<F extends Function>(fun: F, that: any, ...args: any[]): void {\n\t\ttry {\n\t\t\tfun.apply(that, args);\n\t\t} catch (e) {\n\t\t\targs[args.length - 1](e);\n\t\t}\n\t}\n\n\tprivate cmdTraversal(folderQuery: IFolderQuery, onResult: (result: IRawFileMatch) => void, onMessage: (message: IProgressMessage) => void, cb: (err?: Error) => void): void {\n\t\tconst rootFolder = folderQuery.folder.fsPath;\n\t\tconst isMac = platform.isMacintosh;\n\t\tlet cmd: childProcess.ChildProcess;\n\t\tconst killCmd = () => cmd && cmd.kill();\n\t\tkillCmds.add(killCmd);\n\n\t\tlet done = (err?: Error) => {\n\t\t\tkillCmds.delete(killCmd);\n\t\t\tdone = () => { };\n\t\t\tcb(err);\n\t\t};\n\t\tlet leftover = '';\n\t\tconst tree = this.initDirectoryTree();\n\n\t\tlet noSiblingsClauses: boolean;\n\t\tconst ripgrep = spawnRipgrepCmd(this.config, folderQuery, this.config.includePattern, this.folderExcludePatterns.get(folderQuery.folder.fsPath)!.expression);\n\t\tcmd = ripgrep.cmd;\n\t\tnoSiblingsClauses = !Object.keys(ripgrep.siblingClauses).length;\n\n\t\tconst escapedArgs = ripgrep.rgArgs.args\n\t\t\t.map(arg => arg.match(/^-/) ? arg : `'${arg}'`)\n\t\t\t.join(' ');\n\n\t\tlet rgCmd = `${ripgrep.rgDiskPath} ${escapedArgs}\\n - cwd: ${ripgrep.cwd}`;\n\t\tif (ripgrep.rgArgs.siblingClauses) {\n\t\t\trgCmd += `\\n - Sibling clauses: ${JSON.stringify(ripgrep.rgArgs.siblingClauses)}`;\n\t\t}\n\t\tonMessage({ message: rgCmd });\n\n\t\tthis.cmdResultCount = 0;\n\t\tthis.collectStdout(cmd, 'utf8', onMessage, (err: Error | null, stdout?: string, last?: boolean) => {\n\t\t\tif (err) {\n\t\t\t\tdone(err);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this.isLimitHit) {\n\t\t\t\tdone();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Mac: uses NFD unicode form on disk, but we want NFC\n\t\t\tconst normalized = leftover + (isMac ? normalization.normalizeNFC(stdout || '') : stdout);\n\t\t\tconst relativeFiles = normalized.split('\\n');\n\n\t\t\tif (last) {\n\t\t\t\tconst n = relativeFiles.length;\n\t\t\t\trelativeFiles[n - 1] = relativeFiles[n - 1].trim();\n\t\t\t\tif (!relativeFiles[n - 1]) {\n\t\t\t\t\trelativeFiles.pop();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tleftover = relativeFiles.pop() || '';\n\t\t\t}\n\n\t\t\tif (relativeFiles.length && relativeFiles[0].indexOf('\\n') !== -1) {\n\t\t\t\tdone(new Error('Splitting up files failed'));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.cmdResultCount += relativeFiles.length;\n\n\t\t\tif (noSiblingsClauses) {\n\t\t\t\tfor (const relativePath of relativeFiles) {\n\t\t\t\t\tthis.matchFile(onResult, { base: rootFolder, relativePath, searchPath: this.getSearchPath(folderQuery, relativePath) });\n\t\t\t\t\tif (this.isLimitHit) {\n\t\t\t\t\t\tkillCmd();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (last || this.isLimitHit) {\n\t\t\t\t\tdone();\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// TODO: Optimize siblings clauses with ripgrep here.\n\t\t\tthis.addDirectoryEntries(folderQuery, tree, rootFolder, relativeFiles, onResult);\n\n\t\t\tif (last) {\n\t\t\t\tthis.matchDirectoryTree(tree, rootFolder, onResult);\n\t\t\t\tdone();\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Public for testing.\n\t */\n\tspawnFindCmd(folderQuery: IFolderQuery) {\n\t\tconst excludePattern = this.folderExcludePatterns.get(folderQuery.folder.fsPath)!;\n\t\tconst basenames = excludePattern.getBasenameTerms();\n\t\tconst pathTerms = excludePattern.getPathTerms();\n\t\tconst args = ['-L', '.'];\n\t\tif (basenames.length || pathTerms.length) {\n\t\t\targs.push('-not', '(', '(');\n\t\t\tfor (const basename of basenames) {\n\t\t\t\targs.push('-name', basename);\n\t\t\t\targs.push('-o');\n\t\t\t}\n\t\t\tfor (const path of pathTerms) {\n\t\t\t\targs.push('-path', path);\n\t\t\t\targs.push('-o');\n\t\t\t}\n\t\t\targs.pop();\n\t\t\targs.push(')', '-prune', ')');\n\t\t}\n\t\targs.push('-type', 'f');\n\t\treturn childProcess.spawn('find', args, { cwd: folderQuery.folder.fsPath });\n\t}\n\n\t/**\n\t * Public for testing.\n\t */\n\treadStdout(cmd: childProcess.ChildProcess, encoding: string, cb: (err: Error | null, stdout?: string) => void): void {\n\t\tlet all = '';\n\t\tthis.collectStdout(cmd, encoding, () => { }, (err: Error | null, stdout?: string, last?: boolean) => {\n\t\t\tif (err) {\n\t\t\t\tcb(err);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tall += stdout;\n\t\t\tif (last) {\n\t\t\t\tcb(null, all);\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate collectStdout(cmd: childProcess.ChildProcess, encoding: string, onMessage: (message: IProgressMessage) => void, cb: (err: Error | null, stdout?: string, last?: boolean) => void): void {\n\t\tlet onData = (err: Error | null, stdout?: string, last?: boolean) => {\n\t\t\tif (err || last) {\n\t\t\t\tonData = () => { };\n\n\t\t\t\tif (this.cmdSW) {\n\t\t\t\t\tthis.cmdSW.stop();\n\t\t\t\t}\n\t\t\t}\n\t\t\tcb(err, stdout, last);\n\t\t};\n\n\t\tlet gotData = false;\n\t\tif (cmd.stdout) {\n\t\t\t// Should be non-null, but #38195\n\t\t\tthis.forwardData(cmd.stdout, encoding, onData);\n\t\t\tcmd.stdout.once('data', () => gotData = true);\n\t\t} else {\n\t\t\tonMessage({ message: 'stdout is null' });\n\t\t}\n\n\t\tlet stderr: Buffer[];\n\t\tif (cmd.stderr) {\n\t\t\t// Should be non-null, but #38195\n\t\t\tstderr = this.collectData(cmd.stderr);\n\t\t} else {\n\t\t\tonMessage({ message: 'stderr is null' });\n\t\t}\n\n\t\tcmd.on('error', (err: Error) => {\n\t\t\tonData(err);\n\t\t});\n\n\t\tcmd.on('close', (code: number) => {\n\t\t\t// ripgrep returns code=1 when no results are found\n\t\t\tlet stderrText: string;\n\t\t\tif (!gotData && (stderrText = this.decodeData(stderr, encoding)) && rgErrorMsgForDisplay(stderrText)) {\n\t\t\t\tonData(new Error(`command failed with error code ${code}: ${this.decodeData(stderr, encoding)}`));\n\t\t\t} else {\n\t\t\t\tif (this.exists && code === 0) {\n\t\t\t\t\tthis.isLimitHit = true;\n\t\t\t\t}\n\t\t\t\tonData(null, '', true);\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate forwardData(stream: Readable, encoding: string, cb: (err: Error | null, stdout?: string) => void): StringDecoder {\n\t\tconst decoder = new StringDecoder(encoding);\n\t\tstream.on('data', (data: Buffer) => {\n\t\t\tcb(null, decoder.write(data));\n\t\t});\n\t\treturn decoder;\n\t}\n\n\tprivate collectData(stream: Readable): Buffer[] {\n\t\tconst buffers: Buffer[] = [];\n\t\tstream.on('data', (data: Buffer) => {\n\t\t\tbuffers.push(data);\n\t\t});\n\t\treturn buffers;\n\t}\n\n\tprivate decodeData(buffers: Buffer[], encoding: string): string {\n\t\tconst decoder = new StringDecoder(encoding);\n\t\treturn buffers.map(buffer => decoder.write(buffer)).join('');\n\t}\n\n\tprivate initDirectoryTree(): IDirectoryTree {\n\t\tconst tree: IDirectoryTree = {\n\t\t\trootEntries: [],\n\t\t\tpathToEntries: Object.create(null)\n\t\t};\n\t\ttree.pathToEntries['.'] = tree.rootEntries;\n\t\treturn tree;\n\t}\n\n\tprivate addDirectoryEntries(folderQuery: IFolderQuery, { pathToEntries }: IDirectoryTree, base: string, relativeFiles: string[], onResult: (result: IRawFileMatch) => void) {\n\t\t// Support relative paths to files from a root resource (ignores excludes)\n\t\tif (relativeFiles.indexOf(this.filePattern) !== -1) {\n\t\t\tthis.matchFile(onResult, {\n\t\t\t\tbase,\n\t\t\t\trelativePath: this.filePattern,\n\t\t\t\tsearchPath: this.getSearchPath(folderQuery, this.filePattern)\n\t\t\t});\n\t\t}\n\n\t\tconst add = (relativePath: string) => {\n\t\t\tconst basename = path.basename(relativePath);\n\t\t\tconst dirname = path.dirname(relativePath);\n\t\t\tlet entries = pathToEntries[dirname];\n\t\t\tif (!entries) {\n\t\t\t\tentries = pathToEntries[dirname] = [];\n\t\t\t\tadd(dirname);\n\t\t\t}\n\t\t\tentries.push({\n\t\t\t\tbase,\n\t\t\t\trelativePath,\n\t\t\t\tbasename,\n\t\t\t\tsearchPath: this.getSearchPath(folderQuery, relativePath),\n\t\t\t});\n\t\t};\n\t\trelativeFiles.forEach(add);\n\t}\n\n\tprivate matchDirectoryTree({ rootEntries, pathToEntries }: IDirectoryTree, rootFolder: string, onResult: (result: IRawFileMatch) => void) {\n\t\tconst self = this;\n\t\tconst excludePattern = this.folderExcludePatterns.get(rootFolder)!;\n\t\tconst filePattern = this.filePattern;\n\t\tfunction matchDirectory(entries: IDirectoryEntry[]) {\n\t\t\tself.directoriesWalked++;\n\t\t\tconst hasSibling = glob.hasSiblingFn(() => entries.map(entry => entry.basename));\n\t\t\tfor (let i = 0, n = entries.length; i < n; i++) {\n\t\t\t\tconst entry = entries[i];\n\t\t\t\tconst { relativePath, basename } = entry;\n\n\t\t\t\t// Check exclude pattern\n\t\t\t\t// If the user searches for the exact file name, we adjust the glob matching\n\t\t\t\t// to ignore filtering by siblings because the user seems to know what she\n\t\t\t\t// is searching for and we want to include the result in that case anyway\n\t\t\t\tif (excludePattern.test(relativePath, basename, filePattern !== basename ? hasSibling : undefined)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst sub = pathToEntries[relativePath];\n\t\t\t\tif (sub) {\n\t\t\t\t\tmatchDirectory(sub);\n\t\t\t\t} else {\n\t\t\t\t\tself.filesWalked++;\n\t\t\t\t\tif (relativePath === filePattern) {\n\t\t\t\t\t\tcontinue; // ignore file if its path matches with the file pattern because that is already matched above\n\t\t\t\t\t}\n\n\t\t\t\t\tself.matchFile(onResult, entry);\n\t\t\t\t}\n\n\t\t\t\tif (self.isLimitHit) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tmatchDirectory(rootEntries);\n\t}\n\n\tgetStats(): ISearchEngineStats {\n\t\treturn {\n\t\t\tcmdTime: this.cmdSW!.elapsed(),\n\t\t\tfileWalkTime: this.fileWalkSW!.elapsed(),\n\t\t\tdirectoriesWalked: this.directoriesWalked,\n\t\t\tfilesWalked: this.filesWalked,\n\t\t\tcmdResultCount: this.cmdResultCount\n\t\t};\n\t}\n\n\tprivate doWalk(folderQuery: IFolderQuery, relativeParentPath: string, files: string[], onResult: (result: IRawFileMatch) => void, done: (error?: Error) => void): void {\n\t\tconst rootFolder = folderQuery.folder;\n\n\t\t// Execute tasks on each file in parallel to optimize throughput\n\t\tconst hasSibling = glob.hasSiblingFn(() => files);\n\t\tthis.parallel(files, (file: string, clb: (error: Error | null, _?: any) => void): void => {\n\n\t\t\t// Check canceled\n\t\t\tif (this.isCanceled || this.isLimitHit) {\n\t\t\t\treturn clb(null);\n\t\t\t}\n\n\t\t\t// Check exclude pattern\n\t\t\t// If the user searches for the exact file name, we adjust the glob matching\n\t\t\t// to ignore filtering by siblings because the user seems to know what she\n\t\t\t// is searching for and we want to include the result in that case anyway\n\t\t\tconst currentRelativePath = relativeParentPath ? [relativeParentPath, file].join(path.sep) : file;\n\t\t\tif (this.folderExcludePatterns.get(folderQuery.folder.fsPath)!.test(currentRelativePath, file, this.config.filePattern !== file ? hasSibling : undefined)) {\n\t\t\t\treturn clb(null);\n\t\t\t}\n\n\t\t\t// Use lstat to detect links\n\t\t\tconst currentAbsolutePath = [rootFolder.fsPath, currentRelativePath].join(path.sep);\n\t\t\tfs.lstat(currentAbsolutePath, (error, lstat) => {\n\t\t\t\tif (error || this.isCanceled || this.isLimitHit) {\n\t\t\t\t\treturn clb(null);\n\t\t\t\t}\n\n\t\t\t\t// If the path is a link, we must instead use fs.stat() to find out if the\n\t\t\t\t// link is a directory or not because lstat will always return the stat of\n\t\t\t\t// the link which is always a file.\n\t\t\t\tthis.statLinkIfNeeded(currentAbsolutePath, lstat, (error, stat) => {\n\t\t\t\t\tif (error || this.isCanceled || this.isLimitHit) {\n\t\t\t\t\t\treturn clb(null);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Directory: Follow directories\n\t\t\t\t\tif (stat.isDirectory()) {\n\t\t\t\t\t\tthis.directoriesWalked++;\n\n\t\t\t\t\t\t// to really prevent loops with links we need to resolve the real path of them\n\t\t\t\t\t\treturn this.realPathIfNeeded(currentAbsolutePath, lstat, (error, realpath) => {\n\t\t\t\t\t\t\tif (error || this.isCanceled || this.isLimitHit) {\n\t\t\t\t\t\t\t\treturn clb(null);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\trealpath = realpath || '';\n\t\t\t\t\t\t\tif (this.walkedPaths[realpath]) {\n\t\t\t\t\t\t\t\treturn clb(null); // escape when there are cycles (can happen with symlinks)\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.walkedPaths[realpath] = true; // remember as walked\n\n\t\t\t\t\t\t\t// Continue walking\n\t\t\t\t\t\t\treturn readdir(currentAbsolutePath).then(children => {\n\t\t\t\t\t\t\t\tif (this.isCanceled || this.isLimitHit) {\n\t\t\t\t\t\t\t\t\treturn clb(null);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tthis.doWalk(folderQuery, currentRelativePath, children, onResult, err => clb(err || null));\n\t\t\t\t\t\t\t}, error => {\n\t\t\t\t\t\t\t\tclb(null);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// File: Check for match on file pattern and include pattern\n\t\t\t\t\telse {\n\t\t\t\t\t\tthis.filesWalked++;\n\t\t\t\t\t\tif (currentRelativePath === this.filePattern) {\n\t\t\t\t\t\t\treturn clb(null, undefined); // ignore file if its path matches with the file pattern because checkFilePatternRelativeMatch() takes care of those\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.maxFilesize && types.isNumber(stat.size) && stat.size > this.maxFilesize) {\n\t\t\t\t\t\t\treturn clb(null, undefined); // ignore file if max file size is hit\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.matchFile(onResult, {\n\t\t\t\t\t\t\tbase: rootFolder.fsPath,\n\t\t\t\t\t\t\trelativePath: currentRelativePath,\n\t\t\t\t\t\t\tsearchPath: this.getSearchPath(folderQuery, currentRelativePath),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// Unwind\n\t\t\t\t\treturn clb(null, undefined);\n\t\t\t\t});\n\t\t\t});\n\t\t}, (error: Array<Error | null> | null): void => {\n\t\t\tconst filteredErrors = error ? arrays.coalesce(error) : error; // find any error by removing null values first\n\t\t\treturn done(filteredErrors && filteredErrors.length > 0 ? filteredErrors[0] : undefined);\n\t\t});\n\t}\n\n\tprivate matchFile(onResult: (result: IRawFileMatch) => void, candidate: IRawFileMatch): void {\n\t\tif (this.isFileMatch(candidate) && (!this.includePattern || this.includePattern(candidate.relativePath, path.basename(candidate.relativePath)))) {\n\t\t\tthis.resultCount++;\n\n\t\t\tif (this.exists || (this.maxResults && this.resultCount > this.maxResults)) {\n\t\t\t\tthis.isLimitHit = true;\n\t\t\t}\n\n\t\t\tif (!this.isLimitHit) {\n\t\t\t\tonResult(candidate);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate isFileMatch(candidate: IRawFileMatch): boolean {\n\t\t// Check for search pattern\n\t\tif (this.filePattern) {\n\t\t\tif (this.filePattern === '*') {\n\t\t\t\treturn true; // support the all-matching wildcard\n\t\t\t}\n\n\t\t\tif (this.normalizedFilePatternLowercase) {\n\t\t\t\treturn isFilePatternMatch(candidate, this.normalizedFilePatternLowercase);\n\t\t\t}\n\t\t}\n\n\t\t// No patterns means we match all\n\t\treturn true;\n\t}\n\n\tprivate statLinkIfNeeded(path: string, lstat: fs.Stats, clb: (error: Error | null, stat: fs.Stats) => void): void {\n\t\tif (lstat.isSymbolicLink()) {\n\t\t\treturn fs.stat(path, clb); // stat the target the link points to\n\t\t}\n\n\t\treturn clb(null, lstat); // not a link, so the stat is already ok for us\n\t}\n\n\tprivate realPathIfNeeded(path: string, lstat: fs.Stats, clb: (error: Error | null, realpath?: string) => void): void {\n\t\tif (lstat.isSymbolicLink()) {\n\t\t\treturn fs.realpath(path, (error, realpath) => {\n\t\t\t\tif (error) {\n\t\t\t\t\treturn clb(error);\n\t\t\t\t}\n\n\t\t\t\treturn clb(null, realpath);\n\t\t\t});\n\t\t}\n\n\t\treturn clb(null, path);\n\t}\n\n\t/**\n\t * If we're searching for files in multiple workspace folders, then better prepend the\n\t * name of the workspace folder to the path of the file. This way we'll be able to\n\t * better filter files that are all on the top of a workspace folder and have all the\n\t * same name. A typical example are `package.json` or `README.md` files.\n\t */\n\tprivate getSearchPath(folderQuery: IFolderQuery, relativePath: string): string {\n\t\tif (folderQuery.folderName) {\n\t\t\treturn path.join(folderQuery.folderName, relativePath);\n\t\t}\n\t\treturn relativePath;\n\t}\n}\n\nexport class Engine implements ISearchEngine<IRawFileMatch> {\n\tprivate folderQueries: IFolderQuery[];\n\tprivate extraFiles: URI[];\n\tprivate walker: FileWalker;\n\n\tconstructor(config: IFileQuery) {\n\t\tthis.folderQueries = config.folderQueries;\n\t\tthis.extraFiles = config.extraFileResources || [];\n\n\t\tthis.walker = new FileWalker(config);\n\t}\n\n\tsearch(onResult: (result: IRawFileMatch) => void, onProgress: (progress: IProgressMessage) => void, done: (error: Error | null, complete: ISearchEngineSuccess) => void): void {\n\t\tthis.walker.walk(this.folderQueries, this.extraFiles, onResult, onProgress, (err: Error | null, isLimitHit: boolean) => {\n\t\t\tdone(err, {\n\t\t\t\tlimitHit: isLimitHit,\n\t\t\t\tstats: this.walker.getStats()\n\t\t\t});\n\t\t});\n\t}\n\n\tcancel(): void {\n\t\tthis.walker.cancel();\n\t}\n}\n\n/**\n * This class exists to provide one interface on top of two ParsedExpressions, one for absolute expressions and one for relative expressions.\n * The absolute and relative expressions don't \"have\" to be kept separate, but this keeps us from having to path.join every single\n * file searched, it's only used for a text search with a searchPath\n */\nclass AbsoluteAndRelativeParsedExpression {\n\tprivate absoluteParsedExpr: glob.ParsedExpression | undefined;\n\tprivate relativeParsedExpr: glob.ParsedExpression | undefined;\n\n\tconstructor(public expression: glob.IExpression, private root: string) {\n\t\tthis.init(expression);\n\t}\n\n\t/**\n\t * Split the IExpression into its absolute and relative components, and glob.parse them separately.\n\t */\n\tprivate init(expr: glob.IExpression): void {\n\t\tlet absoluteGlobExpr: glob.IExpression | undefined;\n\t\tlet relativeGlobExpr: glob.IExpression | undefined;\n\t\tObject.keys(expr)\n\t\t\t.filter(key => expr[key])\n\t\t\t.forEach(key => {\n\t\t\t\tif (path.isAbsolute(key)) {\n\t\t\t\t\tabsoluteGlobExpr = absoluteGlobExpr || glob.getEmptyExpression();\n\t\t\t\t\tabsoluteGlobExpr[key] = expr[key];\n\t\t\t\t} else {\n\t\t\t\t\trelativeGlobExpr = relativeGlobExpr || glob.getEmptyExpression();\n\t\t\t\t\trelativeGlobExpr[key] = expr[key];\n\t\t\t\t}\n\t\t\t});\n\n\t\tthis.absoluteParsedExpr = absoluteGlobExpr && glob.parse(absoluteGlobExpr, { trimForExclusions: true });\n\t\tthis.relativeParsedExpr = relativeGlobExpr && glob.parse(relativeGlobExpr, { trimForExclusions: true });\n\t}\n\n\ttest(_path: string, basename?: string, hasSibling?: (name: string) => boolean | Promise<boolean>): string | Promise<string | null> | undefined | null {\n\t\treturn (this.relativeParsedExpr && this.relativeParsedExpr(_path, basename, hasSibling)) ||\n\t\t\t(this.absoluteParsedExpr && this.absoluteParsedExpr(path.join(this.root, _path), basename, hasSibling));\n\t}\n\n\tgetBasenameTerms(): string[] {\n\t\tconst basenameTerms: string[] = [];\n\t\tif (this.absoluteParsedExpr) {\n\t\t\tbasenameTerms.push(...glob.getBasenameTerms(this.absoluteParsedExpr));\n\t\t}\n\n\t\tif (this.relativeParsedExpr) {\n\t\t\tbasenameTerms.push(...glob.getBasenameTerms(this.relativeParsedExpr));\n\t\t}\n\n\t\treturn basenameTerms;\n\t}\n\n\tgetPathTerms(): string[] {\n\t\tconst pathTerms: string[] = [];\n\t\tif (this.absoluteParsedExpr) {\n\t\t\tpathTerms.push(...glob.getPathTerms(this.absoluteParsedExpr));\n\t\t}\n\n\t\tif (this.relativeParsedExpr) {\n\t\t\tpathTerms.push(...glob.getPathTerms(this.relativeParsedExpr));\n\t\t}\n\n\t\treturn pathTerms;\n\t}\n}\n\nexport function rgErrorMsgForDisplay(msg: string): string | undefined {\n\tconst lines = msg.trim().split('\\n');\n\tconst firstLine = lines[0].trim();\n\n\tif (firstLine.startsWith('Error parsing regex')) {\n\t\treturn firstLine;\n\t}\n\n\tif (firstLine.startsWith('regex parse error')) {\n\t\treturn strings.uppercaseFirstLetter(lines[lines.length - 1].trim());\n\t}\n\n\tif (firstLine.startsWith('error parsing glob') ||\n\t\tfirstLine.startsWith('unsupported encoding')) {\n\t\t// Uppercase first letter\n\t\treturn firstLine.charAt(0).toUpperCase() + firstLine.substr(1);\n\t}\n\n\tif (firstLine === `Literal '\\\\n' not allowed.`) {\n\t\t// I won't localize this because none of the Ripgrep error messages are localized\n\t\treturn `Literal '\\\\n' currently not supported`;\n\t}\n\n\tif (firstLine.startsWith('Literal ')) {\n\t\t// Other unsupported chars\n\t\treturn firstLine;\n\t}\n\n\treturn undefined;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as cp from 'child_process';\nimport { EventEmitter } from 'events';\nimport { StringDecoder } from 'string_decoder';\nimport { coalesce } from 'vs/base/common/arrays';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { groupBy } from 'vs/base/common/collections';\nimport { splitGlobAware } from 'vs/base/common/glob';\nimport * as path from 'vs/base/common/path';\nimport { createRegExp, escapeRegExpCharacters, startsWithUTF8BOM, stripUTF8BOM } from 'vs/base/common/strings';\nimport { URI } from 'vs/base/common/uri';\nimport { Progress } from 'vs/platform/progress/common/progress';\nimport { IExtendedExtensionSearchOptions, SearchError, SearchErrorCode, serializeSearchError } from 'vs/workbench/services/search/common/search';\nimport { Range, TextSearchComplete, TextSearchContext, TextSearchMatch, TextSearchOptions, TextSearchPreviewOptions, TextSearchQuery, TextSearchResult } from 'vs/workbench/services/search/common/searchExtTypes';\nimport { RegExpParser, RegExpVisitor, AST as ReAST } from 'vscode-regexpp';\nimport { rgPath } from 'vscode-ripgrep';\nimport { anchorGlob, createTextSearchResult, IOutputChannel, Maybe } from './ripgrepSearchUtils';\n\n// If vscode-ripgrep is in an .asar file, then the binary is unpacked.\nconst rgDiskPath = rgPath.replace(/\\bnode_modules\\.asar\\b/, 'node_modules.asar.unpacked');\n\nexport class RipgrepTextSearchEngine {\n\n\tconstructor(private outputChannel: IOutputChannel) { }\n\n\tprovideTextSearchResults(query: TextSearchQuery, options: TextSearchOptions, progress: Progress<TextSearchResult>, token: CancellationToken): Promise<TextSearchComplete> {\n\t\tthis.outputChannel.appendLine(`provideTextSearchResults ${query.pattern}, ${JSON.stringify({\n\t\t\t...options,\n\t\t\t...{\n\t\t\t\tfolder: options.folder.toString()\n\t\t\t}\n\t\t})}`);\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\ttoken.onCancellationRequested(() => cancel());\n\n\t\t\tconst rgArgs = getRgArgs(query, options);\n\n\t\t\tconst cwd = options.folder.fsPath;\n\n\t\t\tconst escapedArgs = rgArgs\n\t\t\t\t.map(arg => arg.match(/^-/) ? arg : `'${arg}'`)\n\t\t\t\t.join(' ');\n\t\t\tthis.outputChannel.appendLine(`${rgDiskPath} ${escapedArgs}\\n - cwd: ${cwd}`);\n\n\t\t\tlet rgProc: Maybe<cp.ChildProcess> = cp.spawn(rgDiskPath, rgArgs, { cwd });\n\t\t\trgProc.on('error', e => {\n\t\t\t\tconsole.error(e);\n\t\t\t\tthis.outputChannel.appendLine('Error: ' + (e && e.message));\n\t\t\t\treject(serializeSearchError(new SearchError(e && e.message, SearchErrorCode.rgProcessError)));\n\t\t\t});\n\n\t\t\tlet gotResult = false;\n\t\t\tconst ripgrepParser = new RipgrepParser(options.maxResults, cwd, options.previewOptions);\n\t\t\tripgrepParser.on('result', (match: TextSearchResult) => {\n\t\t\t\tgotResult = true;\n\t\t\t\tdataWithoutResult = '';\n\t\t\t\tprogress.report(match);\n\t\t\t});\n\n\t\t\tlet isDone = false;\n\t\t\tconst cancel = () => {\n\t\t\t\tisDone = true;\n\n\t\t\t\tif (rgProc) {\n\t\t\t\t\trgProc.kill();\n\t\t\t\t}\n\n\t\t\t\tif (ripgrepParser) {\n\t\t\t\t\tripgrepParser.cancel();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tlet limitHit = false;\n\t\t\tripgrepParser.on('hitLimit', () => {\n\t\t\t\tlimitHit = true;\n\t\t\t\tcancel();\n\t\t\t});\n\n\t\t\tlet dataWithoutResult = '';\n\t\t\trgProc.stdout!.on('data', data => {\n\t\t\t\tripgrepParser.handleData(data);\n\t\t\t\tif (!gotResult) {\n\t\t\t\t\tdataWithoutResult += data;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tlet gotData = false;\n\t\t\trgProc.stdout!.once('data', () => gotData = true);\n\n\t\t\tlet stderr = '';\n\t\t\trgProc.stderr!.on('data', data => {\n\t\t\t\tconst message = data.toString();\n\t\t\t\tthis.outputChannel.appendLine(message);\n\t\t\t\tstderr += message;\n\t\t\t});\n\n\t\t\trgProc.on('close', () => {\n\t\t\t\tthis.outputChannel.appendLine(gotData ? 'Got data from stdout' : 'No data from stdout');\n\t\t\t\tthis.outputChannel.appendLine(gotResult ? 'Got result from parser' : 'No result from parser');\n\t\t\t\tif (dataWithoutResult) {\n\t\t\t\t\tthis.outputChannel.appendLine(`Got data without result: ${dataWithoutResult}`);\n\t\t\t\t}\n\n\t\t\t\tthis.outputChannel.appendLine('');\n\n\t\t\t\tif (isDone) {\n\t\t\t\t\tresolve({ limitHit });\n\t\t\t\t} else {\n\t\t\t\t\t// Trigger last result\n\t\t\t\t\tripgrepParser.flush();\n\t\t\t\t\trgProc = null;\n\t\t\t\t\tlet searchError: Maybe<SearchError>;\n\t\t\t\t\tif (stderr && !gotData && (searchError = rgErrorMsgForDisplay(stderr))) {\n\t\t\t\t\t\treject(serializeSearchError(new SearchError(searchError.message, searchError.code)));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresolve({ limitHit });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n}\n\n/**\n * Read the first line of stderr and return an error for display or undefined, based on a list of\n * allowed properties.\n * Ripgrep produces stderr output which is not from a fatal error, and we only want the search to be\n * \"failed\" when a fatal error was produced.\n */\nexport function rgErrorMsgForDisplay(msg: string): Maybe<SearchError> {\n\tconst lines = msg.split('\\n');\n\tconst firstLine = lines[0].trim();\n\n\tif (lines.some(l => l.startsWith('regex parse error'))) {\n\t\treturn new SearchError(buildRegexParseError(lines), SearchErrorCode.regexParseError);\n\t}\n\n\tconst match = firstLine.match(/grep config error: unknown encoding: (.*)/);\n\tif (match) {\n\t\treturn new SearchError(`Unknown encoding: ${match[1]}`, SearchErrorCode.unknownEncoding);\n\t}\n\n\tif (firstLine.startsWith('error parsing glob')) {\n\t\t// Uppercase first letter\n\t\treturn new SearchError(firstLine.charAt(0).toUpperCase() + firstLine.substr(1), SearchErrorCode.globParseError);\n\t}\n\n\tif (firstLine.startsWith('the literal')) {\n\t\t// Uppercase first letter\n\t\treturn new SearchError(firstLine.charAt(0).toUpperCase() + firstLine.substr(1), SearchErrorCode.invalidLiteral);\n\t}\n\n\tif (firstLine.startsWith('PCRE2: error compiling pattern')) {\n\t\treturn new SearchError(firstLine, SearchErrorCode.regexParseError);\n\t}\n\n\treturn undefined;\n}\n\nexport function buildRegexParseError(lines: string[]): string {\n\tconst errorMessage: string[] = ['Regex parse error'];\n\tconst pcre2ErrorLine = lines.filter(l => (l.startsWith('PCRE2:')));\n\tif (pcre2ErrorLine.length >= 1) {\n\t\tconst pcre2ErrorMessage = pcre2ErrorLine[0].replace('PCRE2:', '');\n\t\tif (pcre2ErrorMessage.indexOf(':') !== -1 && pcre2ErrorMessage.split(':').length >= 2) {\n\t\t\tconst pcre2ActualErrorMessage = pcre2ErrorMessage.split(':')[1];\n\t\t\terrorMessage.push(':' + pcre2ActualErrorMessage);\n\t\t}\n\t}\n\n\treturn errorMessage.join('');\n}\n\n\nexport class RipgrepParser extends EventEmitter {\n\tprivate remainder = '';\n\tprivate isDone = false;\n\tprivate hitLimit = false;\n\tprivate stringDecoder: StringDecoder;\n\n\tprivate numResults = 0;\n\n\tconstructor(private maxResults: number, private rootFolder: string, private previewOptions?: TextSearchPreviewOptions) {\n\t\tsuper();\n\t\tthis.stringDecoder = new StringDecoder();\n\t}\n\n\tcancel(): void {\n\t\tthis.isDone = true;\n\t}\n\n\tflush(): void {\n\t\tthis.handleDecodedData(this.stringDecoder.end());\n\t}\n\n\n\ton(event: 'result', listener: (result: TextSearchResult) => void): this;\n\ton(event: 'hitLimit', listener: () => void): this;\n\ton(event: string, listener: (...args: any[]) => void): this {\n\t\tsuper.on(event, listener);\n\t\treturn this;\n\t}\n\n\thandleData(data: Buffer | string): void {\n\t\tif (this.isDone) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst dataStr = typeof data === 'string' ? data : this.stringDecoder.write(data);\n\t\tthis.handleDecodedData(dataStr);\n\t}\n\n\tprivate handleDecodedData(decodedData: string): void {\n\t\t// check for newline before appending to remainder\n\t\tlet newlineIdx = decodedData.indexOf('\\n');\n\n\t\t// If the previous data chunk didn't end in a newline, prepend it to this chunk\n\t\tconst dataStr = this.remainder + decodedData;\n\n\t\tif (newlineIdx >= 0) {\n\t\t\tnewlineIdx += this.remainder.length;\n\t\t} else {\n\t\t\t// Shortcut\n\t\t\tthis.remainder = dataStr;\n\t\t\treturn;\n\t\t}\n\n\t\tlet prevIdx = 0;\n\t\twhile (newlineIdx >= 0) {\n\t\t\tthis.handleLine(dataStr.substring(prevIdx, newlineIdx).trim());\n\t\t\tprevIdx = newlineIdx + 1;\n\t\t\tnewlineIdx = dataStr.indexOf('\\n', prevIdx);\n\t\t}\n\n\t\tthis.remainder = dataStr.substring(prevIdx);\n\t}\n\n\tprivate handleLine(outputLine: string): void {\n\t\tif (this.isDone || !outputLine) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet parsedLine: IRgMessage;\n\t\ttry {\n\t\t\tparsedLine = JSON.parse(outputLine);\n\t\t} catch (e) {\n\t\t\tthrow new Error(`malformed line from rg: ${outputLine}`);\n\t\t}\n\n\t\tif (parsedLine.type === 'match') {\n\t\t\tconst matchPath = bytesOrTextToString(parsedLine.data.path);\n\t\t\tconst uri = URI.file(path.join(this.rootFolder, matchPath));\n\t\t\tconst result = this.createTextSearchMatch(parsedLine.data, uri);\n\t\t\tthis.onResult(result);\n\n\t\t\tif (this.hitLimit) {\n\t\t\t\tthis.cancel();\n\t\t\t\tthis.emit('hitLimit');\n\t\t\t}\n\t\t} else if (parsedLine.type === 'context') {\n\t\t\tconst contextPath = bytesOrTextToString(parsedLine.data.path);\n\t\t\tconst uri = URI.file(path.join(this.rootFolder, contextPath));\n\t\t\tconst result = this.createTextSearchContext(parsedLine.data, uri);\n\t\t\tresult.forEach(r => this.onResult(r));\n\t\t}\n\t}\n\n\tprivate createTextSearchMatch(data: IRgMatch, uri: URI): TextSearchMatch {\n\t\tconst lineNumber = data.line_number - 1;\n\t\tlet isBOMStripped = false;\n\t\tlet fullText = bytesOrTextToString(data.lines);\n\t\tif (lineNumber === 0 && startsWithUTF8BOM(fullText)) {\n\t\t\tisBOMStripped = true;\n\t\t\tfullText = stripUTF8BOM(fullText);\n\t\t}\n\t\tconst fullTextBytes = Buffer.from(fullText);\n\n\t\tlet prevMatchEnd = 0;\n\t\tlet prevMatchEndCol = 0;\n\t\tlet prevMatchEndLine = lineNumber;\n\n\t\t// it looks like certain regexes can match a line, but cause rg to not\n\t\t// emit any specific submatches for that line.\n\t\t// https://github.com/microsoft/vscode/issues/100569#issuecomment-738496991\n\t\tif (data.submatches.length === 0) {\n\t\t\tdata.submatches.push(\n\t\t\t\tfullText.length\n\t\t\t\t\t? { start: 0, end: 1, match: { text: fullText[0] } }\n\t\t\t\t\t: { start: 0, end: 0, match: { text: '' } }\n\t\t\t);\n\t\t}\n\n\t\tconst ranges = coalesce(data.submatches.map((match, i) => {\n\t\t\tif (this.hitLimit) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tthis.numResults++;\n\t\t\tif (this.numResults >= this.maxResults) {\n\t\t\t\t// Finish the line, then report the result below\n\t\t\t\tthis.hitLimit = true;\n\t\t\t}\n\n\t\t\tlet matchText = bytesOrTextToString(match.match);\n\t\t\tif (lineNumber === 0 && i === 0 && isBOMStripped) {\n\t\t\t\tmatchText = stripUTF8BOM(matchText);\n\t\t\t\tmatch.start = match.start <= 3 ? 0 : match.start - 3;\n\t\t\t\tmatch.end = match.end <= 3 ? 0 : match.end - 3;\n\t\t\t}\n\t\t\tconst inBetweenChars = fullTextBytes.slice(prevMatchEnd, match.start).toString().length;\n\t\t\tconst startCol = prevMatchEndCol + inBetweenChars;\n\n\t\t\tconst stats = getNumLinesAndLastNewlineLength(matchText);\n\t\t\tconst startLineNumber = prevMatchEndLine;\n\t\t\tconst endLineNumber = stats.numLines + startLineNumber;\n\t\t\tconst endCol = stats.numLines > 0 ?\n\t\t\t\tstats.lastLineLength :\n\t\t\t\tstats.lastLineLength + startCol;\n\n\t\t\tprevMatchEnd = match.end;\n\t\t\tprevMatchEndCol = endCol;\n\t\t\tprevMatchEndLine = endLineNumber;\n\n\t\t\treturn new Range(startLineNumber, startCol, endLineNumber, endCol);\n\t\t}));\n\n\t\treturn createTextSearchResult(uri, fullText, <Range[]>ranges, this.previewOptions);\n\t}\n\n\tprivate createTextSearchContext(data: IRgMatch, uri: URI): TextSearchContext[] {\n\t\tconst text = bytesOrTextToString(data.lines);\n\t\tconst startLine = data.line_number;\n\t\treturn text\n\t\t\t.replace(/\\r?\\n$/, '')\n\t\t\t.split('\\n')\n\t\t\t.map((line, i) => {\n\t\t\t\treturn {\n\t\t\t\t\ttext: line,\n\t\t\t\t\turi,\n\t\t\t\t\tlineNumber: startLine + i\n\t\t\t\t};\n\t\t\t});\n\t}\n\n\tprivate onResult(match: TextSearchResult): void {\n\t\tthis.emit('result', match);\n\t}\n}\n\nfunction bytesOrTextToString(obj: any): string {\n\treturn obj.bytes ?\n\t\tBuffer.from(obj.bytes, 'base64').toString() :\n\t\tobj.text;\n}\n\nfunction getNumLinesAndLastNewlineLength(text: string): { numLines: number, lastLineLength: number } {\n\tconst re = /\\n/g;\n\tlet numLines = 0;\n\tlet lastNewlineIdx = -1;\n\tlet match: ReturnType<typeof re.exec>;\n\twhile (match = re.exec(text)) {\n\t\tnumLines++;\n\t\tlastNewlineIdx = match.index;\n\t}\n\n\tconst lastLineLength = lastNewlineIdx >= 0 ?\n\t\ttext.length - lastNewlineIdx - 1 :\n\t\ttext.length;\n\n\treturn { numLines, lastLineLength };\n}\n\nfunction getRgArgs(query: TextSearchQuery, options: TextSearchOptions): string[] {\n\tconst args = ['--hidden'];\n\targs.push(query.isCaseSensitive ? '--case-sensitive' : '--ignore-case');\n\n\tconst { doubleStarIncludes, otherIncludes } = groupBy(\n\t\toptions.includes,\n\t\t(include: string) => include.startsWith('**') ? 'doubleStarIncludes' : 'otherIncludes');\n\n\tif (otherIncludes && otherIncludes.length) {\n\t\tconst uniqueOthers = new Set<string>();\n\t\totherIncludes.forEach(other => { uniqueOthers.add(other); });\n\n\t\targs.push('-g', '!*');\n\t\tuniqueOthers\n\t\t\t.forEach(otherIncude => {\n\t\t\t\tspreadGlobComponents(otherIncude)\n\t\t\t\t\t.map(anchorGlob)\n\t\t\t\t\t.forEach(globArg => {\n\t\t\t\t\t\targs.push('-g', globArg);\n\t\t\t\t\t});\n\t\t\t});\n\t}\n\n\tif (doubleStarIncludes && doubleStarIncludes.length) {\n\t\tdoubleStarIncludes.forEach(globArg => {\n\t\t\targs.push('-g', globArg);\n\t\t});\n\t}\n\n\toptions.excludes\n\t\t.map(anchorGlob)\n\t\t.forEach(rgGlob => args.push('-g', `!${rgGlob}`));\n\n\tif (options.maxFileSize) {\n\t\targs.push('--max-filesize', options.maxFileSize + '');\n\t}\n\n\tif (options.useIgnoreFiles) {\n\t\targs.push('--no-ignore-parent');\n\t} else {\n\t\t// Don't use .gitignore or .ignore\n\t\targs.push('--no-ignore');\n\t}\n\n\tif (options.followSymlinks) {\n\t\targs.push('--follow');\n\t}\n\n\tif (options.encoding && options.encoding !== 'utf8') {\n\t\targs.push('--encoding', options.encoding);\n\t}\n\n\t// Ripgrep handles -- as a -- arg separator. Only --.\n\t// - is ok, --- is ok, --some-flag is also ok. Need to special case.\n\tif (query.pattern === '--') {\n\t\tquery.isRegExp = true;\n\t\tquery.pattern = '\\\\-\\\\-';\n\t}\n\n\tif (query.isMultiline && !query.isRegExp) {\n\t\tquery.pattern = escapeRegExpCharacters(query.pattern);\n\t\tquery.isRegExp = true;\n\t}\n\n\tif ((<IExtendedExtensionSearchOptions>options).usePCRE2) {\n\t\targs.push('--pcre2');\n\t}\n\n\t// Allow $ to match /r/n\n\targs.push('--crlf');\n\n\tif (query.isRegExp) {\n\t\tquery.pattern = unicodeEscapesToPCRE2(query.pattern);\n\t\targs.push('--auto-hybrid-regex');\n\t}\n\n\tlet searchPatternAfterDoubleDashes: Maybe<string>;\n\tif (query.isWordMatch) {\n\t\tconst regexp = createRegExp(query.pattern, !!query.isRegExp, { wholeWord: query.isWordMatch });\n\t\tconst regexpStr = regexp.source.replace(/\\\\\\//g, '/'); // RegExp.source arbitrarily returns escaped slashes. Search and destroy.\n\t\targs.push('--regexp', regexpStr);\n\t} else if (query.isRegExp) {\n\t\tlet fixedRegexpQuery = fixRegexNewline(query.pattern);\n\t\tfixedRegexpQuery = fixNewline(fixedRegexpQuery);\n\t\targs.push('--regexp', fixedRegexpQuery);\n\t} else {\n\t\tsearchPatternAfterDoubleDashes = query.pattern;\n\t\targs.push('--fixed-strings');\n\t}\n\n\targs.push('--no-config');\n\tif (!options.useGlobalIgnoreFiles) {\n\t\targs.push('--no-ignore-global');\n\t}\n\n\targs.push('--json');\n\n\tif (query.isMultiline) {\n\t\targs.push('--multiline');\n\t}\n\n\tif (options.beforeContext) {\n\t\targs.push('--before-context', options.beforeContext + '');\n\t}\n\n\tif (options.afterContext) {\n\t\targs.push('--after-context', options.afterContext + '');\n\t}\n\n\t// Folder to search\n\targs.push('--');\n\n\tif (searchPatternAfterDoubleDashes) {\n\t\t// Put the query after --, in case the query starts with a dash\n\t\targs.push(searchPatternAfterDoubleDashes);\n\t}\n\n\targs.push('.');\n\n\treturn args;\n}\n\n/**\n * `\"foo/*bar/something\"` -> `[\"foo\", \"foo/*bar\", \"foo/*bar/something\", \"foo/*bar/something/**\"]`\n */\nexport function spreadGlobComponents(globArg: string): string[] {\n\tconst components = splitGlobAware(globArg, '/');\n\treturn components.map((_, i) => components.slice(0, i + 1).join('/'));\n}\n\nexport function unicodeEscapesToPCRE2(pattern: string): string {\n\t// Match \\u1234\n\tconst unicodePattern = /((?:[^\\\\]|^)(?:\\\\\\\\)*)\\\\u([a-z0-9]{4})/gi;\n\n\twhile (pattern.match(unicodePattern)) {\n\t\tpattern = pattern.replace(unicodePattern, `$1\\\\x{$2}`);\n\t}\n\n\t// Match \\u{1234}\n\t// \\u with 5-6 characters will be left alone because \\x only takes 4 characters.\n\tconst unicodePatternWithBraces = /((?:[^\\\\]|^)(?:\\\\\\\\)*)\\\\u\\{([a-z0-9]{4})\\}/gi;\n\twhile (pattern.match(unicodePatternWithBraces)) {\n\t\tpattern = pattern.replace(unicodePatternWithBraces, `$1\\\\x{$2}`);\n\t}\n\n\treturn pattern;\n}\n\nexport interface IRgMessage {\n\ttype: 'match' | 'context' | string;\n\tdata: IRgMatch;\n}\n\nexport interface IRgMatch {\n\tpath: IRgBytesOrText;\n\tlines: IRgBytesOrText;\n\tline_number: number;\n\tabsolute_offset: number;\n\tsubmatches: IRgSubmatch[];\n}\n\nexport interface IRgSubmatch {\n\tmatch: IRgBytesOrText;\n\tstart: number;\n\tend: number;\n}\n\nexport type IRgBytesOrText = { bytes: string } | { text: string };\n\nconst isLookBehind = (node: ReAST.Node) => node.type === 'Assertion' && node.kind === 'lookbehind';\n\nexport function fixRegexNewline(pattern: string): string {\n\t// we parse the pattern anew each tiem\n\tlet re: ReAST.Pattern;\n\ttry {\n\t\tre = new RegExpParser().parsePattern(pattern);\n\t} catch {\n\t\treturn pattern;\n\t}\n\n\tlet output = '';\n\tlet lastEmittedIndex = 0;\n\tconst replace = (start: number, end: number, text: string) => {\n\t\toutput += pattern.slice(lastEmittedIndex, start) + text;\n\t\tlastEmittedIndex = end;\n\t};\n\n\tconst context: ReAST.Node[] = [];\n\tconst visitor = new RegExpVisitor({\n\t\tonCharacterEnter(char) {\n\t\t\tif (char.raw !== '\\\\n') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst parent = context[0];\n\t\t\tif (!parent) {\n\t\t\t\t// simple char, \\n -> \\r?\\n\n\t\t\t\treplace(char.start, char.end, '\\\\r?\\\\n');\n\t\t\t} else if (context.some(isLookBehind)) {\n\t\t\t\t// no-op in a lookbehind, see #100569\n\t\t\t} else if (parent.type === 'CharacterClass') {\n\t\t\t\t// in a bracket expr, [a-z\\n] -> (?:[a-z]|\\r?\\n)\n\t\t\t\tconst otherContent = pattern.slice(parent.start + 1, char.start) + pattern.slice(char.end, parent.end - 1);\n\t\t\t\treplace(parent.start, parent.end, otherContent === '' ? '\\\\r?\\\\n' : `(?:[${otherContent}]|\\\\r?\\\\n)`);\n\t\t\t} else if (parent.type === 'Quantifier') {\n\t\t\t\treplace(char.start, char.end, '(?:\\\\r?\\\\n)');\n\t\t\t}\n\t\t},\n\t\tonQuantifierEnter(node) {\n\t\t\tcontext.unshift(node);\n\t\t},\n\t\tonQuantifierLeave() {\n\t\t\tcontext.shift();\n\t\t},\n\t\tonCharacterClassRangeEnter(node) {\n\t\t\tcontext.unshift(node);\n\t\t},\n\t\tonCharacterClassRangeLeave() {\n\t\t\tcontext.shift();\n\t\t},\n\t\tonCharacterClassEnter(node) {\n\t\t\tcontext.unshift(node);\n\t\t},\n\t\tonCharacterClassLeave() {\n\t\t\tcontext.shift();\n\t\t},\n\t\tonAssertionEnter(node) {\n\t\t\tif (isLookBehind(node)) {\n\t\t\t\tcontext.push(node);\n\t\t\t}\n\t\t},\n\t\tonAssertionLeave(node) {\n\t\t\tif (context[0] === node) {\n\t\t\t\tcontext.shift();\n\t\t\t}\n\t\t},\n\t});\n\n\tvisitor.visit(re);\n\toutput += pattern.slice(lastEmittedIndex);\n\treturn output;\n}\n\nexport function fixNewline(pattern: string): string {\n\treturn pattern.replace(/\\n/g, '\\\\r?\\\\n');\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationTokenSource, CancellationToken } from 'vs/base/common/cancellation';\nimport { OutputChannel } from 'vs/workbench/services/search/node/ripgrepSearchUtils';\nimport { RipgrepTextSearchEngine } from 'vs/workbench/services/search/node/ripgrepTextSearchEngine';\nimport { TextSearchProvider, TextSearchComplete, TextSearchResult, TextSearchQuery, TextSearchOptions } from 'vs/workbench/services/search/common/searchExtTypes';\nimport { Progress } from 'vs/platform/progress/common/progress';\n\nexport class RipgrepSearchProvider implements TextSearchProvider {\n\tprivate inProgress: Set<CancellationTokenSource> = new Set();\n\n\tconstructor(private outputChannel: OutputChannel) {\n\t\tprocess.once('exit', () => this.dispose());\n\t}\n\n\tprovideTextSearchResults(query: TextSearchQuery, options: TextSearchOptions, progress: Progress<TextSearchResult>, token: CancellationToken): Promise<TextSearchComplete> {\n\t\tconst engine = new RipgrepTextSearchEngine(this.outputChannel);\n\t\treturn this.withToken(token, token => engine.provideTextSearchResults(query, options, progress, token));\n\t}\n\n\tprivate async withToken<T>(token: CancellationToken, fn: (token: CancellationToken) => Promise<T>): Promise<T> {\n\t\tconst merged = mergedTokenSource(token);\n\t\tthis.inProgress.add(merged);\n\t\tconst result = await fn(merged.token);\n\t\tthis.inProgress.delete(merged);\n\n\t\treturn result;\n\t}\n\n\tprivate dispose() {\n\t\tthis.inProgress.forEach(engine => engine.cancel());\n\t}\n}\n\nfunction mergedTokenSource(token: CancellationToken): CancellationTokenSource {\n\tconst tokenSource = new CancellationTokenSource();\n\ttoken.onCancellationRequested(() => tokenSource.cancel());\n\n\treturn tokenSource;\n}","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport * as pfs from 'vs/base/node/pfs';\nimport { IFileMatch, IProgressMessage, ITextQuery, ITextSearchStats, ITextSearchMatch, ISerializedFileMatch, ISerializedSearchSuccess } from 'vs/workbench/services/search/common/search';\nimport { RipgrepTextSearchEngine } from 'vs/workbench/services/search/node/ripgrepTextSearchEngine';\nimport { NativeTextSearchManager } from 'vs/workbench/services/search/node/textSearchManager';\n\nexport class TextSearchEngineAdapter {\n\n\tconstructor(private query: ITextQuery) { }\n\n\tsearch(token: CancellationToken, onResult: (matches: ISerializedFileMatch[]) => void, onMessage: (message: IProgressMessage) => void): Promise<ISerializedSearchSuccess> {\n\t\tif ((!this.query.folderQueries || !this.query.folderQueries.length) && (!this.query.extraFileResources || !this.query.extraFileResources.length)) {\n\t\t\treturn Promise.resolve(<ISerializedSearchSuccess>{\n\t\t\t\ttype: 'success',\n\t\t\t\tlimitHit: false,\n\t\t\t\tstats: <ITextSearchStats>{\n\t\t\t\t\ttype: 'searchProcess'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tconst pretendOutputChannel = {\n\t\t\tappendLine(msg: string) {\n\t\t\t\tonMessage({ message: msg });\n\t\t\t}\n\t\t};\n\t\tconst textSearchManager = new NativeTextSearchManager(this.query, new RipgrepTextSearchEngine(pretendOutputChannel), pfs);\n\t\treturn new Promise((resolve, reject) => {\n\t\t\treturn textSearchManager\n\t\t\t\t.search(\n\t\t\t\t\tmatches => {\n\t\t\t\t\t\tonResult(matches.map(fileMatchToSerialized));\n\t\t\t\t\t},\n\t\t\t\t\ttoken)\n\t\t\t\t.then(\n\t\t\t\t\tc => resolve({ limitHit: c.limitHit, type: 'success' } as ISerializedSearchSuccess),\n\t\t\t\t\treject);\n\t\t});\n\t}\n}\n\nfunction fileMatchToSerialized(match: IFileMatch): ISerializedFileMatch {\n\treturn {\n\t\tpath: match.resource && match.resource.fsPath,\n\t\tresults: match.results,\n\t\tnumMatches: (match.results || []).reduce((sum, r) => {\n\t\t\tif (!!(<ITextSearchMatch>r).ranges) {\n\t\t\t\tconst m = <ITextSearchMatch>r;\n\t\t\t\treturn sum + (Array.isArray(m.ranges) ? m.ranges.length : 1);\n\t\t\t} else {\n\t\t\t\treturn sum + 1;\n\t\t\t}\n\t\t}, 0)\n\t};\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as fs from 'fs';\nimport * as gracefulFs from 'graceful-fs';\nimport * as arrays from 'vs/base/common/arrays';\nimport { CancelablePromise, createCancelablePromise } from 'vs/base/common/async';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { canceled } from 'vs/base/common/errors';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { compareItemsByFuzzyScore, FuzzyScorerCache, IItemAccessor, prepareQuery } from 'vs/base/common/fuzzyScorer';\nimport { basename, dirname, join, sep } from 'vs/base/common/path';\nimport { StopWatch } from 'vs/base/common/stopwatch';\nimport { URI, UriComponents } from 'vs/base/common/uri';\nimport { MAX_FILE_SIZE } from 'vs/base/node/pfs';\nimport { ICachedSearchStats, IFileQuery, IFileSearchProgressItem, IFileSearchStats, IFolderQuery, IProgressMessage, IRawFileMatch, IRawFileQuery, IRawQuery, IRawSearchService, IRawTextQuery, ISearchEngine, ISearchEngineSuccess, ISerializedFileMatch, ISerializedSearchComplete, ISerializedSearchProgressItem, ISerializedSearchSuccess, isFilePatternMatch, ITextQuery } from 'vs/workbench/services/search/common/search';\nimport { Engine as FileSearchEngine } from 'vs/workbench/services/search/node/fileSearch';\nimport { TextSearchEngineAdapter } from 'vs/workbench/services/search/node/textSearchAdapter';\n\ngracefulFs.gracefulify(fs);\n\nexport type IProgressCallback = (p: ISerializedSearchProgressItem) => void;\nexport type IFileProgressCallback = (p: IFileSearchProgressItem) => void;\n\nexport class SearchService implements IRawSearchService {\n\n\tprivate static readonly BATCH_SIZE = 512;\n\n\tprivate caches: { [cacheKey: string]: Cache; } = Object.create(null);\n\n\tfileSearch(config: IRawFileQuery): Event<ISerializedSearchProgressItem | ISerializedSearchComplete> {\n\t\tlet promise: CancelablePromise<ISerializedSearchSuccess>;\n\n\t\tconst query = reviveQuery(config);\n\t\tconst emitter = new Emitter<ISerializedSearchProgressItem | ISerializedSearchComplete>({\n\t\t\tonFirstListenerDidAdd: () => {\n\t\t\t\tpromise = createCancelablePromise(token => {\n\t\t\t\t\treturn this.doFileSearchWithEngine(FileSearchEngine, query, p => emitter.fire(p), token);\n\t\t\t\t});\n\n\t\t\t\tpromise.then(\n\t\t\t\t\tc => emitter.fire(c),\n\t\t\t\t\terr => emitter.fire({ type: 'error', error: { message: err.message, stack: err.stack } }));\n\t\t\t},\n\t\t\tonLastListenerRemove: () => {\n\t\t\t\tpromise.cancel();\n\t\t\t}\n\t\t});\n\n\t\treturn emitter.event;\n\t}\n\n\ttextSearch(rawQuery: IRawTextQuery): Event<ISerializedSearchProgressItem | ISerializedSearchComplete> {\n\t\tlet promise: CancelablePromise<ISerializedSearchComplete>;\n\n\t\tconst query = reviveQuery(rawQuery);\n\t\tconst emitter = new Emitter<ISerializedSearchProgressItem | ISerializedSearchComplete>({\n\t\t\tonFirstListenerDidAdd: () => {\n\t\t\t\tpromise = createCancelablePromise(token => {\n\t\t\t\t\treturn this.ripgrepTextSearch(query, p => emitter.fire(p), token);\n\t\t\t\t});\n\n\t\t\t\tpromise.then(\n\t\t\t\t\tc => emitter.fire(c),\n\t\t\t\t\terr => emitter.fire({ type: 'error', error: { message: err.message, stack: err.stack } }));\n\t\t\t},\n\t\t\tonLastListenerRemove: () => {\n\t\t\t\tpromise.cancel();\n\t\t\t}\n\t\t});\n\n\t\treturn emitter.event;\n\t}\n\n\tprivate ripgrepTextSearch(config: ITextQuery, progressCallback: IProgressCallback, token: CancellationToken): Promise<ISerializedSearchSuccess> {\n\t\tconfig.maxFileSize = MAX_FILE_SIZE;\n\t\tconst engine = new TextSearchEngineAdapter(config);\n\n\t\treturn engine.search(token, progressCallback, progressCallback);\n\t}\n\n\tdoFileSearch(config: IFileQuery, progressCallback: IProgressCallback, token?: CancellationToken): Promise<ISerializedSearchSuccess> {\n\t\treturn this.doFileSearchWithEngine(FileSearchEngine, config, progressCallback, token);\n\t}\n\n\tdoFileSearchWithEngine(EngineClass: { new(config: IFileQuery): ISearchEngine<IRawFileMatch>; }, config: IFileQuery, progressCallback: IProgressCallback, token?: CancellationToken, batchSize = SearchService.BATCH_SIZE): Promise<ISerializedSearchSuccess> {\n\t\tlet resultCount = 0;\n\t\tconst fileProgressCallback: IFileProgressCallback = progress => {\n\t\t\tif (Array.isArray(progress)) {\n\t\t\t\tresultCount += progress.length;\n\t\t\t\tprogressCallback(progress.map(m => this.rawMatchToSearchItem(m)));\n\t\t\t} else if ((<IRawFileMatch>progress).relativePath) {\n\t\t\t\tresultCount++;\n\t\t\t\tprogressCallback(this.rawMatchToSearchItem(<IRawFileMatch>progress));\n\t\t\t} else {\n\t\t\t\tprogressCallback(<IProgressMessage>progress);\n\t\t\t}\n\t\t};\n\n\t\tif (config.sortByScore) {\n\t\t\tlet sortedSearch = this.trySortedSearchFromCache(config, fileProgressCallback, token);\n\t\t\tif (!sortedSearch) {\n\t\t\t\tconst walkerConfig = config.maxResults ? Object.assign({}, config, { maxResults: null }) : config;\n\t\t\t\tconst engine = new EngineClass(walkerConfig);\n\t\t\t\tsortedSearch = this.doSortedSearch(engine, config, progressCallback, fileProgressCallback, token);\n\t\t\t}\n\n\t\t\treturn new Promise<ISerializedSearchSuccess>((c, e) => {\n\t\t\t\tsortedSearch!.then(([result, rawMatches]) => {\n\t\t\t\t\tconst serializedMatches = rawMatches.map(rawMatch => this.rawMatchToSearchItem(rawMatch));\n\t\t\t\t\tthis.sendProgress(serializedMatches, progressCallback, batchSize);\n\t\t\t\t\tc(result);\n\t\t\t\t}, e);\n\t\t\t});\n\t\t}\n\n\t\tconst engine = new EngineClass(config);\n\n\t\treturn this.doSearch(engine, fileProgressCallback, batchSize, token).then(complete => {\n\t\t\treturn <ISerializedSearchSuccess>{\n\t\t\t\tlimitHit: complete.limitHit,\n\t\t\t\ttype: 'success',\n\t\t\t\tstats: {\n\t\t\t\t\tdetailStats: complete.stats,\n\t\t\t\t\ttype: 'searchProcess',\n\t\t\t\t\tfromCache: false,\n\t\t\t\t\tresultCount,\n\t\t\t\t\tsortingTime: undefined\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\t}\n\n\tprivate rawMatchToSearchItem(match: IRawFileMatch): ISerializedFileMatch {\n\t\treturn { path: match.base ? join(match.base, match.relativePath) : match.relativePath };\n\t}\n\n\tprivate doSortedSearch(engine: ISearchEngine<IRawFileMatch>, config: IFileQuery, progressCallback: IProgressCallback, fileProgressCallback: IFileProgressCallback, token?: CancellationToken): Promise<[ISerializedSearchSuccess, IRawFileMatch[]]> {\n\t\tconst emitter = new Emitter<IFileSearchProgressItem>();\n\n\t\tlet allResultsPromise = createCancelablePromise(token => {\n\t\t\tlet results: IRawFileMatch[] = [];\n\n\t\t\tconst innerProgressCallback: IFileProgressCallback = progress => {\n\t\t\t\tif (Array.isArray(progress)) {\n\t\t\t\t\tresults = progress;\n\t\t\t\t} else {\n\t\t\t\t\tfileProgressCallback(progress);\n\t\t\t\t\temitter.fire(progress);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\treturn this.doSearch(engine, innerProgressCallback, -1, token)\n\t\t\t\t.then<[ISearchEngineSuccess, IRawFileMatch[]]>(result => {\n\t\t\t\t\treturn [result, results];\n\t\t\t\t});\n\t\t});\n\n\t\tlet cache: Cache;\n\t\tif (config.cacheKey) {\n\t\t\tcache = this.getOrCreateCache(config.cacheKey);\n\t\t\tconst cacheRow: ICacheRow = {\n\t\t\t\tpromise: allResultsPromise,\n\t\t\t\tevent: emitter.event,\n\t\t\t\tresolved: false\n\t\t\t};\n\t\t\tcache.resultsToSearchCache[config.filePattern || ''] = cacheRow;\n\t\t\tallResultsPromise.then(() => {\n\t\t\t\tcacheRow.resolved = true;\n\t\t\t}, err => {\n\t\t\t\tdelete cache.resultsToSearchCache[config.filePattern || ''];\n\t\t\t});\n\n\t\t\tallResultsPromise = this.preventCancellation(allResultsPromise);\n\t\t}\n\n\t\treturn allResultsPromise.then(([result, results]) => {\n\t\t\tconst scorerCache: FuzzyScorerCache = cache ? cache.scorerCache : Object.create(null);\n\t\t\tconst sortSW = (typeof config.maxResults !== 'number' || config.maxResults > 0) && StopWatch.create(false);\n\t\t\treturn this.sortResults(config, results, scorerCache, token)\n\t\t\t\t.then<[ISerializedSearchSuccess, IRawFileMatch[]]>(sortedResults => {\n\t\t\t\t\t// sortingTime: -1 indicates a \"sorted\" search that was not sorted, i.e. populating the cache when quickaccess is opened.\n\t\t\t\t\t// Contrasting with findFiles which is not sorted and will have sortingTime: undefined\n\t\t\t\t\tconst sortingTime = sortSW ? sortSW.elapsed() : -1;\n\n\t\t\t\t\treturn [{\n\t\t\t\t\t\ttype: 'success',\n\t\t\t\t\t\tstats: {\n\t\t\t\t\t\t\tdetailStats: result.stats,\n\t\t\t\t\t\t\tsortingTime,\n\t\t\t\t\t\t\tfromCache: false,\n\t\t\t\t\t\t\ttype: 'searchProcess',\n\t\t\t\t\t\t\tworkspaceFolderCount: config.folderQueries.length,\n\t\t\t\t\t\t\tresultCount: sortedResults.length\n\t\t\t\t\t\t},\n\t\t\t\t\t\tlimitHit: result.limitHit || typeof config.maxResults === 'number' && results.length > config.maxResults\n\t\t\t\t\t} as ISerializedSearchSuccess, sortedResults];\n\t\t\t\t});\n\t\t});\n\t}\n\n\tprivate getOrCreateCache(cacheKey: string): Cache {\n\t\tconst existing = this.caches[cacheKey];\n\t\tif (existing) {\n\t\t\treturn existing;\n\t\t}\n\t\treturn this.caches[cacheKey] = new Cache();\n\t}\n\n\tprivate trySortedSearchFromCache(config: IFileQuery, progressCallback: IFileProgressCallback, token?: CancellationToken): Promise<[ISerializedSearchSuccess, IRawFileMatch[]]> | undefined {\n\t\tconst cache = config.cacheKey && this.caches[config.cacheKey];\n\t\tif (!cache) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst cached = this.getResultsFromCache(cache, config.filePattern || '', progressCallback, token);\n\t\tif (cached) {\n\t\t\treturn cached.then(([result, results, cacheStats]) => {\n\t\t\t\tconst sortSW = StopWatch.create(false);\n\t\t\t\treturn this.sortResults(config, results, cache.scorerCache, token)\n\t\t\t\t\t.then<[ISerializedSearchSuccess, IRawFileMatch[]]>(sortedResults => {\n\t\t\t\t\t\tconst sortingTime = sortSW.elapsed();\n\t\t\t\t\t\tconst stats: IFileSearchStats = {\n\t\t\t\t\t\t\tfromCache: true,\n\t\t\t\t\t\t\tdetailStats: cacheStats,\n\t\t\t\t\t\t\ttype: 'searchProcess',\n\t\t\t\t\t\t\tresultCount: results.length,\n\t\t\t\t\t\t\tsortingTime\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttype: 'success',\n\t\t\t\t\t\t\t\tlimitHit: result.limitHit || typeof config.maxResults === 'number' && results.length > config.maxResults,\n\t\t\t\t\t\t\t\tstats\n\t\t\t\t\t\t\t} as ISerializedSearchSuccess,\n\t\t\t\t\t\t\tsortedResults\n\t\t\t\t\t\t];\n\t\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tprivate sortResults(config: IFileQuery, results: IRawFileMatch[], scorerCache: FuzzyScorerCache, token?: CancellationToken): Promise<IRawFileMatch[]> {\n\t\t// we use the same compare function that is used later when showing the results using fuzzy scoring\n\t\t// this is very important because we are also limiting the number of results by config.maxResults\n\t\t// and as such we want the top items to be included in this result set if the number of items\n\t\t// exceeds config.maxResults.\n\t\tconst query = prepareQuery(config.filePattern || '');\n\t\tconst compare = (matchA: IRawFileMatch, matchB: IRawFileMatch) => compareItemsByFuzzyScore(matchA, matchB, query, true, FileMatchItemAccessor, scorerCache);\n\n\t\tconst maxResults = typeof config.maxResults === 'number' ? config.maxResults : Number.MAX_VALUE;\n\t\treturn arrays.topAsync(results, compare, maxResults, 10000, token);\n\t}\n\n\tprivate sendProgress(results: ISerializedFileMatch[], progressCb: IProgressCallback, batchSize: number) {\n\t\tif (batchSize && batchSize > 0) {\n\t\t\tfor (let i = 0; i < results.length; i += batchSize) {\n\t\t\t\tprogressCb(results.slice(i, i + batchSize));\n\t\t\t}\n\t\t} else {\n\t\t\tprogressCb(results);\n\t\t}\n\t}\n\n\tprivate getResultsFromCache(cache: Cache, searchValue: string, progressCallback: IFileProgressCallback, token?: CancellationToken): Promise<[ISearchEngineSuccess, IRawFileMatch[], ICachedSearchStats]> | null {\n\t\tconst cacheLookupSW = StopWatch.create(false);\n\n\t\t// Find cache entries by prefix of search value\n\t\tconst hasPathSep = searchValue.indexOf(sep) >= 0;\n\t\tlet cachedRow: ICacheRow | undefined;\n\t\tfor (const previousSearch in cache.resultsToSearchCache) {\n\t\t\t// If we narrow down, we might be able to reuse the cached results\n\t\t\tif (searchValue.startsWith(previousSearch)) {\n\t\t\t\tif (hasPathSep && previousSearch.indexOf(sep) < 0 && previousSearch !== '') {\n\t\t\t\t\tcontinue; // since a path character widens the search for potential more matches, require it in previous search too\n\t\t\t\t}\n\n\t\t\t\tconst row = cache.resultsToSearchCache[previousSearch];\n\t\t\t\tcachedRow = {\n\t\t\t\t\tpromise: this.preventCancellation(row.promise),\n\t\t\t\t\tevent: row.event,\n\t\t\t\t\tresolved: row.resolved\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (!cachedRow) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst cacheLookupTime = cacheLookupSW.elapsed();\n\t\tconst cacheFilterSW = StopWatch.create(false);\n\n\t\tconst listener = cachedRow.event(progressCallback);\n\t\tif (token) {\n\t\t\ttoken.onCancellationRequested(() => {\n\t\t\t\tlistener.dispose();\n\t\t\t});\n\t\t}\n\n\t\treturn cachedRow.promise.then<[ISearchEngineSuccess, IRawFileMatch[], ICachedSearchStats]>(([complete, cachedEntries]) => {\n\t\t\tif (token && token.isCancellationRequested) {\n\t\t\t\tthrow canceled();\n\t\t\t}\n\n\t\t\t// Pattern match on results\n\t\t\tconst results: IRawFileMatch[] = [];\n\t\t\tconst normalizedSearchValueLowercase = prepareQuery(searchValue).normalizedLowercase;\n\t\t\tfor (const entry of cachedEntries) {\n\n\t\t\t\t// Check if this entry is a match for the search value\n\t\t\t\tif (!isFilePatternMatch(entry, normalizedSearchValueLowercase)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tresults.push(entry);\n\t\t\t}\n\n\t\t\treturn [complete, results, {\n\t\t\t\tcacheWasResolved: cachedRow!.resolved,\n\t\t\t\tcacheLookupTime,\n\t\t\t\tcacheFilterTime: cacheFilterSW.elapsed(),\n\t\t\t\tcacheEntryCount: cachedEntries.length\n\t\t\t}];\n\t\t});\n\t}\n\n\n\n\tprivate doSearch(engine: ISearchEngine<IRawFileMatch>, progressCallback: IFileProgressCallback, batchSize: number, token?: CancellationToken): Promise<ISearchEngineSuccess> {\n\t\treturn new Promise<ISearchEngineSuccess>((c, e) => {\n\t\t\tlet batch: IRawFileMatch[] = [];\n\t\t\tif (token) {\n\t\t\t\ttoken.onCancellationRequested(() => engine.cancel());\n\t\t\t}\n\n\t\t\tengine.search((match) => {\n\t\t\t\tif (match) {\n\t\t\t\t\tif (batchSize) {\n\t\t\t\t\t\tbatch.push(match);\n\t\t\t\t\t\tif (batchSize > 0 && batch.length >= batchSize) {\n\t\t\t\t\t\t\tprogressCallback(batch);\n\t\t\t\t\t\t\tbatch = [];\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tprogressCallback(match);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, (progress) => {\n\t\t\t\tprogressCallback(progress);\n\t\t\t}, (error, complete) => {\n\t\t\t\tif (batch.length) {\n\t\t\t\t\tprogressCallback(batch);\n\t\t\t\t}\n\n\t\t\t\tif (error) {\n\t\t\t\t\te(error);\n\t\t\t\t} else {\n\t\t\t\t\tc(complete);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tclearCache(cacheKey: string): Promise<void> {\n\t\tdelete this.caches[cacheKey];\n\t\treturn Promise.resolve(undefined);\n\t}\n\n\t/**\n\t * Return a CancelablePromise which is not actually cancelable\n\t * TODO@rob - Is this really needed?\n\t */\n\tprivate preventCancellation<C>(promise: CancelablePromise<C>): CancelablePromise<C> {\n\t\treturn new class implements CancelablePromise<C> {\n\t\t\tget [Symbol.toStringTag]() { return this.toString(); }\n\t\t\tcancel() {\n\t\t\t\t// Do nothing\n\t\t\t}\n\t\t\tthen<TResult1 = C, TResult2 = never>(resolve?: ((value: C) => TResult1 | Promise<TResult1>) | undefined | null, reject?: ((reason: any) => TResult2 | Promise<TResult2>) | undefined | null): Promise<TResult1 | TResult2> {\n\t\t\t\treturn promise.then(resolve, reject);\n\t\t\t}\n\t\t\tcatch(reject?: any) {\n\t\t\t\treturn this.then(undefined, reject);\n\t\t\t}\n\t\t\tfinally(onFinally: any) {\n\t\t\t\treturn promise.finally(onFinally);\n\t\t\t}\n\t\t};\n\t}\n}\n\ninterface ICacheRow {\n\t// TODO@roblou - never actually canceled\n\tpromise: CancelablePromise<[ISearchEngineSuccess, IRawFileMatch[]]>;\n\tresolved: boolean;\n\tevent: Event<IFileSearchProgressItem>;\n}\n\nclass Cache {\n\n\tresultsToSearchCache: { [searchValue: string]: ICacheRow; } = Object.create(null);\n\n\tscorerCache: FuzzyScorerCache = Object.create(null);\n}\n\nconst FileMatchItemAccessor = new class implements IItemAccessor<IRawFileMatch> {\n\n\tgetItemLabel(match: IRawFileMatch): string {\n\t\treturn basename(match.relativePath); // e.g. myFile.txt\n\t}\n\n\tgetItemDescription(match: IRawFileMatch): string {\n\t\treturn dirname(match.relativePath); // e.g. some/path/to/file\n\t}\n\n\tgetItemPath(match: IRawFileMatch): string {\n\t\treturn match.relativePath; // e.g. some/path/to/file/myFile.txt\n\t}\n};\n\nfunction reviveQuery<U extends IRawQuery>(rawQuery: U): U extends IRawTextQuery ? ITextQuery : IFileQuery {\n\treturn {\n\t\t...<any>rawQuery, // TODO\n\t\t...{\n\t\t\tfolderQueries: rawQuery.folderQueries && rawQuery.folderQueries.map(reviveFolderQuery),\n\t\t\textraFileResources: rawQuery.extraFileResources && rawQuery.extraFileResources.map(components => URI.revive(components))\n\t\t}\n\t};\n}\n\nfunction reviveFolderQuery(rawFolderQuery: IFolderQuery<UriComponents>): IFolderQuery<URI> {\n\treturn {\n\t\t...rawFolderQuery,\n\t\tfolder: URI.revive(rawFolderQuery.folder)\n\t};\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IDisposable, toDisposable } from 'vs/base/common/lifecycle';\nimport { URI } from 'vs/base/common/uri';\nimport * as pfs from 'vs/base/node/pfs';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { IFileQuery, IRawFileQuery, ISearchCompleteStats, isSerializedFileMatch, ISerializedSearchProgressItem, ITextQuery } from 'vs/workbench/services/search/common/search';\nimport { SearchService } from 'vs/workbench/services/search/node/rawSearchService';\nimport { RipgrepSearchProvider } from 'vs/workbench/services/search/node/ripgrepSearchProvider';\nimport { OutputChannel } from 'vs/workbench/services/search/node/ripgrepSearchUtils';\nimport type * as vscode from 'vscode';\nimport { IExtHostRpcService } from 'vs/workbench/api/common/extHostRpcService';\nimport { IURITransformerService } from 'vs/workbench/api/common/extHostUriTransformerService';\nimport { IExtHostInitDataService } from 'vs/workbench/api/common/extHostInitDataService';\nimport { ExtHostSearch, reviveQuery } from 'vs/workbench/api/common/extHostSearch';\nimport { Schemas } from 'vs/base/common/network';\nimport { NativeTextSearchManager } from 'vs/workbench/services/search/node/textSearchManager';\nimport { TextSearchManager } from 'vs/workbench/services/search/common/textSearchManager';\n\nexport class NativeExtHostSearch extends ExtHostSearch {\n\n\tprotected _pfs: typeof pfs = pfs; // allow extending for tests\n\n\tprivate _internalFileSearchHandle: number = -1;\n\tprivate _internalFileSearchProvider: SearchService | null = null;\n\n\tconstructor(\n\t\t@IExtHostRpcService extHostRpc: IExtHostRpcService,\n\t\t@IExtHostInitDataService initData: IExtHostInitDataService,\n\t\t@IURITransformerService _uriTransformer: IURITransformerService,\n\t\t@ILogService _logService: ILogService,\n\t) {\n\t\tsuper(extHostRpc, _uriTransformer, _logService);\n\n\t\tif (initData.remote.isRemote && initData.remote.authority) {\n\t\t\tthis._registerEHSearchProviders();\n\t\t}\n\t}\n\n\tprivate _registerEHSearchProviders(): void {\n\t\tconst outputChannel = new OutputChannel(this._logService);\n\t\tthis.registerTextSearchProvider(Schemas.file, new RipgrepSearchProvider(outputChannel));\n\t\tthis.registerInternalFileSearchProvider(Schemas.file, new SearchService());\n\t}\n\n\tprivate registerInternalFileSearchProvider(scheme: string, provider: SearchService): IDisposable {\n\t\tconst handle = this._handlePool++;\n\t\tthis._internalFileSearchProvider = provider;\n\t\tthis._internalFileSearchHandle = handle;\n\t\tthis._proxy.$registerFileSearchProvider(handle, this._transformScheme(scheme));\n\t\treturn toDisposable(() => {\n\t\t\tthis._internalFileSearchProvider = null;\n\t\t\tthis._proxy.$unregisterProvider(handle);\n\t\t});\n\t}\n\n\t$provideFileSearchResults(handle: number, session: number, rawQuery: IRawFileQuery, token: vscode.CancellationToken): Promise<ISearchCompleteStats> {\n\t\tconst query = reviveQuery(rawQuery);\n\t\tif (handle === this._internalFileSearchHandle) {\n\t\t\treturn this.doInternalFileSearch(handle, session, query, token);\n\t\t}\n\n\t\treturn super.$provideFileSearchResults(handle, session, rawQuery, token);\n\t}\n\n\tprivate doInternalFileSearch(handle: number, session: number, rawQuery: IFileQuery, token: vscode.CancellationToken): Promise<ISearchCompleteStats> {\n\t\tconst onResult = (ev: ISerializedSearchProgressItem) => {\n\t\t\tif (isSerializedFileMatch(ev)) {\n\t\t\t\tev = [ev];\n\t\t\t}\n\n\t\t\tif (Array.isArray(ev)) {\n\t\t\t\tthis._proxy.$handleFileMatch(handle, session, ev.map(m => URI.file(m.path)));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (ev.message) {\n\t\t\t\tthis._logService.debug('ExtHostSearch', ev.message);\n\t\t\t}\n\t\t};\n\n\t\tif (!this._internalFileSearchProvider) {\n\t\t\tthrow new Error('No internal file search handler');\n\t\t}\n\n\t\treturn <Promise<ISearchCompleteStats>>this._internalFileSearchProvider.doFileSearch(rawQuery, onResult, token);\n\t}\n\n\t$clearCache(cacheKey: string): Promise<void> {\n\t\tif (this._internalFileSearchProvider) {\n\t\t\tthis._internalFileSearchProvider.clearCache(cacheKey);\n\t\t}\n\n\t\treturn super.$clearCache(cacheKey);\n\t}\n\n\tprotected createTextSearchManager(query: ITextQuery, provider: vscode.TextSearchProvider): TextSearchManager {\n\t\treturn new NativeTextSearchManager(query, provider);\n\t}\n}\n\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { createHash } from 'crypto';\nimport { Socket, Server as NetServer, createConnection, createServer } from 'net';\nimport * as zlib from 'zlib';\nimport { Event, Emitter } from 'vs/base/common/event';\nimport { ClientConnectionEvent, IPCServer } from 'vs/base/parts/ipc/common/ipc';\nimport { join } from 'vs/base/common/path';\nimport { tmpdir } from 'os';\nimport { generateUuid } from 'vs/base/common/uuid';\nimport { IDisposable, Disposable } from 'vs/base/common/lifecycle';\nimport { VSBuffer } from 'vs/base/common/buffer';\nimport { ISocket, Protocol, Client, ChunkStream } from 'vs/base/parts/ipc/common/ipc.net';\nimport { onUnexpectedError } from 'vs/base/common/errors';\nimport { Platform, platform } from 'vs/base/common/platform';\n\nexport class NodeSocket implements ISocket {\n\tpublic readonly socket: Socket;\n\n\tconstructor(socket: Socket) {\n\t\tthis.socket = socket;\n\t}\n\n\tpublic dispose(): void {\n\t\tthis.socket.destroy();\n\t}\n\n\tpublic onData(_listener: (e: VSBuffer) => void): IDisposable {\n\t\tconst listener = (buff: Buffer) => _listener(VSBuffer.wrap(buff));\n\t\tthis.socket.on('data', listener);\n\t\treturn {\n\t\t\tdispose: () => this.socket.off('data', listener)\n\t\t};\n\t}\n\n\tpublic onClose(listener: () => void): IDisposable {\n\t\tthis.socket.on('close', listener);\n\t\treturn {\n\t\t\tdispose: () => this.socket.off('close', listener)\n\t\t};\n\t}\n\n\tpublic onEnd(listener: () => void): IDisposable {\n\t\tthis.socket.on('end', listener);\n\t\treturn {\n\t\t\tdispose: () => this.socket.off('end', listener)\n\t\t};\n\t}\n\n\tpublic write(buffer: VSBuffer): void {\n\t\t// return early if socket has been destroyed in the meantime\n\t\tif (this.socket.destroyed) {\n\t\t\treturn;\n\t\t}\n\n\t\t// we ignore the returned value from `write` because we would have to cached the data\n\t\t// anyways and nodejs is already doing that for us:\n\t\t// > https://nodejs.org/api/stream.html#stream_writable_write_chunk_encoding_callback\n\t\t// > However, the false return value is only advisory and the writable stream will unconditionally\n\t\t// > accept and buffer chunk even if it has not been allowed to drain.\n\t\ttry {\n\t\t\tthis.socket.write(<Buffer>buffer.buffer);\n\t\t} catch (err) {\n\t\t\tif (err.code === 'EPIPE') {\n\t\t\t\t// An EPIPE exception at the wrong time can lead to a renderer process crash\n\t\t\t\t// so ignore the error since the socket will fire the close event soon anyways:\n\t\t\t\t// > https://nodejs.org/api/errors.html#errors_common_system_errors\n\t\t\t\t// > EPIPE (Broken pipe): A write on a pipe, socket, or FIFO for which there is no\n\t\t\t\t// > process to read the data. Commonly encountered at the net and http layers,\n\t\t\t\t// > indicative that the remote side of the stream being written to has been closed.\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tonUnexpectedError(err);\n\t\t}\n\t}\n\n\tpublic end(): void {\n\t\tthis.socket.end();\n\t}\n\n\tpublic drain(): Promise<void> {\n\t\treturn new Promise<void>((resolve, reject) => {\n\t\t\tif (this.socket.bufferSize === 0) {\n\t\t\t\tresolve();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst finished = () => {\n\t\t\t\tthis.socket.off('close', finished);\n\t\t\t\tthis.socket.off('end', finished);\n\t\t\t\tthis.socket.off('error', finished);\n\t\t\t\tthis.socket.off('timeout', finished);\n\t\t\t\tthis.socket.off('drain', finished);\n\t\t\t\tresolve();\n\t\t\t};\n\t\t\tthis.socket.on('close', finished);\n\t\t\tthis.socket.on('end', finished);\n\t\t\tthis.socket.on('error', finished);\n\t\t\tthis.socket.on('timeout', finished);\n\t\t\tthis.socket.on('drain', finished);\n\t\t});\n\t}\n}\n\nconst enum Constants {\n\tMinHeaderByteSize = 2\n}\n\nconst enum ReadState {\n\tPeekHeader = 1,\n\tReadHeader = 2,\n\tReadBody = 3,\n\tFin = 4\n}\n\n/**\n * See https://tools.ietf.org/html/rfc6455#section-5.2\n */\nexport class WebSocketNodeSocket extends Disposable implements ISocket {\n\n\tpublic readonly socket: NodeSocket;\n\tpublic readonly permessageDeflate: boolean;\n\tprivate _totalIncomingWireBytes: number;\n\tprivate _totalIncomingDataBytes: number;\n\tprivate _totalOutgoingWireBytes: number;\n\tprivate _totalOutgoingDataBytes: number;\n\tprivate readonly _zlibInflate: zlib.InflateRaw | null;\n\tprivate readonly _zlibDeflate: zlib.DeflateRaw | null;\n\tprivate _zlibDeflateFlushWaitingCount: number;\n\tprivate readonly _onDidZlibFlush = this._register(new Emitter<void>());\n\tprivate readonly _recordInflateBytes: boolean;\n\tprivate readonly _recordedInflateBytes: Buffer[] = [];\n\tprivate readonly _pendingInflateData: Buffer[] = [];\n\tprivate readonly _pendingDeflateData: Buffer[] = [];\n\tprivate readonly _incomingData: ChunkStream;\n\tprivate readonly _onData = this._register(new Emitter<VSBuffer>());\n\tprivate readonly _onClose = this._register(new Emitter<void>());\n\tprivate _isEnded: boolean = false;\n\n\tprivate readonly _state = {\n\t\tstate: ReadState.PeekHeader,\n\t\treadLen: Constants.MinHeaderByteSize,\n\t\tfin: 0,\n\t\tmask: 0\n\t};\n\n\tpublic get totalIncomingWireBytes(): number {\n\t\treturn this._totalIncomingWireBytes;\n\t}\n\n\tpublic get totalIncomingDataBytes(): number {\n\t\treturn this._totalIncomingDataBytes;\n\t}\n\n\tpublic get totalOutgoingWireBytes(): number {\n\t\treturn this._totalOutgoingWireBytes;\n\t}\n\n\tpublic get totalOutgoingDataBytes(): number {\n\t\treturn this._totalOutgoingDataBytes;\n\t}\n\n\tpublic get recordedInflateBytes(): VSBuffer {\n\t\tif (this._recordInflateBytes) {\n\t\t\treturn VSBuffer.wrap(Buffer.concat(this._recordedInflateBytes));\n\t\t}\n\t\treturn VSBuffer.alloc(0);\n\t}\n\n\t/**\n\t * Create a socket which can communicate using WebSocket frames.\n\t *\n\t * **NOTE**: When using the permessage-deflate WebSocket extension, if parts of inflating was done\n\t *  in a different zlib instance, we need to pass all those bytes into zlib, otherwise the inflate\n\t *  might hit an inflated portion referencing a distance too far back.\n\t *\n\t * @param socket The underlying socket\n\t * @param permessageDeflate Use the permessage-deflate WebSocket extension\n\t * @param inflateBytes \"Seed\" zlib inflate with these bytes.\n\t * @param recordInflateBytes Record all bytes sent to inflate\n\t */\n\tconstructor(socket: NodeSocket, permessageDeflate: boolean, inflateBytes: VSBuffer | null, recordInflateBytes: boolean) {\n\t\tsuper();\n\t\tthis.socket = socket;\n\t\tthis._totalIncomingWireBytes = 0;\n\t\tthis._totalIncomingDataBytes = 0;\n\t\tthis._totalOutgoingWireBytes = 0;\n\t\tthis._totalOutgoingDataBytes = 0;\n\t\tthis.permessageDeflate = permessageDeflate;\n\t\tthis._recordInflateBytes = recordInflateBytes;\n\t\tif (permessageDeflate) {\n\t\t\t// See https://tools.ietf.org/html/rfc7692#page-16\n\t\t\t// To simplify our logic, we don't negociate the window size\n\t\t\t// and simply dedicate (2^15) / 32kb per web socket\n\t\t\tthis._zlibInflate = zlib.createInflateRaw({\n\t\t\t\twindowBits: 15\n\t\t\t});\n\t\t\tthis._zlibInflate.on('error', (err) => {\n\t\t\t\t// zlib errors are fatal, since we have no idea how to recover\n\t\t\t\tconsole.error(err);\n\t\t\t\tonUnexpectedError(err);\n\t\t\t\tthis._onClose.fire();\n\t\t\t});\n\t\t\tthis._zlibInflate.on('data', (data: Buffer) => {\n\t\t\t\tthis._pendingInflateData.push(data);\n\t\t\t});\n\t\t\tif (inflateBytes) {\n\t\t\t\tthis._zlibInflate.write(inflateBytes.buffer);\n\t\t\t\tthis._zlibInflate.flush(() => {\n\t\t\t\t\tthis._pendingInflateData.length = 0;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis._zlibDeflate = zlib.createDeflateRaw({\n\t\t\t\twindowBits: 15\n\t\t\t});\n\t\t\tthis._zlibDeflate.on('error', (err) => {\n\t\t\t\t// zlib errors are fatal, since we have no idea how to recover\n\t\t\t\tconsole.error(err);\n\t\t\t\tonUnexpectedError(err);\n\t\t\t\tthis._onClose.fire();\n\t\t\t});\n\t\t\tthis._zlibDeflate.on('data', (data: Buffer) => {\n\t\t\t\tthis._pendingDeflateData.push(data);\n\t\t\t});\n\t\t} else {\n\t\t\tthis._zlibInflate = null;\n\t\t\tthis._zlibDeflate = null;\n\t\t}\n\t\tthis._zlibDeflateFlushWaitingCount = 0;\n\t\tthis._incomingData = new ChunkStream();\n\t\tthis._register(this.socket.onData(data => this._acceptChunk(data)));\n\t\tthis._register(this.socket.onClose(() => this._onClose.fire()));\n\t}\n\n\tpublic dispose(): void {\n\t\tif (this._zlibDeflateFlushWaitingCount > 0) {\n\t\t\t// Wait for any outstanding writes to finish before disposing\n\t\t\tthis._register(this._onDidZlibFlush.event(() => {\n\t\t\t\tthis.dispose();\n\t\t\t}));\n\t\t} else {\n\t\t\tthis.socket.dispose();\n\t\t\tsuper.dispose();\n\t\t}\n\t}\n\n\tpublic onData(listener: (e: VSBuffer) => void): IDisposable {\n\t\treturn this._onData.event(listener);\n\t}\n\n\tpublic onClose(listener: () => void): IDisposable {\n\t\treturn this._onClose.event(listener);\n\t}\n\n\tpublic onEnd(listener: () => void): IDisposable {\n\t\treturn this.socket.onEnd(listener);\n\t}\n\n\tpublic write(buffer: VSBuffer): void {\n\t\tthis._totalOutgoingDataBytes += buffer.byteLength;\n\n\t\tif (this._zlibDeflate) {\n\t\t\tthis._zlibDeflate.write(<Buffer>buffer.buffer);\n\n\t\t\tthis._zlibDeflateFlushWaitingCount++;\n\t\t\t// See https://zlib.net/manual.html#Constants\n\t\t\tthis._zlibDeflate.flush(/*Z_SYNC_FLUSH*/2, () => {\n\t\t\t\tthis._zlibDeflateFlushWaitingCount--;\n\t\t\t\tlet data = Buffer.concat(this._pendingDeflateData);\n\t\t\t\tthis._pendingDeflateData.length = 0;\n\n\t\t\t\t// See https://tools.ietf.org/html/rfc7692#section-7.2.1\n\t\t\t\tdata = data.slice(0, data.length - 4);\n\n\t\t\t\tif (!this._isEnded) {\n\t\t\t\t\t// Avoid ERR_STREAM_WRITE_AFTER_END\n\t\t\t\t\tthis._write(VSBuffer.wrap(data), true);\n\t\t\t\t}\n\n\t\t\t\tif (this._zlibDeflateFlushWaitingCount === 0) {\n\t\t\t\t\tthis._onDidZlibFlush.fire();\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tthis._write(buffer, false);\n\t\t}\n\t}\n\n\tprivate _write(buffer: VSBuffer, compressed: boolean): void {\n\t\tlet headerLen = Constants.MinHeaderByteSize;\n\t\tif (buffer.byteLength < 126) {\n\t\t\theaderLen += 0;\n\t\t} else if (buffer.byteLength < 2 ** 16) {\n\t\t\theaderLen += 2;\n\t\t} else {\n\t\t\theaderLen += 8;\n\t\t}\n\t\tconst header = VSBuffer.alloc(headerLen);\n\n\t\tif (compressed) {\n\t\t\t// The RSV1 bit indicates a compressed frame\n\t\t\theader.writeUInt8(0b11000010, 0);\n\t\t} else {\n\t\t\theader.writeUInt8(0b10000010, 0);\n\t\t}\n\t\tif (buffer.byteLength < 126) {\n\t\t\theader.writeUInt8(buffer.byteLength, 1);\n\t\t} else if (buffer.byteLength < 2 ** 16) {\n\t\t\theader.writeUInt8(126, 1);\n\t\t\tlet offset = 1;\n\t\t\theader.writeUInt8((buffer.byteLength >>> 8) & 0b11111111, ++offset);\n\t\t\theader.writeUInt8((buffer.byteLength >>> 0) & 0b11111111, ++offset);\n\t\t} else {\n\t\t\theader.writeUInt8(127, 1);\n\t\t\tlet offset = 1;\n\t\t\theader.writeUInt8(0, ++offset);\n\t\t\theader.writeUInt8(0, ++offset);\n\t\t\theader.writeUInt8(0, ++offset);\n\t\t\theader.writeUInt8(0, ++offset);\n\t\t\theader.writeUInt8((buffer.byteLength >>> 24) & 0b11111111, ++offset);\n\t\t\theader.writeUInt8((buffer.byteLength >>> 16) & 0b11111111, ++offset);\n\t\t\theader.writeUInt8((buffer.byteLength >>> 8) & 0b11111111, ++offset);\n\t\t\theader.writeUInt8((buffer.byteLength >>> 0) & 0b11111111, ++offset);\n\t\t}\n\n\t\tthis._totalOutgoingWireBytes += header.byteLength + buffer.byteLength;\n\t\tthis.socket.write(VSBuffer.concat([header, buffer]));\n\t}\n\n\tpublic end(): void {\n\t\tthis._isEnded = true;\n\t\tthis.socket.end();\n\t}\n\n\tprivate _acceptChunk(data: VSBuffer): void {\n\t\tif (data.byteLength === 0) {\n\t\t\treturn;\n\t\t}\n\t\tthis._totalIncomingWireBytes += data.byteLength;\n\n\t\tthis._incomingData.acceptChunk(data);\n\n\t\twhile (this._incomingData.byteLength >= this._state.readLen) {\n\n\t\t\tif (this._state.state === ReadState.PeekHeader) {\n\t\t\t\t// peek to see if we can read the entire header\n\t\t\t\tconst peekHeader = this._incomingData.peek(this._state.readLen);\n\t\t\t\tconst firstByte = peekHeader.readUInt8(0);\n\t\t\t\tconst finBit = (firstByte & 0b10000000) >>> 7;\n\t\t\t\tconst secondByte = peekHeader.readUInt8(1);\n\t\t\t\tconst hasMask = (secondByte & 0b10000000) >>> 7;\n\t\t\t\tconst len = (secondByte & 0b01111111);\n\n\t\t\t\tthis._state.state = ReadState.ReadHeader;\n\t\t\t\tthis._state.readLen = Constants.MinHeaderByteSize + (hasMask ? 4 : 0) + (len === 126 ? 2 : 0) + (len === 127 ? 8 : 0);\n\t\t\t\tthis._state.fin = finBit;\n\t\t\t\tthis._state.mask = 0;\n\n\t\t\t} else if (this._state.state === ReadState.ReadHeader) {\n\t\t\t\t// read entire header\n\t\t\t\tconst header = this._incomingData.read(this._state.readLen);\n\t\t\t\tconst secondByte = header.readUInt8(1);\n\t\t\t\tconst hasMask = (secondByte & 0b10000000) >>> 7;\n\t\t\t\tlet len = (secondByte & 0b01111111);\n\n\t\t\t\tlet offset = 1;\n\t\t\t\tif (len === 126) {\n\t\t\t\t\tlen = (\n\t\t\t\t\t\theader.readUInt8(++offset) * 2 ** 8\n\t\t\t\t\t\t+ header.readUInt8(++offset)\n\t\t\t\t\t);\n\t\t\t\t} else if (len === 127) {\n\t\t\t\t\tlen = (\n\t\t\t\t\t\theader.readUInt8(++offset) * 0\n\t\t\t\t\t\t+ header.readUInt8(++offset) * 0\n\t\t\t\t\t\t+ header.readUInt8(++offset) * 0\n\t\t\t\t\t\t+ header.readUInt8(++offset) * 0\n\t\t\t\t\t\t+ header.readUInt8(++offset) * 2 ** 24\n\t\t\t\t\t\t+ header.readUInt8(++offset) * 2 ** 16\n\t\t\t\t\t\t+ header.readUInt8(++offset) * 2 ** 8\n\t\t\t\t\t\t+ header.readUInt8(++offset)\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tlet mask = 0;\n\t\t\t\tif (hasMask) {\n\t\t\t\t\tmask = (\n\t\t\t\t\t\theader.readUInt8(++offset) * 2 ** 24\n\t\t\t\t\t\t+ header.readUInt8(++offset) * 2 ** 16\n\t\t\t\t\t\t+ header.readUInt8(++offset) * 2 ** 8\n\t\t\t\t\t\t+ header.readUInt8(++offset)\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tthis._state.state = ReadState.ReadBody;\n\t\t\t\tthis._state.readLen = len;\n\t\t\t\tthis._state.mask = mask;\n\n\t\t\t} else if (this._state.state === ReadState.ReadBody) {\n\t\t\t\t// read body\n\n\t\t\t\tconst body = this._incomingData.read(this._state.readLen);\n\t\t\t\tunmask(body, this._state.mask);\n\n\t\t\t\tthis._state.state = ReadState.PeekHeader;\n\t\t\t\tthis._state.readLen = Constants.MinHeaderByteSize;\n\t\t\t\tthis._state.mask = 0;\n\n\t\t\t\tif (this._zlibInflate) {\n\t\t\t\t\t// See https://tools.ietf.org/html/rfc7692#section-7.2.2\n\t\t\t\t\tif (this._recordInflateBytes) {\n\t\t\t\t\t\tthis._recordedInflateBytes.push(Buffer.from(<Buffer>body.buffer));\n\t\t\t\t\t}\n\t\t\t\t\tthis._zlibInflate.write(<Buffer>body.buffer);\n\t\t\t\t\tif (this._state.fin) {\n\t\t\t\t\t\tif (this._recordInflateBytes) {\n\t\t\t\t\t\t\tthis._recordedInflateBytes.push(Buffer.from([0x00, 0x00, 0xff, 0xff]));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis._zlibInflate.write(Buffer.from([0x00, 0x00, 0xff, 0xff]));\n\t\t\t\t\t}\n\t\t\t\t\tthis._zlibInflate.flush(() => {\n\t\t\t\t\t\tconst data = Buffer.concat(this._pendingInflateData);\n\t\t\t\t\t\tthis._pendingInflateData.length = 0;\n\t\t\t\t\t\tthis._totalIncomingDataBytes += data.length;\n\t\t\t\t\t\tthis._onData.fire(VSBuffer.wrap(data));\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthis._totalIncomingDataBytes += body.byteLength;\n\t\t\t\t\tthis._onData.fire(body);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic async drain(): Promise<void> {\n\t\tif (this._zlibDeflateFlushWaitingCount > 0) {\n\t\t\tawait Event.toPromise(this._onDidZlibFlush.event);\n\t\t}\n\t\tawait this.socket.drain();\n\t}\n}\n\nfunction unmask(buffer: VSBuffer, mask: number): void {\n\tif (mask === 0) {\n\t\treturn;\n\t}\n\tlet cnt = buffer.byteLength >>> 2;\n\tfor (let i = 0; i < cnt; i++) {\n\t\tconst v = buffer.readUInt32BE(i * 4);\n\t\tbuffer.writeUInt32BE(v ^ mask, i * 4);\n\t}\n\tlet offset = cnt * 4;\n\tlet bytesLeft = buffer.byteLength - offset;\n\tconst m3 = (mask >>> 24) & 0b11111111;\n\tconst m2 = (mask >>> 16) & 0b11111111;\n\tconst m1 = (mask >>> 8) & 0b11111111;\n\tif (bytesLeft >= 1) {\n\t\tbuffer.writeUInt8(buffer.readUInt8(offset) ^ m3, offset);\n\t}\n\tif (bytesLeft >= 2) {\n\t\tbuffer.writeUInt8(buffer.readUInt8(offset + 1) ^ m2, offset + 1);\n\t}\n\tif (bytesLeft >= 3) {\n\t\tbuffer.writeUInt8(buffer.readUInt8(offset + 2) ^ m1, offset + 2);\n\t}\n}\n\n// Read this before there's any chance it is overwritten\n// Related to https://github.com/microsoft/vscode/issues/30624\nexport const XDG_RUNTIME_DIR = <string | undefined>process.env['XDG_RUNTIME_DIR'];\n\nconst safeIpcPathLengths: { [platform: number]: number } = {\n\t[Platform.Linux]: 107,\n\t[Platform.Mac]: 103\n};\n\nexport function createRandomIPCHandle(): string {\n\tconst randomSuffix = generateUuid();\n\n\t// Windows: use named pipe\n\tif (process.platform === 'win32') {\n\t\treturn `\\\\\\\\.\\\\pipe\\\\vscode-ipc-${randomSuffix}-sock`;\n\t}\n\n\t// Mac/Unix: use socket file and prefer\n\t// XDG_RUNTIME_DIR over tmpDir\n\tlet result: string;\n\tif (XDG_RUNTIME_DIR) {\n\t\tresult = join(XDG_RUNTIME_DIR, `vscode-ipc-${randomSuffix}.sock`);\n\t} else {\n\t\tresult = join(tmpdir(), `vscode-ipc-${randomSuffix}.sock`);\n\t}\n\n\t// Validate length\n\tvalidateIPCHandleLength(result);\n\n\treturn result;\n}\n\nexport function createStaticIPCHandle(directoryPath: string, type: string, version: string): string {\n\tconst scope = createHash('md5').update(directoryPath).digest('hex');\n\n\t// Windows: use named pipe\n\tif (process.platform === 'win32') {\n\t\treturn `\\\\\\\\.\\\\pipe\\\\${scope}-${version}-${type}-sock`;\n\t}\n\n\t// Mac/Unix: use socket file and prefer\n\t// XDG_RUNTIME_DIR over user data path\n\t// unless portable\n\tlet result: string;\n\tif (XDG_RUNTIME_DIR && !process.env['VSCODE_PORTABLE']) {\n\t\tresult = join(XDG_RUNTIME_DIR, `vscode-${scope.substr(0, 8)}-${version}-${type}.sock`);\n\t} else {\n\t\tresult = join(directoryPath, `${version}-${type}.sock`);\n\t}\n\n\t// Validate length\n\tvalidateIPCHandleLength(result);\n\n\treturn result;\n}\n\nfunction validateIPCHandleLength(handle: string): void {\n\tconst limit = safeIpcPathLengths[platform];\n\tif (typeof limit === 'number' && handle.length >= limit) {\n\t\t// https://nodejs.org/api/net.html#net_identifying_paths_for_ipc_connections\n\t\tconsole.warn(`WARNING: IPC handle \"${handle}\" is longer than ${limit} chars, try a shorter --user-data-dir`);\n\t}\n}\n\nexport class Server extends IPCServer {\n\n\tprivate static toClientConnectionEvent(server: NetServer): Event<ClientConnectionEvent> {\n\t\tconst onConnection = Event.fromNodeEventEmitter<Socket>(server, 'connection');\n\n\t\treturn Event.map(onConnection, socket => ({\n\t\t\tprotocol: new Protocol(new NodeSocket(socket)),\n\t\t\tonDidClientDisconnect: Event.once(Event.fromNodeEventEmitter<void>(socket, 'close'))\n\t\t}));\n\t}\n\n\tprivate server: NetServer | null;\n\n\tconstructor(server: NetServer) {\n\t\tsuper(Server.toClientConnectionEvent(server));\n\t\tthis.server = server;\n\t}\n\n\tdispose(): void {\n\t\tsuper.dispose();\n\t\tif (this.server) {\n\t\t\tthis.server.close();\n\t\t\tthis.server = null;\n\t\t}\n\t}\n}\n\nexport function serve(port: number): Promise<Server>;\nexport function serve(namedPipe: string): Promise<Server>;\nexport function serve(hook: any): Promise<Server> {\n\treturn new Promise<Server>((c, e) => {\n\t\tconst server = createServer();\n\n\t\tserver.on('error', e);\n\t\tserver.listen(hook, () => {\n\t\t\tserver.removeListener('error', e);\n\t\t\tc(new Server(server));\n\t\t});\n\t});\n}\n\nexport function connect(options: { host: string, port: number }, clientId: string): Promise<Client>;\nexport function connect(port: number, clientId: string): Promise<Client>;\nexport function connect(namedPipe: string, clientId: string): Promise<Client>;\nexport function connect(hook: any, clientId: string): Promise<Client> {\n\treturn new Promise<Client>((c, e) => {\n\t\tconst socket = createConnection(hook, () => {\n\t\t\tsocket.removeListener('error', e);\n\t\t\tc(Client.fromSocket(new NodeSocket(socket), clientId));\n\t\t});\n\n\t\tsocket.once('error', e);\n\t});\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { createRandomIPCHandle } from 'vs/base/parts/ipc/node/ipc.net';\nimport * as http from 'http';\nimport * as fs from 'fs';\nimport { IExtHostCommands } from 'vs/workbench/api/common/extHostCommands';\nimport { IWindowOpenable, IOpenWindowOptions } from 'vs/platform/windows/common/windows';\nimport { URI } from 'vs/base/common/uri';\nimport { hasWorkspaceFileExtension } from 'vs/platform/workspaces/common/workspaces';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { join } from 'vs/base/common/path';\nimport { tmpdir } from 'os';\n\nexport interface OpenCommandPipeArgs {\n\ttype: 'open';\n\tfileURIs?: string[];\n\tfolderURIs?: string[];\n\tforceNewWindow?: boolean;\n\tdiffMode?: boolean;\n\taddMode?: boolean;\n\tgotoLineMode?: boolean;\n\tforceReuseWindow?: boolean;\n\twaitMarkerFilePath?: string;\n}\n\nexport interface OpenExternalCommandPipeArgs {\n\ttype: 'openExternal';\n\turis: string[];\n}\n\nexport interface StatusPipeArgs {\n\ttype: 'status';\n}\n\nexport interface RunCommandPipeArgs {\n\ttype: 'command';\n\tcommand: string;\n\targs: any[];\n}\n\nexport interface ExtensionManagementPipeArgs {\n\ttype: 'extensionManagement';\n\tlist?: { showVersions?: boolean, category?: string; };\n\tinstall?: string[];\n\tuninstall?: string[];\n\tforce?: boolean;\n}\n\nexport type PipeCommand = OpenCommandPipeArgs | StatusPipeArgs | RunCommandPipeArgs | OpenExternalCommandPipeArgs | ExtensionManagementPipeArgs;\n\nexport interface ICommandsExecuter {\n\texecuteCommand<T>(id: string, ...args: any[]): Promise<T>;\n}\n\nexport class CLIServerBase {\n\tprivate readonly _server: http.Server;\n\n\tconstructor(\n\t\tprivate readonly _commands: ICommandsExecuter,\n\t\tprivate readonly logService: ILogService,\n\t\tprivate readonly _ipcHandlePath: string,\n\t) {\n\t\tthis._server = http.createServer((req, res) => this.onRequest(req, res));\n\t\tthis.setup().catch(err => {\n\t\t\tlogService.error(err);\n\t\t\treturn '';\n\t\t});\n\t}\n\n\tpublic get ipcHandlePath() {\n\t\treturn this._ipcHandlePath;\n\t}\n\n\tprivate async setup(): Promise<string> {\n\t\t// NOTE@coder: Write this out so we can get the most recent path.\n\t\tfs.promises.writeFile(join(tmpdir(), 'vscode-ipc'), this._ipcHandlePath).catch((error) => {\n\t\t\tthis.logService.error(error);\n\t\t});\n\n\t\ttry {\n\t\t\tthis._server.listen(this.ipcHandlePath);\n\t\t\tthis._server.on('error', err => this.logService.error(err));\n\t\t} catch (err) {\n\t\t\tthis.logService.error('Could not start open from terminal server.');\n\t\t}\n\n\t\treturn this._ipcHandlePath;\n\t}\n\n\tprivate onRequest(req: http.IncomingMessage, res: http.ServerResponse): void {\n\t\tconst chunks: string[] = [];\n\t\treq.setEncoding('utf8');\n\t\treq.on('data', (d: string) => chunks.push(d));\n\t\treq.on('end', () => {\n\t\t\tconst data: PipeCommand | any = JSON.parse(chunks.join(''));\n\t\t\tswitch (data.type) {\n\t\t\t\tcase 'open':\n\t\t\t\t\tthis.open(data, res);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'openExternal':\n\t\t\t\t\tthis.openExternal(data, res);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'status':\n\t\t\t\t\tthis.getStatus(data, res);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'command':\n\t\t\t\t\tthis.runCommand(data, res)\n\t\t\t\t\t\t.catch(this.logService.error);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'extensionManagement':\n\t\t\t\t\tthis.manageExtensions(data, res)\n\t\t\t\t\t\t.catch(this.logService.error);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tres.writeHead(404);\n\t\t\t\t\tres.write(`Unknown message type: ${data.type}`, err => {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\tthis.logService.error(err);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tres.end();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate open(data: OpenCommandPipeArgs, res: http.ServerResponse) {\n\t\tlet { fileURIs, folderURIs, forceNewWindow, diffMode, addMode, forceReuseWindow, gotoLineMode, waitMarkerFilePath } = data;\n\t\tconst urisToOpen: IWindowOpenable[] = [];\n\t\tif (Array.isArray(folderURIs)) {\n\t\t\tfor (const s of folderURIs) {\n\t\t\t\ttry {\n\t\t\t\t\turisToOpen.push({ folderUri: URI.parse(s) });\n\t\t\t\t} catch (e) {\n\t\t\t\t\t// ignore\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (Array.isArray(fileURIs)) {\n\t\t\tfor (const s of fileURIs) {\n\t\t\t\ttry {\n\t\t\t\t\tif (hasWorkspaceFileExtension(s)) {\n\t\t\t\t\t\turisToOpen.push({ workspaceUri: URI.parse(s) });\n\t\t\t\t\t} else {\n\t\t\t\t\t\turisToOpen.push({ fileUri: URI.parse(s) });\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\t// ignore\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (urisToOpen.length) {\n\t\t\tconst waitMarkerFileURI = waitMarkerFilePath ? URI.file(waitMarkerFilePath) : undefined;\n\t\t\tconst preferNewWindow = !forceReuseWindow && !waitMarkerFileURI && !addMode;\n\t\t\tconst windowOpenArgs: IOpenWindowOptions = { forceNewWindow, diffMode, addMode, gotoLineMode, forceReuseWindow, preferNewWindow, waitMarkerFileURI };\n\t\t\tthis._commands.executeCommand('_files.windowOpen', urisToOpen, windowOpenArgs);\n\t\t}\n\t\tres.writeHead(200);\n\t\tres.end();\n\t}\n\n\tprivate async openExternal(data: OpenExternalCommandPipeArgs, res: http.ServerResponse) {\n\t\tfor (const uri of data.uris) {\n\t\t\tawait this._commands.executeCommand('_remoteCLI.openExternal', URI.parse(uri), { allowTunneling: true });\n\t\t}\n\t\tres.writeHead(200);\n\t\tres.end();\n\t}\n\n\tprivate async manageExtensions(data: ExtensionManagementPipeArgs, res: http.ServerResponse) {\n\t\tconsole.log('server: manageExtensions');\n\t\ttry {\n\t\t\tconst toExtOrVSIX = (inputs: string[] | undefined) => inputs?.map(input => /\\.vsix$/i.test(input) ? URI.parse(input) : input);\n\t\t\tconst commandArgs = {\n\t\t\t\tlist: data.list,\n\t\t\t\tinstall: toExtOrVSIX(data.install),\n\t\t\t\tuninstall: toExtOrVSIX(data.uninstall),\n\t\t\t\tforce: data.force\n\t\t\t};\n\t\t\tconst output = await this._commands.executeCommand('_remoteCLI.manageExtensions', commandArgs, { allowTunneling: true });\n\t\t\tres.writeHead(200);\n\t\t\tres.write(output);\n\t\t} catch (e) {\n\t\t\tres.writeHead(500);\n\t\t\tres.write(String(e));\n\t\t}\n\t\tres.end();\n\t}\n\n\tprivate async getStatus(data: StatusPipeArgs, res: http.ServerResponse) {\n\t\ttry {\n\t\t\tconst status = await this._commands.executeCommand('_issues.getSystemStatus');\n\t\t\tres.writeHead(200);\n\t\t\tres.write(status);\n\t\t\tres.end();\n\t\t} catch (err) {\n\t\t\tres.writeHead(500);\n\t\t\tres.write(String(err), err => {\n\t\t\t\tif (err) {\n\t\t\t\t\tthis.logService.error(err);\n\t\t\t\t}\n\t\t\t});\n\t\t\tres.end();\n\t\t}\n\t}\n\n\tprivate async runCommand(data: RunCommandPipeArgs, res: http.ServerResponse) {\n\t\ttry {\n\t\t\tconst { command, args } = data;\n\t\t\tconst result = await this._commands.executeCommand(command, ...args);\n\t\t\tres.writeHead(200);\n\t\t\tres.write(JSON.stringify(result), err => {\n\t\t\t\tif (err) {\n\t\t\t\t\tthis.logService.error(err);\n\t\t\t\t}\n\t\t\t});\n\t\t\tres.end();\n\t\t} catch (err) {\n\t\t\tres.writeHead(500);\n\t\t\tres.write(String(err), err => {\n\t\t\t\tif (err) {\n\t\t\t\t\tthis.logService.error(err);\n\t\t\t\t}\n\t\t\t});\n\t\t\tres.end();\n\t\t}\n\t}\n\n\tdispose(): void {\n\t\tthis._server.close();\n\n\t\tif (this._ipcHandlePath && process.platform !== 'win32' && fs.existsSync(this._ipcHandlePath)) {\n\t\t\tfs.unlinkSync(this._ipcHandlePath);\n\t\t}\n\t}\n}\n\nexport class CLIServer extends CLIServerBase {\n\tconstructor(\n\t\t@IExtHostCommands commands: IExtHostCommands,\n\t\t@ILogService logService: ILogService\n\t) {\n\t\tsuper(commands, logService, createRandomIPCHandle());\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as performance from 'vs/base/common/performance';\nimport { createApiFactoryAndRegisterActors } from 'vs/workbench/api/common/extHost.api.impl';\nimport { RequireInterceptor } from 'vs/workbench/api/common/extHostRequireInterceptor';\nimport { MainContext } from 'vs/workbench/api/common/extHost.protocol';\nimport { ExtensionActivationTimesBuilder } from 'vs/workbench/api/common/extHostExtensionActivator';\nimport { connectProxyResolver } from 'vs/workbench/services/extensions/node/proxyResolver';\nimport { AbstractExtHostExtensionService } from 'vs/workbench/api/common/extHostExtensionService';\nimport { ExtHostDownloadService } from 'vs/workbench/api/node/extHostDownloadService';\nimport { CLIServer } from 'vs/workbench/api/node/extHostCLIServer';\nimport { URI } from 'vs/base/common/uri';\nimport { Schemas } from 'vs/base/common/network';\nimport { ExtensionIdentifier, IExtensionDescription } from 'vs/platform/extensions/common/extensions';\nimport { ExtensionRuntime } from 'vs/workbench/api/common/extHostTypes';\n\nclass NodeModuleRequireInterceptor extends RequireInterceptor {\n\n\tprotected _installInterceptor(): void {\n\t\tconst that = this;\n\t\tconst node_module = <any>require.__$__nodeRequire('module');\n\t\tconst original = node_module._load;\n\t\tnode_module._load = function load(request: string, parent: { filename: string; }, isMain: any) {\n\t\t\tfor (let alternativeModuleName of that._alternatives) {\n\t\t\t\tlet alternative = alternativeModuleName(request);\n\t\t\t\tif (alternative) {\n\t\t\t\t\trequest = alternative;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!that._factories.has(request)) {\n\t\t\t\treturn original.apply(this, arguments);\n\t\t\t}\n\t\t\treturn that._factories.get(request)!.load(\n\t\t\t\trequest,\n\t\t\t\tURI.file(parent.filename),\n\t\t\t\trequest => original.apply(this, [request, parent, isMain])\n\t\t\t);\n\t\t};\n\t}\n}\n\nexport class ExtHostExtensionService extends AbstractExtHostExtensionService {\n\n\treadonly extensionRuntime = ExtensionRuntime.Node;\n\n\tprotected async _beforeAlmostReadyToRunExtensions(): Promise<void> {\n\t\t// initialize API and register actors\n\t\tconst extensionApiFactory = this._instaService.invokeFunction(createApiFactoryAndRegisterActors);\n\n\t\t// Register Download command\n\t\tthis._instaService.createInstance(ExtHostDownloadService);\n\n\t\t// Register CLI Server for ipc\n\t\tif (this._initData.remote.isRemote && this._initData.remote.authority) {\n\t\t\tconst cliServer = this._instaService.createInstance(CLIServer);\n\t\t\tprocess.env['VSCODE_IPC_HOOK_CLI'] = cliServer.ipcHandlePath;\n\t\t}\n\n\t\t// Module loading tricks\n\t\tconst interceptor = this._instaService.createInstance(NodeModuleRequireInterceptor, extensionApiFactory, this._registry);\n\t\tawait interceptor.install();\n\t\tperformance.mark('code/extHost/didInitAPI');\n\n\t\t// Do this when extension service exists, but extensions are not being activated yet.\n\t\tconst configProvider = await this._extHostConfiguration.getConfigProvider();\n\t\tawait connectProxyResolver(this._extHostWorkspace, configProvider, this, this._logService, this._mainThreadTelemetryProxy, this._initData);\n\t\tperformance.mark('code/extHost/didInitProxyResolver');\n\n\t\t// Use IPC messages to forward console-calls, note that the console is\n\t\t// already patched to use`process.send()`\n\t\tconst nativeProcessSend = process.send!;\n\t\tconst mainThreadConsole = this._extHostContext.getProxy(MainContext.MainThreadConsole);\n\t\tprocess.send = (...args) => {\n\t\t\tif ((args as unknown[]).length === 0 || !args[0] || args[0].type !== '__$console') {\n\t\t\t\treturn nativeProcessSend.apply(process, args);\n\t\t\t}\n\t\t\tmainThreadConsole.$logExtensionHostMessage(args[0]);\n\t\t\treturn false;\n\t\t};\n\t}\n\n\tprotected _getEntryPoint(extensionDescription: IExtensionDescription): string | undefined {\n\t\treturn extensionDescription.main;\n\t}\n\n\tprotected _loadCommonJSModule<T>(extensionId: ExtensionIdentifier | null, module: URI, activationTimesBuilder: ExtensionActivationTimesBuilder): Promise<T> {\n\t\tif (module.scheme !== Schemas.file) {\n\t\t\tthrow new Error(`Cannot load URI: '${module}', must be of file-scheme`);\n\t\t}\n\t\tlet r: T | null = null;\n\t\tactivationTimesBuilder.codeLoadingStart();\n\t\tthis._logService.info(`ExtensionService#loadCommonJSModule ${module.toString(true)}`);\n\t\tthis._logService.flush();\n\t\ttry {\n\t\t\tif (extensionId) {\n\t\t\t\tperformance.mark(`code/extHost/willLoadExtensionCode/${extensionId.value}`);\n\t\t\t}\n\t\t\tr = require.__$__nodeRequire<T>(module.fsPath);\n\t\t} catch (e) {\n\t\t\treturn Promise.reject(e);\n\t\t} finally {\n\t\t\tif (extensionId) {\n\t\t\t\tperformance.mark(`code/extHost/didLoadExtensionCode/${extensionId.value}`);\n\t\t\t}\n\t\t\tactivationTimesBuilder.codeLoadingStop();\n\t\t}\n\t\treturn Promise.resolve(r);\n\t}\n\n\tpublic async $setRemoteEnvironment(env: { [key: string]: string | null }): Promise<void> {\n\t\tif (!this._initData.remote.isRemote) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const key in env) {\n\t\t\tconst value = env[key];\n\t\t\tif (value === null) {\n\t\t\t\tdelete process.env[key];\n\t\t\t} else {\n\t\t\t\tprocess.env[key] = value;\n\t\t\t}\n\t\t}\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { registerSingleton } from 'vs/platform/instantiation/common/extensions';\nimport { ExtHostOutputService2 } from 'vs/workbench/api/node/extHostOutputService';\nimport { ExtHostTerminalService } from 'vs/workbench/api/node/extHostTerminalService';\nimport { ExtHostTask } from 'vs/workbench/api/node/extHostTask';\nimport { ExtHostDebugService } from 'vs/workbench/api/node/extHostDebugService';\nimport { NativeExtHostSearch } from 'vs/workbench/api/node/extHostSearch';\nimport { ExtHostExtensionService } from 'vs/workbench/api/node/extHostExtensionService';\nimport { ExtHostLogService } from 'vs/workbench/api/node/extHostLogService';\nimport { ExtHostTunnelService } from 'vs/workbench/api/node/extHostTunnelService';\nimport { IExtHostDebugService } from 'vs/workbench/api/common/extHostDebugService';\nimport { IExtHostExtensionService } from 'vs/workbench/api/common/extHostExtensionService';\nimport { IExtHostOutputService } from 'vs/workbench/api/common/extHostOutput';\nimport { IExtHostSearch } from 'vs/workbench/api/common/extHostSearch';\nimport { IExtHostTask } from 'vs/workbench/api/common/extHostTask';\nimport { IExtHostTerminalService } from 'vs/workbench/api/common/extHostTerminalService';\nimport { IExtHostTunnelService } from 'vs/workbench/api/common/extHostTunnelService';\nimport { ILogService } from 'vs/platform/log/common/log';\n\n// #########################################################################\n// ###                                                                   ###\n// ### !!! PLEASE ADD COMMON IMPORTS INTO extHost.common.services.ts !!! ###\n// ###                                                                   ###\n// #########################################################################\n\nregisterSingleton(IExtHostExtensionService, ExtHostExtensionService);\nregisterSingleton(ILogService, ExtHostLogService);\n\nregisterSingleton(IExtHostDebugService, ExtHostDebugService);\nregisterSingleton(IExtHostOutputService, ExtHostOutputService2);\nregisterSingleton(IExtHostSearch, NativeExtHostSearch);\nregisterSingleton(IExtHostTask, ExtHostTask);\nregisterSingleton(IExtHostTerminalService, ExtHostTerminalService);\nregisterSingleton(IExtHostTunnelService, ExtHostTunnelService);\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as nativeWatchdog from 'native-watchdog';\nimport * as net from 'net';\nimport * as minimist from 'minimist';\nimport * as performance from 'vs/base/common/performance';\nimport { onUnexpectedError } from 'vs/base/common/errors';\nimport { Event } from 'vs/base/common/event';\nimport { IMessagePassingProtocol } from 'vs/base/parts/ipc/common/ipc';\nimport { PersistentProtocol, ProtocolConstants, BufferedEmitter } from 'vs/base/parts/ipc/common/ipc.net';\nimport { NodeSocket, WebSocketNodeSocket } from 'vs/base/parts/ipc/node/ipc.net';\nimport product from 'vs/platform/product/common/product';\nimport { IInitData } from 'vs/workbench/api/common/extHost.protocol';\nimport { MessageType, createMessageOfType, isMessageOfType, IExtHostSocketMessage, IExtHostReadyMessage, IExtHostReduceGraceTimeMessage, ExtensionHostExitCode } from 'vs/workbench/services/extensions/common/extensionHostProtocol';\nimport { ExtensionHostMain, IExitFn } from 'vs/workbench/services/extensions/common/extensionHostMain';\nimport { VSBuffer } from 'vs/base/common/buffer';\nimport { IURITransformer, URITransformer } from 'vs/base/common/uriIpc';\nimport { exists } from 'vs/base/node/pfs';\nimport { realpath } from 'vs/base/node/extpath';\nimport { IHostUtils } from 'vs/workbench/api/common/extHostExtensionService';\nimport { RunOnceScheduler } from 'vs/base/common/async';\nimport * as proxyAgent from 'vs/base/node/proxy_agent';\n\nimport 'vs/workbench/api/common/extHost.common.services';\nimport 'vs/workbench/api/node/extHost.node.services';\n\ninterface ParsedExtHostArgs {\n\turiTransformerPath?: string;\n\tuseHostProxy?: string;\n}\n\n// workaround for https://github.com/microsoft/vscode/issues/85490\n// remove --inspect-port=0 after start so that it doesn't trigger LSP debugging\n(function removeInspectPort() {\n\tfor (let i = 0; i < process.execArgv.length; i++) {\n\t\tif (process.execArgv[i] === '--inspect-port=0') {\n\t\t\tprocess.execArgv.splice(i, 1);\n\t\t\ti--;\n\t\t}\n\t}\n})();\n\nconst args = minimist(process.argv.slice(2), {\n\tstring: [\n\t\t'uriTransformerPath',\n\t\t'useHostProxy'\n\t]\n}) as ParsedExtHostArgs;\n\n// With Electron 2.x and node.js 8.x the \"natives\" module\n// can cause a native crash (see https://github.com/nodejs/node/issues/19891 and\n// https://github.com/electron/electron/issues/10905). To prevent this from\n// happening we essentially blocklist this module from getting loaded in any\n// extension by patching the node require() function.\n(function () {\n\tconst Module = require.__$__nodeRequire('module') as any;\n\tconst originalLoad = Module._load;\n\n\tModule._load = function (request: string) {\n\t\tif (request === 'natives') {\n\t\t\tthrow new Error('Either the extension or a NPM dependency is using the \"natives\" node module which is unsupported as it can cause a crash of the extension host. Click [here](https://go.microsoft.com/fwlink/?linkid=871887) to find out more');\n\t\t}\n\n\t\treturn originalLoad.apply(this, arguments);\n\t};\n})();\n\n// custom process.exit logic...\nconst nativeExit: IExitFn = process.exit.bind(process);\nfunction patchProcess(allowExit: boolean) {\n\tprocess.exit = function (code?: number) {\n\t\tif (allowExit) {\n\t\t\tnativeExit(code);\n\t\t} else {\n\t\t\tconst err = new Error('An extension called process.exit() and this was prevented.');\n\t\t\tconsole.warn(err.stack);\n\t\t}\n\t} as (code?: number) => never;\n\n\t// override Electron's process.crash() method\n\tprocess.crash = function () {\n\t\tconst err = new Error('An extension called process.crash() and this was prevented.');\n\t\tconsole.warn(err.stack);\n\t};\n}\n\ninterface IRendererConnection {\n\tprotocol: IMessagePassingProtocol;\n\tinitData: IInitData;\n}\n\n// This calls exit directly in case the initialization is not finished and we need to exit\n// Otherwise, if initialization completed we go to extensionHostMain.terminate()\nlet onTerminate = function (reason: string) {\n\tnativeExit();\n};\n\nfunction _createExtHostProtocol(): Promise<PersistentProtocol> {\n\tif (process.env.VSCODE_EXTHOST_WILL_SEND_SOCKET) {\n\n\t\treturn new Promise<PersistentProtocol>((resolve, reject) => {\n\n\t\t\tlet protocol: PersistentProtocol | null = null;\n\n\t\t\tlet timer = setTimeout(() => {\n\t\t\t\treject(new Error('VSCODE_EXTHOST_IPC_SOCKET timeout'));\n\t\t\t}, 60000);\n\n\t\t\tconst reconnectionGraceTime = ProtocolConstants.ReconnectionGraceTime;\n\t\t\tconst reconnectionShortGraceTime = ProtocolConstants.ReconnectionShortGraceTime;\n\t\t\tconst disconnectRunner1 = new RunOnceScheduler(() => onTerminate('renderer disconnected for too long (1)'), reconnectionGraceTime);\n\t\t\tconst disconnectRunner2 = new RunOnceScheduler(() => onTerminate('renderer disconnected for too long (2)'), reconnectionShortGraceTime);\n\n\t\t\tprocess.on('message', (msg: IExtHostSocketMessage | IExtHostReduceGraceTimeMessage, handle: net.Socket) => {\n\t\t\t\tif (msg && msg.type === 'VSCODE_EXTHOST_IPC_SOCKET') {\n\t\t\t\t\tconst initialDataChunk = VSBuffer.wrap(Buffer.from(msg.initialDataChunk, 'base64'));\n\t\t\t\t\tlet socket: NodeSocket | WebSocketNodeSocket;\n\t\t\t\t\tif (msg.skipWebSocketFrames) {\n\t\t\t\t\t\tsocket = new NodeSocket(handle);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst inflateBytes = VSBuffer.wrap(Buffer.from(msg.inflateBytes, 'base64'));\n\t\t\t\t\t\tsocket = new WebSocketNodeSocket(new NodeSocket(handle), msg.permessageDeflate, inflateBytes, false);\n\t\t\t\t\t}\n\t\t\t\t\tif (protocol) {\n\t\t\t\t\t\t// reconnection case\n\t\t\t\t\t\tdisconnectRunner1.cancel();\n\t\t\t\t\t\tdisconnectRunner2.cancel();\n\t\t\t\t\t\tprotocol.beginAcceptReconnection(socket, initialDataChunk);\n\t\t\t\t\t\tprotocol.endAcceptReconnection();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t\t\tprotocol = new PersistentProtocol(socket, initialDataChunk);\n\t\t\t\t\t\tprotocol.onDidDispose(() => onTerminate('renderer disconnected'));\n\t\t\t\t\t\tresolve(protocol);\n\n\t\t\t\t\t\t// Wait for rich client to reconnect\n\t\t\t\t\t\tprotocol.onSocketClose(() => {\n\t\t\t\t\t\t\t// NOTE@coder: Inform the server so we can manage offline\n\t\t\t\t\t\t\t// connections there instead. Our goal is to persist connections\n\t\t\t\t\t\t\t// forever (to a reasonable point) to account for things like\n\t\t\t\t\t\t\t// hibernating overnight.\n\t\t\t\t\t\t\tprocess.send!({ type: 'VSCODE_EXTHOST_DISCONNECTED' });\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (msg && msg.type === 'VSCODE_EXTHOST_IPC_REDUCE_GRACE_TIME') {\n\t\t\t\t\tif (disconnectRunner2.isScheduled()) {\n\t\t\t\t\t\t// we are disconnected and already running the short reconnection timer\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (disconnectRunner1.isScheduled()) {\n\t\t\t\t\t\t// we are disconnected and running the long reconnection timer\n\t\t\t\t\t\tdisconnectRunner2.schedule();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Now that we have managed to install a message listener, ask the other side to send us the socket\n\t\t\tconst req: IExtHostReadyMessage = { type: 'VSCODE_EXTHOST_IPC_READY' };\n\t\t\tif (process.send) {\n\t\t\t\tprocess.send(req);\n\t\t\t}\n\t\t});\n\n\t} else {\n\n\t\tconst pipeName = process.env.VSCODE_IPC_HOOK_EXTHOST!;\n\n\t\treturn new Promise<PersistentProtocol>((resolve, reject) => {\n\n\t\t\tconst socket = net.createConnection(pipeName, () => {\n\t\t\t\tsocket.removeListener('error', reject);\n\t\t\t\tresolve(new PersistentProtocol(new NodeSocket(socket)));\n\t\t\t});\n\t\t\tsocket.once('error', reject);\n\n\t\t});\n\t}\n}\n\nasync function createExtHostProtocol(): Promise<IMessagePassingProtocol> {\n\n\tconst protocol = await _createExtHostProtocol();\n\n\treturn new class implements IMessagePassingProtocol {\n\n\t\tprivate readonly _onMessage = new BufferedEmitter<VSBuffer>();\n\t\treadonly onMessage: Event<VSBuffer> = this._onMessage.event;\n\n\t\tprivate _terminating: boolean;\n\n\t\tconstructor() {\n\t\t\tthis._terminating = false;\n\t\t\tprotocol.onMessage((msg) => {\n\t\t\t\tif (isMessageOfType(msg, MessageType.Terminate)) {\n\t\t\t\t\tthis._terminating = true;\n\t\t\t\t\tonTerminate('received terminate message from renderer');\n\t\t\t\t} else {\n\t\t\t\t\tthis._onMessage.fire(msg);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tsend(msg: any): void {\n\t\t\tif (!this._terminating) {\n\t\t\t\tprotocol.send(msg);\n\t\t\t}\n\t\t}\n\n\t\tdrain(): Promise<void> {\n\t\t\treturn protocol.drain();\n\t\t}\n\t};\n}\n\nfunction connectToRenderer(protocol: IMessagePassingProtocol): Promise<IRendererConnection> {\n\treturn new Promise<IRendererConnection>((c) => {\n\n\t\t// Listen init data message\n\t\tconst first = protocol.onMessage(raw => {\n\t\t\tfirst.dispose();\n\n\t\t\tconst initData = <IInitData>JSON.parse(raw.toString());\n\n\t\t\tconst rendererCommit = initData.commit;\n\t\t\tconst myCommit = product.commit;\n\n\t\t\tif (rendererCommit && myCommit) {\n\t\t\t\t// Running in the built version where commits are defined\n\t\t\t\tif (rendererCommit !== myCommit) {\n\t\t\t\t\tnativeExit(ExtensionHostExitCode.VersionMismatch);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Print a console message when rejection isn't handled within N seconds. For details:\n\t\t\t// see https://nodejs.org/api/process.html#process_event_unhandledrejection\n\t\t\t// and https://nodejs.org/api/process.html#process_event_rejectionhandled\n\t\t\tconst unhandledPromises: Promise<any>[] = [];\n\t\t\tprocess.on('unhandledRejection', (reason: any, promise: Promise<any>) => {\n\t\t\t\tunhandledPromises.push(promise);\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tconst idx = unhandledPromises.indexOf(promise);\n\t\t\t\t\tif (idx >= 0) {\n\t\t\t\t\t\tpromise.catch(e => {\n\t\t\t\t\t\t\tunhandledPromises.splice(idx, 1);\n\t\t\t\t\t\t\tconsole.warn(`rejected promise not handled within 1 second: ${e}`);\n\t\t\t\t\t\t\tif (e && e.stack) {\n\t\t\t\t\t\t\t\tconsole.warn(`stack trace: ${e.stack}`);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonUnexpectedError(reason);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}, 1000);\n\t\t\t});\n\n\t\t\tprocess.on('rejectionHandled', (promise: Promise<any>) => {\n\t\t\t\tconst idx = unhandledPromises.indexOf(promise);\n\t\t\t\tif (idx >= 0) {\n\t\t\t\t\tunhandledPromises.splice(idx, 1);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Print a console message when an exception isn't handled.\n\t\t\tprocess.on('uncaughtException', function (err: Error) {\n\t\t\t\tonUnexpectedError(err);\n\t\t\t});\n\n\t\t\t// Kill oneself if one's parent dies. Much drama.\n\t\t\tlet epermErrors = 0;\n\t\t\tsetInterval(function () {\n\t\t\t\ttry {\n\t\t\t\t\tprocess.kill(initData.parentPid, 0); // throws an exception if the main process doesn't exist anymore.\n\t\t\t\t\tepermErrors = 0;\n\t\t\t\t} catch (e) {\n\t\t\t\t\tif (e && e.code === 'EPERM') {\n\t\t\t\t\t\t// Even if the parent process is still alive,\n\t\t\t\t\t\t// some antivirus software can lead to an EPERM error to be thrown here.\n\t\t\t\t\t\t// Let's terminate only if we get 3 consecutive EPERM errors.\n\t\t\t\t\t\tepermErrors++;\n\t\t\t\t\t\tif (epermErrors >= 3) {\n\t\t\t\t\t\t\tonTerminate(`parent process ${initData.parentPid} does not exist anymore (3 x EPERM): ${e.message} (code: ${e.code}) (errno: ${e.errno})`);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tonTerminate(`parent process ${initData.parentPid} does not exist anymore: ${e.message} (code: ${e.code}) (errno: ${e.errno})`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, 1000);\n\n\t\t\t// In certain cases, the event loop can become busy and never yield\n\t\t\t// e.g. while-true or process.nextTick endless loops\n\t\t\t// So also use the native node module to do it from a separate thread\n\t\t\tlet watchdog: typeof nativeWatchdog;\n\t\t\ttry {\n\t\t\t\twatchdog = require.__$__nodeRequire('native-watchdog');\n\t\t\t\twatchdog.start(initData.parentPid);\n\t\t\t} catch (err) {\n\t\t\t\t// no problem...\n\t\t\t\tonUnexpectedError(err);\n\t\t\t}\n\n\t\t\t// Tell the outside that we are initialized\n\t\t\tprotocol.send(createMessageOfType(MessageType.Initialized));\n\n\t\t\tc({ protocol, initData });\n\t\t});\n\n\t\t// Tell the outside that we are ready to receive messages\n\t\tprotocol.send(createMessageOfType(MessageType.Ready));\n\t});\n}\n\nexport async function startExtensionHostProcess(): Promise<void> {\n\tproxyAgent.monkeyPatch(true);\n\n\tperformance.mark(`code/extHost/willConnectToRenderer`);\n\tconst protocol = await createExtHostProtocol();\n\tperformance.mark(`code/extHost/didConnectToRenderer`);\n\tconst renderer = await connectToRenderer(protocol);\n\tperformance.mark(`code/extHost/didWaitForInitData`);\n\tconst { initData } = renderer;\n\t// setup things\n\tpatchProcess(!!initData.environment.extensionTestsLocationURI); // to support other test frameworks like Jasmin that use process.exit (https://github.com/microsoft/vscode/issues/37708)\n\tinitData.environment.useHostProxy = args.useHostProxy !== undefined ? args.useHostProxy !== 'false' : undefined;\n\n\t// host abstraction\n\tconst hostUtils = new class NodeHost implements IHostUtils {\n\t\tdeclare readonly _serviceBrand: undefined;\n\t\texit(code: number) { nativeExit(code); }\n\t\texists(path: string) { return exists(path); }\n\t\trealpath(path: string) { return realpath(path); }\n\t};\n\n\t// Attempt to load uri transformer\n\tlet uriTransformer: IURITransformer | null = null;\n\tif (initData.remote.authority) {\n\t\ttry {\n\t\t\turiTransformer = new URITransformer(initData.remote.authority);\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t}\n\t}\n\n\tconst extensionHostMain = new ExtensionHostMain(\n\t\trenderer.protocol,\n\t\tinitData,\n\t\thostUtils,\n\t\turiTransformer\n\t);\n\n\t// rewrite onTerminate-function to be a proper shutdown\n\tonTerminate = (reason: string) => extensionHostMain.terminate(reason);\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { startExtensionHostProcess } from 'vs/workbench/services/extensions/node/extensionHostProcessSetup';\n\nstartExtensionHostProcess().catch((err) => console.log(err));\n"],"mappings":"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AA,EAAA,EAAA,IAAA,IACA,EAAA,EAAA,EAAA,IAAA,IACA,EAAA,EAAA,EAAA,IAAA,IACA,EAAA,EAAA,EAAA,KAAA,IACA,EAAA,EAAA,EAAA,KAAA,IACA,EAAA,EAAA,EAAA,KAAA,IACA,EAAA,EAAA,EAAA,KAAA,IACA,EAAA,EAAA,EAAA,KAAA,IACA,EAAA,EAAA,EAAA,KAAA,IACA,EAAA,EAAA,EAAA,KAAA,IACA,EAAA,EAAA,EAAA,KAAA,IACA,EAAA,EAAA,EAAA,KAAA,IACA,EAAA,EAAA,EAAA,KAAA,IACA,EAAA,EAAA,EAAA,KAAA,IACA,EAAA,EAAA,EAAA,KAAA,IACA,EAAA,EAAA,EAAA,KAAA,IACA,EAAA,EAAA,EAAA,KAAA,IACA,EAAA,EAAA,EAAA,KAAA,IACA,EAAA,EAAA,EAAA,KAAA,IACA,EAAA,EAAA,EAAA,KAAA,IACA,EAAA,EAAA,EAAA,KAAA,IACA,EAAA,EAAA,EAAA,KAAA,IACA,EAAA,EAAA,EAAA,KAAA,IACA,EAAA,EAAA,EAAA,KAAA,IACA,EAAA,EAAA,EAAA,KAAA,IACA,EAAA,EAAA,EAAA,KAAA,IAEA,EAAA,EAAA,EAAA,IAAA,IACA,EAAA,EAAA,EAAA,IAAA,IACA,EAAA,EAAA,EAAA,IAAA,IACA,EAAA,EAAA,EAAA,IAAA,IACA,EAAA,EAAA,EAAA,IAAA,IACA,EAAA,EAAA,EAAA,IAAA,IACA,EAAA,EAAA,EAAA,IAAA,IACA,EAAA,EAAA,EAAA,IAAA,IACA,EAAA,EAAA,EAAA,IAAA,IACA,EAAA,EAAA,EAAA,IAAA,IACA,EAAA,EAAA,EAAA,IAAA,IACA,EAAA,EAAA,EAAA,IAAA,IACA,EAAA,EAAA,EAAA,IAAA,IACA,EAAA,EAAA,EAAA,IAAA,IACA,EAAA,EAAA,EAAA,IAAA,IACA,EAAA,EAAA,EAAA,IAAA,IACA,EAAA,EAAA,EAAA,IAAA,IACA,EAAA,EAAA,EAAA,IAAA,IACA,EAAA,EAAA,EAAA,IAAA,IACA,EAAA,EAAA,EAAA,IAAA,IACA,EAAA,EAAA,EAAA,IAAA,IACA,EAAA,EAAA,EAAA,IAAA,IACA,EA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","names":[],"file":"extensionHostProcess.js"}
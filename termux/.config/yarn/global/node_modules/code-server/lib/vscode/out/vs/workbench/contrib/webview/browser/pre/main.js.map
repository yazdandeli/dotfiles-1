{"version":3,"sources":["out-vscode/vs/workbench/contrib/webview/browser/pre/main.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n// @ts-check\n\n/**\n * @typedef {{\n *   postMessage: (channel: string, data?: any) => void,\n *   onMessage: (channel: string, handler: any) => void,\n *   focusIframeOnCreate?: boolean,\n *   ready?: Promise<void>,\n *   onIframeLoaded?: (iframe: HTMLIFrameElement) => void,\n *   fakeLoad?: boolean,\n *   rewriteCSP: (existingCSP: string, endpoint?: string) => string,\n *   onElectron?: boolean\n * }} WebviewHost\n */\n\n(function () {\n\t'use strict';\n\n\tconst isSafari = navigator.vendor && navigator.vendor.indexOf('Apple') > -1 &&\n\t\tnavigator.userAgent &&\n\t\tnavigator.userAgent.indexOf('CriOS') === -1 &&\n\t\tnavigator.userAgent.indexOf('FxiOS') === -1;\n\n\t/**\n\t * Use polling to track focus of main webview and iframes within the webview\n\t *\n\t * @param {Object} handlers\n\t * @param {() => void} handlers.onFocus\n\t * @param {() => void} handlers.onBlur\n\t */\n\tconst trackFocus = ({ onFocus, onBlur }) => {\n\t\tconst interval = 50;\n\t\tlet isFocused = document.hasFocus();\n\t\tsetInterval(() => {\n\t\t\tconst isCurrentlyFocused = document.hasFocus();\n\t\t\tif (isCurrentlyFocused === isFocused) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tisFocused = isCurrentlyFocused;\n\t\t\tif (isCurrentlyFocused) {\n\t\t\t\tonFocus();\n\t\t\t} else {\n\t\t\t\tonBlur();\n\t\t\t}\n\t\t}, interval);\n\t};\n\n\tconst getActiveFrame = () => {\n\t\treturn /** @type {HTMLIFrameElement} */ (document.getElementById('active-frame'));\n\t};\n\n\tconst getPendingFrame = () => {\n\t\treturn /** @type {HTMLIFrameElement} */ (document.getElementById('pending-frame'));\n\t};\n\n\tconst defaultCssRules = `\n\thtml {\n\t\tscrollbar-color: var(--vscode-scrollbarSlider-background) var(--vscode-editor-background);\n\t}\n\n\tbody {\n\t\tbackground-color: transparent;\n\t\tcolor: var(--vscode-editor-foreground);\n\t\tfont-family: var(--vscode-font-family);\n\t\tfont-weight: var(--vscode-font-weight);\n\t\tfont-size: var(--vscode-font-size);\n\t\tmargin: 0;\n\t\tpadding: 0 20px;\n\t}\n\n\timg {\n\t\tmax-width: 100%;\n\t\tmax-height: 100%;\n\t}\n\n\ta {\n\t\tcolor: var(--vscode-textLink-foreground);\n\t}\n\n\ta:hover {\n\t\tcolor: var(--vscode-textLink-activeForeground);\n\t}\n\n\ta:focus,\n\tinput:focus,\n\tselect:focus,\n\ttextarea:focus {\n\t\toutline: 1px solid -webkit-focus-ring-color;\n\t\toutline-offset: -1px;\n\t}\n\n\tcode {\n\t\tcolor: var(--vscode-textPreformat-foreground);\n\t}\n\n\tblockquote {\n\t\tbackground: var(--vscode-textBlockQuote-background);\n\t\tborder-color: var(--vscode-textBlockQuote-border);\n\t}\n\n\tkbd {\n\t\tcolor: var(--vscode-editor-foreground);\n\t\tborder-radius: 3px;\n\t\tvertical-align: middle;\n\t\tpadding: 1px 3px;\n\n\t\tbackground-color: hsla(0,0%,50%,.17);\n\t\tborder: 1px solid rgba(71,71,71,.4);\n\t\tborder-bottom-color: rgba(88,88,88,.4);\n\t\tbox-shadow: inset 0 -1px 0 rgba(88,88,88,.4);\n\t}\n\t.vscode-light kbd {\n\t\tbackground-color: hsla(0,0%,87%,.5);\n\t\tborder: 1px solid hsla(0,0%,80%,.7);\n\t\tborder-bottom-color: hsla(0,0%,73%,.7);\n\t\tbox-shadow: inset 0 -1px 0 hsla(0,0%,73%,.7);\n\t}\n\n\t::-webkit-scrollbar {\n\t\twidth: 10px;\n\t\theight: 10px;\n\t}\n\n\t::-webkit-scrollbar-corner {\n\t\tbackground-color: var(--vscode-editor-background);\n\t}\n\n\t::-webkit-scrollbar-thumb {\n\t\tbackground-color: var(--vscode-scrollbarSlider-background);\n\t}\n\t::-webkit-scrollbar-thumb:hover {\n\t\tbackground-color: var(--vscode-scrollbarSlider-hoverBackground);\n\t}\n\t::-webkit-scrollbar-thumb:active {\n\t\tbackground-color: var(--vscode-scrollbarSlider-activeBackground);\n\t}`;\n\n\t/**\n\t * @param {boolean} allowMultipleAPIAcquire\n\t * @param {*} [state]\n\t * @return {string}\n\t */\n\tfunction getVsCodeApiScript(allowMultipleAPIAcquire, state) {\n\t\tconst encodedState = state ? encodeURIComponent(state) : undefined;\n\t\treturn `\n\t\t\tglobalThis.acquireVsCodeApi = (function() {\n\t\t\t\tconst originalPostMessage = window.parent.postMessage.bind(window.parent);\n\t\t\t\tconst targetOrigin = '*';\n\t\t\t\tlet acquired = false;\n\n\t\t\t\tlet state = ${state ? `JSON.parse(decodeURIComponent(\"${encodedState}\"))` : undefined};\n\n\t\t\t\treturn () => {\n\t\t\t\t\tif (acquired && !${allowMultipleAPIAcquire}) {\n\t\t\t\t\t\tthrow new Error('An instance of the VS Code API has already been acquired');\n\t\t\t\t\t}\n\t\t\t\t\tacquired = true;\n\t\t\t\t\treturn Object.freeze({\n\t\t\t\t\t\tpostMessage: function(msg) {\n\t\t\t\t\t\t\treturn originalPostMessage({ command: 'onmessage', data: msg }, targetOrigin);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsetState: function(newState) {\n\t\t\t\t\t\t\tstate = newState;\n\t\t\t\t\t\t\toriginalPostMessage({ command: 'do-update-state', data: JSON.stringify(newState) }, targetOrigin);\n\t\t\t\t\t\t\treturn newState;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tgetState: function() {\n\t\t\t\t\t\t\treturn state;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t})();\n\t\t\tdelete window.parent;\n\t\t\tdelete window.top;\n\t\t\tdelete window.frameElement;\n\t\t`;\n\t}\n\n\t/**\n\t * @param {WebviewHost} host\n\t */\n\tfunction createWebviewManager(host) {\n\t\t// state\n\t\tlet firstLoad = true;\n\t\tlet loadTimeout;\n\t\tlet pendingMessages = [];\n\n\t\tconst initData = {\n\t\t\tinitialScrollProgress: undefined,\n\t\t};\n\n\n\t\t/**\n\t\t * @param {HTMLDocument?} document\n\t\t * @param {HTMLElement?} body\n\t\t */\n\t\tconst applyStyles = (document, body) => {\n\t\t\tif (!document) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (body) {\n\t\t\t\tbody.classList.remove('vscode-light', 'vscode-dark', 'vscode-high-contrast');\n\t\t\t\tbody.classList.add(initData.activeTheme);\n\n\t\t\t\tbody.dataset.vscodeThemeKind = initData.activeTheme;\n\t\t\t\tbody.dataset.vscodeThemeName = initData.themeName || '';\n\t\t\t}\n\n\t\t\tif (initData.styles) {\n\t\t\t\tconst documentStyle = document.documentElement.style;\n\n\t\t\t\t// Remove stale properties\n\t\t\t\tfor (let i = documentStyle.length - 1; i >= 0; i--) {\n\t\t\t\t\tconst property = documentStyle[i];\n\n\t\t\t\t\t// Don't remove properties that the webview might have added separately\n\t\t\t\t\tif (property && property.startsWith('--vscode-')) {\n\t\t\t\t\t\tdocumentStyle.removeProperty(property);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Re-add new properties\n\t\t\t\tfor (const variable of Object.keys(initData.styles)) {\n\t\t\t\t\tdocumentStyle.setProperty(`--${variable}`, initData.styles[variable]);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * @param {MouseEvent} event\n\t\t */\n\t\tconst handleInnerClick = (event) => {\n\t\t\tif (!event || !event.view || !event.view.document) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet baseElement = event.view.document.getElementsByTagName('base')[0];\n\t\t\t/** @type {any} */\n\t\t\tlet node = event.target;\n\t\t\twhile (node) {\n\t\t\t\tif (node.tagName && node.tagName.toLowerCase() === 'a' && node.href) {\n\t\t\t\t\tif (node.getAttribute('href') === '#') {\n\t\t\t\t\t\tevent.view.scrollTo(0, 0);\n\t\t\t\t\t} else if (node.hash && (node.getAttribute('href') === node.hash || (baseElement && node.href.indexOf(baseElement.href) >= 0))) {\n\t\t\t\t\t\tlet scrollTarget = event.view.document.getElementById(node.hash.substr(1, node.hash.length - 1));\n\t\t\t\t\t\tif (scrollTarget) {\n\t\t\t\t\t\t\tscrollTarget.scrollIntoView();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\thost.postMessage('did-click-link', node.href.baseVal || node.href);\n\t\t\t\t\t}\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tnode = node.parentNode;\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * @param {MouseEvent} event\n\t\t */\n\t\tconst handleAuxClick =\n\t\t\t(event) => {\n\t\t\t\t// Prevent middle clicks opening a broken link in the browser\n\t\t\t\tif (!event.view || !event.view.document) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (event.button === 1) {\n\t\t\t\t\tlet node = /** @type {any} */ (event.target);\n\t\t\t\t\twhile (node) {\n\t\t\t\t\t\tif (node.tagName && node.tagName.toLowerCase() === 'a' && node.href) {\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t/**\n\t\t * @param {KeyboardEvent} e\n\t\t */\n\t\tconst handleInnerKeydown = (e) => {\n\t\t\t// If the keypress would trigger a browser event, such as copy or paste,\n\t\t\t// make sure we block the browser from dispatching it. Instead VS Code\n\t\t\t// handles these events and will dispatch a copy/paste back to the webview\n\t\t\t// if needed\n\t\t\tif (isUndoRedo(e)) {\n\t\t\t\te.preventDefault();\n\t\t\t} else if (isCopyPasteOrCut(e)) {\n\t\t\t\tif (host.onElectron) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t} else {\n\t\t\t\t\treturn; // let the browser handle this\n\t\t\t\t}\n\t\t\t}\n\n\t\t\thost.postMessage('did-keydown', {\n\t\t\t\tkey: e.key,\n\t\t\t\tkeyCode: e.keyCode,\n\t\t\t\tcode: e.code,\n\t\t\t\tshiftKey: e.shiftKey,\n\t\t\t\taltKey: e.altKey,\n\t\t\t\tctrlKey: e.ctrlKey,\n\t\t\t\tmetaKey: e.metaKey,\n\t\t\t\trepeat: e.repeat\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * @param {KeyboardEvent} e\n\t\t * @return {boolean}\n\t\t */\n\t\tfunction isCopyPasteOrCut(e) {\n\t\t\tconst hasMeta = e.ctrlKey || e.metaKey;\n\t\t\tconst shiftInsert = e.shiftKey && e.key.toLowerCase() === 'insert';\n\t\t\treturn (hasMeta && ['c', 'v', 'x'].includes(e.key.toLowerCase())) || shiftInsert;\n\t\t}\n\n\t\t/**\n\t\t * @param {KeyboardEvent} e\n\t\t * @return {boolean}\n\t\t */\n\t\tfunction isUndoRedo(e) {\n\t\t\tconst hasMeta = e.ctrlKey || e.metaKey;\n\t\t\treturn hasMeta && ['z', 'y'].includes(e.key.toLowerCase());\n\t\t}\n\n\t\tlet isHandlingScroll = false;\n\n\t\tconst handleWheel = (event) => {\n\t\t\tif (isHandlingScroll) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\thost.postMessage('did-scroll-wheel', {\n\t\t\t\tdeltaMode: event.deltaMode,\n\t\t\t\tdeltaX: event.deltaX,\n\t\t\t\tdeltaY: event.deltaY,\n\t\t\t\tdeltaZ: event.deltaZ,\n\t\t\t\tdetail: event.detail,\n\t\t\t\ttype: event.type\n\t\t\t});\n\t\t};\n\n\t\tconst handleInnerScroll = (event) => {\n\t\t\tif (!event.target || !event.target.body) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (isHandlingScroll) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst progress = event.currentTarget.scrollY / event.target.body.clientHeight;\n\t\t\tif (isNaN(progress)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tisHandlingScroll = true;\n\t\t\twindow.requestAnimationFrame(() => {\n\t\t\t\ttry {\n\t\t\t\t\thost.postMessage('did-scroll', progress);\n\t\t\t\t} catch (e) {\n\t\t\t\t\t// noop\n\t\t\t\t}\n\t\t\t\tisHandlingScroll = false;\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * @return {string}\n\t\t */\n\t\tfunction toContentHtml(data) {\n\t\t\tconst options = data.options;\n\t\t\tconst text = data.contents;\n\t\t\tconst newDocument = new DOMParser().parseFromString(text, 'text/html');\n\n\t\t\tnewDocument.querySelectorAll('a').forEach(a => {\n\t\t\t\tif (!a.title) {\n\t\t\t\t\ta.title = a.getAttribute('href');\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// apply default script\n\t\t\tif (options.allowScripts) {\n\t\t\t\tconst defaultScript = newDocument.createElement('script');\n\t\t\t\tdefaultScript.id = '_vscodeApiScript';\n\t\t\t\tdefaultScript.textContent = getVsCodeApiScript(options.allowMultipleAPIAcquire, data.state);\n\t\t\t\tnewDocument.head.prepend(defaultScript);\n\t\t\t}\n\n\t\t\t// apply default styles\n\t\t\tconst defaultStyles = newDocument.createElement('style');\n\t\t\tdefaultStyles.id = '_defaultStyles';\n\t\t\tdefaultStyles.textContent = defaultCssRules;\n\t\t\tnewDocument.head.prepend(defaultStyles);\n\n\t\t\tapplyStyles(newDocument, newDocument.body);\n\n\t\t\t// Check for CSP\n\t\t\tconst csp = newDocument.querySelector('meta[http-equiv=\"Content-Security-Policy\"]');\n\t\t\tif (!csp) {\n\t\t\t\thost.postMessage('no-csp-found');\n\t\t\t} else {\n\t\t\t\ttry {\n\t\t\t\t\tcsp.setAttribute('content', host.rewriteCSP(csp.getAttribute('content'), data.endpoint));\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error(`Could not rewrite csp: ${e}`);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// set DOCTYPE for newDocument explicitly as DOMParser.parseFromString strips it off\n\t\t\t// and DOCTYPE is needed in the iframe to ensure that the user agent stylesheet is correctly overridden\n\t\t\treturn '<!DOCTYPE html>\\n' + newDocument.documentElement.outerHTML;\n\t\t}\n\n\t\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\t\tconst idMatch = document.location.search.match(/\\bid=([\\w-]+)/);\n\t\t\tconst ID = idMatch ? idMatch[1] : undefined;\n\t\t\tif (!document.body) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\thost.onMessage('styles', (_event, data) => {\n\t\t\t\tinitData.styles = data.styles;\n\t\t\t\tinitData.activeTheme = data.activeTheme;\n\t\t\t\tinitData.themeName = data.themeName;\n\n\t\t\t\tconst target = getActiveFrame();\n\t\t\t\tif (!target) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (target.contentDocument) {\n\t\t\t\t\tapplyStyles(target.contentDocument, target.contentDocument.body);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// propagate focus\n\t\t\thost.onMessage('focus', () => {\n\t\t\t\tconst activeFrame = getActiveFrame();\n\t\t\t\tif (!activeFrame || !activeFrame.contentWindow) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (document.activeElement === activeFrame) {\n\t\t\t\t\t// We are already focused on the iframe (or one of its children) so no need\n\t\t\t\t\t// to refocus.\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tactiveFrame.contentWindow.focus();\n\t\t\t});\n\n\t\t\t// update iframe-contents\n\t\t\tlet updateId = 0;\n\t\t\thost.onMessage('content', async (_event, data) => {\n\t\t\t\tconst currentUpdateId = ++updateId;\n\t\t\t\tawait host.ready;\n\t\t\t\tif (currentUpdateId !== updateId) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst options = data.options;\n\t\t\t\tconst newDocument = toContentHtml(data);\n\n\t\t\t\tconst frame = getActiveFrame();\n\t\t\t\tconst wasFirstLoad = firstLoad;\n\t\t\t\t// keep current scrollY around and use later\n\t\t\t\tlet setInitialScrollPosition;\n\t\t\t\tif (firstLoad) {\n\t\t\t\t\tfirstLoad = false;\n\t\t\t\t\tsetInitialScrollPosition = (body, window) => {\n\t\t\t\t\t\tif (!isNaN(initData.initialScrollProgress)) {\n\t\t\t\t\t\t\tif (window.scrollY === 0) {\n\t\t\t\t\t\t\t\twindow.scroll(0, body.clientHeight * initData.initialScrollProgress);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tconst scrollY = frame && frame.contentDocument && frame.contentDocument.body ? frame.contentWindow.scrollY : 0;\n\t\t\t\t\tsetInitialScrollPosition = (body, window) => {\n\t\t\t\t\t\tif (window.scrollY === 0) {\n\t\t\t\t\t\t\twindow.scroll(0, scrollY);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// Clean up old pending frames and set current one as new one\n\t\t\t\tconst previousPendingFrame = getPendingFrame();\n\t\t\t\tif (previousPendingFrame) {\n\t\t\t\t\tpreviousPendingFrame.setAttribute('id', '');\n\t\t\t\t\tdocument.body.removeChild(previousPendingFrame);\n\t\t\t\t}\n\t\t\t\tif (!wasFirstLoad) {\n\t\t\t\t\tpendingMessages = [];\n\t\t\t\t}\n\n\t\t\t\tconst newFrame = document.createElement('iframe');\n\t\t\t\tnewFrame.setAttribute('id', 'pending-frame');\n\t\t\t\tnewFrame.setAttribute('frameborder', '0');\n\t\t\t\tnewFrame.setAttribute('sandbox', options.allowScripts ? 'allow-scripts allow-forms allow-same-origin allow-pointer-lock allow-downloads' : 'allow-same-origin allow-pointer-lock');\n\t\t\t\tif (host.fakeLoad) {\n\t\t\t\t\t// We should just be able to use srcdoc, but I wasn't\n\t\t\t\t\t// seeing the service worker applying properly.\n\t\t\t\t\t// Fake load an empty on the correct origin and then write real html\n\t\t\t\t\t// into it to get around this.\n\t\t\t\t\tnewFrame.src = `./fake.html?id=${ID}`;\n\t\t\t\t}\n\t\t\t\tnewFrame.style.cssText = 'display: block; margin: 0; overflow: hidden; position: absolute; width: 100%; height: 100%; visibility: hidden';\n\t\t\t\tdocument.body.appendChild(newFrame);\n\n\t\t\t\tif (!host.fakeLoad) {\n\t\t\t\t\t// write new content onto iframe\n\t\t\t\t\tnewFrame.contentDocument.open();\n\t\t\t\t}\n\n\t\t\t\t/**\n\t\t\t\t * @param {Document} contentDocument\n\t\t\t\t */\n\t\t\t\tfunction onFrameLoaded(contentDocument) {\n\t\t\t\t\t// Workaround for https://bugs.chromium.org/p/chromium/issues/detail?id=978325\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tif (host.fakeLoad) {\n\t\t\t\t\t\t\tcontentDocument.open();\n\t\t\t\t\t\t\tcontentDocument.write(newDocument);\n\t\t\t\t\t\t\tcontentDocument.close();\n\t\t\t\t\t\t\thookupOnLoadHandlers(newFrame);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (contentDocument) {\n\t\t\t\t\t\t\tapplyStyles(contentDocument, contentDocument.body);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 0);\n\t\t\t\t}\n\n\t\t\t\tif (host.fakeLoad && !options.allowScripts && isSafari) {\n\t\t\t\t\t// On Safari for iframes with scripts disabled, the `DOMContentLoaded` never seems to be fired.\n\t\t\t\t\t// Use polling instead.\n\t\t\t\t\tconst interval = setInterval(() => {\n\t\t\t\t\t\t// If the frame is no longer mounted, loading has stopped\n\t\t\t\t\t\tif (!newFrame.parentElement) {\n\t\t\t\t\t\t\tclearInterval(interval);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (newFrame.contentDocument.readyState !== 'loading') {\n\t\t\t\t\t\t\tclearInterval(interval);\n\t\t\t\t\t\t\tonFrameLoaded(newFrame.contentDocument);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 10);\n\t\t\t\t} else {\n\t\t\t\t\tnewFrame.contentWindow.addEventListener('DOMContentLoaded', e => {\n\t\t\t\t\t\tconst contentDocument = e.target ? (/** @type {HTMLDocument} */ (e.target)) : undefined;\n\t\t\t\t\t\tonFrameLoaded(contentDocument);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t/**\n\t\t\t\t * @param {Document} contentDocument\n\t\t\t\t * @param {Window} contentWindow\n\t\t\t\t */\n\t\t\t\tconst onLoad = (contentDocument, contentWindow) => {\n\t\t\t\t\tif (contentDocument && contentDocument.body) {\n\t\t\t\t\t\t// Workaround for https://github.com/microsoft/vscode/issues/12865\n\t\t\t\t\t\t// check new scrollY and reset if necessary\n\t\t\t\t\t\tsetInitialScrollPosition(contentDocument.body, contentWindow);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst newFrame = getPendingFrame();\n\t\t\t\t\tif (newFrame && newFrame.contentDocument && newFrame.contentDocument === contentDocument) {\n\t\t\t\t\t\tconst oldActiveFrame = getActiveFrame();\n\t\t\t\t\t\tif (oldActiveFrame) {\n\t\t\t\t\t\t\tdocument.body.removeChild(oldActiveFrame);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Styles may have changed since we created the element. Make sure we re-style\n\t\t\t\t\t\tapplyStyles(newFrame.contentDocument, newFrame.contentDocument.body);\n\t\t\t\t\t\tnewFrame.setAttribute('id', 'active-frame');\n\t\t\t\t\t\tnewFrame.style.visibility = 'visible';\n\t\t\t\t\t\tif (host.focusIframeOnCreate) {\n\t\t\t\t\t\t\tnewFrame.contentWindow.focus();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcontentWindow.addEventListener('scroll', handleInnerScroll);\n\t\t\t\t\t\tcontentWindow.addEventListener('wheel', handleWheel);\n\n\t\t\t\t\t\tpendingMessages.forEach((data) => {\n\t\t\t\t\t\t\tcontentWindow.postMessage(data, '*');\n\t\t\t\t\t\t});\n\t\t\t\t\t\tpendingMessages = [];\n\t\t\t\t\t}\n\n\t\t\t\t\thost.postMessage('did-load');\n\t\t\t\t};\n\n\t\t\t\t/**\n\t\t\t\t * @param {HTMLIFrameElement} newFrame\n\t\t\t\t */\n\t\t\t\tfunction hookupOnLoadHandlers(newFrame) {\n\t\t\t\t\tclearTimeout(loadTimeout);\n\t\t\t\t\tloadTimeout = undefined;\n\t\t\t\t\tloadTimeout = setTimeout(() => {\n\t\t\t\t\t\tclearTimeout(loadTimeout);\n\t\t\t\t\t\tloadTimeout = undefined;\n\t\t\t\t\t\tonLoad(newFrame.contentDocument, newFrame.contentWindow);\n\t\t\t\t\t}, 200);\n\n\t\t\t\t\tnewFrame.contentWindow.addEventListener('load', function (e) {\n\t\t\t\t\t\tconst contentDocument = /** @type {Document} */ (e.target);\n\n\t\t\t\t\t\tif (loadTimeout) {\n\t\t\t\t\t\t\tclearTimeout(loadTimeout);\n\t\t\t\t\t\t\tloadTimeout = undefined;\n\t\t\t\t\t\t\tonLoad(contentDocument, this);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t// Bubble out various events\n\t\t\t\t\tnewFrame.contentWindow.addEventListener('click', handleInnerClick);\n\t\t\t\t\tnewFrame.contentWindow.addEventListener('auxclick', handleAuxClick);\n\t\t\t\t\tnewFrame.contentWindow.addEventListener('keydown', handleInnerKeydown);\n\t\t\t\t\tnewFrame.contentWindow.addEventListener('contextmenu', e => e.preventDefault());\n\n\t\t\t\t\tif (host.onIframeLoaded) {\n\t\t\t\t\t\thost.onIframeLoaded(newFrame);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!host.fakeLoad) {\n\t\t\t\t\thookupOnLoadHandlers(newFrame);\n\t\t\t\t}\n\n\t\t\t\tif (!host.fakeLoad) {\n\t\t\t\t\tnewFrame.contentDocument.write(newDocument);\n\t\t\t\t\tnewFrame.contentDocument.close();\n\t\t\t\t}\n\n\t\t\t\thost.postMessage('did-set-content', undefined);\n\t\t\t});\n\n\t\t\t// Forward message to the embedded iframe\n\t\t\thost.onMessage('message', (_event, data) => {\n\t\t\t\tconst pending = getPendingFrame();\n\t\t\t\tif (!pending) {\n\t\t\t\t\tconst target = getActiveFrame();\n\t\t\t\t\tif (target) {\n\t\t\t\t\t\ttarget.contentWindow.postMessage(data, '*');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tpendingMessages.push(data);\n\t\t\t});\n\n\t\t\thost.onMessage('initial-scroll-position', (_event, progress) => {\n\t\t\t\tinitData.initialScrollProgress = progress;\n\t\t\t});\n\n\t\t\thost.onMessage('execCommand', (_event, data) => {\n\t\t\t\tconst target = getActiveFrame();\n\t\t\t\tif (!target) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\ttarget.contentDocument.execCommand(data);\n\t\t\t});\n\n\t\t\ttrackFocus({\n\t\t\t\tonFocus: () => host.postMessage('did-focus'),\n\t\t\t\tonBlur: () => host.postMessage('did-blur')\n\t\t\t});\n\n\t\t\t// signal ready\n\t\t\thost.postMessage('webview-ready', {});\n\t\t});\n\t}\n\n\tif (typeof module !== 'undefined') {\n\t\tmodule.exports = createWebviewManager;\n\t} else {\n\t\t(/** @type {any} */ (window)).createWebviewManager = createWebviewManager;\n\t}\n}());\n"],"mappings":"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","names":[],"file":"main.js"}